/* ==========================================================================
   1. Global Styles & Root Variables
   ========================================================================== */
:root {
    /* Light Theme Code Block General (Enhanced) */
    --code-bg-light: #f8f9fa; /* Slightly off-white for light mode code blocks */
    --code-text-light: #212529;
    --code-border-light: #dee2e6;
    --code-header-bg-light: #e9ecef;
    --code-header-text-light: #495057; /* For language name */
    --code-copy-btn-bg-light: #f1f3f5;
    --code-copy-btn-border-light: #ced4da;
    --code-copy-btn-text-light: #495057;
    --code-copy-btn-hover-bg-light: #e9ecef;
    --code-copy-btn-hover-border-light: #adb5bd;
    --code-copy-btn-copied-bg-light: #d1e7dd; /* Light green */
    --code-copy-btn-copied-border-light: #badbcc;
    --code-copy-btn-copied-text-light: #0f5132;

    /* Dark Theme Code Block General (Enhanced) */
    --code-bg-dark: #1E1E1E;
    --code-text-dark: #D4D4D4;
    --code-border-dark: #3c3c3c;
    --code-header-bg-dark: #252526;
    --code-header-text-dark: #CCCCCC;
    --code-copy-btn-bg-dark: #333333;
    --code-copy-btn-border-dark: #454545;
    --code-copy-btn-text-dark: #CCCCCC;
    --code-copy-btn-hover-bg-dark: #3c3c3c;
    --code-copy-btn-hover-border-dark: #505050;
    /* Note: Dark mode 'copied' button styles are hardcoded directly in their rule */
}

body {
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
    overscroll-behavior-y: none;
    background-color: #f3f4f6; /* bg-gray-100 */
    color: #111827; /* text-gray-900 */
    margin: 0;
}
.dark body {
    background-color: #1f2937; /* dark:bg-gray-800 */
    color: #f3f4f6; /* dark:text-gray-100 */
}

/* Custom scrollbar for webkit browsers */
::-webkit-scrollbar { width: 8px; height: 8px; }
::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 10px; }
::-webkit-scrollbar-thumb { background: #888; border-radius: 10px; }
::-webkit-scrollbar-thumb:hover { background: #555; }

.dark ::-webkit-scrollbar-track { background: #2d3748; } /* dark:bg-gray-700ish */
.dark ::-webkit-scrollbar-thumb { background: #4a5568; } /* dark:bg-gray-600ish */
.dark ::-webkit-scrollbar-thumb:hover { background: #718096; } /* dark:bg-gray-500ish */

/* ==========================================================================
   2. General UI Theming (Sidebar, Main Layout, Common Elements)
   ========================================================================== */

/* Main Layout Containers */
aside {
    background-color: white;
    border-right: 1px solid #e5e7eb; /* border-r border-gray-200 */
}
.dark aside {
    background-color: #1f2937; /* dark:bg-gray-800 */
    border-right-color: #374151; /* dark:border-gray-700 */
}
aside .border-b { border-bottom-color: #e5e7eb; }
.dark aside .border-b { border-bottom-color: #374151; }
aside .border-t { border-top-color: #e5e7eb; }
.dark aside .border-t { border-top-color: #374151; }

main {
    background-color: #f9fafb; /* bg-gray-50 */
}
.dark main {
    background-color: #111827; /* dark:bg-gray-900 */
}

main > header { /* Main content area header */
    background-color: white;
    border-bottom: 1px solid #e5e7eb;
}
.dark main > header {
    background-color: #1f2937;
    border-bottom-color: #374151;
}

main > footer { /* Main content area footer, e.g., message input bar */
    background-color: white;
    border-top: 1px solid #e5e7eb;
}
.dark main > footer {
    background-color: #1f2937;
    border-top-color: #374151;
}

/* Sidebar Elements */
aside #newDiscussionBtn {
    background-color: #2563eb; /* bg-blue-600 */
    color: white;
}
aside #newDiscussionBtn:hover {
    background-color: #1d4ed8; /* hover:bg-blue-700 */
}

aside #discussionSearchInput {
    background-color: white;
    border: 1px solid #d1d5db; /* border-gray-300 */
    color: #111827;
}
aside #discussionSearchInput::placeholder { color: #6b7280; /* placeholder-gray-500 */ }
aside #discussionSearchInput:focus {
    outline: none;
    border-color: #3b82f6; /* focus:ring-blue-500 focus:border-blue-500 */
    box-shadow: 0 0 0 3px rgba(59,130,246,0.5);
}
.dark aside #discussionSearchInput {
    background-color: #374151; /* dark:bg-gray-700 */
    border-color: #4b5563; /* dark:border-gray-600 */
    color: #e5e7eb;
}
.dark aside #discussionSearchInput::placeholder { color: #6b7280; /* dark:placeholder-gray-500 */ }
.dark aside #discussionSearchInput:focus {
    border-color: #3b82f6;
    box-shadow: 0 0 0 3px rgba(59,130,246,0.5);
}

.discussion-section-header {
    padding: 0.25rem 0.5rem; font-size: 0.75rem; font-weight: 600;
    text-transform: uppercase; letter-spacing: 0.05em; margin-top: 0.5rem;
    color: #6b7280; /* text-gray-500 */
    background-color: #f3f4f6; /* bg-gray-100 */
    border-bottom: 1px solid #e5e7eb;
}
.dark .discussion-section-header {
    color: #9ca3af; /* dark:text-gray-400 */
    background-color: #1f2937; /* dark:bg-gray-800 */
    border-bottom-color: #374151;
}
.discussion-section-header:first-child { margin-top: 0; }

aside #discussionListContainer .discussion-item {
    color: #374151; /* text-gray-700 */
}
aside #discussionListContainer .discussion-item:hover {
    background-color: #f3f4f6; /* hover:bg-gray-100 */
}
.dark aside #discussionListContainer .discussion-item {
    color: #d1d5db; /* dark:text-gray-300 */
}
.dark aside #discussionListContainer .discussion-item:hover {
    background-color: #374151; /* dark:hover:bg-gray-700 */
}
aside #discussionListContainer .discussion-item.active-discussion {
    background-color: #dbeafe; /* bg-blue-100 */
    color: #1e40af; /* text-blue-800 */
}
aside #discussionListContainer .discussion-item.active-discussion:hover {
    background-color: #bfdbfe; /* hover:bg-blue-200 */
}
.dark aside #discussionListContainer .discussion-item.active-discussion {
    background-color: rgba(29,78,216,0.5); /* dark:bg-blue-700/50 */
    color: #bfdbfe; /* dark:text-blue-200 */
}
.dark aside #discussionListContainer .discussion-item.active-discussion:hover {
    background-color: rgba(29,78,216,0.7); /* dark:hover:bg-blue-700/70 */
}
aside #discussionListContainer .text-gray-500 { color: #6b7280; } /* e.g. "No discussions" text */
.dark aside #discussionListContainer .text-gray-500 { color: #9ca3af; /* dark:text-gray-400 */ }


/* Main Header Elements */
main > header #discussionTitle {
    color: #1f2937; /* text-gray-800 */
}
.dark main > header #discussionTitle {
    color: #f3f4f6; /* dark:text-gray-100 */
}
main > header #languageSelector { /* Assuming this is a select element */
    border: 1px solid #d1d5db;
    background-color: white;
    color: #111827;
    padding: 0.375rem 0.5rem; /* Example padding */
    border-radius: 0.375rem;
}
.dark main > header #languageSelector {
    border-color: #4b5563;
    background-color: #374151;
    color: #e5e7eb;
}
main > header #themeToggleBtn { /* Assuming this is a button */
    color: #6b7280; /* text-gray-500 */
    padding: 0.5rem; /* Example padding */
    border-radius: 0.375rem;
}
main > header #themeToggleBtn:hover {
    background-color: #e5e7eb; /* hover:bg-gray-200 */
}
.dark main > header #themeToggleBtn {
    color: #9ca3af; /* dark:text-gray-400 */
}
.dark main > header #themeToggleBtn:hover {
    background-color: #374151; /* dark:hover:bg-gray-700 */
}

/* Main Footer Elements (Message Input Bar) */
main > footer label[for="imageUploadInput"] { /* Assuming this is the label for file input */
    padding: 0.5rem; /* Example padding */
    border-radius: 0.375rem;
    cursor: pointer;
}
main > footer label[for="imageUploadInput"]:hover {
    background-color: #f3f4f6;
}
main > footer label[for="imageUploadInput"] svg {
    color: #6b7280;
}
main > footer label[for="imageUploadInput"]:hover svg {
    color: #374151;
}
.dark main > footer label[for="imageUploadInput"]:hover {
    background-color: #374151;
}
.dark main > footer label[for="imageUploadInput"] svg {
    color: #9ca3af;
}
.dark main > footer label[for="imageUploadInput"]:hover svg {
    color: #e5e7eb;
}

main > footer #messageInput { /* Textarea for message */
    background-color: white;
    border: 1px solid #d1d5db;
    color: #111827;
    border-radius: 0.375rem;
    padding: 0.5rem 0.75rem;
}
main > footer #messageInput::placeholder { color: #9ca3af; }
main > footer #messageInput:focus {
    outline: none;
    border-color: #3b82f6;
    box-shadow: 0 0 0 2px rgba(59,130,246,0.2);
}
.dark main > footer #messageInput {
    background-color: #374151;
    border-color: #4b5563;
    color: #f3f4f6;
}
.dark main > footer #messageInput::placeholder { color: #6b7280; }
.dark main > footer #messageInput:focus {
    border-color: #3b82f6;
    box-shadow: 0 0 0 2px rgba(59,130,246,0.3);
}

main > footer #sendMessageBtn {
    background-color: #2563eb;
    color: white;
    /* Assuming other button styles like padding, border-radius are applied via a common class or direct HTML */
}
main > footer #sendMessageBtn:hover {
    background-color: #1d4ed8;
}
main > footer #stopGenerationBtn {
    background-color: #dc2626; /* bg-red-600 */
    color: white;
}
main > footer #stopGenerationBtn:hover {
    background-color: #b91c1c; /* hover:bg-red-700 */
}

main > footer #statusMessage { color: #6b7280; }
.dark main > footer #statusMessage { color: #6b7280; } /* Often kept subtle in dark mode too */

main > footer #pyodideStatus { color: #3b82f6; /* text-blue-500 */ }
.dark main > footer #pyodideStatus { color: #60a5fa; /* dark:text-blue-400 */ }

/* User Info & Menu (typically in sidebar footer) */
aside #userInfoContainer #userMenuToggleBtn:hover {
    background-color: #f3f4f6;
}
.dark aside #userInfoContainer #userMenuToggleBtn:hover {
    background-color: #374151;
}
aside #userInfoContainer #userMenuToggleBtn .text-gray-400 { color: #9ca3af; } /* User icon in toggle button */
.dark aside #userInfoContainer #userMenuToggleBtn .text-gray-400 { color: #6b7280; }

aside #userInfoContainer #usernameDisplay { color: #374151; }
.dark aside #userInfoContainer #usernameDisplay { color: #e5e7eb; }

aside #adminBadge {
    background-color: #fee2e2; /* bg-red-100 */
    color: #991b1b; /* text-red-800 */
    /* Assuming padding, font-size, border-radius are applied */
}
.dark aside #adminBadge {
    background-color: rgba(153,27,27,0.5); /* dark:bg-red-800/50 */
    color: #fecaca; /* dark:text-red-200 */
}

#userMenuDropdown {
    background-color: white;
    border: 1px solid #e5e7eb;
    box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1); /* shadow-lg */
}
.dark #userMenuDropdown {
    background-color: #1f2937;
    border-color: #374151;
}
.user-menu-item { /* For items within the dropdown */
    width: 100%; display: flex; align-items: center;
    padding: 0.5rem 0.75rem; /* py-2 px-3 */
    font-size: 0.875rem; /* text-sm */
    border-radius: 0.375rem; /* rounded-md */
    transition: background-color 0.15s ease-in-out, color 0.15s ease-in-out;
    color: #374151;
}
.user-menu-item:hover {
    background-color: #f3f4f6;
    color: #111827;
}
.dark .user-menu-item { color: #d1d5db; }
.dark .user-menu-item:hover {
    background-color: #374151;
    color: white;
}
.user-menu-icon { /* For icons next to menu items */
    width: 1rem; height: 1rem; margin-right: 0.75rem;
    color: #9ca3af;
}
.dark .user-menu-icon { color: #6b7280; }
#userMenuToggleBtn[aria-expanded="true"] #userMenuArrow { transform: rotate(180deg); } /* Arrow rotation */
#userMenuDropdown hr.my-1 { /* Divider in dropdown */
    border-color: #e5e7eb;
    margin-top: 0.25rem; margin-bottom: 0.25rem;
}
.dark #userMenuDropdown hr.my-1 { border-color: #374151; }

.hljs-keyword{
    color: rgb(47, 80, 45)
}

.dark .hljs-keyword{
    color: rgb(186, 241, 182)
}

.hljs-number{
    color: rgb(47, 80, 45)
}



.dark .hljs-number{
    color: rgb(186, 241, 182)
}


.hljs-string{
    color: rgb(54, 107, 52)
}

hljs-string

.dark .hljs-string{
    color: rgb(186, 241, 182)
}

.hljs-title{
    color: rgb(60, 64, 89)
}
.dark .hljs-title{
    color: rgb(191, 198, 243)
}

.hljs-built_in{
    color: rgb(60, 64, 89)
}
.dark .hljs-built_in{
    color: rgb(191, 198, 243)
}

.hljs-comment{
    color: rgb(60, 64, 89)
}
.dark .hljs-comment{
    color: rgb(191, 198, 243)
}


/* ==========================================================================
   3. Chat Area & Message Styling
   ========================================================================== */

.chat-container {
    display: flex;
    flex-direction: column;
    gap: 0.5rem; /* Gap between message containers */
    padding: 1rem;
}

.message-container {
    display: flex;
    flex-direction: column;
    position: relative;
    margin-bottom: 0.5rem; /* Consistent bottom margin */
    opacity: 0;
    transform: translateY(10px);
    animation: messageSlideIn 0.3s ease-out forwards;
}
.message-container.mt-4 .message-bubble { /* For messages with addSpacing: true */
    margin-top: 1rem;
}

/* Base Message Bubble */
.message-bubble {
    max-width: 85%; /* Consolidated from 75% and 85% */
    padding: 0.75rem 1rem; /* Consolidated */
    border-radius: 0.75rem; /* Consolidated */
    margin-bottom: 0.25rem; /* Small gap for consecutive bubbles from same sender */
    word-wrap: break-word;
    overflow-wrap: break-word;
    position: relative;
    line-height: 1.6; /* From message-content, good for readability */
    font-size: 0.95rem; /* From earlier definition, slightly larger than 0.875rem */
    transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
    box-shadow: 0 1px 3px 0 rgba(0,0,0,0.1), 0 1px 2px -1px rgba(0,0,0,0.1); /* Default subtle shadow */
    border: 1px solid transparent; /* Base border, can be overridden */
    /* backdrop-filter: blur(10px); Removed for broader compatibility and performance, can be re-added if desired */
}
.message-bubble:hover {
    /* transform: translateY(-1px); */ /* Subtle hover, can be enabled if desired */
    box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1); /* shadow-lg */
}
.dark .message-bubble:hover {
     box-shadow: 0 10px 15px -3px rgba(0,0,0,0.3), 0 4px 6px -4px rgba(0,0,0,0.2);
}

/* User Bubble */
.user-bubble {
    align-self: flex-end;
    border-bottom-right-radius: 0.25rem; /* For tail effect */
    background-color: #EFF6FF; /* blue-50 */
    color: #1E3A8A; /* blue-900 */
}
.dark .user-bubble {
    background-color: #1E3A8A; /* dark:bg-blue-800 */
    color: #BFDBFE; /* dark:text-blue-200 */
}
/* User bubble tail removed as it was complex and often better handled by border-radius or simpler SVG */

/* AI Bubble */
.ai-bubble {
    align-self: flex-start;
    border-bottom-left-radius: 0.25rem; /* For tail effect */
    background-color: #F9FAFB; /* gray-50 */
    color: #1F2937; /* gray-800 */
    border: 1px solid #e2e8f0; /* border-slate-200 (from an earlier definition, good for definition) */
}
.dark .ai-bubble {
    background-color: #374151; /* dark:bg-gray-700 */
    color: #F3F4F6; /* dark:text-gray-100 */
    border-color: #334155; /* dark:border-slate-700 */
}
/* AI bubble tail removed for consistency, relying on border-radius */

/* System Bubble */
.system-bubble {
    align-self: center;
    font-style: italic;
    font-size: 0.875rem; /* Was 0.8rem and 0.875rem, standardized */
    text-align: center;
    width: auto; /* Let content define width up to max-width */
    max-width: 90%; /* Was 400px and 90%, 90% is more responsive */
    border-radius: 0.5rem; /* Was 0.75rem, 0.5rem is common for system/info */
    padding: 0.5rem 1rem;
    background-color: #FEFCE8; /* yellow-50 */
    color: #713F12; /* yellow-900 */
    border: 1px solid #fde047; /* yellow-300, for definition */
    box-shadow: none; /* System messages typically don't need shadows */
}
.dark .system-bubble {
    background-color: #422006; /* dark:from-yellow-900 to-yellow-800 simplified */
    color: #FEF3C7; /* dark:text-yellow-200 */
    border-color: #a16207; /* dark:border-yellow-700 */
}
/* The class that JavaScript will add to the AI bubble during generation */
.ai-bubble.is-streaming {
    animation: pulse-bg 2s infinite;
}


/* The keyframe animation for the pulse effect */
@keyframes pulse-bg {
    0% {
        background-color: var(--ai-bubble-bg-color);
    }
    50% {
        background-color: var(--ai-bubble-bg-pulse-color);
    }
    100% {
        background-color: var(--ai-bubble-bg-color);
    }
}
/* Sender Information (Name, Avatar, Model Badge) */
.sender-name {
    font-size: 0.75rem; /* Standardized from 0.7rem and 0.75rem */
    font-weight: 600;
    margin-bottom: 0.375rem; /* Standardized */
    letter-spacing: 0.025em;
    text-transform: uppercase;
    opacity: 0.9; /* Slightly more visible */
    color: #4B5563; /* gray-600 */
}
.dark .sender-name { color: #D1D5DB; /* dark:text-gray-300 */ }

.sender-name .flex { /* Container for avatar + name text */
    display: flex;
    align-items: center;
    gap: 0.5rem;
}
.sender-avatar { /* For the avatar circle */
    width: 1.5rem; /* 24px */
    height: 1.5rem; /* 24px */
    border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    font-size: 0.75rem; font-weight: 600; /* For initial/icon fallback */
    color: white; /* Default text color for fallback, BG set by JS/context */
    box-shadow: 0 1px 2px 0 rgb(0 0 0 / 0.05); /* shadow-sm */
    overflow: hidden; /* To clip img if it's not perfectly round */
}
.sender-avatar img {
    width: 100%; height: 100%; object-fit: cover;
}

.user-bubble .sender-name { display: none; } /* User bubbles typically don't show sender name to self */
.ai-bubble .sender-name { color: #16A34A; /* green-600, distinct for AI */ }
.dark .ai-bubble .sender-name { color: #6EE7B7; /* dark:green-300 */ }

.model-badge {
    padding: 0.125rem 0.375rem;
    border-radius: 0.25rem; /* Standardized */
    font-size: 0.625rem; /* 10px, consistent */
    font-weight: 500;
    opacity: 0.8;
    background-color: rgba(0,0,0,0.05);
    color: #4B5563; /* gray-600 */
    margin-left: 0.25rem; /* Spacing if next to name */
}
.dark .model-badge {
    background-color: rgba(255,255,255,0.1);
    color: #9CA3AF; /* gray-400 */
}

/* Message Timestamp */
.message-timestamp {
    font-size: 0.625rem; /* 10px, consistent */
    opacity: 0.7; /* Slightly more visible */
    margin-top: 0.25rem; /* Default top margin */
    line-height: 1;
    color: #6B7280; /* gray-500 */
}
.sender-name + .message-timestamp { /* If timestamp is directly after sender name block */
    margin-left: calc(1.5rem + 0.5rem); /* Align with sender text, after avatar + gap */
    margin-top: -0.25rem; /* Pull it slightly closer */
}
.message-bubble > .message-content + .message-timestamp { /* Timestamp after main content */
    text-align: right;
    margin-top: 0.375rem;
}
.user-bubble .message-timestamp {
    /* text-align: left; */ /* User bubble timestamps usually also right-aligned for consistency */
    color: rgba(255, 255, 255, 0.8); /* If user bubble has dark BG */
}
.dark .message-timestamp { color: #9CA3AF; /* dark:text-gray-400 */ }
.dark .user-bubble .message-timestamp { color: #9CA3AF; /* Ensure user bubble timestamp is also legible in dark mode */ }


/* Message Content Styling */
.message-content {
    word-wrap: break-word;
    overflow-wrap: break-word;
    word-break: break-word; /* More aggressive break for long unbreakable strings */
    position: relative;
    z-index: 1;
    min-width: 10px; /* Prevents collapse for very short/empty streaming content */
}
.message-content p:last-child { margin-bottom: 0; }

.message-content a { /* General link styling in messages */
    text-decoration: underline;
    color: #2563eb; /* Default link color (blue-600) */
}
.message-content a:hover { color: #1d4ed8; /* blue-700 */ }

.dark .message-content a { color: #60a5fa; /* dark:text-blue-400 */ }
.dark .message-content a:hover { color: #93c5fd; /* dark:text-blue-300 */ }

.user-bubble .message-content a {
    color: inherit; /* Inherit from user bubble text color */
    text-decoration-color: rgba(255, 255, 255, 0.7); /* If user bubble has light text on dark bg */
}
/* If user bubble has dark text on light bg (as per current user-bubble style) */
.user-bubble .message-content a {
    color: #1D4ED8; /* A darker blue for user bubble links for contrast */
    text-decoration-color: currentColor;
}
.dark .user-bubble .message-content a {
    color: #93C5FD; /* Lighter blue for dark mode user bubble links */
    text-decoration-color: currentColor;
}


/* Simple Preformatted Text within Message Bubbles */
.message-bubble pre.simple-code {
    border-radius: 0.5rem;
    padding: 0.75rem;
    margin: 0.5rem 0;
    overflow-x: auto;
    font-size: 0.85rem;
    background-color: rgba(0,0,0,0.05);
    color: #111827;
    font-family: 'Fira Code', 'Monaco', 'Cascadia Code', 'Roboto Mono', monospace;
}
.dark .message-bubble pre.simple-code {
    background-color: rgba(255,255,255,0.05);
}
.user-bubble pre.simple-code { /* Slightly different for user bubble contrast */
    background-color: rgba(0,0,0,0.08); /* Assuming light user bubble bg */
}
.dark .user-bubble pre.simple-code {
    background-color: rgba(255,255,255,0.1);
}

/* Message Images */
.message-images-container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); /* Min image size 150px */
    gap: 0.5rem;
    margin: 0.75rem 0;
}
.message-image-item {
    position: relative; border-radius: 0.5rem; overflow: hidden;
    transition: transform 0.2s ease, opacity 0.3s ease;
    background-color: #e5e7eb; /* bg-gray-200 as placeholder */
    border: 1px solid #d1d5db; /* border-gray-300 */
}
.dark .message-image-item {
    background-color: #374151; /* dark:bg-gray-700 */
    border-color: #4b5563; /* dark:border-gray-600 */
}
.message-image-item:hover { transform: scale(1.02); }
.message-image-item img {
    width: 100%; height: auto; display: block;
    cursor: pointer;
    opacity: 0; /* Start hidden, fade in when loaded */
}
.message-image-item.loaded img { opacity: 1; }
.message-image-item.error { border-color: #EF4444; /* red-500 */ }
.message-image-item.error::after {
    content: 'Failed to load'; position: absolute; top: 50%; left: 50%;
    transform: translate(-50%, -50%); font-size: 0.75rem;
    color: #dc2626; /* text-red-600 */
    padding: 0.25rem 0.5rem; background: rgba(255,255,255,0.8); border-radius: 0.25rem;
}
.dark .message-image-item.error::after {
    color: #f87171; /* dark:text-red-400 */
    background: rgba(0,0,0,0.7);
}

/* --- Image Modal Viewer Styles (REVISED) --- */

.image-modal-overlay {
    position: fixed;
    top: 0; left: 0;
    width: 100vw; height: 100vh;
    background-color: rgba(0, 0, 0, 0.85);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 1000;
    opacity: 0;
    transition: opacity 0.3s ease;
    cursor: zoom-out;
}

.image-modal-overlay.visible {
    opacity: 1;
}

.image-modal-content {
    position: relative;
    max-width: 90vw;
    max-height: 90vh;
    transition: transform 0.3s ease;
    cursor: grab;
    
    /* --- KEY CHANGES --- */
    display: flex; /* Make the container a flexbox */
    overflow: auto; /* Add scrollbars if content overflows */
}

.image-modal-content.zoomed {
    cursor: move;
    overflow: hidden; /* Hide scrollbars when zoomed for panning */
}

.image-modal-content img {
    /* --- KEY CHANGES --- */
    width: auto;
    height: auto;
    max-width: 100%;  /* The image can't be wider than its container */
    max-height: 100%; /* The image can't be taller than its container */
    margin: auto;     /* This centers the image perfectly inside the flex container */
    user-select: none;
    -webkit-user-drag: none;
}

.image-modal-close-btn {
    position: absolute;
    top: -40px;
    right: 0;
    background: none;
    border: none;
    color: white;
    font-size: 2rem;
    cursor: pointer;
    padding: 0.5rem;
    line-height: 1;
}

.image-modal-help-text {
    position: absolute;
    bottom: -40px;
    left: 50%;
    transform: translateX(-50%);
    color: rgba(255, 255, 255, 0.8);
    font-size: 0.9rem;
    white-space: nowrap;
    pointer-events: none;
}

/* Typing Indicator */
/* --- Typing Indicator Styles --- */
.typing-indicator {
    display: flex;
    align-items: center;
    padding: 10px 0;
}

.typing-indicator span {
    height: 8px;
    width: 8px;
    border-radius: 50%;
    background-color: #9ca3af; /* A neutral gray */
    margin: 0 2px;
    animation: bounce 1.4s infinite ease-in-out both;
}

.dark .typing-indicator span {
    background-color: #6b7280;
}

.typing-indicator span:nth-of-type(1) {
    animation-delay: -0.32s;
}

.typing-indicator span:nth-of-type(2) {
    animation-delay: -0.16s;
}

/* The bouncing animation keyframes */
@keyframes bounce {
    0%, 80%, 100% {
        transform: scale(0);
    }
    40% {
        transform: scale(1.0);
    }
}
.typing-bubble { /* Represents the AI bubble placeholder */
    align-self: flex-start;
    padding: 1rem 1.25rem; /* Matches AI bubble padding if desired or can be unique */
    border-radius: 1.25rem;
    border-bottom-left-radius: 0.375rem;
    max-width: 75px; /* Small, just for dots */
    animation: pulse 1.5s ease-in-out infinite;
    background-color: #f1f5f9; /* bg-slate-100 */
    border: 1px solid #e2e8f0; /* border-slate-200 */
}
.dark .typing-bubble {
    background-color: #1e293b; /* dark:bg-slate-800 */
    border-color: #334155; /* dark:border-slate-700 */
}
.typing-dots { display: flex; gap: 0.375rem; justify-content: center; align-items:center; height:100%;}
.typing-dot {
    width: 8px; height: 8px; border-radius: 50%;
    animation: typingAnimation 1.4s ease-in-out infinite;
    background-color: #94a3b8; /* bg-slate-400 */
}
.dark .typing-dot {
    background-color: #64748b; /* dark:bg-slate-500 */
}
.typing-dot:nth-child(1) { animation-delay: 0s; }
.typing-dot:nth-child(2) { animation-delay: 0.2s; }
.typing-dot:nth-child(3) { animation-delay: 0.4s; }

/* Date Separator */
.date-separator {
    display: flex; align-items: center; margin: 1.5rem 0; gap: 1rem;
}
.date-separator-line {
    flex: 1; height: 1px; background-color: #e5e7eb; /* bg-gray-200 */
}
.dark .date-separator-line { background-color: #374151; /* dark:bg-gray-700 */ }
.date-separator-text {
    font-size: 0.75rem; font-weight: 500; text-transform: uppercase;
    letter-spacing: 0.05em; padding: 0.25rem 0.75rem;
    border-radius: 1rem;
    color: #6b7280; /* text-gray-500 */
    background-color: #f3f4f6; /* bg-gray-100 */
}
.dark .date-separator-text {
    color: #9ca3af; /* dark:text-gray-400 */
    background-color: #1f2937; /* dark:bg-gray-800 */
}

/* Empty Message Placeholder (e.g. if message content is null) */
.empty-message {
    font-style: italic; margin: 0; padding: 0.25rem 0; /* Ensure it takes some space */
    color: #6b7280; /* text-gray-500 */
}
.dark .empty-message { color: #9ca3af; /* dark:text-gray-400 */ }

/* --- Step Rendering Styles --- */
.steps-container {
    margin-top: 1rem;
    padding-top: 0.75rem;
    border-top: 1px solid #e5e7eb; /* border-gray-200 */
}
.dark .steps-container {
    border-top-color: #374151; /* dark:border-gray-700 */
}


.step-item {
    display: flex;
    align-items: center;
    margin-bottom: 0.5rem;
    font-size: 0.875rem;
    color: #6b7280;
}
.dark .step-item {
    color: #9ca3af; /* dark:text-gray-400 */
}

.step-icon {
    flex-shrink: 0;
    width: 1.25rem; /* w-5 */
    height: 1.25rem; /* h-5 */
    margin-right: 0.75rem; /* mr-3 */
}

/* Spinner for 'pending' status */
.step-item.status-pending .step-icon .spinner {
    animation: rotate 1.5s linear infinite;
    width: 1rem;
    height: 1rem;
}
.step-item.status-pending .step-icon .spinner .path {
    stroke: #6b7280; /* text-gray-500 */
    stroke-linecap: round;
    animation: dash 1.5s ease-in-out infinite;
}
.dark .step-item.status-pending .step-icon .spinner .path {
    stroke: #9ca3af; /* dark:text-gray-400 */
}

/* Checkmark for 'done' status */
.step-item.status-done .step-icon {
    color: #10B981; /* green-500 */
}
.dark .step-item.status-done .step-icon {
    color: #34D399; /* green-400 */
}
.step-item.status-done .step-text {
    color: #1f2937; /* text-gray-800 */
}
.dark .step-item.status-done .step-text {
    color: #d1d5db; /* dark:text-gray-300 */
}

/* --- New styles for differentiated steps --- */

/* Style for informational steps ('step' type) */
.step-item-info {
    color: #4B5563; /* gray-600 */
    align-items: flex-start; /* Align icon to top */
}
.dark .step-item-info {
    color: #D1D5DB; /* dark:text-gray-300 */
}
.step-item-info .step-icon {
    margin-top: 0.125rem; /* Align icon nicely with first line of text */
}

/* Style for process steps ('step_start'/'step_end' type) */
.step-item-process.status-pending {
    color: #6b7280; /* text-gray-500 */
}
.dark .step-item-process.status-pending {
    color: #9ca3af; /* dark:text-gray-400 */
}


/* Spinner Keyframe Animations */
@keyframes rotate { 100% { transform: rotate(360deg); } }
@keyframes dash {
    0% { stroke-dasharray: 1, 150; stroke-dashoffset: 0; }
    50% { stroke-dasharray: 90, 150; stroke-dashoffset: -35; }
    100% { stroke-dasharray: 90, 150; stroke-dashoffset: -124; }
}
/* --- Collapsible Steps Styles --- */
.steps-container {
    margin-top: 1rem;
    padding-top: 0.75rem;
    border-top: 1px solid #e5e7eb; /* border-gray-200 */
    overflow: hidden; /* Key for the collapse animation */
    transition: max-height 0.4s ease-in-out;
}
.dark .steps-container {
    border-top-color: #374151; /* dark:border-gray-700 */
}

/* By default, the container is collapsed to show only the last step */
.steps-container.collapsed {
    /* Adjust this value if your step items have different heights */
    max-height: 36px; 
}




/* ... (step-icon, spinner, and status-done styles remain the same) ... */

/* --- The Toggle Button --- */
.steps-toggle-button {
    background: none; border: none;
    color: #6B7280; font-size: 0.8rem;
    font-weight: 500; cursor: pointer;
    margin-top: 0.25rem; padding: 0.25rem 0;
    display: flex; align-items: center;
    width: 100%;
}
.dark .steps-toggle-button { color: #9CA3AF; }
.steps-toggle-button:hover .toggle-text { text-decoration: underline; }

.steps-toggle-button .toggle-text {
    /* --- Key addition for long text --- */
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    flex-grow: 1;
    text-align: left;
}

.steps-toggle-button .toggle-arrow {
    width: 0.85rem; height: 0.85rem;
    margin-left: 0.5rem;
    flex-shrink: 0;
    transition: transform 0.3s ease;
}
.steps-container.collapsed + .steps-toggle-button .toggle-arrow {
    transform: rotate(-90deg);
}
/* ==========================================================================
   4. Code Blocks & Output
   ========================================================================== */

/* Shared Styles */
.code-block-container,
.code-block-wrapper {
    border-radius: 0.75rem;
    overflow: hidden;
    box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.05), 0 2px 4px -2px rgb(0 0 0 / 0.05);
    font-family: 'Fira Code', 'Monaco', 'Cascadia Code', 'Roboto Mono', monospace;
    box-sizing: border-box;
}

/* Light Theme Container */
.code-block-container {
    margin: 1rem 0;
    background: var(--code-bg-light);
    border: 1px solid var(--code-border-light);
}

/* Dark Theme Container */
.dark .code-block-container {
    background: var(--code-bg-dark);
    border-color: var(--code-border-dark);
}

/* Header Shared */
.code-block-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.75rem 1rem;
    border-bottom: 1px solid var(--code-border-light);
    background: var(--code-header-bg-light);
}

.dark .code-block-header {
    border-bottom-color: var(--code-border-dark);
    background: var(--code-header-bg-dark);
}

/* Language Label */
.code-language {
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--code-header-text-light);
}

.dark .code-language {
    color: var(--code-header-text-dark);
}

/* Copy Button */
.code-copy-btn {
    display: flex;
    align-items: center;
    gap: 0.25rem;
    padding: 0.25rem 0.5rem;
    border-radius: 0.375rem;
    font-size: 0.75rem;
    cursor: pointer;
    transition: all 0.2s ease;
    background: var(--code-copy-btn-bg-light);
    border: 1px solid var(--code-copy-btn-border-light);
    color: var(--code-copy-btn-text-light);
}

.dark .code-copy-btn {
    background: var(--code-copy-btn-bg-dark);
    border-color: var(--code-copy-btn-border-dark);
    color: var(--code-copy-btn-text-dark);
}

.code-copy-btn:hover {
    background: var(--code-copy-btn-hover-bg-light);
    border-color: var(--code-copy-btn-hover-border-light);
}

.dark .code-copy-btn:hover {
    background: var(--code-copy-btn-hover-bg-dark);
    border-color: var(--code-copy-btn-hover-border-dark);
}

.code-copy-btn.copied {
    background: var(--code-copy-btn-copied-bg-light);
    border-color: var(--code-copy-btn-copied-border-light);
    color: var(--code-copy-btn-copied-text-light);
}

.dark .code-copy-btn.copied {
    background: #22c55e;
    border-color: #16a34a;
    color: white;
}

.code-copy-btn svg {
    width: 14px;
    height: 14px;
}

/* Code Block */
.code-block {
    margin: 0;
    padding: 1rem;
    font-size: 0.875rem;
    line-height: 1.6;
    overflow-x: auto;
    color: var(--code-text-light);
    background: var(--code-bg-light);
}

.dark .code-block {
    color: var(--code-text-dark);
    background: var(--code-bg-dark);
}

/* Wrapper for Basic Blocks */
.code-block-wrapper {
    margin-bottom: 1rem;
    border: 1px solid #e5e7eb;
    border-radius: 0.375rem;
}

.dark .code-block-wrapper {
    border-color: #374151;
}

.code-block-wrapper .code-block-header {
    padding: 0.5rem 0.75rem;
    font-size: 0.8em;
    font-weight: 500;
    background-color: #f3f4f6;
    color: #374151;
    border-bottom: 1px solid #d1d5db;
}

.dark .code-block-wrapper .code-block-header {
    background-color: #1f2937;
    color: #d1d5db;
    border-bottom-color: #374151;
}

/* Buttons Inside Wrapper */
.code-block-buttons button {
    border: 1px solid #d1d5db;
    padding: 0.25rem 0.5rem;
    font-size: 0.75em;
    border-radius: 0.25rem;
    margin-left: 0.5rem;
    cursor: pointer;
    transition: background-color 0.2s;
    background-color: #e5e7eb;
    color: #374151;
}

.code-block-buttons button:hover {
    background-color: #d1d5db;
}

.dark .code-block-buttons button {
    background-color: #374151;
    border-color: #4b5563;
    color: #e5e7eb;
}

.dark .code-block-buttons button:hover {
    background-color: #4b5563;
}

.code-block-buttons button svg {
    vertical-align: middle;
}

/* <pre> styles in prose context */
.message-content.prose pre,
.code-block-wrapper pre {
    padding: 0 !important;
    margin: 0 !important;
    border-radius: 0 !important;
    background-color: transparent !important;
    white-space: pre-wrap;
    word-break: break-all;
    overflow-x: auto;
}

.message-content.prose pre {
    padding: 1em;
    display: block;
    font-size: 0.875em;
    line-height: 1.6;
    border-bottom-left-radius: 0.375rem;
    border-bottom-right-radius: 0.375rem;
}

/* Code Output Styling */
.code-output {
    font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    font-size: 0.875em;
    padding: 0.75em 1em;
    margin-top: 0;
    border-top: 1px solid #d1d5db;
    border-radius: 0 0 0.375rem 0.375rem;
    background-color: #f9fafb;
    color: #1f2937;
    max-height: 200px;
    overflow-y: auto;
    word-break: break-all;
}

.dark .code-output {
    background-color: #111827;
    color: #9ca3af;
    border-top-color: #374151;
}


/* ==========================================================================
   5. Message Footer, Actions & Details
   ========================================================================== */

.message-footer {
    margin-top: 0.75rem;
    padding-top: 0.5rem;
    border-top: 1px solid rgba(0,0,0,0.07);
}
.dark .message-footer {
    border-top-color: rgba(255,255,255,0.07);
}

.footer-content {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    gap: 0.75rem;
    flex-wrap: wrap; /* Allow sections to wrap */
}

.message-details { /* Container for badges like token count, time, sources */
    display: flex;
    align-items: center;
    flex-wrap: wrap;
    gap: 0.5rem;
    flex-grow: 1;
    min-width: 0; /* For proper flex wrapping */
}

.message-footer-actions { /* Container for action buttons (copy, edit) and rating */
    display: flex;
    align-items: center;
    gap: 0.75rem; /* Space between actions group and rating group */
    flex-shrink: 0;
}
.message-actions-group { /* Wrapper for copy,edit,delete buttons specifically */
    display: flex;
    align-items: center;
    gap: 0.25rem; /* Tighter gap for individual action buttons */
}
.message-actions-group button:disabled,
.message-rating button:disabled {
    opacity: var(--message-action-btn-disabled-opacity);
    cursor: not-allowed;
}

/* Detail Badges (Token, Time, Source) */
.detail-badge {
    display: inline-flex;
    align-items: center;
    gap: 0.25rem;
    padding: 0.25rem 0.5rem;
    border-radius: 0.375rem; /* 6px */
    font-size: 0.75rem; /* 12px */
    font-weight: 500;
    line-height: 1;
    background-color: rgba(0,0,0,0.05);
    color: #4B5563; /* gray-600 */
    border: 1px solid transparent;
}
.dark .detail-badge {
    background-color: rgba(255,255,255,0.08);
    color: #9CA3AF; /* gray-400 */
}
.detail-badge svg {
    width: 0.875rem; /* 14px */
    height: 0.875rem;
}

.token-badge { background-color: #DCFCE7; color: #166534; /* green-100, green-800 */ }
.dark .token-badge { background-color: #14532D; color: #A7F3D0; /* dark:green-900, dark:green-300 */ }

.time-badge { background-color: #E0E7FF; color: #3730A3; /* indigo-100, indigo-800 */ }
.dark .time-badge { background-color: #3730A3; color: #C7D2FE; /* dark:indigo-800, dark:indigo-200 */ }

.source-badge {
    cursor: pointer;
    background-color: #f9fbe7; /* Light greenish-yellow from late override, preferred over #EFEFEF */
    transition: background-color 0.2s ease, border-color 0.2s ease;
    border: 1px solid rgba(0,0,0,0.1);
    text-align: left;
}
.dark .source-badge {
    background-color: #2D3748; /* dark:gray-750 */
    border-color: rgba(255,255,255,0.15);
}
.source-badge:hover, .source-badge:focus {
    background-color: #eef2c3; /* Slightly darker/saturated version of #f9fbe7 */
    border-color: rgba(0,0,0,0.2);
    outline: none;
}
.dark .source-badge:hover, .dark .source-badge:focus {
    background-color: #4A5568; /* dark:gray-600 */
    border-color: rgba(255,255,255,0.25);
}
.source-badge .source-similarity-chip {
    font-size: 0.625rem;
    padding: 0.1rem 0.3rem;
    border-radius: 0.25rem;
    background-color: rgba(0,0,0,0.1);
    margin-left: 0.25rem;
}
.dark .source-badge .source-similarity-chip { background-color: rgba(255,255,255,0.15); }


/* General Action Buttons (used in footer, discussion items, etc.) */
.action-btn, .message-action-btn {
    background: none; border: none; padding: 0.375rem; /* 6px padding */
    cursor: pointer; border-radius: 0.375rem; /* 6px */
    display: flex; align-items: center; justify-content: center;
    transition: background-color 0.15s ease, color 0.15s ease;
    color: #4B5563; /* gray-600 */
}
.action-btn:hover, .message-action-btn:hover {
    background-color: #E5E7EB; /* gray-200 */
    color: #1F2937; /* gray-800 */
}
.dark .action-btn, .dark .message-action-btn {
    color: #D1D5DB; /* dark:text-gray-300 */
}
.dark .action-btn:hover, .dark .message-action-btn:hover {
    background-color: #4B5563; /* dark:bg-gray-600 */
    color: #F9FAFB; /* dark:text-gray-50 */
}
.action-btn svg, .message-action-btn svg {
    width: 1rem; height: 1rem; /* 16px */
}

/* Destructive action button variant */
.action-btn.destructive:hover, .message-action-btn.destructive:hover {
    background-color: #FEE2E2; /* red-100 */
    color: #991B1B; /* red-800 */
}
.dark .action-btn.destructive:hover, .dark .message-action-btn.destructive:hover {
    background-color: #7F1D1D; /* dark:bg-red-900 */
    color: #FECACA; /* dark:text-red-200 */
}
/* Primary action button variant */
.action-btn.primary:hover { /* Base color inherited, hover changes */
    background-color: #DBEAFE; /* blue-100 */
    color: #1D4ED8; /* blue-700 */
}
.dark .action-btn.primary:hover {
    background-color: #1E3A8A; /* dark:bg-blue-800 */
    color: #93C5FD; /* dark:text-blue-300 */
}

/* Message Rating Controls */
.message-rating {
    display: flex;
    align-items: center;
    gap: 0.125rem; /* 2px, very tight for rating controls */
    padding: 0.125rem;
    border-radius: 0.5rem; /* 8px */
    background-color: rgba(0,0,0,0.03);
}
.dark .message-rating {
    background-color: rgba(255,255,255,0.04);
}

.rating-btn { /* Individual up/down vote icon wrapper */
    display: flex; align-items: center; justify-content: center;
    width: 24px; height: 24px;
    border: none; border-radius: 50%; /* Circle */
    background: transparent; cursor: pointer;
    transition: background-color 0.15s ease, color 0.15s ease;
    color: #9CA3AF; /* gray-400 */
}
.rating-btn:hover {
    background-color: rgba(0,0,0,0.07);
    color: #4B5563; /* gray-600 */
}
.dark .rating-btn { color: #6B7280; /* dark:text-gray-500 */ }
.dark .rating-btn:hover {
    background-color: rgba(255,255,255,0.07);
    color: #D1D5DB; /* dark:text-gray-300 */
}

.rating-btn.upvote.active { background-color: #D1FAE5; color: #065F46; /* green-100, green-800 */ }
.dark .rating-btn.upvote.active { background-color: #064E3B; color: #6EE7B7; /* dark:green-900, dark:green-300 */ }

.rating-btn.downvote.active { background-color: #FEE2E2; color: #991B1B; /* red-100, red-800 */ }
.dark .rating-btn.downvote.active { background-color: #7F1D1D; color: #FCA5A5; /* dark:red-900, dark:red-400 */ }

.rating-btn svg { width: 0.875rem; height: 0.875rem; /* 14px */ }

.rating-score { /* Numeric score between rating buttons */
    min-width: 20px; text-align: center; font-size: 0.75rem; /* 12px */
    font-weight: 600;
    padding: 0 0.25rem;
    color: #374151; /* gray-700 */
    line-height: 1;
}
.dark .rating-score { color: #E5E7EB; /* dark:text-gray-200 */ }


/* ==========================================================================
   6. Modals & Popups
   ========================================================================== */

/* General Modal Styling */
.modal {
    position: fixed; inset: 0; display: flex;
    align-items: center; justify-content: center;
    z-index: 50; opacity: 0; pointer-events: none;
    transition: opacity 0.3s ease-in-out;
    padding: 1rem; backdrop-filter: blur(4px);
    background-color: rgba(0,0,0,0.75); /* bg-black/75 */
}
.dark .modal {
    background-color: rgba(0,0,0,0.85); /* dark:bg-black/85 */
}
.modal.active { opacity: 1; pointer-events: auto; }
.modal.active .modal-content { animation: modalSlideInAnimation 0.3s ease-out forwards; }

.modal-content {
    padding: 0; /* Header/body/footer will have padding */
    border-radius: 0.5rem;
    max-width: 95vw; width: 600px; /* Default width, can be overridden by specific modal IDs */
    max-height: 90vh;
    display: flex; flex-direction: column; position: relative;
    background-color: white; /* bg-white */
    color: #111827; /* text-gray-900 */
    box-shadow: 0 25px 50px -12px rgb(0 0 0 / 0.25); /* shadow-2xl */
    border: 1px solid #d1d5db; /* border-gray-300 */
}
.dark .modal-content {
    background-color: #1f2937; /* dark:bg-gray-800 */
    color: #f3f4f6; /* dark:text-gray-100 */
    border-color: #374151; /* dark:border-gray-700 */
    box-shadow: 0 25px 50px -12px rgba(0,0,0,0.5);
}

/* Specific Modal Widths and Padding (Examples) */
#loginModal .modal-content { width: 400px; }
#loginModal .modal-body { padding: 1.5rem 2rem; } /* Custom padding for login */
#dataStoresModal .modal-content,
#fileManagementModal .modal-content { width: 700px; }
#settingsModal .modal-content { width: 750px; overflow: hidden; }


.modal-header {
    padding: 1rem 1.5rem;
    display: flex; justify-content: space-between; align-items: center;
    border-bottom: 1px solid #e5e7eb; /* border-b border-gray-200 */
}
.dark .modal-header { border-bottom-color: #374151; }

.modal-title {
    font-size: 1.125rem; font-weight: 600; margin: 0;
    color: #111827;
}
.dark .modal-title { color: #f9fafb; }

.modal-body {
    flex-grow: 1; overflow: auto; padding: 1.5rem;
}
#settingsModal .modal-body { display: flex; flex-direction: row; padding: 0; } /* Special case for settings */

.modal-footer {
    padding: 1rem 1.5rem;
    display: flex; justify-content: flex-end; gap: 0.75rem;
    border-top: 1px solid #e5e7eb;
}
.dark .modal-footer { border-top-color: #374151; }

.modal-close-btn {
    position: absolute; top: 0.75rem; right: 0.75rem;
    background: none; border: none; cursor: pointer;
    padding: 0.5rem; border-radius: 50%;
    transition: background-color 0.2s ease, color 0.2s ease;
    z-index: 10;
    width: 32px; height: 32px;
    display: flex; align-items: center; justify-content: center;
    color: #6b7280; /* text-gray-500 */
}
.modal-close-btn:hover {
    background-color: #f3f4f6; /* hover:bg-gray-100 */
    color: #111827; /* hover:text-gray-900 */
}
.dark .modal-close-btn { color: #9ca3af; }
.dark .modal-close-btn:hover {
    background-color: #374151;
    color: #f3f4f6;
}
.modal-close-btn svg { width: 1rem; height: 1rem; }


/* Form Elements within Modals */
.modal input[type="text"],
.modal input[type="password"],
.modal input[type="number"],
.modal input[type="email"],
.modal input[type="date"],
.modal textarea,
.modal select {
    border-radius: 0.375rem; padding: 0.5rem 0.75rem;
    width: 100%; transition: border-color 0.2s, box-shadow 0.2s;
    border: 1px solid #d1d5db; /* border border-gray-300 */
    background-color: #f9fafb; /* bg-gray-50 */
    color: #111827; /* text-gray-900 */
    font-size: 0.875rem; /* Standardize font size */
}
.dark .modal input[type="text"],
.dark .modal input[type="password"],
.dark .modal input[type="number"],
.dark .modal input[type="email"],
.dark .modal input[type="date"],
.dark .modal textarea,
.dark .modal select {
    border-color: #4b5563; /* dark:border-gray-600 */
    background-color: #374151; /* dark:bg-gray-700 */
    color: #f3f4f6; /* dark:text-gray-100 */
}
.dark .modal input::placeholder,
.dark .modal textarea::placeholder {
    color: #9ca3af; /* dark:placeholder-gray-400 */
}

.modal input:focus,
.modal textarea:focus,
.modal select:focus {
    outline: none;
    border-color: #3b82f6; /* border-blue-500 */
    box-shadow: 0 0 0 2px rgba(59,130,246,0.2); /* ring-2 ring-blue-500/20 */
}
.dark .modal input:focus,
.dark .modal textarea:focus,
.dark .modal select:focus {
    border-color: #3b82f6; /* dark:border-blue-500 */
    box-shadow: 0 0 0 2px rgba(59,130,246,0.3); /* dark:ring-blue-500/30 */
}

/* Modal Buttons (general, specific styling via classes like .btn-primary in HTML) */
.modal button:not(.modal-close-btn) {
    padding: 0.5rem 1rem; border-radius: 0.375rem;
    font-weight: 500; transition: background-color 0.2s ease, color 0.2s ease, border-color 0.2s ease;
    border: 1px solid transparent; /* Base border */
    cursor: pointer; font-size: 0.875rem;
}
/* Example: Apply .btn-primary or .btn-secondary classes from a utility stylesheet or define here if needed */
/* .modal .btn-primary { background-color: #2563eb; color: white; } */
/* .modal .btn-secondary { background-color: #e5e7eb; color: #1f2937; border-color: #d1d5db; } */

/* RAG Source Modal (specific styling if needed beyond general modal) */
.source-modal-overlay {
    position: fixed;           /* Stay in place */
    top: 0;
    left: 0;
    width: 100vw;              /* Full width */
    height: 100vh;             /* Full height */
    background-color: rgba(0, 0, 0, 0.5); /* Optional: semi-transparent background */
    z-index: 9999;             /* Ensure it's above other elements */
    display: flex;             /* Flex to center content */
    justify-content: center;
    align-items: center;
    backdrop-filter: blur(4px);
    transition: opacity 0.3s ease;
}

.source-modal-content { /* This is .modal-content for RAG source */
    max-width: 42rem; /* Wider for content */
}
.source-modal-title { /* This is .modal-title */
    word-break: break-all; /* For long document names */
}
.source-modal-similarity {
    font-size: 0.875rem; /* 14px */
    color: #4b5563; /* gray-600 */
    margin-bottom: 1rem; /* 16px */
}
.dark .source-modal-similarity { color: #d1d5db; /* dark:text-gray-300 */ }
.source-modal-similarity strong { font-weight: 600; } /* Slightly less than 700 for subtlety */

.source-modal-body { /* This is .modal-body for RAG source */
    font-size: 0.875rem; /* 14px */
    line-height: 1.6;
    /* border-top: 1px solid #e5e7eb; */ /* Already handled by .modal-body being after .modal-header */
    /* padding-top: 1rem; */
}
/* Markdown content within RAG source modal body */
.source-modal-body .markdown-content pre { /* Assuming prose styles are not applied here */
    background-color: #f3f4f6; /* gray-100 */
    padding: 1em;
    border-radius: 0.375rem;
    overflow-x: auto;
    font-size: 0.875em; /* Relative to .source-modal-body font-size */
    margin: 0.5em 0;
}
.dark .source-modal-body .markdown-content pre {
    background-color: #1f2937; /* dark:bg-gray-800 */
    color: #d1d5db;
}
.source-modal-body .markdown-content code {
    font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, Courier, monospace;
}
.source-modal-body .markdown-content pre code { /* Code inside pre should not have its own bg */
    background-color: transparent;
    padding: 0;
    font-size: 1em; /* Reset from inline code style */
}
.source-modal-body .markdown-content :not(pre) > code { /* Inline code */
    background-color: rgba(0,0,0,0.05);
    padding: .2em .4em;
    margin: 0 0.1em;
    font-size: 85%;
    border-radius: 3px;
}
.dark .source-modal-body .markdown-content :not(pre) > code {
    background-color: rgba(255,255,255,0.1);
}


/* ==========================================================================
   7. Specialized Components & UI Elements
   ========================================================================== */

/* Katex Math Display */
.katex-display {
    margin: 0.75em 0 !important;
    padding: 0.5em 0;
    overflow-x: auto;
    overflow-y: hidden;
    max-width: 100%;
    color: #1f2937; /* text-gray-800 */
}
.dark .katex-display {
    color: #f3f4f6; /* dark:text-gray-100 */
}

/* Settings Page Tabs */
.settings-tab-btn {
    border: 1px solid transparent; /* Base border */
    transition: background-color 0.2s, color 0.2s, border-color 0.2s;
    background-color: #f3f4f6; /* bg-gray-100 */
    color: #374151; /* text-gray-700 */
    padding: 0.75rem 1rem; /* Example padding */
    text-align: left;
    width: 100%;
    border-radius: 0.375rem;
    margin-bottom: 0.25rem;
}
.settings-tab-btn:hover {
    background-color: #e5e7eb; /* hover:bg-gray-200 */
    color: #111827; /* hover:text-gray-900 */
}
.dark .settings-tab-btn {
    background-color: #374151; /* dark:bg-gray-700 */
    color: #d1d5db; /* dark:text-gray-300 */
}
.dark .settings-tab-btn:hover {
    background-color: #4b5563; /* dark:hover:bg-gray-600 */
    color: #f9fafb; /* dark:hover:text-gray-50 */
}
.settings-tab-btn.active-tab { /* Assuming settings tabs are vertical */
    font-weight: 600; /* More emphasis than 500 */
    border-left-width: 3px; /* Or border-right if tabs on right */
    background-color: #dbeafe; /* bg-blue-100 */
    color: #1d4ed8; /* text-blue-700 */
    border-left-color: #3b82f6; /* border-blue-500 */
}
.dark .settings-tab-btn.active-tab {
    background-color: rgba(30,64,175,0.3); /* dark:bg-blue-800/30 for subtlety */
    color: #93c5fd; /* dark:text-blue-300 */
    border-left-color: #3b82f6; /* dark:border-blue-500 */
}
.settings-tab-content { padding: 1rem; /* Content area for the selected tab */ }


/* Discussion List Item Actions (Hover) */
.discussion-item { position: relative; } /* Ensure parent is positioned */
.discussion-item-actions-container {
    position: absolute; right: 0.5rem; top: 50%; transform: translateY(-50%);
    display: flex; align-items: center; gap: 0.25rem;
    padding: 0.25rem; border-radius: 0.375rem;
    opacity: 0; visibility: hidden; /* Start hidden */
    transition: opacity 0.2s ease-in-out, visibility 0.2s ease-in-out;
    z-index: 10;
    background-color: rgba(243,244,246,0.9); /* bg-gray-100/90 */
    box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1); /* shadow-md */
}
.dark .discussion-item-actions-container {
    background-color: rgba(55,65,81,0.9); /* dark:bg-gray-700/90 */
}
.discussion-item:hover .discussion-item-actions-container {
    opacity: 1;
    visibility: visible;
}
/* .discussion-action-btn uses .action-btn styles defined earlier */

/* Star Icon */
.star-icon {
    cursor: pointer; transition: color 0.2s;
    color: #9ca3af; /* text-gray-400 */
    width: 1rem; height: 1rem; /* Consistent size */
}
.dark .star-icon { color: #6b7280; /* dark:text-gray-500 */ }
.star-icon.starred { color: #facc15; /* text-yellow-400 */ }
/* Dark .starred is the same yellow */
.star-icon:hover:not(.starred) { color: #4b5563; /* text-gray-600 */ }
.dark .star-icon:hover:not(.starred) { color: #d1d5db; /* dark:text-gray-300 */ }


/* "Think" Block (Collapsible debug/process info) */
.think-block {
    border: 1px dashed #fde047; /* border-yellow-300 */
    border-radius: 0.375rem; /* Slightly larger radius */
    margin: 0.75rem 0; /* Consistent margin */
    background-color: #fefce8; /* bg-yellow-50 */
}
.dark .think-block {
    background-color: rgba(55, 65, 81, 0.5); /* dark:bg-gray-700 with some transparency or a specific darker yellow shade */
    border-color: #ca8a04; /* dark:border-yellow-500 */
}
.think-block summary {
    cursor: pointer; padding: 0.375rem 0.75rem; /* More padding */
    font-size: 0.875rem; /* Slightly larger */
    font-style: italic; user-select: none;
    color: #a16207; /* text-yellow-700 */
    font-weight: 500;
    transition: background-color 0.2s;
}
.think-block summary:hover {
    background-color: #fef9c3; /* hover:bg-yellow-100 */
}
.dark .think-block summary {
    color: #fef08a; /* dark:text-yellow-200 */
}
.dark .think-block summary:hover {
    background-color: rgba(75, 85, 99, 0.5); /* dark:hover:bg-gray-600 with transparency */
}
.think-block .think-content {
    padding: 0.75rem;
    font-size: 0.875rem; /* Was 0.9em */
    max-height: 250px; /* Slightly more max-height */
    overflow-y: auto;
    border-top: 1px dashed #fde047;
    word-wrap: break-word; overflow-wrap: break-word; word-break: break-word;
    color: #854d0e; /* text-yellow-800 */
    background-color: rgba(254, 252, 232, 0.5); /* Slightly transparent bg-yellow-50 */
    line-height: 1.5;
}
.dark .think-block .think-content {
    color: #e2e8f0; /* dark:text-slate-200 */
    background-color: rgba(31, 41, 55, 0.7); /* dark:bg-gray-800 with transparency */
    border-top-color: #ca8a04;
}


/* Image Upload Preview (in input area) */
#imageUploadPreviewContainer {
    display: flex; flex-wrap: wrap; gap: 0.5rem; margin-bottom: 0.5rem;
    max-height: 150px; overflow-y: auto; padding: 0.5rem;
    border: 1px dashed #d1d5db; /* border-gray-300 */
    border-radius: 0.375rem; /* Standard radius */
    background-color: #f9fafb; /* bg-gray-50 */
}
.dark #imageUploadPreviewContainer {
    border-color: #4b5563; /* dark:border-gray-600 */
    background-color: #1f2937; /* dark:bg-gray-800 */
}
.image-preview-item { position: relative; }
.image-preview-item img {
    width: 70px; height: 70px; object-fit: cover; border-radius: 0.25rem;
    border: 1px solid #d1d5db;
}
.dark .image-preview-item img { border-color: #374151; }

.remove-preview-btn {
    position: absolute; top: -0.375rem; right: -0.375rem; /* Adjusted for slightly larger button */
    border: none; border-radius: 50%;
    width: 1.25rem; height: 1.25rem; /* 20px */
    font-size: 0.75rem; line-height: 1.25rem; text-align: center;
    cursor: pointer; font-weight: bold;
    background-color: rgba(239,68,68,0.9); /* bg-red-500/90 */
    color: white;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    display: flex; align-items: center; justify-content: center;
    transition: background-color 0.2s;
}
.remove-preview-btn:hover { background-color: #dc2626; /* hover:bg-red-600 */ }
.dark .remove-preview-btn { background-color: rgba(220,38,38,0.9); }
.dark .remove-preview-btn:hover { background-color: #b91c1c; }


/* RAG Controls (Toggle & Select) */
.rag-controls { display: flex; align-items: center; gap: 0.75rem; /* Increased gap */ }
.rag-toggle {
    padding: 0.375rem 0.75rem; border-radius: 9999px; cursor: pointer;
    transition: background-color 0.2s, color 0.2s, border-color 0.2s;
    font-weight: 500; border: 1px solid; font-size: 0.875rem;
    line-height: 1.25; /* Ensure text is centered */
}
.rag-toggle-off {
    background-color: #e5e7eb; /* bg-gray-200 */
    color: #374151; /* text-gray-700 */
    border-color: #d1d5db; /* border-gray-300 */
}
.rag-toggle-off:hover { background-color: #d1d5db; }
.dark .rag-toggle-off {
    background-color: #374151; /* dark:bg-gray-700 */
    color: #d1d5db; /* dark:text-gray-300 */
    border-color: #4b5563; /* dark:border-gray-600 */
}
.dark .rag-toggle-off:hover { background-color: #4b5563; }

.rag-toggle-on {
    background-color: #22c55e; /* bg-green-500 */
    color: white;
    border-color: #22c55e;
}
.rag-toggle-on:hover { background-color: #16a34a; /* hover:bg-green-600 */ }
.dark .rag-toggle-on {
    background-color: #16a34a; /* dark:bg-green-600 */
    border-color: #16a34a;
}
.dark .rag-toggle-on:hover { background-color: #15803d; /* dark:hover:bg-green-700 */ }
.rag-toggle:disabled { opacity: 0.6; cursor: not-allowed; }

#ragDataStoreSelect { /* Assuming this is a <select> element */
    font-size: 0.875rem; padding: 0.375rem 0.5rem; border-radius: 0.375rem;
    border: 1px solid #d1d5db;
    background-color: white;
    color: #111827;
    min-width: 150px; /* Give it some default width */
}
.dark #ragDataStoreSelect {
    border-color: #4b5563;
    background-color: #374151;
    color: #e5e7eb;
}

/* Message Steps & Metadata Blocks */
.message-steps, .message-metadata {
    margin: 1rem 0; border-radius: 0.75rem; overflow: hidden;
    border: 1px solid #e5e7eb; /* border-gray-200 */
    background-color: #f9fafb; /* bg-gray-50 */
    box-shadow: 0 2px 4px rgba(0,0,0,0.03);
}
.dark .message-steps, .dark .message-metadata {
    border-color: #374151; /* dark:border-gray-700 */
    background-color: #1f2937; /* dark:bg-gray-800 */
}
.steps-header, .metadata-header {
    display: flex; align-items: center; gap: 0.5rem; padding: 0.75rem 1rem;
    font-size: 0.875rem; font-weight: 600;
    background-color: #f3f4f6; /* bg-gray-100 */
    border-bottom: 1px solid #e5e7eb;
    color: #374151; /* text-gray-700 */
}
.dark .steps-header, .dark .metadata-header {
    background-color: #2D3748; /* dark:bg-gray-750ish */
    border-bottom-color: #374151;
    color: #e5e7eb; /* dark:text-gray-200 */
}
.steps-header svg, .metadata-header svg { width: 1.125rem; height: 1.125rem; } /* 18px */

.steps-list, .metadata-list { padding: 0.75rem; /* More padding for list container */ }

.message-steps .step-item {
    display: flex; gap: 0.75rem; padding: 0.75rem; margin-bottom: 0.5rem;
    border-radius: 0.5rem;
    background-color: white;
    border: 1px solid #e5e7eb;
}
.dark .message-steps .step-item {
    background-color: #111827; /* dark:bg-gray-900 */
    border-color: #374151;
}
.message-steps .step-item:last-child { margin-bottom: 0; }

.step-indicator {
    flex-shrink: 0; width: 32px; height: 32px; border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    background-color: #2563eb; /* bg-blue-600 */
    /* Consider using different colors for different step states (pending, active, completed, error) */
}
.step-number { /* Text inside indicator */
    color: white; font-size: 0.75rem; font-weight: 600;
}
.step-content { flex: 1; min-width: 0; /* For proper flex behavior with long text */ }
.step-title {
    font-weight: 600; margin-bottom: 0.25rem;
    color: #111827;
}
.dark .step-title { color: #f3f4f6; }
.step-description {
    font-size: 0.875rem; margin-bottom: 0.25rem;
    color: #4b5563; /* text-gray-600 */
    line-height: 1.5;
}
.dark .step-description { color: #9ca3af; /* dark:text-gray-400 */ }
.step-duration {
    font-size: 0.75rem; color: #6b7280; /* text-gray-500 */
}
.dark .step-duration { color: #6b7280; /* Often kept same for dark mode */ }

.metadata-item {
    display: flex; justify-content: space-between; align-items: center;
    padding: 0.5rem 0.75rem;
    border-bottom: 1px solid #f3f4f6; /* Lighter border for items */
}
.dark .metadata-item { border-bottom-color: #374151; }
.metadata-item:last-child { border-bottom: none; }

.metadata-key {
    font-weight: 500; color: #374151;
    margin-right: 0.5rem; /* Ensure space between key and value */
}
.dark .metadata-key { color: #e5e7eb; }
.metadata-value {
    font-size: 0.875rem; color: #4b5563;
    text-align: right; /* Align value to the right */
    word-break: break-all; /* For long values */
}
.dark .metadata-value { color: #9ca3af; }


/* Chat Empty State Placeholder */
.chat-empty-state {
    display: flex; align-items: center; justify-content: center;
    min-height: 300px; /* Reduced min-height */
    padding: 2rem;
    flex-direction: column; /* Stack icon and text */
    text-align: center;
}
.empty-state-content { max-width: 400px; }
.empty-state-icon {
    width: 56px; height: 56px; /* Slightly smaller */
    margin: 0 auto 1rem;
    color: #d1d5db; /* text-gray-300 */
}
.dark .empty-state-icon { color: #4b5563; /* dark:text-gray-600 */ }
.empty-state-title {
    font-size: 1.25rem; font-weight: 600; margin-bottom: 0.5rem;
    color: #1f2937; /* text-gray-800 */
}
.dark .empty-state-title { color: #f3f4f6; /* dark:text-gray-100 */ }
.empty-state-description {
    line-height: 1.6; /* Improved line height */
    color: #4b5563; /* text-gray-600 */
    font-size: 0.875rem; /* Standard text size */
}
.dark .empty-state-description { color: #9ca3af; /* dark:text-gray-400 */ }


/* App Loading Message */
#appLoadingMessage {
    display: flex; flex-direction: column; align-items: center; justify-content: center;
    position: fixed; inset: 0; z-index: 10000;
    color: #374151;
    transition: opacity 0.3s ease-out;
}
html:not(.dark) #appLoadingMessage { background: linear-gradient(135deg, #f9fafb 0%, #e9ecef 100%); } /* Lighter gradient */
.dark #appLoadingMessage { background: linear-gradient(135deg, #111827 0%, #1f2937 100%); }

#appLoadingMessage img {
    width: 80px; /* Example size */
    margin-bottom: 1.5rem;
    filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.1));
}
.dark #appLoadingMessage img { filter: drop-shadow(0 4px 10px rgba(96, 165, 250, 0.3)); }

#appLoadingMessage p:first-of-type { /* Title like "Loading Your Experience" */
    font-size: 1.5rem; font-weight: 600; margin-bottom: 0.5rem;
    color: #2563eb; /* text-blue-600 */
}
.dark #appLoadingMessage p:first-of-type { color: #93c5fd; /* dark:text-blue-300 */ }

#appLoadingStatus { /* Status text like "Initializing components..." */
    font-size: 0.875rem; color: #4b5563; margin-top: 1rem;
    min-height: 1.25em; /* Prevent layout shift */
}
.dark #appLoadingStatus { color: #9ca3af; }

#appLoadingProgressContainer { /* Container for the progress bar */
    width: 250px; height: 8px;
    background-color: #e5e7eb; /* Progress track light */
    border-radius: 4px;
    overflow: hidden;
    margin-top: 0.75rem;
}
.dark #appLoadingProgressContainer { background-color: #374151; /* Progress track dark */ }

#appLoadingProgress { /* The progress bar itself */
    width: 0%; /* Controlled by JS */
    height: 100%;
    background-color: #3b82f6; /* bg-blue-500 */
    border-radius: 4px;
    transition: width 0.3s ease;
}


/* ==========================================================================
   8. Tailwind Typography (.prose) Overrides
   ========================================================================== */
.prose {
    color: #374151; /* text-gray-700 */
    max-width: 100%; /* Ensure prose content doesn't overflow its container */
    line-height: 1.7; /* Slightly more generous line height for readability */
}
.dark .prose { color: #d1d5db; /* dark:text-gray-300 */ }

.prose h1, .prose h2, .prose h3, .prose h4, .prose strong { color: #111827; }
.dark .prose h1, .dark .prose h2, .dark .prose h3, .dark .prose h4, .dark .prose strong { color: #f3f4f6; }

.prose a {
    color: #2563eb; /* text-blue-600 */
    text-decoration: underline;
    transition: color 0.15s ease;
}
.prose a:hover { color: #1d4ed8; /* hover:text-blue-700 */ }
.dark .prose a { color: #60a5fa; /* dark:text-blue-400 */ }
.dark .prose a:hover { color: #93c5fd; /* dark:hover:text-blue-300 */ }

.prose blockquote {
    border-left-color: #d1d5db; /* border-l-gray-300 */
    color: #4b5563; /* text-gray-600 */
    padding-left: 1em; /* Default prose padding */
    font-style: italic;
    margin-left: 0; /* Reset margin if needed */
}
.dark .prose blockquote {
    border-left-color: #4b5563; /* dark:border-l-gray-600 */
    color: #9ca3af; /* dark:text-gray-400 */
}

.prose code { /* For inline code */
    background-color: #e5e7eb; /* bg-gray-200 */
    color: #1f2937; /* text-gray-800 */
    padding: 0.2em 0.4em; /* Standard prose padding */
    border-radius: 0.25rem;
    font-size: 0.875em; /* Relative to parent */
    font-weight: 500; /* Slightly less than 600 for subtlety */
}
.dark .prose code {
    background-color: #374151; /* dark:bg-gray-700 */
    color: #e5e7eb; /* dark:text-gray-200 */
}

/* Reset for code blocks handled by syntax highlighters (e.g. Highlight.js) */
.prose pre code {
    background-color: white !important;
    color: black !important;
    padding: 0 !important;
    font-weight: inherit !important;
    font-size: inherit !important; /* Ensure it inherits from pre */
    border-radius: 0 !important;
}
.dark .prose pre code {
    background-color: black !important;
    color: white !important;
}
.prose pre { /* For the <pre> tag itself when using syntax highlighting */
    /* Background, padding etc. should be handled by the syntax highlighter's theme */
    /* Or by .code-block-container if that's the wrapper */
    border-radius: 0.375rem; /* If .code-block-container is not used */
    overflow-x: auto;
}



.prose ul > li::before {
    background-color: #9ca3af; /* bg-gray-400 */
    /* Default prose marker styles are usually fine */
}
.dark .prose ul > li::before { background-color: #4b5563; /* dark:bg-gray-600 */ }

.prose ol > li::before { color: #6b7280; /* text-gray-500 */ }
.dark .prose ol > li::before { color: #9ca3af; /* dark:text-gray-400 */ }

.prose hr { border-color: #e5e7eb; /* border-gray-200 */ }
.dark .prose hr { border-color: #374151; /* dark:border-gray-700 */ }

.prose table { width: auto; display: table; /* From original, keeps table from full-width */ }
.prose th {
    color: #1f2937; /* text-gray-800 */
    background-color: #f3f4f6; /* bg-gray-100 */
    border: 1px solid #d1d5db; /* border-gray-300 */
    padding: 0.5em 1em; /* Default prose padding */
    font-weight: 600;
}
.dark .prose th {
    color: #e5e7eb; /* dark:text-gray-200 */
    background-color: #374151; /* dark:bg-gray-700 */
    border-color: #4b5563; /* dark:border-gray-600 */
}
.prose td {
    border: 1px solid #d1d5db;
    padding: 0.5em 1em;
}
.dark .prose td { border-color: #4b5563; }

.prose img { border-radius: 0.375rem; margin: 1em 0; }


/* ==========================================================================
   9. Animations
   ========================================================================== */
@keyframes typingAnimation { /* Renamed for clarity from 'typing' */
    0%, 100% { transform: translateY(0); opacity: 0.5; }
    50% { transform: translateY(-6px); opacity: 1; } /* Reduced jump height */
}
@keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.7; }
}
@keyframes messageSlideIn { /* For message container */
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}
@keyframes modalSlideInAnimation { /* Renamed for clarity */
    from { opacity: 0; transform: scale(0.95) translateY(-10px); }
    to { opacity: 1; transform: scale(1) translateY(0); }
}


/* ==========================================================================
   10. Responsive Design
   ========================================================================== */
@media (max-width: 768px) {
    .message-bubble {
        max-width: 90%;
        padding: 0.625rem 0.875rem; /* Slightly smaller padding on mobile */
        font-size: 0.9rem;
    }
    .system-bubble {
        width: auto; /* Rely on max-width */
        max-width: 95%;
        font-size: 0.8rem; /* Slightly smaller for system messages on mobile */
    }

    .modal { padding: 0.5rem; } /* Reduce padding around modal on small screens */
    .modal-content {
        width: calc(100% - 1rem) !important; /* Full width minus padding */
        max-width: calc(100% - 1rem) !important;
        margin: 0.5rem;
        border-radius: 0.75rem; /* Consistent radius */
        max-height: calc(100vh - 1rem);
    }
    /* Ensure specific modals also adhere to this if they had fixed widths */
    #loginModal .modal-content,
    #dataStoresModal .modal-content,
    #fileManagementModal .modal-content,
    #settingsModal .modal-content {
        width: calc(100% - 1rem) !important;
        padding: 1rem; /* Unified padding for content inside modal */
    }
    .modal-header, .modal-body, .modal-footer {
        padding: 1rem; /* Unified padding for modal sections on mobile */
    }

    .footer-content { /* For message footer with details/actions */
        flex-direction: column;
        align-items: stretch; /* Stretch items like detail badges */
        gap: 0.5rem;
    }
    .message-footer-actions {
        justify-content: flex-end; /* Align actions to the right when wrapped */
        width: 100%;
    }

    .message-images-container {
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); /* Smaller min image size */
    }

    .code-block-container .code-block-header { padding: 0.5rem 0.75rem; }
    .code-block-container .code-block { padding: 0.75rem; font-size: 0.8rem; }
}


/* ==========================================================================
   11. Accessibility
   ========================================================================== */
@media (prefers-reduced-motion: reduce) {
    .message-container, .modal.active .modal-content,
    .message-bubble, /* Added message bubble to this rule */
    .action-btn, .rating-btn, .code-copy-btn, .modal, .modal-close-btn,
    .rag-toggle, .settings-tab-btn, .star-icon, #appLoadingMessage, #appLoadingProgress {
        animation: none !important;
        transition: none !important;
    }
    /* Ensure initial states are visible if animations are removed */
    .message-container, .modal.active .modal-content {
        opacity: 1;
        transform: none;
    }
}

@media (prefers-contrast: high) {
    body {
        border: 2px solid transparent; /* For Windows High Contrast mode to show window outline */
    }
    .message-bubble, .code-block-container, .modal-content, .detail-badge,
    input, select, textarea, button {
        border-width: 1px; /* Ensure borders are consistently visible, can be increased */
        border-style: solid;
        /* Specific high-contrast border colors might be needed if defaults aren't sufficient */
    }
    /* Example: force darker borders in light HC, lighter in dark HC if needed */
    /* :not(.dark) .message-bubble { border-color: #000 !important; } */
    /* .dark .message-bubble { border-color: #FFF !important; } */

    /* Ensure text has enough contrast (often handled by OS in HC mode) */
    /* .some-light-text-on-light-bg { color: #000 !important; } */
}

/* ==========================================================================
   Specific Component: Discussion Action Button
   ========================================================================== */

.discussion-action-btn {
    background: none;
    border: none;
    padding: 0.375rem; /* 6px padding, creates a ~28px clickable area with 16px icon */
    cursor: pointer;
    border-radius: 0.375rem; /* 6px */
    display: inline-flex; /* Use inline-flex to wrap content tightly */
    align-items: center;
    justify-content: center;
    transition: background-color 0.15s ease, color 0.15s ease;
    color: #4B5563; /* gray-600 */
    line-height: 1; /* Prevents extra space if text were used */
}

.discussion-action-btn:hover {
    background-color: #E5E7EB; /* gray-200 */
    color: #1F2937; /* gray-800 */
}

.dark .discussion-action-btn {
    color: #D1D5DB; /* dark:text-gray-300 */
}

.dark .discussion-action-btn:hover {
    background-color: #4B5563; /* dark:bg-gray-600 */
    color: #F9FAFB; /* dark:text-gray-50 */
}

.discussion-action-btn svg {
    width: 1rem; /* 16px */
    height: 1rem; /* 16px */
    display: block; /* Remove any baseline alignment issues */
}

/* Variant for destructive actions (e.g., delete) */
.discussion-action-btn.destructive:hover {
    background-color: #FEE2E2; /* red-100 */
    color: #991B1B; /* red-800 */
}
.dark .discussion-action-btn.destructive:hover {
    background-color: #7F1D1D; /* dark:bg-red-900 */
    color: #FECACA; /* dark:text-red-200 */
}

/* Variant for primary/positive actions (e.g., pin, if applicable) */
.discussion-action-btn.primary:hover {
    background-color: #DBEAFE; /* blue-100 */
    color: #1D4ED8; /* blue-700 */
}
.dark .discussion-action-btn.primary:hover {
    background-color: #1E3A8A; /* dark:bg-blue-800 */
    color: #93C5FD; /* dark:text-blue-300 */
}


/* --- Custom Image Modal Styles --- */

/* The dark overlay that covers the entire screen */
.image-modal-overlay {
    position: fixed;
    z-index: 1000;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.85); /* Dark, semi-transparent background */
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: zoom-out;
    opacity: 0;
    transition: opacity 0.3s ease;
}

/* A class to add when the modal is open for the fade-in effect */
.image-modal-overlay.open {
    opacity: 1;
}

/* The image itself inside the modal */
.image-modal-content {
    max-width: 90vw;   /* Max width is 90% of viewport width */
    max-height: 90vh;  /* Max height is 90% of viewport height */
    object-fit: contain; /* Ensures the whole image is visible without distortion */
    transition: transform 0.3s ease;
    cursor: default;
}

/* The close button (top right corner) */
.image-modal-close-btn {
    position: absolute;
    top: 20px;
    right: 30px;
    font-size: 3rem;
    color: white;
    font-weight: bold;
    cursor: pointer;
    border: none;
    background: transparent;
    transition: transform 0.2s ease;
}

.image-modal-close-btn:hover {
    transform: scale(1.1);
}

/* --- Thumbnail Enhancement in Chat Bubble --- */

/* Style for the image item in the chat */
.message-image-item {
    cursor: zoom-in;
    overflow: hidden; /* Important for the zoom effect */
    border-radius: 8px;
}

/* The actual image thumbnail */
.message-image-item img {
    display: block;
    width: 100%;
    transition: transform 0.3s ease;
}

/* A nice zoom-in effect when hovering over the thumbnail */
.message-image-item:hover img {
    transform: scale(1.05);
}