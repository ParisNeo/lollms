import{a as Z,y as ee,r as u,c as x,o as te,w as I,g as a,d as i,f as e,l as f,j as w,i as j,v as D,h as T,m as le,t as y,A as c,k,ab as se,af as A,F as E,B as P,p as oe,O as ne,L as ae,K as R,U as W}from"./index-GJY6etPD.js";import{useAdminStore as ie}from"./admin-CVB73vxO.js";const re={class:"space-y-12"},ce={class:"bg-white dark:bg-gray-800 shadow-md rounded-lg"},de={key:0,class:"p-6 text-center text-gray-500"},ue={class:"mt-2 flex items-center gap-x-4"},ge=["src"],me=["disabled"],ve={class:"flex justify-end pt-4 border-t dark:border-gray-700"},fe=["disabled"],ye={class:"bg-white dark:bg-gray-800 shadow-md rounded-lg"},be={class:"p-6 border-b dark:border-gray-700 flex justify-between items-center flex-wrap gap-2"},pe={class:"flex gap-2"},_e={class:"p-6 grid grid-cols-1 lg:grid-cols-2 gap-8"},we={class:"flex justify-between items-center mb-2"},he={class:"flex items-center gap-2"},xe={class:"border rounded-lg overflow-hidden dark:border-gray-700 max-h-96 overflow-y-auto"},ke={key:0,class:"p-4 text-center text-gray-500"},Ce={key:1,class:"divide-y dark:divide-gray-700"},Fe=["onClick"],Se={class:"flex items-center gap-3"},Le=["title"],$e={class:"flex items-center gap-1 flex-shrink-0"},Me=["onClick"],Ne=["onClick"],Ie=["onClick"],je={class:"flex justify-between items-center mb-2"},De=["title"],Te=["disabled"],Ae={class:"border rounded-lg overflow-hidden dark:border-gray-700 max-h-96 overflow-y-auto"},Ee={key:0,class:"p-4 text-center text-gray-500"},Pe={key:1,class:"p-4 text-center text-sm text-gray-500 italic"},Re={key:2,class:"divide-y dark:divide-gray-700"},We=["title"],Ue={class:"flex items-center gap-1 flex-shrink-0 opacity-0 group-hover:opacity-100 transition-opacity"},Ve=["onClick"],Oe=["onClick"],Be={key:0,class:"p-4 text-center text-sm text-gray-500 italic"},Ke={__name:"WelcomeSettings",setup(Ge){const o=ie(),g=Z(),{globalSettings:C,funFacts:U,funFactCategories:F,isLoadingFunFacts:V,isLoadingFunFactCategories:O}=ee(o),n=u({welcome_text:"",welcome_slogan:"",welcome_logo_url:""}),b=u(!1),p=u(!1),m=u(!1),v=u(null),_=u(null);let h="{}";const r=u(null),S=x(()=>C.value.filter(l=>l.category==="Welcome Page")),L=x(()=>r.value?U.value.filter(l=>l.category.id===r.value):[]),$=x(()=>{if(!r.value)return"Select a Category";const l=F.value.find(t=>t.id===r.value);return l?l.name:"Select a Category"});te(()=>{o.fetchGlobalSettings(),o.fetchFunFacts(),o.fetchFunFactCategories()}),I(()=>C.value,B,{deep:!0,immediate:!0}),I(n,l=>{m.value=JSON.stringify(l)!==h},{deep:!0});function B(){if(S.value.length>0){const l=S.value.reduce((t,s)=>(t[s.key]=s.value,t),{});n.value.welcome_text=l.welcome_text||"",n.value.welcome_slogan=l.welcome_slogan||"",n.value.welcome_logo_url=l.welcome_logo_url||"",h=JSON.stringify(n.value),m.value=!1,_.value=null,v.value=null}}function G(l){const t=l.target.files[0];if(t&&t.type.startsWith("image/")){v.value=t;const s=new FileReader;s.onload=d=>{_.value=d.target.result},s.readAsDataURL(t),m.value=!0}}async function J(){p.value=!0;try{await o.removeWelcomeLogo()}finally{p.value=!1}}async function z(){b.value=!0;try{const l={welcome_text:n.value.welcome_text,welcome_slogan:n.value.welcome_slogan},t=[o.updateGlobalSettings(l)];v.value&&t.push(o.uploadWelcomeLogo(v.value)),await Promise.all(t),h=JSON.stringify(n.value),m.value=!1,v.value=null,_.value=null}finally{b.value=!1}}function M(l=null){g.openModal("funFactCategory",{category:l,onSave:o.fetchFunFactCategories})}function N(l=null){if(!r.value&&!l){g.addNotification("Please select a category first.","warning");return}g.openModal("funFact",{fact:l,preselectedCategoryId:r.value,onSave:o.fetchFunFacts})}async function K(l){await g.showConfirmation({title:"Delete Category and its Facts?",message:`This will permanently delete "${l.name}" and all facts inside it. This action cannot be undone.`,confirmText:"Delete All"})&&(await o.deleteFunFactCategory(l.id),r.value===l.id&&(r.value=null))}async function q(l){await g.showConfirmation({title:"Delete Fun Fact?",message:"Are you sure you want to delete this fact?",confirmText:"Delete"})&&await o.deleteFunFact(l.id)}async function H(l){await o.exportCategory(l.id,l.name)}async function Q(l){const t=l.target.files[0];t&&await o.importCategoryFromFile(t),l.target.value=""}async function X(){await o.exportFunFacts()}function Y(){g.openModal("generateFunFacts")}return(l,t)=>(i(),a("div",re,[e("div",ce,[t[9]||(t[9]=e("div",{class:"p-6 border-b dark:border-gray-700"},[e("h3",{class:"text-xl font-semibold"},"Welcome Page Settings")],-1)),f(o).isLoadingSettings&&!Object.keys(n.value).length?(i(),a("div",de,"Loading settings...")):(i(),a("form",{key:1,onSubmit:w(z,["prevent"]),class:"p-6 space-y-6"},[e("div",null,[t[6]||(t[6]=e("label",{for:"welcome_text",class:"label"},"Main Welcome Text",-1)),j(e("input",{id:"welcome_text","onUpdate:modelValue":t[0]||(t[0]=s=>n.value.welcome_text=s),type:"text",class:"input-field mt-1"},null,512),[[D,n.value.welcome_text]])]),e("div",null,[t[7]||(t[7]=e("label",{for:"welcome_slogan",class:"label"},"Slogan",-1)),j(e("input",{id:"welcome_slogan","onUpdate:modelValue":t[1]||(t[1]=s=>n.value.welcome_slogan=s),type:"text",class:"input-field mt-1"},null,512),[[D,n.value.welcome_slogan]])]),e("div",null,[t[8]||(t[8]=e("label",{class:"label"},"Custom Logo",-1)),e("div",ue,[e("img",{src:_.value||n.value.welcome_logo_url||f(le),alt:"Logo Preview",class:"h-16 w-16 object-contain rounded-md bg-gray-100 dark:bg-gray-700 p-1 border dark:border-gray-600"},null,8,ge),e("input",{type:"file",onChange:G,accept:"image/*",class:"hidden",ref:"logoInput"},null,544),e("button",{type:"button",onClick:t[2]||(t[2]=s=>l.$refs.logoInput.click()),class:"btn btn-secondary"},"Change"),n.value.welcome_logo_url?(i(),a("button",{key:0,type:"button",onClick:J,class:"btn btn-danger-outline",disabled:p.value},y(p.value?"Removing...":"Remove"),9,me)):T("",!0)])]),e("div",ve,[e("button",{type:"submit",class:"btn btn-primary",disabled:b.value||!m.value},y(b.value?"Saving...":"Save Settings"),9,fe)])],32))]),e("div",ye,[e("div",be,[t[10]||(t[10]=e("h3",{class:"text-xl font-semibold"},"Fun Facts Management",-1)),e("div",pe,[e("button",{onClick:t[3]||(t[3]=s=>l.$refs.importInput.click()),class:"btn btn-secondary btn-sm"},"Import Category"),e("input",{type:"file",ref:"importInput",onChange:Q,accept:".json",class:"hidden"},null,544),e("button",{onClick:X,class:"btn btn-secondary btn-sm"},"Export All")])]),e("div",_e,[e("div",null,[e("div",we,[t[13]||(t[13]=e("h4",{class:"font-semibold"},"Categories",-1)),e("div",he,[e("button",{onClick:Y,class:"btn btn-secondary btn-sm"},[c(se,{class:"w-4 h-4 mr-1"}),t[11]||(t[11]=k(" Generate with AI"))]),e("button",{onClick:t[4]||(t[4]=s=>M()),class:"btn btn-secondary btn-sm"},[c(A,{class:"w-4 h-4 mr-1"}),t[12]||(t[12]=k("New"))])])]),e("div",xe,[f(O)?(i(),a("div",ke,"Loading...")):(i(),a("ul",Ce,[(i(!0),a(E,null,P(f(F),s=>(i(),a("li",{key:s.id,onClick:d=>r.value=s.id,class:oe(["p-3 flex items-center justify-between cursor-pointer transition-colors",r.value===s.id?"bg-blue-100 dark:bg-blue-900/50":"hover:bg-gray-50 dark:hover:bg-gray-700/50"])},[e("div",Se,[e("span",{class:"w-5 h-5 rounded-full flex-shrink-0",style:ne({backgroundColor:s.color})},null,4),e("span",{class:"font-medium text-sm truncate",title:s.name},y(s.name),9,Le)]),e("div",$e,[e("button",{onClick:w(d=>H(s),["stop"]),class:"btn-icon",title:"Export"},[c(ae,{class:"w-4 h-4"})],8,Me),e("button",{onClick:w(d=>M(s),["stop"]),class:"btn-icon",title:"Edit"},[c(R,{class:"w-4 h-4"})],8,Ne),e("button",{onClick:w(d=>K(s),["stop"]),class:"btn-icon-danger",title:"Delete"},[c(W,{class:"w-4 h-4"})],8,Ie)])],10,Fe))),128))]))])]),e("div",null,[e("div",je,[e("h4",{class:"font-semibold truncate pr-2",title:$.value},y($.value),9,De),e("button",{onClick:t[5]||(t[5]=s=>N()),disabled:!r.value,class:"btn btn-secondary btn-sm"},[c(A,{class:"w-4 h-4 mr-1"}),t[14]||(t[14]=k("New"))],8,Te)]),e("div",Ae,[f(V)?(i(),a("div",Ee,"Loading...")):r.value?(i(),a("ul",Re,[(i(!0),a(E,null,P(L.value,s=>(i(),a("li",{key:s.id,class:"p-3 flex items-center justify-between hover:bg-gray-50 dark:hover:bg-gray-700/50 group"},[e("p",{class:"text-sm flex-grow pr-2",title:s.content},y(s.content),9,We),e("div",Ue,[e("button",{onClick:d=>N(s),class:"btn-icon",title:"Edit"},[c(R,{class:"w-4 h-4"})],8,Ve),e("button",{onClick:d=>q(s),class:"btn-icon-danger",title:"Delete"},[c(W,{class:"w-4 h-4"})],8,Oe)])]))),128)),r.value&&L.value.length===0?(i(),a("li",Be,"No facts in this category yet.")):T("",!0)])):(i(),a("div",Pe,"Select a category to view its facts."))])])])])]))}};export{Ke as default};
