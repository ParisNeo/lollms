import{_ as W,Y as X,ay as Z,u as ee,az as P,r as g,b4 as te,S as w,b as _,d as se,c as n,o as l,a,p as R,h as y,f as O,g as V,a6 as B,t as f,w as ae,J as T,U as le,A as G,K as ne,F as S,j as C,n as E,V as oe,T as ie,z as re,G as de,L as ue,aD as ce,aw as ve,b5 as fe,b6 as me,b7 as ge,b8 as be,av as _e}from"./index-D2Id9a0s.js";const ye={class:"bg-white dark:bg-gray-800 shadow-md rounded-lg"},he={class:"border-t border-gray-200 dark:border-gray-700"},pe={class:"relative"},xe={class:"flex items-center space-x-3 truncate"},ke=["src"],we={key:1,class:"w-8 h-8 flex-shrink-0 text-gray-500 dark:text-gray-400 flex items-center justify-center bg-gray-200 dark:bg-gray-700 rounded-md"},Te={class:"min-w-0 text-left"},Se={class:"block font-semibold truncate"},Ce={class:"p-2 sticky top-0 bg-white dark:bg-gray-800 z-10 border-b dark:border-gray-700"},Me={class:"p-1 flex-grow overflow-y-auto"},Ie={key:0,class:"text-center p-4 text-sm text-gray-500"},Le={key:1,class:"text-center p-4 text-sm text-gray-500"},Oe={class:"px-2 py-1.5 text-xs font-bold text-gray-600 dark:text-gray-300"},Ve=["onClick"],Ee={class:"flex items-center space-x-3 truncate"},Fe=["src"],Ue={class:"truncate text-left"},De={class:"font-medium truncate text-sm"},je={key:0,class:"p-4 border rounded-lg dark:border-gray-700 space-y-4"},ze={class:"font-medium"},Ne={class:"font-mono text-blue-600 dark:text-blue-400"},$e={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},Ae=["for"],Pe={key:0,class:"text-xs text-gray-500 dark:text-gray-400 mb-1"},Re=["id","onUpdate:modelValue"],Be=["value"],Ge=["type","step","id","onUpdate:modelValue","placeholder"],Je={key:3,class:"mt-1"},qe=["onClick"],Ye={class:"flex justify-end gap-3 pt-4 border-t dark:border-gray-600"},Ke=["disabled"],He={key:1,class:"p-4 border border-yellow-300 dark:border-yellow-700 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg text-sm text-yellow-800 dark:text-yellow-200 flex items-center gap-3"},Qe={class:"flex justify-end pt-4 border-t dark:border-gray-600"},We=["disabled"],Xe={__name:"TTISettings",setup(Ze){const F=X(),x=Z();ee();const{user:m}=P(F),{availableTtiModels:U,availableTtiModelsGrouped:D}=P(x),o=g({}),h=g(!1),M=g(!1);let j="{}";const b=g(!1),I=g(null),L=g(null),k=g(""),{floatingStyles:J}=te(I,L,{placement:"bottom-start",whileElementsMounted:fe,middleware:[me(5),ge(),be({padding:5})]}),q={mounted:(s,e)=>{s.clickOutsideEvent=i=>{const r=I.value;s===i.target||s.contains(i.target)||r!=null&&r.contains(i.target)||e.value()},document.addEventListener("mousedown",s.clickOutsideEvent)},unmounted:s=>{document.removeEventListener("mousedown",s.clickOutsideEvent)}};w(b,s=>{s&&_e(()=>{const e=L.value;if(e){const i=e.querySelector(".menu-item-button.selected");i&&i.scrollIntoView({block:"nearest"})}})});const v=_({get:()=>o.value.tti_binding_model_name,set:s=>{o.value.tti_binding_model_name=s}}),u=_(()=>!v.value||U.value.length===0?null:U.value.find(s=>s.id===v.value)||null),p=_(()=>{var r;if(!((r=u.value)!=null&&r.binding_params))return[];const s=[...u.value.binding_params.class_parameters||[],...u.value.binding_params.generation_parameters||[],...u.value.binding_params.edit_parameters||[]],e=["model"],i=s.reduce((c,t)=>(!c.has(t.name)&&!e.includes(t.name)&&c.set(t.name,t),c),new Map);return Array.from(i.values())}),Y=_(()=>!m.value||!v.value||!m.value.tti_models_config?{}:m.value.tti_models_config[v.value]||{}),z=_(()=>{var s;return(s=u.value)!=null&&s.alias?u.value.alias.allow_parameters_override!==!1:!0}),N=_(()=>{if(!k.value)return D.value;const s=k.value.toLowerCase(),e=[];for(const i of D.value)if(i.items){const r=i.items.filter(c=>c.name.toLowerCase().includes(s));r.length>0&&e.push({...i,items:r})}return e});function K(s){v.value=s,b.value=!1}const $=()=>{if(m.value){const s={};u.value&&p.value.forEach(e=>{s[e.name]=Y.value[e.name]??e.default}),o.value={...s,tti_binding_model_name:m.value.tti_binding_model_name},j=JSON.stringify(o.value),M.value=!1}};w(u,$,{immediate:!0,deep:!0}),w(m,$,{deep:!0}),w(o,s=>{M.value=JSON.stringify(s)!==JSON.stringify(j)},{deep:!0});async function H(){h.value=!0;try{const s={tti_binding_model_name:o.value.tti_binding_model_name},e=m.value.tti_models_config||{},i={};p.value.forEach(c=>{o.value[c.name]!==c.default&&o.value[c.name]!==null&&o.value[c.name]!==""&&(i[c.name]=o.value[c.name])});const r={...e,[v.value]:i};Object.keys(r[v.value]||{}).length===0&&delete r[v.value],s.tti_models_config=r,await F.updateUserPreferences(s)}finally{h.value=!1}}function Q(){const s={};u.value&&(p.value.forEach(e=>{s[e.name]=e.default}),o.value={...o.value,...s})}return se(()=>{x.availableTtiModels.length===0&&x.fetchAvailableTtiModels()}),(s,e)=>{var i,r,c;return l(),n("div",ye,[e[7]||(e[7]=a("div",{class:"px-4 py-5 sm:p-6"},[a("h2",{class:"text-xl font-bold leading-6 text-gray-900 dark:text-white"},"Image Generation (TTI) Parameters"),a("p",{class:"mt-1 max-w-2xl text-sm text-gray-500 dark:text-gray-400"}," Configure default parameters for your selected Text-to-Image model. These settings can be overridden by model aliases set by an administrator if overrides are disabled. ")],-1)),a("div",he,[a("form",{onSubmit:R(H,["prevent"]),class:"p-4 sm:p-6 space-y-6"},[a("div",null,[e[4]||(e[4]=a("label",{class:"block text-base font-medium mb-2"},"Active Image Generation Model",-1)),a("div",pe,[a("button",{ref_key:"ttiTriggerRef",ref:I,onClick:e[0]||(e[0]=t=>b.value=!b.value),type:"button",class:"toolbox-select truncate w-full flex items-center justify-between"},[a("div",xe,[(r=(i=u.value)==null?void 0:i.alias)!=null&&r.icon?(l(),n("img",{key:0,src:u.value.alias.icon,class:"h-8 w-8 rounded-md object-cover"},null,8,ke)):(l(),n("span",we,[V(B,{class:"w-5 h-5"})])),a("div",Te,[a("span",Se,f(((c=u.value)==null?void 0:c.name)||"Select an Image Model"),1)])]),e[3]||(e[3]=a("svg",{class:"w-4 h-4 text-gray-400 flex-shrink-0",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor"},[a("path",{"fill-rule":"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z","clip-rule":"evenodd"})],-1))],512),(l(),O(re,{to:"body"},[V(ie,{"enter-active-class":"transition ease-out duration-100","enter-from-class":"transform opacity-0 scale-95","enter-to-class":"transform opacity-100 scale-100","leave-active-class":"transition ease-in duration-75","leave-from-class":"transform opacity-100 scale-100","leave-to-class":"transform opacity-0 scale-95"},{default:ae(()=>[b.value?T((l(),n("div",{key:0,ref_key:"ttiFloatingRef",ref:L,style:le(G(J)),class:"z-50 w-80 origin-top-left rounded-md bg-white dark:bg-gray-800 shadow-lg ring-1 ring-black ring-opacity-5 dark:ring-gray-700 focus:outline-none py-1 flex flex-col max-h-[50vh]"},[a("div",Ce,[T(a("input",{type:"text","onUpdate:modelValue":e[1]||(e[1]=t=>k.value=t),onClick:e[2]||(e[2]=R(()=>{},["stop"])),placeholder:"Search TTI models...",class:"input-field-sm w-full"},null,512),[[ne,k.value]])]),a("div",Me,[G(x).isLoadingTtiModels?(l(),n("div",Ie,"Loading TTI models...")):N.value.length===0?(l(),n("div",Le,"No TTI models found.")):y("",!0),(l(!0),n(S,null,C(N.value,t=>(l(),n("div",{key:t.label},[a("h4",Oe,f(t.label),1),(l(!0),n(S,null,C(t.items,d=>{var A;return l(),n("button",{key:d.id,onClick:et=>K(d.id),class:E(["menu-item-button",{selected:v.value===d.id}])},[a("div",Ee,[(A=d.alias)!=null&&A.icon?(l(),n("img",{key:0,src:d.alias.icon,class:"h-6 w-6 rounded-md object-cover flex-shrink-0"},null,8,Fe)):(l(),O(B,{key:1,class:"w-6 h-6 text-gray-500 dark:text-gray-400 flex-shrink-0"})),a("div",Ue,[a("p",De,f(d.name),1)])]),v.value===d.id?(l(),O(oe,{key:0,class:"w-5 h-5 text-blue-600 dark:text-blue-400 flex-shrink-0"})):y("",!0)],10,Ve)}),128))]))),128))])],4)),[[q,()=>b.value=!1]]):y("",!0)]),_:1})]))])]),v.value&&u.value&&z.value&&p.value.length>0?(l(),n("div",je,[a("h4",ze,[e[5]||(e[5]=de("Configuration for: ")),a("span",Ne,f(u.value.name),1)]),a("div",$e,[(l(!0),n(S,null,C(p.value,t=>(l(),n("div",{key:t.name},[a("label",{for:`tti-param-${t.name}`,class:"block text-sm font-medium capitalize"},f(t.name.replace(/_/g," ")),9,Ae),t.description?(l(),n("p",Pe,f(t.description),1)):y("",!0),t.options&&t.options.length>0?T((l(),n("select",{key:1,id:`tti-param-${t.name}`,"onUpdate:modelValue":d=>o.value[t.name]=d,class:"input-field mt-1"},[(l(!0),n(S,null,C(t.options,d=>(l(),n("option",{key:d,value:d},f(d),9,Be))),128))],8,Re)),[[ue,o.value[t.name]]]):["str","int","float"].includes((t.type||"").toLowerCase())?T((l(),n("input",{key:2,type:(t.type||"").toLowerCase()==="str"?"text":"number",step:(t.type||"").toLowerCase()==="float"?"any":"1",id:`tti-param-${t.name}`,"onUpdate:modelValue":d=>o.value[t.name]=d,class:"input-field mt-1",placeholder:`Default: ${t.default}`},null,8,Ge)),[[ce,o.value[t.name]]]):(t.type||"").toLowerCase()==="bool"?(l(),n("div",Je,[a("button",{onClick:d=>o.value[t.name]=!o.value[t.name],type:"button",class:E([o.value[t.name]?"bg-blue-600":"bg-gray-200 dark:bg-gray-600","relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out"])},[a("span",{class:E([o.value[t.name]?"translate-x-5":"translate-x-0","pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition-colors duration-200 ease-in-out"])},null,2)],10,qe)])):y("",!0)]))),128))]),a("div",Ye,[a("button",{type:"button",onClick:Q,class:"btn btn-secondary",disabled:h.value},"Reset to Defaults",8,Ke)])])):v.value&&u.value&&!z.value?(l(),n("div",He,[V(ve,{class:"w-5 h-5 flex-shrink-0"}),e[6]||(e[6]=a("span",null,"An administrator has locked the parameters for this model alias. Your personal settings will be ignored.",-1))])):y("",!0),a("div",Qe,[a("button",{type:"submit",class:"btn btn-primary",disabled:h.value||!M.value},f(h.value?"Saving...":"Save TTI Settings"),9,We)])],32)])])}}},st=W(Xe,[["__scopeId","data-v-3c5649a1"]]);export{st as default};
