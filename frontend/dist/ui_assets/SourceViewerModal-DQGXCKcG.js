import{a as V,c as o,r as h,w as M,b as R,d as i,e as w,f as a,l as j,g as c,h as d,O as T,p as _,t as g,A as f,i as B,v as E,Q as C,n as L}from"./index-GJY6etPD.js";import{_ as N}from"./GenericModal-Cz02a-9C.js";import{_ as D}from"./JsonRenderer-BAPVTihr.js";/* empty css                                                                 */const z={class:"space-y-4 p-4"},A={key:0,class:"flex items-center gap-3"},H={class:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-4 relative overflow-hidden"},O={key:0},U={key:1,class:"p-3 bg-gray-50 dark:bg-gray-800/50 rounded-lg border dark:border-gray-700",open:""},q={class:"mt-2"},Q={class:"relative"},W={key:0,class:"absolute inset-y-0 right-0 flex items-center pr-3 text-sm"},F=["disabled"],G=["disabled"],J=["innerHTML"],ee={__name:"SourceViewerModal",setup(K){const p=V(),n=o(()=>p.modalData("sourceViewer")),$=o(()=>{var t;return((t=n.value)==null?void 0:t.title)||"Source"}),v=o(()=>{var t;return((t=n.value)==null?void 0:t.content)||""}),r=o(()=>{var t;return(t=n.value)!=null&&t.score?Math.round(n.value.score):null}),b=o(()=>{var t;return(t=n.value)!=null&&t.metadata&&Object.keys(n.value.metadata).length>0?n.value.metadata:null}),u=h(""),s=h({count:0,positions:[],currentIndex:-1}),m=h(null),S=o(()=>r.value===null?"bg-gray-400":r.value<50?"bg-red-500":r.value<80?"bg-yellow-500":"bg-green-500"),I=o(()=>{if(!v.value)return"";if(!u.value)return v.value;const t=new RegExp(`(${u.value.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")})`,"gi");return v.value.replace(t,'<mark class="bg-yellow-300 dark:bg-yellow-600 rounded">$1</mark>')});M(u,t=>{if(!t){s.value={count:0,positions:[],currentIndex:-1};return}const e=new RegExp(t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"gi"),l=[];let k;for(;(k=e.exec(v.value))!==null;)l.push(k.index);s.value={count:l.length,positions:l,currentIndex:l.length>0?0:-1},l.length>0&&L(()=>y(0))});function y(t){if(!m.value)return;const e=m.value.querySelectorAll("mark");e[t]&&(e.forEach(l=>l.classList.remove("current-search-highlight")),e[t].classList.add("current-search-highlight"),e[t].scrollIntoView({behavior:"smooth",block:"center"}))}function x(t){if(s.value.count===0)return;let e=s.value.currentIndex+t;e<0&&(e=s.value.count-1),e>=s.value.count&&(e=0),s.value.currentIndex=e,y(e)}return(t,e)=>(i(),R(N,{modalName:"sourceViewer",title:$.value,maxWidthClass:"max-w-4xl"},{body:w(()=>[a("div",z,[r.value!==null?(i(),c("div",A,[e[4]||(e[4]=a("span",{class:"text-sm font-medium flex-shrink-0"},"Similarity:",-1)),a("div",H,[a("div",{class:_(["h-4 rounded-full text-white text-xs flex items-center justify-center transition-all duration-300",S.value]),style:T({width:r.value+"%"})},[r.value>10?(i(),c("span",O,g(r.value)+"%",1)):d("",!0)],6),r.value<=10?(i(),c("span",{key:0,class:_(["absolute inset-0 flex items-center justify-center text-xs font-semibold",r.value>50?"text-white":"text-gray-800 dark:text-gray-200"])},g(r.value)+"%",3)):d("",!0)])])):d("",!0),b.value?(i(),c("details",U,[e[5]||(e[5]=a("summary",{class:"font-semibold cursor-pointer"},"Metadata",-1)),a("div",q,[f(D,{json:b.value},null,8,["json"])])])):d("",!0),a("div",null,[e[6]||(e[6]=a("h4",{class:"font-semibold mb-2"},"Content",-1)),a("div",Q,[B(a("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=l=>u.value=l),placeholder:"Search in content...",class:"input-field w-full pr-32"},null,512),[[E,u.value]]),u.value?(i(),c("div",W,[a("span",null,g(s.value.count>0?s.value.currentIndex+1:0)+" / "+g(s.value.count),1),a("button",{onClick:e[1]||(e[1]=l=>x(-1)),class:"ml-2 p-1 rounded hover:bg-gray-200 dark:hover:bg-gray-600",disabled:s.value.count===0},[f(C,{class:"w-4 h-4 transform rotate-180"})],8,F),a("button",{onClick:e[2]||(e[2]=l=>x(1)),class:"p-1 rounded hover:bg-gray-200 dark:hover:bg-gray-600",disabled:s.value.count===0},[f(C,{class:"w-4 h-4"})],8,G)])):d("",!0)]),a("div",{ref_key:"contentRef",ref:m,class:"mt-2 p-3 bg-gray-100 dark:bg-gray-900 rounded-md max-h-96 overflow-y-auto whitespace-pre-wrap break-words"},[a("span",{innerHTML:I.value},null,8,J)],512)])])]),footer:w(()=>[a("button",{onClick:e[3]||(e[3]=l=>j(p).closeModal("sourceViewer")),type:"button",class:"btn btn-secondary"},"Close")]),_:1},8,["title"]))}};export{ee as default};
