import{L as xe,e as a,o as s,b as e,d5 as Ne,u as Le,aa as Re,an as $e,N as p,c as E,m as ne,a as U,f as r,t as f,g as m,h as Q,aB as Ce,a4 as Se,w as ae,F as L,r as P,ao as Ue,dF as it,n as B,aI as We,au as Te,d as J,a5 as qe,V as Ae,aC as ze,Y as _e,K as oe,ax as we,M as Ke,aq as dt,J as ut,z as re,dy as Fe,W as G,ak as Y,as as je,ar as Ye,aD as ge,a7 as fe,l as Xe,$ as Oe,O as Ve,X as Pt,cp as Et,i as ct,aj as bt,d6 as Be,di as Gt,av as he,aw as Bt,at as pt,D as vt,Q as st,c$ as Wt,G as lt,am as Je,aJ as Ft,ap as at,R as ot,p as nt,cz as Jt,k as Ht}from"./index-BPMLm_gj.js";import{I as qt}from"./IconArrowRight-C0usVAFM.js";import{I as Kt}from"./IconClock-DWzTnUf0.js";import{I as He}from"./IconVideoCamera-Btjr8Ous.js";const Yt={},Xt={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor"};function Zt(O,u){return s(),a("svg",Xt,u[0]||(u[0]=[e("path",{d:"M4 12L20 12M12 4L12 20M6.2 20H17.8C18.9201 20 19.4802 20 19.908 19.782C20.2843 19.5903 20.5903 19.2843 20.782 18.908C21 18.4802 21 17.9201 21 16.8V7.2C21 6.0799 21 5.51984 20.782 5.09202C20.5903 4.71569 20.2843 4.40973 19.908 4.21799C19.4802 4 18.9201 4 17.8 4H6.2C5.0799 4 4.51984 4 4.09202 4.21799C3.71569 4.40973 3.40973 4.71569 3.21799 5.09202C3 5.51984 3 6.07989 3 7.2V16.8C3 17.9201 3 18.4802 3.21799 18.908C3.40973 19.2843 3.71569 19.5903 4.09202 19.782C4.51984 20 5.07989 20 6.2 20Z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)]))}const Qt=xe(Yt,[["render",Zt]]),es={class:"h-full flex flex-col overflow-hidden bg-gray-50 dark:bg-gray-950 relative"},ts={class:"flex flex-col items-center"},ss={class:"text-sm font-bold text-gray-800 dark:text-gray-100 truncate max-w-[200px]"},ls={class:"flex items-center gap-1.5"},as={key:0,class:"flex items-center gap-1 text-[8px] font-black uppercase text-blue-500 animate-pulse"},os={class:"flex items-center gap-1"},ns={class:"w-48 py-1"},rs=["onClick"],is={class:"flex bg-gray-100 dark:bg-gray-800 p-0.5 rounded-lg border dark:border-gray-700 mx-1"},ds={class:"flex-grow flex overflow-hidden"},us={class:"w-72 border-r dark:border-gray-800 bg-gray-100 dark:bg-gray-900 flex flex-col flex-shrink-0"},cs={class:"p-4 border-b dark:border-gray-800 font-black text-[10px] uppercase tracking-widest text-gray-500 flex justify-between items-center"},bs={class:"flex-grow overflow-y-auto p-2 space-y-1 custom-scrollbar"},ps=["onClick"],vs={class:"flex items-center gap-2 flex-grow min-w-0"},fs={class:"truncate text-xs font-bold"},gs={class:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity"},xs=["onClick"],ms=["onClick"],ks=["onClick"],ys={class:"flex-grow flex flex-col min-w-0"},hs={class:"bg-white dark:bg-gray-900 border-b dark:border-gray-800 flex overflow-x-auto no-scrollbar pt-2 px-2 shadow-sm"},ws=["onClick"],_s={class:"truncate"},$s={class:"flex-grow overflow-hidden relative"},Cs={key:0,class:"absolute inset-0 overflow-y-auto p-12 custom-scrollbar bg-white dark:bg-gray-900"},Ss={class:"max-w-4xl mx-auto shadow-sm border dark:border-gray-800 p-10 rounded-xl min-h-full"},As={class:"p-4 bg-white dark:bg-gray-900 border-t dark:border-gray-800 z-50 shadow-inner flex flex-col gap-3"},Is={class:"max-w-6xl mx-auto w-full flex items-center gap-2 overflow-x-auto no-scrollbar pb-1"},Ts=["onClick","disabled"],Vs={class:"text-[10px] font-black uppercase tracking-wide"},js={class:"max-w-6xl mx-auto w-full flex gap-2 relative"},Ns={class:"absolute right-14 top-1/2 -translate-y-1/2 flex items-center gap-2 border-l dark:border-gray-700 pl-3 pr-2 bg-white dark:bg-gray-900"},Ls=["disabled"],Rs={key:0,class:"fixed inset-0 z-[100] bg-gray-900/60 backdrop-blur-sm flex items-center justify-center p-6"},Us={class:"bg-white dark:bg-gray-900 rounded-2xl w-full max-w-5xl h-[85vh] flex flex-col overflow-hidden border dark:border-gray-800 shadow-2xl"},zs={class:"p-4 border-b dark:border-gray-800 flex justify-between items-center bg-gray-50 dark:bg-gray-800/50"},Os={class:"flex items-center gap-2"},Ds={class:"flex-grow p-6 flex flex-col gap-4 overflow-hidden"},Ms={class:"space-y-1"},Ps={class:"flex-grow flex flex-col space-y-1 min-h-0"},Es={class:"p-4 border-t dark:border-gray-800 flex justify-end gap-3 bg-gray-50 dark:bg-gray-900/50"},Gs={__name:"GenericNotebookView",props:{notebook:{type:Object,required:!0}},setup(O){const u=O,b=Ne(),V=Le(),W=Re(),{tasks:R}=$e(W),$=p(null),N=p(!0),A=p(""),k=p(!1),S=p([]),C=p(null),K=[{label:"PDF Document",value:"pdf"},{label:"Word (DOCX)",value:"docx"},{label:"Markdown",value:"md"},{label:"PowerPoint",value:"pptx"},{label:"Text File",value:"txt"}],H=[{id:"summarize",label:"Summarize",icon:re,color:"text-purple-500",bg:"bg-purple-50 dark:bg-purple-900/20"},{id:"extract_key_points",label:"Key Points",icon:_e,color:"text-blue-500",bg:"bg-blue-50 dark:bg-blue-900/20"},{id:"generate_html",label:"Visual Widget",icon:Qt,color:"text-green-500",bg:"bg-green-50 dark:bg-green-900/20"},{id:"generate_code",label:"Logic/Code",icon:Fe,color:"text-orange-500",bg:"bg-orange-50 dark:bg-orange-900/20"},{id:"generate_timeline",label:"Timeline",icon:Kt,color:"text-cyan-500",bg:"bg-cyan-50 dark:bg-cyan-900/20"}],D=E(()=>R.value.find(y=>(y.description===u.notebook.id||y.name.includes(u.notebook.title))&&(y.status==="running"||y.status==="pending"))),I=E(()=>{var y;return(y=u.notebook.tabs)!=null&&y.length?u.notebook.tabs.find(v=>v.id===$.value)||u.notebook.tabs[0]:null});ne(()=>u.notebook.id,()=>{var y;if(((y=u.notebook.tabs)==null?void 0:y.length)>0&&(!$.value||!u.notebook.tabs.find(v=>v.id===$.value))){const v=u.notebook.tabs.find(j=>j.type==="markdown");$.value=v?v.id:u.notebook.tabs[0].id}},{immediate:!0});async function ie(y,v=null){const j=k.value?$.value:null,g=v||A.value||`Perform ${y.replace("_"," ")}`;await b.processWithAi(g,[],y,j,!1,S.value),v||(A.value="")}function se(){ie("text_processing")}async function _(y){D.value||await ie(y)}async function c(y){await b.exportNotebook(y)}function x(y){const v=S.value.indexOf(y);v===-1?S.value.push(y):S.value.splice(v,1)}function h(y){V.openModal("artefactViewer",{artefact:{title:y.filename,content:y.content}})}function F(y){C.value={originalName:y.filename,name:y.filename,content:y.content}}async function de(){if(C.value)try{await b.updateArtefact(C.value.originalName,C.value.name,C.value.content),C.value=null}catch(y){console.error(y)}}return(y,v)=>{var j;return s(),a("div",es,[(s(),U(Se,{to:"#global-header-title-target"},[e("div",ts,[e("span",ss,f(O.notebook.title),1),e("div",ls,[v[11]||(v[11]=e("span",{class:"text-[8px] font-black uppercase bg-gray-200 dark:bg-gray-800 px-1.5 py-0.5 rounded text-gray-500"},"Research",-1)),D.value?(s(),a("span",as,[r(Ce,{class:"w-2 h-2 animate-spin"}),Q(" "+f(D.value.progress)+"% ",1)])):m("",!0)])])])),(s(),U(Se,{to:"#global-header-actions-target"},[e("div",os,[r(it,{title:"Export",icon:"ticket","button-class":"btn-icon-flat text-gray-500 hover:text-blue-500"},{icon:ae(()=>[r(Ue,{class:"w-4 h-4"})]),default:ae(()=>[e("div",ns,[(s(),a(L,null,P(K,g=>e("button",{key:g.value,onClick:X=>c(g.value),class:"w-full text-left px-4 py-2 text-xs font-bold hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors"},f(g.label),9,rs)),64))])]),_:1}),e("div",is,[e("button",{onClick:v[0]||(v[0]=g=>N.value=!0),class:B(["p-1.5 rounded transition-colors",N.value?"bg-white dark:bg-gray-700 shadow text-blue-600":"text-gray-400"])},[r(We,{class:"w-3.5 h-3.5"})],2),e("button",{onClick:v[1]||(v[1]=g=>N.value=!1),class:B(["p-1.5 rounded transition-colors",N.value?"text-gray-400":"bg-white dark:bg-gray-700 shadow text-blue-600"])},[r(Te,{class:"w-3.5 h-3.5"})],2)]),e("button",{onClick:v[2]||(v[2]=(...g)=>J(b).saveActive&&J(b).saveActive(...g)),class:"btn-icon-flat text-green-500",title:"Save"},[r(qe,{class:"w-4 h-4"})])])])),e("div",ds,[e("div",us,[e("div",cs,[v[12]||(v[12]=e("span",null,"Research Material",-1)),e("button",{onClick:v[3]||(v[3]=g=>J(V).openModal("artefactImportWizard",{notebookId:u.notebook.id})),class:"text-green-500 hover:text-green-600"},[r(Ae,{class:"w-4 h-4"})])]),e("div",bs,[(s(!0),a(L,null,P(O.notebook.artefacts,g=>(s(),a("div",{key:g.filename,onClick:X=>x(g.filename),class:B(["flex items-center gap-2 p-3 rounded-lg cursor-pointer group bg-white dark:bg-gray-800 border transition-all shadow-sm",S.value.includes(g.filename)?"border-green-500 ring-1 ring-green-500/20":"border-transparent"])},[e("div",vs,[S.value.includes(g.filename)?(s(),U(ze,{key:0,class:"w-4 h-4 text-green-500"})):(s(),U(_e,{key:1,class:"w-4 h-4 text-gray-400"})),e("span",fs,f(g.filename),1)]),e("div",gs,[e("button",{onClick:oe(X=>h(g),["stop"]),class:"p-1 hover:text-blue-500 transition-colors",title:"View"},[r(We,{class:"w-3.5 h-3.5"})],8,xs),e("button",{onClick:oe(X=>F(g),["stop"]),class:"p-1 hover:text-blue-500 transition-colors",title:"Edit"},[r(Te,{class:"w-3.5 h-3.5"})],8,ms),e("button",{onClick:oe(X=>J(b).deleteArtefact(g.filename),["stop"]),class:"p-1 hover:text-red-500 transition-colors",title:"Delete"},[r(we,{class:"w-3.5 h-3.5"})],8,ks)])],10,ps))),128))])]),e("div",ys,[e("div",hs,[(s(!0),a(L,null,P(O.notebook.tabs,g=>(s(),a("div",{key:g.id,onClick:X=>$.value=g.id,class:B(["group px-4 py-2 cursor-pointer text-[10px] font-black uppercase transition-all flex items-center gap-2 border-t border-x rounded-t-lg mx-0.5",$.value===g.id?"bg-gray-50 dark:bg-gray-950 border-gray-200 dark:border-gray-700 text-blue-600":"text-gray-400"])},[e("span",_s,f(g.title),1)],10,ws))),128))]),e("div",$s,[I.value?(s(),a(L,{key:0},[N.value?(s(),a("div",Cs,[e("div",Ss,[(s(),U(Ke,{content:I.value.content,key:I.value.id+((j=I.value.content)==null?void 0:j.length),class:"prose dark:prose-invert max-w-none"},null,8,["content"]))])])):(s(),U(dt,{key:1,modelValue:I.value.content,"onUpdate:modelValue":v[4]||(v[4]=g=>I.value.content=g),onBlur:J(b).saveActive,class:"h-full"},null,8,["modelValue","onBlur"]))],64)):m("",!0)])])]),e("div",As,[e("div",Is,[v[13]||(v[13]=e("span",{class:"text-[9px] font-black uppercase text-gray-400 tracking-widest mr-2 shrink-0"},"Analysis Tools:",-1)),(s(),a(L,null,P(H,g=>e("button",{key:g.id,onClick:X=>_(g.id),disabled:D.value,class:B(["flex items-center gap-2 px-3 py-1.5 rounded-full border transition-all shrink-0 hover:shadow-md active:scale-95 disabled:opacity-50",[g.bg,g.color,"border-transparent hover:border-current"]])},[(s(),U(ut(g.icon),{class:"w-3.5 h-3.5"})),e("span",Vs,f(g.label),1)],10,Ts)),64))]),e("div",js,[G(e("input",{"onUpdate:modelValue":v[5]||(v[5]=g=>A.value=g),onKeyup:je(se,["enter"]),placeholder:"Ask AI to analyze or write...",class:"input-field flex-grow pr-32 h-12 rounded-xl text-sm"},null,544),[[Y,A.value]]),e("div",Ns,[G(e("input",{type:"checkbox",id:"mod-tab","onUpdate:modelValue":v[6]||(v[6]=g=>k.value=g),class:"h-4 w-4 rounded text-blue-600"},null,512),[[Ye,k.value]]),v[14]||(v[14]=e("label",{for:"mod-tab",class:"text-[9px] font-black uppercase text-gray-400 cursor-pointer select-none"},"Update Active",-1))]),e("button",{onClick:se,class:"btn btn-primary w-12 h-12 rounded-xl shadow-lg",disabled:D.value},[r(qt,{class:"w-5 h-5"})],8,Ls)])]),r(fe,{"enter-active-class":"transition duration-300","enter-from-class":"opacity-0","enter-to-class":"opacity-100","leave-active-class":"transition duration-200","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:ae(()=>[C.value?(s(),a("div",Rs,[e("div",Us,[e("div",zs,[e("div",Os,[r(Te,{class:"w-4 h-4 text-blue-500"}),v[15]||(v[15]=e("h3",{class:"font-black text-xs uppercase tracking-widest text-gray-500"},"Edit Research Source",-1))]),e("button",{onClick:v[7]||(v[7]=g=>C.value=null),class:"p-1 hover:bg-gray-200 dark:hover:bg-gray-700 rounded transition-colors"},[r(ge,{class:"w-5 h-5"})])]),e("div",Ds,[e("div",Ms,[v[16]||(v[16]=e("label",{class:"text-[10px] font-black uppercase text-gray-400"},"Source Name",-1)),G(e("input",{"onUpdate:modelValue":v[8]||(v[8]=g=>C.value.name=g),class:"input-field w-full font-bold text-lg",placeholder:"Filename..."},null,512),[[Y,C.value.name]])]),e("div",Ps,[v[17]||(v[17]=e("label",{class:"text-[10px] font-black uppercase text-gray-400"},"Content",-1)),G(e("textarea",{"onUpdate:modelValue":v[9]||(v[9]=g=>C.value.content=g),class:"flex-grow input-field font-mono text-xs p-4 resize-none leading-relaxed",placeholder:"Type or paste content..."},null,512),[[Y,C.value.content]])])]),e("div",Es,[e("button",{onClick:v[10]||(v[10]=g=>C.value=null),class:"btn btn-secondary"},"Cancel"),e("button",{onClick:de,class:"btn btn-primary px-8"},"Save Changes")])])])):m("",!0)]),_:1})])}}},Bs=xe(Gs,[["__scopeId","data-v-dccd13a9"]]),Ws={class:"w-full flex items-center gap-2"},Fs={key:0,class:"flex-grow h-8 bg-gray-200 dark:bg-gray-700 animate-pulse rounded-lg flex items-center px-4"},Js=["src"],Hs={key:2,class:"flex-grow h-8 bg-red-50 dark:bg-red-900/20 rounded-lg flex items-center px-4 border border-red-200 dark:border-red-800"},qs={class:"text-[10px] font-bold text-red-500 uppercase tracking-widest"},Ks={__name:"AuthenticatedAudio",props:{src:{type:String,required:!0}},setup(O){const u=O,b=p(null),V=p(!0),W=p(!1),R=p(null);let $=null;async function N(){if(!u.src){V.value=!1;return}V.value=!0,W.value=!1,$&&(URL.revokeObjectURL($),$=null);try{const k=await Ve.get(u.src,{responseType:"blob",timeout:3e4});$=URL.createObjectURL(k.data),b.value=$}catch(k){console.error("Failed to fetch authenticated audio:",k),W.value=!0}finally{V.value=!1}}function A(k){console.error("Audio playback error:",k),W.value=!0}return ne(()=>u.src,N),Xe(N),Oe(()=>{$&&URL.revokeObjectURL($)}),(k,S)=>(s(),a("div",Ws,[V.value?(s(),a("div",Fs,S[0]||(S[0]=[e("span",{class:"text-[10px] font-bold text-gray-400 uppercase tracking-widest"},"Loading Audio...",-1)]))):b.value&&!W.value?(s(),a("audio",{key:1,ref_key:"audioRef",ref:R,controls:"",src:b.value,class:"w-full h-8",onError:A},null,40,Js)):(s(),a("div",Hs,[e("span",qs,f(W.value?"Audio Access Error":"No Audio Data"),1)]))]))}},Ys=xe(Ks,[["__scopeId","data-v-950450fa"]]),Xs={class:"w-full relative bg-black rounded-2xl overflow-hidden shadow-lg border border-gray-800 group/authvideo"},Zs={key:0,class:"aspect-video flex flex-col items-center justify-center bg-gray-900"},Qs=["src"],el={key:1,class:"aspect-video flex flex-col items-center justify-center bg-red-950/20 text-red-500 p-6 text-center"},ft={__name:"AuthenticatedVideo",props:{src:{type:String,required:!0}},setup(O){const u=O,b=p(null),V=p(!0),W=p(!1),R=p(null);let $=null;async function N(){if(!u.src){V.value=!1;return}V.value=!0,W.value=!1,$&&(URL.revokeObjectURL($),$=null);try{const k=await Ve.get(u.src,{responseType:"blob",timeout:12e4});$=URL.createObjectURL(k.data),b.value=$}catch(k){console.error("Failed to fetch authenticated video:",k),W.value=!0}finally{V.value=!1}}function A(k){console.error("Video playback error:",k),W.value=!0}return ne(()=>u.src,N),Xe(N),Oe(()=>{$&&URL.revokeObjectURL($)}),(k,S)=>(s(),a("div",Xs,[V.value?(s(),a("div",Zs,[r(Ce,{class:"w-12 h-12 text-blue-500 animate-spin mb-4"}),S[0]||(S[0]=e("span",{class:"text-xs font-black uppercase tracking-widest text-gray-500"},"Buffering Secure Media...",-1))])):m("",!0),G(e("video",{ref_key:"videoRef",ref:R,controls:"",src:b.value,class:"w-full h-full max-h-[600px] object-contain",onError:A},null,40,Qs),[[Pt,!V.value&&b.value&&!W.value]]),W.value?(s(),a("div",el,[r(ge,{class:"w-12 h-12 mb-4 opacity-50"}),S[1]||(S[1]=e("p",{class:"font-bold uppercase tracking-tighter"},"Access Denied or File Missing",-1)),S[2]||(S[2]=e("p",{class:"text-[10px] opacity-70 mt-2"},"The secure video stream could not be established.",-1))])):m("",!0)]))}},tl={},sl={width:"50px",height:"50px",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function ll(O,u){return s(),a("svg",sl,u[0]||(u[0]=[Et('<path d="M13 8.92226L7.92226 3.84453C6.79623 2.71849 4.97056 2.71849 3.84453 3.84453C2.71849 4.97056 2.71849 6.79623 3.84453 7.92226L16.0777 20.1555C17.2038 21.2815 19.0294 21.2815 20.1555 20.1555C21.2815 19.0294 21.2815 17.2038 20.1555 16.0777L17.0777 13" stroke="#1C274C" stroke-width="1.5" stroke-linecap="round"></path><path d="M6 10L10 6" stroke="#1C274C" stroke-width="1.5" stroke-linecap="round"></path><path d="M16.1 2.30719C16.261 1.8976 16.8385 1.8976 16.9994 2.30719L17.4298 3.40247C17.479 3.52752 17.5776 3.62651 17.7022 3.67583L18.7934 4.1078C19.2015 4.26934 19.2015 4.849 18.7934 5.01054L17.7022 5.44252C17.5776 5.49184 17.479 5.59082 17.4298 5.71587L16.9995 6.81115C16.8385 7.22074 16.261 7.22074 16.1 6.81116L15.6697 5.71587C15.6205 5.59082 15.5219 5.49184 15.3973 5.44252L14.3061 5.01054C13.898 4.849 13.898 4.26934 14.3061 4.1078L15.3973 3.67583C15.5219 3.62651 15.6205 3.52752 15.6697 3.40247L16.1 2.30719Z" stroke="#1C274C"></path><path d="M19.9672 9.12945C20.1281 8.71987 20.7057 8.71987 20.8666 9.12945L21.0235 9.5288C21.0727 9.65385 21.1713 9.75284 21.2959 9.80215L21.6937 9.95965C22.1018 10.1212 22.1018 10.7009 21.6937 10.8624L21.2959 11.0199C21.1713 11.0692 21.0727 11.1682 21.0235 11.2932L20.8666 11.6926C20.7057 12.1022 20.1281 12.1022 19.9672 11.6926L19.8103 11.2932C19.7611 11.1682 19.6625 11.0692 19.5379 11.0199L19.14 10.8624C18.732 10.7009 18.732 10.1212 19.14 9.95965L19.5379 9.80215C19.6625 9.75284 19.7611 9.65385 19.8103 9.5288L19.9672 9.12945Z" stroke="#1C274C"></path><path d="M5.1332 15.3072C5.29414 14.8976 5.87167 14.8976 6.03261 15.3072L6.18953 15.7065C6.23867 15.8316 6.33729 15.9306 6.46188 15.9799L6.85975 16.1374C7.26783 16.2989 7.26783 16.8786 6.85975 17.0401L6.46188 17.1976C6.33729 17.2469 6.23867 17.3459 6.18953 17.471L6.03261 17.8703C5.87167 18.2799 5.29414 18.2799 5.1332 17.8703L4.97628 17.471C4.92714 17.3459 4.82852 17.2469 4.70393 17.1976L4.30606 17.0401C3.89798 16.8786 3.89798 16.2989 4.30606 16.1374L4.70393 15.9799C4.82852 15.9306 4.92714 15.8316 4.97628 15.7065L5.1332 15.3072Z" stroke="#1C274C"></path>',5)]))}const al=xe(tl,[["render",ll]]),ol={},nl={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none"};function rl(O,u){return s(),a("svg",nl,u[0]||(u[0]=[e("path",{d:"M15 18l-6-6 6-6",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)]))}const il=xe(ol,[["render",rl]]),dl={},ul={width:"50px",height:"50px",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"};function cl(O,u){return s(),a("svg",ul,u[0]||(u[0]=[e("title",null,null,-1),e("g",{id:"Complete"},[e("g",{id:"bubble-square"},[e("path",{d:"M7.7,18.3H19.4a2.1,2.1,0,0,0,2.1-2.1V4.6a2.1,2.1,0,0,0-2.1-2.1H4.6A2.1,2.1,0,0,0,2.5,4.6V21.5Z",fill:"none",stroke:"#000000","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"})])],-1)]))}const rt=xe(dl,[["render",cl]]),bl={class:"h-full flex flex-col bg-slate-50 dark:bg-slate-950 overflow-hidden relative"},pl={key:0,class:"absolute inset-0 z-[70] bg-slate-900/90 backdrop-blur-md flex flex-col items-center justify-center p-12"},vl={class:"max-w-3xl w-full"},fl={class:"flex items-center justify-between mb-8"},gl={class:"flex items-center gap-6"},xl={class:"p-5 bg-blue-600 rounded-2xl shadow-xl shadow-blue-500/30"},ml={class:"text-3xl font-black text-white uppercase tracking-tighter"},kl={class:"text-blue-400 font-bold uppercase tracking-widest text-xs"},yl={class:"text-5xl font-black text-blue-500 font-mono"},hl={class:"w-full bg-slate-800 h-3 rounded-full overflow-hidden mb-10"},wl={class:"bg-black rounded-2xl border border-slate-800 overflow-hidden h-64 flex flex-col"},_l={class:"opacity-30 shrink-0"},$l={class:"flex flex-col items-center"},Cl={class:"text-sm font-bold text-slate-800 dark:text-slate-100"},Sl={class:"flex items-center gap-2 text-[10px] text-slate-500"},Al={class:"uppercase tracking-wide font-medium"},Il={class:"flex items-center gap-1"},Tl=["value"],Vl=["value"],jl=["disabled"],Nl={class:"h-28 flex-shrink-0 bg-white dark:bg-slate-900 border-b dark:border-slate-800 flex items-center px-4 gap-3 overflow-x-auto no-scrollbar shadow-sm z-20"},Ll=["onClick"],Rl={key:1,class:"w-full h-full bg-slate-100 dark:bg-slate-800 flex items-center justify-center text-slate-300 font-mono text-xs"},Ul={class:"absolute bottom-0 left-0 right-0 bg-black/60 text-white text-[9px] px-1 truncate py-0.5 font-bold"},zl={class:"flex-grow flex overflow-hidden"},Ol={class:"flex-grow flex flex-col items-center p-6 md:p-10 overflow-hidden relative"},Dl={key:0,class:"w-full max-w-5xl mb-4 bg-black rounded-xl overflow-hidden shadow-2xl relative group/video"},Ml={class:"absolute top-4 right-4 opacity-0 group-hover/video:opacity-100 transition-opacity flex gap-2"},Pl={key:1,class:"w-full max-w-5xl aspect-video bg-white shadow-2xl rounded-xl overflow-hidden flex flex-col border border-slate-200 dark:border-slate-800 relative group/canvas"},El={class:"flex-grow flex p-12 gap-10 overflow-hidden relative"},Gl=["src"],Bl={class:"absolute inset-0 z-0"},Wl={class:"absolute bottom-0 left-0 right-0 p-12 bg-gradient-to-t from-black/90 to-transparent z-10"},Fl={class:"text-4xl font-black text-white uppercase tracking-tight"},Jl={class:"w-1/2 flex flex-col z-10"},Hl={class:"text-3xl font-black text-slate-900 mb-8 border-b-4 border-blue-500 pb-2 inline-block self-start"},ql={class:"space-y-4"},Kl={class:"w-1/2 rounded-2xl overflow-hidden shadow-xl border-8 border-white dark:border-slate-800 bg-slate-50 relative"},Yl={key:1,class:"absolute bottom-4 left-1/2 -translate-x-1/2 flex gap-2 opacity-0 group-hover/canvas:opacity-100 transition-opacity"},Xl={key:2,class:"flex-grow flex flex-col"},Zl={class:"text-5xl font-black text-slate-900 mb-12 border-b-8 border-blue-500 pb-4 inline-block self-start uppercase tracking-tighter"},Ql={key:0,class:"space-y-6"},ea={class:"absolute top-4 right-4 flex gap-2 opacity-0 group-hover/canvas:opacity-100 transition-opacity z-20"},ta={class:"h-10 bg-slate-50 dark:bg-slate-900 border-t flex items-center justify-between px-8 text-[10px] font-black uppercase text-slate-400"},sa={key:2,class:"w-full max-w-5xl mt-4 flex items-end gap-4 overflow-x-auto no-scrollbar pb-2"},la={key:0,class:"flex gap-2"},aa=["onClick"],oa={class:"absolute inset-0 flex items-center justify-center gap-1 opacity-0 group-hover/thumb:opacity-100 bg-black/40 transition-opacity"},na=["onClick"],ra=["onClick"],ia={key:0,class:"w-80 border-l dark:border-slate-800 bg-white dark:bg-slate-900 flex flex-col flex-shrink-0 z-30 shadow-2xl"},da={class:"p-4 border-b flex items-center justify-between"},ua={class:"flex items-center gap-2"},ca={class:"p-4 border-t flex gap-2"},ba=["onKeyup","disabled"],pa=["disabled"],va={class:"bg-white dark:bg-slate-900 border-t dark:border-slate-800 shadow-2xl p-6 z-40"},fa={class:"max-w-7xl mx-auto grid grid-cols-1 md:grid-cols-2 gap-8"},ga={key:0,class:"space-y-4"},xa={class:"flex items-center justify-between"},ma={class:"text-[10px] font-black uppercase text-slate-400 tracking-widest flex items-center gap-2"},ka=["value"],ya=["value"],ha=["value"],wa={class:"space-y-3 max-h-40 overflow-y-auto custom-scrollbar pr-2"},_a=["value","onChange"],$a=["onClick"],Ca={class:"flex flex-col gap-4"},Sa={key:0,class:"flex-grow flex flex-col bg-slate-50 dark:bg-slate-800/40 rounded-2xl p-4 border dark:border-slate-800 relative group/notes"},Aa={class:"flex justify-between items-center mb-2"},Ia={class:"flex items-center gap-2"},Ta={class:"flex gap-2"},Va=["disabled"],ja=["disabled"],Na=["value"],La={key:0,class:"mt-2 bg-blue-50 dark:bg-blue-900/20 rounded-xl p-2 flex items-center gap-2"},Ra={class:"flex gap-3 mt-auto"},Ua=["disabled"],za={key:0,class:"fixed inset-0 z-[100] bg-slate-900/60 backdrop-blur-sm p-6 flex items-center justify-center"},Oa={class:"bg-white dark:bg-slate-900 rounded-2xl shadow-2xl w-full max-w-3xl flex flex-col border dark:border-slate-800"},Da={class:"p-4 border-b flex justify-between items-center bg-slate-50 dark:bg-slate-800/50"},Ma={class:"p-8 min-h-[450px] overflow-y-auto custom-scrollbar"},Pa={key:0,class:"space-y-6"},Ea={class:"grid grid-cols-2 gap-2 max-h-40 overflow-y-auto p-2 border rounded-xl"},Ga=["onClick"],Ba={class:"truncate"},Wa={key:1,class:"space-y-6"},Fa={class:"grid grid-cols-3 gap-4"},Ja=["onClick"],Ha={class:"text-xs font-black"},qa={class:"text-[9px] opacity-60"},Ka={key:2,class:"space-y-4"},Ya={class:"p-4 border-t dark:border-slate-800 flex justify-between bg-slate-50 dark:bg-slate-900/50"},Xa={key:1},Za={class:"flex gap-2"},Qa=["disabled"],eo=["disabled"],to={key:0,class:"fixed inset-0 z-[110] bg-slate-900/60 backdrop-blur-sm p-6 flex items-center justify-center"},so={class:"bg-white dark:bg-slate-900 rounded-2xl shadow-2xl w-full max-w-lg overflow-hidden border dark:border-slate-800 flex flex-col"},lo={class:"p-4 border-b bg-slate-50 dark:bg-slate-800/50 flex justify-between items-center"},ao={class:"font-black text-sm uppercase tracking-widest text-blue-600"},oo={class:"p-6 space-y-4"},no={class:"flex justify-between items-center"},ro={class:"flex items-center gap-2"},io={class:"text-[9px] font-bold uppercase text-slate-400"},uo=["disabled"],co={class:"p-4 border-t dark:border-slate-800 flex justify-end gap-2 bg-slate-50"},bo=["disabled"],po={key:0,class:"fixed inset-0 z-[100] bg-slate-900/60 flex items-center justify-center"},vo={class:"bg-white dark:bg-slate-900 rounded-2xl w-full max-w-4xl h-[80vh] flex flex-col overflow-hidden"},fo={class:"p-4 border-b flex justify-between items-center bg-slate-50"},go={class:"flex-grow p-6 flex flex-col gap-4"},xo={class:"p-4 border-t flex justify-end gap-2"},mo={__name:"SlidesMakingView",props:{notebook:{type:Object,required:!0}},setup(O){const u=O,b=Ne(),V=Le(),W=Re(),R=ct(),{tasks:$}=$e(W),N=E(()=>R.user),A=p(0),k=p(0),S=p(null),C=p(null),K=p(null),H=p(!1),D=p(""),I=p(!1),z=p(!1),ie=p(!1);p(!0);const se=p("image"),_=p(""),c=p(null),x=E(()=>{if(c.value){const t=$.value.find(T=>T.id===c.value);if(t)return t}const i=$.value.find(t=>(t.name.includes(u.notebook.title)||t.description.includes(u.notebook.id))&&(t.status==="running"||t.status==="pending"));return i&&i.id!==c.value&&(c.value=i.id),i}),h=p([]),F=p(null),de=p(!1),y=p(1),v=p(!1),j=p({topic:"",title:"",layout:"TitleImageBody",bullets:[],image_prompt:"",selected_artefacts:[],author:""}),g=p(!1),X=p("images"),ue=p(""),Ie=p("text, words, blurry, deformed, low quality, watermark"),me=p(!1),ke=p(!1);let le=null;const De=[{code:"en",name:"English"},{code:"fr",name:"French"},{code:"es",name:"Spanish"},{code:"de",name:"German"},{code:"it",name:"Italian"},{code:"pt",name:"Portuguese"},{code:"zh",name:"Chinese"},{code:"ja",name:"Japanese"},{code:"ru",name:"Russian"},{code:"ar",name:"Arabic"}],Me=E(()=>(u.notebook.tabs||[]).filter(i=>i.type==="slides")),q=E(()=>Me.value[A.value]),te=E(()=>{if(!q.value||!q.value.content)return{slides_data:[],mode:"hybrid",summary:""};try{return JSON.parse(q.value.content)}catch{return{slides_data:[],mode:"hybrid",summary:""}}}),o=E(()=>te.value.slides_data[k.value]||null),l=E(()=>{if(!o.value||!o.value.images||o.value.images.length===0)return null;const i=o.value.selected_image_index||0;return o.value.images[i]||o.value.images[0]}),ee=E(()=>{var t;if(!((t=o.value)!=null&&t.html_content))return null;const i=new Blob([o.value.html_content],{type:"text/html"});return URL.createObjectURL(i)});ne(()=>{var i;return(i=o.value)==null?void 0:i.html_content},i=>{i&&(se.value="html")});const pe=E(()=>x.value&&x.value.name.includes("Summary")),ye=E(()=>x.value&&x.value.name==="AI Task: generate_notes");E(()=>x.value&&x.value.name==="AI Task: generate_slide_title");const d=E(()=>x.value&&x.value.name==="AI Task: generate_audio"),Z=[{value:"TitleImageBody",label:"Standard Hybrid",desc:"Split screen content."},{value:"ImageOnly",label:"Impact Visual",desc:"Full image focus."},{value:"TextOnly",label:"Factual List",desc:"Bullet points only."},{value:"TitleOnly",label:"Section Hero",desc:"Minimalist break."},{value:"TwoColumn",label:"Comparison",desc:"Dual column content."}];ne(()=>{var i,t;return(t=(i=x.value)==null?void 0:i.logs)==null?void 0:t.length},()=>{Je(()=>{C.value&&(C.value.scrollTop=C.value.scrollHeight)})}),ne(()=>{var i,t;return(t=(i=o.value)==null?void 0:i.messages)==null?void 0:t.length},()=>{Je(()=>{K.value&&(K.value.scrollTop=K.value.scrollHeight)})});async function ve(i){if(!q.value)return;const t=u.notebook.tabs.findIndex(T=>T.id===q.value.id);t!==-1&&(u.notebook.tabs[t].content=JSON.stringify(i),await b.saveActive())}async function ce(i,t){if(!o.value)return;const T={...te.value};T.slides_data[k.value][i]=t,await ve(T)}async function gt(i){u.notebook.language=i,await b.saveActive()}async function xt(){await b.generateTitle()}async function Ze(){const i=(_.value||"").trim();!i||!q.value||(await b.processWithAi(i,[],"generate_slides_text",q.value.id,!1,h.value),_.value="")}async function mt(i){if(!z.value){z.value=!0;try{const t=i.path.split("/").pop(),T=await b.describeAsset(t),{confirmed:M}=await V.showConfirmation({title:"Image Analysis",message:`AI description: "${T}". Update slide prompt?`,confirmText:"Update"});M&&await ce("image_prompt",T)}finally{z.value=!1}}}async function Qe(){const i=(D.value||"").trim();if(!(!i||I.value)){I.value=!0;try{await b.sendSlideMessage(q.value.id,o.value.id,i,h.value),D.value=""}finally{I.value=!1}}}async function kt(){if(F.value)try{await b.updateArtefact(F.value.originalName,F.value.name,F.value.content),F.value=null}catch(i){console.error(i)}}function yt(){j.value={topic:"",title:"",layout:"TitleImageBody",bullets:[],image_prompt:"",selected_artefacts:[...h.value],author:N.value?N.value.username:""},y.value=1,de.value=!0}function ht(i){const t=j.value.selected_artefacts.indexOf(i);t===-1?j.value.selected_artefacts.push(i):j.value.selected_artefacts.splice(t,1)}async function wt(){const i=(j.value.topic||"").trim();if(i){v.value=!0;try{const t=await b.brainstormSlide(i,j.value.layout,j.value.selected_artefacts,j.value.author);Object.assign(j.value,t),y.value=3}finally{v.value=!1}}}async function _t(){de.value=!1,await b.processWithAi(JSON.stringify(j.value),[],"add_full_slide",q.value.id,!1,j.value.selected_artefacts)}function et(i){o.value&&(X.value=i,i==="refine_image"?ue.value=o.value.last_edit_prompt||o.value.image_prompt||"":ue.value=o.value.last_prompt||o.value.image_prompt||"",g.value=!0)}async function $t(){const i=(ue.value||"").trim();if(i){me.value=!0;try{const t=await b.enhancePrompt(i,h.value.length?`Using ${h.value.length} selected artefacts.`:"");ue.value=t}finally{me.value=!1}}}async function Ct(){const i=(ue.value||"").trim(),t=(Ie.value||"").trim();if(!i)return;const T={...te.value};X.value==="refine_image"?T.slides_data[k.value].last_edit_prompt=i:T.slides_data[k.value].last_prompt=i,T.slides_data[k.value].negative_prompt=t,await ve(T),await b.processWithAi(`SLIDE_INDEX:${k.value}|${i}|${t}`,[],X.value,q.value.id,!1,h.value),g.value=!1}async function St(){await b.generateSummary()}async function At(i){ce("selected_image_index",i)}async function It(i){await V.showConfirmation({title:"Delete Variant",message:"Remove image version?",confirmText:"Delete"})&&await b.deleteSlideImage(q.value.id,o.value.id,i)}function Tt(){var i;(i=S.value)==null||i.click()}async function Vt(i){const t=i.target.files[0];if(t){try{const T=await b.uploadSource(t,!1),M=`/api/notebooks/${u.notebook.id}/assets/${T.filename}`,n={...te.value},w=n.slides_data[k.value];w.images||(w.images=[]),w.images.push({path:M,prompt:"Manual Import",created_at:Date.now().toString()}),w.selected_image_index=w.images.length-1,await ve(n)}catch{}i.target.value=""}}function jt(i){if(ke.value){le&&le.stop(),ke.value=!1;return}const t=window.SpeechRecognition||window.webkitSpeechRecognition;if(!t){V.addNotification("Speech recognition not supported.","error");return}le=new t,le.lang=u.notebook.language==="zh"?"zh-CN":u.notebook.language||"en-US",le.continuous=!0,le.onstart=()=>{ke.value=!0},le.onresult=T=>{for(let M=T.resultIndex;M<T.results.length;++M)if(T.results[M].isFinal){const n=(T.results[M][0].transcript||"").trim();if(n){const w=o.value[i]||"";ce(i,w+(w?" ":"")+n)}}},le.start()}async function Nt(i){if(i!=null&&i.path)try{const t=await Ve.get(i.path,{responseType:"blob"}),T=window.URL.createObjectURL(new Blob([t.data])),M=document.createElement("a");M.href=T,M.setAttribute("download",i.path.split("/").pop()||"image.png"),document.body.appendChild(M),M.click(),document.body.removeChild(M)}catch{V.addNotification("Download failed.","error")}}async function Pe(i){ie.value=!0;try{const t=await Ve.get(`/api/notebooks/${u.notebook.id}/export`,{params:{format:i},responseType:"blob"}),T=window.URL.createObjectURL(new Blob([t.data])),M=document.createElement("a");M.href=T,M.setAttribute("download",`${u.notebook.title||"presentation"}.${i}`),document.body.appendChild(M),M.click(),document.body.removeChild(M)}finally{ie.value=!1}}async function Lt(){const{confirmed:i}=await V.showConfirmation({title:"Generate Video",message:"Render video using slide images and TTS voice-over?",confirmText:"Generate"});if(i)try{await Ve.post(`/api/notebooks/${u.notebook.id}/generate_video`)}catch{V.addNotification("Failed to start.","error")}}async function Rt(){const{confirmed:i}=await V.showConfirmation({title:"Delete Video?",message:"This action cannot be undone.",confirmText:"Delete"});i&&await b.deleteGeneratedAsset("video",q.value.id)}async function Ut(){await b.generateSlideAudio(k.value,q.value.id)}async function zt(){const{confirmed:i}=await V.showConfirmation({title:"Delete Audio?",message:"Remove generated voice-over?",confirmText:"Delete"});i&&await b.deleteGeneratedAsset("audio",q.value.id,o.value.id)}async function Ot(){const{confirmed:i,value:t}=await V.showConfirmation({title:"Generate Graphic",message:"Create an HTML/SVG graphic for this slide:",confirmText:"Generate",inputType:"text"});i&&await b.processWithAi(`SLIDE_INDEX:${k.value}| ${t||"Create visual"}`,[],"generate_slide_html",q.value.id,!1,h.value)}async function Dt(){await b.generateSlideNotes(k.value,"",q.value.id)}function tt(i){var n,w;if(!((w=(n=o.value)==null?void 0:n.images)!=null&&w.length))return;const t=o.value.images.length,M=((o.value.selected_image_index||0)+i+t)%t;ce("selected_image_index",M)}function Mt(){if(!te.value.slides_data||te.value.slides_data.length===0){V.addNotification("No slides to play.","warning");return}const i=te.value.slides_data.map(t=>{var T;return{src:(T=t.images)!=null&&T.length?t.images[t.selected_image_index||0].path:null,prompt:t.title||"Untitled Slide",id:t.id,notes:t.notes,audio_src:t.audio_src,html_content:t.html_content}});V.openSlideshow({slides:i,startIndex:k.value,title:u.notebook.title})}return Oe(()=>{le&&ke.value&&le.stop()}),(i,t)=>{var T,M;return s(),a("div",bl,[r(fe,{"enter-active-class":"transition duration-300","enter-from-class":"opacity-0 scale-95","enter-to-class":"opacity-100 scale-100","leave-active-class":"transition duration-200","leave-from-class":"opacity-100 scale-100","leave-to-class":"opacity-0 scale-95"},{default:ae(()=>[x.value?(s(),a("div",pl,[e("div",vl,[e("div",fl,[e("div",gl,[e("div",xl,[r(Ce,{class:"w-12 h-12 animate-spin text-white"})]),e("div",null,[e("h2",ml,f(x.value.name),1),e("p",kl,f(x.value.description),1)])]),e("div",yl,f(x.value.progress)+"%",1)]),e("div",hl,[e("div",{class:"h-full bg-blue-500 transition-all duration-500 progress-bar-animated",style:bt({width:x.value.progress+"%"})},null,4)]),e("div",wl,[t[34]||(t[34]=e("div",{class:"px-4 py-2 bg-slate-800 text-[10px] font-black uppercase text-slate-400 tracking-widest border-b border-slate-700"},"Studio Log Output",-1)),e("div",{ref_key:"logsContainerRef",ref:C,class:"flex-grow overflow-y-auto p-4 font-mono text-[11px] text-slate-400 space-y-1 custom-scrollbar"},[(s(!0),a(L,null,P(x.value.logs,(n,w)=>(s(),a("div",{key:w,class:"flex gap-4"},[e("span",_l,"["+f(new Date(n.timestamp).toLocaleTimeString())+"]",1),e("span",{class:B({"text-red-400":n.level==="ERROR","text-blue-400":n.level==="INFO"})},f(n.message),3)]))),128))],512)])])])):m("",!0)]),_:1}),(s(),U(Se,{to:"#global-header-title-target"},[e("div",$l,[e("div",{class:"flex items-center gap-2 group cursor-pointer",onClick:xt,title:"Click to auto-title"},[e("span",Cl,f(O.notebook.title),1),r(re,{class:"w-3 h-3 text-blue-500 opacity-0 group-hover:opacity-100 transition-opacity"})]),e("div",Sl,[r(Be,{class:"w-3 h-3"}),e("span",Al,f(((T=q.value)==null?void 0:T.title)||"Studio"),1)])])])),(s(),U(Se,{to:"#global-header-actions-target"},[e("div",Il,[e("select",{value:O.notebook.language,onChange:t[0]||(t[0]=n=>gt(n.target.value)),class:"bg-slate-100 dark:bg-slate-800 border-none rounded px-2 py-1 text-[10px] font-black uppercase outline-none mr-2"},[(s(),a(L,null,P(De,n=>e("option",{key:n.code,value:n.code},f(n.code),9,Vl)),64))],40,Tl),e("button",{onClick:t[1]||(t[1]=n=>Pe("pptx")),class:"btn-icon-flat text-orange-600",title:"PPTX"},[r(Be,{class:"w-4 h-4"})]),e("button",{onClick:t[2]||(t[2]=n=>Pe("pdf")),class:"btn-icon-flat text-red-600",title:"PDF"},[r(_e,{class:"w-4 h-4"})]),e("button",{onClick:t[3]||(t[3]=n=>Pe("zip")),class:"btn-icon-flat text-blue-600",title:"Export ZIP"},[r(Gt,{class:"w-4 h-4"})]),e("button",{onClick:Lt,class:"btn-icon-flat text-pink-500",title:"Gen Video"},[r(He,{class:"w-4 h-4"})]),e("button",{onClick:St,class:"btn-icon-flat",title:"Summary",disabled:pe.value},[r(re,{class:"w-4 h-4 text-purple-500"})],8,jl),e("button",{onClick:t[4]||(t[4]=n=>H.value=!H.value),class:B(["btn-icon-flat relative",{"bg-blue-50 dark:bg-blue-900/20 text-blue-500":H.value}])},[r(rt,{class:"w-4 h-4"})],2),e("button",{onClick:Mt,class:"btn-primary-flat ml-2"},[r(Be,{class:"w-4 h-4"}),t[35]||(t[35]=e("span",{class:"hidden sm:inline ml-1"},"Play",-1))])])])),e("div",Nl,[(s(!0),a(L,null,P(te.value.slides_data,(n,w)=>{var be;return s(),a("div",{key:n.id,onClick:Ee=>k.value=w,class:B(["h-20 aspect-video flex-shrink-0 rounded-lg border-2 cursor-pointer overflow-hidden transition-all relative group shadow-sm",k.value===w?"border-blue-500 ring-2 ring-blue-500/20":"border-slate-200 dark:border-slate-800 opacity-60 hover:opacity-100"])},[(be=n.images)!=null&&be.length?(s(),U(he,{key:0,src:n.images[n.selected_image_index||0].path,"img-class":"object-cover",class:"w-full h-full"},null,8,["src"])):(s(),a("div",Rl,f(w+1),1)),e("div",Ul,f(n.title||"Untitled"),1)],10,Ll)}),128)),e("button",{onClick:yt,class:"h-20 aspect-video border-2 border-dashed border-slate-300 dark:border-slate-700 rounded-lg flex flex-col items-center justify-center text-slate-400 hover:border-blue-500 hover:text-blue-500 transition-colors"},[r(Ae,{class:"w-6 h-6 mb-1"}),t[36]||(t[36]=e("span",{class:"text-[9px] font-black uppercase"},"Add Slide",-1))])]),e("div",zl,[e("div",Ol,[te.value.video_src?(s(),a("div",Dl,[r(ft,{src:te.value.video_src},null,8,["src"]),e("div",Ml,[e("button",{onClick:Rt,class:"btn btn-danger btn-sm shadow-xl"},[r(we,{class:"w-4 h-4 mr-1"}),t[37]||(t[37]=Q(" Delete Video"))])])])):m("",!0),o.value?(s(),a("div",Pl,[e("div",El,[se.value==="html"&&o.value.html_content?(s(),a("iframe",{key:0,src:ee.value,class:"w-full h-full border-none bg-white"},null,8,Gl)):(s(),a(L,{key:1},[o.value.layout==="ImageOnly"?(s(),a(L,{key:0},[e("div",Bl,[l.value?(s(),U(he,{key:0,src:l.value.path,"img-class":"object-cover",class:"w-full h-full"},null,8,["src"])):m("",!0)]),e("div",Wl,[e("h1",Fl,f(o.value.title),1)])],64)):o.value.layout==="TitleImageBody"||o.value.layout==="TwoColumn"?(s(),a(L,{key:1},[e("div",Jl,[e("h1",Hl,f(o.value.title),1),e("ul",ql,[(s(!0),a(L,null,P(o.value.bullets,(n,w)=>(s(),a("li",{key:w,class:"flex gap-4 text-xl text-slate-700 font-medium leading-snug"},[t[38]||(t[38]=e("span",{class:"text-blue-500 font-black"},"•",-1)),e("span",null,f(n),1)]))),128))])]),e("div",Kl,[l.value?(s(),U(he,{key:0,src:l.value.path,"img-class":"object-cover",class:"w-full h-full"},null,8,["src"])):m("",!0),l.value?(s(),a("div",Yl,[e("button",{onClick:t[5]||(t[5]=oe(n=>tt(-1),["stop"])),class:"p-2 bg-black/60 rounded-full text-white hover:bg-black"},[r(il,{class:"w-4 h-4"})]),e("button",{onClick:t[6]||(t[6]=oe(n=>tt(1),["stop"])),class:"p-2 bg-black/60 rounded-full text-white hover:bg-black"},[r(Bt,{class:"w-4 h-4"})])])):m("",!0)])],64)):(s(),a("div",Xl,[e("h1",Zl,f(o.value.title),1),o.value.layout==="TextOnly"?(s(),a("ul",Ql,[(s(!0),a(L,null,P(o.value.bullets,(n,w)=>(s(),a("li",{key:w,class:"flex gap-6 text-2xl text-slate-800 font-bold leading-tight"},[t[39]||(t[39]=e("span",{class:"text-blue-600 font-black"},"▶",-1)),e("span",null,f(n),1)]))),128))])):m("",!0)]))],64))]),e("div",ea,[e("button",{onClick:t[7]||(t[7]=n=>et("images")),class:"p-2 bg-white/90 dark:bg-slate-800/90 rounded-lg shadow hover:text-blue-500 transition-colors",title:"Gen Variant"},[r(pt,{class:"w-4 h-4"})]),e("button",{onClick:t[8]||(t[8]=n=>et("refine_image")),class:"p-2 bg-white/90 dark:bg-slate-800/90 rounded-lg shadow hover:text-purple-500 transition-colors",title:"AI Edit"},[r(al,{class:"w-4 h-4"})]),e("button",{onClick:Ot,class:"p-2 bg-white/90 dark:bg-slate-800/90 rounded-lg shadow hover:text-green-500 transition-colors",title:"Create HTML Graphic"},[r(Fe,{class:"w-4 h-4"})]),o.value.html_content?(s(),a("button",{key:0,onClick:t[9]||(t[9]=n=>se.value=se.value==="image"?"html":"image"),class:"p-2 bg-white/90 dark:bg-slate-800/90 rounded-lg shadow hover:text-orange-500 transition-colors",title:"Toggle Graphic/Image"},[se.value==="html"?(s(),U(vt,{key:0,class:"w-4 h-4"})):(s(),U(Fe,{key:1,class:"w-4 h-4"}))])):m("",!0),l.value?(s(),a("button",{key:1,onClick:t[10]||(t[10]=n=>Nt(l.value)),class:"p-2 bg-white/90 dark:bg-slate-800/90 rounded-lg shadow hover:text-blue-500 transition-colors",title:"Download Image"},[r(Ue,{class:"w-4 h-4"})])):m("",!0)]),e("div",ta,[e("span",null,"Layout: "+f(o.value.layout),1),e("span",null,"Slide "+f(k.value+1)+" / "+f(te.value.slides_data.length),1)])])):m("",!0),o.value?(s(),a("div",sa,[(M=o.value.images)!=null&&M.length?(s(),a("div",la,[(s(!0),a(L,null,P(o.value.images,(n,w)=>(s(),a("div",{key:w,onClick:be=>At(w),class:B(["h-14 w-24 flex-shrink-0 rounded border-2 transition-all relative group/thumb overflow-hidden cursor-pointer",w===(o.value.selected_image_index||0)?"border-blue-500":"border-transparent opacity-50"])},[r(he,{src:n.path,class:"w-full h-full object-cover"},null,8,["src"]),e("div",oa,[e("button",{onClick:oe(be=>mt(n),["stop"]),class:"text-white p-0.5 bg-blue-600 rounded",title:"Analyze AI"},[r(st,{class:"w-3 h-3"})],8,na),e("button",{onClick:oe(be=>It(w),["stop"]),class:"text-white p-0.5 bg-red-600 rounded",title:"Delete"},[r(we,{class:"w-3 h-3"})],8,ra)])],10,aa))),128))])):m("",!0),e("button",{onClick:Tt,class:"h-14 w-24 flex-shrink-0 rounded border-2 border-dashed border-slate-300 dark:border-slate-800 flex items-center justify-center text-slate-400 hover:text-blue-500 hover:border-blue-500 transition-colors"},[r(Ue,{class:"w-5 h-5"})]),e("input",{type:"file",ref_key:"fileInput",ref:S,onChange:Vt,class:"hidden",accept:"image/*"},null,544)])):m("",!0)]),r(fe,{"enter-active-class":"transition duration-300 transform translate-x-full","enter-to-class":"translate-x-0"},{default:ae(()=>{var n;return[H.value?(s(),a("div",ia,[e("div",da,[e("div",ua,[r(rt,{class:"w-4 h-4 text-blue-500"}),t[40]||(t[40]=e("h3",{class:"font-black text-[10px] uppercase tracking-widest"},"Intelligence",-1))]),e("button",{onClick:t[11]||(t[11]=w=>H.value=!1),class:"btn-icon-flat"},[r(ge,{class:"w-5 h-5"})])]),e("div",{class:"flex-grow overflow-y-auto custom-scrollbar p-4 space-y-4",ref_key:"messagesContainerRef",ref:K},[(s(!0),a(L,null,P((n=o.value)==null?void 0:n.messages,(w,be)=>(s(),a("div",{key:be,class:B(["flex flex-col gap-1",{"items-end":w.role==="user"}])},[e("div",{class:B(["p-3 rounded-2xl text-xs max-w-[90%]",w.role==="user"?"bg-blue-600 text-white":"bg-slate-100 dark:bg-slate-800 text-slate-700 dark:text-slate-300"])},[r(Ke,{content:w.content},null,8,["content"])],2)],2))),128))],512),e("div",ca,[G(e("textarea",{"onUpdate:modelValue":t[12]||(t[12]=w=>D.value=w),onKeyup:je(oe(Qe,["exact"]),["enter"]),class:"input-field w-full text-xs h-20 resize-none",placeholder:"Ask AI...",disabled:I.value},null,40,ba),[[Y,D.value]]),e("button",{onClick:Qe,class:"btn btn-primary h-20",disabled:I.value},[r(Wt,{class:"w-4 h-4"})],8,pa)])])):m("",!0)]}),_:1})]),e("div",va,[e("div",fa,[o.value?(s(),a("div",ga,[e("div",xa,[e("h3",ma,[r(Te,{class:"w-3 h-3"}),t[41]||(t[41]=Q(" Content Editor"))]),e("select",{value:o.value.layout,onChange:t[13]||(t[13]=n=>ce("layout",n.target.value)),class:"text-[10px] font-bold bg-slate-100 dark:bg-slate-800 border-none rounded px-3 py-1 focus:ring-1 ring-blue-500 transition-all"},[(s(),a(L,null,P(Z,n=>e("option",{key:n.value,value:n.value},f(n.label),9,ya)),64))],40,ka)]),e("input",{value:o.value.title,onChange:t[14]||(t[14]=n=>ce("title",n.target.value)),placeholder:"Slide Title...",class:"w-full text-2xl font-black bg-transparent border-b-2 border-slate-100 dark:border-slate-800 focus:border-blue-500 p-0 transition-all outline-none"},null,40,ha),e("div",wa,[(s(!0),a(L,null,P(o.value.bullets||[],(n,w)=>(s(),a("div",{key:w,class:"flex items-start gap-3 group"},[t[42]||(t[42]=e("span",{class:"text-blue-500 font-black mt-1.5"},"●",-1)),e("textarea",{value:n,onChange:be=>ce("bullets",o.value.bullets.map((Ee,Ge)=>Ge===w?be.target.value:Ee)),class:"flex-grow bg-transparent text-sm border-none focus:ring-0 p-0 resize-none min-h-[24px]",rows:"1"},null,40,_a),e("button",{onClick:be=>ce("bullets",o.value.bullets.filter((Ee,Ge)=>Ge!==w)),class:"opacity-0 group-hover:opacity-100 text-red-500 transition-opacity p-1"},[r(we,{class:"w-3.5 h-3.5"})],8,$a)]))),128)),e("button",{onClick:t[15]||(t[15]=n=>ce("bullets",[...o.value.bullets||[],"New point..."])),class:"text-[10px] font-black uppercase text-blue-500 hover:underline"},"+ Add Point")])])):m("",!0),e("div",Ca,[o.value?(s(),a("div",Sa,[e("div",Aa,[e("div",Ia,[r(lt,{class:"w-3.5 h-3.5 text-slate-400"}),t[43]||(t[43]=e("label",{class:"text-[10px] font-black uppercase text-slate-500 tracking-widest"},"Speaker Script",-1)),e("button",{onClick:t[16]||(t[16]=n=>jt("notes")),class:B(["p-1 rounded-full transition-all",ke.value?"text-red-600 bg-red-100":"text-blue-500"])},[r(lt,{class:"w-4 h-4"})],2)]),e("div",Ta,[e("button",{onClick:Ut,class:"btn btn-secondary btn-xs",disabled:d.value},"TTS",8,Va),e("button",{onClick:Dt,class:"btn btn-secondary btn-xs",disabled:ye.value},"AI Gen",8,ja),o.value.audio_src?(s(),a("button",{key:0,onClick:zt,class:"text-red-500 p-1 hover:bg-red-50 rounded"},[r(we,{class:"w-3.5 h-3.5"})])):m("",!0)])]),e("textarea",{value:o.value.notes,onChange:t[17]||(t[17]=n=>ce("notes",n.target.value)),class:"flex-grow bg-transparent border-none focus:ring-0 text-xs leading-relaxed resize-none p-0 custom-scrollbar",placeholder:"Type script..."},null,40,Na),o.value.audio_src?(s(),a("div",La,[r(Ys,{src:o.value.audio_src,class:"flex-grow"},null,8,["src"])])):m("",!0)])):m("",!0),e("div",Ra,[G(e("input",{"onUpdate:modelValue":t[18]||(t[18]=n=>_.value=n),onKeyup:je(Ze,["enter"]),placeholder:"Add slides or refine deck...",class:"input-field flex-grow h-12 rounded-2xl border-2"},null,544),[[Y,_.value]]),e("button",{onClick:Ze,disabled:!_.value.trim()||x.value,class:"btn btn-primary px-8 rounded-2xl h-12 shadow-xl"},[r(re,{class:"w-5 h-5 mr-2"}),t[44]||(t[44]=e("span",{class:"font-bold"},"Process",-1))],8,Ua)])])])]),r(fe,{name:"fade"},{default:ae(()=>[de.value?(s(),a("div",za,[e("div",Oa,[e("div",Da,[t[45]||(t[45]=e("h3",{class:"font-black text-sm uppercase tracking-widest"},"New Slide Wizard",-1)),e("button",{onClick:t[19]||(t[19]=n=>de.value=!1),class:"btn-icon-flat"},[r(ge,{class:"w-5 h-5"})])]),e("div",Ma,[y.value===1?(s(),a("div",Pa,[e("div",null,[t[46]||(t[46]=e("label",{class:"text-[10px] font-black uppercase text-blue-500 mb-2 block"},"1. Topic",-1)),G(e("textarea",{"onUpdate:modelValue":t[20]||(t[20]=n=>j.value.topic=n),class:"input-field w-full h-24 font-bold text-lg",placeholder:"What should this slide be about?"},null,512),[[Y,j.value.topic]])]),e("div",null,[t[47]||(t[47]=e("label",{class:"text-[10px] font-black uppercase text-slate-500 mb-2 block"},"Sources",-1)),e("div",Ea,[(s(!0),a(L,null,P(O.notebook.artefacts,n=>(s(),a("button",{key:n.filename,onClick:w=>ht(n.filename),class:B(["p-2 rounded-lg text-[10px] flex items-center gap-2 border transition-all",j.value.selected_artefacts.includes(n.filename)?"bg-green-50 border-green-500":"border-transparent"])},[j.value.selected_artefacts.includes(n.filename)?(s(),U(ze,{key:0,class:"w-3 h-3"})):m("",!0),e("span",Ba,f(n.filename),1)],10,Ga))),128))])])])):m("",!0),y.value===2?(s(),a("div",Wa,[t[48]||(t[48]=e("label",{class:"text-[10px] font-black uppercase text-blue-500 mb-4 block"},"3. Layout Architecture",-1)),e("div",Fa,[(s(),a(L,null,P(Z,n=>e("button",{key:n.value,onClick:w=>j.value.layout=n.value,class:B(["p-4 rounded-xl border-2 transition-all text-left",j.value.layout===n.value?"border-blue-500 bg-blue-50":"border-slate-100"])},[e("p",Ha,f(n.label),1),e("p",qa,f(n.desc),1)],10,Ja)),64))])])):m("",!0),y.value===3?(s(),a("div",Ka,[e("div",null,[t[49]||(t[49]=e("label",{class:"text-[10px] font-black text-slate-500 mb-1 block"},"Proposed Title",-1)),G(e("input",{"onUpdate:modelValue":t[21]||(t[21]=n=>j.value.title=n),class:"input-field w-full font-bold"},null,512),[[Y,j.value.title]])]),e("div",null,[t[50]||(t[50]=e("label",{class:"text-[10px] font-black text-slate-500 mb-1 block"},"Visual Strategy (Prompt)",-1)),G(e("textarea",{"onUpdate:modelValue":t[22]||(t[22]=n=>j.value.image_prompt=n),class:"input-field w-full h-20 text-xs italic resize-none"},null,512),[[Y,j.value.image_prompt]])])])):m("",!0)]),e("div",Ya,[y.value>1?(s(),a("button",{key:0,onClick:t[23]||(t[23]=n=>y.value--),class:"btn btn-secondary"},"Back")):(s(),a("div",Xa)),e("div",Za,[e("button",{onClick:t[24]||(t[24]=n=>de.value=!1),class:"btn btn-secondary"},"Cancel"),y.value===3?(s(),a("button",{key:0,onClick:_t,class:"btn btn-primary"},"Add to Deck")):y.value===2?(s(),a("button",{key:1,onClick:wt,class:"btn btn-primary",disabled:v.value},[v.value?(s(),U(Ce,{key:0,class:"w-4 h-4 mr-2 animate-spin"})):m("",!0),t[51]||(t[51]=Q("Brainstorm"))],8,Qa)):(s(),a("button",{key:2,onClick:t[25]||(t[25]=n=>y.value=2),class:"btn btn-primary",disabled:!j.value.topic.trim()},"Next",8,eo))])])])])):m("",!0)]),_:1}),r(fe,{name:"fade"},{default:ae(()=>[g.value?(s(),a("div",to,[e("div",so,[e("div",lo,[e("h3",ao,f(X.value==="refine_image"?"Refine Visual":"New Variant"),1),e("button",{onClick:t[26]||(t[26]=n=>g.value=!1),class:"btn-icon-flat"},[r(ge,{class:"w-5 h-5"})])]),e("div",oo,[e("div",null,[t[52]||(t[52]=e("label",{class:"text-[10px] font-bold uppercase text-slate-500 mb-1 block"},"Strategy Prompt",-1)),G(e("textarea",{"onUpdate:modelValue":t[27]||(t[27]=n=>ue.value=n),class:"input-field w-full h-32 resize-none"},null,512),[[Y,ue.value]])]),e("div",no,[e("div",ro,[r(st,{class:"w-3 h-3 text-slate-400"}),e("span",io,"Context: "+f(h.value.length)+" Active",1)]),e("button",{onClick:$t,class:"btn btn-secondary btn-sm",disabled:me.value},[r(re,{class:"w-3 h-3 mr-1"}),t[53]||(t[53]=Q(" Enhance AI"))],8,uo)]),e("div",null,[t[54]||(t[54]=e("label",{class:"text-[10px] font-bold uppercase text-red-500 mb-1 block"},"Negative Guidance (Avoid)",-1)),G(e("textarea",{"onUpdate:modelValue":t[28]||(t[28]=n=>Ie.value=n),class:"input-field w-full h-16 resize-none border-red-100",placeholder:"Negative..."},null,512),[[Y,Ie.value]])])]),e("div",co,[e("button",{onClick:t[29]||(t[29]=n=>g.value=!1),class:"btn btn-secondary"},"Cancel"),e("button",{onClick:Ct,class:"btn btn-primary",disabled:!ue.value.trim()},"Generate Variant",8,bo)])])])):m("",!0)]),_:1}),r(fe,{name:"fade"},{default:ae(()=>[F.value?(s(),a("div",po,[e("div",vo,[e("div",fo,[t[55]||(t[55]=e("h3",{class:"font-black text-xs uppercase tracking-widest"},"Edit Knowledge Source",-1)),e("button",{onClick:t[30]||(t[30]=n=>F.value=null)},[r(ge,{class:"w-5 h-5"})])]),e("div",go,[G(e("input",{"onUpdate:modelValue":t[31]||(t[31]=n=>F.value.name=n),class:"input-field font-bold"},null,512),[[Y,F.value.name]]),G(e("textarea",{"onUpdate:modelValue":t[32]||(t[32]=n=>F.value.content=n),class:"flex-grow input-field font-mono text-xs p-4 resize-none"},null,512),[[Y,F.value.content]])]),e("div",xo,[e("button",{onClick:t[33]||(t[33]=n=>F.value=null),class:"btn btn-secondary"},"Cancel"),e("button",{onClick:kt,class:"btn btn-primary"},"Update Artefact")])])])):m("",!0)]),_:1})])}}},ko=xe(mo,[["__scopeId","data-v-90dcb16d"]]),yo={class:"h-full flex overflow-hidden bg-gray-50 dark:bg-gray-900 relative"},ho={class:"flex flex-col items-center"},wo={class:"text-sm font-bold text-gray-800 dark:text-gray-100"},_o={class:"flex items-center gap-1"},$o={class:"w-48 py-1"},Co=["onClick"],So={class:"flex bg-gray-100 dark:bg-gray-800 p-0.5 rounded-lg border dark:border-gray-700"},Ao={class:"w-72 border-r dark:border-gray-700 bg-white dark:bg-gray-850 flex flex-col flex-shrink-0"},Io={class:"p-4 border-b dark:border-gray-700 font-black text-[10px] uppercase tracking-widest text-gray-500 flex justify-between items-center"},To={class:"flex-grow overflow-y-auto p-2 space-y-4 custom-scrollbar"},Vo={class:"flex items-center gap-2 mb-1 text-blue-600"},jo={class:"text-[10px] opacity-70"},No={class:"flex-grow flex flex-col relative min-w-0"},Lo={class:"flex-grow overflow-hidden relative"},Ro={key:0,class:"absolute inset-0 overflow-y-auto p-8 space-y-6 bg-gray-50/50 dark:bg-transparent"},Uo={class:"max-w-4xl mx-auto space-y-4"},zo={class:"flex-grow pr-6"},Oo={class:"text-[10px] font-black uppercase text-blue-500 mb-1"},Do={class:"font-bold text-lg text-gray-900 dark:text-white mb-2"},Mo={class:"text-sm text-gray-600 dark:text-gray-400 leading-relaxed"},Po=["onClick","disabled"],Eo={key:0,class:"absolute inset-0 overflow-y-auto p-10 custom-scrollbar bg-white dark:bg-gray-900"},Go={class:"p-4 border-t dark:border-gray-700 bg-white dark:bg-gray-900 flex gap-3 shadow-inner"},Bo={class:"relative flex-grow"},Wo={class:"flex items-center gap-2 px-2 border-l dark:border-gray-700 absolute right-1 top-1/2 -translate-y-1/2 bg-white dark:bg-gray-800 pl-2 h-8"},Fo=["disabled"],Jo={__name:"BookBuildingView",props:{notebook:{type:Object,required:!0}},setup(O){const u=O,b=Ne();Le();const V=Re(),{tasks:W}=$e(V),R=p(null),$=p(!0),N=p(""),A=p(!1);p(null);const k=p([]);p(null);const S=[{label:"PDF Manuscript",value:"pdf"},{label:"Word (DOCX)",value:"docx"},{label:"Markdown File",value:"md"},{label:"Plain Text",value:"txt"}];async function C(_){await b.exportNotebook(_)}const K=E(()=>W.value.find(_=>(_.description===u.notebook.id||_.name.includes(u.notebook.title))&&(_.status==="running"||_.status==="pending"))),H=E(()=>{var _;return(_=u.notebook.tabs)==null?void 0:_.find(c=>c.type==="book_plan")}),D=E(()=>{if(!H.value)return[];try{return JSON.parse(H.value.content)}catch{return[]}}),I=E(()=>{var _,c;return((_=u.notebook.tabs)==null?void 0:_.find(x=>x.id===R.value))||((c=u.notebook.tabs)==null?void 0:c[0])});ne(()=>u.notebook.id,()=>{var _;if(((_=u.notebook.tabs)==null?void 0:_.length)>0&&(!R.value||!u.notebook.tabs.find(c=>c.id===R.value))){const c=u.notebook.tabs.find(x=>x.type==="book_plan");R.value=c?c.id:u.notebook.tabs[0].id}},{immediate:!0});async function ie(){var x,h;if(!N.value.trim())return;let _=A.value&&((x=I.value)==null?void 0:x.type)==="book_plan"?"generate_book_plan":"write_book_chapter",c=A.value?(h=I.value)==null?void 0:h.id:null;await b.processWithAi(N.value,[],_,c,!1,k.value),N.value=""}async function se(_){await b.processWithAi(`Write Chapter: ${_.title}`,[],"write_book_chapter",null,!1,k.value)}return(_,c)=>{var x;return s(),a("div",yo,[(s(),U(Se,{to:"#global-header-title-target"},[e("div",ho,[e("span",wo,f(O.notebook.title),1),c[8]||(c[8]=e("span",{class:"text-[9px] font-black uppercase text-blue-500 tracking-widest"},"Book Studio",-1))])])),(s(),U(Se,{to:"#global-header-actions-target"},[e("div",_o,[r(it,{title:"Export","button-class":"btn-icon-flat text-gray-500"},{icon:ae(()=>[r(Ue,{class:"w-4 h-4"})]),default:ae(()=>[e("div",$o,[(s(),a(L,null,P(S,h=>e("button",{key:h.value,onClick:F=>C(h.value),class:"w-full text-left px-4 py-2 text-xs font-bold hover:bg-gray-100 dark:hover:bg-gray-800"},f(h.label),9,Co)),64))])]),_:1}),e("div",So,[e("button",{onClick:c[0]||(c[0]=h=>$.value=!0),class:B(["p-1.5 rounded transition-colors",$.value?"bg-white dark:bg-gray-700 shadow text-blue-600":"text-gray-400"])},[r(We,{class:"w-3.5 h-3.5"})],2),e("button",{onClick:c[1]||(c[1]=h=>$.value=!1),class:B(["p-1.5 rounded transition-colors",$.value?"text-gray-400":"bg-white dark:bg-gray-700 shadow text-blue-600"])},[r(Te,{class:"w-3.5 h-3.5"})],2)]),e("button",{onClick:c[2]||(c[2]=(...h)=>J(b).saveActive&&J(b).saveActive(...h)),class:"btn-icon-flat text-green-500",title:"Save"},[r(qe,{class:"w-4 h-4"})])])])),e("div",Ao,[e("div",Io,[c[9]||(c[9]=e("span",null,"Manuscript",-1)),e("button",{onClick:c[3]||(c[3]=h=>J(b).addTab("markdown")),class:"text-blue-500 hover:text-blue-600"},[r(Ae,{class:"w-4 h-4"})])]),e("div",To,[H.value?(s(),a("div",{key:0,onClick:c[4]||(c[4]=h=>R.value=H.value.id),class:B(["p-3 rounded-lg border-2 cursor-pointer shadow-sm",R.value===H.value.id?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"bg-gray-50 dark:bg-gray-800 border-transparent"])},[e("div",Vo,[r(Ft,{class:"w-4 h-4"}),c[10]||(c[10]=Q()),c[11]||(c[11]=e("span",{class:"font-bold text-xs uppercase"},"Outline",-1))]),e("p",jo,f(O.notebook.title)+" Plan",1)],2)):m("",!0)])]),e("div",No,[e("div",Lo,[((x=I.value)==null?void 0:x.type)==="book_plan"?(s(),a("div",Ro,[e("div",Uo,[(s(!0),a(L,null,P(D.value,(h,F)=>(s(),a("div",{key:F,class:"p-6 bg-white dark:bg-gray-800 rounded-xl border-l-4 border-blue-500 shadow-md flex justify-between items-start transition-transform hover:scale-[1.01]"},[e("div",zo,[e("div",Oo,"Chapter "+f(F+1),1),e("div",Do,f(h.title),1),e("p",Mo,f(h.description),1)]),e("button",{onClick:de=>se(h),class:"btn btn-primary btn-sm flex-shrink-0 shadow-lg",disabled:K.value},[r(re,{class:"w-4 h-4 mr-2"}),c[12]||(c[12]=Q(" Write"))],8,Po)]))),128))])])):I.value?(s(),a(L,{key:1},[$.value?(s(),a("div",Eo,[r(Ke,{content:I.value.content,class:"prose prose-lg dark:prose-invert max-w-4xl mx-auto"},null,8,["content"])])):(s(),U(dt,{key:1,modelValue:I.value.content,"onUpdate:modelValue":c[5]||(c[5]=h=>I.value.content=h),onBlur:J(b).saveActive,class:"h-full"},null,8,["modelValue","onBlur"]))],64)):m("",!0)]),e("div",Go,[e("div",Bo,[G(e("input",{"onUpdate:modelValue":c[6]||(c[6]=h=>N.value=h),onKeyup:je(ie,["enter"]),placeholder:"Describe instructions for the book...",class:"input-field w-full pr-32"},null,544),[[Y,N.value]]),e("div",Wo,[G(e("input",{type:"checkbox",id:"mod-tab","onUpdate:modelValue":c[7]||(c[7]=h=>A.value=h),class:"h-3 w-3 rounded text-blue-600 cursor-pointer"},null,512),[[Ye,A.value]]),c[13]||(c[13]=e("label",{for:"mod-tab",class:"text-[9px] font-black uppercase text-gray-400 cursor-pointer"},"Update Active",-1))])]),e("button",{onClick:ie,class:"btn btn-primary px-8 flex-shrink-0",disabled:K.value},[r(re,{class:"w-4 h-4 mr-2"}),c[14]||(c[14]=Q(" Go"))],8,Fo)])])])}}},Ho={class:"h-full flex overflow-hidden bg-gray-50 dark:bg-gray-950 relative"},qo={key:0,class:"absolute inset-0 z-50 bg-white/95 dark:bg-gray-900/95 backdrop-blur-md flex flex-col p-10"},Ko={class:"max-w-4xl mx-auto w-full flex flex-col h-full animate-in fade-in zoom-in-95 duration-500"},Yo={class:"flex items-center justify-between mb-8"},Xo={class:"flex items-center gap-6"},Zo={class:"p-4 bg-blue-600 rounded-3xl shadow-xl shadow-blue-500/20"},Qo={class:"text-2xl font-black text-gray-900 dark:text-white uppercase tracking-tighter"},en={class:"text-sm font-bold text-blue-500 opacity-80 uppercase tracking-widest"},tn={class:"text-4xl font-black text-blue-600 font-mono"},sn={class:"w-full bg-gray-200 dark:bg-gray-800 h-3 rounded-full overflow-hidden mb-10 shadow-inner"},ln={class:"flex-grow flex flex-col min-h-0 bg-black rounded-3xl shadow-2xl border border-gray-800 overflow-hidden"},an={class:"text-gray-700 shrink-0 select-none"},on={class:"bg-white dark:bg-gray-900 rounded-2xl shadow-2xl w-full max-w-3xl flex flex-col overflow-hidden border dark:border-gray-800"},nn={class:"p-4 border-b dark:border-gray-800 flex justify-between items-center bg-gray-50 dark:bg-gray-800/50"},rn={class:"font-black text-sm uppercase tracking-widest flex items-center gap-2"},dn={class:"p-8 overflow-y-auto custom-scrollbar min-h-[450px]"},un={key:0,class:"space-y-6"},cn={class:"grid grid-cols-2 gap-2 max-h-40 overflow-y-auto p-2 border rounded-xl dark:border-gray-800"},bn=["onClick"],pn={class:"truncate"},vn={key:1,class:"space-y-6"},fn={class:"grid grid-cols-2 gap-6"},gn=["value"],xn=["value"],mn={class:"p-4 border-t dark:border-gray-800 flex justify-between gap-3 bg-gray-50 dark:bg-gray-900/50"},kn={key:1},yn={class:"flex gap-2"},hn=["disabled"],wn={class:"w-72 border-r dark:border-gray-800 bg-white dark:bg-gray-900 flex flex-col flex-shrink-0 transition-all duration-300"},_n={class:"p-4 border-b dark:border-gray-800 font-black text-[10px] uppercase tracking-widest text-gray-500 flex justify-between items-center"},$n={class:"flex gap-2"},Cn={class:"flex-grow overflow-y-auto p-3 space-y-4 custom-scrollbar"},Sn={key:0,class:"bg-blue-50 dark:bg-blue-900/10 rounded-xl p-3 border border-blue-100 dark:border-blue-900/30 mb-4 animate-in slide-in-from-left duration-300"},An={class:"flex justify-between items-center mb-3"},In={key:0,class:"text-[10px] text-center text-gray-400 italic py-2"},Tn={class:"space-y-2"},Vn=["onClick"],jn={class:"min-w-0 flex-grow"},Nn={class:"text-xs font-bold truncate"},Ln={class:"flex gap-1"},Rn=["onClick"],Un=["onClick"],zn={class:"flex items-center gap-2 mb-1 text-red-600"},On={class:"text-[10px] opacity-70"},Dn={key:2,class:"space-y-1"},Mn=["onClick"],Pn={class:"flex items-center gap-2 truncate min-w-0"},En={class:"w-4 h-4 flex items-center justify-center bg-gray-300 dark:bg-gray-600 rounded-full text-[8px] flex-shrink-0"},Gn={class:"truncate"},Bn=["onClick"],Wn={class:"p-4 border-t dark:border-gray-800"},Fn=["disabled"],Jn={class:"flex-grow flex flex-col relative min-w-0"},Hn={key:0,class:"absolute inset-0 flex items-center justify-center p-8 text-center bg-gray-50 dark:bg-gray-900/50"},qn={class:"max-w-md"},Kn={class:"w-20 h-20 bg-gray-100 dark:bg-gray-800 rounded-full flex items-center justify-center mx-auto mb-6"},Yn={class:"p-3 border-b dark:border-gray-800 flex justify-between items-center bg-white dark:bg-gray-900 shadow-sm z-10"},Xn={class:"flex items-center gap-3"},Zn={class:"flex items-center gap-3"},Qn={class:"grid grid-cols-2 gap-2 max-h-40 overflow-y-auto p-2 border rounded-xl dark:border-gray-800"},er=["onClick"],tr={class:"flex items-center gap-2 truncate min-w-0"},sr={class:"truncate"},lr={class:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity"},ar=["onClick"],or=["onClick"],nr={class:"flex-grow overflow-hidden relative"},rr={key:0,class:"absolute inset-0 flex flex-col md:flex-row overflow-hidden"},ir={class:"flex-grow overflow-y-auto p-6 md:p-10 custom-scrollbar bg-gray-50/30 dark:bg-transparent"},dr={key:0,class:"max-w-4xl mx-auto space-y-8 animate-in fade-in duration-300"},ur=["value"],cr={key:0},br={class:"flex flex-wrap gap-2"},pr=["onClick"],vr={class:"w-4 h-4 rounded-full bg-gray-300 overflow-hidden"},fr={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},gr=["value"],xr={class:"flex flex-col gap-4"},mr=["value"],kr={class:"bg-black rounded-2xl overflow-hidden aspect-video relative group shadow-lg border dark:border-gray-800"},yr={key:1,class:"w-full h-full flex items-center justify-center text-gray-600"},hr={class:"absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center"},wr={key:1,class:"absolute inset-0 p-10 bg-black flex items-center justify-center"},_r={class:"p-4 border-t dark:border-gray-800 bg-white dark:bg-gray-900 flex gap-4 shadow-2xl z-20"},$r={class:"relative flex-grow"},Cr={class:"flex items-center gap-2 px-2 border-l dark:border-gray-700 absolute right-1 top-1/2 -translate-y-1/2 bg-white dark:bg-gray-800 pl-2 h-8"},Sr=["disabled"],Ar={__name:"YoutubeVideoView",props:{notebook:{type:Object,required:!0}},setup(O){const u=O,b=Ne(),V=Le(),W=Re(),R=ct(),{tasks:$}=$e(W);E(()=>R.user);const N=p(null),A=p(0),k=p(""),S=p(null),C=p([]),K=p(!1),H=p(!1),D=p(!1),I=p(1),z=p({topic:"",num_scenes:5,target_duration:"2 minutes",style:"Documentary",platform:"YouTube (16:9)",selected_artefacts:[]}),ie=["Documentary","Vlog","Cinematic","Tutorial","News Report","Animation Script","Music Video"],se=["YouTube (16:9)","YouTube Shorts (9:16)","TikTok (9:16)","Instagram Reel (9:16)"],_=E(()=>$.value.find(o=>(o.name.includes(u.notebook.title)||o.description.includes(u.notebook.id))&&(o.status==="running"||o.status==="pending"))),c=E(()=>{var o;return(o=u.notebook.tabs)==null?void 0:o.find(l=>l.type==="youtube_script"||l.title==="Script")}),x=E(()=>{if(!c.value)return{scenes:[],metadata:{},personalities:[]};try{const o=JSON.parse(c.value.content);return o.personalities||(o.personalities=[]),o}catch{return{scenes:[],metadata:{},personalities:[]}}}),h=E(()=>{var o,l;return((o=u.notebook.tabs)==null?void 0:o.find(ee=>ee.id===N.value))||c.value||((l=u.notebook.tabs)==null?void 0:l[0])}),F=()=>{var o;if(((o=u.notebook.tabs)==null?void 0:o.length)>0&&(!N.value||!u.notebook.tabs.find(l=>l.id===N.value))){const l=u.notebook.tabs.find(ee=>ee.type==="youtube_script"||ee.title==="Script");N.value=l?l.id:u.notebook.tabs[0].id}};ne(()=>u.notebook.id,(o,l)=>{o!==l&&(N.value=null,F())},{immediate:!0}),ne(()=>u.notebook.tabs,F,{deep:!0}),ne(()=>{var o,l;return(l=(o=_.value)==null?void 0:o.logs)==null?void 0:l.length},()=>{Je(()=>{S.value&&(S.value.scrollTop=S.value.scrollHeight)})});function de(){z.value={topic:"",num_scenes:5,target_duration:"2 minutes",style:"Documentary",platform:"YouTube (16:9)",selected_artefacts:[...C.value]},I.value=1,D.value=!0}function y(o){const l=z.value.selected_artefacts.indexOf(o);l===-1?z.value.selected_artefacts.push(o):z.value.selected_artefacts.splice(l,1)}async function v(){D.value=!1;const o=JSON.stringify(z.value);await b.processWithAi(o,[],"generate_script",null,!1,z.value.selected_artefacts)}async function j(){if(!k.value.trim())return;let o=null;H.value&&c.value&&(o=c.value.id),await b.processWithAi(k.value,[],"generate_script",o,!1,C.value),k.value=""}async function g(){var l;const{confirmed:o}=await V.showConfirmation({title:"Render Video",message:"Generate visuals and synthesis audio?",confirmText:"Start"});o&&await b.processWithAi("Render full video",[(l=c.value)==null?void 0:l.id],"generate_animation")}async function X(o){c.value&&(c.value.content=JSON.stringify(o),await b.saveActive())}async function ue(){const o=JSON.parse(JSON.stringify(x.value));o.scenes.push({id:Math.random().toString(36).substr(2,9),title:`Scene ${o.scenes.length+1}`,content:"",visual_description:"",audio_script:""}),await X(o),A.value=o.scenes.length-1}async function Ie(o){const l=JSON.parse(JSON.stringify(x.value));l.scenes.splice(o,1),await X(l),A.value>=l.scenes.length&&(A.value=Math.max(0,l.scenes.length-1))}async function me(o,l){const ee=JSON.parse(JSON.stringify(x.value));ee.scenes[A.value]&&(ee.scenes[A.value][o]=l,await X(ee))}async function ke(){await b.processWithAi("Extract and generate characters",[c.value.id],"generate_personalities",c.value.id),K.value=!0}async function le(o){await b.processWithAi(o,[c.value.id],"regenerate_personality",c.value.id)}async function De(o){const l=JSON.parse(JSON.stringify(x.value));l.personalities.splice(o,1),await X(l)}async function Me(o,l){const ee=JSON.parse(JSON.stringify(x.value)),pe=ee.scenes[l];pe.selected_personalities||(pe.selected_personalities=[]);const ye=pe.selected_personalities.indexOf(o);ye===-1?pe.selected_personalities.push(o):pe.selected_personalities.splice(ye,1),await X(ee)}async function q(o){await b.processWithAi(`SCENE_INDEX:${o}`,[c.value.id],"generate_scene_image",c.value.id)}function te(o){V.openImageViewer({imageList:[{src:o}],startIndex:0})}return Oe(()=>{recognition&&isRecording.value&&recognition.stop()}),(o,l)=>{var ye;const ee=nt("IconEye"),pe=nt("IconPencil");return s(),a("div",Ho,[r(fe,{"enter-active-class":"transition ease-out duration-300","enter-from-class":"opacity-0","enter-to-class":"opacity-100","leave-active-class":"transition ease-in duration-200","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:ae(()=>[_.value?(s(),a("div",qo,[e("div",Ko,[e("div",Yo,[e("div",Xo,[e("div",Zo,[r(Ce,{class:"w-10 h-10 animate-spin text-white"})]),e("div",null,[e("h2",Qo,f(_.value.name),1),e("p",en,f(_.value.description),1)])]),e("div",tn,f(_.value.progress)+"%",1)]),e("div",sn,[e("div",{class:"h-full bg-blue-600 transition-all duration-500 progress-bar-animated",style:bt({width:_.value.progress+"%"})},null,4)]),e("div",ln,[l[21]||(l[21]=e("div",{class:"px-6 py-3 bg-gray-900 border-b border-gray-800 flex items-center justify-between"},[e("span",{class:"text-[10px] font-black uppercase text-gray-500 tracking-widest"},"Video Studio Terminal Output"),e("div",{class:"flex gap-1.5"},[e("div",{class:"w-2 h-2 rounded-full bg-red-500/50"}),e("div",{class:"w-2 h-2 rounded-full bg-yellow-500/50"}),e("div",{class:"w-2 h-2 rounded-full bg-green-500/50"})])],-1)),e("div",{ref_key:"logsContainerRef",ref:S,class:"flex-grow overflow-y-auto p-6 font-mono text-xs text-gray-400 space-y-1.5 custom-scrollbar"},[(s(!0),a(L,null,P(_.value.logs,(d,Z)=>(s(),a("div",{key:Z,class:"flex gap-4"},[e("span",an,"["+f(new Date(d.timestamp).toLocaleTimeString())+"]",1),e("span",{class:B({"text-red-400 font-bold":d.level==="ERROR","text-blue-400":d.level==="INFO","text-yellow-400":d.level==="WARNING"})},f(d.message),3)]))),128))],512)])])])):m("",!0)]),_:1}),r(fe,{"enter-active-class":"transition ease-out duration-200","enter-from-class":"opacity-0 translate-y-4","enter-to-class":"opacity-100 translate-y-0","leave-active-class":"transition ease-in duration-150","leave-from-class":"opacity-100 translate-y-0","leave-to-class":"opacity-0 translate-y-4"},{default:ae(()=>[D.value?(s(),a("div",{key:0,class:"fixed inset-0 z-[100] bg-gray-900/60 backdrop-blur-sm p-6 flex items-center justify-center",onClick:l[9]||(l[9]=oe(d=>D.value=!1,["self"]))},[e("div",on,[e("div",nn,[e("h3",rn,[r(Ae,{class:"w-4 h-4"}),l[22]||(l[22]=Q(" New Video Project"))]),e("button",{onClick:l[0]||(l[0]=d=>D.value=!1),class:"btn-icon-flat"},[r(ge,{class:"w-5 h-5"})])]),e("div",dn,[I.value===1?(s(),a("div",un,[e("div",null,[l[23]||(l[23]=e("label",{class:"text-[10px] font-black uppercase text-blue-500 mb-2 block tracking-widest"},"1. Video Concept",-1)),G(e("textarea",{"onUpdate:modelValue":l[1]||(l[1]=d=>z.value.topic=d),class:"input-field w-full h-32 font-bold text-lg p-4",placeholder:"What is this video about? (e.g. A documentary about Mars colonization...)"},null,512),[[Y,z.value.topic]])]),e("div",null,[l[24]||(l[24]=e("label",{class:"text-[10px] font-black uppercase text-gray-500 mb-2 block tracking-widest"},"2. Research Sources",-1)),e("div",cn,[(s(!0),a(L,null,P(O.notebook.artefacts,d=>(s(),a("button",{key:d.filename,onClick:Z=>y(d.filename),class:B(["p-2 rounded-lg text-[10px] flex items-center gap-2 text-left transition-all border",z.value.selected_artefacts.includes(d.filename)?"bg-green-50 border-green-500 text-green-700":"border-transparent hover:bg-gray-50 text-gray-500"])},[z.value.selected_artefacts.includes(d.filename)?(s(),U(ze,{key:0,class:"w-3 h-3 flex-shrink-0"})):(s(),U(_e,{key:1,class:"w-3 h-3 opacity-30 flex-shrink-0"})),e("span",pn,f(d.filename),1)],10,bn))),128))])])])):m("",!0),I.value===2?(s(),a("div",vn,[l[29]||(l[29]=e("label",{class:"text-[10px] font-black uppercase text-blue-500 mb-4 block tracking-widest"},"3. Configuration",-1)),e("div",fn,[e("div",null,[l[25]||(l[25]=e("label",{class:"label mb-2"},"Style / Genre",-1)),G(e("select",{"onUpdate:modelValue":l[2]||(l[2]=d=>z.value.style=d),class:"input-field w-full"},[(s(),a(L,null,P(ie,d=>e("option",{key:d,value:d},f(d),9,gn)),64))],512),[[at,z.value.style]])]),e("div",null,[l[26]||(l[26]=e("label",{class:"label mb-2"},"Platform / Format",-1)),G(e("select",{"onUpdate:modelValue":l[3]||(l[3]=d=>z.value.platform=d),class:"input-field w-full"},[(s(),a(L,null,P(se,d=>e("option",{key:d,value:d},f(d),9,xn)),64))],512),[[at,z.value.platform]])]),e("div",null,[l[27]||(l[27]=e("label",{class:"label mb-2"},"Target Duration",-1)),G(e("input",{"onUpdate:modelValue":l[4]||(l[4]=d=>z.value.target_duration=d),class:"input-field w-full",placeholder:"e.g. 5 minutes"},null,512),[[Y,z.value.target_duration]])]),e("div",null,[l[28]||(l[28]=e("label",{class:"label mb-2"},"Approx. Scene Count",-1)),G(e("input",{type:"number","onUpdate:modelValue":l[5]||(l[5]=d=>z.value.num_scenes=d),class:"input-field w-full",min:"1",max:"50"},null,512),[[Y,z.value.num_scenes,void 0,{number:!0}]])])])])):m("",!0)]),e("div",mn,[I.value>1?(s(),a("button",{key:0,onClick:l[6]||(l[6]=d=>I.value--),class:"btn btn-secondary"},"Back")):(s(),a("div",kn)),e("div",yn,[e("button",{onClick:l[7]||(l[7]=d=>D.value=!1),class:"btn btn-secondary"},"Cancel"),I.value===1?(s(),a("button",{key:0,onClick:l[8]||(l[8]=d=>I.value=2),class:"btn btn-primary",disabled:!z.value.topic},"Next",8,hn)):m("",!0),I.value===2?(s(),a("button",{key:1,onClick:v,class:"btn btn-primary"},"Generate Script")):m("",!0)])])])])):m("",!0)]),_:1}),e("div",wn,[e("div",_n,[l[30]||(l[30]=e("span",null,"Video Studio",-1)),e("div",$n,[e("button",{onClick:l[10]||(l[10]=d=>K.value=!K.value),class:"text-blue-500 hover:text-blue-600",title:"Toggle Personalities"},[r(ot,{class:"w-4 h-4"})]),e("button",{onClick:ue,class:"text-blue-500 hover:text-blue-600",title:"Add Scene"},[r(Ae,{class:"w-4 h-4"})])])]),e("div",Cn,[K.value?(s(),a("div",Sn,[e("div",An,[l[31]||(l[31]=e("span",{class:"text-xs font-bold text-blue-700 dark:text-blue-300"},"Cast & Characters",-1)),e("button",{onClick:ke,class:"p-1 bg-blue-100 dark:bg-blue-800 text-blue-600 dark:text-blue-200 rounded hover:bg-blue-200 transition-colors",title:"Auto-generate from Script"},[r(re,{class:"w-3 h-3"})])]),x.value.personalities.length===0?(s(),a("div",In," No characters yet. ")):m("",!0),e("div",Tn,[(s(!0),a(L,null,P(x.value.personalities,(d,Z)=>(s(),a("div",{key:d.id,class:"flex items-center gap-2 bg-white dark:bg-gray-800 p-2 rounded-lg shadow-sm"},[e("div",{class:"w-8 h-8 rounded-full bg-gray-200 dark:bg-gray-700 flex-shrink-0 overflow-hidden cursor-pointer border border-gray-200 dark:border-gray-600",onClick:ve=>te(d.image_path)},[d.image_path?(s(),U(he,{key:0,src:d.image_path,class:"w-full h-full object-cover"},null,8,["src"])):(s(),U(ot,{key:1,class:"w-4 h-4 m-2 text-gray-400"}))],8,Vn),e("div",jn,[e("p",Nn,f(d.name),1)]),e("div",Ln,[e("button",{onClick:ve=>le(d.id),class:"text-gray-400 hover:text-blue-500"},[r(pt,{class:"w-3 h-3"})],8,Rn),e("button",{onClick:ve=>De(Z),class:"text-gray-400 hover:text-red-500"},[r(ge,{class:"w-3 h-3"})],8,Un)])]))),128))])])):m("",!0),c.value?(s(),a("div",{key:1,onClick:l[11]||(l[11]=d=>N.value=c.value.id),class:B(["p-3 rounded-xl border-2 cursor-pointer transition-all shadow-sm",N.value===c.value.id?"border-red-500 bg-red-50 dark:bg-red-900/10":"border-transparent bg-gray-50 dark:bg-gray-800 hover:border-gray-300"])},[e("div",zn,[r(_e,{class:"w-4 h-4"}),l[32]||(l[32]=Q()),l[33]||(l[33]=e("span",{class:"font-bold text-xs uppercase"},"Master Script",-1))]),e("p",On,f(x.value.scenes.length)+" Scenes",1)],2)):m("",!0),N.value===((ye=c.value)==null?void 0:ye.id)?(s(),a("div",Dn,[(s(!0),a(L,null,P(x.value.scenes,(d,Z)=>(s(),a("div",{key:Z,onClick:ve=>A.value=Z,class:B(["group flex items-center justify-between p-2 rounded-lg cursor-pointer text-sm transition-all",A.value===Z?"bg-gray-200 dark:bg-gray-700 font-bold text-gray-900 dark:text-white":"text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-800"])},[e("div",Pn,[e("span",En,f(Z+1),1),e("span",Gn,f(d.title),1)]),e("button",{onClick:oe(ve=>Ie(Z),["stop"]),class:"opacity-0 group-hover:opacity-100 hover:text-red-500 p-1"},[r(we,{class:"w-3.5 h-3.5"})],8,Bn)],10,Mn))),128))])):m("",!0)]),e("div",Wn,[e("button",{onClick:g,class:"btn btn-primary w-full",disabled:_.value||!c.value},[r(He,{class:"w-4 h-4 mr-2"}),l[34]||(l[34]=Q(" Render Video"))],8,Fn)])]),e("div",Jn,[x.value.scenes.length===0?(s(),a("div",Hn,[e("div",qn,[e("div",Kn,[r(He,{class:"w-10 h-10 text-gray-400"})]),l[36]||(l[36]=e("h2",{class:"text-2xl font-bold text-gray-800 dark:text-white mb-3"},"Start Your Video Production",-1)),l[37]||(l[37]=e("p",{class:"text-gray-500 dark:text-gray-400 mb-8"},"Use the wizard to generate a professional script and storyboard from your topic or documents.",-1)),e("button",{onClick:de,class:"btn btn-primary px-8 py-3 text-lg shadow-xl hover:shadow-blue-500/20 transition-all"},[r(re,{class:"w-5 h-5 mr-2"}),l[35]||(l[35]=Q(" Open Video Wizard "))])])])):h.value?(s(),a(L,{key:1},[e("div",Yn,[e("div",Xn,[G(e("input",{"onUpdate:modelValue":l[12]||(l[12]=d=>h.value.title=d),onBlur:l[13]||(l[13]=(...d)=>J(b).saveActive&&J(b).saveActive(...d)),class:"font-black text-lg bg-transparent border-none focus:ring-0 text-gray-800 dark:text-white p-0"},null,544),[[Y,h.value.title]])]),e("div",Zn,[e("button",{onClick:l[14]||(l[14]=(...d)=>J(b).saveActive&&J(b).saveActive(...d)),class:"btn btn-secondary btn-sm"},[r(qe,{class:"w-4 h-4 mr-2"}),l[38]||(l[38]=Q(" Save"))])])]),e("div",Qn,[(s(!0),a(L,null,P(O.notebook.artefacts,d=>(s(),a("div",{key:d.filename,class:B(["group p-2 rounded-lg text-[10px] flex items-center justify-between gap-2 transition-all border cursor-pointer",z.value.selected_artefacts.includes(d.filename)?"bg-green-50 border-green-500 text-green-700":"border-transparent hover:bg-gray-50 dark:hover:bg-gray-800 text-gray-500"]),onClick:Z=>y(d.filename)},[e("div",tr,[z.value.selected_artefacts.includes(d.filename)?(s(),U(ze,{key:0,class:"w-3 h-3 flex-shrink-0"})):(s(),U(_e,{key:1,class:"w-3 h-3 opacity-30 flex-shrink-0"})),e("span",sr,f(d.filename),1)]),e("div",lr,[e("button",{onClick:oe(Z=>o.viewArtefact(d),["stop"]),class:"p-1 hover:text-blue-500",title:"View"},[r(ee,{class:"w-3 h-3"})],8,ar),e("button",{onClick:oe(Z=>o.openArtefactEditor(d),["stop"]),class:"p-1 hover:text-blue-500",title:"Edit"},[r(pe,{class:"w-3 h-3"})],8,or)])],10,er))),128))]),e("div",nr,[h.value.type==="youtube_script"?(s(),a("div",rr,[e("div",ir,[x.value.scenes[A.value]?(s(),a("div",dr,[e("div",null,[l[39]||(l[39]=e("label",{class:"text-[10px] font-black uppercase text-gray-400 mb-2 block"},"Scene Title",-1)),e("input",{value:x.value.scenes[A.value].title,onInput:l[15]||(l[15]=d=>me("title",d.target.value)),class:"w-full bg-transparent border-b-2 border-gray-200 dark:border-gray-800 focus:border-red-500 transition-colors py-2 text-2xl font-black outline-none dark:text-white"},null,40,ur)]),x.value.personalities.length>0?(s(),a("div",cr,[l[40]||(l[40]=e("label",{class:"text-[10px] font-black uppercase text-gray-400 mb-2 block"},"Scene Cast",-1)),e("div",br,[(s(!0),a(L,null,P(x.value.personalities,d=>(s(),a("button",{key:d.id,onClick:Z=>Me(d.id,A.value),class:B(["flex items-center gap-2 px-3 py-1.5 rounded-full border transition-all text-xs font-bold",(x.value.scenes[A.value].selected_personalities||[]).includes(d.id)?"bg-blue-100 border-blue-500 text-blue-700 dark:bg-blue-900/40 dark:text-blue-300":"bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700 text-gray-500 hover:border-blue-300"])},[e("div",vr,[d.image_path?(s(),U(he,{key:0,src:d.image_path,class:"w-full h-full object-cover"},null,8,["src"])):m("",!0)]),Q(" "+f(d.name),1)],10,pr))),128))])])):m("",!0),e("div",fr,[e("div",null,[l[41]||(l[41]=e("label",{class:"text-[10px] font-black uppercase text-gray-400 mb-3 block"},"Narration",-1)),e("textarea",{value:x.value.scenes[A.value].audio_script,onInput:l[16]||(l[16]=d=>me("audio_script",d.target.value)),class:"w-full bg-white dark:bg-gray-900 border dark:border-gray-800 rounded-2xl p-5 min-h-[200px] text-lg leading-relaxed dark:text-gray-200 shadow-sm",placeholder:"Narration script..."},null,40,gr)]),e("div",xr,[e("div",null,[l[42]||(l[42]=e("label",{class:"text-[10px] font-black uppercase text-gray-400 mb-3 block"},"Visual Direction",-1)),e("textarea",{value:x.value.scenes[A.value].visual_description,onInput:l[17]||(l[17]=d=>me("visual_description",d.target.value)),class:"w-full bg-blue-50/50 dark:bg-blue-900/10 border border-blue-100 dark:border-blue-900/20 rounded-2xl p-5 text-sm italic dark:text-gray-300 min-h-[100px]",placeholder:"Visual Prompt..."},null,40,mr)]),e("div",kr,[x.value.scenes[A.value].image_path?(s(),U(he,{key:0,src:x.value.scenes[A.value].image_path,class:"w-full h-full object-contain"},null,8,["src"])):(s(),a("div",yr,[r(vt,{class:"w-12 h-12 opacity-20"})])),e("div",hr,[e("button",{onClick:l[18]||(l[18]=d=>q(A.value)),class:"btn btn-primary shadow-xl"},[r(re,{class:"w-4 h-4 mr-2"}),Q(" "+f(x.value.scenes[A.value].image_path?"Regenerate":"Generate Visual"),1)])])])])])])):m("",!0)])])):h.value.type==="video"?(s(),a("div",wr,[r(ft,{src:h.value.content},null,8,["src"])])):m("",!0)])],64)):m("",!0)]),e("div",_r,[e("div",$r,[G(e("input",{"onUpdate:modelValue":l[19]||(l[19]=d=>k.value=d),onKeyup:je(j,["enter"]),placeholder:"Quickly modify script or scene...",class:"input-field w-full pr-32"},null,544),[[Y,k.value]]),e("div",Cr,[G(e("input",{type:"checkbox",id:"mod-tab","onUpdate:modelValue":l[20]||(l[20]=d=>H.value=d),class:"h-3 w-3 rounded text-blue-600 focus:ring-blue-500 cursor-pointer"},null,512),[[Ye,H.value]]),l[43]||(l[43]=e("label",{for:"mod-tab",class:"text-[9px] font-black uppercase text-gray-400 cursor-pointer select-none whitespace-nowrap"},"Update Active",-1))])]),e("button",{onClick:j,class:"btn btn-primary px-8 h-12 rounded-2xl",disabled:!k.value.trim()||_.value},[r(re,{class:"w-4 h-4 mr-2"}),l[44]||(l[44]=Q(" Go"))],8,Sr)])])}}},Ir=xe(Ar,[["__scopeId","data-v-4df2662f"]]),Tr={class:"flex-grow h-full w-full flex flex-col overflow-hidden bg-white dark:bg-gray-900 relative"},Vr={key:0,class:"absolute inset-0 flex flex-col items-center justify-center bg-white/80 dark:bg-gray-900/80 z-50 backdrop-blur-sm"},jr={key:1,class:"flex-grow h-full w-full overflow-hidden"},Nr={key:2,class:"flex-grow h-full flex flex-col items-center justify-center text-center p-12"},Lr={class:"max-w-md"},Rr={class:"w-20 h-20 bg-gray-100 dark:bg-gray-800 rounded-3xl flex items-center justify-center mx-auto mb-6 shadow-inner"},Mr={__name:"NotebookStudioView",setup(O){const u=Ne(),b=Le(),V=Re(),W=Ht(),{activeNotebook:R,isLoading:$}=$e(u),{tasks:N}=$e(V),A=E(()=>{if(!R.value)return null;const S=R.value.type||"generic";return S==="slides_making"?ko:S==="book_building"?Jo:S==="youtube_video"?Ir:Bs}),k=async()=>{const S=W.params.id;S?await u.selectNotebook(S):u.setActiveNotebook(null)};return ne(N,(S,C)=>{if(!R.value||!C)return;const K=R.value.id||R.value._id,H=S.find(D=>(D.description===K||D.name&&D.name.includes(R.value.title))&&(D.status==="finished"||D.status==="failed")&&C.some(I=>I.id===D.id&&(I.status==="running"||I.status==="pending")));H&&(console.log(`[NotebookStudio] Task ${H.name} ended. Refreshing content...`),u.selectNotebook(K))},{deep:!0}),ne(()=>W.params.id,k,{immediate:!0}),Xe(()=>{u.fetchNotebooks()}),(S,C)=>(s(),a("div",Tr,[J($)&&!J(R)?(s(),a("div",Vr,[r(Ce,{class:"w-10 h-10 text-blue-500 animate-spin mb-4"}),C[1]||(C[1]=e("p",{class:"text-[10px] font-black uppercase tracking-widest text-gray-400"},"Syncing Production...",-1))])):m("",!0),J(R)?(s(),a("div",jr,[(s(),U(ut(A.value),{notebook:J(R),key:J(R).id||J(R)._id},null,8,["notebook"]))])):J($)?m("",!0):(s(),a("div",Nr,[e("div",Lr,[e("div",Rr,[r(Jt,{class:"w-10 h-10 text-gray-300"})]),C[3]||(C[3]=e("h2",{class:"text-xl font-black text-gray-800 dark:text-white uppercase mb-2"},"Notebook Studio",-1)),C[4]||(C[4]=e("p",{class:"text-sm text-gray-500 mb-8"},"Select a production from the sidebar or start a new one to begin.",-1)),e("button",{onClick:C[0]||(C[0]=K=>J(b).openModal("notebookWizard")),class:"btn btn-primary px-8 py-3 rounded-2xl shadow-xl"},[r(Ae,{class:"w-4 h-4 mr-2"}),C[2]||(C[2]=Q(" New Production "))])])]))]))}};export{Mr as default};
