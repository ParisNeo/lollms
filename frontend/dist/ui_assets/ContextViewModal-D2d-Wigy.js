import{Z as B,u as N,a8 as O,an as R,L as M,c as g,a as y,o,w as C,b as e,m as F,aB as L,at as Z,t as r,d as S,e as n,am as P,J as U,F as _,n as b,f as c,l as T,aw as k,aq as q,X as A,C as E,O as J}from"./index-IMwO7oGA.js";import{_ as W}from"./GenericModal-D7D7fv2K.js";const X={key:0,class:"space-y-6"},G={class:"flex justify-between items-center mb-1 text-sm font-mono text-gray-700 dark:text-gray-300"},H={class:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-4 relative overflow-hidden"},Q={class:"space-y-4"},Y={class:"flex items-center justify-between p-3 cursor-pointer select-none"},K={class:"flex items-center gap-3"},D={class:"font-semibold text-gray-800 dark:text-gray-200"},z={key:0,class:"text-xs text-gray-500"},ee={class:"font-mono text-sm text-gray-600 dark:text-gray-400"},se={class:"p-4 border-t dark:border-gray-700 space-y-3"},te={class:"flex items-center justify-between p-2 cursor-pointer select-none"},oe={class:"flex items-center gap-2"},ae={class:"text-sm font-medium"},re={class:"font-mono text-xs text-gray-500 dark:text-gray-400"},ne={class:"p-2 border-t dark:border-gray-600"},ie={class:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm"},le={class:"p-3 bg-white dark:bg-gray-800 border dark:border-gray-600 rounded-md flex items-center gap-3"},de={class:"font-mono text-gray-600 dark:text-gray-400"},ce={class:"p-3 bg-white dark:bg-gray-800 border dark:border-gray-600 rounded-md flex items-center gap-3"},ue={class:"font-mono text-gray-600 dark:text-gray-400"},me={key:0,class:"bg-white dark:bg-gray-800 border dark:border-gray-600 rounded-md"},ge={class:"flex items-center justify-between p-2 cursor-pointer select-none"},xe={class:"flex items-center gap-2"},_e={class:"p-2 border-t dark:border-gray-600 max-h-60 overflow-y-auto"},fe={class:"text-xs font-mono divide-y dark:divide-gray-700"},ye={class:"font-semibold"},be={key:2,class:"flex items-start gap-3 p-3 bg-white dark:bg-gray-800 border dark:border-gray-600 rounded-md"},ke={key:1,class:"text-center py-10"},he={class:"flex justify-between items-center w-full"},ve=["disabled"],pe={__name:"ContextViewModal",setup(we){const j=N(),x=O(),{activeDiscussionContextStatus:m}=R(x),u=M(!1),h=t=>t.replace(/_/g," ").replace(/\b\w/g,s=>s.toUpperCase()),d=t=>t?t.toLocaleString():"0",v=g(()=>{var t;return((t=m.value)==null?void 0:t.current_tokens)||0}),f=g(()=>{var t;return((t=m.value)==null?void 0:t.max_tokens)||1}),p=g(()=>f.value<=0?0:v.value/f.value*100),I=g(()=>{const t=p.value;return t>=90?"bg-red-500":t>=75?"bg-yellow-500":"bg-blue-500"}),V=g(()=>{var l;if(!((l=m.value)!=null&&l.zones))return[];const t=Object.entries(m.value.zones),s=["system_context","message_history"];return t.sort(([a],[i])=>s.indexOf(a)-s.indexOf(i))});async function $(){if(x.activeDiscussion&&!u.value){u.value=!0;try{await x.fetchContextStatus(x.activeDiscussion.id)}finally{u.value=!1}}}return(t,s)=>(o(),y(W,{"modal-name":"contextViewer",title:"Context Breakdown",maxWidthClass:"max-w-4xl"},{body:C(()=>[S(m)?(o(),n("div",X,[e("div",null,[e("div",G,[s[1]||(s[1]=e("span",null,"Total Tokens",-1)),e("span",null,r(d(v.value))+" / "+r(d(f.value)),1)]),e("div",H,[e("div",{class:U(["h-full rounded-full transition-all duration-300",I.value]),style:P({width:`${Math.min(p.value,100)}%`})},null,6)])]),e("div",Q,[(o(!0),n(_,null,b(V.value,([l,a])=>(o(),n("details",{key:l,class:"bg-gray-50 dark:bg-gray-800/50 border dark:border-gray-700 rounded-lg",open:""},[e("summary",Y,[e("div",K,[c(k,{class:"w-5 h-5 text-gray-500 transition-transform details-arrow"}),e("h3",D,r(h(l)),1),a.message_count?(o(),n("span",z,"("+r(a.message_count)+" messages)",1)):T("",!0)]),e("span",ee,r(d(a.tokens))+" tokens",1)]),e("div",se,[l==="system_context"&&typeof a.breakdown=="object"&&a.breakdown?(o(!0),n(_,{key:0},b(Object.entries(a.breakdown),([i,w])=>(o(),n("details",{key:i,class:"bg-white dark:bg-gray-800 border dark:border-gray-600 rounded-md"},[e("summary",te,[e("div",oe,[c(k,{class:"w-4 h-4 text-gray-400 transition-transform details-arrow"}),e("h4",ae,r(h(i)),1)]),e("span",re,r(d(w.tokens))+" tokens",1)]),e("div",ne,[c(q,{"model-value":w.content,options:{readOnly:!0},class:"text-xs max-h-60"},null,8,["model-value"])])]))),128)):l==="message_history"&&a.breakdown?(o(),n(_,{key:1},[e("div",ie,[e("div",le,[c(A,{class:"w-6 h-6 text-blue-500 flex-shrink-0"}),e("div",null,[s[2]||(s[2]=e("div",{class:"font-semibold"},"Text Tokens",-1)),e("div",de,r(d(a.breakdown.text_tokens)),1)])]),e("div",ce,[c(E,{class:"w-6 h-6 text-green-500 flex-shrink-0"}),e("div",null,[s[3]||(s[3]=e("div",{class:"font-semibold"},"Image Tokens",-1)),e("div",ue,r(d(a.breakdown.image_tokens)),1)])])]),a.breakdown.image_details&&a.breakdown.image_details.length>0?(o(),n("details",me,[e("summary",ge,[e("div",xe,[c(k,{class:"w-4 h-4 text-gray-400 transition-transform details-arrow"}),s[4]||(s[4]=e("h4",{class:"text-sm font-medium"},"Image Details",-1))])]),e("div",_e,[e("ul",fe,[(o(!0),n(_,null,b(a.breakdown.image_details,i=>(o(),n("li",{key:`${i.message_id}-${i.index}`,class:"py-1.5 flex justify-between items-center"},[e("span",null,"Msg: "+r(i.message_id.substring(0,8))+"... (Img #"+r(i.index+1)+")",1),e("span",ye,r(d(i.tokens))+" tokens",1)]))),128))])])])):T("",!0)],64)):(o(),n("div",be,[c(J,{class:"w-5 h-5 mt-0.5 text-gray-500 flex-shrink-0"}),s[5]||(s[5]=e("p",{class:"text-sm text-gray-700 dark:text-gray-300"},"This zone contains the full text content, which is used for context but has no further breakdown available.",-1))]))])]))),128))])])):(o(),n("div",ke,s[6]||(s[6]=[e("p",{class:"text-gray-500"},"Context information is not available.",-1)])))]),footer:C(()=>[e("div",he,[e("button",{onClick:$,class:"btn btn-secondary",disabled:u.value},[u.value?(o(),y(L,{key:0,class:"w-4 h-4 mr-2"})):(o(),y(Z,{key:1,class:"w-4 h-4 mr-2"})),F(" "+r(u.value?"Refreshing...":"Refresh"),1)],8,ve),e("button",{onClick:s[0]||(s[0]=l=>S(j).closeModal("contextViewer")),class:"btn btn-primary"},"Close")])]),_:1}))}},Te=B(pe,[["__scopeId","data-v-61629172"]]);export{Te as default};
