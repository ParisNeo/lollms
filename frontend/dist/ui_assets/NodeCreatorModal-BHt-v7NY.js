import{b1 as ee,u as te,dW as oe,dX as j,r as p,b as O,d as se,c as i,o as a,a as t,h as w,t as b,g as d,G as f,M,n as I,aw as le,m as ae,J as n,K as c,L as D,F as _,j as C,H as E,X as $,ak as G,i as ne,ae as ie,aB as J,aJ as B,f as re,au as F,av as de}from"./index-BzYhVBtc.js";import{json as ue}from"./index-bKEl5d9f.js";const pe={class:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm p-4"},ce={class:"bg-white dark:bg-gray-900 rounded-xl shadow-2xl w-full max-w-7xl h-[90vh] flex flex-col border dark:border-gray-700 overflow-hidden animate-in fade-in zoom-in-95 duration-200"},ve={class:"p-4 border-b dark:border-gray-700 flex justify-between items-center bg-gray-50 dark:bg-gray-800/80"},fe={class:"flex items-center gap-3"},ge={class:"text-xl font-bold text-gray-800 dark:text-gray-100"},be={key:0,class:"flex items-center gap-2 text-xs text-blue-500 font-medium bg-blue-50 dark:bg-blue-900/30 px-2 py-1 rounded-full"},xe={class:"flex items-center gap-2"},me={class:"flex-grow flex min-h-0 relative"},ye={class:"w-full md:w-1/3 flex flex-col border-r dark:border-gray-700 bg-gray-50/50 dark:bg-gray-900/50"},we={class:"p-4 flex-grow overflow-y-auto custom-scrollbar space-y-6"},ke={class:"space-y-3"},he={class:"grid grid-cols-1 gap-3"},_e=["disabled"],Ce={class:"flex gap-1"},Ne=["value"],Ve={class:"space-y-2"},Ue={class:"flex justify-between items-center border-b dark:border-gray-700 pb-1"},Te={class:"space-y-1"},qe=["onUpdate:modelValue"],Se=["onClick"],Ie={class:"space-y-2"},De={class:"flex justify-between items-center border-b dark:border-gray-700 pb-1"},Ee={class:"space-y-2"},$e=["onUpdate:modelValue"],Ae=["onUpdate:modelValue"],je=["onClick"],Oe={class:"space-y-2"},Me={class:"flex justify-between items-center border-b dark:border-gray-700 pb-1"},Ge={class:"space-y-2"},Je=["onUpdate:modelValue"],Be=["onUpdate:modelValue"],Fe=["onClick"],Le={class:"w-full md:w-2/3 flex flex-col h-full bg-gray-900 text-gray-200 relative"},Re={class:"flex-shrink-0 p-2 bg-gray-800 border-b border-gray-700 flex justify-between items-center"},We={class:"flex items-center gap-2"},ze={key:0,class:"flex items-center gap-2"},Ke=["disabled"],He={class:"flex-grow relative flex flex-col min-h-0"},Pe={class:"flex-grow flex flex-col p-4 space-y-4 bg-gray-900 overflow-y-auto"},Xe={class:"grid grid-cols-2 gap-4 h-1/2 min-h-[200px]"},Qe={class:"flex flex-col"},Ye={class:"flex flex-col"},Ze={class:"flex-grow border border-gray-700 rounded bg-black/50 p-2 font-mono text-xs overflow-auto text-green-400 whitespace-pre-wrap"},et={class:"flex justify-end pt-2 border-t border-gray-800"},tt={key:0,class:"text-xs text-red-400 font-mono flex-grow pr-4"},ot=["disabled"],st={class:"p-4 border-t dark:border-gray-700 flex justify-end gap-3 bg-gray-50 dark:bg-gray-800 rounded-b-lg"},nt={__name:"NodeCreatorModal",props:{nodeToEdit:{type:Object,default:null}},emits:["close"],setup(L,{emit:R}){const N=L,W=R,k=ee(),V=te(),z=[oe(),j],K=[ue(),j],v=p("code"),U=p(!1),x=p(!1),g=p(!1),m=p(""),T=p(`{
  "input": "test"
}`),q=p(""),y=p(""),S=p(""),o=p({id:null,name:"",label:"",category:"General",description:"",color:"bg-indigo-100 border-indigo-500",inputs:[{name:"input",type:"string"}],outputs:[{name:"output",type:"string"}],requirements:[],code:`class CustomNode:
    def execute(self, inputs, context):
        return {"output": inputs.get("input")}`}),h=O(()=>!!N.nodeToEdit),H=O(()=>{const l=new Set(k.nodeDefinitions.map(e=>e.category));return l.add("General"),l.add("AI Generation"),l.add("Video Generation"),l.add("Audio Effects"),l.add("Image Effects"),l.add("Transformers"),l.add("Logic"),Array.from(l).sort()});se(()=>{N.nodeToEdit&&(o.value=JSON.parse(JSON.stringify(N.nodeToEdit)),o.value.requirements||(o.value.requirements=[]))});function P(){o.value.requirements.push("")}function X(){o.value.inputs.push({name:"new_input",type:"string"})}function Q(){o.value.outputs.push({name:"new_output",type:"string"})}async function A(){if(!(!m.value.trim()||x.value)){x.value=!0;try{const e=(await F.post("/api/flows/generate_code",{prompt:m.value})).data;e&&(o.value.name=e.name||o.value.name,o.value.label=e.label||o.value.label,o.value.category=e.category||o.value.category,o.value.description=e.description||o.value.description,e.color&&(o.value.color=e.color),e.inputs&&(o.value.inputs=e.inputs),e.outputs&&(o.value.outputs=e.outputs),e.requirements&&(o.value.requirements=e.requirements),await de(),e.code&&(o.value.code=e.code),V.addNotification("Node designed!","success"),m.value="")}catch{V.addNotification("Failed to design node.","error")}finally{x.value=!1}}}async function Y(){if(!g.value){g.value=!0,y.value="",q.value="";try{const l=JSON.parse(T.value),e=await F.post("/api/flows/test_code",{code:o.value.code,inputs:l,requirements:o.value.requirements});e.data.status==="success"?q.value=JSON.stringify(e.data.output,null,2):y.value=e.data.error}catch{y.value="Test failed."}finally{g.value=!1}}}async function Z(){if(!o.value.name||!o.value.code)return V.addNotification("Missing required fields","warning");o.value.category==="NEW_CAT"&&(o.value.category=S.value||"General"),(h.value?await k.updateNodeDefinition(o.value.id,o.value):await k.createNodeDefinition(o.value))&&(await k.fetchNodeDefinitions(),W("close"))}return(l,e)=>(a(),i("div",pe,[t("div",ce,[t("div",ve,[t("div",fe,[t("h3",ge,b(h.value?"Edit Node":"Create Node"),1),x.value?(a(),i("div",be,[d(M,{class:"w-3.5 h-3.5 animate-spin"}),e[14]||(e[14]=f(" Designing node... "))])):w("",!0)]),t("div",xe,[t("button",{onClick:e[0]||(e[0]=s=>U.value=!U.value),class:I(["btn btn-secondary btn-sm",{"bg-blue-100 text-blue-600":U.value}])},[d(le,{class:"w-4 h-4 mr-1"}),e[15]||(e[15]=f(" API Docs "))],2),t("button",{onClick:e[1]||(e[1]=s=>l.$emit("close")),class:"text-gray-400 hover:text-red-500 transition-colors p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full"},[d(ae,{class:"w-6 h-6"})])])]),t("div",me,[t("div",ye,[t("div",we,[t("div",ke,[e[22]||(e[22]=t("h4",{class:"text-xs font-black uppercase text-gray-400 tracking-widest border-b dark:border-gray-700 pb-1"},"Metadata",-1)),t("div",he,[t("div",null,[e[16]||(e[16]=t("label",{class:"block text-[10px] font-bold uppercase text-gray-500 mb-1"},"ID (Internal)",-1)),n(t("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>o.value.name=s),class:"input-field w-full text-xs font-mono",placeholder:"unique_node_id",disabled:h.value},null,8,_e),[[c,o.value.name]])]),t("div",null,[e[17]||(e[17]=t("label",{class:"block text-[10px] font-bold uppercase text-gray-500 mb-1"},"Label (Display)",-1)),n(t("input",{"onUpdate:modelValue":e[3]||(e[3]=s=>o.value.label=s),class:"input-field w-full text-xs",placeholder:"My Custom Node"},null,512),[[c,o.value.label]])]),t("div",null,[e[19]||(e[19]=t("label",{class:"block text-[10px] font-bold uppercase text-gray-500 mb-1"},"Category (Group)",-1)),t("div",Ce,[n(t("select",{"onUpdate:modelValue":e[4]||(e[4]=s=>o.value.category=s),class:"input-field w-full text-xs"},[(a(!0),i(_,null,C(H.value,s=>(a(),i("option",{key:s,value:s},b(s),9,Ne))),128)),e[18]||(e[18]=t("option",{value:"NEW_CAT"},"+ New Category",-1))],512),[[D,o.value.category]]),o.value.category==="NEW_CAT"?n((a(),i("input",{key:0,"onUpdate:modelValue":e[5]||(e[5]=s=>S.value=s),class:"input-field w-full text-xs",placeholder:"Category name..."},null,512)),[[c,S.value]]):w("",!0)])]),t("div",null,[e[20]||(e[20]=t("label",{class:"block text-[10px] font-bold uppercase text-gray-500 mb-1"},"Color (Tailwind)",-1)),n(t("input",{"onUpdate:modelValue":e[6]||(e[6]=s=>o.value.color=s),class:"input-field w-full text-xs font-mono",placeholder:"bg-blue-100 border-blue-500"},null,512),[[c,o.value.color]])]),t("div",null,[e[21]||(e[21]=t("label",{class:"block text-[10px] font-bold uppercase text-gray-500 mb-1"},"Description",-1)),n(t("textarea",{"onUpdate:modelValue":e[7]||(e[7]=s=>o.value.description=s),class:"input-field w-full text-xs h-16 resize-none",placeholder:"What does this node do?"},null,512),[[c,o.value.description]])])])]),t("div",Ve,[t("div",Ue,[e[24]||(e[24]=t("h4",{class:"text-xs font-black uppercase text-gray-400 tracking-widest"},"Library Dependencies",-1)),t("button",{onClick:P,class:"text-orange-500 hover:text-orange-600 text-xs font-bold flex items-center gap-1"},[d(E,{class:"w-3 h-3"}),e[23]||(e[23]=f(" Add"))])]),t("div",Te,[(a(!0),i(_,null,C(o.value.requirements,(s,u)=>(a(),i("div",{key:"req"+u,class:"flex gap-1 items-center"},[n(t("input",{"onUpdate:modelValue":r=>o.value.requirements[u]=r,placeholder:"e.g. opencv-python",class:"input-field-sm flex-1 !text-xs font-mono"},null,8,qe),[[c,o.value.requirements[u]]]),t("button",{onClick:r=>o.value.requirements.splice(u,1),class:"text-gray-400 hover:text-red-500"},[d($,{class:"w-3 h-3"})],8,Se)]))),128))])]),t("div",Ie,[t("div",De,[e[26]||(e[26]=t("h4",{class:"text-xs font-black uppercase text-gray-400 tracking-widest"},"Inputs",-1)),t("button",{onClick:X,class:"text-blue-500 hover:text-blue-600 text-xs font-bold flex items-center gap-1"},[d(E,{class:"w-3 h-3"}),e[25]||(e[25]=f(" Add"))])]),t("div",Ee,[(a(!0),i(_,null,C(o.value.inputs,(s,u)=>(a(),i("div",{key:"in"+u,class:"flex gap-2 items-center bg-white dark:bg-gray-800 p-2 rounded border dark:border-gray-700 shadow-sm group"},[n(t("input",{"onUpdate:modelValue":r=>s.name=r,placeholder:"key_name",class:"input-field-sm flex-1 !text-xs font-mono"},null,8,$e),[[c,s.name]]),n(t("select",{"onUpdate:modelValue":r=>s.type=r,class:"input-field-sm w-28 !text-xs"},e[27]||(e[27]=[G('<option value="string">String</option><option value="int">Int</option><option value="float">Float</option><option value="boolean">Bool</option><option value="image">Image</option><option value="node_ref">NodeRef</option><option value="model_selection">Model Sel</option><option value="any">Any</option>',8)]),8,Ae),[[D,s.type]]),t("button",{onClick:r=>o.value.inputs.splice(u,1),class:"text-gray-400 hover:text-red-500"},[d($,{class:"w-3.5 h-3.5"})],8,je)]))),128))])]),t("div",Oe,[t("div",Me,[e[29]||(e[29]=t("h4",{class:"text-xs font-black uppercase text-gray-400 tracking-widest"},"Outputs",-1)),t("button",{onClick:Q,class:"text-green-500 hover:text-green-600 text-xs font-bold flex items-center gap-1"},[d(E,{class:"w-3 h-3"}),e[28]||(e[28]=f(" Add"))])]),t("div",Ge,[(a(!0),i(_,null,C(o.value.outputs,(s,u)=>(a(),i("div",{key:"out"+u,class:"flex gap-2 items-center bg-white dark:border-gray-800 p-2 rounded border dark:border-gray-700 shadow-sm group"},[n(t("input",{"onUpdate:modelValue":r=>s.name=r,placeholder:"key_name",class:"input-field-sm flex-1 !text-xs font-mono"},null,8,Je),[[c,s.name]]),n(t("select",{"onUpdate:modelValue":r=>s.type=r,class:"input-field-sm w-24 !text-xs"},e[30]||(e[30]=[G('<option value="string">String</option><option value="int">Integer</option><option value="float">Float</option><option value="boolean">Boolean</option><option value="image">Image</option><option value="list">List</option><option value="any">Any</option>',7)]),8,Be),[[D,s.type]]),t("button",{onClick:r=>o.value.outputs.splice(u,1),class:"text-gray-400 hover:text-red-500"},[d($,{class:"w-3.5 h-3.5"})],8,Fe)]))),128))])])])]),t("div",Le,[t("div",Re,[t("div",We,[e[31]||(e[31]=t("span",{class:"text-xs font-mono text-blue-400 font-bold px-2"},"node_logic.py",-1)),e[32]||(e[32]=t("div",{class:"h-4 w-px bg-gray-600"},null,-1)),t("button",{onClick:e[8]||(e[8]=s=>v.value="code"),class:I(["px-3 py-1 rounded text-xs font-medium",v.value==="code"?"bg-blue-600 text-white":"text-gray-400 hover:text-white"])},"Editor",2),t("button",{onClick:e[9]||(e[9]=s=>v.value="test"),class:I(["px-3 py-1 rounded text-xs font-medium",v.value==="test"?"bg-green-600 text-white":"text-gray-400 hover:text-white"])},"Test / Debug",2)]),v.value==="code"?(a(),i("div",ze,[n(t("input",{"onUpdate:modelValue":e[10]||(e[10]=s=>m.value=s),onKeydown:ne(A,["enter"]),class:"bg-gray-900 border border-gray-600 text-xs text-gray-200 rounded-l-md px-2 py-1 w-48 focus:w-64",placeholder:"e.g. Node for video cropping"},null,544),[[c,m.value]]),t("button",{onClick:A,class:"bg-blue-600 hover:bg-blue-500 text-white text-xs px-3 py-1 rounded-r-md",disabled:x.value},[d(ie,{class:"w-3 h-3 inline mr-1"}),e[33]||(e[33]=f(" AI Design"))],8,Ke)])):w("",!0)]),n(t("div",He,[d(B,{modelValue:o.value.code,"onUpdate:modelValue":e[11]||(e[11]=s=>o.value.code=s),class:"absolute inset-0 h-full w-full text-sm",extensions:z},null,8,["modelValue"])],512),[[J,v.value==="code"]]),n(t("div",Pe,[t("div",Xe,[t("div",Qe,[e[34]||(e[34]=t("label",{class:"text-xs font-bold text-gray-400 mb-2 uppercase"},"Test Inputs (JSON)",-1)),d(B,{modelValue:T.value,"onUpdate:modelValue":e[12]||(e[12]=s=>T.value=s),extensions:K,class:"flex-grow border border-gray-700 rounded bg-gray-800"},null,8,["modelValue"])]),t("div",Ye,[e[35]||(e[35]=t("label",{class:"text-xs font-bold text-gray-400 mb-2 uppercase"},"Output Result",-1)),t("div",Ze,b(q.value),1)])]),t("div",et,[y.value?(a(),i("div",tt,b(y.value),1)):w("",!0),t("button",{onClick:Y,class:"btn btn-primary btn-sm",disabled:g.value},[g.value?(a(),re(M,{key:0,class:"w-4 h-4 mr-2 animate-spin"})):w("",!0),f(b(g.value?"Running...":"Run Test"),1)],8,ot)])],512),[[J,v.value==="test"]])])]),t("div",st,[t("button",{onClick:e[13]||(e[13]=s=>l.$emit("close")),class:"btn btn-secondary"},"Cancel"),t("button",{onClick:Z,class:"btn btn-primary px-6 shadow-lg"},b(h.value?"Update Node":"Create Node"),1)])])]))}};export{nt as default};
