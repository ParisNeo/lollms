import{D as y,g as n,d as l,f as e,a as S,Y as U,c,r as v,o as A,A as i,V as M,k as T,am as N,i as P,v as V,al as z,t as p,l as x,p as D,F as H,B as L,$}from"./index-Dja0BxAz.js";import{useAdminStore as F}from"./admin-DrWr55jq.js";const I={},O={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor"};function j(f,s){return l(),n("svg",O,s[0]||(s[0]=[e("path",{d:"M3.375 3C2.339 3 1.5 3.84 1.5 4.875v.75c0 1.036.84 1.875 1.875 1.875h17.25c1.035 0 1.875-.84 1.875-1.875v-.75C22.5 3.839 21.66 3 20.625 3H3.375z"},null,-1),e("path",{"fill-rule":"evenodd",d:"M3.087 9l.54 9.176A3 3 0 006.62 21h10.757a3 3 0 002.995-2.824L20.913 9H3.087zm6.163 3.75A.75.75 0 0110 12h4a.75.75 0 010 1.5h-4a.75.75 0 01-.75-.75z","clip-rule":"evenodd"},null,-1)]))}const E=y(I,[["render",j]]),q={},K={width:"50px",height:"50px",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"};function R(f,s){return l(),n("svg",K,s[0]||(s[0]=[e("title",null,null,-1),e("g",{id:"Complete"},[e("g",{id:"bubble-square"},[e("path",{d:"M7.7,18.3H19.4a2.1,2.1,0,0,0,2.1-2.1V4.6a2.1,2.1,0,0,0-2.1-2.1H4.6A2.1,2.1,0,0,0,2.5,4.6V21.5Z",fill:"none",stroke:"#000000","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"})])],-1)]))}const Y=y(q,[["render",R]]),Z={class:"space-y-8"},G={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},J={class:"bg-white dark:bg-gray-800 p-6 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700"},Q={class:"flex items-center gap-4 mb-4"},W={class:"p-3 bg-blue-100 dark:bg-blue-900/30 text-blue-600 rounded-full"},X={class:"bg-white dark:bg-gray-800 p-6 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700"},ee={class:"flex items-center gap-4 mb-4"},te={class:"p-3 bg-red-100 dark:bg-red-900/30 text-red-600 rounded-full"},se={class:"bg-white dark:bg-gray-800 p-6 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700"},ae={class:"font-bold text-lg mb-4 flex items-center gap-2"},re={class:"flex gap-2"},oe=["disabled"],ne={class:"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden"},le={class:"p-4 bg-gray-50 dark:bg-gray-700/50 border-b dark:border-gray-700 flex justify-between items-center"},de={class:"flex items-center gap-2"},ie={class:"text-sm font-medium px-2 py-1 bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400 rounded-full"},ce={class:"max-h-96 overflow-y-auto p-4"},ue={key:0,class:"text-center text-gray-500 py-4"},ge={key:1,class:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4"},pe={class:"flex items-center gap-3 overflow-hidden"},fe={class:"truncate"},me=["title"],be={class:"text-xs text-gray-500"},he=["onClick"],_e={__name:"Operations",setup(f){const s=F(),o=S(),_=U(),m=c(()=>s.connectedUsers),b=c(()=>s.allUsers),w=c(()=>s.isLoadingConnectedUsers),d=v(""),u=v(!1),g=c(()=>b.value.length?m.value.map(r=>b.value.find(a=>a.id===r.id)||r):m.value);A(()=>{s.fetchConnectedUsers(),s.fetchAllUsers()});async function k(){const{confirmed:r,value:t}=await o.showConfirmation({title:"Secure System Backup",message:"Enter a MANDATORY password to encrypt the backup.",confirmText:"Backup",inputType:"password",inputPlaceholder:"Encryption Password"});if(r){if(!t){o.addNotification("Password is required for backup.","error");return}try{await s.createBackup(t),o.addNotification("Secure backup task started.","info")}catch{o.addNotification("Failed to start backup.","error")}}}async function C(){const r=await o.showConfirmation({title:"Purge Temporary Files?",message:"Delete temporary files older than 24 hours from all user directories?",confirmText:"Purge",cancelText:"Cancel"});r&&r.confirmed&&(s.purgeUnusedUploads(),o.addNotification("Purge task started.","info"))}async function h(){if(d.value.trim()){u.value=!0;try{await s.broadcastMessage(d.value),o.addNotification("Broadcast sent successfully.","success"),d.value=""}finally{u.value=!1}}}function B(r){_.openConversation({id:r.id,username:r.username,icon:r.icon}),o.setMainView("chat")}return(r,t)=>(l(),n("div",Z,[t[7]||(t[7]=e("h3",{class:"text-xl font-bold text-gray-900 dark:text-white"},"System Operations",-1)),e("div",G,[e("div",J,[e("div",Q,[e("div",W,[i(E,{class:"w-6 h-6"})]),t[2]||(t[2]=e("div",null,[e("h4",{class:"font-bold text-lg"},"System Backup"),e("p",{class:"text-sm text-gray-500"},"Create an encrypted full backup.")],-1))]),e("button",{onClick:k,class:"btn btn-primary w-full"},"Start Backup")]),e("div",X,[e("div",ee,[e("div",te,[i(M,{class:"w-6 h-6"})]),t[3]||(t[3]=e("div",null,[e("h4",{class:"font-bold text-lg"},"Cleanup"),e("p",{class:"text-sm text-gray-500"},"Purge old temporary files.")],-1))]),e("button",{onClick:C,class:"btn btn-danger-outline w-full"},"Purge Temp Files")])]),e("div",se,[e("h4",ae,[i(N,{class:"w-5 h-5 text-gray-500"}),t[4]||(t[4]=T(" Broadcast Message "))]),e("div",re,[P(e("input",{"onUpdate:modelValue":t[0]||(t[0]=a=>d.value=a),type:"text",class:"input-field flex-grow",placeholder:"Type a message to send to all connected users...",onKeyup:z(h,["enter"])},null,544),[[V,d.value]]),e("button",{onClick:h,disabled:!d.value||u.value,class:"btn btn-primary px-6"}," Send ",8,oe)])]),e("div",ne,[e("div",le,[t[6]||(t[6]=e("h4",{class:"font-bold text-lg"},"Live Users",-1)),e("div",de,[e("span",ie,p(g.value.length)+" Online ",1),e("button",{onClick:t[1]||(t[1]=(...a)=>x(s).fetchConnectedUsers&&x(s).fetchConnectedUsers(...a)),class:"btn-icon p-1"},[(l(),n("svg",{xmlns:"http://www.w3.org/2000/svg",class:D(["h-4 w-4",{"animate-spin":w.value}]),viewBox:"0 0 20 20",fill:"currentColor"},t[5]||(t[5]=[e("path",{"fill-rule":"evenodd",d:"M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z","clip-rule":"evenodd"},null,-1)]),2))])])]),e("div",ce,[g.value.length===0?(l(),n("div",ue,"No users currently connected.")):(l(),n("div",ge,[(l(!0),n(H,null,L(g.value,a=>(l(),n("div",{key:a.id,class:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700/30 rounded-lg border border-gray-200 dark:border-gray-700"},[e("div",pe,[i($,{icon:a.icon,username:a.username,"size-class":"h-8 w-8"},null,8,["icon","username"]),e("div",fe,[e("p",{class:"font-medium text-sm truncate",title:a.username},p(a.username),9,me),e("p",be,"ID: "+p(a.id),1)])]),e("button",{onClick:ve=>B(a),class:"btn btn-secondary btn-xs",title:"Send Direct Message"},[i(Y,{class:"w-4 h-4"})],8,he)]))),128))]))])])]))}};export{_e as default};
