import{X as O,c as _,a2 as R,K as v,w as S,o as q,n as F,l as b,g as T,e,j as o,d as f,H as g,t as p,J as G,O as x,h as K,au as A,Y as L,f as W,a8 as I,F as X,i as Y,m as Q}from"./index-CZNMIptP.js";import{_ as Z}from"./GenericModal-DlcvRk3V.js";import{u as ee}from"./admin-B7P7solc.js";import{_ as te}from"./WysiwygEditor-BZxFncWs.js";/* empty css                    */import"./InsertImageModal-CTob9Noy.js";const le={class:"grid grid-cols-1 md:grid-cols-3 gap-6"},se={class:"space-y-6 md:col-span-2"},oe={class:"flex items-center gap-4"},ae={class:"flex-grow"},ne=["disabled"],re={class:"flex items-center justify-between mb-1"},ie={class:"flex items-center gap-2"},de=["disabled"],ue=["disabled"],ce={class:"space-y-4"},me={class:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg"},ve={class:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg"},be={class:"space-y-4"},fe={class:"text-sm font-medium"},ge={class:"relative"},pe={class:"flex items-center p-2 border-b dark:border-gray-600"},ye={class:"max-h-96 overflow-y-auto border dark:border-gray-600 rounded-b-md"},xe={key:0,class:"divide-y dark:divide-gray-600"},ke=["id","value"],he=["for"],we={class:"font-medium"},_e={key:1,class:"p-4 text-center text-sm text-gray-500"},Ce={class:"flex justify-between items-center w-full"},Ue=["disabled"],je={class:"flex justify-end space-x-3"},Me=["disabled"],$e={__name:"EmailAllUsersModal",setup(Se){const d=O(),C=ee(),P=_(()=>d.modalData("emailAllUsers")),{isEnhancingEmail:U}=R(C),{emailModalSubject:a,emailModalBody:n,emailModalBackgroundColor:r,emailModalSendAsText:c}=R(d),j=v(""),y=v(!1),u=v([]),i=v(-1),k=v(!1),m=v([]),E=v([]),M=v(!0),V=_(()=>i.value>0),B=_(()=>i.value<u.value.length-1),h=_(()=>(E.value||[]).filter(l=>l.is_active&&l.email));S(P,l=>{l&&l.users&&(E.value=l.users,m.value=l.users.map(t=>t.id))},{immediate:!0,deep:!0}),q(()=>{w()}),S(M,l=>{l?m.value=h.value.map(t=>t.id):m.value=[]}),S([a,n,r],()=>{w()});function w(){const l={subject:a.value,body:n.value,backgroundColor:r.value};u.value.length>0&&JSON.stringify(l)===JSON.stringify(u.value[i.value])||(u.value.splice(i.value+1),u.value.push(l),i.value=u.value.length-1)}function N(l){a.value=l.subject,n.value=l.body,r.value=l.backgroundColor}function z(){V.value&&(i.value--,N(u.value[i.value]))}function D(){B.value&&(i.value++,N(u.value[i.value]))}async function H(){if(!a.value&&!n.value){d.addNotification("Please provide a subject or body to enhance.","warning");return}try{const l=await C.enhanceEmail(a.value,n.value,r.value,j.value);l&&(a.value=l.subject,n.value=l.body,r.value=l.background_color||r.value,w())}catch{}}async function $(){if(!a.value||!n.value){d.addNotification("Subject and body are required.","error");return}if(m.value.length===0){d.addNotification("Please select at least one user to email.","error");return}k.value=!0;try{await C.sendEmailToUsers(a.value,n.value,m.value,r.value,c.value),d.closeModal("emailAllUsers"),d.initEmailModalState(),u.value=[],i.value=-1,w()}catch{}finally{k.value=!1}}return(l,t)=>(b(),F(Z,{"modal-name":"emailAllUsers",title:"Email Users",onClose:t[9]||(t[9]=s=>o(d).closeModal("emailAllUsers")),maxWidthClass:"max-w-6xl"},{body:T(()=>[e("form",{onSubmit:G($,["prevent"]),class:"p-6 space-y-6"},[e("div",le,[e("div",se,[e("div",oe,[e("div",ae,[t[10]||(t[10]=e("label",{for:"email-subject",class:"block text-sm font-medium"},"Subject",-1)),x(e("input",{id:"email-subject","onUpdate:modelValue":t[0]||(t[0]=s=>A(a)?a.value=s:null),type:"text",class:"input-field mt-1",required:""},null,512),[[L,o(a)]])]),e("div",null,[e("label",{for:"email-bg-color",class:g(["block text-sm font-medium",{"text-gray-400 dark:text-gray-500":o(c)}])},"BG Color",2),x(e("input",{id:"email-bg-color","onUpdate:modelValue":t[1]||(t[1]=s=>A(r)?r.value=s:null),type:"color",class:"w-20 h-10 mt-1 p-1 border border-gray-300 dark:border-gray-600 rounded-md",disabled:o(c)},null,8,ne),[[L,o(r)]])])]),e("div",null,[e("div",re,[t[13]||(t[13]=e("label",{class:"block text-sm font-medium"},"Body",-1)),e("div",ie,[e("button",{onClick:z,disabled:!V.value,type:"button",class:"toolbar-btn",title:"Undo"},t[11]||(t[11]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 10h10a8 8 0 018 8v2M3 10l4-4m-4 4l4 4"})],-1)]),8,de),e("button",{onClick:D,disabled:!B.value,type:"button",class:"toolbar-btn",title:"Redo"},t[12]||(t[12]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 10h-10a8 8 0 00-8 8v2m18-10l-4-4m4 4l-4 4"})],-1)]),8,ue)])]),W(te,{modelValue:o(n),"onUpdate:modelValue":t[2]||(t[2]=s=>A(n)?n.value=s:null)},null,8,["modelValue"])]),e("div",ce,[e("div",me,[t[15]||(t[15]=e("label",{for:"send-as-text",class:"text-sm font-medium text-gray-900 dark:text-gray-100"},"Send as plain text",-1)),e("button",{onClick:t[3]||(t[3]=s=>c.value=!o(c)),type:"button",class:g(["relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800",o(c)?"bg-blue-600":"bg-gray-200 dark:bg-gray-600"])},[t[14]||(t[14]=e("span",{class:"sr-only"},"Use plain text",-1)),e("span",{class:g(["pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out",o(c)?"translate-x-5":"translate-x-0"])},null,2)],2)]),e("div",ve,[t[17]||(t[17]=e("label",{for:"show-custom-prompt",class:"text-sm font-medium text-gray-900 dark:text-gray-100"},"Use Custom AI Prompt",-1)),e("button",{onClick:t[4]||(t[4]=s=>y.value=!y.value),type:"button",class:g(["relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800",y.value?"bg-blue-600":"bg-gray-200 dark:bg-gray-600"])},[t[16]||(t[16]=e("span",{class:"sr-only"},"Use Custom AI Prompt",-1)),e("span",{class:g(["pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out",y.value?"translate-x-5":"translate-x-0"])},null,2)],2)])]),y.value?x((b(),f("textarea",{key:0,"onUpdate:modelValue":t[5]||(t[5]=s=>j.value=s),rows:"3",class:"input-field mt-2",placeholder:"e.g., Rewrite this to be more casual and exciting..."},null,512)),[[L,j.value]]):K("",!0)]),e("div",be,[e("h4",fe,"Recipients ("+p(m.value.length)+"/"+p(h.value.length)+")",1),e("div",ge,[e("div",pe,[x(e("input",{id:"select-all-users",type:"checkbox","onUpdate:modelValue":t[6]||(t[6]=s=>M.value=s),class:"h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-600"},null,512),[[I,M.value]]),t[18]||(t[18]=e("label",{for:"select-all-users",class:"ml-3 block text-sm font-medium"},"Select All",-1))]),e("div",ye,[h.value.length>0?(b(),f("div",xe,[(b(!0),f(X,null,Y(h.value,s=>(b(),f("div",{key:s.id,class:"p-2 flex items-center"},[x(e("input",{id:`user-${s.id}`,type:"checkbox",value:s.id,"onUpdate:modelValue":t[7]||(t[7]=J=>m.value=J),class:"h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-600"},null,8,ke),[[I,m.value]]),e("label",{for:`user-${s.id}`,class:"ml-3 text-sm"},[e("span",we,p(s.username),1),Q(" ("+p(s.email)+") ",1)],8,he)]))),128))])):(b(),f("div",_e," No eligible users found. "))])])])])],32)]),footer:T(()=>[e("div",Ce,[e("button",{type:"button",onClick:H,class:"btn btn-secondary flex items-center gap-2",disabled:o(U)||o(c)},[(b(),f("svg",{xmlns:"http://www.w3.org/2000/svg",class:g(["h-5 w-5",{"animate-spin":o(U)}]),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},t[19]||(t[19]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.898 20.572L16.5 21.75l-.398-1.178a3.375 3.375 0 00-2.3-2.3L12.75 18l1.178-.398a3.375 3.375 0 002.3-2.3L16.5 14.25l.398 1.178a3.375 3.375 0 002.3 2.3l1.178.398-1.178.398a3.375 3.375 0 00-2.3 2.3z"},null,-1)]),2)),e("span",null,p(o(U)?"Enhancing...":"Enhance with AI"),1)],8,Ue),e("div",je,[e("button",{type:"button",class:"btn btn-secondary",onClick:t[8]||(t[8]=s=>o(d).closeModal("emailAllUsers"))},"Cancel"),e("button",{type:"button",onClick:$,class:"btn btn-primary",disabled:k.value},p(k.value?"Sending...":"Send Email"),9,Me)])])]),_:1}))}};export{$e as default};
