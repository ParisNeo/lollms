import{d9 as J,da as X,db as Y,dc as ee,dd as te,de as se,df as ae,dg as oe,dh as ne,u as R,N as f,c as $,m as le,a as z,o as l,w as V,b as e,t as c,d as T,e as r,f as M,aB as re,L as ie,j as de,q as ce,an as ue,l as ve,g as b,h,V as me,W as A,ak as pe,ap as B,ar as j,F as fe,r as ge,U as ye,n as O,ax as he}from"./index-BkSnPnj7.js";import{u as F}from"./admin-DblNksfn.js";import{L as _e}from"./chartjs-adapter-date-fns.esm-D-U2zsrX.js";import{_ as be}from"./GenericModal-CyWgHpU9.js";const ke={key:0,class:"flex justify-center items-center h-96"},xe={key:1,class:"text-center h-96 flex items-center justify-center"},Ce={key:2},we={class:"h-96"},Se=["disabled"],Ue={__name:"UserStatsModal",props:{userId:{type:Number,required:!0},username:{type:String,required:!0}},setup(I){J.register(X,Y,ee,te,se,ae,oe,ne);const u=I,m=F(),g=R(),_=f(null),p=f(!0),k=f(null),x=$(()=>({responsive:!0,maintainAspectRatio:!1,scales:{x:{type:"time",time:{unit:"day",tooltipFormat:"MMM d, yyyy",displayFormats:{day:"MMM d"}},grid:{color:g.currentTheme==="dark"?"rgba(255, 255, 255, 0.1)":"rgba(0, 0, 0, 0.1)"},ticks:{color:g.currentTheme==="dark"?"#cbd5e1":"#4b5563"}},y:{beginAtZero:!0,grid:{color:g.currentTheme==="dark"?"rgba(255, 255, 255, 0.1)":"rgba(0, 0, 0, 0.1)"},ticks:{color:g.currentTheme==="dark"?"#cbd5e1":"#4b5563",stepSize:1}}},plugins:{legend:{labels:{color:g.currentTheme==="dark"?"#cbd5e1":"#4b5563"}}}})),L=$(()=>{if(!_.value)return{labels:[],datasets:[]};const o=new Map;for(let n=29;n>=0;n--){const S=new Date;S.setDate(S.getDate()-n),o.set(S.toISOString().split("T")[0],{tasks:0,messages:0})}_.value.tasks_per_day.forEach(n=>{o.has(n.date)&&(o.get(n.date).tasks=n.count)}),_.value.messages_per_day.forEach(n=>{o.has(n.date)&&(o.get(n.date).messages=n.count)});const i=Array.from(o.keys()),d=Array.from(o.values()).map(n=>n.tasks),w=Array.from(o.values()).map(n=>n.messages);return{labels:i,datasets:[{label:"Tasks Created",backgroundColor:"#3b82f6",borderColor:"#3b82f6",data:d,tension:.1},{label:"AI Generations",backgroundColor:"#10b981",borderColor:"#10b981",data:w,tension:.1}]}});async function C(){p.value=!0;try{_.value=await m.fetchUserStats(u.userId)}finally{p.value=!1}}function v(){if(k.value&&k.value.chart){const o=document.createElement("a");o.href=k.value.chart.toBase64Image("image/png",1),o.download=`user_stats_${u.username}.png`,o.click()}else g.addNotification("Could not export chart.","error")}return le(()=>u.userId,o=>{o&&C()},{immediate:!0}),(o,i)=>(l(),z(be,{modalName:"userStats",title:`Usage Statistics for ${I.username}`,maxWidthClass:"max-w-4xl"},{body:V(()=>[p.value?(l(),r("div",ke,[M(re,{class:"w-8 h-8 text-blue-500"})])):_.value?(l(),r("div",Ce,[i[2]||(i[2]=e("p",{class:"text-sm text-gray-500 mb-4"},"Showing activity for the last 30 days.",-1)),e("div",we,[M(T(_e),{data:L.value,options:x.value,ref_key:"chartRef",ref:k},null,8,["data","options"])])])):(l(),r("div",xe,i[1]||(i[1]=[e("p",{class:"text-gray-500"},"Could not load statistics for this user.",-1)])))]),footer:V(()=>[e("button",{onClick:C,class:"btn btn-secondary",disabled:p.value},c(p.value?"Reloading...":"Reload Data"),9,Se),e("button",{onClick:v,class:"btn btn-secondary"},"Export Image"),i[3]||(i[3]=e("div",{class:"flex-grow"},null,-1)),e("button",{onClick:i[0]||(i[0]=d=>T(g).closeModal("userStats")),class:"btn btn-primary"},"Close")]),_:1},8,["title"]))}},Me={},Le={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",class:"w-5 h-5"};function Ae(I,u){return l(),r("svg",Le,u[0]||(u[0]=[e("path",{d:"M7.05025 1.53553C8.03344 0.552348 9.36692 0 10.7574 0C13.6528 0 16 2.34721 16 5.24264C16 6.63308 15.4477 7.96656 14.4645 8.94975L12.4142 11L11 9.58579L13.0503 7.53553C13.6584 6.92742 14 6.10264 14 5.24264C14 3.45178 12.5482 2 10.7574 2C9.89736 2 9.07258 2.34163 8.46447 2.94975L6.41421 5L5 3.58579L7.05025 1.53553Z"},null,-1),e("path",{d:"M7.53553 13.0503L9.58579 11L11 12.4142L8.94975 14.4645C7.96656 15.4477 6.63308 16 5.24264 16C2.34721 16 0 13.6528 0 10.7574C0 9.36693 0.552347 8.03344 1.53553 7.05025L3.58579 5L5 6.41421L2.94975 8.46447C2.34163 9.07258 2 9.89736 2 10.7574C2 12.5482 3.45178 14 5.24264 14C6.10264 14 6.92742 13.6584 7.53553 13.0503Z"},null,-1),e("path",{d:"M5.70711 11.7071L11.7071 5.70711L10.2929 4.29289L4.29289 10.2929L5.70711 11.7071Z"},null,-1)]))}const $e=ie(Me,[["render",Ae]]),Ie={class:"bg-white dark:bg-gray-800 shadow-sm rounded-lg overflow-hidden"},De={class:"px-4 py-5 sm:p-6 space-y-4"},Te={class:"flex flex-wrap items-center justify-between gap-4"},Ee={class:"flex items-center gap-2"},Ne=["disabled"],Ve=["disabled"],Be={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},je={class:"border-t border-gray-200 dark:border-gray-700"},Oe={key:0,class:"p-6 text-center text-gray-500"},Re={key:1,class:"p-6 text-center text-gray-500"},ze={key:2,class:"overflow-x-auto"},Fe={class:"min-w-full divide-y divide-gray-200 dark:divide-gray-700"},He={class:"bg-gray-50 dark:bg-gray-700/50"},Ke={scope:"col",class:"px-6 py-3"},Pe={scope:"col",class:"table-header"},Ze={key:0},qe={scope:"col",class:"table-header"},Qe={key:0},We={scope:"col",class:"table-header"},Ge={key:0},Je={scope:"col",class:"table-header"},Xe={key:0},Ye={scope:"col",class:"table-header"},et={key:0},tt={scope:"col",class:"table-header"},st={key:0},at={class:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700"},ot={class:"px-6 py-4"},nt=["value"],lt={class:"table-cell"},rt={class:"flex items-center"},it={class:"ml-4"},dt={class:"text-sm font-medium text-gray-900 dark:text-white"},ct={class:"text-sm text-gray-500 dark:text-gray-400"},ut={class:"table-cell"},vt={class:"flex items-center gap-2"},mt=["title"],pt={class:"table-cell text-sm text-center font-mono text-gray-500 dark:text-gray-400"},ft=["title"],gt={class:"table-cell text-sm text-gray-500 dark:text-gray-400"},yt={class:"table-cell text-sm text-center text-gray-500 dark:text-gray-400"},ht={class:"table-cell text-sm text-center text-gray-500 dark:text-gray-400"},_t={class:"table-cell text-sm text-gray-500 dark:text-gray-400"},bt={class:"table-cell text-right text-sm font-medium"},kt={class:"flex items-center justify-end space-x-2"},xt=["onClick"],Ct=["onClick"],wt=["onClick"],St=["onClick"],$t={__name:"UserTable",setup(I){const u=F(),m=R(),g=de(),_=ce(),{allUsers:p,isLoadingUsers:k}=ue(u),x=f(""),L=f(null),C=f(null),v=f("username"),o=f("asc"),i=f(null),d=f([]),w=$(()=>({filter_online:L.value,filter_has_keys:C.value,sort_by:v.value,sort_order:o.value})),n=$(()=>{if(!x.value)return p.value;const a=x.value.toLowerCase();return p.value.filter(t=>t.username.toLowerCase().includes(a)||t.email&&t.email.toLowerCase().includes(a))}),S=$({get:()=>{const a=n.value.map(t=>t.id);return a.length===0?!1:d.value.length===a.length&&a.every(t=>d.value.includes(t))},set:a=>{const t=n.value.map(s=>s.id);a?d.value=[...new Set([...d.value,...t])]:d.value=d.value.filter(s=>!t.includes(s))}});function H(){const a=p.value.filter(t=>d.value.includes(t.id));if(a.length===0){m.addNotification("Please select at least one user.","warning");return}m.openModal("emailAllUsers",{users:a})}function K(){m.openModal("adminCreateUser")}async function P(a){(await m.showConfirmation({title:"Delete User?",message:`Are you sure you want to delete user "${a.username}"? This action is permanent and will delete all user data.`,confirmText:"Delete User",danger:!0})).confirmed&&await u.deleteUser(a.id)}function Z(){const a=p.value.filter(t=>d.value.includes(t.id));if(a.length===0){m.addNotification("Please select at least one user.","warning");return}m.openModal("emailList",{users:a})}function U(a){v.value===a?o.value=o.value==="asc"?"desc":"asc":(v.value=a,o.value="asc"),u.fetchAllUsers(w.value)}function E(){u.fetchAllUsers(w.value)}function q(a){if(!a)return"Never";const t=new Date(a),y=Math.round((new Date-t)/1e3);if(y<60)return`${y}s ago`;const D=Math.round(y/60);if(D<60)return`${D}m ago`;const N=Math.round(D/60);return N<24?`${N}h ago`:t.toLocaleString()}function Q(a){m.openModal("adminUserEdit",{user:a,onUserUpdated:()=>u.fetchAllUsers(w.value)})}function W(a){i.value=a,m.openModal("userStats",{userId:a.id,username:a.username})}async function G(a){await _.push("/"),g.openConversation({id:a.id,username:a.username,icon:a.icon})}return ve(()=>{u.fetchAllUsers(w.value)}),(a,t)=>(l(),r("div",Ie,[e("div",De,[e("div",Te,[t[12]||(t[12]=e("h3",{class:"text-base font-semibold leading-6 text-gray-900 dark:text-white"},"All Users",-1)),e("div",Ee,[e("button",{onClick:K,class:"btn btn-primary btn-sm flex items-center gap-1"},[M(me,{class:"w-4 h-4"}),t[11]||(t[11]=h(" Add User "))]),e("button",{onClick:Z,class:"btn btn-secondary btn-sm",disabled:d.value.length===0},"Copy Emails",8,Ne),e("button",{onClick:H,class:"btn btn-secondary btn-sm",disabled:d.value.length===0},"Email Selected",8,Ve)])]),e("div",Be,[A(e("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=s=>x.value=s),placeholder:"Search username/email...",class:"input-field md:col-span-2"},null,512),[[pe,x.value]]),A(e("select",{"onUpdate:modelValue":t[1]||(t[1]=s=>L.value=s),onChange:E,class:"input-field"},t[13]||(t[13]=[e("option",{value:null},"All Activity",-1),e("option",{value:!0},"Online",-1),e("option",{value:!1},"Offline",-1)]),544),[[B,L.value]]),A(e("select",{"onUpdate:modelValue":t[2]||(t[2]=s=>C.value=s),onChange:E,class:"input-field"},t[14]||(t[14]=[e("option",{value:null},"All API Keys",-1),e("option",{value:!0},"Has Keys",-1),e("option",{value:!1},"No Keys",-1)]),544),[[B,C.value]])])]),e("div",je,[T(k)?(l(),r("div",Oe," Loading users... ")):n.value.length===0?(l(),r("div",Re," No users found. ")):(l(),r("div",ze,[e("table",Fe,[e("thead",He,[e("tr",null,[e("th",Ke,[A(e("input",{type:"checkbox","onUpdate:modelValue":t[3]||(t[3]=s=>S.value=s),class:"h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500"},null,512),[[j,S.value]])]),e("th",Pe,[e("button",{onClick:t[4]||(t[4]=s=>U("username")),class:"flex items-center gap-1"},[t[15]||(t[15]=h("User ")),v.value==="username"?(l(),r("span",Ze,c(o.value==="asc"?"▲":"▼"),1)):b("",!0)])]),t[21]||(t[21]=e("th",{scope:"col",class:"table-header"},"Status",-1)),e("th",qe,[e("button",{onClick:t[5]||(t[5]=s=>U("connection_count")),class:"flex items-center gap-1"},[t[16]||(t[16]=h("Connections")),v.value==="connection_count"?(l(),r("span",Qe,c(o.value==="asc"?"▲":"▼"),1)):b("",!0)])]),e("th",We,[e("button",{onClick:t[6]||(t[6]=s=>U("last_activity_at")),class:"flex items-center gap-1"},[t[17]||(t[17]=h("Last Seen ")),v.value==="last_activity_at"?(l(),r("span",Ge,c(o.value==="asc"?"▲":"▼"),1)):b("",!0)])]),e("th",Je,[e("button",{onClick:t[7]||(t[7]=s=>U("api_key_count")),class:"flex items-center gap-1"},[t[18]||(t[18]=h("API Keys ")),v.value==="api_key_count"?(l(),r("span",Xe,c(o.value==="asc"?"▲":"▼"),1)):b("",!0)])]),e("th",Ye,[e("button",{onClick:t[8]||(t[8]=s=>U("task_count")),class:"flex items-center gap-1"},[t[19]||(t[19]=h("Tasks ")),v.value==="task_count"?(l(),r("span",et,c(o.value==="asc"?"▲":"▼"),1)):b("",!0)])]),e("th",tt,[e("button",{onClick:t[9]||(t[9]=s=>U("created_at")),class:"flex items-center gap-1"},[t[20]||(t[20]=h("Joined ")),v.value==="created_at"?(l(),r("span",st,c(o.value==="asc"?"▲":"▼"),1)):b("",!0)])]),t[22]||(t[22]=e("th",{scope:"col",class:"relative px-6 py-3"},[e("span",{class:"sr-only"},"Actions")],-1))])]),e("tbody",at,[(l(!0),r(fe,null,ge(n.value,s=>(l(),r("tr",{key:s.id,class:"hover:bg-gray-50 dark:hover:bg-gray-700/50"},[e("td",ot,[A(e("input",{type:"checkbox",value:s.id,"onUpdate:modelValue":t[10]||(t[10]=y=>d.value=y),class:"h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500"},null,8,nt),[[j,d.value]])]),e("td",lt,[e("div",rt,[M(ye,{icon:s.icon,username:s.username,"size-class":"h-8 w-8"},null,8,["icon","username"]),e("div",it,[e("div",dt,c(s.username),1),e("div",ct,c(s.email||"No email"),1)])])]),e("td",ut,[e("div",vt,[e("span",{class:O(["w-3 h-3 rounded-full",s.is_online?"bg-green-500":"bg-gray-400"]),title:s.is_online?"Online":"Offline"},null,10,mt),e("span",{class:O([s.is_active?"status-badge-green":"status-badge-red","status-badge"])},c(s.is_active?"Active":"Inactive"),3)])]),e("td",pt,[e("div",{class:"flex items-center justify-center gap-1",title:`${s.connection_count} active connections`},[M($e,{class:"w-4 h-4"}),h(" "+c(s.connection_count),1)],8,ft)]),e("td",gt,c(q(s.last_activity_at)),1),e("td",yt,c(s.api_key_count),1),e("td",ht,c(s.task_count),1),e("td",_t,c(new Date(s.created_at).toLocaleDateString()),1),e("td",bt,[e("div",kt,[e("button",{onClick:y=>W(s),title:"View Stats",class:"action-icon"},t[23]||(t[23]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})],-1)]),8,xt),e("button",{onClick:y=>G(s),title:"Send DM",class:"action-icon"},t[24]||(t[24]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})],-1)]),8,Ct),e("button",{onClick:y=>Q(s),title:"Edit User",class:"action-icon"},t[25]||(t[25]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10"})],-1)]),8,wt),e("button",{onClick:y=>P(s),title:"Delete User",class:"action-icon text-red-500 hover:text-red-700"},[M(he,{class:"w-5 h-5"})],8,St)])])]))),128))])])]))]),i.value?(l(),z(Ue,{key:0,userId:i.value.id,username:i.value.username},null,8,["userId","username"])):b("",!0)]))}};export{$t as default};
