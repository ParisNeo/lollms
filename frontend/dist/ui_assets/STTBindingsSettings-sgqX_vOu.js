const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["ui_assets/BindingModelsManager-DmfZp1EE.js","ui_assets/index-CZ57W16T.js","ui_assets/index-HfzKwilw.css","ui_assets/admin-oSQkGxSZ.js","ui_assets/BindingZoo-Dyd7FjW3.js"])))=>i.map(i=>d[i]);
import{u as ue,R as ce,T as R,L as f,c as F,m as O,l as me,e as o,o as l,b as t,g as v,t as r,n as g,a0 as E,h as x,ac as H,ar as J,F as A,r as B,d as C,cx as ve,a3 as ge,a as z,aJ as fe,aK as be,aD as ye,K as L,f as $,cy as pe,ab as xe,an as _e,s as K,G as he,H as Z}from"./index-CZ57W16T.js";import{u as ke}from"./admin-oSQkGxSZ.js";import{_ as we}from"./JsonRenderer-BXIGRWbM.js";const Ce={class:"space-y-8"},Se={key:0,class:"bg-white dark:bg-gray-800 shadow-md rounded-lg p-6"},Te={class:"flex justify-between items-center mb-4"},Ae={class:"text-xl font-semibold"},Be={key:0,class:"flex gap-2 text-sm font-medium overflow-x-auto"},$e={key:0},Me={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},De=["disabled"],je=["value"],Ne={key:0,class:"space-y-6 border-t dark:border-gray-700 pt-6"},Ve=["innerHTML"],Ee=["for"],Fe={key:0,class:"text-red-500"},Ie=["id","onUpdate:modelValue"],Oe=["value"],ze={key:1},Le={class:"relative"},Pe=["type","id","onUpdate:modelValue","required","placeholder"],Ue=["onClick","title"],qe={key:2,class:"flex items-center justify-between bg-gray-50 dark:bg-gray-700/50 p-3 rounded-md"},Ge={class:"flex-grow flex flex-col pr-4"},Re={class:"text-sm text-gray-500 dark:text-gray-400"},He=["onClick"],Je={class:"text-xs text-gray-500 mt-1"},Ke={class:"flex items-center justify-between bg-gray-50 dark:bg-gray-700/50 p-3 rounded-md"},Ze={class:"flex justify-end gap-3"},Qe=["disabled"],We={key:1,class:"space-y-6"},Xe={key:0},Ye={class:"flex justify-between items-start mb-3"},et={class:"font-bold text-md flex items-center gap-2"},tt={class:"text-sm text-gray-600 dark:text-gray-400 mt-1"},at=["onClick","disabled"],st={key:0,class:"space-y-3 mb-4 p-3 bg-white dark:bg-gray-800 rounded border dark:border-gray-700"},nt={class:"block text-xs font-medium uppercase text-gray-500 dark:text-gray-400 mb-1"},lt=["onUpdate:modelValue","placeholder"],ot={key:1,class:"flex items-center gap-2"},it=["onClick"],rt={class:"text-sm text-gray-600 dark:text-gray-400"},dt={key:1,class:"mt-4"},ut={class:"flex justify-between text-xs mb-1 font-semibold text-blue-600 dark:text-blue-400"},ct={class:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2"},mt={class:"text-xs text-gray-500 mt-1 truncate"},vt={key:2,class:"mt-4 p-3 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-md"},gt={key:0},ft={key:1,class:"whitespace-pre-wrap text-sm text-gray-800 dark:text-gray-200 font-mono"},bt={key:3,class:"mt-4 p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-md"},yt={class:"text-xs font-bold text-red-800 dark:text-red-300 mb-2 uppercase flex items-center gap-2"},pt={class:"text-sm text-red-700 dark:text-red-400"},xt={key:1,class:"text-center text-gray-500 py-8 border-2 border-dashed border-gray-200 dark:border-gray-700 rounded-lg"},_t={key:2},ht={key:3},kt={key:1},wt={class:"flex justify-between items-center mb-4 flex-wrap gap-4"},Ct={class:"flex items-center gap-4"},St=["value"],Tt={key:0,class:"text-center p-6"},At={key:1,class:"text-center p-6 bg-gray-50 dark:bg-gray-800/50 rounded-lg"},Bt={key:2,class:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6"},$t=["onClick"],Mt=["onClick","title"],Dt={class:"flex-grow"},jt={class:"flex items-center gap-3 mb-2"},Nt={class:"font-bold text-lg text-gray-900 dark:text-white"},Vt={class:"text-xs text-gray-500 dark:text-gray-400"},Et={class:"mt-3 text-sm text-gray-600 dark:text-gray-300"},Ft={key:0,class:"mb-1"},It={class:"text-xs text-gray-400 truncate"},Ot={class:"border-t dark:border-gray-700 pt-3 flex justify-between items-center text-xs text-gray-500"},zt=["onClick"],Rt={__name:"STTBindingsSettings",setup(Lt){const Q=K(()=>Z(()=>import("./BindingModelsManager-DmfZp1EE.js"),__vite__mapDeps([0,1,2,3]))),W=K(()=>Z(()=>import("./BindingZoo-Dyd7FjW3.js"),__vite__mapDeps([4,1,2,3]))),b=ke(),M=ue(),P=ce(),{sttBindings:U,availableSttBindingTypes:_,isLoadingSttBindings:X,globalSettings:Y}=R(b),{tasks:ee}=R(P),S=f(!1),h=f(null),D=f(!1),k=f({}),I=f("mixed"),y=f({}),d=f("settings"),j=f(null),N=f(null),w=f(null),u=F(()=>j.value?ee.value.find(s=>s.id===j.value):null);O(u,s=>{s&&s.status==="completed"&&(w.value=s.result)},{deep:!0});const q=()=>({id:null,alias:"",name:"",config:{},default_model_name:"",is_active:!0}),i=f(q()),T=F(()=>h.value!==null),p=F(()=>!i.value.name||!Array.isArray(_.value)?null:_.value.find(s=>(s.binding_name||s.name)===i.value.name)),te=F(()=>{if(!p.value)return[];const s=p.value.input_parameters||[],a=new Set(s.map(c=>c.name)),e=p.value.model_parameters||[],n=new Set(e.map(c=>c.name)),m=Object.keys(i.value.config||{}).filter(c=>!a.has(c)&&!n.has(c)&&c!=="model_name"&&c!=="model"&&c!=="class").map(c=>({name:c,type:typeof i.value.config[c]=="boolean"?"bool":typeof i.value.config[c]=="number"?"float":"str",description:"(Parameter not in binding description)",mandatory:!1}));return[...s.filter(c=>!n.has(c.name)&&c.name!=="model_name"),...m]});O(Y,s=>{if(Array.isArray(s)){const a=s.find(e=>e.key==="stt_model_display_mode");a&&(I.value=a.value)}},{deep:!0,immediate:!0});function ae(s){const a=s.target.value;I.value=a,b.updateGlobalSettings({stt_model_display_mode:a})}O(()=>i.value.name,(s,a)=>{if(s!==a&&!T.value){if(!Array.isArray(_.value))return;const e=_.value.find(m=>(m.binding_name||m.name)===s),n={};e&&e.input_parameters&&e.input_parameters.forEach(m=>{n[m.name]=m.default}),i.value.config=n}}),me(()=>{b.fetchSttBindings(),b.fetchAvailableSttBindingTypes(),b.fetchGlobalSettings()});function G(){h.value=null,i.value=q(),k.value={},y.value={},S.value=!0,d.value="settings",window.scrollTo({top:0,behavior:"smooth"})}function se(s){h.value=s,i.value=JSON.parse(JSON.stringify(s)),i.value.config||(i.value.config={}),k.value={};const a=_.value.find(e=>(e.binding_name||e.name)===s.name);if(a&&a.commands){const e={};a.commands.forEach(n=>{e[n.name]={},n.parameters&&n.parameters.forEach(m=>{e[n.name][m.name]=m.default!==void 0?m.default:""})}),y.value=e}else y.value={};j.value=null,w.value=null,N.value=null,S.value=!0,d.value="settings",window.scrollTo({top:0,behavior:"smooth"})}function V(){S.value=!1,h.value=null}function ne(s){return typeof s=="string"?s.split(",").map(a=>a.trim()).filter(a=>a):Array.isArray(s)?s.filter(a=>a):[]}async function le(){if(!i.value.alias.trim()||!i.value.name){M.addNotification("Alias and Binding Type are required fields.","warning");return}D.value=!0;try{const s={alias:i.value.alias,name:i.value.name,config:i.value.config||{},is_active:i.value.is_active,default_model_name:i.value.default_model_name||null};T.value?await b.updateSttBinding(h.value.id,s):await b.addSttBinding(s),V()}catch(s){console.error("Submit failed:",s.message)}finally{D.value=!1}}async function oe(s){await M.showConfirmation({title:`Delete STT Binding '${s.alias}'?`,message:"Are you sure? This action cannot be undone.",confirmText:"Delete"})&&await b.deleteSttBinding(s.id)}async function ie(s){await b.updateSttBinding(s.id,{is_active:!s.is_active})}function re(s){if(!Array.isArray(_.value))return s;const a=_.value.find(e=>(e.binding_name||e.name)===s);return a?a.title||a.name:s}async function de(s,a,e){j.value=null,w.value=null,N.value=s.name;try{M.addNotification(`Submitting command '${s.title||s.name}'...`,"info");const n=await b.executeSttBindingCommand(a,s.name,e);n&&n.id&&(j.value=n.id,P.addTask(n),M.addNotification(`Task started: ${s.title||s.name}`,"success"))}catch(n){console.error(n),M.addNotification(`Command submission failed: ${n.message}`,"error")}}return(s,a)=>(l(),o("div",Ce,[S.value?(l(),o("div",Se,[t("div",Te,[t("h3",Ae,r(T.value?"Edit STT Binding: "+i.value.alias:"Add New STT Binding"),1),T.value?(l(),o("div",Be,[t("button",{onClick:a[0]||(a[0]=e=>d.value="settings"),class:g([{"text-blue-600 border-b-2 border-blue-600":d.value==="settings","text-gray-500 hover:text-gray-700":d.value!=="settings"},"px-3 py-2 whitespace-nowrap"])},"Settings",2),t("button",{onClick:a[1]||(a[1]=e=>d.value="commands"),class:g([{"text-blue-600 border-b-2 border-blue-600":d.value==="commands","text-gray-500 hover:text-gray-700":d.value!=="commands"},"px-3 py-2 whitespace-nowrap"])},"Commands",2),t("button",{onClick:a[2]||(a[2]=e=>d.value="zoo"),class:g([{"text-blue-600 border-b-2 border-blue-600":d.value==="zoo","text-gray-500 hover:text-gray-700":d.value!=="zoo"},"px-3 py-2 whitespace-nowrap"])},"Models Zoo",2),t("button",{onClick:a[3]||(a[3]=e=>d.value="models"),class:g([{"text-blue-600 border-b-2 border-blue-600":d.value==="models","text-gray-500 hover:text-gray-700":d.value!=="models"},"px-3 py-2 whitespace-nowrap"])},"Installed Models",2)])):v("",!0)]),d.value==="settings"?(l(),o("div",$e,[t("form",{onSubmit:L(le,["prevent"]),class:"space-y-6"},[t("div",Me,[t("div",null,[a[8]||(a[8]=t("label",{for:"alias",class:"block text-sm font-medium"},[x("Alias "),t("span",{class:"text-red-500"},"*")],-1)),E(t("input",{type:"text",id:"alias","onUpdate:modelValue":a[4]||(a[4]=e=>i.value.alias=e),class:"input-field mt-1",required:"",placeholder:"e.g., local_whisper",autocomplete:"off"},null,512),[[H,i.value.alias]]),a[9]||(a[9]=t("p",{class:"text-xs text-gray-500 mt-1"},"A unique, short name for this configuration.",-1))]),t("div",null,[a[11]||(a[11]=t("label",{for:"name",class:"block text-sm font-medium"},[x("Binding Type "),t("span",{class:"text-red-500"},"*")],-1)),E(t("select",{id:"name","onUpdate:modelValue":a[5]||(a[5]=e=>i.value.name=e),class:"input-field mt-1",required:"",disabled:T.value},[a[10]||(a[10]=t("option",{disabled:"",value:""},"Select a type",-1)),(l(!0),o(A,null,B(C(_),e=>(l(),o("option",{key:e.binding_name||e.name,value:e.binding_name||e.name},r(e.title||e.name),9,je))),128))],8,De),[[J,i.value.name]])])]),p.value?(l(),o("div",Ne,[t("div",{class:"text-sm text-gray-600 dark:text-gray-400 prose dark:prose-invert max-w-none",innerHTML:C(ve)(p.value.description||"")},null,8,Ve),(l(!0),o(A,null,B(te.value,e=>(l(),o("div",{key:e.name,class:"space-y-1"},[t("label",{for:`param-${e.name}`,class:"block text-sm font-medium capitalize"},[x(r(e.name.replace(/_/g," "))+" ",1),e.mandatory?(l(),o("span",Fe,"*")):v("",!0)],8,Ee),e.options&&e.options.length>0?E((l(),o("select",{key:0,id:`param-${e.name}`,"onUpdate:modelValue":n=>i.value.config[e.name]=n,class:"input-field"},[(l(!0),o(A,null,B(ne(e.options),n=>(l(),o("option",{key:n,value:n},r(n),9,Oe))),128))],8,Ie)),[[J,i.value.config[e.name]]]):["str","int","float"].includes(e.type)?(l(),o("div",ze,[t("div",Le,[E(t("input",{type:(e.name.includes("key")||e.name.includes("token"))&&!k.value[e.name]?"password":"text",id:`param-${e.name}`,"onUpdate:modelValue":n=>i.value.config[e.name]=n,class:"input-field",required:e.mandatory,placeholder:e.description,autocomplete:"off"},null,8,Pe),[[ge,i.value.config[e.name]]]),e.name.includes("key")||e.name.includes("token")?(l(),o("button",{key:0,type:"button",onClick:n=>k.value[e.name]=!k.value[e.name],class:"absolute inset-y-0 right-0 px-3 flex items-center text-gray-500 hover:text-gray-700 dark:hover:text-gray-300",title:k.value[e.name]?"Hide":"Show"},[k.value[e.name]?(l(),z(fe,{key:0,class:"w-5 h-5"})):(l(),z(be,{key:1,class:"w-5 h-5"}))],8,Ue)):v("",!0)])])):e.type==="bool"?(l(),o("div",qe,[t("span",Ge,[t("span",Re,r(e.description),1)]),t("button",{onClick:n=>i.value.config[e.name]=!i.value.config[e.name],type:"button",class:g([i.value.config[e.name]?"bg-blue-600":"bg-gray-200 dark:bg-gray-600","relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out"])},[t("span",{class:g([i.value.config[e.name]?"translate-x-5":"translate-x-0","pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition-colors duration-200 ease-in-out"])},null,2)],10,He)])):v("",!0),t("p",Je,r(e.description),1)]))),128))])):v("",!0),t("div",Ke,[a[12]||(a[12]=t("span",{class:"flex-grow flex flex-col"},[t("span",{class:"text-sm font-medium text-gray-900 dark:text-gray-100"},"Active"),t("span",{class:"text-sm text-gray-500 dark:text-gray-400"},"If disabled, this STT service will not be available.")],-1)),t("button",{onClick:a[6]||(a[6]=e=>i.value.is_active=!i.value.is_active),type:"button",class:g([i.value.is_active?"bg-blue-600":"bg-gray-200 dark:bg-gray-600","relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out"])},[t("span",{class:g([i.value.is_active?"translate-x-5":"translate-x-0","pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition-colors duration-200 ease-in-out"])},null,2)],2)]),t("div",Ze,[t("button",{type:"button",onClick:V,class:"btn btn-secondary"},"Cancel"),t("button",{type:"submit",class:"btn btn-primary",disabled:D.value},[D.value?(l(),z(ye,{key:0,class:"w-5 h-5 mr-2"})):v("",!0),x(" "+r(D.value?"Saving...":T.value?"Save Changes":"Add Binding"),1)],8,Qe)])],32)])):d.value==="commands"?(l(),o("div",We,[p.value&&p.value.commands&&p.value.commands.length>0?(l(),o("div",Xe,[(l(!0),o(A,null,B(p.value.commands,e=>(l(),o("div",{key:e.name,class:"p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg border dark:border-gray-600 mb-4"},[t("div",Ye,[t("div",null,[t("h5",et,[$(pe,{class:"w-4 h-4 text-gray-500"}),x(" "+r(e.title||e.name),1)]),t("p",tt,r(e.description),1)]),t("button",{type:"button",onClick:n=>de(e,h.value.id,y.value[e.name]),class:"btn btn-primary btn-sm flex items-center gap-2",disabled:u.value&&u.value.status==="running"},[$(xe,{class:"w-4 h-4"}),a[13]||(a[13]=x(" Execute "))],8,at)]),e.parameters&&e.parameters.length>0?(l(),o("div",st,[(l(!0),o(A,null,B(e.parameters,n=>(l(),o("div",{key:n.name},[t("label",nt,r(n.name),1),n.type!=="bool"?E((l(),o("input",{key:0,type:"text","onUpdate:modelValue":m=>y.value[e.name][n.name]=m,class:"input-field text-sm",placeholder:n.default},null,8,lt)),[[H,y.value[e.name][n.name]]]):(l(),o("div",ot,[t("button",{onClick:m=>y.value[e.name][n.name]=!y.value[e.name][n.name],type:"button",class:g([y.value[e.name][n.name]?"bg-blue-600":"bg-gray-200 dark:bg-gray-600","relative inline-flex h-5 w-9 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out"])},[t("span",{class:g([y.value[e.name][n.name]?"translate-x-4":"translate-x-0","pointer-events-none inline-block h-4 w-4 transform rounded-full bg-white shadow ring-0 transition-colors duration-200 ease-in-out"])},null,2)],10,it),t("span",rt,r(n.description),1)]))]))),128))])):v("",!0),u.value&&N.value===e.name&&(u.value.status==="running"||u.value.status==="pending")?(l(),o("div",dt,[t("div",ut,[a[14]||(a[14]=t("span",null,"Executing...",-1)),t("span",null,r(u.value.progress)+"%",1)]),t("div",ct,[t("div",{class:"bg-blue-600 h-2 rounded-full transition-all duration-300 relative overflow-hidden",style:_e({width:u.value.progress+"%"})},a[15]||(a[15]=[t("div",{class:"absolute inset-0 bg-white/20 animate-[pulse_2s_cubic-bezier(0.4,0,0.6,1)_infinite]"},null,-1)]),4)]),t("p",mt,r(u.value.description),1)])):v("",!0),w.value&&N.value===e.name&&u.value&&u.value.status==="completed"?(l(),o("div",vt,[a[16]||(a[16]=t("h6",{class:"text-xs font-bold text-green-800 dark:text-green-300 mb-2 uppercase flex items-center gap-2"},[t("span",{class:"w-2 h-2 rounded-full bg-green-500"}),x(" Success ")],-1)),typeof w.value=="object"?(l(),o("div",gt,[$(we,{json:w.value},null,8,["json"])])):(l(),o("div",ft,r(w.value),1))])):v("",!0),u.value&&N.value===e.name&&(u.value.status==="failed"||u.value.status==="cancelled")?(l(),o("div",bt,[t("h6",yt,[a[17]||(a[17]=t("span",{class:"w-2 h-2 rounded-full bg-red-500"},null,-1)),x(" "+r(u.value.status),1)]),t("p",pt,r(u.value.error),1)])):v("",!0)]))),128))])):(l(),o("div",xt," No commands available for this binding type. ")),t("div",{class:"flex justify-end gap-3 mt-4"},[t("button",{type:"button",onClick:V,class:"btn btn-secondary"},"Close")])])):d.value==="zoo"?(l(),o("div",_t,[$(C(W),{binding:h.value,"binding-type":"stt"},null,8,["binding"]),t("div",{class:"flex justify-end gap-3 mt-4"},[t("button",{type:"button",onClick:V,class:"btn btn-secondary"},"Close")])])):d.value==="models"?(l(),o("div",ht,[$(C(Q),{binding:h.value,"binding-type":"stt"},null,8,["binding"]),t("div",{class:"flex justify-end gap-3 mt-4"},[t("button",{type:"button",onClick:V,class:"btn btn-secondary"},"Close")])])):v("",!0)])):(l(),o("div",kt,[t("div",wt,[a[20]||(a[20]=t("h2",{class:"text-2xl font-bold"},"STT Bindings",-1)),t("div",Ct,[t("div",null,[a[19]||(a[19]=t("label",{for:"stt-model-display-mode",class:"block text-xs font-medium text-gray-500 dark:text-gray-400"},"Model Display Mode",-1)),t("select",{id:"stt-model-display-mode",value:I.value,onChange:ae,class:"input-field mt-1"},a[18]||(a[18]=[t("option",{value:"mixed"},"Mixed (Alias or Original)",-1),t("option",{value:"aliased"},"Aliased Only",-1),t("option",{value:"original"},"Original Names Only",-1)]),40,St)]),S.value?v("",!0):(l(),o("button",{key:0,onClick:G,class:"btn btn-primary self-end"},"+ Add New STT Binding"))])]),C(X)?(l(),o("div",Tt,"Loading STT bindings...")):C(U).length===0&&!S.value?(l(),o("div",At,[a[21]||(a[21]=t("p",null,"No STT bindings configured yet.",-1)),t("button",{onClick:G,class:"mt-2 text-blue-600 hover:underline"},"Add your first one")])):(l(),o("div",Bt,[(l(!0),o(A,null,B(C(U),e=>(l(),o("div",{key:e.id,onClick:n=>se(e),class:"bg-white dark:bg-gray-800 p-5 rounded-lg shadow-md hover:shadow-lg transition-shadow cursor-pointer flex flex-col gap-4 border border-transparent hover:border-blue-500 group relative"},[t("div",{class:"absolute top-4 right-4 z-10",onClick:a[7]||(a[7]=L(()=>{},["stop"]))},[t("button",{onClick:n=>ie(e),type:"button",class:g([e.is_active?"bg-blue-600":"bg-gray-200 dark:bg-gray-600","relative inline-flex h-5 w-9 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out"]),title:e.is_active?"Deactivate":"Activate"},[t("span",{class:g([e.is_active?"translate-x-4":"translate-x-0","pointer-events-none inline-block h-4 w-4 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out"])},null,2)],10,Mt)]),t("div",Dt,[t("div",jt,[$(he,{class:"w-8 h-8 text-blue-500"}),t("div",null,[t("h4",Nt,r(e.alias),1),t("p",Vt,r(re(e.name)),1)])]),t("div",Et,[e.default_model_name?(l(),o("p",Ft,[a[22]||(a[22]=t("span",{class:"font-semibold"},"Default:",-1)),x(" "+r(e.default_model_name),1)])):v("",!0),t("p",It,r(e.config?Object.keys(e.config).filter(n=>!n.includes("key")).join(", "):""),1)])]),t("div",Ot,[a[23]||(a[23]=t("span",null,"Click to edit",-1)),t("button",{onClick:L(n=>oe(e),["stop"]),class:"text-red-500 hover:underline p-1"},"Delete",8,zt)])],8,$t))),128))]))]))]))}};export{Rt as default};
