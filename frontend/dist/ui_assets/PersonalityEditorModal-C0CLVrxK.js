import{J as Y,O as ee,u as te,P as le,Q as ae,c as T,q as f,w as C,o as oe,R as se,T as ne,n as ie,l as s,g as N,e as t,d as n,h as c,f as y,m as re,V as de,j as g,t as F,G as ue,y as d,K as x,W as V,X as A,F as ce,i as me,Y as pe}from"./index-4tYqOs8q.js";import{_ as ve}from"./GenericModal-CtZwNhiR.js";import{M as H}from"./MultiSelectMenu-B-Bma-3E.js";const fe={class:"grid grid-cols-1 md:grid-cols-3 gap-6"},ge={class:"md:col-span-1 flex flex-col items-center"},ye={class:"w-24 h-24 rounded-full bg-gray-200 dark:bg-gray-700 flex items-center justify-center overflow-hidden mb-2 relative"},be=["src"],xe={key:1,class:"w-16 h-16 text-gray-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},_e={key:2,class:"absolute inset-0 bg-black/50 flex items-center justify-center"},ke={class:"flex gap-2"},we=["disabled"],Se={key:0},he={key:1},Ie={class:"md:col-span-2 grid grid-cols-1 sm:grid-cols-2 gap-6"},Me={class:"sm:col-span-2"},Te=["placeholder"],Ce={key:0},Ve={key:1},Ae={class:"space-y-6 pt-6 border-t dark:border-gray-700"},Pe={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},Ee={key:0},Ue=["value"],De={key:0},Le={class:"flex items-center justify-between mb-1"},Ne={key:2,class:"flex items-center pt-6 border-t dark:border-gray-700"},Fe={class:"w-full flex justify-between"},He={class:"flex gap-2"},je={class:"flex gap-2"},Ge=["disabled"],We={__name:"PersonalityEditorModal",setup(Re){const i=Y(),r=ee(),_=te();le();const{on:j,off:G}=se(),{availableRagStores:R,availableMcpToolsForSelector:$}=ae(r),q=T(()=>i.modalData("personalityEditor")),P=T(()=>{var o;return(o=q.value)==null?void 0:o.personality}),M=()=>({id:null,name:"",category:"",author:"",description:"",prompt_text:"",disclaimer:"",script_code:"",icon_base64:null,is_public:!1,data_source_type:"none",data_source:null,active_mcps:[],required_context_options:[],owner_type:"user"}),l=f(M()),E=f(null),U=f(null),k=f(!1),m=f(!1),w=f(!1),S=f(null),X=[{id:"image_generation",name:"Image Generation"},{id:"image_editing",name:"Image Editing"},{id:"slide_maker",name:"Slide Maker"},{id:"note_generation",name:"Note Generation"},{id:"memory",name:"Long-Term Memory"}],B=T(()=>X);C(()=>l.value.icon_base64,()=>{w.value=!1}),C(()=>P.value,o=>{o?(l.value={...M(),...o},l.value.required_context_options||(l.value.required_context_options=[])):l.value=M()},{immediate:!0,deep:!0}),oe(()=>{r.availableRagStores.length===0&&r.fetchDataStores(),r.availableMcpToolsForSelector.length===0&&r.fetchMcpTools(),j("task:completed",D)}),ne(()=>{G("task:completed",D)});function D(o){if(S.value&&o.id===S.value){let e=o.result;if(typeof e=="string")try{e=JSON.parse(e)}catch(a){console.error("Failed to parse task result JSON",a)}o.status==="completed"&&(e!=null&&e.icon_base64)?(l.value={...l.value,icon_base64:e.icon_base64},w.value=!1,i.addNotification("Icon generated. Don't forget to save!","success")):o.status==="failed"&&i.addNotification("Icon generation failed.","error"),m.value=!1,S.value=null}}C(()=>l.value.data_source_type,(o,e)=>{o!==e&&(l.value.data_source=null)});async function L(){k.value=!0;try{l.value.id?await r.updatePersonality(l.value):await r.addPersonality(l.value),i.closeModal("personalityEditor")}finally{k.value=!1}}function O(){if(!l.value.prompt_text){i.addNotification("Please provide a base prompt to enhance.","warning");return}i.openModal("enhancePersonalityPrompt",{prompt_text:l.value.prompt_text,onApply:o=>{l.value.prompt_text=o}})}async function W(){m.value=!0;try{const o=l.value.name||"AI Assistant",e=l.value.category||"General",a=l.value.description?l.value.description.replace(/\n/g," ").slice(0,150):"helpful AI assistant",u=`Profile icon/avatar of ${o}, ${e}. ${a}. High quality digital art, centered, smooth, professional style.`,h=await r.generatePersonalityIcon(u);h?S.value=h.id:m.value=!1}catch{m.value=!1}}function z(){E.value.click()}function J(o){const e=o.target.files[0];if(!e)return;if(!["image/jpeg","image/png","image/gif","image/webp","image/svg+xml"].includes(e.type)){i.addNotification("Invalid file type. Please select an image.","error");return}const u=new FileReader;u.onload=h=>{const b=new Image;b.onload=()=>{let p=b.width,v=b.height;p>v?p>128&&(v*=128/p,p=128):v>128&&(p*=128/v,v=128);const I=document.createElement("canvas");I.width=p,I.height=v,I.getContext("2d").drawImage(b,0,0,p,v),l.value.icon_base64=I.toDataURL("image/png")},b.src=h.target.result},u.readAsDataURL(e),o.target.value=""}function Z(){var o;(o=U.value)==null||o.click()}function K(o){const e=o.target.files[0];if(!e)return;const a=new FileReader;a.onload=u=>{l.value.data_source=u.target.result,i.addNotification(`Imported text from ${e.name}`,"success")},a.onerror=u=>{i.addNotification(`Error reading file: ${u.target.error.name}`,"error")},a.readAsText(e),o.target.value=""}async function Q(){l.value.id&&await r.exportPersonality(l.value.id)}return(o,e)=>(s(),ie(ve,{"modal-name":"personalityEditor",title:l.value.id?"Edit Personality":"Create Personality",maxWidthClass:"max-w-4xl"},{body:N(()=>[P.value?(s(),n("form",{key:0,onSubmit:ue(L,["prevent"]),class:"space-y-6"},[t("div",fe,[t("div",ge,[t("div",ye,[l.value.icon_base64&&!w.value?(s(),n("img",{key:0,src:l.value.icon_base64,onError:e[0]||(e[0]=a=>w.value=!0),alt:"Icon Preview",class:"h-full w-full object-cover"},null,40,be)):(s(),n("svg",xe,e[16]||(e[16]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15.75 6a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0ZM4.501 20.118a7.5 7.5 0 0 1 14.998 0A17.933 17.933 0 0 1 12 21.75c-2.676 0-5.216-.584-7.499-1.632Z"},null,-1)]))),m.value?(s(),n("div",_e,e[17]||(e[17]=[t("svg",{class:"animate-spin h-8 w-8 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)]))):c("",!0)]),t("div",ke,[t("button",{onClick:z,type:"button",class:"btn btn-secondary btn-sm"},"Upload"),t("button",{onClick:W,type:"button",class:"btn btn-secondary btn-sm",disabled:m.value},[m.value?(s(),n("span",Se,"Generating...")):(s(),n("span",he,"Generate"))],8,we)]),t("input",{type:"file",ref_key:"fileInput",ref:E,onChange:J,class:"hidden",accept:"image/png, image/jpeg, image/gif, image/webp, image/svg+xml"},null,544)]),t("div",Ie,[t("div",null,[e[18]||(e[18]=t("label",{for:"name",class:"block text-sm font-medium"},"Name",-1)),d(t("input",{type:"text",id:"name","onUpdate:modelValue":e[1]||(e[1]=a=>l.value.name=a),class:"input-field mt-1",required:""},null,512),[[x,l.value.name]])]),t("div",null,[e[19]||(e[19]=t("label",{for:"category",class:"block text-sm font-medium"},"Category",-1)),d(t("input",{type:"text",id:"category","onUpdate:modelValue":e[2]||(e[2]=a=>l.value.category=a),class:"input-field mt-1"},null,512),[[x,l.value.category]])]),t("div",Me,[e[20]||(e[20]=t("label",{for:"author",class:"block text-sm font-medium"},"Author",-1)),d(t("input",{type:"text",id:"author","onUpdate:modelValue":e[3]||(e[3]=a=>l.value.author=a),class:"input-field mt-1",placeholder:g(_).user.username},null,8,Te),[[x,l.value.author]])])])]),g(_).user.is_admin&&!l.value.id?(s(),n("div",Ce,[e[22]||(e[22]=t("label",{for:"owner_type",class:"block text-sm font-medium"},"Owner Type",-1)),d(t("select",{id:"owner_type","onUpdate:modelValue":e[4]||(e[4]=a=>l.value.owner_type=a),class:"input-field mt-1"},e[21]||(e[21]=[t("option",{value:"user"},"Personal (for me only)",-1),t("option",{value:"system"},"System (available to all users if public)",-1)]),512),[[V,l.value.owner_type]])])):c("",!0),t("div",null,[e[23]||(e[23]=t("label",{for:"description",class:"block text-sm font-medium"},"Description",-1)),d(t("textarea",{id:"description","onUpdate:modelValue":e[5]||(e[5]=a=>l.value.description=a),rows:"3",class:"input-field mt-1"},null,512),[[x,l.value.description]])]),t("div",null,[e[24]||(e[24]=t("label",{for:"disclaimer",class:"block text-sm font-medium"},"Disclaimer",-1)),d(t("textarea",{id:"disclaimer","onUpdate:modelValue":e[6]||(e[6]=a=>l.value.disclaimer=a),rows:"2",class:"input-field mt-1"},null,512),[[x,l.value.disclaimer]])]),t("div",null,[t("div",{class:"flex items-center justify-between mb-1"},[e[26]||(e[26]=t("label",{for:"prompt",class:"block text-sm font-medium"},"System Prompt",-1)),t("button",{onClick:O,type:"button",class:"btn btn-secondary btn-sm flex items-center gap-2"},e[25]||(e[25]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.898 20.572L16.5 21.75l-.398-1.178a3.375 3.375 0 00-2.3-2.3L12.75 18l1.178-.398a3.375 3.375 0 002.3-2.3L16.5 14.25l.398 1.178a3.375 3.375 0 002.3 2.3l1.178.398-1.178.398a3.375 3.375 0 00-2.3 2.3z"})],-1),t("span",null,"Enhance with AI",-1)]))]),y(A,{modelValue:l.value.prompt_text,"onUpdate:modelValue":e[7]||(e[7]=a=>l.value.prompt_text=a),class:"h-48"},null,8,["modelValue"])]),g(_).user.is_admin?(s(),n("div",Ve,[e[27]||(e[27]=t("label",{for:"script_code",class:"block text-sm font-medium"},"Script Code (Python)",-1)),y(A,{modelValue:l.value.script_code,"onUpdate:modelValue":e[8]||(e[8]=a=>l.value.script_code=a),class:"h-48 mt-1",language:"python"},null,8,["modelValue"])])):c("",!0),t("div",Ae,[e[36]||(e[36]=t("h3",{class:"text-lg font-medium text-gray-900 dark:text-gray-100"},"Advanced Settings",-1)),t("div",Pe,[t("div",null,[e[29]||(e[29]=t("label",{for:"data_source_type",class:"block text-sm font-medium"},"Data Source Type",-1)),d(t("select",{id:"data_source_type","onUpdate:modelValue":e[9]||(e[9]=a=>l.value.data_source_type=a),class:"input-field mt-1"},e[28]||(e[28]=[t("option",{value:"none"},"None",-1),t("option",{value:"datastore"},"Data Store",-1),t("option",{value:"static_text"},"Static Text",-1)]),512),[[V,l.value.data_source_type]])]),l.value.data_source_type==="datastore"?(s(),n("div",Ee,[e[31]||(e[31]=t("label",{for:"data_source",class:"block text-sm font-medium"},"Select Data Store",-1)),d(t("select",{id:"data_source","onUpdate:modelValue":e[10]||(e[10]=a=>l.value.data_source=a),class:"input-field mt-1"},[e[30]||(e[30]=t("option",{value:null},"Select a store",-1)),(s(!0),n(ce,null,me(g(R),a=>(s(),n("option",{key:a.id,value:a.id},F(a.name),9,Ue))),128))],512),[[V,l.value.data_source]])])):c("",!0)]),l.value.data_source_type==="static_text"?(s(),n("div",De,[t("div",Le,[e[32]||(e[32]=t("label",{for:"data_source_static",class:"block text-sm font-medium"},"Static Text Content",-1)),t("button",{onClick:Z,type:"button",class:"btn btn-secondary btn-sm"},"Import from File"),t("input",{type:"file",ref_key:"staticTextInputRef",ref:U,onChange:K,class:"hidden",accept:".txt,.md,.json,.csv,.py,.js,text/*"},null,544)]),y(A,{modelValue:l.value.data_source,"onUpdate:modelValue":e[11]||(e[11]=a=>l.value.data_source=a),id:"data_source_static",class:"h-32"},null,8,["modelValue"])])):c("",!0),t("div",null,[e[33]||(e[33]=t("label",{class:"block text-sm font-medium mb-1"},"Mandatory Context Features",-1)),e[34]||(e[34]=t("p",{class:"text-xs text-gray-500 dark:text-gray-400 mb-2"},"Selecting these will auto-activate them when this personality is used. Disabling them manually later will revert to the default personality.",-1)),y(H,{modelValue:l.value.required_context_options,"onUpdate:modelValue":e[12]||(e[12]=a=>l.value.required_context_options=a),items:B.value,placeholder:"Select required features (e.g. Image Gen)",class:"mt-1"},null,8,["modelValue","items"])]),t("div",null,[e[35]||(e[35]=t("label",{class:"block text-sm font-medium"},"Active MCPs",-1)),y(H,{modelValue:l.value.active_mcps,"onUpdate:modelValue":e[13]||(e[13]=a=>l.value.active_mcps=a),items:g($),placeholder:"Select tools",class:"mt-1"},null,8,["modelValue","items"])])]),g(_).user.is_admin?(s(),n("div",Ne,[d(t("input",{id:"is_public",type:"checkbox","onUpdate:modelValue":e[14]||(e[14]=a=>l.value.is_public=a),class:"h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500"},null,512),[[pe,l.value.is_public]]),e[37]||(e[37]=t("label",{for:"is_public",class:"ml-2 block text-sm text-gray-900 dark:text-gray-200"},"Make Public (Available to all users)",-1))])):c("",!0)],32)):c("",!0)]),footer:N(()=>[t("div",Fe,[t("div",He,[l.value.id?(s(),n("button",{key:0,onClick:Q,type:"button",class:"btn btn-secondary-outline"},[y(de,{class:"w-4 h-4 mr-2"}),e[38]||(e[38]=re(" Export "))])):c("",!0)]),t("div",je,[t("button",{onClick:e[15]||(e[15]=a=>g(i).closeModal("personalityEditor")),type:"button",class:"btn btn-secondary"},"Cancel"),t("button",{onClick:L,type:"button",class:"btn btn-primary",disabled:k.value},F(k.value?"Saving...":"Save"),9,Ge)])])]),_:1},8,["title"]))}};export{We as default};
