import{k as R,u as X,a4 as se,s as L,r as $,h as p,g as oe,l as W,d as v,o as l,a as e,e as I,z as d,Z as ae,I as ne,Q as J,$ as F,t as k,_ as K,b as H,m as Q,a7 as O,x as Y,f as E,v as re,c as M,j as le,a9 as ee,d9 as te,S as ie,ad as de,i as w,F as ce,A as ue,n as T,a0 as ve,cT as ge,G as fe,da as q,a1 as he,as as N,L as ye}from"./index-BztlMlxc.js";import{I as pe,a as xe}from"./IconRedo-DWKtwnCf.js";import{useMemoriesStore as be}from"./memories-YD3_LxPd.js";import{I as me}from"./IconMaximize-B76U18Ha.js";import{I as _e}from"./IconMinimize-BHVNg3Mk.js";const ke={class:"flex flex-col h-full overflow-hidden"},we={class:"flex-shrink-0 flex items-center justify-between gap-2 p-1.5 bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-t-lg"},$e={class:"flex items-center gap-0.5"},Ce=["disabled"],De=["disabled"],Me=["disabled"],Ie=["disabled"],Te=["disabled"],Se={key:0,class:"flex items-center gap-2 pr-2"},ze={class:"text-[10px] font-bold text-blue-500"},Ze={__name:"DiscussionZone",setup(S){const u=R(),b=X(),f=se(),{activeDiscussion:s}=L(u),{tasks:_}=L(f),h=$(null),a=$(!1),x=$([]),c=$(-1);let r=null,y=null;const g=p({get:()=>{var t;return((t=s.value)==null?void 0:t.discussion_data_zone)||""},set:t=>{s.value&&(u.setDiscussionDataZoneContent(s.value.id,t),clearTimeout(y),y=setTimeout(()=>{s.value&&oe.put(`/api/discussions/${s.value.id}/data_zone`,{content:t}).then(()=>{u.fetchContextStatus(s.value.id)})},1500))}}),m=p(()=>{if(!s.value)return!1;const t=u.activeAiTasks[s.value.id];if(!t||!t.taskId)return!1;const o=_.value.find(D=>D.id===t.taskId);return o?o.status==="running"||o.status==="pending":!1}),C=p(()=>{if(!s.value)return null;const t=u.activeAiTasks[s.value.id];return!t||!t.taskId?null:_.value.find(o=>o.id===t.taskId)}),z=p(()=>c.value>0),Z=p(()=>c.value<x.value.length-1);function j(t){clearTimeout(r),r=setTimeout(()=>{x.value[c.value]!==t&&(c.value<x.value.length-1&&x.value.splice(c.value+1),x.value.push(t),c.value++)},750)}async function V(){z.value&&(a.value=!0,c.value--,g.value=x.value[c.value],await Q(),a.value=!1)}async function A(){Z.value&&(a.value=!0,c.value++,g.value=x.value[c.value],await Q(),a.value=!1)}W(g,(t,o)=>{!a.value&&t!==o&&j(t)},{flush:"post"}),W(s,(t,o)=>{t&&(!o||t.id!==o.id)&&(x.value=[t.discussion_data_zone||""],c.value=0)},{immediate:!0});function U(t){h.value=t.view}function B(){s.value&&u.cloneDiscussion(s.value.id)}function n(){s.value&&u.refreshDataZones(s.value.id)}async function i(t){const o=Array.from(t.dataTransfer.files);o.length>0&&s.value&&(b.addNotification(`Extracting text from ${o.length} file(s)...`,"info"),await u.uploadAndEmbedFilesToDataZone(s.value.id,o,!1))}return(t,o)=>{var D;return l(),v("div",ke,[e("div",we,[e("div",$e,[e("button",{onClick:V,class:"p-1.5 rounded hover:bg-gray-100 dark:hover:bg-gray-800 disabled:opacity-30",title:"Undo",disabled:!z.value||m.value},[d(pe,{class:"w-4 h-4"})],8,Ce),e("button",{onClick:A,class:"p-1.5 rounded hover:bg-gray-100 dark:hover:bg-gray-800 disabled:opacity-30",title:"Redo",disabled:!Z.value||m.value},[d(xe,{class:"w-4 h-4"})],8,De),o[3]||(o[3]=e("div",{class:"w-px h-4 bg-gray-200 dark:bg-gray-700 mx-1"},null,-1)),e("button",{onClick:B,class:"p-1.5 rounded hover:bg-gray-100 dark:hover:bg-gray-800 disabled:opacity-30",title:"Clone Data Zone",disabled:m.value},[d(ae,{class:"w-4 h-4"})],8,Me),e("button",{onClick:n,class:"p-1.5 rounded hover:bg-gray-100 dark:hover:bg-gray-800 disabled:opacity-30",title:"Refresh",disabled:m.value},[d(ne,{class:"w-4 h-4"})],8,Ie),e("button",{onClick:o[0]||(o[0]=G=>g.value=""),class:"p-1.5 rounded hover:bg-red-50 dark:hover:bg-red-900/20 text-red-500 disabled:opacity-30",title:"Clear Context",disabled:m.value},[d(J,{class:"w-4 h-4"})],8,Te)]),m.value?(l(),v("div",Se,[d(F,{class:"w-3.5 h-3.5 text-blue-500 animate-spin"}),e("span",ze,k((D=C.value)==null?void 0:D.progress)+"%",1)])):I("",!0)]),e("div",{onDragover:o[2]||(o[2]=H(()=>{},["prevent"])),onDrop:H(i,["prevent"]),class:"flex-1 min-h-0 border-x border-b border-gray-200 dark:border-gray-700 rounded-b-lg overflow-hidden relative"},[d(K,{ref:"discussionCodeMirrorEditor",modelValue:g.value,"onUpdate:modelValue":o[1]||(o[1]=G=>g.value=G),class:"h-full","read-only":m.value,renderable:!0,onReady:U},null,8,["modelValue","read-only"])],32)])}}},Ee={class:"h-full flex flex-col border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden"},Le={__name:"PersonalityZone",setup(S){const u=R(),b=p(()=>u.activeDiscussion),f=p(()=>{var s;return((s=b.value)==null?void 0:s.personality_data_zone)||""});return(s,_)=>(l(),v("div",Ee,[d(K,{modelValue:f.value,"onUpdate:modelValue":_[0]||(_[0]=h=>f.value=h),class:"h-full","read-only":!0},null,8,["modelValue"])]))}},Re={class:"flex flex-col h-full gap-3 overflow-hidden"},je={class:"flex items-center justify-between bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 p-2 rounded-lg shadow-sm flex-shrink-0"},Ve=["disabled"],Ae={class:"flex-1 flex flex-col gap-3 min-h-0"},Ue={class:"flex-1 flex flex-col min-h-[150px] border border-gray-200 dark:border-gray-700 rounded-lg bg-white dark:bg-gray-900/50 shadow-inner overflow-hidden"},Be={class:"p-2 border-b dark:border-gray-700 flex items-center justify-between bg-gray-50 dark:bg-gray-800/30"},Ne={class:"flex gap-2"},Pe={key:0,class:"text-[9px] font-mono text-gray-500"},We={key:1,class:"text-[9px] font-mono text-blue-500"},Fe={class:"flex-1 overflow-y-auto custom-scrollbar p-3"},He={key:0,class:"h-full flex flex-col items-center justify-center text-gray-400 opacity-40"},Xe={class:"h-64 border border-gray-200 dark:border-gray-700 rounded-lg bg-white dark:bg-gray-900 flex flex-col shadow-sm overflow-hidden flex-shrink-0"},Ge={class:"p-2 border-b dark:border-gray-700 flex justify-between items-center bg-gray-50/50 dark:bg-gray-800/30"},Qe={class:"text-[10px] font-black uppercase text-gray-500"},qe={class:"flex-1 overflow-y-auto custom-scrollbar p-1"},Je={key:0,class:"text-center py-6"},Ke={key:1,class:"text-center py-6 text-xs text-gray-400"},Oe={key:2,class:"space-y-1"},Ye={class:"flex items-center gap-3 min-w-0"},et={class:"text-[10px] font-mono text-gray-400 font-bold w-5 text-center shrink-0"},tt=["onClick"],st={class:"flex flex-col min-w-0"},ot=["title"],at={class:"text-[10px] truncate text-gray-400"},nt={class:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity"},rt=["onClick"],lt=["onClick"],it={__name:"MemoryZone",setup(S){const u=R(),b=be(),f=X(),{memories:s,isLoading:_}=L(b),h=$(""),a=$(new Set);function x(n){return n?Math.ceil(n.length/4):0}const c=p(()=>u.activeDiscussion),r=p(()=>{var n;return c.value&&((n=u.activeAiTasks[c.value.id])==null?void 0:n.type)==="memorize"}),y=p(()=>[...s.value].sort((n,i)=>new Date(n.created_at)-new Date(i.created_at))),g=p(()=>{const n=y.value.filter(i=>a.value.has(i.title));return n.length===0?"":n.map(i=>`[Memory #${y.value.findIndex(o=>o.id===i.id)+1}] ${i.title}: ${i.content}`).join(`

`)}),m=p(()=>x(g.value)),C=p(()=>{if(!h.value)return y.value;const n=h.value.toLowerCase();return y.value.filter(i=>i.title.toLowerCase().includes(n)||i.content.toLowerCase().includes(n))});function z(){c.value&&u.memorizeLTM(c.value.id)}function Z(){f.openModal("memoryEditor")}function j(n){f.openModal("memoryEditor",{memory:n})}async function V(n){const i=s.value.find(o=>o.id===n);if(!i)return;await f.showConfirmation({title:"Delete Memory?",message:`Permanently delete "${i.title}"?`,confirmText:"Delete"})&&await b.deleteMemory(n)}function A(n){a.value.add(n)}function U(n){a.value.delete(n)}async function B(){await b.fetchMemories(),a.value.size===0&&s.value.length>0&&s.value.forEach(n=>a.value.add(n.title))}return W(s,n=>{},{deep:!0}),Y(()=>{B()}),(n,i)=>(l(),v("div",Re,[e("div",je,[E(e("input",{type:"text","onUpdate:modelValue":i[0]||(i[0]=t=>h.value=t),placeholder:"Filter bank...",class:"w-32 px-2 py-1 text-xs bg-gray-50 dark:bg-gray-900 border-none focus:ring-1 focus:ring-blue-500 rounded"},null,512),[[re,h.value]]),e("button",{onClick:z,class:"btn btn-primary btn-xs py-1 px-3 shadow-sm",disabled:r.value},[r.value?(l(),M(F,{key:0,class:"w-3.5 h-3.5 mr-1 animate-spin"})):(l(),M(ee,{key:1,class:"w-3.5 h-3.5 mr-1"})),i[1]||(i[1]=le(" Memorize Chat "))],8,Ve)]),e("div",Ae,[e("div",Ue,[e("div",Be,[i[2]||(i[2]=e("span",{class:"text-[9px] font-black uppercase text-gray-400 tracking-tighter"},"Active Context Preview",-1)),e("div",Ne,[g.value?(l(),v("span",Pe,k(g.value.length)+" chars",1)):I("",!0),g.value?(l(),v("span",We,"~"+k(m.value)+" tokens",1)):I("",!0)])]),e("div",Fe,[g.value?(l(),M(ie,{key:1,content:g.value,class:"prose-xs"},null,8,["content"])):(l(),v("div",He,[d(te,{class:"w-10 h-10 mb-2"}),i[3]||(i[3]=e("p",{class:"text-[10px] uppercase font-black tracking-widest"},"No Active Memories",-1))]))])]),e("div",Xe,[e("div",Ge,[e("span",Qe,"Memory Bank ("+k(C.value.length)+")",1),e("button",{onClick:Z,class:"p-1 rounded hover:bg-gray-200 dark:hover:bg-gray-700 text-blue-500",title:"Manual Memory Entry"},[d(de,{class:"w-4 h-4"})])]),e("div",qe,[w(_)?(l(),v("div",Je,[d(F,{class:"w-6 h-6 text-gray-300 animate-spin mx-auto"})])):C.value.length===0?(l(),v("div",Ke,"Empty")):(l(),v("div",Oe,[(l(!0),v(ce,null,ue(C.value,(t,o)=>(l(),v("div",{key:t.id,class:T(["group p-2 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800/50 flex items-center justify-between transition-all border border-transparent",{"border-green-500/20 bg-green-50/10 dark:bg-green-900/5":a.value.has(t.title)}])},[e("div",Ye,[e("span",et,"#"+k(o+1),1),e("button",{onClick:D=>a.value.has(t.title)?U(t.title):A(t.title),class:T(["flex-shrink-0 transition-colors",a.value.has(t.title)?"text-green-500":"text-gray-300 hover:text-gray-400"])},[a.value.has(t.title)?(l(),M(ve,{key:0,class:"w-5 h-5"})):(l(),M(ge,{key:1,class:"w-5 h-5"}))],10,tt),e("div",st,[e("span",{class:"text-xs font-bold truncate text-gray-700 dark:text-gray-200",title:t.title},k(t.title),9,ot),e("span",at,k(x(t.content))+" tokens",1)])]),e("div",nt,[e("button",{onClick:D=>j(t),class:"p-1.5 rounded hover:bg-white dark:hover:bg-gray-700 shadow-sm text-blue-500",title:"Edit"},[d(fe,{class:"w-3.5 h-3.5"})],8,rt),e("button",{onClick:D=>V(t.id),class:"p-1.5 rounded hover:bg-red-50 dark:hover:bg-red-900/30 shadow-sm text-red-500",title:"Delete"},[d(J,{class:"w-3.5 h-3.5"})],8,lt)])],2))),128))]))])])])]))}},dt=O(it,[["__scopeId","data-v-ba908132"]]),P={__name:"IconChevronDown",props:{class:{type:String,default:"w-6 h-6"}},setup(S){return(u,b)=>(l(),v("svg",{xmlns:"http://www.w3.org/2000/svg",class:T(S.class),viewBox:"0 0 20 20",fill:"currentColor"},b[0]||(b[0]=[e("path",{"fill-rule":"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z","clip-rule":"evenodd"},null,-1)]),2))}},ct={class:"flex-1 flex flex-col min-w-0 overflow-hidden"},ut={class:"flex-shrink-0 bg-gray-50 dark:bg-gray-800/80 backdrop-blur-sm border-b border-gray-200 dark:border-gray-700 flex justify-between items-center p-2 h-12"},vt={class:"flex items-center gap-2 px-2"},gt={class:"flex items-center gap-1"},ft=["title"],ht={class:"flex-1 overflow-y-auto custom-scrollbar flex flex-col bg-gray-50/30 dark:bg-gray-900/30"},yt={class:"flex flex-col border-b border-gray-200 dark:border-gray-800 transition-all"},pt={class:"flex items-center gap-3"},xt={class:"p-1.5 rounded-md bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400"},bt={key:0,class:"text-xs text-gray-400 font-mono"},mt={class:"h-96 p-2 pt-0"},_t={class:"flex flex-col border-b border-gray-200 dark:border-gray-800 transition-all"},kt={class:"flex items-center gap-3"},wt={class:"p-1.5 rounded-md bg-purple-100 dark:bg-purple-900/30 text-purple-600 dark:text-purple-400"},$t={key:0,class:"text-xs text-gray-400 font-mono"},Ct={class:"h-64 p-2 pt-0"},Dt={class:"flex flex-col flex-1 min-h-0"},Mt={class:"flex items-center gap-3"},It={class:"p-1.5 rounded-md bg-green-100 dark:bg-green-900/30 text-green-600 dark:text-green-400"},Tt={key:0,class:"text-xs text-gray-400 font-mono"},St={class:"flex-1 p-2 pt-0 min-h-[300px]"},zt={__name:"DataZone",setup(S){const u=X(),b=R(),{liveDataZoneTokens:f}=L(b),s=$(450),_=$(!1),h=p(()=>u.isDataZoneExpanded),a=$({discussion:!0,personality:!0,memory:!0});function x(c){_.value=!0;const r=c.clientX,y=s.value,g=C=>{_.value&&(s.value=Math.max(320,y-(C.clientX-r)))},m=()=>{_.value=!1,window.removeEventListener("mousemove",g),window.removeEventListener("mouseup",m),localStorage.setItem("lollms_dataZoneWidth",s.value)};window.addEventListener("mousemove",g),window.addEventListener("mouseup",m)}return Y(()=>{const c=localStorage.getItem("lollms_dataZoneWidth");c&&(s.value=parseInt(c,10))}),(c,r)=>(l(),v("div",{class:T(["relative h-full flex flex-shrink-0 border-l border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900 z-10 shadow-2xl",[h.value?"absolute inset-0 w-full":""]]),style:ye(h.value?{}:{width:`${s.value}px`})},[h.value?I("",!0):(l(),v("div",{key:0,onMousedown:H(x,["prevent"]),class:"absolute top-0 bottom-0 -left-1 w-2 cursor-col-resize z-20 hover:bg-blue-500/30 transition-colors"},null,32)),e("div",ct,[e("div",ut,[e("div",vt,[d(q,{class:"w-4 h-4 text-gray-400"}),r[5]||(r[5]=e("h3",{class:"text-[10px] font-black text-gray-500 dark:text-gray-400 uppercase tracking-widest"},"Context Explorer",-1))]),e("div",gt,[e("button",{onClick:r[0]||(r[0]=y=>w(u).toggleDataZoneExpansion()),class:"p-1.5 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-500 transition-colors",title:h.value?"Shrink":"Expand"},[h.value?(l(),M(_e,{key:0,class:"w-4 h-4"})):(l(),M(me,{key:1,class:"w-4 h-4"}))],8,ft),e("button",{onClick:r[1]||(r[1]=y=>w(u).toggleDataZone()),class:"p-1.5 rounded-lg hover:bg-red-500 hover:text-white text-gray-500 transition-colors",title:"Close Sidebar"},[d(he,{class:"w-4 h-4"})])])]),e("div",ht,[e("div",yt,[e("button",{onClick:r[2]||(r[2]=y=>a.value.discussion=!a.value.discussion),class:"flex-shrink-0 w-full flex items-center justify-between p-4 hover:bg-gray-100 dark:hover:bg-gray-800/50 transition-colors group"},[e("div",pt,[e("div",xt,[d(q,{class:"w-4 h-4"})]),r[6]||(r[6]=e("span",{class:"text-sm font-bold text-gray-700 dark:text-gray-200"},"Discussion Zone",-1)),w(f).discussion>0?(l(),v("span",bt,"("+k(w(f).discussion)+" tok)",1)):I("",!0)]),d(P,{class:T(["w-4 h-4 text-gray-400 transition-transform duration-300",{"rotate-180":!a.value.discussion}])},null,8,["class"])]),E(e("div",mt,[d(Ze)],512),[[N,!a.value.discussion]])]),e("div",_t,[e("button",{onClick:r[3]||(r[3]=y=>a.value.personality=!a.value.personality),class:"flex-shrink-0 w-full flex items-center justify-between p-4 hover:bg-gray-100 dark:hover:bg-gray-800/50 transition-colors group"},[e("div",kt,[e("div",wt,[d(ee,{class:"w-4 h-4"})]),r[7]||(r[7]=e("span",{class:"text-sm font-bold text-gray-700 dark:text-gray-200"},"AI Personality",-1)),w(f).personality>0?(l(),v("span",$t,"("+k(w(f).personality)+" tok)",1)):I("",!0)]),d(P,{class:T(["w-4 h-4 text-gray-400 transition-transform duration-300",{"rotate-180":!a.value.personality}])},null,8,["class"])]),E(e("div",Ct,[d(Le)],512),[[N,!a.value.personality]])]),e("div",Dt,[e("button",{onClick:r[4]||(r[4]=y=>a.value.memory=!a.value.memory),class:"flex-shrink-0 w-full flex items-center justify-between p-4 hover:bg-gray-100 dark:hover:bg-gray-800/50 transition-colors group"},[e("div",Mt,[e("div",It,[d(te,{class:"w-4 h-4"})]),r[8]||(r[8]=e("span",{class:"text-sm font-bold text-gray-700 dark:text-gray-200"},"Long-Term Memory",-1)),w(f).memory>0?(l(),v("span",Tt,"("+k(w(f).memory)+" tok)",1)):I("",!0)]),d(P,{class:T(["w-4 h-4 text-gray-400 transition-transform duration-300",{"rotate-180":!a.value.memory}])},null,8,["class"])]),E(e("div",St,[d(dt)],512),[[N,!a.value.memory]])])])])],6))}},Vt=O(zt,[["__scopeId","data-v-5372207d"]]);export{Vt as default};
