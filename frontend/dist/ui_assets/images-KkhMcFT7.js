import{a9 as z,s as i,K as F,aa as G,u as W,w as T,ac as b,E as r}from"./index-DfxtQ8tA.js";const B=z("images",()=>{const o=i([]),p=i(!1),s=i(!1),n=F(),v=G(),y=W(),{on:A,emit:N}=b(),c=i(""),d=i(""),l=i("1024x1024"),m=i(1),g=i(-1),f=i({});let _=null;T(()=>y.user,e=>{e&&(c.value=e.image_studio_prompt||"",d.value=e.image_studio_negative_prompt||"",l.value=e.image_studio_image_size||"1024x1024",m.value=e.image_studio_n_images||1,g.value=e.image_studio_seed??-1,f.value=e.image_studio_generation_params||{})},{immediate:!0}),T([c,d,l,m,g,f],()=>{y.isAuthenticated&&(clearTimeout(_),_=setTimeout(()=>{const e={image_studio_prompt:c.value,image_studio_negative_prompt:d.value,image_studio_image_size:l.value,image_studio_n_images:m.value,image_studio_seed:g.value,image_studio_generation_params:f.value};y.updateUserPreferences(e)},1500))},{deep:!0});function w(e){let a=e.result;if(typeof a=="string")try{a=JSON.parse(a)}catch{}const t=e.name.startsWith("Generating")&&e.name.includes("image(s)"),h=e.name.startsWith("Editing image:");if((t||h)&&e.status==="completed"&&a){const u=Array.isArray(a)?a:[a];if(u.length>0&&u[0]){const I=[...u].reverse();o.value.unshift(...I),N("image:generated",I[0]),n.addNotification(`${u.length} new image(s) added.`,"success")}}else(t||h)&&e.status==="failed"&&n.addNotification("Image generation failed. Check task manager for details.","error")}A("task:completed",w);async function S(){p.value=!0;try{const e=await r.get("/api/image-studio");o.value=Array.isArray(e.data)?e.data:[]}catch(e){console.error("Failed to fetch images:",e),o.value=[]}finally{p.value=!1}}async function k(e){s.value=!0;try{const a=await r.post("/api/image-studio/generate",e);return v.addTask(a.data),n.addNotification(`Image generation started for ${e.n} image(s).`,"info"),a.data}finally{s.value=!1}}async function E(e){s.value=!0;try{const a=await r.post("/api/image-studio/edit",e);return v.addTask(a.data),n.addNotification("Image edit task started...","info"),a.data}finally{s.value=!1}}async function C(e){s.value=!0;try{const a=await r.post("/api/image-studio/save-canvas",e);return o.value.unshift(a.data),n.addNotification("Image saved successfully!","success"),a.data}catch{return null}finally{s.value=!1}}async function $(e){if(!Array.isArray(e)||e.length===0)return;const a=new FormData;e.forEach(t=>{a.append("files",t)}),s.value=!0;try{const t=await r.post("/api/image-studio/upload",a,{headers:{"Content-Type":"multipart/form-data"}});Array.isArray(t.data)&&t.data.length>0&&(o.value.unshift(...t.data.reverse()),n.addNotification(`${t.data.length} image(s) uploaded successfully!`,"success"))}catch{}finally{s.value=!1}}async function D(e){try{await r.delete(`/api/image-studio/${e}`),o.value=o.value.filter(a=>a.id!==e),n.addNotification("Image deleted.","success")}catch{}}async function P(e,a){try{await r.post(`/api/image-studio/${e}/move-to-discussion`,{discussion_id:a}),n.addNotification("Image added to the active discussion.","success")}catch{}}async function x(e){try{const t=(await r.post("/api/image-studio/enhance-prompt",e)).data;return v.addTask(t),t}catch(a){throw console.error("Enhancement request failed",a),a}}return{images:o,isLoading:p,isGenerating:s,prompt:c,negativePrompt:d,imageSize:l,nImages:m,seed:g,generationParams:f,fetchImages:S,generateImage:k,editImage:E,saveCanvasAsNewImage:C,uploadImages:$,deleteImage:D,moveImageToDiscussion:P,enhanceImagePrompt:x}});export{B as u};
