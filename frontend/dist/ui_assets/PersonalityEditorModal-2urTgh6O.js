import{K as $,P as W,u as Z,Q as q,c as L,s as v,w as I,o as K,n as O,l as s,g as U,e as t,j as c,t as D,d as n,h as f,H as Q,z as i,L as y,R as T,f as k,T as V,F as J,i as Y,V as ee}from"./index-CEXks4lv.js";import{_ as te}from"./GenericModal-Br5hR2Sz.js";import{M as le}from"./MultiSelectMenu-C0DBz24e.js";const ae={class:"grid grid-cols-1 md:grid-cols-3 gap-6"},oe={class:"md:col-span-1 flex flex-col items-center"},se={class:"w-24 h-24 rounded-full bg-gray-200 dark:bg-gray-700 flex items-center justify-center overflow-hidden mb-2"},ne=["src"],ie={key:1,class:"w-16 h-16 text-gray-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},re={class:"flex gap-2"},de=["disabled"],ue={key:0,class:"animate-spin h-4 w-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},me={key:1},ce={class:"md:col-span-2 grid grid-cols-1 sm:grid-cols-2 gap-6"},pe={class:"sm:col-span-2"},ve=["placeholder"],fe={key:0},ge={key:1},ye={class:"space-y-6 pt-6 border-t dark:border-gray-700"},be={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},xe={key:0},_e=["value"],we={key:0},ke={class:"flex items-center justify-between mb-1"},Se={key:2,class:"flex items-center pt-6 border-t dark:border-gray-700"},Me=["disabled"],Pe={__name:"PersonalityEditorModal",setup(Ie){const r=$(),d=W(),b=Z(),{availableRagStores:E,availableMcpToolsForSelector:H}=q(d),F=L(()=>r.modalData("personalityEditor")),C=L(()=>{var o;return(o=F.value)==null?void 0:o.personality}),S=()=>({id:null,name:"",category:"",author:"",description:"",prompt_text:"",disclaimer:"",script_code:"",icon_base64:null,is_public:!1,data_source_type:"none",data_source:null,active_mcps:[],owner_type:"user"}),l=v(S()),h=v(null),A=v(null),x=v(!1),_=v(!1),M=v(!1);I(()=>l.value.icon_base64,()=>{M.value=!1}),I(()=>C.value,o=>{o?l.value={...S(),...o}:l.value=S()},{immediate:!0,deep:!0}),K(()=>{d.availableRagStores.length===0&&d.fetchDataStores(),d.availableMcpToolsForSelector.length===0&&d.fetchMcpTools()}),I(()=>l.value.data_source_type,(o,e)=>{o!==e&&(l.value.data_source=null)});async function P(){x.value=!0;try{l.value.id?await d.updatePersonality(l.value):await d.addPersonality(l.value),r.closeModal("personalityEditor")}finally{x.value=!1}}function j(){if(!l.value.prompt_text){r.addNotification("Please provide a base prompt to enhance.","warning");return}r.openModal("enhancePersonalityPrompt",{prompt_text:l.value.prompt_text,onApply:o=>{l.value.prompt_text=o}})}async function R(){_.value=!0;try{const o=l.value.name||l.value.description,e=await d.generatePersonalityIcon(o);e&&(l.value.icon_base64=e)}finally{_.value=!1}}function N(){h.value.click()}function X(o){const e=o.target.files[0];if(!e)return;if(!["image/jpeg","image/png","image/gif","image/webp","image/svg+xml"].includes(e.type)){r.addNotification("Invalid file type. Please select an image.","error");return}const p=new FileReader;p.onload=G=>{const g=new Image;g.onload=()=>{let u=g.width,m=g.height;u>m?u>128&&(m*=128/u,u=128):m>128&&(u*=128/m,m=128);const w=document.createElement("canvas");w.width=u,w.height=m,w.getContext("2d").drawImage(g,0,0,u,m),l.value.icon_base64=w.toDataURL("image/png")},g.src=G.target.result},p.readAsDataURL(e),o.target.value=""}function B(){var o;(o=A.value)==null||o.click()}function z(o){const e=o.target.files[0];if(!e)return;const a=new FileReader;a.onload=p=>{l.value.data_source=p.target.result,r.addNotification(`Imported text from ${e.name}`,"success")},a.onerror=p=>{r.addNotification(`Error reading file: ${p.target.error.name}`,"error")},a.readAsText(e),o.target.value=""}return(o,e)=>(s(),O(te,{"modal-name":"personalityEditor",title:l.value.id?"Edit Personality":"Create Personality",maxWidthClass:"max-w-4xl"},{body:U(()=>[C.value?(s(),n("form",{key:0,onSubmit:Q(P,["prevent"]),class:"space-y-6"},[t("div",ae,[t("div",oe,[t("div",se,[l.value.icon_base64&&!M.value?(s(),n("img",{key:0,src:l.value.icon_base64,onError:e[0]||(e[0]=a=>M.value=!0),alt:"Icon Preview",class:"h-full w-full object-cover"},null,40,ne)):(s(),n("svg",ie,e[15]||(e[15]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15.75 6a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0ZM4.501 20.118a7.5 7.5 0 0 1 14.998 0A17.933 17.933 0 0 1 12 21.75c-2.676 0-5.216-.584-7.499-1.632Z"},null,-1)])))]),t("div",re,[t("button",{onClick:N,type:"button",class:"btn btn-secondary btn-sm"},"Upload"),t("button",{onClick:R,type:"button",class:"btn btn-secondary btn-sm",disabled:_.value},[_.value?(s(),n("svg",ue,e[16]||(e[16]=[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):(s(),n("span",me,"Generate"))],8,de)]),t("input",{type:"file",ref_key:"fileInput",ref:h,onChange:X,class:"hidden",accept:"image/png, image/jpeg, image/gif, image/webp, image/svg+xml"},null,544)]),t("div",ce,[t("div",null,[e[17]||(e[17]=t("label",{for:"name",class:"block text-sm font-medium"},"Name",-1)),i(t("input",{type:"text",id:"name","onUpdate:modelValue":e[1]||(e[1]=a=>l.value.name=a),class:"input-field mt-1",required:""},null,512),[[y,l.value.name]])]),t("div",null,[e[18]||(e[18]=t("label",{for:"category",class:"block text-sm font-medium"},"Category",-1)),i(t("input",{type:"text",id:"category","onUpdate:modelValue":e[2]||(e[2]=a=>l.value.category=a),class:"input-field mt-1"},null,512),[[y,l.value.category]])]),t("div",pe,[e[19]||(e[19]=t("label",{for:"author",class:"block text-sm font-medium"},"Author",-1)),i(t("input",{type:"text",id:"author","onUpdate:modelValue":e[3]||(e[3]=a=>l.value.author=a),class:"input-field mt-1",placeholder:c(b).user.username},null,8,ve),[[y,l.value.author]])])])]),c(b).user.is_admin&&!l.value.id?(s(),n("div",fe,[e[21]||(e[21]=t("label",{for:"owner_type",class:"block text-sm font-medium"},"Owner Type",-1)),i(t("select",{id:"owner_type","onUpdate:modelValue":e[4]||(e[4]=a=>l.value.owner_type=a),class:"input-field mt-1"},e[20]||(e[20]=[t("option",{value:"user"},"Personal (for me only)",-1),t("option",{value:"system"},"System (available to all users if public)",-1)]),512),[[T,l.value.owner_type]])])):f("",!0),t("div",null,[e[22]||(e[22]=t("label",{for:"description",class:"block text-sm font-medium"},"Description",-1)),i(t("textarea",{id:"description","onUpdate:modelValue":e[5]||(e[5]=a=>l.value.description=a),rows:"3",class:"input-field mt-1"},null,512),[[y,l.value.description]])]),t("div",null,[e[23]||(e[23]=t("label",{for:"disclaimer",class:"block text-sm font-medium"},"Disclaimer",-1)),i(t("textarea",{id:"disclaimer","onUpdate:modelValue":e[6]||(e[6]=a=>l.value.disclaimer=a),rows:"2",class:"input-field mt-1"},null,512),[[y,l.value.disclaimer]])]),t("div",null,[t("div",{class:"flex items-center justify-between mb-1"},[e[25]||(e[25]=t("label",{for:"prompt",class:"block text-sm font-medium"},"System Prompt",-1)),t("button",{onClick:j,type:"button",class:"btn btn-secondary btn-sm flex items-center gap-2"},e[24]||(e[24]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.898 20.572L16.5 21.75l-.398-1.178a3.375 3.375 0 00-2.3-2.3L12.75 18l1.178-.398a3.375 3.375 0 002.3-2.3L16.5 14.25l.398 1.178a3.375 3.375 0 002.3 2.3l1.178.398-1.178.398a3.375 3.375 0 00-2.3 2.3z"})],-1),t("span",null,"Enhance with AI",-1)]))]),k(V,{modelValue:l.value.prompt_text,"onUpdate:modelValue":e[7]||(e[7]=a=>l.value.prompt_text=a),class:"h-48"},null,8,["modelValue"])]),c(b).user.is_admin?(s(),n("div",ge,[e[26]||(e[26]=t("label",{for:"script_code",class:"block text-sm font-medium"},"Script Code (Python)",-1)),k(V,{modelValue:l.value.script_code,"onUpdate:modelValue":e[8]||(e[8]=a=>l.value.script_code=a),class:"h-48 mt-1",language:"python"},null,8,["modelValue"])])):f("",!0),t("div",ye,[e[33]||(e[33]=t("h3",{class:"text-lg font-medium text-gray-900 dark:text-gray-100"},"Advanced Settings",-1)),t("div",be,[t("div",null,[e[28]||(e[28]=t("label",{for:"data_source_type",class:"block text-sm font-medium"},"Data Source Type",-1)),i(t("select",{id:"data_source_type","onUpdate:modelValue":e[9]||(e[9]=a=>l.value.data_source_type=a),class:"input-field mt-1"},e[27]||(e[27]=[t("option",{value:"none"},"None",-1),t("option",{value:"datastore"},"Data Store",-1),t("option",{value:"static_text"},"Static Text",-1)]),512),[[T,l.value.data_source_type]])]),l.value.data_source_type==="datastore"?(s(),n("div",xe,[e[30]||(e[30]=t("label",{for:"data_source",class:"block text-sm font-medium"},"Select Data Store",-1)),i(t("select",{id:"data_source","onUpdate:modelValue":e[10]||(e[10]=a=>l.value.data_source=a),class:"input-field mt-1"},[e[29]||(e[29]=t("option",{value:null},"Select a store",-1)),(s(!0),n(J,null,Y(c(E),a=>(s(),n("option",{key:a.id,value:a.id},D(a.name),9,_e))),128))],512),[[T,l.value.data_source]])])):f("",!0)]),l.value.data_source_type==="static_text"?(s(),n("div",we,[t("div",ke,[e[31]||(e[31]=t("label",{for:"data_source_static",class:"block text-sm font-medium"},"Static Text Content",-1)),t("button",{onClick:B,type:"button",class:"btn btn-secondary btn-sm"},"Import from File"),t("input",{type:"file",ref_key:"staticTextInputRef",ref:A,onChange:z,class:"hidden",accept:".txt,.md,.json,.csv,.py,.js,text/*"},null,544)]),k(V,{modelValue:l.value.data_source,"onUpdate:modelValue":e[11]||(e[11]=a=>l.value.data_source=a),id:"data_source_static",class:"h-32"},null,8,["modelValue"])])):f("",!0),t("div",null,[e[32]||(e[32]=t("label",{class:"block text-sm font-medium"},"Active MCPs",-1)),k(le,{modelValue:l.value.active_mcps,"onUpdate:modelValue":e[12]||(e[12]=a=>l.value.active_mcps=a),items:c(H),placeholder:"Select tools",class:"mt-1"},null,8,["modelValue","items"])])]),c(b).user.is_admin?(s(),n("div",Se,[i(t("input",{id:"is_public",type:"checkbox","onUpdate:modelValue":e[13]||(e[13]=a=>l.value.is_public=a),class:"h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500"},null,512),[[ee,l.value.is_public]]),e[34]||(e[34]=t("label",{for:"is_public",class:"ml-2 block text-sm text-gray-900 dark:text-gray-200"},"Make Public (Available to all users)",-1))])):f("",!0)],32)):f("",!0)]),footer:U(()=>[t("button",{onClick:e[14]||(e[14]=a=>c(r).closeModal("personalityEditor")),type:"button",class:"btn btn-secondary"},"Cancel"),t("button",{onClick:P,type:"button",class:"btn btn-primary",disabled:x.value},D(x.value?"Saving...":"Save"),9,Me)]),_:1},8,["title"]))}};export{Pe as default};
