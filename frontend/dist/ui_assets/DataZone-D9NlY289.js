import{Z as R,u as X,a1 as se,a2 as E,L as $,c as p,R as ae,k as W,e as v,o as i,b as e,l as T,f as d,aw as oe,an as ne,as as Q,ax as F,t as _,a7 as Y,K as H,$ as K,ad as q,at as re,j as G,P as z,Y as le,a as M,p as ie,y as ee,dj as te,T as de,O as ce,d as w,F as ue,m as ve,J as I,ay as ge,cy as fe,ao as ye,dk as O,cr as he,cl as pe,az as xe,dl as N,Q as B,al as be}from"./index-Daq2SOhh.js";import{I as me,a as _e}from"./IconRedo-BpPZlkZS.js";const ke={class:"flex flex-col h-full overflow-hidden"},we={class:"flex-shrink-0 flex items-center justify-between gap-2 p-1.5 bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-t-lg"},$e={class:"flex items-center gap-0.5"},Ce=["disabled"],De=["disabled"],Me=["disabled"],Te=["disabled"],Ie=["disabled"],Se={key:0,class:"flex items-center gap-2 pr-2"},Ze={class:"text-[10px] font-bold text-blue-500"},ze={__name:"DiscussionZone",setup(L){const u=R(),k=X(),f=se(),{activeDiscussion:s}=E(u),{tasks:m}=E(f),y=$(null),o=$(!1),x=$([]),c=$(-1);let r=null,h=null;const g=p({get:()=>{var t;return((t=s.value)==null?void 0:t.discussion_data_zone)||""},set:t=>{s.value&&(u.setDiscussionDataZoneContent(s.value.id,t),clearTimeout(h),h=setTimeout(()=>{s.value&&ae.put(`/api/discussions/${s.value.id}/data_zone`,{content:t}).then(()=>{u.fetchContextStatus(s.value.id)})},1500))}}),b=p(()=>{if(!s.value)return!1;const t=u.activeAiTasks[s.value.id];if(!t||!t.taskId)return!1;const a=m.value.find(D=>D.id===t.taskId);return a?a.status==="running"||a.status==="pending":!1}),C=p(()=>{if(!s.value)return null;const t=u.activeAiTasks[s.value.id];return!t||!t.taskId?null:m.value.find(a=>a.id===t.taskId)}),S=p(()=>c.value>0),Z=p(()=>c.value<x.value.length-1);function j(t){clearTimeout(r),r=setTimeout(()=>{x.value[c.value]!==t&&(c.value<x.value.length-1&&x.value.splice(c.value+1),x.value.push(t),c.value++)},750)}async function V(){S.value&&(o.value=!0,c.value--,g.value=x.value[c.value],await K(),o.value=!1)}async function A(){Z.value&&(o.value=!0,c.value++,g.value=x.value[c.value],await K(),o.value=!1)}W(g,(t,a)=>{!o.value&&t!==a&&j(t)},{flush:"post"}),W(s,(t,a)=>{t&&(!a||t.id!==a.id)&&(x.value=[t.discussion_data_zone||""],c.value=0)},{immediate:!0});function U(t){y.value=t.view}function P(){s.value&&u.cloneDiscussion(s.value.id)}function n(){s.value&&u.refreshDataZones(s.value.id)}async function l(t){const a=Array.from(t.dataTransfer.files);a.length>0&&s.value&&(k.addNotification(`Extracting text from ${a.length} file(s)...`,"info"),await u.uploadAndEmbedFilesToDataZone(s.value.id,a,!1))}return(t,a)=>{var D;return i(),v("div",ke,[e("div",we,[e("div",$e,[e("button",{onClick:V,class:"p-1.5 rounded hover:bg-gray-100 dark:hover:bg-gray-800 disabled:opacity-30",title:"Undo",disabled:!S.value||b.value},[d(me,{class:"w-4 h-4"})],8,Ce),e("button",{onClick:A,class:"p-1.5 rounded hover:bg-gray-100 dark:hover:bg-gray-800 disabled:opacity-30",title:"Redo",disabled:!Z.value||b.value},[d(_e,{class:"w-4 h-4"})],8,De),a[3]||(a[3]=e("div",{class:"w-px h-4 bg-gray-200 dark:bg-gray-700 mx-1"},null,-1)),e("button",{onClick:P,class:"p-1.5 rounded hover:bg-gray-100 dark:hover:bg-gray-800 disabled:opacity-30",title:"Clone Data Zone",disabled:b.value},[d(oe,{class:"w-4 h-4"})],8,Me),e("button",{onClick:n,class:"p-1.5 rounded hover:bg-gray-100 dark:hover:bg-gray-800 disabled:opacity-30",title:"Refresh",disabled:b.value},[d(ne,{class:"w-4 h-4"})],8,Te),e("button",{onClick:a[0]||(a[0]=J=>g.value=""),class:"p-1.5 rounded hover:bg-red-50 dark:hover:bg-red-900/20 text-red-500 disabled:opacity-30",title:"Clear Context",disabled:b.value},[d(Q,{class:"w-4 h-4"})],8,Ie)]),b.value?(i(),v("div",Se,[d(F,{class:"w-3.5 h-3.5 text-blue-500 animate-spin"}),e("span",Ze,_((D=C.value)==null?void 0:D.progress)+"%",1)])):T("",!0)]),e("div",{onDragover:a[2]||(a[2]=H(()=>{},["prevent"])),onDrop:H(l,["prevent"]),class:"flex-1 min-h-0 border-x border-b border-gray-200 dark:border-gray-700 rounded-b-lg overflow-hidden relative"},[d(Y,{ref:"discussionCodeMirrorEditor",modelValue:g.value,"onUpdate:modelValue":a[1]||(a[1]=J=>g.value=J),class:"h-full","read-only":b.value,renderable:!0,onReady:U},null,8,["modelValue","read-only"])],32)])}}},Ee={class:"h-full flex flex-col border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden"},Re={__name:"PersonalityZone",setup(L){const u=R(),k=p(()=>u.activeDiscussion),f=p(()=>{var s;return((s=k.value)==null?void 0:s.personality_data_zone)||""});return(s,m)=>(i(),v("div",Ee,[d(Y,{modelValue:f.value,"onUpdate:modelValue":m[0]||(m[0]=y=>f.value=y),class:"h-full","read-only":!0},null,8,["modelValue"])]))}},Le={class:"flex flex-col h-full gap-3 overflow-hidden"},je={class:"flex items-center justify-between bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 p-2 rounded-lg shadow-sm flex-shrink-0"},Ve=["disabled"],Ae={class:"flex-1 flex flex-col gap-3 min-h-0"},Ue={class:"flex-1 flex flex-col min-h-[150px] border border-gray-200 dark:border-gray-700 rounded-lg bg-white dark:bg-gray-900/50 shadow-inner overflow-hidden"},Pe={class:"p-2 border-b dark:border-gray-700 flex items-center justify-between bg-gray-50 dark:bg-gray-800/30"},Ne={class:"flex gap-2"},Be={key:0,class:"text-[9px] font-mono text-gray-500"},We={key:1,class:"text-[9px] font-mono text-blue-500"},Fe={class:"flex-1 overflow-y-auto custom-scrollbar p-3"},He={key:0,class:"h-full flex flex-col items-center justify-center text-gray-400 opacity-40"},Xe={class:"h-64 border border-gray-200 dark:border-gray-700 rounded-lg bg-white dark:bg-gray-900 flex flex-col shadow-sm overflow-hidden flex-shrink-0"},Je={class:"p-2 border-b dark:border-gray-700 flex justify-between items-center bg-gray-50/50 dark:bg-gray-800/30"},Ke={class:"text-[10px] font-black uppercase text-gray-500"},Oe={class:"flex-1 overflow-y-auto custom-scrollbar p-1"},Qe={key:0,class:"text-center py-6"},Ye={key:1,class:"text-center py-6 text-xs text-gray-400"},qe={key:2,class:"space-y-1"},Ge={class:"flex items-center gap-3 min-w-0"},et={class:"text-[10px] font-mono text-gray-400 font-bold w-5 text-center shrink-0"},tt=["onClick"],st={class:"flex flex-col min-w-0"},at=["title"],ot={class:"text-[10px] truncate text-gray-400"},nt={class:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity"},rt=["onClick"],lt=["onClick"],it={__name:"MemoryZone",setup(L){const u=R(),k=re(),f=X(),{memories:s,isLoading:m}=E(k),y=$(""),o=$(new Set);function x(n){return n?Math.ceil(n.length/4):0}const c=p(()=>u.activeDiscussion),r=p(()=>{var n;return c.value&&((n=u.activeAiTasks[c.value.id])==null?void 0:n.type)==="memorize"}),h=p(()=>[...s.value].sort((n,l)=>new Date(n.created_at)-new Date(l.created_at))),g=p(()=>{const n=h.value.filter(l=>o.value.has(l.title));return n.length===0?"":n.map(l=>`[Memory #${h.value.findIndex(a=>a.id===l.id)+1}] ${l.title}: ${l.content}`).join(`

`)}),b=p(()=>x(g.value)),C=p(()=>{if(!y.value)return h.value;const n=y.value.toLowerCase();return h.value.filter(l=>l.title.toLowerCase().includes(n)||l.content.toLowerCase().includes(n))});function S(){c.value&&u.memorizeLTM(c.value.id)}function Z(){f.openModal("memoryEditor")}function j(n){f.openModal("memoryEditor",{memory:n})}async function V(n){const l=s.value.find(a=>a.id===n);if(!l)return;await f.showConfirmation({title:"Delete Memory?",message:`Permanently delete "${l.title}"?`,confirmText:"Delete"})&&await k.deleteMemory(n)}function A(n){o.value.add(n)}function U(n){o.value.delete(n)}async function P(){await k.fetchMemories(),o.value.size===0&&s.value.length>0&&s.value.forEach(n=>o.value.add(n.title))}return W(s,n=>{},{deep:!0}),G(()=>{P()}),(n,l)=>(i(),v("div",Le,[e("div",je,[z(e("input",{type:"text","onUpdate:modelValue":l[0]||(l[0]=t=>y.value=t),placeholder:"Filter bank...",class:"w-32 px-2 py-1 text-xs bg-gray-50 dark:bg-gray-900 border-none focus:ring-1 focus:ring-blue-500 rounded"},null,512),[[le,y.value]]),e("button",{onClick:S,class:"btn btn-primary btn-xs py-1 px-3 shadow-sm",disabled:r.value},[r.value?(i(),M(F,{key:0,class:"w-3.5 h-3.5 mr-1 animate-spin"})):(i(),M(ee,{key:1,class:"w-3.5 h-3.5 mr-1"})),l[1]||(l[1]=ie(" Memorize Chat "))],8,Ve)]),e("div",Ae,[e("div",Ue,[e("div",Pe,[l[2]||(l[2]=e("span",{class:"text-[9px] font-black uppercase text-gray-400 tracking-tighter"},"Active Context Preview",-1)),e("div",Ne,[g.value?(i(),v("span",Be,_(g.value.length)+" chars",1)):T("",!0),g.value?(i(),v("span",We,"~"+_(b.value)+" tokens",1)):T("",!0)])]),e("div",Fe,[g.value?(i(),M(de,{key:1,content:g.value,class:"prose-xs"},null,8,["content"])):(i(),v("div",He,[d(te,{class:"w-10 h-10 mb-2"}),l[3]||(l[3]=e("p",{class:"text-[10px] uppercase font-black tracking-widest"},"No Active Memories",-1))]))])]),e("div",Xe,[e("div",Je,[e("span",Ke,"Memory Bank ("+_(C.value.length)+")",1),e("button",{onClick:Z,class:"p-1 rounded hover:bg-gray-200 dark:hover:bg-gray-700 text-blue-500",title:"Manual Memory Entry"},[d(ce,{class:"w-4 h-4"})])]),e("div",Oe,[w(m)?(i(),v("div",Qe,[d(F,{class:"w-6 h-6 text-gray-300 animate-spin mx-auto"})])):C.value.length===0?(i(),v("div",Ye,"Empty")):(i(),v("div",qe,[(i(!0),v(ue,null,ve(C.value,(t,a)=>(i(),v("div",{key:t.id,class:I(["group p-2 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800/50 flex items-center justify-between transition-all border border-transparent",{"border-green-500/20 bg-green-50/10 dark:bg-green-900/5":o.value.has(t.title)}])},[e("div",Ge,[e("span",et,"#"+_(a+1),1),e("button",{onClick:D=>o.value.has(t.title)?U(t.title):A(t.title),class:I(["flex-shrink-0 transition-colors",o.value.has(t.title)?"text-green-500":"text-gray-300 hover:text-gray-400"])},[o.value.has(t.title)?(i(),M(ge,{key:0,class:"w-5 h-5"})):(i(),M(fe,{key:1,class:"w-5 h-5"}))],10,tt),e("div",st,[e("span",{class:"text-xs font-bold truncate text-gray-700 dark:text-gray-200",title:t.title},_(t.title),9,at),e("span",ot,_(x(t.content))+" tokens",1)])]),e("div",nt,[e("button",{onClick:D=>j(t),class:"p-1.5 rounded hover:bg-white dark:hover:bg-gray-700 shadow-sm text-blue-500",title:"Edit"},[d(ye,{class:"w-3.5 h-3.5"})],8,rt),e("button",{onClick:D=>V(t.id),class:"p-1.5 rounded hover:bg-red-50 dark:hover:bg-red-900/30 shadow-sm text-red-500",title:"Delete"},[d(Q,{class:"w-3.5 h-3.5"})],8,lt)])],2))),128))]))])])])]))}},dt=q(it,[["__scopeId","data-v-ba908132"]]),ct={class:"flex-1 flex flex-col min-w-0 overflow-hidden"},ut={class:"flex-shrink-0 bg-gray-50 dark:bg-gray-800/80 backdrop-blur-sm border-b border-gray-200 dark:border-gray-700 flex justify-between items-center p-2 h-12"},vt={class:"flex items-center gap-2 px-2"},gt={class:"flex items-center gap-1"},ft=["title"],yt={class:"flex-1 overflow-y-auto custom-scrollbar flex flex-col bg-gray-50/30 dark:bg-gray-900/30"},ht={class:"flex flex-col border-b border-gray-200 dark:border-gray-800 transition-all"},pt={class:"flex items-center gap-3"},xt={class:"p-1.5 rounded-md bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400"},bt={key:0,class:"text-xs text-gray-400 font-mono"},mt={class:"h-96 p-2 pt-0"},_t={class:"flex flex-col border-b border-gray-200 dark:border-gray-800 transition-all"},kt={class:"flex items-center gap-3"},wt={class:"p-1.5 rounded-md bg-purple-100 dark:bg-purple-900/30 text-purple-600 dark:text-purple-400"},$t={key:0,class:"text-xs text-gray-400 font-mono"},Ct={class:"h-64 p-2 pt-0"},Dt={class:"flex flex-col flex-1 min-h-0"},Mt={class:"flex items-center gap-3"},Tt={class:"p-1.5 rounded-md bg-green-100 dark:bg-green-900/30 text-green-600 dark:text-green-400"},It={key:0,class:"text-xs text-gray-400 font-mono"},St={class:"flex-1 p-2 pt-0 min-h-[300px]"},Zt={__name:"DataZone",setup(L){const u=X(),k=R(),{liveDataZoneTokens:f}=E(k),s=$(450),m=$(!1),y=p(()=>u.isDataZoneExpanded),o=$({discussion:!0,personality:!0,memory:!0});function x(c){m.value=!0;const r=c.clientX,h=s.value,g=C=>{m.value&&(s.value=Math.max(320,h-(C.clientX-r)))},b=()=>{m.value=!1,window.removeEventListener("mousemove",g),window.removeEventListener("mouseup",b),localStorage.setItem("lollms_dataZoneWidth",s.value)};window.addEventListener("mousemove",g),window.addEventListener("mouseup",b)}return G(()=>{const c=localStorage.getItem("lollms_dataZoneWidth");c&&(s.value=parseInt(c,10))}),(c,r)=>(i(),v("div",{class:I(["relative h-full flex flex-shrink-0 border-l border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900 z-10 shadow-2xl",[y.value?"absolute inset-0 w-full":""]]),style:be(y.value?{}:{width:`${s.value}px`})},[y.value?T("",!0):(i(),v("div",{key:0,onMousedown:H(x,["prevent"]),class:"absolute top-0 bottom-0 -left-1 w-2 cursor-col-resize z-20 hover:bg-blue-500/30 transition-colors"},null,32)),e("div",ct,[e("div",ut,[e("div",vt,[d(O,{class:"w-4 h-4 text-gray-400"}),r[5]||(r[5]=e("h3",{class:"text-[10px] font-black text-gray-500 dark:text-gray-400 uppercase tracking-widest"},"Context Explorer",-1))]),e("div",gt,[e("button",{onClick:r[0]||(r[0]=h=>w(u).toggleDataZoneExpansion()),class:"p-1.5 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-500 transition-colors",title:y.value?"Shrink":"Expand"},[y.value?(i(),M(he,{key:0,class:"w-4 h-4"})):(i(),M(pe,{key:1,class:"w-4 h-4"}))],8,ft),e("button",{onClick:r[1]||(r[1]=h=>w(u).toggleDataZone()),class:"p-1.5 rounded-lg hover:bg-red-500 hover:text-white text-gray-500 transition-colors",title:"Close Sidebar"},[d(xe,{class:"w-4 h-4"})])])]),e("div",yt,[e("div",ht,[e("button",{onClick:r[2]||(r[2]=h=>o.value.discussion=!o.value.discussion),class:"flex-shrink-0 w-full flex items-center justify-between p-4 hover:bg-gray-100 dark:hover:bg-gray-800/50 transition-colors group"},[e("div",pt,[e("div",xt,[d(O,{class:"w-4 h-4"})]),r[6]||(r[6]=e("span",{class:"text-sm font-bold text-gray-700 dark:text-gray-200"},"Discussion Zone",-1)),w(f).discussion>0?(i(),v("span",bt,"("+_(w(f).discussion)+" tok)",1)):T("",!0)]),d(N,{class:I(["w-4 h-4 text-gray-400 transition-transform duration-300",{"rotate-180":!o.value.discussion}])},null,8,["class"])]),z(e("div",mt,[d(ze)],512),[[B,!o.value.discussion]])]),e("div",_t,[e("button",{onClick:r[3]||(r[3]=h=>o.value.personality=!o.value.personality),class:"flex-shrink-0 w-full flex items-center justify-between p-4 hover:bg-gray-100 dark:hover:bg-gray-800/50 transition-colors group"},[e("div",kt,[e("div",wt,[d(ee,{class:"w-4 h-4"})]),r[7]||(r[7]=e("span",{class:"text-sm font-bold text-gray-700 dark:text-gray-200"},"AI Personality",-1)),w(f).personality>0?(i(),v("span",$t,"("+_(w(f).personality)+" tok)",1)):T("",!0)]),d(N,{class:I(["w-4 h-4 text-gray-400 transition-transform duration-300",{"rotate-180":!o.value.personality}])},null,8,["class"])]),z(e("div",Ct,[d(Re)],512),[[B,!o.value.personality]])]),e("div",Dt,[e("button",{onClick:r[4]||(r[4]=h=>o.value.memory=!o.value.memory),class:"flex-shrink-0 w-full flex items-center justify-between p-4 hover:bg-gray-100 dark:hover:bg-gray-800/50 transition-colors group"},[e("div",Mt,[e("div",Tt,[d(te,{class:"w-4 h-4"})]),r[8]||(r[8]=e("span",{class:"text-sm font-bold text-gray-700 dark:text-gray-200"},"Long-Term Memory",-1)),w(f).memory>0?(i(),v("span",It,"("+_(w(f).memory)+" tok)",1)):T("",!0)]),d(N,{class:I(["w-4 h-4 text-gray-400 transition-transform duration-300",{"rotate-180":!o.value.memory}])},null,8,["class"])]),z(e("div",St,[d(dt)],512),[[B,!o.value.memory]])])])])],6))}},Rt=q(Zt,[["__scopeId","data-v-5372207d"]]);export{Rt as default};
