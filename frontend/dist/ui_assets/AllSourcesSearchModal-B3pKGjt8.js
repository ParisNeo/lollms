import{u as L,c as p,L as x,m as T,ap as B,a as V,o as m,w as $,b as l,d as A,a0 as N,e as f,g as D,ac as q,t as b,f as I,ay as C,F,r as H}from"./index-t2mbfuhq.js";import{_ as U}from"./GenericModal-Cx2wygHN.js";const W={class:"p-4 space-y-4"},j={class:"relative"},z={key:0,class:"absolute inset-y-0 right-0 flex items-center pr-3 text-sm"},G=["disabled"],J=["disabled"],K={class:"max-h-[60vh] overflow-y-auto space-y-4 pr-2 all-sources-search-container"},O={class:"font-semibold text-lg mb-2"},P=["id","innerHTML"],Z={__name:"AllSourcesSearchModal",setup(Q){const k=L(),M=p(()=>k.modalData("allSourcesSearch")),n=p(()=>{var t;return((t=M.value)==null?void 0:t.sources)||[]}),r=x(""),g=x([]),o=x(-1),s=p(()=>g.value.length);T(r,t=>{if(!t){g.value=[],o.value=-1;return}const e=new RegExp(t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"gi"),a=[];let c=0;n.value.forEach((u,i)=>{if(u.content){let v;for(;(v=e.exec(u.content))!==null;)a.push({sourceIndex:i,sourceTitle:u.title,matchIndex:c++,matchIndexInContent:v.index})}}),g.value=a,a.length>0?(o.value=0,B(()=>y(0))):o.value=-1});function E(t){if(!t)return"";if(!r.value)return t;const e=new RegExp(`(${r.value.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")})`,"gi");return t.replace(e,'<mark class="bg-yellow-300 dark:bg-yellow-600 rounded">$1</mark>')}function y(t){const e=g.value[t];if(!e)return;const a=document.getElementById(`all-sources-content-${e.sourceIndex}`);if(a){const c=a.querySelectorAll("mark");let u=0;for(let d=0;d<e.sourceIndex;d++)if(n.value[d].content){const h=new RegExp(r.value.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"gi");u+=(n.value[d].content.match(h)||[]).length}(n.value[e.sourceIndex].content.match(new RegExp(r.value.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"gi"))||[]).length;let i=-1;const v=new RegExp(r.value.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"gi");let _=0,S;for(;(S=v.exec(n.value[e.sourceIndex].content))!==null;){if(S.index===e.matchIndexInContent){i=_;break}_++}if(i>-1){document.querySelectorAll(".all-sources-search-container mark").forEach(R=>R.classList.remove("current-search-highlight"));const h=c[i];h&&(h.classList.add("current-search-highlight"),h.scrollIntoView({behavior:"smooth",block:"center"}))}}}function w(t){if(s.value===0)return;let e=o.value+t;e<0&&(e=s.value-1),e>=s.value&&(e=0),o.value=e,y(e)}return(t,e)=>(m(),V(U,{modalName:"allSourcesSearch",title:"Search All Sources",maxWidthClass:"max-w-5xl"},{body:$(()=>[l("div",W,[l("div",j,[N(l("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=a=>r.value=a),placeholder:"Search in all source contents...",class:"input-field w-full pr-32",autofocus:""},null,512),[[q,r.value]]),r.value?(m(),f("div",z,[l("span",null,b(s.value>0?o.value+1:0)+" / "+b(s.value),1),l("button",{onClick:e[1]||(e[1]=a=>w(-1)),class:"ml-2 p-1 rounded hover:bg-gray-200 dark:hover:bg-gray-600",disabled:s.value===0},[I(C,{class:"w-4 h-4 transform rotate-180"})],8,G),l("button",{onClick:e[2]||(e[2]=a=>w(1)),class:"p-1 rounded hover:bg-gray-200 dark:hover:bg-gray-600",disabled:s.value===0},[I(C,{class:"w-4 h-4"})],8,J)])):D("",!0)]),l("div",K,[(m(!0),f(F,null,H(n.value,(a,c)=>(m(),f("div",{key:c,class:"p-4 border rounded-lg dark:border-gray-700"},[l("h3",O,b(a.title),1),l("div",{id:`all-sources-content-${c}`,class:"whitespace-pre-wrap break-words text-sm bg-gray-50 dark:bg-gray-800/50 p-2 rounded-md",innerHTML:E(a.content)},null,8,P)]))),128))])])]),footer:$(()=>[l("button",{onClick:e[3]||(e[3]=a=>A(k).closeModal("allSourcesSearch")),type:"button",class:"btn btn-secondary"},"Close")]),_:1}))}};export{Z as default};
