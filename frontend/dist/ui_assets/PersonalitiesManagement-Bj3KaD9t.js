import{_ as ye,R as me,u as ge,ay as fe,az as T,r as w,b as r,S as C,d as be,c as a,o,a as l,h as y,n as q,g as h,aM as E,G as I,H as ke,J as c,K as M,L as z,F as x,j as _,t as p,A as O,f as we,aC as B,p as he,X as xe}from"./index-C3WkowhT.js";import{u as _e}from"./admin-C-YlnQsG.js";import{A as Se}from"./AppCard-CgPqOjpI.js";import{A as Pe}from"./AppCardSkeleton-DhJ3RFEm.js";import"./IconNoSymbol-Bb97bC_B.js";import"./IconArrowPath-B4l9FQRi.js";const Re={class:"space-y-6"},Ce={class:"border-b border-gray-200 dark:border-gray-700"},Ie={class:"-mb-px flex space-x-6"},Me={key:0},$e={class:"flex justify-between items-center mb-4"},Ae={class:"flex gap-2"},Ue={class:"space-y-4"},Ve={class:"grid grid-cols-1 lg:grid-cols-4 gap-4"},Ze={class:"relative lg:col-span-1"},Ne={class:"grid grid-cols-1 sm:grid-cols-3 lg:col-span-3 gap-4"},Te=["value"],ze=["value"],Le={key:0,class:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 2xl:grid-cols-4 gap-6"},De={key:1,class:"empty-state-card"},Fe={key:2},je={class:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 2xl:grid-cols-4 gap-6"},qe={key:0,class:"flex justify-between items-center mt-6"},Ee=["disabled"],Oe={class:"text-sm text-gray-600 dark:text-gray-400"},Be=["disabled"],Ge={key:1},Ke={class:"flex justify-between items-center mb-4"},He={key:0,class:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm mb-6"},Je={class:"flex items-center gap-x-4"},Qe={key:0},We=["required"],Xe={key:1},Ye=["required"],et={key:1,class:"text-center p-4"},tt={key:2,class:"empty-state-card"},st={key:3,class:"space-y-4"},lt={class:"font-semibold"},ot={class:"text-sm text-gray-500"},at={class:"text-xs text-gray-400"},nt={class:"flex items-center gap-2"},it=["onClick"],rt=["onClick"],ut={__name:"PersonalitiesManagement",setup(dt){const u=_e(),G=me(),v=ge(),$=fe(),{personalityFilters:i}=u,{personalityZooRepositories:K,isLoadingPersonalityZooRepositories:H,zooPersonalities:S,isLoadingZooPersonalities:J}=T(u),{publicPersonalities:Q}=T($),{tasks:W}=T(G),m=w("zoo"),n=w({type:"git",name:"",url:"",path:""}),b=w(!1),g=w(null),A=r({get:()=>i.searchQuery,set:t=>{i.searchQuery=t}}),P=r({get:()=>i.selectedCategory,set:t=>{i.selectedCategory=t}}),U=r({get:()=>i.installationStatusFilter,set:t=>{i.installationStatusFilter=t}}),V=r({get:()=>i.selectedRepository,set:t=>{i.selectedRepository=t}}),X=r({get:()=>i.sortKey,set:t=>{i.sortKey=t}}),Y=r({get:()=>i.sortOrder,set:t=>{i.sortOrder=t}}),d=r({get:()=>i.currentPage,set:t=>{i.currentPage=t}}),L=r({get:()=>i.pageSize,set:t=>{i.pageSize=t}}),k=w(JSON.parse(localStorage.getItem("starredPersonalities")||"[]"));let D=null;const Z=r(()=>S.value.total||0),F=r(()=>S.value.pages||1),ee=r(()=>{if(Z.value===0)return"Showing 0-0 of 0";const t=(d.value-1)*L.value+1,e=Math.min(d.value*L.value,Z.value);return`Showing ${t}-${e} of ${Z.value}`});async function f(){await u.fetchZooPersonalities()}const j=r(()=>{const t=new Map;return(W.value||[]).forEach(e=>{var s;if((s=e==null?void 0:e.name)!=null&&s.startsWith("Installing personality: ")&&(e.status==="running"||e.status==="pending")){const R=e.name.replace("Installing personality: ","");t.set(R,e)}}),(S.value.items||[]).map(e=>({...e,task:t.get(e.folder_name)||null}))});function te(){clearTimeout(D),D=setTimeout(()=>{d.value=1,f()},300)}C([X,Y,P,U,V],()=>{d.value=1,f()}),C(A,te),C(d,f),C(k,t=>{localStorage.setItem("starredPersonalities",JSON.stringify(t)),P.value==="Starred"&&(d.value=1,f())},{deep:!0}),be(()=>{$.fetchPersonalities(),u.fetchPersonalityZooRepositories(),f()});const N=r(()=>[...K.value||[]].sort((t,e)=>(t.name||"").localeCompare(e.name||""))),se=r(()=>["All","Starred",...S.value.categories||[]]);function le(t){return t?new Date(t).toLocaleString():"Never"}async function oe(){if(!n.value.name){v.addNotification("Repository name is required.","warning");return}const t={name:n.value.name};n.value.type==="git"?t.url=n.value.url:t.path=n.value.path,g.value="add";try{await u.addPersonalityZooRepository(t),n.value={type:"git",name:"",url:"",path:""},b.value=!1}finally{g.value=null}}async function ae(t){g.value=t.id;try{await u.pullPersonalityZooRepository(t.id)}finally{g.value=null}}async function ne(t){if(await v.showConfirmation({title:`Delete Repository '${t.name}'?`})){g.value=t.id;try{await u.deletePersonalityZooRepository(t.id)}finally{g.value=null}}}async function ie(t){await u.installZooPersonality({repository:t.repository,folder_name:t.folder_name})}async function re(t){const e=Q.value.find(s=>s.name===t.name&&s.owner_username==="System");e&&await v.showConfirmation({title:`Uninstall '${t.name}'?`})&&(await $.deletePersonality(e.id),await f())}async function ue(t){const e=await u.fetchPersonalityReadme(t.repository,t.folder_name);v.openModal("sourceViewer",{title:`README: ${t.name}`,content:e,language:"markdown"})}function de(t){const e=k.value.indexOf(t);e>-1?k.value.splice(e,1):k.value.push(t)}function ce(t=null){v.openModal("personalityEditor",{personality:t})}function pe(){v.openModal("generatePersonality")}async function ve(){const t=await u.refreshZooCache();t&&v.openModal("tasksManager",{initialTaskId:t.id})}return(t,e)=>(o(),a("div",Re,[l("div",Ce,[l("nav",Ie,[l("button",{onClick:e[0]||(e[0]=s=>m.value="zoo"),class:q(["tab-button",m.value==="zoo"?"active":"inactive"])},"Zoo",2),l("button",{onClick:e[1]||(e[1]=s=>m.value="source"),class:q(["tab-button",m.value==="source"?"active":"inactive"])},"Repositories",2)])]),m.value==="zoo"?(o(),a("section",Me,[l("div",$e,[e[16]||(e[16]=l("h3",{class:"text-xl font-semibold"},"Personality Zoo",-1)),l("div",Ae,[l("button",{onClick:ve,class:"btn btn-secondary",title:"Refresh Zoo Cache from all sources"},[h(E,{class:"w-4 h-4"})]),l("button",{onClick:pe,class:"btn btn-secondary"},"Generate from Prompt"),l("button",{onClick:e[2]||(e[2]=s=>ce()),class:"btn btn-primary"},[h(ke,{class:"w-4 h-4 mr-1"}),e[15]||(e[15]=I(" Create New"))])])]),l("div",Ue,[l("div",Ve,[l("div",Ze,[c(l("input",{"onUpdate:modelValue":e[3]||(e[3]=s=>A.value=s),type:"text",placeholder:"Search Personalities...",class:"input-field w-full pl-10"},null,512),[[M,A.value]]),e[17]||(e[17]=l("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[l("svg",{class:"h-5 w-5 text-gray-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[l("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})])],-1))]),l("div",Ne,[c(l("select",{"onUpdate:modelValue":e[4]||(e[4]=s=>U.value=s),class:"input-field"},e[18]||(e[18]=[l("option",{value:"All"},"All Statuses",-1),l("option",{value:"Installed"},"Installed",-1),l("option",{value:"Uninstalled"},"Uninstalled",-1)]),512),[[z,U.value]]),c(l("select",{"onUpdate:modelValue":e[5]||(e[5]=s=>P.value=s),class:"input-field"},[(o(!0),a(x,null,_(se.value,s=>(o(),a("option",{key:s,value:s},p(s),9,Te))),128))],512),[[z,P.value]]),c(l("select",{"onUpdate:modelValue":e[6]||(e[6]=s=>V.value=s),class:"input-field"},[e[19]||(e[19]=l("option",{value:"All"},"All Sources",-1)),(o(!0),a(x,null,_(N.value,s=>(o(),a("option",{key:s.id,value:s.name},p(s.name),9,ze))),128))],512),[[z,V.value]])])]),O(J)?(o(),a("div",Le,[(o(),a(x,null,_(8,s=>h(Pe,{key:s})),64))])):j.value.length===0?(o(),a("div",De,e[20]||(e[20]=[l("p",null,"No personalities found.",-1)]))):(o(),a("div",Fe,[l("div",je,[(o(!0),a(x,null,_(j.value,s=>(o(),we(Se,{key:`${s.repository}/${s.folder_name}`,app:s,task:s.task,"is-starred":k.value.includes(s.name),"item-type-name":"Personality",onStar:R=>de(s.name),onInstall:ie,onUninstall:re,onHelp:ue},null,8,["app","task","is-starred","onStar"]))),128))]),F.value>1?(o(),a("div",qe,[l("button",{onClick:e[7]||(e[7]=s=>d.value--),disabled:d.value===1,class:"btn btn-secondary"},"Previous",8,Ee),l("span",Oe,p(ee.value),1),l("button",{onClick:e[8]||(e[8]=s=>d.value++),disabled:d.value>=F.value,class:"btn btn-secondary"},"Next",8,Be)])):y("",!0)]))])])):y("",!0),m.value==="source"?(o(),a("section",Ge,[l("div",Ke,[e[21]||(e[21]=l("h3",{class:"text-xl font-semibold"},"Personality Zoo Repositories",-1)),l("button",{onClick:e[9]||(e[9]=s=>b.value=!b.value),class:"btn btn-primary"},p(b.value?"Cancel":"Add Repository"),1)]),b.value?(o(),a("div",He,[l("form",{onSubmit:he(oe,["prevent"]),class:"space-y-4"},[l("div",Je,[l("label",null,[c(l("input",{type:"radio","onUpdate:modelValue":e[10]||(e[10]=s=>n.value.type=s),value:"git",class:"radio-input"},null,512),[[B,n.value.type]]),e[22]||(e[22]=I(" Git"))]),l("label",null,[c(l("input",{type:"radio","onUpdate:modelValue":e[11]||(e[11]=s=>n.value.type=s),value:"local",class:"radio-input"},null,512),[[B,n.value.type]]),e[23]||(e[23]=I(" Local"))])]),l("div",null,[e[24]||(e[24]=l("label",null,"Name",-1)),c(l("input",{"onUpdate:modelValue":e[12]||(e[12]=s=>n.value.name=s),type:"text",class:"input-field",required:""},null,512),[[M,n.value.name]])]),n.value.type==="git"?(o(),a("div",Qe,[e[25]||(e[25]=l("label",null,"URL",-1)),c(l("input",{"onUpdate:modelValue":e[13]||(e[13]=s=>n.value.url=s),type:"url",class:"input-field",required:n.value.type==="git"},null,8,We),[[M,n.value.url]])])):y("",!0),n.value.type==="local"?(o(),a("div",Xe,[e[26]||(e[26]=l("label",null,"Path",-1)),c(l("input",{"onUpdate:modelValue":e[14]||(e[14]=s=>n.value.path=s),type:"text",class:"input-field",required:n.value.type==="local"},null,8,Ye),[[M,n.value.path]])])):y("",!0),e[27]||(e[27]=l("div",{class:"flex justify-end"},[l("button",{type:"submit",class:"btn btn-primary"},"Add")],-1))],32)])):y("",!0),O(H)?(o(),a("div",et,"Loading...")):N.value.length===0?(o(),a("div",tt,e[28]||(e[28]=[l("p",null,"No repositories added.",-1)]))):(o(),a("div",st,[(o(!0),a(x,null,_(N.value,s=>(o(),a("div",{key:s.id,class:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm flex items-center justify-between"},[l("div",null,[l("p",lt,p(s.name),1),l("p",ot,p(s.url),1),l("p",at,"Pulled: "+p(le(s.last_pulled_at)),1)]),l("div",nt,[l("button",{onClick:R=>ae(s),class:"btn btn-secondary btn-sm"},[h(E,{class:"w-4 h-4 mr-1"}),I(p(s.type==="git"?"Pull":"Rescan"),1)],8,it),s.is_deletable?(o(),a("button",{key:0,onClick:R=>ne(s),class:"btn btn-danger btn-sm"},[h(xe,{class:"w-4 h-4"})],8,rt)):y("",!0)])]))),128))]))])):y("",!0)]))}},ft=ye(ut,[["__scopeId","data-v-5e92e80d"]]);export{ft as default};
