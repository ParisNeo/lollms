import{aS as R,u as X,R as se,az as E,r as $,b,au as ae,S as H,c as g,o as i,a as e,h as S,g as d,aG as oe,aM as ne,X as K,M as W,t as _,aJ as O,p as F,av as J,_ as Q,b9 as re,d as Y,J as z,K as le,f as C,G as ie,ae as ee,bp as te,P as de,H as ce,A as w,w as ue,F as ve,j as ge,n as T,V as fe,aZ as he,E as ye,bq as be,br as q,l as pe,I as xe,m as me,bs as B,aB as N,U as _e}from"./index-BzYhVBtc.js";import{I as ke,a as we}from"./IconRedo-DMI-VGNf.js";const $e={class:"flex flex-col h-full overflow-hidden"},Ce={class:"flex-shrink-0 flex items-center justify-between gap-2 p-1.5 bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-t-lg"},Me={class:"flex items-center gap-0.5"},De=["disabled"],Se=["disabled"],Te=["disabled"],Ie=["disabled"],Ze=["disabled"],ze={key:0,class:"flex items-center gap-2 pr-2"},Ee={class:"text-[10px] font-bold text-blue-500"},Re={__name:"DiscussionZone",setup(L){const u=R(),k=X(),f=se(),{activeDiscussion:o}=E(u),{tasks:m}=E(f),h=$(null),s=$(!1),p=$([]),c=$(-1);let l=null,y=null;const v=b({get:()=>{var t;return((t=o.value)==null?void 0:t.discussion_data_zone)||""},set:t=>{o.value&&(u.setDiscussionDataZoneContent(o.value.id,t),clearTimeout(y),y=setTimeout(()=>{o.value&&ae.put(`/api/discussions/${o.value.id}/data_zone`,{content:t}).then(()=>{u.fetchContextStatus(o.value.id)})},1500))}}),x=b(()=>{if(!o.value)return!1;const t=u.activeAiTasks[o.value.id];if(!t||!t.taskId)return!1;const a=m.value.find(D=>D.id===t.taskId);return a?a.status==="running"||a.status==="pending":!1}),M=b(()=>{if(!o.value)return null;const t=u.activeAiTasks[o.value.id];return!t||!t.taskId?null:m.value.find(a=>a.id===t.taskId)}),I=b(()=>c.value>0),Z=b(()=>c.value<p.value.length-1);function j(t){clearTimeout(l),l=setTimeout(()=>{p.value[c.value]!==t&&(c.value<p.value.length-1&&p.value.splice(c.value+1),p.value.push(t),c.value++)},750)}async function V(){I.value&&(s.value=!0,c.value--,v.value=p.value[c.value],await J(),s.value=!1)}async function A(){Z.value&&(s.value=!0,c.value++,v.value=p.value[c.value],await J(),s.value=!1)}H(v,(t,a)=>{!s.value&&t!==a&&j(t)},{flush:"post"}),H(o,(t,a)=>{t&&(!a||t.id!==a.id)&&(p.value=[t.discussion_data_zone||""],c.value=0)},{immediate:!0});function U(t){h.value=t.view}function P(){o.value&&u.cloneDiscussion(o.value.id)}function n(){o.value&&u.refreshDataZones(o.value.id)}async function r(t){const a=Array.from(t.dataTransfer.files);a.length>0&&o.value&&(k.addNotification(`Extracting text from ${a.length} file(s)...`,"info"),await u.uploadAndEmbedFilesToDataZone(o.value.id,a,!1))}return(t,a)=>{var D;return i(),g("div",$e,[e("div",Ce,[e("div",Me,[e("button",{onClick:V,class:"p-1.5 rounded hover:bg-gray-100 dark:hover:bg-gray-800 disabled:opacity-30",title:"Undo",disabled:!I.value||x.value},[d(ke,{class:"w-4 h-4"})],8,De),e("button",{onClick:A,class:"p-1.5 rounded hover:bg-gray-100 dark:hover:bg-gray-800 disabled:opacity-30",title:"Redo",disabled:!Z.value||x.value},[d(we,{class:"w-4 h-4"})],8,Se),a[3]||(a[3]=e("div",{class:"w-px h-4 bg-gray-200 dark:bg-gray-700 mx-1"},null,-1)),e("button",{onClick:P,class:"p-1.5 rounded hover:bg-gray-100 dark:hover:bg-gray-800 disabled:opacity-30",title:"Clone Data Zone",disabled:x.value},[d(oe,{class:"w-4 h-4"})],8,Te),e("button",{onClick:n,class:"p-1.5 rounded hover:bg-gray-100 dark:hover:bg-gray-800 disabled:opacity-30",title:"Refresh",disabled:x.value},[d(ne,{class:"w-4 h-4"})],8,Ie),e("button",{onClick:a[0]||(a[0]=G=>v.value=""),class:"p-1.5 rounded hover:bg-red-50 dark:hover:bg-red-900/20 text-red-500 disabled:opacity-30",title:"Clear Context",disabled:x.value},[d(K,{class:"w-4 h-4"})],8,Ze)]),x.value?(i(),g("div",ze,[d(W,{class:"w-3.5 h-3.5 text-blue-500 animate-spin"}),e("span",Ee,_((D=M.value)==null?void 0:D.progress)+"%",1)])):S("",!0)]),e("div",{onDragover:a[2]||(a[2]=F(()=>{},["prevent"])),onDrop:F(r,["prevent"]),class:"flex-1 min-h-0 border-x border-b border-gray-200 dark:border-gray-700 rounded-b-lg overflow-hidden relative"},[d(O,{ref:"discussionCodeMirrorEditor",modelValue:v.value,"onUpdate:modelValue":a[1]||(a[1]=G=>v.value=G),class:"h-full","read-only":x.value,renderable:!0,onReady:U},null,8,["modelValue","read-only"])],32)])}}},Le={class:"h-full flex flex-col border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden"},je={__name:"PersonalityZone",setup(L){const u=R(),k=b(()=>u.activeDiscussion),f=b(()=>{var o;return((o=k.value)==null?void 0:o.personality_data_zone)||""});return(o,m)=>(i(),g("div",Le,[d(O,{modelValue:f.value,"onUpdate:modelValue":m[0]||(m[0]=h=>f.value=h),class:"h-full","read-only":!0},null,8,["modelValue"])]))}},Ve={class:"flex flex-col h-full gap-3 overflow-hidden"},Ae={class:"flex items-center justify-between bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 p-2 rounded-lg shadow-sm flex-shrink-0"},Ue=["disabled"],Pe={class:"flex-1 flex flex-col gap-3 min-h-0"},Be={class:"flex-1 flex flex-col min-h-[150px] border border-gray-200 dark:border-gray-700 rounded-lg bg-white dark:bg-gray-900/50 shadow-inner overflow-hidden"},Ne={class:"p-2 border-b dark:border-gray-700 flex items-center justify-between bg-gray-50 dark:bg-gray-800/30"},He={class:"flex gap-2"},We={key:0,class:"text-[9px] font-mono text-gray-500"},Fe={key:1,class:"text-[9px] font-mono text-blue-500"},Xe={class:"flex-1 overflow-y-auto custom-scrollbar p-3"},Ge={key:0,class:"h-full flex flex-col items-center justify-center text-gray-400 opacity-40"},Je={class:"h-64 border border-gray-200 dark:border-gray-700 rounded-lg bg-white dark:bg-gray-900 flex flex-col shadow-sm overflow-hidden flex-shrink-0"},qe={class:"p-2 border-b dark:border-gray-700 flex justify-between items-center bg-gray-50/50 dark:bg-gray-800/30"},Ke={class:"text-[10px] font-black uppercase text-gray-500"},Oe={class:"flex-1 overflow-y-auto custom-scrollbar p-1"},Qe={key:0,class:"text-center py-6"},Ye={key:1,class:"text-center py-6 text-xs text-gray-400"},et={class:"flex items-center gap-3 min-w-0"},tt={class:"text-[10px] font-mono text-gray-400 font-bold w-5 text-center shrink-0"},st=["onClick"],at={class:"flex flex-col min-w-0"},ot=["title"],nt={class:"text-[10px] truncate text-gray-400"},rt={class:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity"},lt=["onClick"],it=["onClick"],dt={__name:"MemoryZone",setup(L){const u=R(),k=re(),f=X(),{memories:o,isLoading:m}=E(k),h=$(""),s=$(new Set);function p(n){return n?Math.ceil(n.length/4):0}const c=b(()=>u.activeDiscussion),l=b(()=>{var n;return c.value&&((n=u.activeAiTasks[c.value.id])==null?void 0:n.type)==="memorize"}),y=b(()=>[...o.value].sort((n,r)=>new Date(n.created_at)-new Date(r.created_at))),v=b(()=>{const n=y.value.filter(r=>s.value.has(r.title));return n.length===0?"":n.map(r=>`[Memory #${y.value.findIndex(a=>a.id===r.id)+1}] ${r.title}: ${r.content}`).join(`

`)}),x=b(()=>p(v.value)),M=b(()=>{if(!h.value)return y.value;const n=h.value.toLowerCase();return y.value.filter(r=>r.title.toLowerCase().includes(n)||r.content.toLowerCase().includes(n))});function I(){c.value&&u.memorizeLTM(c.value.id)}function Z(){f.openModal("memoryEditor")}function j(n){f.openModal("memoryEditor",{memory:n})}async function V(n){const r=o.value.find(a=>a.id===n);if(!r)return;const t=await f.showConfirmation({title:"Delete Memory?",message:`Permanently delete "${r.title}"?`,confirmText:"Delete"});t&&t.confirmed&&(s.value.delete(r.title),s.value=new Set(s.value),await k.deleteMemory(n))}function A(n){s.value.add(n),s.value=new Set(s.value)}function U(n){s.value.delete(n),s.value=new Set(s.value)}async function P(){await k.fetchMemories(),s.value.size===0&&o.value.length>0&&(o.value.forEach(n=>s.value.add(n.title)),s.value=new Set(s.value))}return H(o,n=>{const r=new Set(n.map(a=>a.title));let t=!1;for(const a of s.value)r.has(a)||(s.value.delete(a),t=!0);t&&(s.value=new Set(s.value))},{deep:!0}),Y(()=>{P()}),(n,r)=>(i(),g("div",Ve,[e("div",Ae,[z(e("input",{type:"text","onUpdate:modelValue":r[0]||(r[0]=t=>h.value=t),placeholder:"Filter bank...",class:"w-32 px-2 py-1 text-xs bg-gray-50 dark:bg-gray-900 border-none focus:ring-1 focus:ring-blue-500 rounded"},null,512),[[le,h.value]]),e("button",{onClick:I,class:"btn btn-primary btn-xs py-1 px-3 shadow-sm",disabled:l.value},[l.value?(i(),C(W,{key:0,class:"w-3.5 h-3.5 mr-1 animate-spin"})):(i(),C(ee,{key:1,class:"w-3.5 h-3.5 mr-1"})),r[1]||(r[1]=ie(" Memorize Chat "))],8,Ue)]),e("div",Pe,[e("div",Be,[e("div",Ne,[r[2]||(r[2]=e("span",{class:"text-[9px] font-black uppercase text-gray-400 tracking-tighter"},"Active Context Preview",-1)),e("div",He,[v.value?(i(),g("span",We,_(v.value.length)+" chars",1)):S("",!0),v.value?(i(),g("span",Fe,"~"+_(x.value)+" tokens",1)):S("",!0)])]),e("div",Xe,[v.value?(i(),C(de,{key:1,content:v.value,class:"prose-xs"},null,8,["content"])):(i(),g("div",Ge,[d(te,{class:"w-10 h-10 mb-2"}),r[3]||(r[3]=e("p",{class:"text-[10px] uppercase font-black tracking-widest"},"No Active Memories",-1))]))])]),e("div",Je,[e("div",qe,[e("span",Ke,"Memory Bank ("+_(M.value.length)+")",1),e("button",{onClick:Z,class:"p-1 rounded hover:bg-gray-200 dark:hover:bg-gray-700 text-blue-500",title:"Manual Memory Entry"},[d(ce,{class:"w-4 h-4"})])]),e("div",Oe,[w(m)?(i(),g("div",Qe,[d(W,{class:"w-6 h-6 text-gray-300 animate-spin mx-auto"})])):M.value.length===0?(i(),g("div",Ye,"Empty")):(i(),C(be,{key:2,name:"mem",tag:"div",class:"space-y-1"},{default:ue(()=>[(i(!0),g(ve,null,ge(M.value,(t,a)=>(i(),g("div",{key:t.id,class:T(["group p-2 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800/50 flex items-center justify-between transition-all border border-transparent",{"border-green-500/20 bg-green-50/10 dark:bg-green-900/5":s.value.has(t.title)}])},[e("div",et,[e("span",tt,"#"+_(a+1),1),e("button",{onClick:D=>s.value.has(t.title)?U(t.title):A(t.title),class:T(["flex-shrink-0 transition-colors",s.value.has(t.title)?"text-green-500":"text-gray-300 hover:text-gray-400"])},[s.value.has(t.title)?(i(),C(fe,{key:0,class:"w-5 h-5"})):(i(),C(he,{key:1,class:"w-5 h-5"}))],10,st),e("div",at,[e("span",{class:"text-xs font-bold truncate text-gray-700 dark:text-gray-200",title:t.title},_(t.title),9,ot),e("span",nt,_(p(t.content))+" tokens",1)])]),e("div",rt,[e("button",{onClick:D=>j(t),class:"p-1.5 rounded hover:bg-white dark:hover:bg-gray-700 shadow-sm text-blue-500",title:"Edit"},[d(ye,{class:"w-3.5 h-3.5"})],8,lt),e("button",{onClick:D=>V(t.id),class:"p-1.5 rounded hover:bg-red-50 dark:hover:bg-red-900/30 shadow-sm text-red-500",title:"Delete"},[d(K,{class:"w-3.5 h-3.5"})],8,it)])],2))),128))]),_:1}))])])])]))}},ct=Q(dt,[["__scopeId","data-v-1e6950f0"]]),ut={class:"flex-1 flex flex-col min-w-0 overflow-hidden"},vt={class:"flex-shrink-0 bg-gray-50 dark:bg-gray-800/80 backdrop-blur-sm border-b border-gray-200 dark:border-gray-700 flex justify-between items-center p-2 h-12"},gt={class:"flex items-center gap-2 px-2"},ft={class:"flex items-center gap-1"},ht=["title"],yt={class:"flex-1 overflow-y-auto custom-scrollbar flex flex-col bg-gray-50/30 dark:bg-gray-900/30"},bt={class:"flex flex-col border-b border-gray-200 dark:border-gray-800 transition-all"},pt={class:"flex items-center gap-3"},xt={class:"p-1.5 rounded-md bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400"},mt={key:0,class:"text-xs text-gray-400 font-mono"},_t={class:"h-96 p-2 pt-0"},kt={class:"flex flex-col border-b border-gray-200 dark:border-gray-800 transition-all"},wt={class:"flex items-center gap-3"},$t={class:"p-1.5 rounded-md bg-purple-100 dark:bg-purple-900/30 text-purple-600 dark:text-purple-400"},Ct={key:0,class:"text-xs text-gray-400 font-mono"},Mt={class:"h-64 p-2 pt-0"},Dt={class:"flex flex-col flex-1 min-h-0"},St={class:"flex items-center gap-3"},Tt={class:"p-1.5 rounded-md bg-green-100 dark:bg-green-900/30 text-green-600 dark:text-green-400"},It={key:0,class:"text-xs text-gray-400 font-mono"},Zt={class:"flex-1 p-2 pt-0 min-h-[300px]"},zt={__name:"DataZone",setup(L){const u=X(),k=R(),{liveDataZoneTokens:f}=E(k),o=$(450),m=$(!1),h=b(()=>u.isDataZoneExpanded),s=$({discussion:!0,personality:!0,memory:!0});function p(c){m.value=!0;const l=c.clientX,y=o.value,v=M=>{m.value&&(o.value=Math.max(320,y-(M.clientX-l)))},x=()=>{m.value=!1,window.removeEventListener("mousemove",v),window.removeEventListener("mouseup",x),localStorage.setItem("lollms_dataZoneWidth",o.value)};window.addEventListener("mousemove",v),window.addEventListener("mouseup",x)}return Y(()=>{const c=localStorage.getItem("lollms_dataZoneWidth");c&&(o.value=parseInt(c,10))}),(c,l)=>(i(),g("div",{class:T(["relative h-full flex flex-shrink-0 border-l border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900 z-10 shadow-2xl",[h.value?"absolute inset-0 w-full":""]]),style:_e(h.value?{}:{width:`${o.value}px`})},[h.value?S("",!0):(i(),g("div",{key:0,onMousedown:F(p,["prevent"]),class:"absolute top-0 bottom-0 -left-1 w-2 cursor-col-resize z-20 hover:bg-blue-500/30 transition-colors"},null,32)),e("div",ut,[e("div",vt,[e("div",gt,[d(q,{class:"w-4 h-4 text-gray-400"}),l[5]||(l[5]=e("h3",{class:"text-[10px] font-black text-gray-500 dark:text-gray-400 uppercase tracking-widest"},"Context Explorer",-1))]),e("div",ft,[e("button",{onClick:l[0]||(l[0]=y=>w(u).toggleDataZoneExpansion()),class:"p-1.5 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-500 transition-colors",title:h.value?"Shrink":"Expand"},[h.value?(i(),C(pe,{key:0,class:"w-4 h-4"})):(i(),C(xe,{key:1,class:"w-4 h-4"}))],8,ht),e("button",{onClick:l[1]||(l[1]=y=>w(u).toggleDataZone()),class:"p-1.5 rounded-lg hover:bg-red-500 hover:text-white text-gray-500 transition-colors",title:"Close Sidebar"},[d(me,{class:"w-4 h-4"})])])]),e("div",yt,[e("div",bt,[e("button",{onClick:l[2]||(l[2]=y=>s.value.discussion=!s.value.discussion),class:"flex-shrink-0 w-full flex items-center justify-between p-4 hover:bg-gray-100 dark:hover:bg-gray-800/50 transition-colors group"},[e("div",pt,[e("div",xt,[d(q,{class:"w-4 h-4"})]),l[6]||(l[6]=e("span",{class:"text-sm font-bold text-gray-700 dark:text-gray-200"},"Discussion Zone",-1)),w(f).discussion>0?(i(),g("span",mt,"("+_(w(f).discussion)+" tok)",1)):S("",!0)]),d(B,{class:T(["w-4 h-4 text-gray-400 transition-transform duration-300",{"rotate-180":!s.value.discussion}])},null,8,["class"])]),z(e("div",_t,[d(Re)],512),[[N,!s.value.discussion]])]),e("div",kt,[e("button",{onClick:l[3]||(l[3]=y=>s.value.personality=!s.value.personality),class:"flex-shrink-0 w-full flex items-center justify-between p-4 hover:bg-gray-100 dark:hover:bg-gray-800/50 transition-colors group"},[e("div",wt,[e("div",$t,[d(ee,{class:"w-4 h-4"})]),l[7]||(l[7]=e("span",{class:"text-sm font-bold text-gray-700 dark:text-gray-200"},"AI Personality",-1)),w(f).personality>0?(i(),g("span",Ct,"("+_(w(f).personality)+" tok)",1)):S("",!0)]),d(B,{class:T(["w-4 h-4 text-gray-400 transition-transform duration-300",{"rotate-180":!s.value.personality}])},null,8,["class"])]),z(e("div",Mt,[d(je)],512),[[N,!s.value.personality]])]),e("div",Dt,[e("button",{onClick:l[4]||(l[4]=y=>s.value.memory=!s.value.memory),class:"flex-shrink-0 w-full flex items-center justify-between p-4 hover:bg-gray-100 dark:hover:bg-gray-800/50 transition-colors group"},[e("div",St,[e("div",Tt,[d(te,{class:"w-4 h-4"})]),l[8]||(l[8]=e("span",{class:"text-sm font-bold text-gray-700 dark:text-gray-200"},"Long-Term Memory",-1)),w(f).memory>0?(i(),g("span",It,"("+_(w(f).memory)+" tok)",1)):S("",!0)]),d(B,{class:T(["w-4 h-4 text-gray-400 transition-transform duration-300",{"rotate-180":!s.value.memory}])},null,8,["class"])]),z(e("div",Zt,[d(ct)],512),[[N,!s.value.memory]])])])])],6))}},Lt=Q(zt,[["__scopeId","data-v-5372207d"]]);export{Lt as default};
