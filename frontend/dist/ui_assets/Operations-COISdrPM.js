import{L as k,e as s,o as n,b as e,u as j,N as u,c as T,l as z,m as F,$ as H,g as l,f as i,ct as L,n as N,W as P,ak as I,t as O,h as g,aC as W,cz as G,aB as E,at as Z,ao as M,ax as q,cu as J,O as b}from"./index-7rLr_kL9.js";import{u as K}from"./admin-Bo8e158b.js";import{I as Q}from"./IconClock-BKR7EBc6.js";const X={},Y={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor"};function ee(w,a){return n(),s("svg",Y,a[0]||(a[0]=[e("path",{d:"M3.375 3C2.339 3 1.5 3.84 1.5 4.875v.75c0 1.036.84 1.875 1.875 1.875h17.25c1.035 0 1.875-.84 1.875-1.875v-.75C22.5 3.839 21.66 3 20.625 3H3.375z"},null,-1),e("path",{"fill-rule":"evenodd",d:"M3.087 9l.54 9.176A3 3 0 006.62 21h10.757a3 3 0 002.995-2.824L20.913 9H3.087zm6.163 3.75A.75.75 0 0110 12h4a.75.75 0 010 1.5h-4a.75.75 0 01-.75-.75z","clip-rule":"evenodd"},null,-1)]))}const te=k(X,[["render",ee]]),ae={},se={width:"50px",height:"50px",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function ne(w,a){return n(),s("svg",se,a[0]||(a[0]=[e("path",{d:"M6.49999 0V8H9.49999V0H6.49999Z",fill:"currentColor"},null,-1),e("path",{d:"M4.46447 11.5355C2.51184 9.58291 2.51184 6.41709 4.46447 4.46447L2.34315 2.34315C-0.781049 5.46734 -0.781049 10.5327 2.34315 13.6569C5.46734 16.781 10.5327 16.781 13.6569 13.6569C16.781 10.5327 16.781 5.46734 13.6569 2.34315L11.5355 4.46447C13.4882 6.41709 13.4882 9.58291 11.5355 11.5355C9.58291 13.4882 6.41709 13.4882 4.46447 11.5355Z",fill:"currentColor"},null,-1)]))}const oe=k(ae,[["render",ne]]),re={class:"space-y-8"},ie={class:"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-orange-200 dark:border-orange-900/50 overflow-hidden"},le={class:"p-6 bg-orange-50 dark:bg-orange-900/20 border-b border-orange-100 dark:border-orange-900/30"},de={class:"flex items-center gap-4"},ce={class:"p-3 bg-orange-100 dark:bg-orange-900/50 rounded-full text-orange-600"},ue={class:"ml-auto"},ge={key:0,class:"p-6 space-y-4 animate-in fade-in slide-in-from-top-2"},pe={key:0},me={class:"flex justify-end"},fe=["disabled"],be={class:"text-lg font-bold text-gray-900 dark:text-white mb-4 flex items-center gap-2"},ve={key:0,class:"flex flex-col items-center justify-center p-12 bg-gray-50 dark:bg-gray-900 rounded-xl border border-gray-200 dark:border-gray-700 text-center animate-fade-in mb-6"},he={class:"mb-6 relative"},ye={key:0,class:"p-4 bg-green-100 dark:bg-green-900/30 rounded-full text-green-600"},xe={key:1,class:"p-4 bg-blue-50 dark:bg-blue-900/20 rounded-full text-blue-600 relative"},ke={class:"absolute inset-0 flex items-center justify-center"},we={class:"text-2xl font-bold text-gray-900 dark:text-white mb-2"},_e={key:0},Ce={key:1},Se={key:2},Te={key:3},Ne={class:"text-gray-500 dark:text-gray-400 max-w-md"},Pe={key:0},Ie={key:1},Me={key:2},Be={key:3},Ae={key:1,class:"grid grid-cols-1 md:grid-cols-2 gap-6"},Re={class:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 flex flex-col items-start gap-4"},Ue={class:"p-3 rounded-full bg-orange-100 dark:bg-orange-900/30 text-orange-600"},$e={class:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 flex flex-col items-start gap-4"},Ve={class:"p-3 rounded-full bg-blue-100 dark:bg-blue-900/30 text-blue-600"},De={class:"grid grid-cols-1 lg:grid-cols-2 gap-8"},je={class:"text-lg font-bold text-gray-900 dark:text-white mb-4 flex items-center gap-2"},ze={class:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 divide-y divide-gray-200 dark:divide-gray-700"},Fe={class:"p-5 flex items-center justify-between"},He={class:"p-5 flex items-center justify-between"},Le={class:"text-lg font-bold text-gray-900 dark:text-white mb-4 flex items-center gap-2"},Oe={class:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700"},We={class:"space-y-3"},Ge=["disabled"],Ee={__name:"Operations",setup(w){const a=j(),p=K(),d=u(!1),v=u(""),h=u(!1),y=T(()=>p.globalSettings.find(r=>r.key==="maintenance_mode")),_=T(()=>p.globalSettings.find(r=>r.key==="maintenance_message")),x=u(!1),o=u(""),m=u(null),f=u("");z(()=>{p.globalSettings.length===0?p.fetchGlobalSettings():C()}),F(()=>p.globalSettings,C,{deep:!0});function C(){y.value&&(d.value=y.value.value),_.value&&(v.value=_.value.value)}async function B(){h.value=!0;try{await p.updateGlobalSettings({maintenance_mode:d.value,maintenance_message:v.value}),a.addNotification("Maintenance settings updated.","success")}catch{a.addNotification("Failed to save maintenance settings.","error")}finally{h.value=!1}}async function A(){(await a.showConfirmation({title:"Reboot Server?",message:"This will restart the application process. All current connections will be dropped.",confirmText:"Reboot Now",isDanger:!0})).confirmed&&S("/api/admin/system/reboot","rebooting")}async function R(){(await a.showConfirmation({title:"Update & Restart?",message:"This will pull the latest code from Git, reinstall dependencies, and restart the server. This may take several minutes.",confirmText:"Update Now",isDanger:!0})).confirmed&&S("/api/admin/system/update","updating")}async function U(){if((await a.showConfirmation({title:"Purge Temporary Files?",message:"This will delete unused temporary uploads older than 24 hours. This is safe to run.",confirmText:"Purge"})).confirmed)try{await b.post("/api/admin/purge-unused-uploads"),a.addNotification("Purge task started.","success")}catch{a.addNotification("Failed to start purge task.","error")}}async function $(){if((await a.showConfirmation({title:"Prune Task History?",message:"This will delete records of finished tasks older than the retention period (default 7 days).",confirmText:"Prune"})).confirmed)try{await b.post("/api/admin/tasks/prune"),a.addNotification("Pruning task started.","success")}catch{a.addNotification("Failed to start pruning.","error")}}async function V(){if(!f.value){a.addNotification("Please set a password for the backup archive.","warning");return}try{await b.post("/api/admin/backup/create",{password:f.value}),a.addNotification("Backup task started. Check the Tasks tab for progress.","success"),f.value=""}catch{a.addNotification("Failed to start backup.","error")}}async function S(r,t){x.value=!0,o.value=t;try{try{await b.post(r,{},{timeout:5e3})}catch(c){console.log("Server likely restarting...",c)}o.value="reconnecting",D()}catch(c){a.addNotification(`Action failed: ${c.message}`,"error"),x.value=!1,o.value=""}}function D(){m.value&&clearInterval(m.value),setTimeout(()=>{m.value=setInterval(async()=>{try{await b.get("/api/public/version",{timeout:2e3}),clearInterval(m.value),o.value="success",a.addNotification("Server is back online!","success"),setTimeout(()=>{window.location.reload()},1500)}catch{console.log("Waiting for server...")}},3e3)},5e3)}return H(()=>{m.value&&clearInterval(m.value)}),(r,t)=>(n(),s("div",re,[e("div",ie,[e("div",le,[e("div",de,[e("div",ce,[i(L,{class:"w-8 h-8"})]),t[3]||(t[3]=e("div",null,[e("h4",{class:"text-lg font-bold text-gray-900 dark:text-white"},"Maintenance Mode"),e("p",{class:"text-sm text-gray-600 dark:text-gray-300"}," Block access for non-admin users and show a maintenance page. ")],-1)),e("div",ue,[e("button",{onClick:t[0]||(t[0]=c=>d.value=!d.value),type:"button",class:N([d.value?"bg-orange-600":"bg-gray-200 dark:bg-gray-600","relative inline-flex h-8 w-14 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out"])},[e("span",{class:N([d.value?"translate-x-6":"translate-x-0","pointer-events-none inline-block h-7 w-7 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out"])},null,2)],2)])])]),d.value||y.value&&d.value!==y.value.value?(n(),s("div",ge,[d.value?(n(),s("div",pe,[t[4]||(t[4]=e("label",{class:"block text-sm font-medium mb-1"},"Maintenance Message",-1)),P(e("textarea",{"onUpdate:modelValue":t[1]||(t[1]=c=>v.value=c),rows:"3",class:"input-field w-full",placeholder:"We are performing maintenance..."},null,512),[[I,v.value]]),t[5]||(t[5]=e("p",{class:"text-xs text-gray-500 mt-1"},"This message will be displayed to users on the splash screen.",-1))])):l("",!0),e("div",me,[e("button",{onClick:B,class:"btn btn-primary",disabled:h.value},O(h.value?"Saving...":"Save Changes"),9,fe)])])):l("",!0)]),e("div",null,[e("h3",be,[i(oe,{class:"w-5 h-5 text-red-500"}),t[6]||(t[6]=g(" Server Control "))]),x.value?(n(),s("div",ve,[e("div",he,[o.value==="success"?(n(),s("div",ye,[i(W,{class:"w-16 h-16"})])):(n(),s("div",xe,[i(G,{class:"w-16 h-16 opacity-50"}),e("div",ke,[i(E,{class:"w-10 h-10 animate-spin text-blue-600"})])]))]),e("h3",we,[o.value==="rebooting"?(n(),s("span",_e,"Rebooting Server...")):l("",!0),o.value==="updating"?(n(),s("span",Ce,"Updating System...")):l("",!0),o.value==="reconnecting"?(n(),s("span",Se,"Waiting for Connection...")):l("",!0),o.value==="success"?(n(),s("span",Te,"Server Online!")):l("",!0)]),e("p",Ne,[o.value==="rebooting"?(n(),s("span",Pe,"The application process is restarting. This usually takes 5-10 seconds.")):l("",!0),o.value==="updating"?(n(),s("span",Ie,"Downloading updates and reinstalling requirements. This may take a few minutes.")):l("",!0),o.value==="reconnecting"?(n(),s("span",Me,"The server is starting up. We are pinging it automatically.")):l("",!0),o.value==="success"?(n(),s("span",Be,"Redirecting you to the dashboard...")):l("",!0)])])):(n(),s("div",Ae,[e("div",Re,[e("div",Ue,[i(Z,{class:"w-8 h-8"})]),t[7]||(t[7]=e("div",null,[e("h4",{class:"text-lg font-bold text-gray-900 dark:text-white"},"Reboot Server"),e("p",{class:"text-sm text-gray-500 dark:text-gray-400 mt-1"}," Restarts the python application process. Useful for applying configuration changes or clearing memory leaks. ")],-1)),e("button",{onClick:A,class:"btn btn-secondary w-full mt-auto"}," Reboot Now ")]),e("div",$e,[e("div",Ve,[i(M,{class:"w-8 h-8"})]),t[8]||(t[8]=e("div",null,[e("h4",{class:"text-lg font-bold text-gray-900 dark:text-white"},"Update & Restart"),e("p",{class:"text-sm text-gray-500 dark:text-gray-400 mt-1"},[g(" Pulls latest code from Git, updates dependencies, and restarts. "),e("span",{class:"text-yellow-600 dark:text-yellow-500 font-semibold"},"Service will be unavailable during update.")])],-1)),e("button",{onClick:R,class:"btn btn-primary w-full mt-auto"}," Update System ")])]))]),e("div",De,[e("div",null,[e("h3",je,[i(te,{class:"w-5 h-5 text-purple-500"}),t[9]||(t[9]=g(" Data Operations "))]),e("div",ze,[e("div",Fe,[t[11]||(t[11]=e("div",null,[e("h4",{class:"font-medium text-gray-900 dark:text-white"},"Purge Temporary Files"),e("p",{class:"text-xs text-gray-500 mt-1"},"Deletes uploads older than 24h that are not in use.")],-1)),e("button",{onClick:U,class:"btn btn-secondary btn-sm flex items-center gap-2"},[i(q,{class:"w-4 h-4"}),t[10]||(t[10]=g(" Purge "))])]),e("div",He,[t[13]||(t[13]=e("div",null,[e("h4",{class:"font-medium text-gray-900 dark:text-white"},"Prune Task History"),e("p",{class:"text-xs text-gray-500 mt-1"},"Cleans up logs from old completed/failed background tasks.")],-1)),e("button",{onClick:$,class:"btn btn-secondary btn-sm flex items-center gap-2"},[i(Q,{class:"w-4 h-4"}),t[12]||(t[12]=g(" Prune "))])])])]),e("div",null,[e("h3",Le,[i(J,{class:"w-5 h-5 text-green-500"}),t[14]||(t[14]=g(" Backup & Security "))]),e("div",Oe,[t[17]||(t[17]=e("h4",{class:"font-medium text-gray-900 dark:text-white mb-2"},"Create Secure Backup",-1)),t[18]||(t[18]=e("p",{class:"text-sm text-gray-500 mb-4"}," Creates an AES-256 encrypted zip archive of the `data/` folder (databases, configs, and personal files). ",-1)),e("div",We,[e("div",null,[t[15]||(t[15]=e("label",{class:"text-xs font-medium text-gray-700 dark:text-gray-300"},"Archive Password",-1)),P(e("input",{type:"password","onUpdate:modelValue":t[2]||(t[2]=c=>f.value=c),class:"input-field w-full mt-1",placeholder:"Enter a strong password"},null,512),[[I,f.value]])]),e("button",{onClick:V,disabled:!f.value,class:"btn btn-primary w-full flex items-center justify-center gap-2"},[i(M,{class:"w-4 h-4"}),t[16]||(t[16]=g(" Create Backup "))],8,Ge)])])])])]))}},Ke=k(Ee,[["__scopeId","data-v-125fcd73"]]);export{Ke as default};
