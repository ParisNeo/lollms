import{u as O,ax as D,ay as M,b as m,r as f,a7 as w,f as N,o as s,w as P,c as o,h as r,a as e,t as i,J as B,K as F,g as L,M as R,S as V,F as S,j as C,G as j,n as J}from"./index-X76Zlg0l.js";import{_ as z}from"./GenericModal-ox4fsMOO.js";const U={class:"p-6 space-y-6"},$={key:0,class:"space-y-4"},G={class:"mt-1 text-sm text-gray-600 dark:text-gray-400 p-3 bg-gray-50 dark:bg-gray-700/50 rounded-md whitespace-pre-wrap font-mono max-h-40 overflow-y-auto"},K={key:1,class:"space-y-4"},W={class:"flex items-center space-x-3 text-lg font-semibold"},q={key:0},H={class:"w-full bg-gray-200 rounded-full dark:bg-gray-700 h-2.5"},Q={class:"text-center text-sm mt-2"},X={key:0,class:"mt-4 max-h-40 overflow-y-auto bg-gray-900 text-white font-mono text-xs p-3 rounded-md"},Y={class:"text-gray-500 mr-2"},Z={key:2,class:"space-y-4"},ee={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},te={class:"text-sm h-64 overflow-y-auto text-gray-600 dark:text-gray-400 p-3 bg-gray-50 dark:bg-gray-700/50 rounded-md whitespace-pre-wrap font-mono"},ae={class:"text-sm h-64 overflow-y-auto text-gray-800 dark:text-gray-200 p-3 bg-green-50 dark:bg-green-900/20 rounded-md whitespace-pre-wrap font-mono"},se={key:3,class:"space-y-4"},oe={key:0,class:"text-sm bg-red-50 dark:bg-red-900/20 text-red-700 dark:text-red-300 p-3 rounded-md font-mono"},ne={key:1,class:"text-sm bg-red-50 dark:bg-red-900/20 text-red-700 dark:text-red-300 p-3 rounded-md"},le={key:2},re={class:"max-h-48 overflow-y-auto bg-gray-900 text-white font-mono text-xs p-3 rounded-md"},de={class:"text-gray-500 mr-2"},ie={key:0},ue={key:1},ce={key:2},me={key:3},ve={__name:"EnhancePersonalityPromptModal",setup(pe){const y=O(),E=D(),I=M(),b=m(()=>y.modalData("enhancePersonalityPrompt")),g=m(()=>{var a;return((a=b.value)==null?void 0:a.prompt_text)||""}),h=m(()=>{var a;return(a=b.value)==null?void 0:a.onApply}),u=f(""),l=f("confirm"),c=f(null),n=m(()=>c.value?I.getTaskById(c.value):null),v=m(()=>{var a;if((a=n.value)!=null&&a.result&&typeof n.value.result=="string")try{return JSON.parse(n.value.result).enhanced_system_prompt||""}catch(t){return console.error("Failed to parse task result JSON for enhanced prompt:",t),""}return""});async function A(){l.value="running";try{const a=await E.enhancePersonalityPrompt(g.value,u.value);if(a&&a.task_id)c.value=a.task_id;else throw new Error("Failed to start enhancement task.")}catch{l.value="failed"}}w(n,a=>{a&&["completed","failed","cancelled"].includes(a.status)&&(l.value=a.status==="completed"?"completed":"failed")});function T(){h.value&&v.value&&h.value(v.value),p()}function p(){c.value=null,l.value="confirm",u.value="",y.closeModal("enhancePersonalityPrompt")}return w(()=>y.isModalOpen("enhancePersonalityPrompt"),a=>{a||(c.value=null,l.value="confirm",u.value="")}),(a,t)=>(s(),N(z,{"modal-name":"enhancePersonalityPrompt",title:"Enhance System Prompt with AI",maxWidthClass:"max-w-4xl","allow-overlay-close":l.value!=="running"},{body:P(()=>{var k,_;return[e("div",U,[l.value==="confirm"?(s(),o("div",$,[e("div",null,[t[1]||(t[1]=e("h4",{class:"font-semibold text-gray-800 dark:text-gray-200"},"Original Prompt",-1)),e("p",G,i(g.value||"(No prompt provided)"),1)]),e("div",null,[t[2]||(t[2]=e("label",{for:"modification-prompt-input",class:"block font-semibold text-gray-800 dark:text-gray-200"},"Enhancement Instructions (optional)",-1)),B(e("textarea",{id:"modification-prompt-input","onUpdate:modelValue":t[0]||(t[0]=d=>u.value=d),rows:"3",class:"input-field mt-1",placeholder:"e.g., Make the personality more formal and professional..."},null,512),[[F,u.value]]),t[3]||(t[3]=e("p",{class:"mt-1 text-xs text-gray-500"},"The AI will refine the original prompt based on your instructions. If left blank, a general enhancement will be applied.",-1))])])):r("",!0),l.value==="running"?(s(),o("div",K,[e("div",W,[L(R,{class:"w-6 h-6 text-blue-500"}),t[4]||(t[4]=e("span",null,"Enhancing prompt...",-1))]),n.value?(s(),o("div",q,[e("div",H,[e("div",{class:"bg-blue-600 h-2.5 rounded-full transition-all duration-300",style:V({width:`${n.value.progress}%`})},null,4)]),e("p",Q,i(n.value.progress)+"%",1),n.value.logs&&n.value.logs.length>0?(s(),o("div",X,[(s(!0),o(S,null,C(n.value.logs,(d,x)=>(s(),o("p",{key:x},[e("span",Y,i(new Date(d.timestamp).toLocaleTimeString())+":",1),e("span",null,i(d.message),1)]))),128))])):r("",!0)])):r("",!0)])):r("",!0),l.value==="completed"?(s(),o("div",Z,[t[7]||(t[7]=e("h3",{class:"text-lg font-semibold text-green-600 dark:text-green-400"},"Enhancement Complete!",-1)),e("div",ee,[e("div",null,[t[5]||(t[5]=e("h4",{class:"font-semibold text-gray-800 dark:text-gray-200 mb-1"},"Original",-1)),e("p",te,i(g.value),1)]),e("div",null,[t[6]||(t[6]=e("h4",{class:"font-semibold text-gray-800 dark:text-gray-200 mb-1"},"Enhanced",-1)),e("p",ae,i(v.value),1)])])])):r("",!0),l.value==="failed"?(s(),o("div",se,[t[10]||(t[10]=e("h3",{class:"text-lg font-semibold text-red-600 dark:text-red-400"},"Enhancement Failed",-1)),t[11]||(t[11]=e("p",{class:"text-sm text-gray-600 dark:text-gray-400"},"The task could not be completed. See the error and logs below for details.",-1)),(k=n.value)!=null&&k.error?(s(),o("div",oe,[t[8]||(t[8]=e("strong",null,"Error:",-1)),j(" "+i(n.value.error),1)])):(s(),o("div",ne," An unknown error occurred. Please check the server console for more details. ")),(_=n.value)!=null&&_.logs&&n.value.logs.length>0?(s(),o("div",le,[t[9]||(t[9]=e("h4",{class:"font-semibold text-gray-800 dark:text-gray-200 mb-1 text-sm"},"Task Logs",-1)),e("div",re,[(s(!0),o(S,null,C(n.value.logs,(d,x)=>(s(),o("p",{key:x,class:J({"text-red-400":d.level==="CRITICAL"||d.level==="ERROR"})},[e("span",de,i(new Date(d.timestamp).toLocaleTimeString())+":",1),e("span",null,i(d.message),1)],2))),128))])])):r("",!0)])):r("",!0)])]}),footer:P(()=>[l.value==="confirm"?(s(),o("div",ie,[e("button",{type:"button",onClick:p,class:"btn btn-secondary"},"Cancel"),e("button",{type:"button",onClick:A,class:"btn btn-primary ml-3"},"Start Enhancement")])):r("",!0),l.value==="running"?(s(),o("div",ue,t[12]||(t[12]=[e("button",{type:"button",class:"btn btn-secondary",disabled:""},"Running...",-1)]))):r("",!0),l.value==="completed"?(s(),o("div",ce,[e("button",{type:"button",onClick:p,class:"btn btn-secondary"},"Discard"),e("button",{type:"button",onClick:T,class:"btn btn-primary ml-3"},"Apply Changes")])):r("",!0),l.value==="failed"?(s(),o("div",me,[e("button",{type:"button",onClick:p,class:"btn btn-secondary"},"Close")])):r("",!0)]),_:1},8,["allow-overlay-close"]))}};export{ve as default};
