import{u as J,r as u,h as p,l as q,x as Q,E as Z,c as L,o as a,z as h,w as ee,d,e as b,i as te,a as t,t as X,I as se,G as ae,H as le,J as oe,K as A,L as B,b as j,M as ne,N as re,F as ce,A as ie,T as ue,O as de,P as ve,g as fe,n as he}from"./index-BztlMlxc.js";const me={class:"flex-shrink-0 flex items-center justify-between p-4 text-white"},pe={class:"min-w-0"},we={class:"text-sm font-semibold truncate"},ge={key:0,class:"text-xs text-gray-300 font-mono truncate"},be={class:"flex items-center gap-2"},ye={class:"w-full h-full flex items-center justify-center p-4"},_e=["src"],ke={class:"flex-shrink-0 bg-black/20 p-2"},xe={class:"overflow-x-auto py-2 custom-scrollbar"},Ce={class:"flex items-center gap-3 px-2 whitespace-nowrap"},Me=["onClick"],Ie=["src"],Le={__name:"ImageViewerModal",setup(Re){const v=J(),O=ve(),o=u(0),n=u(1),w=u(0),g=u(0),y=u(!1),x=u(0),C=u(0),M=u(null),I=p(()=>v.imageViewer.imageList),r=p(()=>I.value[o.value]||null),c=p(()=>{var e;return(e=r.value)==null?void 0:e.src}),R=p(()=>o.value<I.value.length-1),V=p(()=>o.value>0),D=p(()=>({transform:`scale(${n.value}) translate(${w.value}px, ${g.value}px)`,cursor:y.value?"grabbing":"grab"}));q(()=>v.imageViewer.isOpen,e=>{e&&(o.value=v.imageViewer.startIndex,k())});function E(e){return e&&e.startsWith("/api/")}function T(e){return e&&e.src?e.id||e.src.substring(e.src.length-30):Math.random()}const _=()=>v.closeImageViewer(),$=()=>{R.value&&o.value++,k()},S=()=>{V.value&&o.value--,k()};function Y(e){v.imageViewer.isOpen&&(e.key==="Escape"&&_(),e.key==="ArrowRight"&&R.value&&$(),e.key==="ArrowLeft"&&V.value&&S())}async function W(){var e;if(c.value)try{const i=await fe.get(c.value,{responseType:"blob"}),l=window.URL.createObjectURL(new Blob([i.data])),s=document.createElement("a");s.href=l,s.setAttribute("download",((e=r.value)==null?void 0:e.filename)||"image.png"),document.body.appendChild(s),s.click(),document.body.removeChild(s),window.URL.revokeObjectURL(l)}catch(i){console.error("Download failed:",i),v.addNotification("Failed to download image.","error")}}function z(){!r.value||!r.value.id||(_(),O.push(`/image-studio/edit/${r.value.id}`))}function k(){n.value=1,w.value=0,g.value=0}function P(e){e.preventDefault();const i=.1;if(!M.value)return;const l=M.value.getBoundingClientRect(),s=e.clientX-l.left,f=e.clientY-l.top,m=n.value,U=m*(1-Math.sign(e.deltaY)*i);n.value=Math.min(Math.max(.1,10),U);const G=w.value-(s/m-s/n.value),H=g.value-(f/m-f/n.value);w.value=G,g.value=H}function F(e){e.button===0&&(e.preventDefault(),y.value=!0,x.value=e.clientX,C.value=e.clientY)}function K(e){if(!y.value)return;e.preventDefault();const i=(e.clientX-x.value)/n.value,l=(e.clientY-C.value)/n.value;w.value+=i,g.value+=l,x.value=e.clientX,C.value=e.clientY}function N(){y.value=!1}return Q(()=>{document.addEventListener("keydown",Y)}),Z(()=>{document.removeEventListener("keydown",Y)}),(e,i)=>(a(),L(de,{to:"body"},[h(ue,{"enter-active-class":"transition-opacity ease-out duration-300","enter-from-class":"opacity-0","enter-to-class":"opacity-100","leave-active-class":"transition-opacity ease-in duration-200","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:ee(()=>{var l,s;return[te(v).imageViewer.isOpen?(a(),d("div",{key:0,class:"fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex flex-col",onClick:j(_,["self"])},[t("div",me,[t("div",pe,[t("p",we,X(((l=r.value)==null?void 0:l.prompt)||"Image"),1),(s=r.value)!=null&&s.model?(a(),d("p",ge,X(r.value.model),1)):b("",!0)]),t("div",be,[t("button",{onClick:k,class:"p-2 rounded-full hover:bg-white/20 transition-colors",title:"Reset View"},[h(se,{class:"w-6 h-6"})]),t("button",{onClick:z,class:"p-2 rounded-full hover:bg-white/20 transition-colors",title:"Edit Image"},[h(ae,{class:"w-6 h-6"})]),t("button",{onClick:W,class:"p-2 rounded-full hover:bg-white/20 transition-colors",title:"Download"},[h(le,{class:"w-6 h-6"})]),t("button",{onClick:_,class:"p-2 rounded-full hover:bg-white/20 transition-colors",title:"Close (Esc)"},[h(oe,{class:"w-6 h-6"})])])]),t("div",{ref_key:"imageWrapperRef",ref:M,class:"flex-1 flex items-center justify-center min-h-0 relative overflow-hidden",onWheel:P,onMousedown:F,onMousemove:K,onMouseup:N,onMouseleave:N},[t("div",ye,[E(c.value)?(a(),L(A,{key:c.value,src:c.value,style:B(D.value),class:"object-contain transition-transform max-w-full max-h-full"},null,8,["src","style"])):c.value?(a(),d("img",{key:c.value,src:c.value,style:B(D.value),class:"object-contain transition-transform max-w-full max-h-full"},null,12,_e)):b("",!0)]),V.value?(a(),d("button",{key:0,onClick:j(S,["stop"]),class:"absolute left-4 top-1/2 -translate-y-1/2 p-3 rounded-full bg-black/40 hover:bg-black/60 text-white transition-colors",title:"Previous (←)"},[h(ne,{class:"w-6 h-6"})])):b("",!0),R.value?(a(),d("button",{key:1,onClick:j($,["stop"]),class:"absolute right-4 top-1/2 -translate-y-1/2 p-3 rounded-full bg-black/40 hover:bg-black/60 text-white transition-colors",title:"Next (→)"},[h(re,{class:"w-6 h-6"})])):b("",!0)],544),t("div",ke,[t("div",xe,[t("div",Ce,[(a(!0),d(ce,null,ie(I.value,(f,m)=>(a(),d("div",{key:T(f),onClick:U=>o.value=m,class:he(["w-16 h-16 rounded-md overflow-hidden cursor-pointer flex-shrink-0 border-2 transition-colors",m===o.value?"border-blue-500":"border-transparent hover:border-gray-400"])},[E(f.src)?(a(),L(A,{key:0,src:f.src,class:"w-full h-full object-cover"},null,8,["src"])):(a(),d("img",{key:1,src:f.src,class:"w-full h-full object-cover"},null,8,Ie))],10,Me))),128))])])])])):b("",!0)]}),_:1})]))}};export{Le as default};
