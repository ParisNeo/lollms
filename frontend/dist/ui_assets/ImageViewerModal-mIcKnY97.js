import{u as G,Q as H,r as u,b as p,a7 as J,d as Z,e as ee,f as j,o as s,g as h,w as te,c as d,h as g,A as ae,p as L,a as t,t as A,aM as se,E as oe,aq as le,b2 as ne,k as B,S as N,q as re,s as ce,F as ie,j as ue,n as de,T as ve,z as fe,at as he}from"./index-CQBOoy6t.js";const me={class:"flex-shrink-0 flex items-center justify-between p-4 text-white"},pe={class:"min-w-0"},we={class:"text-sm font-semibold truncate"},be={key:0,class:"text-xs text-gray-300 font-mono truncate"},ge={class:"flex items-center gap-2"},ye={class:"w-full h-full flex items-center justify-center p-4"},_e=["src"],ke={class:"flex-shrink-0 bg-black/20 p-2"},xe={class:"overflow-x-auto py-2 custom-scrollbar"},Ce={class:"flex items-center gap-3 px-2 whitespace-nowrap"},Me=["onClick"],Ie=["src"],je={__name:"ImageViewerModal",setup(Re){const v=G(),T=H(),l=u(0),n=u(1),w=u(0),b=u(0),y=u(!1),x=u(0),C=u(0),M=u(null),I=p(()=>v.imageViewer.imageList),r=p(()=>I.value[l.value]||null),c=p(()=>{var e;return(e=r.value)==null?void 0:e.src}),R=p(()=>l.value<I.value.length-1),V=p(()=>l.value>0),D=p(()=>({transform:`scale(${n.value}) translate(${w.value}px, ${b.value}px)`,cursor:y.value?"grabbing":"grab"}));J(()=>v.imageViewer.isOpen,e=>{e&&(l.value=v.imageViewer.startIndex,k())});function E(e){return e&&e.startsWith("/api/")}function O(e){return e&&e.src?e.id||e.src.substring(e.src.length-30):Math.random()}const _=()=>v.closeImageViewer(),S=()=>{R.value&&l.value++,k()},$=()=>{V.value&&l.value--,k()};function Y(e){v.imageViewer.isOpen&&(e.key==="Escape"&&_(),e.key==="ArrowRight"&&R.value&&S(),e.key==="ArrowLeft"&&V.value&&$())}async function W(){var e;if(c.value)try{const i=await he.get(c.value,{responseType:"blob"}),o=window.URL.createObjectURL(new Blob([i.data])),a=document.createElement("a");a.href=o,a.setAttribute("download",((e=r.value)==null?void 0:e.filename)||"image.png"),document.body.appendChild(a),a.click(),document.body.removeChild(a),window.URL.revokeObjectURL(o)}catch(i){console.error("Download failed:",i),v.addNotification("Failed to download image.","error")}}function z(){!r.value||!r.value.id||(_(),T.push(`/image-studio/edit/${r.value.id}`))}function k(){n.value=1,w.value=0,b.value=0}function F(e){e.preventDefault();const i=.1;if(!M.value)return;const o=M.value.getBoundingClientRect(),a=e.clientX-o.left,f=e.clientY-o.top,m=n.value,X=m*(1-Math.sign(e.deltaY)*i);n.value=Math.min(Math.max(.1,10),X);const K=w.value-(a/m-a/n.value),Q=b.value-(f/m-f/n.value);w.value=K,b.value=Q}function P(e){e.button===0&&(e.preventDefault(),y.value=!0,x.value=e.clientX,C.value=e.clientY)}function q(e){if(!y.value)return;e.preventDefault();const i=(e.clientX-x.value)/n.value,o=(e.clientY-C.value)/n.value;w.value+=i,b.value+=o,x.value=e.clientX,C.value=e.clientY}function U(){y.value=!1}return Z(()=>{document.addEventListener("keydown",Y)}),ee(()=>{document.removeEventListener("keydown",Y)}),(e,i)=>(s(),j(fe,{to:"body"},[h(ve,{"enter-active-class":"transition-opacity ease-out duration-300","enter-from-class":"opacity-0","enter-to-class":"opacity-100","leave-active-class":"transition-opacity ease-in duration-200","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:te(()=>{var o,a;return[ae(v).imageViewer.isOpen?(s(),d("div",{key:0,class:"fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex flex-col",onClick:L(_,["self"])},[t("div",me,[t("div",pe,[t("p",we,A(((o=r.value)==null?void 0:o.prompt)||"Image"),1),(a=r.value)!=null&&a.model?(s(),d("p",be,A(r.value.model),1)):g("",!0)]),t("div",ge,[t("button",{onClick:k,class:"p-2 rounded-full hover:bg-white/20 transition-colors",title:"Reset View"},[h(se,{class:"w-6 h-6"})]),t("button",{onClick:z,class:"p-2 rounded-full hover:bg-white/20 transition-colors",title:"Edit Image"},[h(oe,{class:"w-6 h-6"})]),t("button",{onClick:W,class:"p-2 rounded-full hover:bg-white/20 transition-colors",title:"Download"},[h(le,{class:"w-6 h-6"})]),t("button",{onClick:_,class:"p-2 rounded-full hover:bg-white/20 transition-colors",title:"Close (Esc)"},[h(ne,{class:"w-6 h-6"})])])]),t("div",{ref_key:"imageWrapperRef",ref:M,class:"flex-1 flex items-center justify-center min-h-0 relative overflow-hidden",onWheel:F,onMousedown:P,onMousemove:q,onMouseup:U,onMouseleave:U},[t("div",ye,[E(c.value)?(s(),j(B,{key:c.value,src:c.value,style:N(D.value),class:"object-contain transition-transform max-w-full max-h-full"},null,8,["src","style"])):c.value?(s(),d("img",{key:c.value,src:c.value,style:N(D.value),class:"object-contain transition-transform max-w-full max-h-full"},null,12,_e)):g("",!0)]),V.value?(s(),d("button",{key:0,onClick:L($,["stop"]),class:"absolute left-4 top-1/2 -translate-y-1/2 p-3 rounded-full bg-black/40 hover:bg-black/60 text-white transition-colors",title:"Previous (←)"},[h(re,{class:"w-6 h-6"})])):g("",!0),R.value?(s(),d("button",{key:1,onClick:L(S,["stop"]),class:"absolute right-4 top-1/2 -translate-y-1/2 p-3 rounded-full bg-black/40 hover:bg-black/60 text-white transition-colors",title:"Next (→)"},[h(ce,{class:"w-6 h-6"})])):g("",!0)],544),t("div",ke,[t("div",xe,[t("div",Ce,[(s(!0),d(ie,null,ue(I.value,(f,m)=>(s(),d("div",{key:O(f),onClick:X=>l.value=m,class:de(["w-16 h-16 rounded-md overflow-hidden cursor-pointer flex-shrink-0 border-2 transition-colors",m===l.value?"border-blue-500":"border-transparent hover:border-gray-400"])},[E(f.src)?(s(),j(B,{key:0,src:f.src,class:"w-full h-full object-cover"},null,8,["src"])):(s(),d("img",{key:1,src:f.src,class:"w-full h-full object-cover"},null,8,Ie))],10,Me))),128))])])])])):g("",!0)]}),_:1})]))}};export{je as default};
