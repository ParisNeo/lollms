import{D as B,g as n,d,f as e,a as U,X as S,c,r as h,o as T,A as i,U as A,k as M,am as N,i as P,v as V,ak as D,t as p,l as v,p as I,F as L,B as F,Z as H}from"./index-GJY6etPD.js";import{useAdminStore as z}from"./admin-CVB73vxO.js";import{I as O}from"./IconArchiveBox-BS_vPSaT.js";const j={},E={width:"50px",height:"50px",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"};function $(y,a){return d(),n("svg",E,a[0]||(a[0]=[e("title",null,null,-1),e("g",{id:"Complete"},[e("g",{id:"bubble-square"},[e("path",{d:"M7.7,18.3H19.4a2.1,2.1,0,0,0,2.1-2.1V4.6a2.1,2.1,0,0,0-2.1-2.1H4.6A2.1,2.1,0,0,0,2.5,4.6V21.5Z",fill:"none",stroke:"#000000","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"})])],-1)]))}const q=B(j,[["render",$]]),K={class:"space-y-8"},R={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},Z={class:"bg-white dark:bg-gray-800 p-6 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700"},X={class:"flex items-center gap-4 mb-4"},Y={class:"p-3 bg-blue-100 dark:bg-blue-900/30 text-blue-600 rounded-full"},G={class:"bg-white dark:bg-gray-800 p-6 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700"},J={class:"flex items-center gap-4 mb-4"},Q={class:"p-3 bg-red-100 dark:bg-red-900/30 text-red-600 rounded-full"},W={class:"bg-white dark:bg-gray-800 p-6 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700"},ee={class:"font-bold text-lg mb-4 flex items-center gap-2"},te={class:"flex gap-2"},se=["disabled"],ae={class:"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden"},re={class:"p-4 bg-gray-50 dark:bg-gray-700/50 border-b dark:border-gray-700 flex justify-between items-center"},oe={class:"flex items-center gap-2"},ne={class:"text-sm font-medium px-2 py-1 bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400 rounded-full"},de={class:"max-h-96 overflow-y-auto p-4"},le={key:0,class:"text-center text-gray-500 py-4"},ie={key:1,class:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4"},ce={class:"flex items-center gap-3 overflow-hidden"},ue={class:"truncate"},ge=["title"],pe={class:"text-xs text-gray-500"},fe=["onClick"],ye={__name:"Operations",setup(y){const a=z(),o=U(),x=S(),f=c(()=>a.connectedUsers),b=c(()=>a.allUsers),w=c(()=>a.isLoadingConnectedUsers),l=h(""),u=h(!1),g=c(()=>b.value.length?f.value.map(r=>b.value.find(s=>s.id===r.id)||r):f.value);T(()=>{a.fetchConnectedUsers(),a.fetchAllUsers()});async function _(){const{confirmed:r,value:t}=await o.showConfirmation({title:"Secure System Backup",message:"Enter a MANDATORY password to encrypt the backup.",confirmText:"Backup",inputType:"password",inputPlaceholder:"Encryption Password"});if(r){if(!t){o.addNotification("Password is required for backup.","error");return}try{await a.createBackup(t),o.addNotification("Secure backup task started.","info")}catch{o.addNotification("Failed to start backup.","error")}}}async function k(){const r=await o.showConfirmation({title:"Purge Temporary Files?",message:"Delete temporary files older than 24 hours from all user directories?",confirmText:"Purge",cancelText:"Cancel"});r&&r.confirmed&&(a.purgeUnusedUploads(),o.addNotification("Purge task started.","info"))}async function m(){if(l.value.trim()){u.value=!0;try{await a.broadcastMessage(l.value),o.addNotification("Broadcast sent successfully.","success"),l.value=""}finally{u.value=!1}}}function C(r){x.openConversation({id:r.id,username:r.username,icon:r.icon}),o.setMainView("chat")}return(r,t)=>(d(),n("div",K,[t[7]||(t[7]=e("h3",{class:"text-xl font-bold text-gray-900 dark:text-white"},"System Operations",-1)),e("div",R,[e("div",Z,[e("div",X,[e("div",Y,[i(O,{class:"w-6 h-6"})]),t[2]||(t[2]=e("div",null,[e("h4",{class:"font-bold text-lg"},"System Backup"),e("p",{class:"text-sm text-gray-500"},"Create an encrypted full backup.")],-1))]),e("button",{onClick:_,class:"btn btn-primary w-full"},"Start Backup")]),e("div",G,[e("div",J,[e("div",Q,[i(A,{class:"w-6 h-6"})]),t[3]||(t[3]=e("div",null,[e("h4",{class:"font-bold text-lg"},"Cleanup"),e("p",{class:"text-sm text-gray-500"},"Purge old temporary files.")],-1))]),e("button",{onClick:k,class:"btn btn-danger-outline w-full"},"Purge Temp Files")])]),e("div",W,[e("h4",ee,[i(N,{class:"w-5 h-5 text-gray-500"}),t[4]||(t[4]=M(" Broadcast Message "))]),e("div",te,[P(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>l.value=s),type:"text",class:"input-field flex-grow",placeholder:"Type a message to send to all connected users...",onKeyup:D(m,["enter"])},null,544),[[V,l.value]]),e("button",{onClick:m,disabled:!l.value||u.value,class:"btn btn-primary px-6"}," Send ",8,se)])]),e("div",ae,[e("div",re,[t[6]||(t[6]=e("h4",{class:"font-bold text-lg"},"Live Users",-1)),e("div",oe,[e("span",ne,p(g.value.length)+" Online ",1),e("button",{onClick:t[1]||(t[1]=(...s)=>v(a).fetchConnectedUsers&&v(a).fetchConnectedUsers(...s)),class:"btn-icon p-1"},[(d(),n("svg",{xmlns:"http://www.w3.org/2000/svg",class:I(["h-4 w-4",{"animate-spin":w.value}]),viewBox:"0 0 20 20",fill:"currentColor"},t[5]||(t[5]=[e("path",{"fill-rule":"evenodd",d:"M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z","clip-rule":"evenodd"},null,-1)]),2))])])]),e("div",de,[g.value.length===0?(d(),n("div",le,"No users currently connected.")):(d(),n("div",ie,[(d(!0),n(L,null,F(g.value,s=>(d(),n("div",{key:s.id,class:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700/30 rounded-lg border border-gray-200 dark:border-gray-700"},[e("div",ce,[i(H,{icon:s.icon,username:s.username,"size-class":"h-8 w-8"},null,8,["icon","username"]),e("div",ue,[e("p",{class:"font-medium text-sm truncate",title:s.username},p(s.username),9,ge),e("p",pe,"ID: "+p(s.id),1)])]),e("button",{onClick:be=>C(s),class:"btn btn-secondary btn-xs",title:"Send Direct Message"},[i(q,{class:"w-4 h-4"})],8,fe)]))),128))]))])])]))}};export{ye as default};
