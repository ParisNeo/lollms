import{u as U,ag as E,an as A,c as g,L as b,k as z,j as $,a as D,o as n,w as M,b as e,d as u,t as x,e as i,K as R,J as d,T as p,l as N,F as P,n as V,ap as j,a7 as L,M as h}from"./index-IMwO7oGA.js";import{_ as B}from"./GenericModal-D7D7fv2K.js";const G={class:"grid grid-cols-1 sm:grid-cols-2 gap-6"},T={class:"relative flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg"},F={class:"relative flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg"},J=["disabled"],K={class:"relative flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg"},O={class:"space-y-4 pt-4 border-t dark:border-gray-600"},q=["disabled"],H={key:0,disabled:"",value:""},I={key:1,disabled:"",value:""},Q=["value"],W={class:"space-y-4 pt-4 border-t dark:border-gray-600"},X={class:"flex flex-col sm:flex-row gap-4"},Y=["disabled"],Z={key:1,class:"p-6 text-center text-gray-500"},ee={class:"flex justify-end space-x-3"},te=["disabled"],oe={__name:"AdminUserEditModal",setup(se){const r=U(),_=E(),{availableLollmsModels:c,isLoadingLollmsModels:y}=A(_),k=g(()=>r.modalData("adminUserEdit")),o=g(()=>{var a;return(a=k.value)==null?void 0:a.user}),v=g(()=>{var a;return(a=k.value)==null?void 0:a.onUserUpdated}),s=b({is_admin:!1,is_moderator:!1,is_active:!1,lollms_model_name:"",llm_ctx_size:null,safe_store_vectorizer:""}),m=b(!1),f=b(!1);z(o,a=>{a&&(s.value={is_admin:a.is_admin,is_moderator:a.is_moderator,is_active:a.is_active,lollms_model_name:a.lollms_model_name||"",llm_ctx_size:a.llm_ctx_size,safe_store_vectorizer:a.safe_store_vectorizer||""})},{immediate:!0}),z(()=>s.value.is_admin,a=>{a&&(s.value.is_moderator=!0)});async function w(){if(!(!o.value||!o.value.id)){m.value=!0;try{const a={is_admin:s.value.is_admin,is_moderator:s.value.is_moderator,is_active:s.value.is_active,lollms_model_name:s.value.lollms_model_name||null,llm_ctx_size:s.value.llm_ctx_size?Number(s.value.llm_ctx_size):null,safe_store_vectorizer:s.value.safe_store_vectorizer||null};await h.put(`/api/admin/users/${o.value.id}`,a),v.value&&typeof v.value=="function"&&v.value(),r.addNotification("User updated successfully.","success"),r.closeModal("adminUserEdit")}catch{}finally{m.value=!1}}}function C(){r.openModal("resetPassword",{user:o.value,onPasswordReset:()=>{r.closeModal("adminUserEdit")}})}async function S(){var a;if((a=o.value)!=null&&a.id){f.value=!0;try{const t=await h.post(`/api/admin/users/${o.value.id}/generate-reset-link`);r.openModal("passwordResetLink",{username:o.value.username,link:t.data.reset_link})}catch{r.addNotification("Failed to generate reset link.","error")}finally{f.value=!1}}}return $(()=>{c.value.length===0&&_.fetchAdminAvailableLollmsModels()}),(a,t)=>(n(),D(B,{"modal-name":"adminUserEdit",title:o.value?`Edit User: ${o.value.username}`:"Edit User"},{body:M(()=>[o.value?(n(),i("form",{key:0,onSubmit:R(w,["prevent"]),class:"p-6 space-y-6"},[e("div",G,[e("div",T,[t[7]||(t[7]=e("span",{class:"flex-grow flex flex-col"},[e("span",{class:"text-sm font-medium text-gray-900 dark:text-gray-100"},"Administrator"),e("span",{class:"text-sm text-gray-500 dark:text-gray-400"},"Grants full system access.")],-1)),e("button",{onClick:t[0]||(t[0]=l=>s.value.is_admin=!s.value.is_admin),type:"button",class:d([s.value.is_admin?"bg-blue-600":"bg-gray-200 dark:bg-gray-600","relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800"])},[e("span",{class:d([s.value.is_admin?"translate-x-5":"translate-x-0","pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out"])},null,2)],2)]),e("div",F,[t[8]||(t[8]=e("span",{class:"flex-grow flex flex-col"},[e("span",{class:"text-sm font-medium text-gray-900 dark:text-gray-100"},"Moderator"),e("span",{class:"text-sm text-gray-500 dark:text-gray-400"},"Can delete user content.")],-1)),e("button",{onClick:t[1]||(t[1]=l=>s.value.is_moderator=!s.value.is_moderator),type:"button",disabled:s.value.is_admin,class:d([s.value.is_moderator?"bg-blue-600":"bg-gray-200 dark:bg-gray-600","relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800",{"opacity-50 cursor-not-allowed":s.value.is_admin}])},[e("span",{class:d([s.value.is_moderator?"translate-x-5":"translate-x-0","pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out"])},null,2)],10,J)]),e("div",K,[t[9]||(t[9]=e("span",{class:"flex-grow flex flex-col"},[e("span",{class:"text-sm font-medium text-gray-900 dark:text-gray-100"},"Account Active"),e("span",{class:"text-sm text-gray-500 dark:text-gray-400"},"Allows the user to log in.")],-1)),e("button",{onClick:t[2]||(t[2]=l=>s.value.is_active=!s.value.is_active),type:"button",class:d([s.value.is_active?"bg-blue-600":"bg-gray-200 dark:bg-gray-600","relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800"])},[e("span",{class:d([s.value.is_active?"translate-x-5":"translate-x-0","pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out"])},null,2)],2)])]),e("div",O,[t[16]||(t[16]=e("h3",{class:"text-base font-semibold leading-6 text-gray-900 dark:text-white"},"Core Assignments",-1)),e("div",null,[t[11]||(t[11]=e("label",{for:"lollmsModelSelect",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Default LLM Model",-1)),p(e("select",{id:"lollmsModelSelect","onUpdate:modelValue":t[3]||(t[3]=l=>s.value.lollms_model_name=l),class:"input-field mt-1",disabled:u(y)},[u(y)?(n(),i("option",H,"Loading models...")):u(c).length===0?(n(),i("option",I,"No models available")):N("",!0),t[10]||(t[10]=e("option",{value:""},"(Use System Default)",-1)),(n(!0),i(P,null,V(u(c),l=>(n(),i("option",{key:l.id,value:l.id},x(l.name),9,Q))),128))],8,q),[[j,s.value.lollms_model_name]])]),e("div",null,[t[12]||(t[12]=e("label",{for:"contextSize",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Context Size Override",-1)),p(e("input",{type:"number",id:"contextSize","onUpdate:modelValue":t[4]||(t[4]=l=>s.value.llm_ctx_size=l),class:"input-field mt-1",placeholder:"e.g., 4096"},null,512),[[L,s.value.llm_ctx_size,void 0,{number:!0}]]),t[13]||(t[13]=e("p",{class:"mt-1 text-xs text-gray-500 dark:text-gray-400"},"Leave blank to use the system or user's default setting.",-1))]),e("div",null,[t[14]||(t[14]=e("label",{for:"vectorizer",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Default Vectorizer",-1)),p(e("input",{type:"text",id:"vectorizer","onUpdate:modelValue":t[5]||(t[5]=l=>s.value.safe_store_vectorizer=l),class:"input-field mt-1",placeholder:"e.g., st:all-MiniLM-L6-v2"},null,512),[[L,s.value.safe_store_vectorizer]]),t[15]||(t[15]=e("p",{class:"mt-1 text-xs text-gray-500 dark:text-gray-400"},"The default vectorizer for new data stores created by this user.",-1))])]),e("div",W,[t[17]||(t[17]=e("h3",{class:"text-base font-semibold leading-6 text-gray-900 dark:text-white"},"Password Management",-1)),e("div",X,[e("button",{type:"button",onClick:C,class:"btn btn-warning flex-1"}," Reset Password... "),e("button",{type:"button",onClick:S,class:"btn btn-secondary flex-1",disabled:f.value},x(f.value?"Generating...":"Generate Reset Link..."),9,Y)])])],32)):(n(),i("div",Z," Loading user data... "))]),footer:M(()=>[e("div",ee,[e("button",{type:"button",class:"btn btn-secondary",onClick:t[6]||(t[6]=l=>u(r).closeModal("adminUserEdit"))},"Cancel"),e("button",{type:"button",class:"btn btn-primary",disabled:m.value||!o.value,onClick:w},x(m.value?"Saving...":"Save Changes"),9,te)])]),_:1},8,["title"]))}};export{oe as default};
