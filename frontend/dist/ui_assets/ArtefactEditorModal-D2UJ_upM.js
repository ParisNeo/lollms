import{u as F,al as R,c as y,N as u,m as q,a as K,o as n,w as N,b as a,d as L,t as B,K as O,e as o,g as E,W,ak as z,f as x,aq as G,h as V,ax as H,D as J,F as D,r as M,n as P}from"./index-Cg5UBQvj.js";import{_ as Q}from"./GenericModal-Bc6NrQaT.js";const X=["disabled"],Y={key:0,class:"text-xs text-gray-500 mt-1"},Z={class:"flex justify-between items-center mb-2"},ee={class:"flex items-center gap-2"},te=["disabled"],ae={key:0,class:"text-center text-sm text-gray-500 p-4 border-2 border-dashed rounded-lg"},se={key:1,class:"grid grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-2 p-2 border rounded-lg"},le=["src"],ne=["onClick"],oe=["src"],re=["onClick"],ie={key:0,class:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg"},ue={class:"flex-grow flex flex-col"},de={class:"text-sm text-gray-500 dark:text-gray-400"},pe={__name:"ArtefactEditorModal",setup(ce){const p=F(),k=R(),I=y(()=>p.modalData("artefactEditor")),d=y(()=>{var t;return(t=I.value)==null?void 0:t.artefact}),h=y(()=>{var t;return(t=I.value)==null?void 0:t.discussionId}),c=y(()=>{var t;return!!((t=d.value)!=null&&t.title)}),g=u(""),f=u(""),v=u([]),b=u([]),m=u([]),_=u(null),r=u(!1);q(()=>p.isModalOpen("artefactEditor"),t=>{var e,s,l;t&&(g.value=((e=d.value)==null?void 0:e.title)||"",f.value=((s=d.value)==null?void 0:s.content)||"",v.value=(((l=d.value)==null?void 0:l.images)||[]).map(i=>`data:image/png;base64,${i}`),b.value=[],m.value=[],r.value=!1)},{immediate:!0});function S(){var t;(t=_.value)==null||t.click()}async function T(t){const e=Array.from(t.target.files);for(const s of e){b.value.push(s);const l=new FileReader;l.onload=i=>{m.value.push(i.target.result)},l.readAsDataURL(s)}t.target.value=""}function U(t){v.value.splice(t,1)}function $(t){b.value.splice(t,1),m.value.splice(t,1)}function j(){v.value=[],b.value=[],m.value=[]}const C=y(()=>[...v.value,...m.value]);async function A(){if(!g.value.trim()||!h.value){p.addNotification("Title is required.","warning");return}const t=await Promise.all(b.value.map(s=>new Promise((l,i)=>{const w=new FileReader;w.onload=()=>l(w.result.split(",")[1]),w.onerror=i,w.readAsDataURL(s)}))),e=v.value.map(s=>s.split(",")[1]);c.value?await k.updateArtefact({discussionId:h.value,artefactTitle:d.value.title,newContent:f.value,newImagesB64:t,keptImagesB64:e,version:d.value.version,updateInPlace:r.value}):await k.createManualArtefact({discussionId:h.value,title:g.value,content:f.value,imagesB64:[...e,...t]}),p.closeModal("artefactEditor")}return(t,e)=>(n(),K(Q,{modalName:"artefactEditor",title:c.value?"Edit Artefact":"Create New Artefact",maxWidthClass:"max-w-4xl"},{body:N(()=>[a("form",{onSubmit:O(A,["prevent"]),class:"space-y-4"},[a("div",null,[e[4]||(e[4]=a("label",{for:"artefact-title",class:"label"},"Title",-1)),W(a("input",{id:"artefact-title",type:"text","onUpdate:modelValue":e[0]||(e[0]=s=>g.value=s),class:"input-field",disabled:c.value,required:""},null,8,X),[[z,g.value]]),c.value?(n(),o("p",Y,"Title cannot be changed after creation.")):E("",!0)]),a("div",null,[e[5]||(e[5]=a("label",{for:"artefact-content",class:"label"},"Content",-1)),x(G,{modelValue:f.value,"onUpdate:modelValue":e[1]||(e[1]=s=>f.value=s),class:"h-64"},null,8,["modelValue"])]),a("div",null,[a("div",Z,[e[8]||(e[8]=a("label",{class:"label"},"Images",-1)),a("div",ee,[a("button",{onClick:j,type:"button",class:"btn btn-danger-outline btn-sm",disabled:C.value.length===0},[x(H,{class:"w-4 h-4 mr-1"}),e[6]||(e[6]=V(" Remove All "))],8,te),a("button",{onClick:S,type:"button",class:"btn btn-secondary btn-sm"},[x(J,{class:"w-4 h-4 mr-1"}),e[7]||(e[7]=V(" Add Images "))])])]),a("input",{type:"file",ref_key:"imageInput",ref:_,onChange:T,multiple:"",accept:"image/*",class:"hidden"},null,544),C.value.length===0?(n(),o("div",ae," No images attached. ")):(n(),o("div",se,[(n(!0),o(D,null,M(v.value,(s,l)=>(n(),o("div",{key:s,class:"relative group"},[a("img",{src:s,class:"w-full h-24 object-cover rounded-md",alt:"Kept image"},null,8,le),a("button",{onClick:i=>U(l),type:"button",class:"absolute top-1 right-1 bg-red-500 text-white rounded-full w-5 h-5 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity"},"×",8,ne)]))),128)),(n(!0),o(D,null,M(m.value,(s,l)=>(n(),o("div",{key:s,class:"relative group"},[a("img",{src:s,class:"w-full h-24 object-cover rounded-md",alt:"New image preview"},null,8,oe),a("button",{onClick:i=>$(l),type:"button",class:"absolute top-1 right-1 bg-red-500 text-white rounded-full w-5 h-5 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity"},"×",8,re)]))),128))]))]),c.value?(n(),o("div",ie,[a("span",ue,[e[9]||(e[9]=a("span",{class:"text-sm font-medium text-gray-900 dark:text-gray-100"},"Update Current Version",-1)),a("span",de,B(r.value?"Overwrite this version directly.":"Create a new version with your changes."),1)]),a("button",{onClick:e[2]||(e[2]=s=>r.value=!r.value),type:"button",class:P([r.value?"bg-blue-600":"bg-gray-200 dark:bg-gray-600","relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out"])},[a("span",{class:P([r.value?"translate-x-5":"translate-x-0","pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition-colors duration-200 ease-in-out"])},null,2)],2)])):E("",!0)],32)]),footer:N(()=>[a("button",{onClick:e[3]||(e[3]=s=>L(p).closeModal("artefactEditor")),type:"button",class:"btn btn-secondary"},"Cancel"),a("button",{onClick:A,type:"button",class:"btn btn-primary"},B(c.value?"Save Changes":"Create Artefact"),1)]),_:1},8,["title"]))}};export{pe as default};
