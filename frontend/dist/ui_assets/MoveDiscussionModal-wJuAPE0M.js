import{u as I,aS as $,b as a,r as b,S as B,f as C,o as v,w as g,a as l,A as F,t as y,p as L,J as N,c as _,F as T,j as U,L as V}from"./index-BzYhVBtc.js";import{_ as j}from"./GenericModal-CJPUG58e.js";const A=["value"],E={class:"flex justify-end gap-2"},H=["disabled"],z={__name:"MoveDiscussionModal",setup(J){const d=I(),m=$(),i=a(()=>d.modalData("moveDiscussion")),D=a(()=>{var e;return(e=i.value)==null?void 0:e.discussionId}),S=a(()=>{var e;return(e=i.value)==null?void 0:e.currentTitle}),h=a(()=>{var e;return(e=i.value)==null?void 0:e.currentGroupId}),u=b(null),n=b(!1),x=a(()=>m.discussionGroups);B(i,e=>{e&&(u.value=e.currentGroupId||null)},{immediate:!0});const w=a(()=>`Move "${S.value||"Discussion"}"`),p=a(()=>u.value!==h.value);function f(e,o=null,s=0,r=new Set){let c=[];const k=e.filter(t=>t.parent_id===o);for(const t of k){if(r.has(t.id)){console.warn("Circular dependency detected in discussion groups, skipping:",t);continue}r.add(t.id),c.push({value:t.id,text:`${"â€”".repeat(s)} ${t.name}`}),c=c.concat(f(e,t.id,s+1,r)),r.delete(t.id)}return c}const G=a(()=>[{value:null,text:"None (Ungrouped)"},...f(x.value)]);async function M(){if(!(!p.value||n.value)){n.value=!0;try{await m.moveDiscussionToGroup(D.value,u.value),d.closeModal("moveDiscussion")}catch{}finally{n.value=!1}}}return(e,o)=>(v(),C(j,{modalName:"moveDiscussion",title:w.value},{body:g(()=>[l("form",{onSubmit:L(M,["prevent"]),id:"move-discussion-form",class:"space-y-4 p-6"},[l("div",null,[o[2]||(o[2]=l("label",{for:"target-group",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"}," Select a group to move this discussion to: ",-1)),N(l("select",{id:"target-group","onUpdate:modelValue":o[0]||(o[0]=s=>u.value=s),class:"mt-1 input-field w-full"},[(v(!0),_(T,null,U(G.value,s=>(v(),_("option",{key:s.value,value:s.value},y(s.text),9,A))),128))],512),[[V,u.value]])])],32)]),footer:g(()=>[l("div",E,[l("button",{type:"button",onClick:o[1]||(o[1]=s=>F(d).closeModal("moveDiscussion")),class:"btn btn-secondary"}," Cancel "),l("button",{type:"submit",form:"move-discussion-form",disabled:!p.value||n.value,class:"btn btn-primary"},y(n.value?"Moving...":"Move"),9,H)])]),_:1},8,["title"]))}};export{z as default};
