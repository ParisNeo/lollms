import{u as ye,ax as xe,ay as we,az as W,r as b,b as T,a7 as X,d as he,c as u,o as d,a as t,g as C,M as P,J as m,K as y,F as Z,j as H,n as x,h as p,t as M,Z as ke,p as Te,f as R,a4 as Me,aF as Se,ad as Q,aD as Be,an as Ce}from"./index-X76Zlg0l.js";import{u as Ae}from"./admin-B4p34gEf.js";const Ne={class:"flex flex-col h-[70vh]"},De={key:0,class:"flex-grow flex items-center justify-center"},Ie={class:"text-center"},$e={key:1,class:"flex flex-grow overflow-hidden"},je={class:"w-1/3 border-r dark:border-gray-700 pr-4 flex flex-col min-w-[250px]"},ze={class:"relative mb-2"},Ue={class:"overflow-y-auto flex-grow"},Ge={key:0,class:"space-y-1"},Fe=["onClick"],Ve={class:"flex-grow min-w-0"},Pe={class:"font-medium text-sm truncate"},Re={key:0,class:"text-xs opacity-70 truncate"},Le={class:"flex-shrink-0 flex items-center gap-1"},Ee={key:0,class:"w-2 h-2 rounded-full bg-blue-500",title:"Binding Default"},qe={key:1,class:"w-2 h-2 rounded-full bg-green-500",title:"Global Default"},Je={key:1,class:"text-center text-sm text-gray-500 py-4"},Oe={class:"w-2/3 pl-4 overflow-y-auto"},Ke={key:0,class:"flex items-center justify-center h-full"},We={class:"text-center text-gray-500"},Xe={key:1},Ze={class:"flex items-center justify-between mb-4 pb-2 border-b dark:border-gray-700"},He=["title"],Qe={class:"flex gap-4"},Ye={class:"flex-shrink-0"},et={class:"group relative w-20 h-20 rounded-lg border-2 border-dashed border-gray-300 dark:border-gray-600 flex items-center justify-center bg-gray-50 dark:bg-gray-800"},tt=["src"],lt={key:2,class:"absolute inset-0 bg-white/80 dark:bg-black/60 flex items-center justify-center rounded-md"},it={key:3,class:"absolute inset-0 bg-black/60 rounded-md flex items-center justify-center gap-2 opacity-0 group-hover:opacity-100 transition-opacity"},at={class:"flex-grow space-y-3"},nt={key:0,class:"p-4 border rounded-lg dark:border-gray-700 bg-gray-50 dark:bg-gray-800/50"},st={class:"grid grid-cols-2 gap-4"},ot={class:"col-span-2 sm:col-span-1"},dt={class:"flex items-center gap-2"},rt=["disabled"],ut={key:1,class:"p-4 border rounded-lg dark:border-gray-700 bg-gray-50 dark:bg-gray-800/50"},ct={class:"grid grid-cols-2 gap-4"},gt=["for"],vt=["type","step","id","onUpdate:modelValue","placeholder"],bt={key:1,class:"mt-1"},ft=["onClick"],mt={key:2,class:"grid grid-cols-2 gap-4"},pt={class:"flex items-center justify-between p-3 border rounded-md dark:border-gray-700"},_t={class:"flex items-center gap-2"},yt={class:"flex items-center justify-between p-3 border rounded-md dark:border-gray-700"},xt={class:"flex items-center justify-between p-3 border rounded-md dark:border-gray-700"},wt={class:"flex justify-end gap-3 pt-2"},ht=["disabled"],kt=["disabled"],Tt={class:"border-t dark:border-gray-600 pt-4"},Mt={class:"space-y-3"},St={class:"flex items-center justify-between"},Bt=["disabled"],Ct={key:0,class:"flex items-center justify-between"},At=["disabled"],It={__name:"BindingModelsManager",props:{binding:{type:Object,required:!0},bindingType:{type:String,required:!0}},setup(A){const i=A,f=ye(),o=Ae();xe();const Y=we(),{globalSettings:ee,availableBindingTypes:te,availableTtiBindingTypes:le,availableTtsBindingTypes:ie,availableTtvBindingTypes:ae,availableTtmBindingTypes:ne,ttiBindings:L}=W(o),{tasks:se}=W(Y),N=b(!0),h=b(!1),D=b(!1),I=b(!1),$=b(!1),S=b(null),U=b(!1),E=b(null),g=b([]),s=b(null),j=b(""),B=b([]),oe=T(()=>L.value&&L.value.some(a=>a.is_active)),G=()=>({icon:"",title:"",name:"",description:"",has_vision:!0,ctx_size:null,ctx_size_locked:!1,temperature:null,top_k:null,top_p:null,repeat_penalty:null,repeat_last_n:null,allow_parameters_override:!0,reasoning_activation:!1,reasoning_effort:null,reasoning_summary:!1}),n=b(G()),F=T(()=>S.value?se.value.find(a=>a.id===S.value):null),de=T(()=>U.value?!0:F.value?["pending","running"].includes(F.value.status):!1);X(F,a=>{if(a)if(a.status==="completed"){let e=a.result;if(e&&typeof e=="string")try{e=JSON.parse(e)}catch{}let l=e&&typeof e=="object"&&e.icon_base64?e.icon_base64:typeof e=="string"?e:null;l?(n.value.icon=l.startsWith("data:image")?l:`data:image/png;base64,${l}`,f.addNotification("Icon generated successfully!","success")):f.addNotification("Icon generation completed, but no image was returned.","warning"),S.value=null}else(a.status==="failed"||a.status==="cancelled")&&(f.addNotification(`Icon generation failed: ${a.error||"Unknown error."}`,"error"),S.value=null)});const q=T(()=>{if(!j.value)return g.value;const a=j.value.toLowerCase();return g.value.filter(e=>{var l,r;return e.original_model_name.toLowerCase().includes(a)||((r=(l=e.alias)==null?void 0:l.title)==null?void 0:r.toLowerCase().includes(a))})}),J=T(()=>{const a=ee.value.find(e=>e.key==="default_lollms_model_name");return a?a.value:null}),O=T(()=>s.value&&i.binding&&s.value.original_model_name===i.binding.default_model_name),K=T(()=>s.value&&i.binding&&`${i.binding.alias}/${s.value.original_model_name}`===J.value),re=a=>i.binding&&a===i.binding.default_model_name,ue=a=>i.binding&&`${i.binding.alias}/${a}`===J.value;async function z(){if(!i.binding){N.value=!1,g.value=[];return}N.value=!0;try{switch(i.bindingType){case"llm":g.value=await o.fetchBindingModels(i.binding.id);break;case"tti":g.value=await o.fetchTtiBindingModels(i.binding.id);break;case"tts":g.value=await o.fetchTtsBindingModels(i.binding.id);break;case"stt":g.value=await o.fetchSttBindingModels(i.binding.id);break;case"ttv":g.value=await o.fetchTtvBindingModels(i.binding.id);break;case"ttm":g.value=await o.fetchTtmBindingModels(i.binding.id);break;case"rag":g.value=await o.fetchRagBindingModels(i.binding.id);break;default:g.value=[]}}finally{N.value=!1}}function V(a){var c;s.value=a;const e={...G(),...a.alias||{}};i.bindingType==="llm"&&!e.name&&(e.name=e.title||a.original_model_name);let l;i.bindingType==="tti"?l=le.value:i.bindingType==="tts"?l=ie.value:i.bindingType==="ttv"?l=ae.value:i.bindingType==="ttm"?l=ne.value:i.bindingType==="rag"?l=o.availableRagBindingTypes:l=te.value;const r=(c=i.binding)==null?void 0:c.name;if(r){const w=l.find(v=>(v.binding_name||v.name)===r),_=(w==null?void 0:w.model_parameters)||[];B.value=_,_.forEach(v=>{v.name in e||(e[v.name]=v.default)})}else B.value=[];n.value=e}async function ce(){if(!(!s.value||!i.binding||i.bindingType!=="llm")){$.value=!0;try{const a=await o.getModelCtxSize(i.binding.id,s.value.original_model_name);a!==null&&(n.value.ctx_size=a)}finally{$.value=!1}}}async function ge(){if(!n.value.title&&!s.value.original_model_name){f.addNotification("Please provide an Alias Title to generate an icon.","warning");return}U.value=!0,S.value=null;try{const e=`a high-quality, abstract, minimalist, vector logo for an AI model named "${n.value.title||s.value.original_model_name}". Description: ${n.value.description||"General purpose model."}`,l=await o.generateIconForModel(e);l!=null&&l.id&&(S.value=l.id,f.addNotification("Icon generation started...","info"))}finally{U.value=!1}}async function ve(){if(!(!s.value||!i.binding)){h.value=!0;try{const a={...n.value};let e={};i.bindingType==="llm"?(a.title&&(a.name=a.title),["ctx_size","temperature","top_k","top_p","repeat_penalty","repeat_last_n"].forEach(r=>{const c=a[r];a[r]=c===""||c===null||isNaN(parseFloat(c))?null:Number(c)}),B.value.forEach(r=>{if(["int","float"].includes(r.type)){const c=a[r.name];a[r.name]=c===""||c===null||isNaN(parseFloat(c))?null:Number(c)}}),e={original_model_name:s.value.original_model_name,alias:a},await o.saveModelAlias(i.binding.id,e)):(B.value.forEach(r=>{if(["int","float"].includes(r.type)){const c=a[r.name];a[r.name]=c===""||c===null||isNaN(parseFloat(c))?null:Number(c)}}),e={original_model_name:s.value.original_model_name,alias:a},i.bindingType==="tti"?await o.saveTtiModelAlias(i.binding.id,e):i.bindingType==="tts"?await o.saveTtsModelAlias(i.binding.id,e):i.bindingType==="stt"?await o.saveSttModelAlias(i.binding.id,e):i.bindingType==="ttv"?await o.saveTtvModelAlias(i.binding.id,e):i.bindingType==="ttm"?await o.saveTtmModelAlias(i.binding.id,e):i.bindingType==="rag"&&await o.saveRagModelAlias(i.binding.id,e)),await z();const l=g.value.find(r=>r.original_model_name===s.value.original_model_name);l&&V(l),f.addNotification("Alias saved.","success")}finally{h.value=!1}}}async function be(){var a;if(!(!((a=s.value)!=null&&a.alias)||!i.binding)&&await f.showConfirmation({title:"Delete Alias?",message:`Delete the alias for '${s.value.original_model_name}'?`,confirmText:"Delete"})){h.value=!0;try{switch(i.bindingType){case"llm":await o.deleteModelAlias(i.binding.id,s.value.original_model_name);break;case"tti":await o.deleteTtiModelAlias(i.binding.id,s.value.original_model_name);break;case"tts":await o.deleteTtsModelAlias(i.binding.id,s.value.original_model_name);break;case"stt":await o.deleteSttModelAlias(i.binding.id,s.value.original_model_name);break;case"ttv":await o.deleteTtvModelAlias(i.binding.id,s.value.original_model_name);break;case"ttm":await o.deleteTtmModelAlias(i.binding.id,s.value.original_model_name);break;case"rag":await o.deleteRagModelAlias(i.binding.id,s.value.original_model_name);break}await z();const e=g.value.find(l=>l.original_model_name===s.value.original_model_name);V(e||g.value[0]||null),f.addNotification("Alias deleted.","success")}finally{h.value=!1}}}async function fe(){if(!(!s.value||!i.binding)){D.value=!0;try{const a={default_model_name:s.value.original_model_name};switch(i.bindingType){case"llm":await o.updateBinding(i.binding.id,a);break;case"tti":await o.updateTtiBinding(i.binding.id,a);break;case"tts":await o.updateTtsBinding(i.binding.id,a);break;case"stt":await o.updateSttBinding(i.binding.id,a);break;case"ttv":await o.updateTtvBinding(i.binding.id,a);break;case"ttm":await o.updateTtmBinding(i.binding.id,a);break}f.addNotification("Binding default model updated.","success")}finally{D.value=!1}}}async function me(){if(!(!s.value||!i.binding||i.bindingType!=="llm")){I.value=!0;try{const a=`${i.binding.alias}/${s.value.original_model_name}`;await o.updateGlobalSettings({default_lollms_model_name:a}),f.addNotification("Global default model for new users has been updated.","success")}finally{I.value=!1}}}function pe(){E.value.click()}function _e(a){const e=a.target.files[0];if(!e)return;if(e.size>5*1024*1024){f.addNotification("File is too large (max 5MB).","error");return}if(!["image/jpeg","image/png","image/webp"].includes(e.type)){f.addNotification("Invalid file type. Use JPG, PNG, and WEBP.","error");return}const l=new FileReader;l.onload=r=>{const c=new Image;c.onload=()=>{const w=document.createElement("canvas"),_=128;let{width:v,height:k}=c;v>k?v>_&&(k*=_/v,v=_):k>_&&(v*=_/k,k=_),w.width=v,w.height=k,w.getContext("2d").drawImage(c,0,0,v,k),n.value.icon=w.toDataURL("image/png")},c.src=r.target.result},l.readAsDataURL(e),a.target.value=""}return he(()=>{z()}),X(()=>i.binding,a=>{a&&(s.value=null,n.value=G(),z())}),(a,e)=>(d(),u("div",Ne,[N.value?(d(),u("div",De,[t("div",Ie,[C(P,{class:"w-8 h-8 text-blue-500 mx-auto mb-2"}),e[12]||(e[12]=t("p",null,"Loading models...",-1))])])):(d(),u("div",$e,[t("div",je,[t("div",ze,[m(t("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=l=>j.value=l),placeholder:"Search models...",class:"input-field w-full pl-8"},null,512),[[y,j.value]]),e[13]||(e[13]=t("div",{class:"absolute inset-y-0 left-0 pl-2 flex items-center pointer-events-none text-gray-400"},[t("svg",{class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})])],-1))]),t("div",Ue,[q.value.length>0?(d(),u("ul",Ge,[(d(!0),u(Z,null,H(q.value,l=>{var r;return d(),u("li",{key:l.original_model_name},[t("button",{onClick:c=>V(l),class:x(["w-full text-left p-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center justify-between transition-colors",{"bg-blue-100 dark:bg-blue-900/50 text-blue-800 dark:text-blue-100":s.value&&s.value.original_model_name===l.original_model_name}])},[t("div",Ve,[t("p",Pe,M(((r=l.alias)==null?void 0:r.title)||l.original_model_name),1),l.alias?(d(),u("p",Re,M(l.original_model_name),1)):p("",!0)]),t("div",Le,[re(l.original_model_name)?(d(),u("span",Ee)):p("",!0),ue(l.original_model_name)?(d(),u("span",qe)):p("",!0)])],10,Fe)])}),128))])):(d(),u("div",Je,"No models match your search."))])]),t("div",Oe,[s.value?(d(),u("div",Xe,[t("div",Ze,[t("h3",{class:"font-semibold text-lg truncate pr-4",title:s.value.original_model_name},M(s.value.original_model_name),9,He)]),t("form",{onSubmit:Te(ve,["prevent"]),class:"space-y-5 pb-6"},[t("div",Qe,[t("div",Ye,[e[15]||(e[15]=t("label",{class:"label mb-1"},"Icon",-1)),t("div",et,[n.value.icon?(d(),u("img",{key:0,src:n.value.icon,alt:"Icon",class:"w-full h-full object-cover rounded-md"},null,8,tt)):(d(),R(Me,{key:1,class:"w-8 h-8 text-gray-400"})),de.value?(d(),u("div",lt,[C(P,{class:"w-6 h-6 text-blue-500"})])):(d(),u("div",it,[t("input",{type:"file",ref_key:"fileInput",ref:E,onChange:_e,class:"hidden",accept:"image/*"},null,544),t("button",{onClick:pe,type:"button",title:"Upload",class:"text-white hover:text-blue-300"},[C(Se,{class:"w-5 h-5"})]),oe.value?(d(),u("button",{key:0,onClick:ge,type:"button",title:"Generate",class:"text-white hover:text-blue-300"},[C(Q,{class:"w-5 h-5"})])):p("",!0)]))])]),t("div",at,[t("div",null,[e[16]||(e[16]=t("label",{for:"alias-title",class:"label"},"Alias Title",-1)),m(t("input",{id:"alias-title","onUpdate:modelValue":e[1]||(e[1]=l=>n.value.title=l),type:"text",class:"input-field",placeholder:"Friendly Name"},null,512),[[y,n.value.title]])]),t("div",null,[e[17]||(e[17]=t("label",{for:"alias-description",class:"label"},"Description",-1)),m(t("input",{id:"alias-description","onUpdate:modelValue":e[2]||(e[2]=l=>n.value.description=l),type:"text",class:"input-field",placeholder:"Short description"},null,512),[[y,n.value.description]])])])]),A.bindingType==="llm"?(d(),u("div",nt,[e[24]||(e[24]=t("h4",{class:"font-medium mb-3 text-sm"},"Generation Parameters",-1)),t("div",st,[t("div",ot,[e[18]||(e[18]=t("label",{class:"label text-xs"},"Context Size",-1)),t("div",dt,[m(t("input",{"onUpdate:modelValue":e[3]||(e[3]=l=>n.value.ctx_size=l),type:"number",class:"input-field",placeholder:"e.g. 4096"},null,512),[[y,n.value.ctx_size]]),t("button",{type:"button",onClick:ce,class:"btn btn-secondary p-2 h-[38px]",title:"Auto-detect",disabled:$.value},[$.value?(d(),R(P,{key:0,class:"w-4 h-4"})):(d(),R(Q,{key:1,class:"w-4 h-4"}))],8,rt)])]),t("div",null,[e[19]||(e[19]=t("label",{class:"label text-xs"},"Temperature",-1)),m(t("input",{"onUpdate:modelValue":e[4]||(e[4]=l=>n.value.temperature=l),type:"number",step:"0.1",class:"input-field"},null,512),[[y,n.value.temperature]])]),t("div",null,[e[20]||(e[20]=t("label",{class:"label text-xs"},"Top K",-1)),m(t("input",{"onUpdate:modelValue":e[5]||(e[5]=l=>n.value.top_k=l),type:"number",class:"input-field"},null,512),[[y,n.value.top_k]])]),t("div",null,[e[21]||(e[21]=t("label",{class:"label text-xs"},"Top P",-1)),m(t("input",{"onUpdate:modelValue":e[6]||(e[6]=l=>n.value.top_p=l),type:"number",step:"0.01",class:"input-field"},null,512),[[y,n.value.top_p]])]),t("div",null,[e[22]||(e[22]=t("label",{class:"label text-xs"},"Repeat Penalty",-1)),m(t("input",{"onUpdate:modelValue":e[7]||(e[7]=l=>n.value.repeat_penalty=l),type:"number",step:"0.1",class:"input-field"},null,512),[[y,n.value.repeat_penalty]])]),t("div",null,[e[23]||(e[23]=t("label",{class:"label text-xs"},"Repeat Last N",-1)),m(t("input",{"onUpdate:modelValue":e[8]||(e[8]=l=>n.value.repeat_last_n=l),type:"number",class:"input-field"},null,512),[[y,n.value.repeat_last_n]])])])])):p("",!0),B.value.length>0?(d(),u("div",ut,[e[25]||(e[25]=t("h4",{class:"font-medium mb-3 text-sm"},"Model Parameters",-1)),t("div",ct,[(d(!0),u(Z,null,H(B.value,l=>(d(),u("div",{key:l.name},[t("label",{for:`p-${l.name}`,class:"label text-xs"},M(l.title||l.name),9,gt),["str","int","float"].includes(l.type)?m((d(),u("input",{key:0,type:l.type==="str"?"text":"number",step:l.type==="float"?"any":1,id:`p-${l.name}`,"onUpdate:modelValue":r=>n.value[l.name]=r,class:"input-field",placeholder:l.help||""},null,8,vt)),[[Be,n.value[l.name]]]):l.type==="bool"?(d(),u("div",bt,[t("button",{type:"button",onClick:r=>n.value[l.name]=!n.value[l.name],class:x([n.value[l.name]?"bg-blue-600":"bg-gray-200 dark:bg-gray-600","relative inline-flex h-5 w-9 flex-shrink-0 cursor-pointer rounded-full transition-colors duration-200 ease-in-out"])},[t("span",{class:x([n.value[l.name]?"translate-x-4":"translate-x-0","pointer-events-none inline-block h-4 w-4 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out"])},null,2)],10,ft)])):p("",!0)]))),128))])])):p("",!0),A.bindingType==="llm"?(d(),u("div",mt,[t("div",pt,[t("div",_t,[C(Ce,{class:"w-4 h-4 text-gray-500"}),e[26]||(e[26]=t("span",{class:"text-sm font-medium"},"Vision Support",-1))]),t("button",{type:"button",onClick:e[9]||(e[9]=l=>n.value.has_vision=!n.value.has_vision),class:x([n.value.has_vision?"bg-blue-600":"bg-gray-200 dark:bg-gray-600","relative inline-flex h-5 w-9 flex-shrink-0 cursor-pointer rounded-full transition-colors duration-200 ease-in-out"])},[t("span",{class:x([n.value.has_vision?"translate-x-4":"translate-x-0","pointer-events-none inline-block h-4 w-4 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out"])},null,2)],2)]),t("div",yt,[e[27]||(e[27]=t("div",{class:"flex items-center gap-2"},[t("span",{class:"text-sm font-medium"},"Lock Context")],-1)),t("button",{type:"button",onClick:e[10]||(e[10]=l=>n.value.ctx_size_locked=!n.value.ctx_size_locked),class:x([n.value.ctx_size_locked?"bg-blue-600":"bg-gray-200 dark:bg-gray-600","relative inline-flex h-5 w-9 flex-shrink-0 cursor-pointer rounded-full transition-colors duration-200 ease-in-out"])},[t("span",{class:x([n.value.ctx_size_locked?"translate-x-4":"translate-x-0","pointer-events-none inline-block h-4 w-4 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out"])},null,2)],2)])])):p("",!0),t("div",xt,[e[28]||(e[28]=t("div",{class:"flex items-center gap-2"},[t("span",{class:"text-sm font-medium"},"Allow User Overrides")],-1)),t("button",{type:"button",onClick:e[11]||(e[11]=l=>n.value.allow_parameters_override=!n.value.allow_parameters_override),class:x([n.value.allow_parameters_override?"bg-blue-600":"bg-gray-200 dark:bg-gray-600","relative inline-flex h-5 w-9 flex-shrink-0 cursor-pointer rounded-full transition-colors duration-200 ease-in-out"])},[t("span",{class:x([n.value.allow_parameters_override?"translate-x-4":"translate-x-0","pointer-events-none inline-block h-4 w-4 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out"])},null,2)],2)]),t("div",wt,[s.value.alias?(d(),u("button",{key:0,type:"button",onClick:be,class:"btn btn-danger-outline",disabled:h.value},"Delete Alias",8,ht)):p("",!0),t("button",{type:"submit",class:"btn btn-primary",disabled:h.value},M(h.value?"Saving...":"Save Alias"),9,kt)])],32),t("div",Tt,[e[31]||(e[31]=t("h4",{class:"font-medium mb-3 text-sm"},"Defaults",-1)),t("div",Mt,[t("div",St,[e[29]||(e[29]=t("span",{class:"text-sm"},"Set as Default for this Binding",-1)),t("button",{onClick:fe,class:"text-blue-600 hover:underline text-sm font-medium",disabled:O.value||D.value},M(O.value?"Current Default":D.value?"Setting...":"Set"),9,Bt)]),A.bindingType==="llm"?(d(),u("div",Ct,[e[30]||(e[30]=t("span",{class:"text-sm"},"Set as Global System Default",-1)),t("button",{onClick:me,class:"text-blue-600 hover:underline text-sm font-medium",disabled:K.value||I.value},M(K.value?"Current Global":I.value?"Setting...":"Set"),9,At)])):p("",!0)])])])):(d(),u("div",Ke,[t("div",We,[C(ke,{class:"w-12 h-12 mx-auto mb-2 opacity-50"}),e[14]||(e[14]=t("p",null,"Select a model to configure its alias and settings.",-1))])]))])]))]))}};export{It as default};
