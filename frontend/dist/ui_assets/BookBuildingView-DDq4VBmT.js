import{a4 as ne,Q as re,u as ie,R as de,T as ce,L as x,c as C,m as z,e as n,o,f as l,b as t,w as D,g as U,aD as ue,t as b,an as be,F as y,r as $,n as m,ad as E,aF as pe,a0 as T,ac as S,h as V,aa as W,d as h,Y as F,aL as ve,a2 as P,K as B,az as K,a as I,aE as fe,aK as L,aw as G,z as q,M as ge,as as xe,au as ke,at as ye,ap as me}from"./index-iFocv_fM.js";const he={class:"h-full flex overflow-hidden bg-gray-50 dark:bg-gray-900 relative"},we={key:0,class:"absolute inset-0 z-50 bg-white/95 dark:bg-gray-900/95 backdrop-blur-md flex flex-col p-10"},_e={class:"max-w-4xl mx-auto w-full flex flex-col h-full animate-in fade-in zoom-in-95 duration-500"},Ce={class:"flex items-center justify-between mb-8"},Te={class:"flex items-center gap-6"},Ae={class:"p-4 bg-blue-600 rounded-3xl shadow-xl shadow-blue-500/20"},$e={class:"text-2xl font-black text-gray-900 dark:text-white uppercase tracking-tighter"},Se={class:"text-sm font-bold text-blue-500 opacity-80 uppercase tracking-widest"},Ve={class:"text-4xl font-black text-blue-600 font-mono"},Be={class:"w-full bg-gray-200 dark:bg-gray-800 h-3 rounded-full overflow-hidden mb-10 shadow-inner"},Ie={class:"flex-grow flex flex-col min-h-0 bg-black rounded-3xl shadow-2xl border border-gray-800 overflow-hidden"},Ne={class:"text-gray-700 shrink-0 select-none"},je={key:0,class:"fixed inset-0 z-[100] bg-gray-900/60 backdrop-blur-sm p-6 flex items-center justify-center"},Re={class:"bg-white dark:bg-gray-900 rounded-2xl shadow-2xl w-full max-w-4xl h-full max-h-[80vh] flex flex-col overflow-hidden border dark:border-gray-800"},ze={class:"p-4 border-b dark:border-gray-800 flex justify-between items-center bg-gray-50 dark:bg-gray-800/50"},Ue={class:"flex-grow p-6 flex flex-col gap-4 overflow-hidden"},Me={class:"flex-grow flex flex-col"},Oe={class:"p-4 border-t dark:border-gray-800 flex justify-end gap-3"},De={class:"w-72 border-r dark:border-gray-700 bg-white dark:bg-gray-850 flex flex-col flex-shrink-0"},Ee={class:"p-4 border-b dark:border-gray-700 font-black text-[10px] uppercase tracking-widest text-gray-500 flex justify-between items-center"},We={class:"flex-grow overflow-y-auto p-2 space-y-4 custom-scrollbar"},Fe={class:"flex items-center gap-2 mb-1 text-blue-600"},Pe={class:"text-[10px] opacity-70 line-clamp-2"},Ke={class:"space-y-1"},Le=["onClick"],Ge={class:"flex items-center gap-2 truncate min-w-0"},qe={class:"truncate"},He=["onClick"],Je={class:"pt-4 space-y-1"},Qe={class:"px-2 py-1 text-[9px] font-black uppercase text-gray-400 tracking-wider flex justify-between items-center"},Ye=["onClick"],Xe={class:"truncate flex-grow"},Ze={class:"flex items-center opacity-0 group-hover:opacity-100 transition-opacity flex-shrink-0 bg-white/50 dark:bg-black/50 rounded px-1 backdrop-blur-sm"},et=["onClick"],tt=["onClick"],at=["onClick"],st={class:"flex-grow flex flex-col relative min-w-0"},ot={class:"p-3 border-b dark:border-gray-700 flex justify-between items-center bg-white dark:bg-gray-900 shadow-sm z-10"},lt={class:"flex items-center gap-2"},nt={class:"flex gap-1 bg-gray-100 dark:bg-gray-800 p-0.5 rounded border dark:border-gray-700"},rt={class:"flex-grow overflow-hidden relative"},it={key:0,class:"absolute inset-0 overflow-y-auto p-8 space-y-6 custom-scrollbar bg-gray-50/50 dark:bg-transparent"},dt={class:"max-w-4xl mx-auto space-y-4"},ct={class:"flex-grow pr-6"},ut={class:"text-[10px] font-black uppercase text-blue-500 mb-1"},bt={class:"font-bold text-lg text-gray-900 dark:text-white mb-2"},pt={class:"text-sm text-gray-600 dark:text-gray-400 leading-relaxed"},vt=["onClick","disabled"],ft={key:0,class:"absolute inset-0 overflow-y-auto p-10 custom-scrollbar bg-white dark:bg-gray-900"},gt={key:1,class:"flex-grow flex items-center justify-center text-gray-400 italic"},xt={class:"p-4 border-t dark:border-gray-700 bg-white dark:bg-gray-900 flex gap-3 shadow-inner"},kt={class:"relative flex-grow"},yt={class:"flex items-center gap-2 px-2 border-l dark:border-gray-700 absolute right-1 top-1/2 -translate-y-1/2 bg-white dark:bg-gray-800 pl-2 h-8"},mt=["disabled"],ht={__name:"BookBuildingView",props:{notebook:{type:Object,required:!0}},setup(N){const i=N,c=re(),j=ie(),H=de(),{tasks:J}=ce(H),u=x(null),w=x(!0),k=x(""),R=x(!1),A=x(null),g=x([]),d=x(null),v=C(()=>J.value.find(s=>(s.name.includes(i.notebook.title)||s.description.includes(i.notebook.id))&&(s.status==="running"||s.status==="pending"))),_=C(()=>{var s;return(s=i.notebook.tabs)==null?void 0:s.find(e=>e.type==="book_plan")}),Q=C(()=>{if(!_.value)return[];try{return JSON.parse(_.value.content)}catch{return[]}}),Y=C(()=>{var s;return((s=i.notebook.tabs)==null?void 0:s.filter(e=>e.type==="markdown"))||[]}),r=C(()=>{var s,e;return((s=i.notebook.tabs)==null?void 0:s.find(f=>f.id===u.value))||((e=i.notebook.tabs)==null?void 0:e[0])}),M=()=>{var s;if(((s=i.notebook.tabs)==null?void 0:s.length)>0&&(!u.value||!i.notebook.tabs.find(e=>e.id===u.value))){const e=i.notebook.tabs.find(f=>f.type==="book_plan");u.value=e?e.id:i.notebook.tabs[0].id}};z(()=>i.notebook.id,(s,e)=>{s!==e&&(u.value=null,M())},{immediate:!0}),z(()=>i.notebook.tabs,M,{deep:!0}),z(()=>{var s,e;return(e=(s=v.value)==null?void 0:s.logs)==null?void 0:e.length},()=>{me(()=>{A.value&&(A.value.scrollTop=A.value.scrollHeight)})});async function O(){var f;if(!k.value.trim())return;let s="write_book_chapter",e=null;if(R.value&&r.value)e=r.value.id,r.value.type==="book_plan"&&(s="generate_book_plan");else if(((f=r.value)==null?void 0:f.type)==="book_plan"){const{confirmed:a}=await j.showConfirmation({title:"Update Plan?",message:"This will regenerate the book outline. Continue?",confirmText:"Regenerate"});if(!a)return;s="generate_book_plan",e=r.value.id}await c.processWithAi(k.value,[],s,e,!1,g.value),k.value=""}async function X(s){const e=`Write Chapter: ${s.title}
Context: ${s.description}`;await c.processWithAi(e,[],"write_book_chapter",null,!1,g.value)}function Z(s){confirm("Delete this chapter?")&&(c.removeTab(s),u.value===s&&(u.value=null))}function ee(s){const e=g.value.indexOf(s);e===-1?g.value.push(s):g.value.splice(e,1)}function te(){j.openModal("artefactImportWizard",{notebookId:i.notebook.id})}function ae(s){j.openModal("artefactViewer",{artefact:{title:s.filename,content:s.content}})}function se(s){d.value={originalName:s.filename,name:s.filename,content:s.content}}async function oe(){if(d.value)try{await c.updateArtefact(d.value.originalName,d.value.name,d.value.content),d.value=null}catch(s){console.error(s)}}async function le(s){await c.deleteArtefact(s)}return(s,e)=>{var f;return o(),n("div",he,[l(E,{"enter-active-class":"transition ease-out duration-300","enter-from-class":"opacity-0","enter-to-class":"opacity-100","leave-active-class":"transition ease-in duration-200","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:D(()=>[v.value?(o(),n("div",we,[t("div",_e,[t("div",Ce,[t("div",Te,[t("div",Ae,[l(ue,{class:"w-10 h-10 animate-spin text-white"})]),t("div",null,[t("h2",$e,b(v.value.name),1),t("p",Se,b(v.value.description),1)])]),t("div",Ve,b(v.value.progress)+"%",1)]),t("div",Be,[t("div",{class:"h-full bg-blue-600 transition-all duration-500 progress-bar-animated",style:be({width:v.value.progress+"%"})},null,4)]),t("div",Ie,[e[14]||(e[14]=t("div",{class:"px-6 py-3 bg-gray-900 border-b border-gray-800 flex items-center justify-between"},[t("span",{class:"text-[10px] font-black uppercase text-gray-500 tracking-widest"},"Book Studio Terminal Output"),t("div",{class:"flex gap-1.5"},[t("div",{class:"w-2 h-2 rounded-full bg-red-500/50"}),t("div",{class:"w-2 h-2 rounded-full bg-yellow-500/50"}),t("div",{class:"w-2 h-2 rounded-full bg-green-500/50"})])],-1)),t("div",{ref_key:"logsContainerRef",ref:A,class:"flex-grow overflow-y-auto p-6 font-mono text-xs text-gray-400 space-y-1.5 custom-scrollbar"},[(o(!0),n(y,null,$(v.value.logs,(a,p)=>(o(),n("div",{key:p,class:"flex gap-4"},[t("span",Ne,"["+b(new Date(a.timestamp).toLocaleTimeString())+"]",1),t("span",{class:m({"text-red-400 font-bold":a.level==="ERROR","text-blue-400":a.level==="INFO","text-yellow-400":a.level==="WARNING"})},b(a.message),3)]))),128))],512)])])])):U("",!0)]),_:1}),l(E,{"enter-active-class":"transition ease-out duration-200","enter-from-class":"opacity-0 translate-y-4","enter-to-class":"opacity-100 translate-y-0","leave-active-class":"transition ease-in duration-150","leave-from-class":"opacity-100 translate-y-0","leave-to-class":"opacity-0 translate-y-4"},{default:D(()=>[d.value?(o(),n("div",je,[t("div",Re,[t("div",ze,[e[15]||(e[15]=t("h3",{class:"font-black text-sm uppercase tracking-widest"},"Edit Source",-1)),t("button",{onClick:e[0]||(e[0]=a=>d.value=null),class:"btn-icon-flat"},[l(pe,{class:"w-5 h-5"})])]),t("div",Ue,[t("div",null,[e[16]||(e[16]=t("label",{class:"text-[10px] font-bold uppercase text-gray-500 mb-1 block"},"Title",-1)),T(t("input",{"onUpdate:modelValue":e[1]||(e[1]=a=>d.value.name=a),class:"input-field w-full font-bold"},null,512),[[S,d.value.name]])]),t("div",Me,[e[17]||(e[17]=t("label",{class:"text-[10px] font-bold uppercase text-gray-500 mb-1 block"},"Content",-1)),T(t("textarea",{"onUpdate:modelValue":e[2]||(e[2]=a=>d.value.content=a),class:"flex-grow input-field w-full font-mono text-xs resize-none"},null,512),[[S,d.value.content]])])]),t("div",Oe,[t("button",{onClick:e[3]||(e[3]=a=>d.value=null),class:"btn btn-secondary"},"Cancel"),t("button",{onClick:oe,class:"btn btn-primary"},[l(W,{class:"w-4 h-4 mr-2"}),e[18]||(e[18]=V(" Save"))])])])])):U("",!0)]),_:1}),t("div",De,[t("div",Ee,[e[19]||(e[19]=t("span",null,"Book Navigator",-1)),t("button",{onClick:e[4]||(e[4]=a=>h(c).addTab("markdown")),class:"text-blue-500 hover:text-blue-600",title:"Add Chapter"},[l(F,{class:"w-4 h-4"})])]),t("div",We,[_.value?(o(),n("div",{key:0,onClick:e[5]||(e[5]=a=>u.value=_.value.id),class:m(["p-3 rounded-lg border-2 cursor-pointer transition-all shadow-sm",u.value===_.value.id?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-transparent bg-gray-50 dark:bg-gray-800 hover:border-gray-300"])},[t("div",Fe,[l(ve,{class:"w-4 h-4"}),e[20]||(e[20]=V()),e[21]||(e[21]=t("span",{class:"font-bold text-xs uppercase"},"Outline",-1))]),t("p",Pe,b(N.notebook.title)+" Plan",1)],2)):U("",!0),t("div",Ke,[(o(!0),n(y,null,$(Y.value,a=>(o(),n("div",{key:a.id,onClick:p=>u.value=a.id,class:m(["group flex items-center justify-between p-2 rounded cursor-pointer text-sm font-medium transition-colors",u.value===a.id?"bg-blue-100 dark:bg-blue-900/40 text-blue-700 dark:text-blue-300":"text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-800"])},[t("div",Ge,[l(P,{class:"w-4 h-4 flex-shrink-0 opacity-70"}),t("span",qe,b(a.title),1)]),t("button",{onClick:B(p=>Z(a.id),["stop"]),class:"opacity-0 group-hover:opacity-100 hover:text-red-500 transition-opacity p-1"},[l(K,{class:"w-3.5 h-3.5"})],8,He)],10,Le))),128))]),t("div",Je,[t("div",Qe,[e[22]||(e[22]=t("span",null,"Artefacts",-1)),t("button",{onClick:te,class:"text-green-500 hover:text-green-600"},[l(F,{class:"w-3 h-3"})])]),(o(!0),n(y,null,$(N.notebook.artefacts,a=>(o(),n("div",{key:a.filename,onClick:p=>ee(a.filename),class:m(["flex items-center gap-2 p-2 rounded text-[10px] cursor-pointer group",g.value.includes(a.filename)?"bg-green-50 dark:bg-green-900/20 text-green-700 dark:text-green-300 font-bold":"text-gray-500 hover:bg-gray-50 dark:hover:bg-gray-800"])},[g.value.includes(a.filename)?(o(),I(fe,{key:0,class:"w-3 h-3 flex-shrink-0 text-green-500"})):(o(),I(P,{key:1,class:"w-3 h-3 flex-shrink-0 opacity-50"})),t("span",Xe,b(a.filename),1),t("div",Ze,[t("button",{onClick:B(p=>ae(a),["stop"]),class:"p-1 hover:text-blue-500",title:"View"},[l(L,{class:"w-3 h-3"})],8,et),t("button",{onClick:B(p=>se(a),["stop"]),class:"p-1 hover:text-orange-500",title:"Edit"},[l(G,{class:"w-3 h-3"})],8,tt),t("button",{onClick:B(p=>le(a.filename),["stop"]),class:"p-1 hover:text-red-500",title:"Delete"},[l(K,{class:"w-3 h-3"})],8,at)])],10,Ye))),128))])])]),t("div",st,[r.value?(o(),n(y,{key:0},[t("div",ot,[T(t("input",{"onUpdate:modelValue":e[6]||(e[6]=a=>r.value.title=a),onBlur:e[7]||(e[7]=(...a)=>h(c).saveActive&&h(c).saveActive(...a)),class:"font-bold text-lg bg-transparent border-none focus:ring-0 text-gray-800 dark:text-gray-100 p-0"},null,544),[[S,r.value.title]]),t("div",lt,[t("button",{onClick:e[8]||(e[8]=(...a)=>h(c).saveActive&&h(c).saveActive(...a)),class:"p-1.5 rounded hover:bg-gray-100 dark:hover:bg-gray-800 text-gray-500",title:"Save"},[l(W,{class:"w-4 h-4"})]),t("div",nt,[t("button",{onClick:e[9]||(e[9]=a=>w.value=!0),class:m(["p-1 rounded",w.value?"bg-white shadow text-blue-600":"text-gray-400"])},[l(L,{class:"w-4 h-4"})],2),t("button",{onClick:e[10]||(e[10]=a=>w.value=!1),class:m(["p-1 rounded",w.value?"text-gray-400":"bg-white shadow text-blue-600"])},[l(G,{class:"w-4 h-4"})],2)])])]),t("div",rt,[r.value.type==="book_plan"?(o(),n("div",it,[t("div",dt,[(o(!0),n(y,null,$(Q.value,(a,p)=>(o(),n("div",{key:p,class:"p-6 bg-white dark:bg-gray-800 rounded-xl border-l-4 border-blue-500 shadow-md flex justify-between items-start transition-transform hover:scale-[1.01]"},[t("div",ct,[t("div",ut,"Chapter "+b(p+1),1),t("div",bt,b(a.title),1),t("p",pt,b(a.description),1)]),t("button",{onClick:wt=>X(a),class:"btn btn-primary btn-sm flex-shrink-0 shadow-lg",disabled:v.value},[l(q,{class:"w-4 h-4 mr-2"}),e[23]||(e[23]=V(" Write "))],8,vt)]))),128))])])):(o(),n(y,{key:1},[w.value?(o(),n("div",ft,[(o(),I(ge,{content:r.value.content,key:r.value.id+((f=r.value.content)==null?void 0:f.length),class:"prose prose-lg dark:prose-invert max-w-4xl mx-auto"},null,8,["content"]))])):(o(),I(xe,{key:1,modelValue:r.value.content,"onUpdate:modelValue":e[11]||(e[11]=a=>r.value.content=a),onBlur:h(c).saveActive,class:"h-full"},null,8,["modelValue","onBlur"]))],64))])],64)):(o(),n("div",gt,"Select a plan or chapter from the sidebar.")),t("div",xt,[t("div",kt,[T(t("input",{"onUpdate:modelValue":e[12]||(e[12]=a=>k.value=a),onKeyup:ke(O,["enter"]),placeholder:"Describe the book's core topic or instructions...",class:"input-field w-full pr-32"},null,544),[[S,k.value]]),t("div",yt,[T(t("input",{type:"checkbox",id:"mod-tab","onUpdate:modelValue":e[13]||(e[13]=a=>R.value=a),class:"h-3 w-3 rounded text-blue-600 focus:ring-blue-500 cursor-pointer"},null,512),[[ye,R.value]]),e[24]||(e[24]=t("label",{for:"mod-tab",class:"text-[9px] font-black uppercase text-gray-400 cursor-pointer select-none whitespace-nowrap"},"Update Active",-1))])]),t("button",{onClick:O,class:"btn btn-primary px-8 flex-shrink-0",disabled:!k.value.trim()||v.value},[l(q,{class:"w-4 h-4 mr-2"}),e[25]||(e[25]=V(" Go "))],8,mt)])])])}}},Ct=ne(ht,[["__scopeId","data-v-50302a9f"]]);export{Ct as default};
