import{_ as Y,u as Z,r as d,b as N,d as tt,au as u,c as i,o,a as t,h as c,g as r,G as S,ae as F,n as $,M as B,F as D,j as T,J as b,K as y,t as g,aM as G,E as et,X as E,aN as st,i as at,H as ot,m as nt,L as it,f as L,V as rt}from"./index-D2Id9a0s.js";import{I as lt}from"./IconArrowRight-CG1jt1i7.js";const dt={class:"bg-white dark:bg-gray-800 shadow rounded-lg h-full flex flex-col relative overflow-hidden"},ct={class:"p-6 border-b dark:border-gray-700 flex justify-between items-center bg-white dark:bg-gray-800 z-10"},ut={class:"flex space-x-6 px-6 border-b dark:border-gray-700 bg-gray-50/50 dark:bg-gray-900/30"},pt={class:"flex-grow overflow-y-auto p-6"},gt={key:0,class:"space-y-6"},vt={key:0,class:"text-center py-20"},bt={key:1,class:"text-center text-gray-500 py-20 border-2 border-dashed rounded-xl"},yt={key:0,class:"p-4 space-y-4"},ft={class:"flex gap-2 justify-end"},xt=["onClick"],mt={key:1,class:"p-5"},kt={class:"flex justify-between items-start mb-4"},ht={class:"flex-grow"},wt={class:"flex items-center gap-2 mb-2"},_t={class:"font-bold text-lg text-gray-900 dark:text-white"},Ct={key:0,class:"flex items-center gap-2 text-xs text-gray-500 bg-gray-100 dark:bg-gray-800 w-fit px-2 py-1 rounded"},St={class:"flex gap-1"},$t=["onClick"],jt=["onClick"],At={class:"text-sm text-gray-600 dark:text-gray-300 whitespace-pre-wrap mb-6 line-clamp-3 bg-gray-50 dark:bg-gray-800/80 p-4 rounded-xl border dark:border-gray-700 italic"},It={class:"flex gap-3"},Nt=["onClick"],Dt=["onClick"],Tt={key:1,class:"space-y-4"},Et={key:0,class:"text-center text-gray-500 py-10"},Vt={class:"overflow-hidden border dark:border-gray-700 rounded-xl"},zt={class:"min-w-full divide-y divide-gray-200 dark:divide-gray-700"},Ut={class:"divide-y divide-gray-100 dark:divide-gray-800 bg-white dark:bg-gray-900/20"},Pt={class:"py-4 px-4"},Rt={class:"font-bold text-gray-900 dark:text-white"},Wt={class:"py-4 px-4 text-sm text-gray-500"},Mt={class:"py-4 px-4"},Ft={class:"px-2 py-1 bg-blue-50 text-blue-700 dark:bg-blue-900/30 dark:text-blue-300 rounded-lg text-[10px] font-black border dark:border-blue-800"},Bt={class:"py-4 px-4 text-right space-x-2"},Gt=["onClick"],Lt=["onClick"],Ht={key:2,class:"max-w-2xl mx-auto space-y-6"},Kt={class:"flex gap-2"},Jt={class:"border dark:border-gray-700 rounded-2xl overflow-hidden bg-white dark:bg-gray-900/40"},Ot={class:"divide-y divide-gray-200 dark:divide-gray-700"},Qt={class:"flex items-center gap-3"},Xt={class:"p-2 bg-green-50 dark:bg-green-900/30 rounded-full"},qt={class:"font-bold text-gray-900 dark:text-white"},Yt={class:"text-[10px] text-gray-500 uppercase tracking-tighter"},Zt=["onClick"],te={key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-gray-950/60 backdrop-blur-sm"},ee={class:"bg-white dark:bg-gray-800 w-full max-w-2xl rounded-3xl shadow-2xl overflow-hidden animate-fade-in-up"},se={class:"p-6 border-b dark:border-gray-700 flex justify-between items-center bg-blue-600 text-white"},ae={class:"flex items-center gap-3"},oe={class:"p-8"},ne={key:0,class:"space-y-6"},ie={class:"space-y-2"},re={class:"grid grid-cols-2 gap-4"},le={class:"space-y-2"},de={class:"space-y-2"},ce={class:"pt-4 flex justify-end"},ue=["disabled"],pe={key:1},ge={key:1,class:"space-y-6"},ve={class:"space-y-2"},be={class:"space-y-2"},ye={class:"flex justify-between items-center pt-4"},fe={class:"flex gap-2"},xe={__name:"EmailMarketing",setup(me){const v=Z(),w=d([]),j=d([]),m=d(""),p=d("drafts"),A=d(!1),_=d(!1),k=d(1),h=d(!1),n=d({topic:"",tone:"professional",instructions:"",subject:"",content:""}),V=N(()=>Array.isArray(w.value)?w.value:[]),z=N(()=>V.value.filter(a=>a.status==="draft"||a.status==="pending_review"||a.status==="rejected")),U=N(()=>V.value.filter(a=>a.status==="sent"||a.status==="approved"));tt(()=>{f(),I()});async function f(){A.value=!0;try{const a=await u.get("/api/admin/email-marketing/proposals");w.value=Array.isArray(a.data)?a.data:[]}catch(a){console.error("Failed to fetch proposals:",a),w.value=[]}finally{A.value=!1}}async function I(){try{const a=await u.get("/api/admin/email-marketing/topics");j.value=Array.isArray(a.data)?a.data:[]}catch{j.value=[]}}function H(){n.value={topic:"",tone:"professional",instructions:"",subject:"",content:""},k.value=1,_.value=!0}async function P(){if(n.value.topic){h.value=!0;try{const a=await u.post("/api/admin/email-marketing/generate-proposal",{topic:n.value.topic,tone:n.value.tone,additional_instructions:n.value.instructions});n.value.subject=a.data.subject,n.value.content=a.data.body,k.value=2}catch{v.addNotification("AI Generation failed","error")}finally{h.value=!1}}}async function K(){try{await u.post("/api/admin/email-marketing/proposals",{title:n.value.subject,content:n.value.content,source_topic:n.value.topic}),v.addNotification("Campaign draft created!","success"),_.value=!1,f()}catch{v.addNotification("Failed to save draft","error")}}async function R(){m.value.trim()&&(await u.post("/api/admin/email-marketing/topics",{topic:m.value}),m.value="",I())}async function J(a){await u.delete(`/api/admin/email-marketing/topics/${a}`),I()}async function W(a,e){if(!(e==="approved"&&!confirm("This will send the email to all eligible users. Continue?")))try{await u.put(`/api/admin/email-marketing/proposals/${a}`,{status:e}),v.addNotification(e==="approved"?"Campaign started!":"Draft updated","success"),f()}catch{v.addNotification("Action failed","error")}}async function O(a){if(confirm("This will email users who joined after the initial campaign. Continue?"))try{await u.post(`/api/admin/email-marketing/proposals/${a}/resend`),v.addNotification("Resend task started","success"),f()}catch{v.addNotification("Action failed","error")}}async function M(a){confirm("Delete this campaign/draft permanently?")&&(await u.delete(`/api/admin/email-marketing/proposals/${a}`),f())}const C=d(null),x=d({title:"",content:""});function Q(a){C.value=a.id,x.value={title:a.title,content:a.content}}async function X(a){await u.put(`/api/admin/email-marketing/proposals/${a}`,x.value),C.value=null,f(),v.addNotification("Draft saved","success")}function q(a){switch(a){case"sent":return"bg-green-100 text-green-800 dark:bg-green-900/40 dark:text-green-300";case"pending_review":return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/40 dark:text-yellow-300";case"rejected":return"bg-red-100 text-red-800 dark:bg-red-900/40 dark:text-red-300";default:return"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300"}}return(a,e)=>(o(),i("div",dt,[t("div",ct,[e[15]||(e[15]=t("div",null,[t("h2",{class:"text-xl font-bold"},"Email Campaigns"),t("p",{class:"text-sm text-gray-500"},"Engage your users with AI-generated newsletters.")],-1)),t("button",{onClick:H,class:"btn btn-primary flex items-center gap-2 shadow-lg hover:scale-105 transition-transform"},[r(F,{class:"w-4 h-4"}),e[14]||(e[14]=S(" AI Campaign Wizard "))])]),t("div",ut,[t("button",{onClick:e[0]||(e[0]=s=>p.value="drafts"),class:$(["py-3 px-1 text-sm font-medium border-b-2 transition-all",p.value==="drafts"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700"])},"Drafts & Proposals",2),t("button",{onClick:e[1]||(e[1]=s=>p.value="sent"),class:$(["py-3 px-1 text-sm font-medium border-b-2 transition-all",p.value==="sent"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700"])},"Sent History",2),t("button",{onClick:e[2]||(e[2]=s=>p.value="topics"),class:$(["py-3 px-1 text-sm font-medium border-b-2 transition-all",p.value==="topics"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700"])},"AI Research Topics",2)]),t("div",pt,[p.value==="drafts"?(o(),i("div",gt,[A.value?(o(),i("div",vt,[r(B,{class:"w-10 h-10 animate-spin mx-auto text-blue-500"})])):z.value.length===0?(o(),i("div",bt," No active drafts. Start with the Wizard above! ")):c("",!0),(o(!0),i(D,null,T(z.value,s=>(o(),i("div",{key:s.id,class:"border dark:border-gray-700 rounded-xl overflow-hidden shadow-sm bg-white dark:bg-gray-900/50"},[C.value===s.id?(o(),i("div",yt,[b(t("input",{"onUpdate:modelValue":e[3]||(e[3]=l=>x.value.title=l),class:"input-field w-full font-bold"},null,512),[[y,x.value.title]]),b(t("textarea",{"onUpdate:modelValue":e[4]||(e[4]=l=>x.value.content=l),class:"input-field w-full h-64 font-mono text-sm"},null,512),[[y,x.value.content]]),t("div",ft,[t("button",{onClick:e[5]||(e[5]=l=>C.value=null),class:"btn btn-secondary"},"Cancel"),t("button",{onClick:l=>X(s.id),class:"btn btn-primary"},"Save Draft",8,xt)])])):(o(),i("div",mt,[t("div",kt,[t("div",ht,[t("div",wt,[t("span",{class:$(["px-2 py-0.5 text-[9px] font-black uppercase rounded tracking-wider",q(s.status)])},g(s.status.replace("_"," ")),3),t("h3",_t,g(s.title),1)]),s.source_topic?(o(),i("div",Ct,[r(G,{class:"w-3 h-3"}),t("span",null,"Source: "+g(s.source_topic),1)])):c("",!0)]),t("div",St,[t("button",{onClick:l=>Q(s),class:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg text-gray-500 transition-colors",title:"Edit Content"},[r(et,{class:"w-4 h-4"})],8,$t),t("button",{onClick:l=>M(s.id),class:"p-2 hover:bg-red-50 text-red-500 rounded-lg transition-colors",title:"Delete"},[r(E,{class:"w-4 h-4"})],8,jt)])]),t("div",At,g(s.content),1),t("div",It,[t("button",{onClick:l=>W(s.id,"approved"),class:"btn btn-primary btn-sm flex items-center gap-2 font-bold px-4"},[r(st,{class:"w-4 h-4"}),e[16]||(e[16]=S(" Start Campaign "))],8,Nt),s.status==="draft"?(o(),i("button",{key:0,onClick:l=>W(s.id,"pending_review"),class:"btn btn-secondary btn-sm"},"Queue for Review",8,Dt)):c("",!0)])]))]))),128))])):c("",!0),p.value==="sent"?(o(),i("div",Tt,[U.value.length===0?(o(),i("div",Et,"No campaigns sent yet.")):c("",!0),t("div",Vt,[t("table",zt,[e[17]||(e[17]=t("thead",{class:"bg-gray-50 dark:bg-gray-900/50"},[t("tr",{class:"text-left text-[10px] font-black uppercase tracking-widest text-gray-500"},[t("th",{class:"py-3 px-4"},"Subject"),t("th",{class:"py-3 px-4"},"Sent At"),t("th",{class:"py-3 px-4"},"Coverage"),t("th",{class:"py-3 px-4 text-right"},"Actions")])],-1)),t("tbody",Ut,[(o(!0),i(D,null,T(U.value,s=>(o(),i("tr",{key:s.id,class:"hover:bg-gray-50 dark:hover:bg-gray-700/30 group transition-colors"},[t("td",Pt,[t("div",Rt,g(s.title),1)]),t("td",Wt,g(s.sent_at?new Date(s.sent_at).toLocaleDateString():"Active..."),1),t("td",Mt,[t("span",Ft,g(s.recipients_count||0)+" RECIPIENTS ",1)]),t("td",Bt,[t("button",{onClick:l=>O(s.id),class:"btn btn-secondary btn-xs",title:"Send only to new users"}," Resend to New ",8,Gt),t("button",{onClick:l=>M(s.id),class:"text-red-500 opacity-0 group-hover:opacity-100 p-1 hover:bg-red-50 rounded transition-all"},[r(E,{class:"w-4 h-4"})],8,Lt)])]))),128))])])])])):c("",!0),p.value==="topics"?(o(),i("div",Ht,[t("div",Kt,[b(t("input",{"onUpdate:modelValue":e[6]||(e[6]=s=>m.value=s),placeholder:"Suggest a research topic for the AI...",class:"input-field flex-grow",onKeyup:at(R,["enter"])},null,544),[[y,m.value]]),t("button",{onClick:R,class:"btn btn-primary px-6"},"Add Topic")]),t("div",Jt,[t("ul",Ot,[(o(!0),i(D,null,T(j.value,s=>(o(),i("li",{key:s.id,class:"p-4 flex justify-between items-center hover:bg-gray-50 dark:hover:bg-gray-800/50 transition-colors"},[t("div",Qt,[t("div",Xt,[r(ot,{class:"w-4 h-4 text-green-500"})]),t("div",null,[t("span",qt,g(s.topic),1),t("p",Yt,"Added via "+g(s.source),1)])]),t("button",{onClick:l=>J(s.id),class:"text-red-500 hover:bg-red-50 p-2 rounded-full transition-all"},[r(E,{class:"w-4 h-4"})],8,Zt)]))),128))])])])):c("",!0)]),_.value?(o(),i("div",te,[t("div",ee,[t("div",se,[t("div",ae,[r(F,{class:"w-6 h-6 animate-pulse"}),e[18]||(e[18]=t("h3",{class:"text-xl font-black uppercase tracking-tighter"},"AI Campaign Wizard",-1))]),t("button",{onClick:e[7]||(e[7]=s=>_.value=!1),class:"p-1 hover:bg-white/20 rounded-full"},[r(nt,{class:"w-6 h-6"})])]),t("div",oe,[k.value===1?(o(),i("div",ne,[t("div",ie,[e[19]||(e[19]=t("label",{class:"text-xs font-black uppercase text-gray-500 tracking-widest"},"What is this email about?",-1)),b(t("textarea",{"onUpdate:modelValue":e[8]||(e[8]=s=>n.value.topic=s),rows:"3",class:"input-field w-full",placeholder:"e.g. New features in v2.1, maintenance notice for Sunday, or tips for better prompts..."},null,512),[[y,n.value.topic]])]),t("div",re,[t("div",le,[e[21]||(e[21]=t("label",{class:"text-xs font-black uppercase text-gray-500 tracking-widest"},"Tone",-1)),b(t("select",{"onUpdate:modelValue":e[9]||(e[9]=s=>n.value.tone=s),class:"input-field w-full"},e[20]||(e[20]=[t("option",{value:"professional"},"Professional & Direct",-1),t("option",{value:"friendly"},"Friendly & Casual",-1),t("option",{value:"exciting"},"Exciting & Hype",-1),t("option",{value:"urgent"},"Urgent & Serious",-1)]),512),[[it,n.value.tone]])]),t("div",de,[e[22]||(e[22]=t("label",{class:"text-xs font-black uppercase text-gray-500 tracking-widest"},"Custom Instructions",-1)),b(t("input",{"onUpdate:modelValue":e[10]||(e[10]=s=>n.value.instructions=s),type:"text",class:"input-field w-full",placeholder:"e.g. Include a link to our discord"},null,512),[[y,n.value.instructions]])])]),t("div",ce,[t("button",{onClick:P,disabled:!n.value.topic||h.value,class:"btn btn-primary px-8 py-3 rounded-2xl flex items-center gap-3"},[h.value?(o(),L(B,{key:0,class:"w-5 h-5 animate-spin"})):(o(),i("span",pe,"Generate Draft")),h.value?c("",!0):(o(),L(lt,{key:2,class:"w-4 h-4"}))],8,ue)])])):c("",!0),k.value===2?(o(),i("div",ge,[t("div",ve,[e[23]||(e[23]=t("label",{class:"text-xs font-black uppercase text-gray-500 tracking-widest"},"Subject Line",-1)),b(t("input",{"onUpdate:modelValue":e[11]||(e[11]=s=>n.value.subject=s),class:"input-field w-full font-bold"},null,512),[[y,n.value.subject]])]),t("div",be,[e[24]||(e[24]=t("label",{class:"text-xs font-black uppercase text-gray-500 tracking-widest"},"Email Content",-1)),b(t("textarea",{"onUpdate:modelValue":e[12]||(e[12]=s=>n.value.content=s),rows:"10",class:"input-field w-full font-mono text-sm"},null,512),[[y,n.value.content]])]),t("div",ye,[t("button",{onClick:e[13]||(e[13]=s=>k.value=1),class:"btn btn-secondary"},"Back"),t("div",fe,[t("button",{onClick:P,class:"btn btn-secondary flex items-center gap-2"},[r(G,{class:"w-4 h-4"}),e[25]||(e[25]=S(" Re-Generate "))]),t("button",{onClick:K,class:"btn btn-primary px-8 flex items-center gap-2"},[r(rt,{class:"w-4 h-4"}),e[26]||(e[26]=S(" Save as Draft "))])])])])):c("",!0)])])])):c("",!0)]))}},we=Y(xe,[["__scopeId","data-v-30b4df2d"]]);export{we as default};
