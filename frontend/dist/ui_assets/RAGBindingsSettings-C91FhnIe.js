import{u as K,T as H,L as y,c as B,m as I,l as Q,e as i,o as l,g as m,b as e,t as c,a0 as A,h as b,ac as W,ar as G,F as x,r as S,d as h,cw as X,a3 as Y,a as T,aJ as Z,aK as ee,n as C,aD as te,K as N,f as ae,B as se}from"./index-CLx4cEXd.js";import{u as ne}from"./admin-Dq5PjGKC.js";const le={class:"space-y-8"},ie={key:0,class:"bg-white dark:bg-gray-800 shadow-md rounded-lg p-6"},oe={class:"text-xl font-semibold mb-4"},de={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},re=["disabled"],ue=["value"],ce={key:0,class:"space-y-6 border-t dark:border-gray-700 pt-6"},me=["innerHTML"],ve=["for"],fe={key:0,class:"text-red-500"},ge={class:"relative"},pe=["type","id","onUpdate:modelValue","required","placeholder"],_e=["onClick"],ye={class:"text-xs text-gray-500 mt-1"},be={class:"flex items-center justify-between bg-gray-50 dark:bg-gray-700/50 p-3 rounded-md"},xe={class:"flex justify-end gap-3"},he=["disabled"],ke={class:"flex justify-between items-center mb-4 flex-wrap gap-4"},we={class:"flex items-center gap-4"},Be={key:0},Ae={key:1,class:"text-center p-6 bg-gray-50 dark:bg-gray-800/50 rounded-lg"},Se={key:2,class:"space-y-4"},Ce={class:"flex-grow"},Me={class:"flex justify-between items-center"},Te={class:"flex items-center gap-3"},Re={class:"font-bold text-lg"},De=["onClick","title"],Ve={class:"flex gap-3"},Fe=["onClick"],$e=["onClick"],Ge={class:"text-sm text-gray-500"},Ne={class:"mt-2 text-xs space-y-1 text-gray-600 dark:text-gray-300"},Ee={key:0},Le={class:"font-semibold capitalize"},Oe={key:0},je={key:1},Ue={class:"border-t dark:border-gray-700 pt-3 flex justify-end"},qe=["onClick"],He={__name:"RAGBindingsSettings",setup(ze){const u=ne(),M=K(),{ragBindings:R,availableRagBindingTypes:k,isLoadingRagBindings:E,globalSettings:D}=H(u),v=y(!1),g=y(null),p=y(!1),f=y({}),V=()=>({id:null,alias:"",name:"",config:{},default_model_name:null,is_active:!0}),n=y(V()),w=B(()=>g.value!==null),_=B(()=>n.value.name?k.value.find(s=>s.name===n.value.name):null),L=B(()=>{if(!_.value)return[];const s=_.value.input_parameters||[],a=new Set(s.map(o=>o.name)),t=_.value.model_parameters||[],d=new Set(t.map(o=>o.name)),r=Object.keys(n.value.config||{}).filter(o=>!a.has(o)&&!d.has(o)&&o!=="model_name"&&o!=="model"&&o!=="class").map(o=>({name:o,type:typeof n.value.config[o]=="boolean"?"bool":typeof n.value.config[o]=="number"?"float":"str",description:"(Parameter not in binding description)",mandatory:!1}));return[...s.filter(o=>!d.has(o.name)&&o.name!=="model_name"),...r]}),F=B({get(){if(!Array.isArray(D.value))return"mixed";const s=D.value.find(a=>a.key==="rag_model_display_mode");return s?s.value:"mixed"},set(s){u.updateGlobalSettings({rag_model_display_mode:s})}});I(()=>n.value.name,(s,a)=>{if(s!==a){const t=k.value.find(r=>r.name===s),d={};t&&t.input_parameters&&t.input_parameters.forEach(r=>{d[r.name]=r.default!==void 0?r.default:""}),n.value.config=d}}),Q(()=>{u.fetchRagBindings(),u.fetchAvailableRagBindingTypes(),u.fetchGlobalSettings()});function O(){g.value=null,n.value=V(),f.value={},v.value=!0,window.scrollTo({top:0,behavior:"smooth"})}function j(s){g.value=s,n.value=JSON.parse(JSON.stringify(s)),n.value.config||(n.value.config={}),f.value={},v.value=!0,window.scrollTo({top:0,behavior:"smooth"})}function $(){v.value=!1,g.value=null}async function U(){if(!n.value.alias.trim()||!n.value.name){M.addNotification("Alias and Vectorizer Type are required.","warning");return}p.value=!0;try{const s={alias:n.value.alias,name:n.value.name,config:n.value.config||{},is_active:n.value.is_active,default_model_name:n.value.default_model_name||null};w.value?await u.updateRagBinding(g.value.id,s):await u.addRagBinding(s),$()}finally{p.value=!1}}async function q(s){await M.showConfirmation({title:`Delete RAG Binding '${s.alias}'?`,confirmText:"Delete"})&&await u.deleteRagBinding(s.id)}async function z(s){await u.updateRagBinding(s.id,{is_active:!s.is_active})}function P(s){const a=k.value.find(t=>t.name===s);return a?a.title:s}function J(s){M.openModal("manageModels",{binding:s,bindingType:"rag"})}return(s,a)=>(l(),i("div",le,[v.value?(l(),i("div",ie,[e("h3",oe,c(w.value?"Edit RAG Binding":"Add New RAG Binding"),1),e("form",{onSubmit:N(U,["prevent"]),class:"space-y-6"},[e("div",de,[e("div",null,[a[4]||(a[4]=e("label",{for:"alias",class:"block text-sm font-medium"},[b("Alias "),e("span",{class:"text-red-500"},"*")],-1)),A(e("input",{type:"text",id:"alias","onUpdate:modelValue":a[0]||(a[0]=t=>n.value.alias=t),class:"input-field mt-1",required:"",placeholder:"e.g., local_embeddings"},null,512),[[W,n.value.alias]])]),e("div",null,[a[6]||(a[6]=e("label",{for:"name",class:"block text-sm font-medium"},[b("Vectorizer Type "),e("span",{class:"text-red-500"},"*")],-1)),A(e("select",{id:"name","onUpdate:modelValue":a[1]||(a[1]=t=>n.value.name=t),class:"input-field mt-1",required:"",disabled:w.value},[a[5]||(a[5]=e("option",{disabled:"",value:""},"Select a type",-1)),(l(!0),i(x,null,S(h(k),t=>(l(),i("option",{key:t.name,value:t.name},c(t.title),9,ue))),128))],8,re),[[G,n.value.name]])])]),_.value?(l(),i("div",ce,[e("div",{class:"text-sm text-gray-600 dark:text-gray-400 prose dark:prose-invert max-w-none",innerHTML:h(X)(_.value.description||"")},null,8,me),(l(!0),i(x,null,S(L.value,t=>(l(),i("div",{key:t.name,class:"space-y-1"},[e("label",{for:`param-${t.name}`,class:"block text-sm font-medium capitalize"},[b(c(t.name.replace(/_/g," "))+" ",1),t.mandatory?(l(),i("span",fe,"*")):m("",!0)],8,ve),e("div",ge,[A(e("input",{type:(t.name.includes("key")||t.name.includes("token"))&&!f.value[t.name]?"password":"text",id:`param-${t.name}`,"onUpdate:modelValue":d=>n.value.config[t.name]=d,class:"input-field",required:t.mandatory,placeholder:t.default},null,8,pe),[[Y,n.value.config[t.name]]]),t.name.includes("key")||t.name.includes("token")?(l(),i("button",{key:0,type:"button",onClick:d=>f.value[t.name]=!f.value[t.name],class:"absolute inset-y-0 right-0 px-3 flex items-center text-gray-500"},[f.value[t.name]?(l(),T(Z,{key:0,class:"w-5 h-5"})):(l(),T(ee,{key:1,class:"w-5 h-5"}))],8,_e)):m("",!0)]),e("p",ye,c(t.description),1)]))),128))])):m("",!0),e("div",be,[a[7]||(a[7]=e("span",{class:"flex-grow flex flex-col"},[e("span",{class:"text-sm font-medium"},"Active"),e("span",{class:"text-sm text-gray-500"},"Enable this binding for use in Data Stores.")],-1)),e("button",{onClick:a[2]||(a[2]=t=>n.value.is_active=!n.value.is_active),type:"button",class:C([n.value.is_active?"bg-blue-600":"bg-gray-200 dark:bg-gray-600","relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out"])},[e("span",{class:C([n.value.is_active?"translate-x-5":"translate-x-0","pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition-colors duration-200 ease-in-out"])},null,2)],2)]),e("div",xe,[e("button",{type:"button",onClick:$,class:"btn btn-secondary"},"Cancel"),e("button",{type:"submit",class:"btn btn-primary",disabled:p.value},[p.value?(l(),T(te,{key:0,class:"w-5 h-5 mr-2"})):m("",!0),b(" "+c(p.value?"Saving...":w.value?"Save Changes":"Create Binding"),1)],8,he)])],32)])):m("",!0),e("div",null,[e("div",ke,[a[10]||(a[10]=e("h2",{class:"text-2xl font-bold"},"RAG Bindings",-1)),e("div",we,[e("div",null,[a[9]||(a[9]=e("label",{for:"rag-model-display-mode",class:"block text-xs font-medium text-gray-500 dark:text-gray-400"},"Model Display Mode",-1)),A(e("select",{id:"rag-model-display-mode","onUpdate:modelValue":a[3]||(a[3]=t=>F.value=t),class:"input-field mt-1"},a[8]||(a[8]=[e("option",{value:"mixed"},"Mixed (Alias or Original)",-1),e("option",{value:"aliased"},"Aliased Only",-1),e("option",{value:"original"},"Original Names Only",-1)]),512),[[G,F.value]])]),v.value?m("",!0):(l(),i("button",{key:0,onClick:O,class:"btn btn-primary self-end"},"+ Add RAG Binding"))])]),h(E)?(l(),i("div",Be,"Loading...")):h(R).length===0&&!v.value?(l(),i("div",Ae,a[11]||(a[11]=[e("p",null,"No RAG bindings configured.",-1)]))):(l(),i("div",Se,[(l(!0),i(x,null,S(h(R),t=>(l(),i("div",{key:t.id,class:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow-md flex flex-col gap-4"},[e("div",Ce,[e("div",Me,[e("div",Te,[e("h4",Re,c(t.alias),1),e("button",{onClick:N(d=>z(t),["stop"]),type:"button",class:C([t.is_active?"bg-blue-600":"bg-gray-200 dark:bg-gray-600","relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out"]),title:t.is_active?"Deactivate":"Activate"},[e("span",{class:C([t.is_active?"translate-x-5":"translate-x-0","pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out"])},null,2)],10,De)]),e("div",Ve,[e("button",{onClick:d=>j(t),class:"text-sm font-medium text-blue-600 hover:underline"},"Edit",8,Fe),e("button",{onClick:d=>q(t),class:"text-sm font-medium text-red-600 hover:underline"},"Delete",8,$e)])]),e("p",Ge,c(P(t.name)),1),e("div",Ne,[(l(!0),i(x,null,S(t.config,(d,r)=>(l(),i(x,{key:r},[d?(l(),i("p",Ee,[e("span",Le,c(r.replace(/_/g," "))+":",1),r.includes("key")||r.includes("token")?(l(),i("span",Oe,"********")):(l(),i("span",je,c(d),1))])):m("",!0)],64))),128))])]),e("div",Ue,[e("button",{onClick:d=>J(t),class:"btn btn-secondary btn-sm flex items-center gap-2"},[ae(se,{class:"w-4 h-4"}),a[12]||(a[12]=b(" Manage Models "))],8,qe)])]))),128))]))])]))}};export{He as default};
