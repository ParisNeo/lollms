import{u as w,c as d,N as m,m as C,a as c,o,w as h,b as a,d as R,g,h as S,aB as M,t as _,K as P,e as x,W as y,ak as f,ap as T,Z as U,aH as X,aI as $,O as A}from"./index-Cg5UBQvj.js";import{u as V}from"./admin-BRuvzi00.js";import{_ as B}from"./GenericModal-Bc6NrQaT.js";const L={key:0,class:"space-y-4 border-l-2 border-gray-200 dark:border-gray-700 pl-4"},E={key:0},I={class:"flex flex-wrap gap-2 mt-2"},D={class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},H={class:"relative mt-1"},q=["type"],z={class:"flex justify-end gap-3"},O=["disabled"],Z={__name:"ServiceRegistrationModal",setup(j){const l=w();V();const r=d(()=>l.modalData("serviceRegistration")),s=d(()=>{var n;return(n=r.value)==null?void 0:n.item}),k=d(()=>{var n;return((n=r.value)==null?void 0:n.itemType)||"app"}),K=d(()=>{var n;return((n=r.value)==null?void 0:n.ownerType)||"system"}),t=m({name:"",url:"",authentication_type:"none",authentication_key:"",header_name:"X-API-Key"}),u=m(!1),p=m(!1),N=d(()=>{const n=k.value.toUpperCase();return s.value?`Edit ${n} Registration`:`Register External ${n}`});C(s,n=>{if(u.value=!1,n)if(t.value.name=n.name,t.value.url=n.url,t.value.authentication_type=n.authentication_type||"none",n.authentication_type==="api_key"&&n.authentication_key)try{const e=JSON.parse(n.authentication_key);typeof e=="object"&&e!==null?(t.value.authentication_key=e.key||"",t.value.header_name=e.header_name||"X-API-Key"):(t.value.authentication_key=n.authentication_key,t.value.header_name="X-API-Key")}catch{t.value.authentication_key=n.authentication_key,t.value.header_name="X-API-Key"}else t.value.authentication_key=n.authentication_key||"",t.value.header_name="X-API-Key";else t.value={name:"",url:"",authentication_type:"none",authentication_key:"",header_name:"X-API-Key"}},{immediate:!0});function v(n){t.value.header_name=n}async function b(){var n;if(!t.value.name||!t.value.url){l.addNotification("Name and URL are required.","warning");return}p.value=!0;try{let e=t.value.authentication_key;t.value.authentication_type==="api_key"&&(e=JSON.stringify({key:t.value.authentication_key,header_name:t.value.header_name}));const i={name:t.value.name,url:t.value.url,type:K.value,authentication_type:t.value.authentication_type,authentication_key:e};if(k.value==="app"){l.addNotification("Manual app registration not fully implemented in UI yet.","warning");return}else s.value?(await A.put(`/api/mcps/${s.value.id}`,i),l.addNotification("MCP updated successfully.","success")):(await A.post("/api/mcps",i),l.addNotification("MCP registered successfully.","success"));(n=r.value)!=null&&n.onRegistered&&r.value.onRegistered(),l.closeModal("serviceRegistration")}catch(e){console.error(e),l.addNotification("Failed to save service registration.","error")}finally{p.value=!1}}return(n,e)=>(o(),c(B,{"modal-name":"serviceRegistration",title:N.value,"max-width-class":"max-w-lg"},{body:h(()=>[a("form",{onSubmit:P(b,["prevent"]),class:"space-y-6"},[a("div",null,[e[10]||(e[10]=a("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Name",-1)),y(a("input",{"onUpdate:modelValue":e[0]||(e[0]=i=>t.value.name=i),type:"text",required:"",class:"input-field mt-1 w-full",placeholder:"My Service"},null,512),[[f,t.value.name]])]),a("div",null,[e[11]||(e[11]=a("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"URL",-1)),y(a("input",{"onUpdate:modelValue":e[1]||(e[1]=i=>t.value.url=i),type:"url",required:"",class:"input-field mt-1 w-full",placeholder:"http://localhost:8000"},null,512),[[f,t.value.url]]),e[12]||(e[12]=a("p",{class:"text-xs text-gray-500 mt-1"},"The base URL of the service.",-1))]),a("div",null,[e[14]||(e[14]=a("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Authentication",-1)),y(a("select",{"onUpdate:modelValue":e[2]||(e[2]=i=>t.value.authentication_type=i),class:"input-field mt-1 w-full"},e[13]||(e[13]=[a("option",{value:"none"},"None",-1),a("option",{value:"api_key"},"API Key (Header)",-1),a("option",{value:"bearer"},"Bearer Token",-1),a("option",{value:"lollms_chat_auth"},"LoLLMs Chat Auth (Internal)",-1)]),512),[[T,t.value.authentication_type]])]),t.value.authentication_type!=="none"&&t.value.authentication_type!=="lollms_chat_auth"?(o(),x("div",L,[t.value.authentication_type==="api_key"?(o(),x("div",E,[e[15]||(e[15]=a("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Header Name",-1)),y(a("input",{"onUpdate:modelValue":e[3]||(e[3]=i=>t.value.header_name=i),type:"text",class:"input-field mt-1 w-full",placeholder:"X-API-Key"},null,512),[[f,t.value.header_name]]),a("div",I,[a("button",{type:"button",onClick:e[4]||(e[4]=i=>v("X-API-Key")),class:"px-2 py-1 text-xs bg-gray-100 dark:bg-gray-700 rounded hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors border dark:border-gray-600"},"X-API-Key"),a("button",{type:"button",onClick:e[5]||(e[5]=i=>v("X-AgentsKB-Key")),class:"px-2 py-1 text-xs bg-gray-100 dark:bg-gray-700 rounded hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors border dark:border-gray-600"},"X-AgentsKB-Key"),a("button",{type:"button",onClick:e[6]||(e[6]=i=>v("Authorization")),class:"px-2 py-1 text-xs bg-gray-100 dark:bg-gray-700 rounded hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors border dark:border-gray-600"},"Authorization")])])):g("",!0),a("div",null,[a("label",D,_(t.value.authentication_type==="bearer"?"Token":"Key"),1),a("div",H,[y(a("input",{type:u.value?"text":"password","onUpdate:modelValue":e[7]||(e[7]=i=>t.value.authentication_key=i),class:"input-field w-full pr-10",placeholder:"Enter secret..."},null,8,q),[[U,t.value.authentication_key]]),a("button",{type:"button",onClick:e[8]||(e[8]=i=>u.value=!u.value),class:"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-500 hover:text-gray-700 dark:hover:text-gray-300 cursor-pointer z-10 focus:outline-none",title:"Toggle Visibility"},[u.value?(o(),c(X,{key:0,class:"w-5 h-5"})):(o(),c($,{key:1,class:"w-5 h-5"}))])])])])):g("",!0)],32)]),footer:h(()=>[a("div",z,[a("button",{onClick:e[9]||(e[9]=i=>R(l).closeModal("serviceRegistration")),class:"btn btn-secondary"},"Cancel"),a("button",{onClick:b,class:"btn btn-primary",disabled:p.value},[p.value?(o(),c(M,{key:0,class:"w-5 h-5 mr-2 animate-spin"})):g("",!0),S(" "+_(s.value?"Save Changes":"Register"),1)],8,O)])]),_:1},8,["title"]))}};export{Z as default};
