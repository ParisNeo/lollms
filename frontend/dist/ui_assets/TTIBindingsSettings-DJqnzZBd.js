const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["ui_assets/BindingModelsManager-CcTPRPu2.js","ui_assets/index-x6ZZ9rZx.js","ui_assets/index-5Jw6l7Hf.css","ui_assets/admin-BhxeX2xU.js","ui_assets/BindingZoo-voSSzcrE.js"])))=>i.map(i=>d[i]);
import{u as ie,a1 as re,a2 as O,L as b,c as E,k as F,j as de,e as o,o as l,b as t,l as c,t as r,J as v,P as D,p,Y as R,a6 as J,F as T,m as C,d as B,X as ue,a as M,cj as ce,ck as ve,ax as me,K as z,f as S,cq as ge,co as be,al as fe,q as G,C as pe,G as K}from"./index-x6ZZ9rZx.js";import{u as ye}from"./admin-BhxeX2xU.js";import{_ as xe}from"./JsonRenderer-DhwSGqUs.js";const _e={class:"space-y-8"},he={key:0,class:"bg-white dark:bg-gray-800 shadow-md rounded-lg p-6"},ke={class:"flex justify-between items-center mb-4"},we={class:"text-xl font-semibold"},Te={key:0,class:"flex gap-2 text-sm font-medium overflow-x-auto"},Ce={key:0},Be={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},Se=["disabled"],$e=["value"],Ae={key:0,class:"space-y-6 border-t dark:border-gray-700 pt-6"},Ie={class:"text-sm text-gray-600 dark:text-gray-400"},je=["for"],Ve={key:0,class:"text-red-500"},Ne=["id","onUpdate:modelValue"],De=["value"],Ee={key:1},Fe={class:"relative"},Me=["type","id","onUpdate:modelValue","required","placeholder"],ze=["onClick","title"],Pe={key:2,class:"flex items-center justify-between bg-gray-50 dark:bg-gray-700/50 p-3 rounded-md"},Ue={class:"flex-grow flex flex-col pr-4"},qe={class:"text-sm text-gray-500 dark:text-gray-400"},Le=["onClick"],Oe={class:"text-xs text-gray-500 mt-1"},Re={class:"flex items-center justify-between bg-gray-50 dark:bg-gray-700/50 p-3 rounded-md"},Je={class:"flex justify-end gap-3"},Ge=["disabled"],Ke={key:1,class:"space-y-6"},Ze={key:0},He={class:"flex justify-between items-start mb-3"},Xe={class:"font-bold text-md flex items-center gap-2"},Ye={class:"text-sm text-gray-600 dark:text-gray-400 mt-1"},Qe=["onClick","disabled"],We={key:0,class:"space-y-3 mb-4 p-3 bg-white dark:bg-gray-800 rounded border dark:border-gray-700"},et={class:"block text-xs font-medium uppercase text-gray-500 dark:text-gray-400 mb-1"},tt=["onUpdate:modelValue","placeholder"],st={key:1,class:"flex items-center gap-2"},nt=["onClick"],at={class:"text-sm text-gray-600 dark:text-gray-400"},lt={key:1,class:"mt-4"},ot={class:"flex justify-between text-xs mb-1 font-semibold text-blue-600 dark:text-blue-400"},it={class:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2"},rt={class:"text-xs text-gray-500 mt-1 truncate"},dt={key:2,class:"mt-4 p-3 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-md"},ut={key:0},ct={key:1,class:"whitespace-pre-wrap text-sm text-gray-800 dark:text-gray-200 font-mono"},vt={key:3,class:"mt-4 p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-md"},mt={class:"text-xs font-bold text-red-800 dark:text-red-300 mb-2 uppercase flex items-center gap-2"},gt={class:"text-sm text-red-700 dark:text-red-400"},bt={key:1,class:"text-center text-gray-500 py-8 border-2 border-dashed border-gray-200 dark:border-gray-700 rounded-lg"},ft={key:2},pt={key:3},yt={key:1},xt={class:"flex justify-between items-center mb-4 flex-wrap gap-4"},_t={class:"flex items-center gap-4"},ht={key:0,class:"text-center p-6"},kt={key:1,class:"text-center p-6 bg-gray-50 dark:bg-gray-800/50 rounded-lg"},wt={key:2,class:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6"},Tt=["onClick"],Ct=["onClick","title"],Bt={class:"flex-grow"},St={class:"flex items-center gap-3 mb-2"},$t={class:"font-bold text-lg text-gray-900 dark:text-white"},At={class:"text-xs text-gray-500 dark:text-gray-400"},It={class:"mt-3 text-sm text-gray-600 dark:text-gray-300"},jt={key:0,class:"mb-1"},Vt={class:"text-xs text-gray-400 truncate"},Nt={class:"border-t dark:border-gray-700 pt-3 flex justify-between items-center text-xs text-gray-500"},Dt=["onClick"],Pt={__name:"TTIBindingsSettings",setup(Et){const Z=G(()=>K(()=>import("./BindingModelsManager-CcTPRPu2.js"),__vite__mapDeps([0,1,2,3]))),H=G(()=>K(()=>import("./BindingZoo-voSSzcrE.js"),__vite__mapDeps([4,1,2,3]))),f=ye(),$=ie(),P=re(),{ttiBindings:U,availableTtiBindingTypes:A,isLoadingTtiBindings:X,globalSettings:Y}=O(f),{tasks:Q}=O(P),k=b(!1),y=b(null),I=b(!1),_=b({}),g=b({}),d=b("settings"),j=b(null),V=b(null),h=b(null),u=E(()=>j.value?Q.value.find(a=>a.id===j.value):null);F(u,a=>{a&&a.status==="completed"&&(h.value=a.result)},{deep:!0});const q=()=>({id:null,alias:"",name:"",config:{},default_model_name:"",is_active:!0}),i=b(q()),w=E(()=>y.value!==null),x=E(()=>i.value.name?A.value.find(a=>a.binding_name===i.value.name):null),W=E(()=>{if(!x.value)return[];const a=x.value.input_parameters||[],s=new Set(a.map(n=>n.name)),e=Object.keys(i.value.config||{}).filter(n=>!s.has(n)&&n!=="model_name").map(n=>({name:n,type:typeof i.value.config[n]=="boolean"?"bool":typeof i.value.config[n]=="number"?"float":"str",description:"(Parameter not in binding description)",mandatory:!1}));return[...a.filter(n=>n.name!=="model_name"),...e]});F(Y,a=>{},{deep:!0,immediate:!0}),F(()=>i.value.name,(a,s)=>{if(a!==s&&!w.value){const e=A.value.find(m=>m.binding_name===a),n={};e&&e.input_parameters&&e.input_parameters.forEach(m=>{n[m.name]=m.default}),i.value.config=n}}),de(()=>{f.fetchTtiBindings(),f.fetchAvailableTtiBindingTypes(),f.fetchGlobalSettings()});function L(){y.value=null,i.value=q(),_.value={},g.value={},k.value=!0,d.value="settings",window.scrollTo({top:0,behavior:"smooth"})}function ee(a){y.value=a,i.value=JSON.parse(JSON.stringify(a)),i.value.config||(i.value.config={}),_.value={};const s=A.value.find(e=>e.binding_name===a.name);if(s&&s.commands){const e={};s.commands.forEach(n=>{e[n.name]={},n.parameters&&n.parameters.forEach(m=>{e[n.name][m.name]=m.default!==void 0?m.default:""})}),g.value=e}else g.value={};j.value=null,h.value=null,V.value=null,k.value=!0,d.value="settings",window.scrollTo({top:0,behavior:"smooth"})}function N(){k.value=!1,y.value=null}function te(a){return typeof a=="string"?a.split(",").map(s=>s.trim()).filter(s=>s):Array.isArray(a)?a.filter(s=>s):[]}async function se(){if(!i.value.alias.trim()||!i.value.name){$.addNotification("Alias and Binding Type are required fields.","warning");return}I.value=!0;try{const a={alias:i.value.alias,name:i.value.name,config:i.value.config||{},is_active:i.value.is_active,default_model_name:i.value.default_model_name||null};w.value?await f.updateTtiBinding(y.value.id,a):await f.addTtiBinding(a),N()}catch(a){console.error("Submit failed:",a.message)}finally{I.value=!1}}async function ne(a){await $.showConfirmation({title:`Delete TTI Binding '${a.alias}'?`,message:"Are you sure? This action cannot be undone.",confirmText:"Delete"})&&await f.deleteTtiBinding(a.id)}async function ae(a){await f.updateTtiBinding(a.id,{is_active:!a.is_active})}function le(a){const s=A.value.find(e=>e.binding_name===a);return s?s.title:a}async function oe(a,s,e){j.value=null,h.value=null,V.value=a.name;try{$.addNotification(`Submitting command '${a.title||a.name}'...`,"info");const n=await f.executeTtiBindingCommand(s,a.name,e);n&&n.id&&(j.value=n.id,P.addTask(n),$.addNotification(`Task started: ${a.title||a.name}`,"success"))}catch(n){console.error(n),$.addNotification(`Command submission failed: ${n.message}`,"error")}}return(a,s)=>(l(),o("div",_e,[k.value?(l(),o("div",he,[t("div",ke,[t("h3",we,r(w.value?"Edit TTI Binding: "+i.value.alias:"Add New TTI Binding"),1),w.value?(l(),o("div",Te,[t("button",{onClick:s[0]||(s[0]=e=>d.value="settings"),class:v([{"text-blue-600 border-b-2 border-blue-600":d.value==="settings","text-gray-500 hover:text-gray-700":d.value!=="settings"},"px-3 py-2 whitespace-nowrap"])},"Settings",2),t("button",{onClick:s[1]||(s[1]=e=>d.value="commands"),class:v([{"text-blue-600 border-b-2 border-blue-600":d.value==="commands","text-gray-500 hover:text-gray-700":d.value!=="commands"},"px-3 py-2 whitespace-nowrap"])},"Commands",2),t("button",{onClick:s[2]||(s[2]=e=>d.value="zoo"),class:v([{"text-blue-600 border-b-2 border-blue-600":d.value==="zoo","text-gray-500 hover:text-gray-700":d.value!=="zoo"},"px-3 py-2 whitespace-nowrap"])},"Models Zoo",2),t("button",{onClick:s[3]||(s[3]=e=>d.value="models"),class:v([{"text-blue-600 border-b-2 border-blue-600":d.value==="models","text-gray-500 hover:text-gray-700":d.value!=="models"},"px-3 py-2 whitespace-nowrap"])},"Installed Models",2)])):c("",!0)]),d.value==="settings"?(l(),o("div",Ce,[t("form",{onSubmit:z(se,["prevent"]),class:"space-y-6"},[t("div",Be,[t("div",null,[s[8]||(s[8]=t("label",{for:"alias",class:"block text-sm font-medium"},[p("Alias "),t("span",{class:"text-red-500"},"*")],-1)),D(t("input",{type:"text",id:"alias","onUpdate:modelValue":s[4]||(s[4]=e=>i.value.alias=e),class:"input-field mt-1",required:"",placeholder:"e.g., local_sd",autocomplete:"off"},null,512),[[R,i.value.alias]]),s[9]||(s[9]=t("p",{class:"text-xs text-gray-500 mt-1"},"A unique, short name for this configuration.",-1))]),t("div",null,[s[11]||(s[11]=t("label",{for:"name",class:"block text-sm font-medium"},[p("Binding Type "),t("span",{class:"text-red-500"},"*")],-1)),D(t("select",{id:"name","onUpdate:modelValue":s[5]||(s[5]=e=>i.value.name=e),class:"input-field mt-1",required:"",disabled:w.value},[s[10]||(s[10]=t("option",{disabled:"",value:""},"Select a type",-1)),(l(!0),o(T,null,C(B(A),e=>(l(),o("option",{key:e.binding_name,value:e.binding_name},r(e.title),9,$e))),128))],8,Se),[[J,i.value.name]])])]),x.value?(l(),o("div",Ae,[t("p",Ie,r(x.value.description),1),(l(!0),o(T,null,C(W.value,e=>(l(),o("div",{key:e.name,class:"space-y-1"},[t("label",{for:`param-${e.name}`,class:"block text-sm font-medium capitalize"},[p(r(e.name.replace(/_/g," "))+" ",1),e.mandatory?(l(),o("span",Ve,"*")):c("",!0)],8,je),e.options&&e.options.length>0?D((l(),o("select",{key:0,id:`param-${e.name}`,"onUpdate:modelValue":n=>i.value.config[e.name]=n,class:"input-field"},[(l(!0),o(T,null,C(te(e.options),n=>(l(),o("option",{key:n,value:n},r(n),9,De))),128))],8,Ne)),[[J,i.value.config[e.name]]]):["str","int","float"].includes(e.type)?(l(),o("div",Ee,[t("div",Fe,[D(t("input",{type:(e.name.includes("key")||e.name.includes("token"))&&!_.value[e.name]?"password":"text",id:`param-${e.name}`,"onUpdate:modelValue":n=>i.value.config[e.name]=n,class:"input-field",required:e.mandatory,placeholder:e.description,autocomplete:"off"},null,8,Me),[[ue,i.value.config[e.name]]]),e.name.includes("key")||e.name.includes("token")?(l(),o("button",{key:0,type:"button",onClick:n=>_.value[e.name]=!_.value[e.name],class:"absolute inset-y-0 right-0 px-3 flex items-center text-gray-500 hover:text-gray-700 dark:hover:text-gray-300",title:_.value[e.name]?"Hide":"Show"},[_.value[e.name]?(l(),M(ce,{key:0,class:"w-5 h-5"})):(l(),M(ve,{key:1,class:"w-5 h-5"}))],8,ze)):c("",!0)])])):e.type==="bool"?(l(),o("div",Pe,[t("span",Ue,[t("span",qe,r(e.description),1)]),t("button",{onClick:n=>i.value.config[e.name]=!i.value.config[e.name],type:"button",class:v([i.value.config[e.name]?"bg-blue-600":"bg-gray-200 dark:bg-gray-600","relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out"])},[t("span",{class:v([i.value.config[e.name]?"translate-x-5":"translate-x-0","pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition-colors duration-200 ease-in-out"])},null,2)],10,Le)])):c("",!0),t("p",Oe,r(e.description),1)]))),128))])):c("",!0),t("div",Re,[s[12]||(s[12]=t("span",{class:"flex-grow flex flex-col"},[t("span",{class:"text-sm font-medium text-gray-900 dark:text-gray-100"},"Active"),t("span",{class:"text-sm text-gray-500 dark:text-gray-400"},"If disabled, this TTI service will not be available.")],-1)),t("button",{onClick:s[6]||(s[6]=e=>i.value.is_active=!i.value.is_active),type:"button",class:v([i.value.is_active?"bg-blue-600":"bg-gray-200 dark:bg-gray-600","relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out"])},[t("span",{class:v([i.value.is_active?"translate-x-5":"translate-x-0","pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition-colors duration-200 ease-in-out"])},null,2)],2)]),t("div",Je,[t("button",{type:"button",onClick:N,class:"btn btn-secondary"},"Cancel"),t("button",{type:"submit",class:"btn btn-primary",disabled:I.value},[I.value?(l(),M(me,{key:0,class:"w-5 h-5 mr-2"})):c("",!0),p(" "+r(I.value?"Saving...":w.value?"Save Changes":"Add Binding"),1)],8,Ge)])],32)])):d.value==="commands"?(l(),o("div",Ke,[x.value&&x.value.commands&&x.value.commands.length>0?(l(),o("div",Ze,[(l(!0),o(T,null,C(x.value.commands,e=>(l(),o("div",{key:e.name,class:"p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg border dark:border-gray-600 mb-4"},[t("div",He,[t("div",null,[t("h5",Xe,[S(ge,{class:"w-4 h-4 text-gray-500"}),p(" "+r(e.title||e.name),1)]),t("p",Ye,r(e.description),1)]),t("button",{type:"button",onClick:n=>oe(e,y.value.id,g.value[e.name]),class:"btn btn-primary btn-sm flex items-center gap-2",disabled:u.value&&u.value.status==="running"},[S(be,{class:"w-4 h-4"}),s[13]||(s[13]=p(" Execute "))],8,Qe)]),e.parameters&&e.parameters.length>0?(l(),o("div",We,[(l(!0),o(T,null,C(e.parameters,n=>(l(),o("div",{key:n.name},[t("label",et,r(n.name),1),n.type!=="bool"?D((l(),o("input",{key:0,type:"text","onUpdate:modelValue":m=>g.value[e.name][n.name]=m,class:"input-field text-sm",placeholder:n.default},null,8,tt)),[[R,g.value[e.name][n.name]]]):(l(),o("div",st,[t("button",{onClick:m=>g.value[e.name][n.name]=!g.value[e.name][n.name],type:"button",class:v([g.value[e.name][n.name]?"bg-blue-600":"bg-gray-200 dark:bg-gray-600","relative inline-flex h-5 w-9 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out"])},[t("span",{class:v([g.value[e.name][n.name]?"translate-x-4":"translate-x-0","pointer-events-none inline-block h-4 w-4 transform rounded-full bg-white shadow ring-0 transition-colors duration-200 ease-in-out"])},null,2)],10,nt),t("span",at,r(n.description),1)]))]))),128))])):c("",!0),u.value&&V.value===e.name&&(u.value.status==="running"||u.value.status==="pending")?(l(),o("div",lt,[t("div",ot,[s[14]||(s[14]=t("span",null,"Executing...",-1)),t("span",null,r(u.value.progress)+"%",1)]),t("div",it,[t("div",{class:"bg-blue-600 h-2 rounded-full transition-all duration-300 relative overflow-hidden",style:fe({width:u.value.progress+"%"})},s[15]||(s[15]=[t("div",{class:"absolute inset-0 bg-white/20 animate-[pulse_2s_cubic-bezier(0.4,0,0.6,1)_infinite]"},null,-1)]),4)]),t("p",rt,r(u.value.description),1)])):c("",!0),h.value&&V.value===e.name&&u.value&&u.value.status==="completed"?(l(),o("div",dt,[s[16]||(s[16]=t("h6",{class:"text-xs font-bold text-green-800 dark:text-green-300 mb-2 uppercase flex items-center gap-2"},[t("span",{class:"w-2 h-2 rounded-full bg-green-500"}),p(" Success ")],-1)),typeof h.value=="object"?(l(),o("div",ut,[S(xe,{json:h.value},null,8,["json"])])):(l(),o("div",ct,r(h.value),1))])):c("",!0),u.value&&V.value===e.name&&(u.value.status==="failed"||u.value.status==="cancelled")?(l(),o("div",vt,[t("h6",mt,[s[17]||(s[17]=t("span",{class:"w-2 h-2 rounded-full bg-red-500"},null,-1)),p(" "+r(u.value.status),1)]),t("p",gt,r(u.value.error),1)])):c("",!0)]))),128))])):(l(),o("div",bt," No commands available for this binding type. ")),t("div",{class:"flex justify-end gap-3 mt-4"},[t("button",{type:"button",onClick:N,class:"btn btn-secondary"},"Close")])])):d.value==="zoo"?(l(),o("div",ft,[S(B(H),{binding:y.value,"binding-type":"tti"},null,8,["binding"]),t("div",{class:"flex justify-end gap-3 mt-4"},[t("button",{type:"button",onClick:N,class:"btn btn-secondary"},"Close")])])):d.value==="models"?(l(),o("div",pt,[S(B(Z),{binding:y.value,"binding-type":"tti"},null,8,["binding"]),t("div",{class:"flex justify-end gap-3 mt-4"},[t("button",{type:"button",onClick:N,class:"btn btn-secondary"},"Close")])])):c("",!0)])):(l(),o("div",yt,[t("div",xt,[s[18]||(s[18]=t("h2",{class:"text-2xl font-bold"},"TTI Bindings",-1)),t("div",_t,[k.value?c("",!0):(l(),o("button",{key:0,onClick:L,class:"btn btn-primary self-end"},"+ Add New TTI Binding"))])]),B(X)?(l(),o("div",ht,"Loading TTI bindings...")):B(U).length===0&&!k.value?(l(),o("div",kt,[s[19]||(s[19]=t("p",null,"No TTI bindings configured yet.",-1)),t("button",{onClick:L,class:"mt-2 text-blue-600 hover:underline"},"Add your first one")])):(l(),o("div",wt,[(l(!0),o(T,null,C(B(U),e=>(l(),o("div",{key:e.id,onClick:n=>ee(e),class:"bg-white dark:bg-gray-800 p-5 rounded-lg shadow-md hover:shadow-lg transition-shadow cursor-pointer flex flex-col gap-4 border border-transparent hover:border-blue-500 group relative"},[t("div",{class:"absolute top-4 right-4 z-10",onClick:s[7]||(s[7]=z(()=>{},["stop"]))},[t("button",{onClick:n=>ae(e),type:"button",class:v([e.is_active?"bg-blue-600":"bg-gray-200 dark:bg-gray-600","relative inline-flex h-5 w-9 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out"]),title:e.is_active?"Deactivate":"Activate"},[t("span",{class:v([e.is_active?"translate-x-4":"translate-x-0","pointer-events-none inline-block h-4 w-4 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out"])},null,2)],10,Ct)]),t("div",Bt,[t("div",St,[S(pe,{class:"w-8 h-8 text-blue-500"}),t("div",null,[t("h4",$t,r(e.alias),1),t("p",At,r(le(e.name)),1)])]),t("div",It,[e.default_model_name?(l(),o("p",jt,[s[20]||(s[20]=t("span",{class:"font-semibold"},"Default:",-1)),p(" "+r(e.default_model_name),1)])):c("",!0),t("p",Vt,r(e.config?Object.keys(e.config).filter(n=>!n.includes("key")).join(", "):""),1)])]),t("div",Nt,[s[21]||(s[21]=t("span",null,"Click to edit",-1)),t("button",{onClick:z(n=>ne(e),["stop"]),class:"text-red-500 hover:underline p-1"},"Delete",8,Dt)])],8,Tt))),128))]))]))]))}};export{Pt as default};
