const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["ui_assets/BindingModelsManager-CNZTERqi.js","ui_assets/index-BaERX4Xe.js","ui_assets/index-3yNPkENC.css","ui_assets/admin-CYP4McKY.js","ui_assets/BindingZoo-5dzHFdJy.js"])))=>i.map(i=>d[i]);
import{K as ee,W as te,s as u,c as I,w as M,o as ne,d as l,l as i,e as t,h as v,t as r,p as m,z as S,m as A,Q as U,X as z,F as h,i as k,j as w,J as se,n as V,c8 as ae,c9 as ie,ao as oe,H as j,f as D,A as O,aj as le,D as P}from"./index-BaERX4Xe.js";import{u as re}from"./admin-CYP4McKY.js";const de={class:"space-y-8"},ue={key:0,class:"bg-white dark:bg-gray-800 shadow-md rounded-lg p-6"},ce={class:"flex justify-between items-center mb-4"},ve={class:"text-xl font-semibold"},me={key:0,class:"flex gap-2 text-sm font-medium"},ge={key:0},fe={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},be=["disabled"],ye=["value"],pe={key:0,class:"space-y-6 border-t dark:border-gray-700 pt-6"},_e={class:"text-sm text-gray-600 dark:text-gray-400"},xe=["for"],he={key:0,class:"text-red-500"},ke=["id","onUpdate:modelValue"],we=["value"],Te={key:1},Ce={class:"relative"},Be=["type","id","onUpdate:modelValue","required","placeholder"],Se=["onClick","title"],Ae={key:2,class:"flex items-center justify-between bg-gray-50 dark:bg-gray-700/50 p-3 rounded-md"},$e={class:"flex-grow flex flex-col pr-4"},Ie={class:"text-sm text-gray-500 dark:text-gray-400"},Ve=["onClick"],je={class:"text-xs text-gray-500 mt-1"},De={key:1,class:"mt-6 border-t dark:border-gray-700 pt-6"},Ne={class:"grid grid-cols-1 gap-4"},Ee={class:"flex justify-between items-start mb-3"},Fe={class:"font-bold text-md"},Me={class:"text-sm text-gray-600 dark:text-gray-400"},Ue={key:0,class:"space-y-3 mb-4"},ze={class:"block text-xs font-medium uppercase text-gray-500 dark:text-gray-400 mb-1"},Oe=["onUpdate:modelValue","placeholder"],Pe={key:1,class:"flex items-center gap-2"},qe=["onClick"],Le={class:"text-sm"},Je={class:"flex justify-end"},Re=["onClick"],He={class:"flex items-center justify-between bg-gray-50 dark:bg-gray-700/50 p-3 rounded-md"},Ke={class:"flex justify-end gap-3"},Ze=["disabled"],Ge={key:1},Qe={key:2},We={key:1},Xe={class:"flex justify-between items-center mb-4 flex-wrap gap-4"},Ye={class:"flex items-center gap-4"},et={key:0,class:"text-center p-6"},tt={key:1,class:"text-center p-6 bg-gray-50 dark:bg-gray-800/50 rounded-lg"},nt={key:2,class:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6"},st=["onClick"],at=["onClick","title"],it={class:"flex-grow"},ot={class:"flex items-center gap-3 mb-2"},lt={class:"font-bold text-lg text-gray-900 dark:text-white"},rt={class:"text-xs text-gray-500 dark:text-gray-400"},dt={class:"mt-3 text-sm text-gray-600 dark:text-gray-300"},ut={key:0,class:"mb-1"},ct={class:"text-xs text-gray-400 truncate"},vt={class:"border-t dark:border-gray-700 pt-3 flex justify-between items-center text-xs text-gray-500"},mt=["onClick"],yt={__name:"TTIBindingsSettings",setup(gt){const q=O(()=>P(()=>import("./BindingModelsManager-CNZTERqi.js"),__vite__mapDeps([0,1,2,3]))),L=O(()=>P(()=>import("./BindingZoo-5dzHFdJy.js"),__vite__mapDeps([4,1,2,3]))),f=re(),T=ee(),{ttiBindings:N,availableTtiBindingTypes:C,isLoadingTtiBindings:J,globalSettings:R}=te(f),x=u(!1),b=u(null),B=u(!1),p=u({}),g=u({}),d=u("settings");u(!1),u(null),u([]),u(null),u({}),u(!1);const E=()=>({id:null,alias:"",name:"",config:{},default_model_name:"",is_active:!0}),o=u(E()),_=I(()=>b.value!==null),y=I(()=>o.value.name?C.value.find(a=>a.binding_name===o.value.name):null),H=I(()=>{if(!y.value)return[];const a=y.value.input_parameters||[],n=new Set(a.map(s=>s.name)),e=Object.keys(o.value.config||{}).filter(s=>!n.has(s)&&s!=="model_name").map(s=>({name:s,type:typeof o.value.config[s]=="boolean"?"bool":typeof o.value.config[s]=="number"?"float":"str",description:"(Parameter not in binding description)",mandatory:!1}));return[...a.filter(s=>s.name!=="model_name"),...e]});M(R,a=>{},{deep:!0,immediate:!0}),M(()=>o.value.name,(a,n)=>{if(a!==n&&!_.value){const e=C.value.find(c=>c.binding_name===a),s={};e&&e.input_parameters&&e.input_parameters.forEach(c=>{s[c.name]=c.default}),o.value.config=s}}),ne(()=>{f.fetchTtiBindings(),f.fetchAvailableTtiBindingTypes(),f.fetchGlobalSettings()});function F(){b.value=null,o.value=E(),p.value={},g.value={},x.value=!0,d.value="settings",window.scrollTo({top:0,behavior:"smooth"})}function K(a){b.value=a,o.value=JSON.parse(JSON.stringify(a)),o.value.config||(o.value.config={}),p.value={};const n=C.value.find(e=>e.binding_name===a.name);if(n&&n.commands){const e={};n.commands.forEach(s=>{e[s.name]={},s.parameters&&s.parameters.forEach(c=>{e[s.name][c.name]=c.default!==void 0?c.default:""})}),g.value=e}else g.value={};x.value=!0,d.value="settings",window.scrollTo({top:0,behavior:"smooth"})}function $(){x.value=!1,b.value=null}function Z(a){return typeof a=="string"?a.split(",").map(n=>n.trim()).filter(n=>n):Array.isArray(a)?a.filter(n=>n):[]}async function G(){if(!o.value.alias.trim()||!o.value.name){T.addNotification("Alias and Binding Type are required fields.","warning");return}B.value=!0;try{const a={alias:o.value.alias,name:o.value.name,config:o.value.config||{},is_active:o.value.is_active,default_model_name:o.value.default_model_name||null};_.value?await f.updateTtiBinding(b.value.id,a):await f.addTtiBinding(a),$()}catch(a){console.error("Submit failed:",a.message)}finally{B.value=!1}}async function Q(a){await T.showConfirmation({title:`Delete TTI Binding '${a.alias}'?`,message:"Are you sure? This action cannot be undone.",confirmText:"Delete"})&&await f.deleteTtiBinding(a.id)}async function W(a){await f.updateTtiBinding(a.id,{is_active:!a.is_active})}function X(a){const n=C.value.find(e=>e.binding_name===a);return n?n.title:a}async function Y(a,n,e){try{T.addNotification(`Submitting command '${a.title||a.name}'...`,"info");const s=await f.executeTtiBindingCommand(n,a.name,e);if(s)return T.addNotification(`Task started: ${a.title||a.name}. Check Task Manager for progress.`,"success",5e3),s}catch(s){console.error(s),T.addNotification(`Command submission failed: ${s.message}`,"error")}}return(a,n)=>(i(),l("div",de,[x.value?(i(),l("div",ue,[t("div",ce,[t("h3",ve,r(_.value?"Edit TTI Binding: "+o.value.alias:"Add New TTI Binding"),1),_.value?(i(),l("div",me,[t("button",{onClick:n[0]||(n[0]=e=>d.value="settings"),class:m([{"text-blue-600 border-b-2 border-blue-600":d.value==="settings","text-gray-500 hover:text-gray-700":d.value!=="settings"},"px-3 py-2"])},"Settings",2),t("button",{onClick:n[1]||(n[1]=e=>d.value="zoo"),class:m([{"text-blue-600 border-b-2 border-blue-600":d.value==="zoo","text-gray-500 hover:text-gray-700":d.value!=="zoo"},"px-3 py-2"])},"Models Zoo",2),t("button",{onClick:n[2]||(n[2]=e=>d.value="models"),class:m([{"text-blue-600 border-b-2 border-blue-600":d.value==="models","text-gray-500 hover:text-gray-700":d.value!=="models"},"px-3 py-2"])},"Installed Models",2)])):v("",!0)]),d.value==="settings"?(i(),l("div",ge,[t("form",{onSubmit:j(G,["prevent"]),class:"space-y-6"},[t("div",fe,[t("div",null,[n[7]||(n[7]=t("label",{for:"alias",class:"block text-sm font-medium"},[A("Alias "),t("span",{class:"text-red-500"},"*")],-1)),S(t("input",{type:"text",id:"alias","onUpdate:modelValue":n[3]||(n[3]=e=>o.value.alias=e),class:"input-field mt-1",required:"",placeholder:"e.g., local_sd",autocomplete:"off"},null,512),[[U,o.value.alias]]),n[8]||(n[8]=t("p",{class:"text-xs text-gray-500 mt-1"},"A unique, short name for this configuration.",-1))]),t("div",null,[n[10]||(n[10]=t("label",{for:"name",class:"block text-sm font-medium"},[A("Binding Type "),t("span",{class:"text-red-500"},"*")],-1)),S(t("select",{id:"name","onUpdate:modelValue":n[4]||(n[4]=e=>o.value.name=e),class:"input-field mt-1",required:"",disabled:_.value},[n[9]||(n[9]=t("option",{disabled:"",value:""},"Select a type",-1)),(i(!0),l(h,null,k(w(C),e=>(i(),l("option",{key:e.binding_name,value:e.binding_name},r(e.title),9,ye))),128))],8,be),[[z,o.value.name]])])]),y.value?(i(),l("div",pe,[t("p",_e,r(y.value.description),1),(i(!0),l(h,null,k(H.value,e=>(i(),l("div",{key:e.name,class:"space-y-1"},[t("label",{for:`param-${e.name}`,class:"block text-sm font-medium capitalize"},[A(r(e.name.replace(/_/g," "))+" ",1),e.mandatory?(i(),l("span",he,"*")):v("",!0)],8,xe),e.options&&e.options.length>0?S((i(),l("select",{key:0,id:`param-${e.name}`,"onUpdate:modelValue":s=>o.value.config[e.name]=s,class:"input-field"},[(i(!0),l(h,null,k(Z(e.options),s=>(i(),l("option",{key:s,value:s},r(s),9,we))),128))],8,ke)),[[z,o.value.config[e.name]]]):["str","int","float"].includes(e.type)?(i(),l("div",Te,[t("div",Ce,[S(t("input",{type:(e.name.includes("key")||e.name.includes("token"))&&!p.value[e.name]?"password":"text",id:`param-${e.name}`,"onUpdate:modelValue":s=>o.value.config[e.name]=s,class:"input-field",required:e.mandatory,placeholder:e.description,autocomplete:"off"},null,8,Be),[[se,o.value.config[e.name]]]),e.name.includes("key")||e.name.includes("token")?(i(),l("button",{key:0,type:"button",onClick:s=>p.value[e.name]=!p.value[e.name],class:"absolute inset-y-0 right-0 px-3 flex items-center text-gray-500 hover:text-gray-700 dark:hover:text-gray-300",title:p.value[e.name]?"Hide":"Show"},[p.value[e.name]?(i(),V(ae,{key:0,class:"w-5 h-5"})):(i(),V(ie,{key:1,class:"w-5 h-5"}))],8,Se)):v("",!0)])])):e.type==="bool"?(i(),l("div",Ae,[t("span",$e,[t("span",Ie,r(e.description),1)]),t("button",{onClick:s=>o.value.config[e.name]=!o.value.config[e.name],type:"button",class:m([o.value.config[e.name]?"bg-blue-600":"bg-gray-200 dark:bg-gray-600","relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out"])},[t("span",{class:m([o.value.config[e.name]?"translate-x-5":"translate-x-0","pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition-colors duration-200 ease-in-out"])},null,2)],10,Ve)])):v("",!0),t("p",je,r(e.description),1)]))),128))])):v("",!0),_.value&&y.value&&y.value.commands&&y.value.commands.length>0?(i(),l("div",De,[n[11]||(n[11]=t("h4",{class:"text-lg font-semibold mb-4"},"Binding Commands",-1)),t("div",Ne,[(i(!0),l(h,null,k(y.value.commands,e=>(i(),l("div",{key:e.name,class:"p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg border dark:border-gray-600"},[t("div",Ee,[t("div",null,[t("h5",Fe,r(e.title||e.name),1),t("p",Me,r(e.description),1)])]),e.parameters&&e.parameters.length>0?(i(),l("div",Ue,[(i(!0),l(h,null,k(e.parameters,s=>(i(),l("div",{key:s.name},[t("label",ze,r(s.name),1),s.type!=="bool"?S((i(),l("input",{key:0,type:"text","onUpdate:modelValue":c=>g.value[e.name][s.name]=c,class:"input-field text-sm",placeholder:s.default},null,8,Oe)),[[U,g.value[e.name][s.name]]]):(i(),l("div",Pe,[t("button",{onClick:c=>g.value[e.name][s.name]=!g.value[e.name][s.name],type:"button",class:m([g.value[e.name][s.name]?"bg-blue-600":"bg-gray-200 dark:bg-gray-600","relative inline-flex h-5 w-9 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out"])},[t("span",{class:m([g.value[e.name][s.name]?"translate-x-4":"translate-x-0","pointer-events-none inline-block h-4 w-4 transform rounded-full bg-white shadow ring-0 transition-colors duration-200 ease-in-out"])},null,2)],10,qe),t("span",Le,r(s.description),1)]))]))),128))])):v("",!0),t("div",Je,[t("button",{type:"button",onClick:s=>Y(e,b.value.id,g.value[e.name]),class:"btn btn-primary btn-sm"},"Execute",8,Re)])]))),128))])])):v("",!0),t("div",He,[n[12]||(n[12]=t("span",{class:"flex-grow flex flex-col"},[t("span",{class:"text-sm font-medium text-gray-900 dark:text-gray-100"},"Active"),t("span",{class:"text-sm text-gray-500 dark:text-gray-400"},"If disabled, this TTI service will not be available.")],-1)),t("button",{onClick:n[5]||(n[5]=e=>o.value.is_active=!o.value.is_active),type:"button",class:m([o.value.is_active?"bg-blue-600":"bg-gray-200 dark:bg-gray-600","relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out"])},[t("span",{class:m([o.value.is_active?"translate-x-5":"translate-x-0","pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition-colors duration-200 ease-in-out"])},null,2)],2)]),t("div",Ke,[t("button",{type:"button",onClick:$,class:"btn btn-secondary"},"Cancel"),t("button",{type:"submit",class:"btn btn-primary",disabled:B.value},[B.value?(i(),V(oe,{key:0,class:"w-5 h-5 mr-2"})):v("",!0),A(" "+r(B.value?"Saving...":_.value?"Save Changes":"Add Binding"),1)],8,Ze)])],32)])):d.value==="zoo"?(i(),l("div",Ge,[D(w(L),{binding:b.value,"binding-type":"tti"},null,8,["binding"]),t("div",{class:"flex justify-end gap-3 mt-4"},[t("button",{type:"button",onClick:$,class:"btn btn-secondary"},"Close")])])):d.value==="models"?(i(),l("div",Qe,[D(w(q),{binding:b.value,"binding-type":"tti"},null,8,["binding"]),t("div",{class:"flex justify-end gap-3 mt-4"},[t("button",{type:"button",onClick:$,class:"btn btn-secondary"},"Close")])])):v("",!0)])):(i(),l("div",We,[t("div",Xe,[n[13]||(n[13]=t("h2",{class:"text-2xl font-bold"},"TTI Bindings",-1)),t("div",Ye,[x.value?v("",!0):(i(),l("button",{key:0,onClick:F,class:"btn btn-primary self-end"},"+ Add New TTI Binding"))])]),w(J)?(i(),l("div",et,"Loading TTI bindings...")):w(N).length===0&&!x.value?(i(),l("div",tt,[n[14]||(n[14]=t("p",null,"No TTI bindings configured yet.",-1)),t("button",{onClick:F,class:"mt-2 text-blue-600 hover:underline"},"Add your first one")])):(i(),l("div",nt,[(i(!0),l(h,null,k(w(N),e=>(i(),l("div",{key:e.id,onClick:s=>K(e),class:"bg-white dark:bg-gray-800 p-5 rounded-lg shadow-md hover:shadow-lg transition-shadow cursor-pointer flex flex-col gap-4 border border-transparent hover:border-blue-500 group relative"},[t("div",{class:"absolute top-4 right-4 z-10",onClick:n[6]||(n[6]=j(()=>{},["stop"]))},[t("button",{onClick:s=>W(e),type:"button",class:m([e.is_active?"bg-blue-600":"bg-gray-200 dark:bg-gray-600","relative inline-flex h-5 w-9 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out"]),title:e.is_active?"Deactivate":"Activate"},[t("span",{class:m([e.is_active?"translate-x-4":"translate-x-0","pointer-events-none inline-block h-4 w-4 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out"])},null,2)],10,at)]),t("div",it,[t("div",ot,[D(le,{class:"w-8 h-8 text-blue-500"}),t("div",null,[t("h4",lt,r(e.alias),1),t("p",rt,r(X(e.name)),1)])]),t("div",dt,[e.default_model_name?(i(),l("p",ut,[n[15]||(n[15]=t("span",{class:"font-semibold"},"Default:",-1)),A(" "+r(e.default_model_name),1)])):v("",!0),t("p",ct,r(e.config?Object.keys(e.config).filter(s=>!s.includes("key")).join(", "):""),1)])]),t("div",vt,[n[16]||(n[16]=t("span",null,"Click to edit",-1)),t("button",{onClick:j(s=>Q(e),["stop"]),class:"text-red-500 hover:underline p-1"},"Delete",8,mt)])],8,st))),128))]))]))]))}};export{yt as default};
