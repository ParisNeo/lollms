import{q as we,Q as xe,K as ke,R as E,s as A,c as y,w as R,o as Ae,d as r,l,e as s,h as m,p as B,f as _,a0 as O,z as v,L as T,j as p,X as I,cc as Re,F as h,i as w,t as g,n as P,cO as $e,m as D,ar as j,H as Ce,ah as Se}from"./index-BBRgbnZQ.js";import{u as _e}from"./admin-CwLQr1mG.js";import{I as Te}from"./IconArrowUp-Q6qK09pz.js";import{A as Ie}from"./AppCard-_yFD3KrL.js";import{A as Ue}from"./AppCardSkeleton-C03QefFR.js";import"./IconGlobeAlt-DJc8Wsna.js";import"./IconPlayCircle-D2gooLkD.js";import"./AdminView-Bo442GSB.js";import"./PageViewLayout-CieE8QU1.js";import"./IconKey-C28jqjj0.js";import"./IconNoSymbol-D0HTNvx3.js";import"./IconArrowPath-DUE5IYPL.js";const Me={class:"space-y-6"},Pe={class:"border-b border-gray-200 dark:border-gray-700"},De={class:"-mb-px flex space-x-6","aria-label":"Sub Tabs"},Ve={key:0},Ze={class:"flex justify-between items-center mb-4 flex-wrap gap-2"},Fe={class:"flex items-center gap-2"},Le={class:"space-y-4"},ze={class:"grid grid-cols-1 lg:grid-cols-4 gap-4"},Ne={class:"relative lg:col-span-1"},Ee={class:"grid grid-cols-1 sm:grid-cols-3 lg:col-span-3 gap-4"},Be=["value"],Oe=["value"],je={class:"flex items-center gap-2"},qe=["value"],He={key:0,class:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 2xl:grid-cols-4 gap-6"},Ke={key:1,class:"empty-state-card"},Qe={key:2},Je={class:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 2xl:grid-cols-4 gap-6"},We={key:0,class:"flex justify-between items-center mt-6"},Ge=["disabled"],Xe={class:"text-sm text-gray-600 dark:text-gray-400"},Ye=["disabled"],et={key:1},tt={class:"flex justify-between items-center mb-4 flex-wrap gap-2"},at={key:0,class:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm mb-6"},st={class:"flex items-center gap-x-4"},nt={key:0},ot=["required"],lt={key:1},it=["required"],rt={key:1,class:"text-center p-4"},dt={key:2,class:"empty-state-card"},ut={key:3,class:"space-y-4"},pt={class:"font-semibold"},ct={class:"text-sm text-gray-500"},vt={class:"text-xs text-gray-400"},ft={class:"flex items-center gap-2"},gt=["onClick"],yt=["onClick"],mt={__name:"AppsManagement",setup(bt){const i=_e(),V=xe(),u=ke(),{appFilters:o}=i,{zooRepositories:Z,isLoadingZooRepositories:q,zooApps:$,isLoadingZooApps:H}=E(i),{tasks:K}=E(V),f=A("zoo"),d=A({type:"git",name:"",url:"",path:""}),x=A(!1),c=A(null),k=A(JSON.parse(localStorage.getItem("starredApps")||"[]"));let F=null;const C=y({get:()=>o.currentPage,set:e=>{o.currentPage=e}}),Q=[{value:"last_update_date",label:"Last Updated"},{value:"creation_date",label:"Creation Date"},{value:"name",label:"Name"},{value:"author",label:"Author"}],U=y(()=>$.value.total||0),L=y(()=>$.value.pages||1),J=y(()=>{if(U.value===0)return"Showing 0-0 of 0";const e=(o.currentPage-1)*o.pageSize+1,t=Math.min(o.currentPage*o.pageSize,U.value);return`Showing ${e}-${t} of ${U.value}`});function W(){clearTimeout(F),F=setTimeout(()=>{o.currentPage!==1?o.currentPage=1:i.fetchZooApps()},300)}R(()=>[o.sortKey,o.sortOrder,o.selectedCategory,o.installationStatusFilter,o.selectedRepository],()=>{o.currentPage!==1?o.currentPage=1:i.fetchZooApps()}),R(()=>o.searchQuery,W),R(()=>o.currentPage,i.fetchZooApps),R(k,e=>{localStorage.setItem("starredApps",JSON.stringify(e))},{deep:!0}),R(f,e=>{e==="zoo"&&i.fetchZooApps(),e==="source"&&i.fetchZooRepositories()}),Ae(()=>{f.value==="zoo"&&i.fetchZooApps(),f.value==="source"&&i.fetchZooRepositories()});const M=y(()=>{const e=new Map,t="Installing app: ",a=/^(Updating app|Start app|Stop app|Fixing item|Purging item): .* \(([a-fA-F0-9-]+)\)$/;return(K.value||[]).forEach(n=>{if(n!=null&&n.name&&(n.status==="running"||n.status==="pending")){let b;if(n.name.startsWith(t))b=`folder:${n.name.replace(t,"")}`;else{const N=n.name.match(a);N&&(b=`id:${N[2]}`)}b&&(!e.has(b)||new Date(n.created_at)>new Date(e.get(b).created_at))&&e.set(b,n)}}),($.value.items||[]).map(n=>({...n,task:e.get(`folder:${n.folder_name}`)||(n.id?e.get(`id:${n.id}`):null)}))}),S=y(()=>Array.isArray(Z.value)?[...Z.value].sort((e,t)=>(e.name||"").localeCompare(t.name||"")):[]),G=y(()=>["All","Starred",...$.value.categories||[]]);function X(e){const t=k.value.indexOf(e);t>-1?k.value.splice(t,1):k.value.push(e)}function Y(e){return e?new Date(e).toLocaleString():"Never"}async function ee(){if(!d.value.name){u.addNotification("Repository name is required.","warning");return}const e={name:d.value.name};d.value.type==="git"?e.url=d.value.url:e.path=d.value.path,c.value="add";try{await i.addZooRepository(e),d.value={type:"git",name:"",url:"",path:""},x.value=!1}finally{c.value=null}}async function te(e){c.value=e.id;try{await i.pullZooRepository(e.id)}finally{c.value=null}}async function ae(e){if(await u.showConfirmation({title:`Delete Repository '${e.name}'?`})){c.value=e.id;try{await i.deleteZooRepository(e.id)}finally{c.value=null}}}function se(e){u.openModal("appInstall",{app:e,type:"apps"})}async function ne(e){await u.showConfirmation({title:`Update '${e.name}'?`,confirmText:"Update"})&&await i.updateApp(e.id)}async function z(e,t){c.value=`${t}-${e}`;try{t==="start"&&await i.startApp(e),t==="stop"&&await i.stopApp(e)}finally{c.value=null}}async function oe(e){await u.showConfirmation({title:`Restart '${e.name}'?`,message:"The application will be stopped and started again.",confirmText:"Restart"})&&await i.restartApp(e.id)}async function le(e){if(await u.showConfirmation({title:`Uninstall '${e.name}'?`,confirmText:"Uninstall"})){c.value=`uninstall-${e.id}`;try{await i.uninstallApp(e.id)}finally{c.value=null}}}function ie(e){e.is_installed?u.openModal("appConfig",{app:e}):e.repository==="Registered"&&u.openModal("serviceRegistration",{item:e,itemType:"app",ownerType:e.type||"system",onRegistered:i.fetchZooApps})}function re(e){u.openModal("appEnvConfig",{app:e})}async function de(e){await u.showConfirmation({title:`Delete Registration for '${e.name}'?`,message:"This will remove the manually registered entry but will not affect the service itself.",confirmText:"Delete"})&&await i.deleteRegisteredApp(e.id)}function ue(e){u.openModal("appLog",{app:e})}async function pe(e){const t=await i.fetchAppReadme(e.repository,e.folder_name);u.openModal("sourceViewer",{title:`README: ${e.name}`,content:t,language:"markdown"})}async function ce(e){await V.cancelTask(e)}function ve(e){u.openModal("tasksManager",{initialTaskId:e})}async function fe(){await i.syncInstallations()}async function ge(e){await u.showConfirmation({title:`Purge '${e.name}'?`,message:"This will permanently delete the installation folder.",confirmText:"Purge"})&&await i.purgeBrokenInstallation(e)}async function ye(e){await u.showConfirmation({title:`Fix '${e.name}'?`,message:"This will attempt to re-create the database entry for this item.",confirmText:"Fix"})&&await i.fixBrokenInstallation(e)}function me(e){u.openModal("appDetails",{app:e})}function be(){u.openModal("serviceRegistration",{itemType:"app",ownerType:"system",onRegistered:i.fetchZooApps})}async function he(){const e=await i.refreshZooCache();e&&u.openModal("tasksManager",{initialTaskId:e.id})}return(e,t)=>(l(),r("div",Me,[s("div",Pe,[s("nav",De,[s("button",{onClick:t[0]||(t[0]=a=>f.value="zoo"),class:B(["tab-button",f.value==="zoo"?"active":"inactive"])},"Zoo",2),s("button",{onClick:t[1]||(t[1]=a=>f.value="source"),class:B(["tab-button",f.value==="source"?"active":"inactive"])},"Repositories",2)])]),f.value==="zoo"?(l(),r("section",Ve,[s("div",Ze,[t[16]||(t[16]=s("h3",{class:"text-xl font-semibold"},"App Zoo",-1)),s("div",Fe,[s("button",{onClick:he,class:"btn btn-secondary",title:"Refresh Zoo Cache from all sources"},[_(O,{class:"w-4 h-4"})]),s("button",{onClick:be,class:"btn btn-secondary"},"Register External App"),s("button",{onClick:fe,class:"btn btn-secondary-outline",title:"Repair broken installations and remove orphaned DB entries."},"Sync Installations")])]),s("div",Le,[s("div",ze,[s("div",Ne,[v(s("input",{type:"text","onUpdate:modelValue":t[2]||(t[2]=a=>p(o).searchQuery=a),placeholder:"Search apps...",class:"input-field w-full pl-10"},null,512),[[T,p(o).searchQuery]]),t[17]||(t[17]=s("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[s("svg",{class:"h-5 w-5 text-gray-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})])],-1))]),s("div",Ee,[v(s("select",{"onUpdate:modelValue":t[3]||(t[3]=a=>p(o).installationStatusFilter=a),class:"input-field"},t[18]||(t[18]=[Re('<option value="All" data-v-2ee57fc8>All Statuses</option><option value="Installed" data-v-2ee57fc8>Installed</option><option value="Uninstalled" data-v-2ee57fc8>Uninstalled</option><option value="Registered" data-v-2ee57fc8>Registered</option><option value="Broken" data-v-2ee57fc8>Broken</option>',5)]),512),[[I,p(o).installationStatusFilter]]),v(s("select",{"onUpdate:modelValue":t[4]||(t[4]=a=>p(o).selectedCategory=a),class:"input-field"},[(l(!0),r(h,null,w(G.value,a=>(l(),r("option",{key:a,value:a},g(a),9,Be))),128))],512),[[I,p(o).selectedCategory]]),v(s("select",{"onUpdate:modelValue":t[5]||(t[5]=a=>p(o).selectedRepository=a),class:"input-field"},[t[19]||(t[19]=s("option",{value:"All"},"All Sources",-1)),t[20]||(t[20]=s("option",{value:"Registered"},"Registered",-1)),(l(!0),r(h,null,w(S.value,a=>(l(),r("option",{key:a.id,value:a.name},g(a.name),9,Oe))),128))],512),[[I,p(o).selectedRepository]])])]),s("div",je,[v(s("select",{"onUpdate:modelValue":t[6]||(t[6]=a=>p(o).sortKey=a),class:"input-field w-48"},[(l(),r(h,null,w(Q,a=>s("option",{key:a.value,value:a.value},"Sort by "+g(a.label),9,qe)),64))],512),[[I,p(o).sortKey]]),s("button",{onClick:t[7]||(t[7]=a=>p(o).sortOrder=p(o).sortOrder==="asc"?"desc":"asc"),class:"btn btn-secondary p-2"},[p(o).sortOrder==="asc"?(l(),P(Te,{key:0,class:"w-5 h-5"})):(l(),P($e,{key:1,class:"w-5 h-5"}))])]),p(H)?(l(),r("div",He,[(l(),r(h,null,w(8,a=>_(Ue,{key:a})),64))])):!M.value||M.value.length===0?(l(),r("div",Ke,t[21]||(t[21]=[s("h4",{class:"font-semibold"},"No Apps Found",-1)]))):(l(),r("div",Qe,[s("div",Je,[(l(!0),r(h,null,w(M.value,a=>(l(),P(Ie,{key:a.id||`${a.repository}/${a.folder_name}`,app:a,task:a.task,"is-starred":k.value.includes(a.name),onStar:n=>X(a.name),onInstall:n=>se(a),onUpdate:n=>ne(a),onUninstall:n=>le(a),onDelete:n=>de(a),onHelp:n=>pe(a),onViewTask:ve,onCancelInstall:n=>ce(a.task.id),onStart:n=>z(a.id,"start"),onStop:n=>z(a.id,"stop"),onConfigure:n=>ie(a),onFix:n=>ye(a),onPurge:n=>ge(a),onDetails:me,onLogs:n=>ue(a),onEditEnv:n=>re(a),onRestart:n=>oe(a)},null,8,["app","task","is-starred","onStar","onInstall","onUpdate","onUninstall","onDelete","onHelp","onCancelInstall","onStart","onStop","onConfigure","onFix","onPurge","onLogs","onEditEnv","onRestart"]))),128))]),L.value>1?(l(),r("div",We,[s("button",{onClick:t[8]||(t[8]=a=>C.value--),disabled:C.value===1,class:"btn btn-secondary"},"Previous",8,Ge),s("span",Xe,g(J.value),1),s("button",{onClick:t[9]||(t[9]=a=>C.value++),disabled:C.value>=L.value,class:"btn btn-secondary"},"Next",8,Ye)])):m("",!0)]))])])):m("",!0),f.value==="source"?(l(),r("section",et,[s("div",tt,[t[22]||(t[22]=s("h3",{class:"text-xl font-semibold"},"App Zoo Repositories",-1)),s("button",{onClick:t[10]||(t[10]=a=>x.value=!x.value),class:"btn btn-primary"},g(x.value?"Cancel":"Add Repository"),1)]),x.value?(l(),r("div",at,[s("form",{onSubmit:Ce(ee,["prevent"]),class:"space-y-4"},[s("div",st,[s("label",null,[v(s("input",{type:"radio","onUpdate:modelValue":t[11]||(t[11]=a=>d.value.type=a),value:"git",class:"radio-input"},null,512),[[j,d.value.type]]),t[23]||(t[23]=D(" Git"))]),s("label",null,[v(s("input",{type:"radio","onUpdate:modelValue":t[12]||(t[12]=a=>d.value.type=a),value:"local",class:"radio-input"},null,512),[[j,d.value.type]]),t[24]||(t[24]=D(" Local"))])]),s("div",null,[t[25]||(t[25]=s("label",null,"Name",-1)),v(s("input",{"onUpdate:modelValue":t[13]||(t[13]=a=>d.value.name=a),type:"text",class:"input-field",required:""},null,512),[[T,d.value.name]])]),d.value.type==="git"?(l(),r("div",nt,[t[26]||(t[26]=s("label",null,"URL",-1)),v(s("input",{"onUpdate:modelValue":t[14]||(t[14]=a=>d.value.url=a),type:"url",class:"input-field",required:d.value.type==="git"},null,8,ot),[[T,d.value.url]])])):m("",!0),d.value.type==="local"?(l(),r("div",lt,[t[27]||(t[27]=s("label",null,"Path",-1)),v(s("input",{"onUpdate:modelValue":t[15]||(t[15]=a=>d.value.path=a),type:"text",class:"input-field",required:d.value.type==="local"},null,8,it),[[T,d.value.path]])])):m("",!0),t[28]||(t[28]=s("div",{class:"flex justify-end"},[s("button",{type:"submit",class:"btn btn-primary"},"Add")],-1))],32)])):m("",!0),p(q)?(l(),r("div",rt,"Loading...")):!S.value||S.value.length===0?(l(),r("div",dt,t[29]||(t[29]=[s("p",null,"No repositories added.",-1)]))):(l(),r("div",ut,[(l(!0),r(h,null,w(S.value,a=>(l(),r("div",{key:a.id,class:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm flex items-center justify-between"},[s("div",null,[s("p",pt,g(a.name),1),s("p",ct,g(a.url),1),s("p",vt,"Pulled: "+g(Y(a.last_pulled_at)),1)]),s("div",ft,[s("button",{onClick:n=>te(a),class:"btn btn-secondary btn-sm"},[_(O,{class:"w-4 h-4 mr-1"}),D(g(a.type==="git"?"Pull":"Rescan"),1)],8,gt),a.is_deletable?(l(),r("button",{key:0,onClick:n=>ae(a),class:"btn btn-danger btn-sm"},[_(Se,{class:"w-4 h-4"})],8,yt)):m("",!0)])]))),128))]))])):m("",!0)]))}},Ut=we(mt,[["__scopeId","data-v-2ee57fc8"]]);export{Ut as default};
