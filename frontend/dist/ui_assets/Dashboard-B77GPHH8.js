import{u as T}from"./admin-CYP4McKY.js";import{q as L,cX as j,cY as I,cZ as V,c_ as E,db as P,c$ as K,d0 as F,d1 as O,d2 as X,d3 as Y,dc as J,K as G,s as A,c as k,d as r,l as n,e,p as $,f as g,m as S,a2 as N,n as D,C as Q,W as z,o as W,j as b,g as R,t as y,F as ee,i as te,U as ae,ap as H,h as M,d4 as se,a0 as ne,v as U}from"./index-BaERX4Xe.js";import{L as oe,B as q}from"./chartjs-adapter-date-fns.esm-ZZ899Fpg.js";import{_ as le}from"./GenericModal-BhrPHn5j.js";const re={class:"space-y-6"},ie={class:"bg-white dark:bg-gray-800 rounded-lg shadow p-5"},de={class:"flex justify-between items-center mb-4 flex-wrap gap-2"},ce={class:"inline-flex rounded-md shadow-sm",role:"group"},ue={class:"flex items-center gap-2"},pe={class:"h-96"},ge={key:0,class:"flex items-center justify-center h-full"},ve={key:1,class:"flex items-center justify-center h-full"},me={key:2,class:"h-full"},be={__name:"GlobalStatsChart",props:{stats:{type:Object,default:null},isLoading:{type:Boolean,default:!1}},setup(x){j.register(I,V,E,P,K,F,O,X,Y,J);const s=x,o=G(),a=A("daily"),i=A(null),u=k(()=>a.value==="daily"||a.value==="weekly_stats"?oe:q),_=k(()=>({responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:a.value==="daily"||a.value==="weekly_stats"},title:{display:!0,text:d.value,color:o.currentTheme==="dark"?"#e5e7eb":"#1f2937"}},scales:{x:{type:a.value==="daily"?"time":"category",time:{unit:"day",tooltipFormat:"MMM d, yyyy"},grid:{color:o.currentTheme==="dark"?"rgba(255, 255, 255, 0.1)":"rgba(0, 0, 0, 0.1)"},ticks:{color:o.currentTheme==="dark"?"#cbd5e1":"#4b5563"}},y:{beginAtZero:!0,grid:{color:o.currentTheme==="dark"?"rgba(255, 255, 255, 0.1)":"rgba(0, 0, 0, 0.1)"},ticks:{color:o.currentTheme==="dark"?"#cbd5e1":"#4b5563"}}}})),d=k(()=>{switch(a.value){case"mean":return"Average Daily Generations by Weekday";case"variance":return"Generation Variance by Weekday";case"weekly_stats":return"Weekly Generation Statistics (Mean Â± Std Dev)";case"daily":default:return"Total AI Generations (Last 30 Days)"}}),c=k(()=>{if(!s.stats)return{labels:[],datasets:[]};const l=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"];if(a.value==="daily")return{labels:s.stats.generations_per_day.map(t=>t.date),datasets:[{label:"Generations",data:s.stats.generations_per_day.map(t=>t.count),borderColor:"#3b82f6",backgroundColor:"rgba(59, 130, 246, 0.2)",tension:.1,fill:!0}]};if(a.value==="mean")return{labels:l,datasets:[{label:"Mean Generations",data:l.map(t=>s.stats.mean_per_weekday[t]),backgroundColor:"#10b981"}]};if(a.value==="variance")return{labels:l,datasets:[{label:"Variance",data:l.map(t=>s.stats.variance_per_weekday[t]),backgroundColor:"#f59e0b"}]};if(a.value==="weekly_stats"){const t=l.map(p=>s.stats.mean_per_weekday[p]),h=l.map(p=>Math.sqrt(s.stats.variance_per_weekday[p])),w=t.map((p,C)=>p+h[C]),f=t.map((p,C)=>Math.max(0,p-h[C]));return{labels:l,datasets:[{label:"Mean",data:t,borderColor:"#3b82f6",backgroundColor:"rgba(59, 130, 246, 0.5)",tension:.1,pointRadius:4,pointBackgroundColor:"#3b82f6"},{label:"Std. Deviation Range",data:w,borderColor:"transparent",backgroundColor:"rgba(59, 130, 246, 0.15)",pointRadius:0,fill:"+1"},{label:"Lower Bound",data:f,borderColor:"transparent",backgroundColor:"transparent",pointRadius:0,showInLegend:!1}]}}return{labels:[],datasets:[]}});function v(){if(i.value&&i.value.chart){const l=document.createElement("a");l.href=i.value.chart.toBase64Image("image/png",1),l.download=`lollms_global_stats_${a.value}.png`,l.click()}else o.addNotification("Could not export chart image.","error")}function m(){if(!s.stats){o.addNotification("No data to export.","warning");return}let l="data:text/csv;charset=utf-8,",t=[];if(a.value==="daily")t.push(["date","generation_count"]),s.stats.generations_per_day.forEach(f=>{t.push([f.date,f.count])});else if(a.value==="weekly_stats")t.push(["weekday","mean","variance","std_deviation"]),["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"].forEach(p=>{const C=s.stats.mean_per_weekday[p],B=s.stats.variance_per_weekday[p],Z=Math.sqrt(B);t.push([p,C,B,Z])});else{t.push(["weekday",a.value]);const f=a.value==="mean"?s.stats.mean_per_weekday:s.stats.variance_per_weekday;Object.entries(f).forEach(([p,C])=>{t.push([p,C])})}l+=t.map(f=>f.join(",")).join(`
`);const h=encodeURI(l),w=document.createElement("a");w.setAttribute("href",h),w.setAttribute("download",`lollms_global_stats_${a.value}.csv`),document.body.appendChild(w),w.click(),document.body.removeChild(w)}return(l,t)=>(n(),r("div",re,[t[8]||(t[8]=e("h3",{class:"text-xl font-semibold leading-6 text-gray-900 dark:text-white"}," Global Usage Statistics ",-1)),e("div",ie,[e("div",de,[e("div",ce,[e("button",{onClick:t[0]||(t[0]=h=>a.value="daily"),type:"button",class:$(["btn-group",{active:a.value==="daily"}])},"Daily",2),e("button",{onClick:t[1]||(t[1]=h=>a.value="weekly_stats"),type:"button",class:$(["btn-group",{active:a.value==="weekly_stats"}])},"Weekly Stats",2),e("button",{onClick:t[2]||(t[2]=h=>a.value="mean"),type:"button",class:$(["btn-group",{active:a.value==="mean"}])},"Mean",2),e("button",{onClick:t[3]||(t[3]=h=>a.value="variance"),type:"button",class:$(["btn-group",{active:a.value==="variance"}])},"Variance",2)]),e("div",ue,[e("button",{onClick:v,class:"btn btn-secondary btn-sm",title:"Export as PNG"},[g(N,{class:"w-4 h-4 mr-1"}),t[4]||(t[4]=S(" PNG "))]),e("button",{onClick:m,class:"btn btn-secondary btn-sm",title:"Export as CSV"},[g(N,{class:"w-4 h-4 mr-1"}),t[5]||(t[5]=S(" CSV "))])])]),e("div",pe,[x.isLoading?(n(),r("div",ge,t[6]||(t[6]=[e("p",{class:"text-gray-500"},"Loading chart data...",-1)]))):x.stats?(n(),r("div",me,[(n(),D(Q(u.value),{data:c.value,options:_.value,ref_key:"chartRef",ref:i},null,8,["data","options"]))])):(n(),r("div",ve,t[7]||(t[7]=[e("p",{class:"text-gray-500"},"Could not load statistics.",-1)])))])])]))}},ye=L(be,[["__scopeId","data-v-a10fe633"]]),_e={class:"bg-white dark:bg-gray-800 p-6 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700 h-96 flex flex-col"},fe={class:"flex-grow relative"},he={key:0,class:"absolute inset-0 flex items-center justify-center"},ke={key:1,class:"absolute inset-0 flex items-center justify-center"},xe={__name:"ModelUsageChart",setup(x){j.register(I,V,E,P,F,O);const s=T(),{modelUsageStats:o,isLoadingModelUsageStats:a}=z(s);W(()=>{s.fetchModelUsageStats()});const i=k(()=>{const _=Array.isArray(o.value)?o.value:[],d=_.map(v=>v.model_name),c=_.map(v=>v.count);return{labels:d,datasets:[{label:"Users Assigned",backgroundColor:"#3B82F6",borderRadius:6,data:c}]}}),u={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{mode:"index",intersect:!1}},scales:{y:{beginAtZero:!0,grid:{color:"#374151"},ticks:{stepSize:1,color:"#9CA3AF"}},x:{grid:{display:!1},ticks:{color:"#9CA3AF"}}}};return(_,d)=>(n(),r("div",_e,[d[2]||(d[2]=e("h3",{class:"text-lg font-semibold text-gray-900 dark:text-white mb-4"},"Default Model Distribution",-1)),e("div",fe,[b(a)?(n(),r("div",he,d[0]||(d[0]=[e("p",{class:"text-gray-500"},"Loading stats...",-1)]))):!b(o)||b(o).length===0?(n(),r("div",ke,d[1]||(d[1]=[e("p",{class:"text-gray-500"},"No data available.",-1)]))):(n(),D(b(q),{key:2,data:i.value,options:u},null,8,["data"]))])]))}},we={key:0,class:"text-center p-6 text-gray-500"},Ce={key:1,class:"space-y-4"},$e={class:"flex justify-between items-center bg-blue-50 dark:bg-blue-900/20 p-3 rounded-lg"},Se={class:"text-sm font-medium text-blue-800 dark:text-blue-200"},Ae=["disabled"],Me={class:"divide-y divide-gray-200 dark:divide-gray-700 max-h-96 overflow-y-auto"},De={class:"flex items-center"},Ue={class:"ml-3"},Te={class:"text-sm font-medium text-gray-900 dark:text-white"},Le={class:"text-xs text-gray-500"},Ge={class:"text-xs text-gray-400"},Be=["onClick"],Ne={__name:"PendingUsersModal",setup(x){const s=G(),o=T(),a=k(()=>o.allUsers),i=k(()=>a.value.filter(c=>!c.is_active)),u=A(!1);async function _(c){try{await o.activateUser(c.id)}catch{s.addNotification("Failed to activate user","error")}}async function d(){u.value=!0;try{for(const c of i.value)await o.activateUser(c.id);s.closeModal("pendingUsers")}finally{u.value=!1}}return(c,v)=>(n(),D(le,{"modal-name":"pendingUsers",title:"Pending User Approvals"},{body:R(()=>[i.value.length===0?(n(),r("div",we," No pending users found. ")):(n(),r("div",Ce,[e("div",$e,[e("span",Se,y(i.value.length)+" users waiting.",1),e("button",{onClick:d,class:"btn btn-primary btn-sm",disabled:u.value},y(u.value?"Activating...":"Activate All"),9,Ae)]),e("ul",Me,[(n(!0),r(ee,null,te(i.value,m=>(n(),r("li",{key:m.id,class:"py-3 flex items-center justify-between"},[e("div",De,[g(ae,{icon:m.icon,username:m.username,"size-class":"h-10 w-10"},null,8,["icon","username"]),e("div",Ue,[e("p",Te,y(m.username),1),e("p",Le,y(m.email||"No email"),1),e("p",Ge,"Registered: "+y(new Date(m.created_at).toLocaleDateString()),1)])]),e("button",{onClick:l=>_(m),class:"btn-icon text-green-600 hover:bg-green-50 dark:hover:bg-green-900/20",title:"Approve"},[g(H,{class:"w-6 h-6"})],8,Be)]))),128))])]))]),footer:R(()=>[e("button",{onClick:v[0]||(v[0]=m=>b(s).closeModal("pendingUsers")),class:"btn btn-secondary"},"Close")]),_:1}))}},Re={},je={class:"w-5 h-5 fill-current"};function Ie(x,s){return n(),r("div",je,s[0]||(s[0]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},[e("path",{d:"M12 17a2 2 0 1 0 0-4 2 2 0 0 0 0 4zm6-7h-1V7a5 5 0 0 0-10 0v3H6a2 2 0 0 0-2 2v7a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-7a2 2 0 0 0-2-2zm-7-3a3 3 0 0 1 6 0v3H11V7zm7 12H6v-7h12v7z"})],-1)]))}const Ve=L(Re,[["render",Ie]]),Ee={class:"space-y-8 animate-fade-in p-2"},Pe={class:"flex flex-col md:flex-row md:items-center justify-between gap-4"},Fe={key:0,class:"flex items-center gap-4 mt-1 text-sm text-gray-500 dark:text-gray-400"},Oe={class:"flex items-center gap-1"},ze={key:0,class:"flex items-center gap-1 text-green-600 dark:text-green-400"},We={key:1,class:"flex items-center gap-1 text-yellow-600 dark:text-yellow-400"},He=["disabled"],qe={key:0,class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6"},Ze={class:"metric-card"},Ke={class:"metric-value"},Xe={class:"metric-icon bg-blue-100 dark:bg-blue-900/30 text-blue-600"},Ye={class:"metric-value"},Je={class:"metric-icon bg-orange-100 dark:bg-orange-900/30 text-orange-600"},Qe={key:0,class:"absolute top-0 right-0 -mt-1 -mr-1 flex h-3 w-3"},et={class:"metric-card"},tt={class:"metric-value"},at={class:"metric-icon bg-green-100 dark:bg-green-900/30 text-green-600"},st={class:"metric-card"},nt={class:"metric-value"},ot={class:"metric-icon bg-purple-100 dark:bg-purple-900/30 text-purple-600"},lt={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},rt={__name:"Dashboard",setup(x){const s=A(null),o=A(!0),a=G(),i=T(),{serverInfo:u,globalGenerationStats:_,isLoadingGlobalGenerationStats:d}=z(i),c=k(()=>{var l;return((l=s.value)==null?void 0:l.pending_approval)||0});async function v(){o.value=!0;try{await Promise.all([i.fetchDashboardStats(),i.fetchServerInfo(),i.fetchGlobalGenerationStats()]),s.value=i.dashboardStats}finally{o.value=!1}}function m(){c.value>0&&a.openModal("pendingUsers")}return W(v),(l,t)=>(n(),r("div",Ee,[e("div",Pe,[e("div",null,[t[2]||(t[2]=e("h2",{class:"text-2xl font-bold text-gray-900 dark:text-white"},"System Dashboard",-1)),b(u)?(n(),r("div",Fe,[e("span",Oe,[e("span",{class:$(["w-2 h-2 rounded-full",b(u).https_enabled?"bg-green-500":"bg-yellow-500"])},null,2),S(" "+y(b(u).url),1)]),b(u).https_enabled?(n(),r("span",ze,[g(se,{class:"w-3 h-3"}),t[0]||(t[0]=S(" HTTPS Active"))])):(n(),r("span",We,[g(Ve,{class:"w-3 h-3"}),t[1]||(t[1]=S(" HTTP Only"))]))])):M("",!0)]),e("button",{onClick:v,class:"btn btn-secondary btn-sm",disabled:o.value},[g(ne,{class:$(["w-4 h-4 mr-2",{"animate-spin":o.value}])},null,8,["class"]),t[3]||(t[3]=S(" Refresh "))],8,He)]),s.value?(n(),r("div",qe,[e("div",Ze,[e("div",null,[t[4]||(t[4]=e("p",{class:"metric-label"},"Total Users",-1)),e("p",Ke,y(s.value.total_users),1)]),e("div",Xe,[g(U,{class:"w-6 h-6"})])]),e("div",{class:"metric-card cursor-pointer hover:ring-2 ring-orange-400 transition-all",onClick:m,title:"Click to manage pending users"},[e("div",null,[t[5]||(t[5]=e("p",{class:"metric-label"},"Pending Approval",-1)),e("p",Ye,y(c.value),1)]),e("div",Je,[g(U,{class:"w-6 h-6"}),c.value>0?(n(),r("span",Qe,t[6]||(t[6]=[e("span",{class:"animate-ping absolute inline-flex h-full w-full rounded-full bg-orange-400 opacity-75"},null,-1),e("span",{class:"relative inline-flex rounded-full h-3 w-3 bg-orange-500"},null,-1)]))):M("",!0)])]),e("div",et,[e("div",null,[t[7]||(t[7]=e("p",{class:"metric-label"},"Active (24h)",-1)),e("p",tt,y(s.value.active_users_24h),1)]),e("div",at,[g(H,{class:"w-6 h-6"})])]),e("div",st,[e("div",null,[t[8]||(t[8]=e("p",{class:"metric-label"},"New (7d)",-1)),e("p",nt,y(s.value.new_users_7d),1)]),e("div",ot,[g(U,{class:"w-6 h-6"})])])])):M("",!0),e("div",lt,[g(ye,{stats:b(_),"is-loading":b(d)},null,8,["stats","is-loading"]),g(xe)]),b(a).activeModal==="pendingUsers"?(n(),D(Ne,{key:1})):M("",!0)]))}},pt=L(rt,[["__scopeId","data-v-5953935a"]]);export{pt as default};
