const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["ui_assets/InteractiveGraphViewer-6kLWy5oM.js","ui_assets/index-CpNEmBDf.js","ui_assets/index-wpwugJHo.css","ui_assets/InteractiveGraphViewer-CoD_Cgx1.css"])))=>i.map(i=>d[i]);
import{ad as de,u as ie,i as ue,aa as ce,an as W,N as u,m as j,l as ge,e as n,o as s,b as t,g as b,t as d,h as w,aj as pe,f as y,co as fe,W as P,ap as F,F as M,r as O,d as U,aG as me,a5 as be,cp as ve,aq as he,ax as ye,K as xe,ak as ke,aB as we,a as _e,at as Ne,a6 as Se,s as De,H as Ge}from"./index-CpNEmBDf.js";const Ce={class:"h-full flex flex-col lg:flex-row gap-6"},Ie={class:"w-full lg:w-96 lg:flex-shrink-0 space-y-6 h-full overflow-y-auto custom-scrollbar pr-4"},Ee={class:"grid grid-cols-2 gap-4"},Pe={class:"bg-gray-50 dark:bg-gray-700/50 rounded-lg p-3 text-center border dark:border-gray-600"},Me={key:0,class:"text-xl font-bold animate-pulse"},Oe={key:1,class:"text-xl font-bold"},Le={class:"bg-gray-50 dark:bg-gray-700/50 rounded-lg p-3 text-center border dark:border-gray-600"},je={key:0,class:"text-xl font-bold animate-pulse"},Fe={key:1,class:"text-xl font-bold"},Ae={key:0,class:"p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-100 dark:border-blue-800"},Te={class:"font-semibold text-blue-800 dark:text-blue-200 text-sm flex justify-between"},Re={class:"text-xs opacity-75"},Ve={class:"text-xs text-blue-700 dark:text-blue-300 mt-1"},We={class:"w-full bg-blue-200 dark:bg-blue-800 rounded-full h-1.5 mt-2"},Ue={key:1,class:"p-4 bg-white dark:bg-gray-800 rounded-lg shadow-sm border dark:border-gray-700 space-y-3"},ze={class:"flex justify-between items-start"},qe={class:"font-semibold text-lg"},Be={class:"px-2 py-0.5 rounded-full bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 text-xs"},Je={class:"text-xs text-gray-500 font-mono"},Ke={class:"bg-gray-50 dark:bg-gray-900 p-2 rounded max-h-40 overflow-auto custom-scrollbar"},$e={class:"text-xs text-gray-700 dark:text-gray-300 whitespace-pre-wrap"},Qe={key:2,class:"p-4 bg-white dark:bg-gray-800 rounded-lg shadow-sm border dark:border-gray-700 space-y-3"},He={class:"flex items-center justify-between text-sm"},Ye={class:"font-medium"},Xe={class:"text-xs text-gray-500 space-y-1"},Ze={class:"space-y-4 p-4 bg-white dark:bg-gray-800 rounded-lg shadow-sm border dark:border-gray-700"},et={key:0,class:"flex gap-2"},tt=["disabled"],at=["disabled"],ot={key:1,class:"dark:border-gray-700"},st={class:"space-y-2"},lt=["label"],nt=["value"],rt={class:"flex justify-between items-center mb-1"},dt={class:"flex items-center gap-2"},it={class:"flex gap-2 mb-2"},ut=["value"],ct={class:"h-48 border rounded-md overflow-hidden border-gray-300 dark:border-gray-600"},gt={class:"grid grid-cols-2 gap-3 pt-2"},pt=["disabled"],ft=["disabled"],mt={class:"pt-2"},bt=["disabled"],vt={key:3,class:"space-y-4 p-4 bg-white dark:bg-gray-800 rounded-lg shadow-sm border dark:border-gray-700"},ht=["disabled"],yt={key:0,class:"flex justify-center p-4"},xt={key:1,class:"space-y-2 max-h-60 overflow-y-auto custom-scrollbar bg-gray-50 dark:bg-gray-900 p-2 rounded-md"},kt={class:"whitespace-pre-wrap font-sans"},wt={key:2,class:"text-center text-gray-500 text-xs italic"},_t={class:"flex-grow h-[500px] lg:h-full lg:min-h-0 bg-white dark:bg-gray-900 rounded-lg shadow-inner border dark:border-gray-700 p-1 relative"},Nt={key:0,class:"absolute inset-0 flex flex-col items-center justify-center bg-gray-50/80 dark:bg-gray-900/80 z-10 p-6 text-center"},St={class:"bg-white dark:bg-gray-800 p-8 rounded-xl shadow-lg border dark:border-gray-700 max-w-md"},Dt={class:"w-16 h-16 bg-blue-100 dark:bg-blue-900/50 rounded-full flex items-center justify-center mx-auto mb-4 text-blue-600 dark:text-blue-400"},Gt=["disabled"],Ct={key:0,class:"text-xs text-red-500 mt-2"},z=`{
  "entities": [
    {"name": "Person", "description": "Key individuals mentioned in the text"},
    {"name": "Organization", "description": "Companies, institutions, or groups"},
    {"name": "Location", "description": "Cities, countries, or physical places"},
    {"name": "Date", "description": "Specific points in time or durations"},
    {"name": "Concept", "description": "Abstract ideas, theories, or methodologies"},
    {"name": "Technology", "description": "Software, hardware, or tools"}
  ],
  "relationships": [
    {"source": "Person", "target": "Organization", "label": "WORKS_FOR"},
    {"source": "Person", "target": "Location", "label": "LOCATED_IN"},
    {"source": "Organization", "target": "Location", "label": "HEADQUARTERED_IN"},
    {"source": "Person", "target": "Person", "label": "KNOWS"},
    {"source": "Organization", "target": "Product", "label": "PRODUCES"},
    {"source": "Concept", "target": "Concept", "label": "RELATES_TO"}
  ]
}`,Et={__name:"DataStoreGraphManager",props:{store:{type:Object,required:!0},task:{type:Object,default:null}},setup(g){const q=De({loader:()=>Ge(()=>import("./InteractiveGraphViewer-6kLWy5oM.js"),__vite__mapDeps([0,1,2,3])),loadingComponent:null,delay:200,errorComponent:null,timeout:3e3}),p=g,c=de(),l=ie(),B=ue();ce();const{user:A}=W(B),{availableLLMModelsGrouped:T}=W(c),L=u(null),f=u({nodes:0,edges:0}),C=u({nodes:[],edges:[]}),x=u(!1),I=u(null),i=u({model_binding:"",model_name:"",chunk_size:2048,overlap_size:256,ontology:z}),_=u(""),N=u(""),E=u([]),D=u(!1),r=u(null),m=u(null),v=u("json"),G=u([]),S=u(null);j(_,o=>{if(o){const[e,...a]=o.split("/");i.value.model_binding=e,i.value.model_name=a.join("/")}else i.value.model_binding="",i.value.model_name=""});async function h(){var o,e;x.value=!0,r.value=null,m.value=null;try{const a=await c.fetchDataStoreGraph(p.store.id);C.value=a||{nodes:[],edges:[]},f.value={nodes:((o=a==null?void 0:a.nodes)==null?void 0:o.length)||0,edges:((e=a==null?void 0:a.edges)==null?void 0:e.length)||0}}catch(a){console.error("Failed to fetch graph:",a),C.value={nodes:[],edges:[]},f.value={nodes:0,edges:0}}finally{x.value=!1}}function R(){if(!i.value.model_binding||!i.value.model_name){l.addNotification("Please select a model for generation.","warning");return}c.generateDataStoreGraph({storeId:p.store.id,graphData:i.value})}function J(){if(!i.value.model_binding||!i.value.model_name){l.addNotification("Please select a model for update.","warning");return}c.updateDataStoreGraph({storeId:p.store.id,graphData:i.value})}async function K(){if((await l.showConfirmation({title:"Wipe Knowledge Graph?",message:"This will permanently delete all nodes and edges from this datastore's graph. This action cannot be undone.",confirmText:"Wipe Graph"})).confirmed)try{await c.wipeDataStoreGraph(p.store.id),h(),l.addNotification("Graph wiped successfully","success")}catch{l.addNotification("Failed to wipe graph","error")}}async function $(){if(N.value.trim()){D.value=!0;try{E.value=await c.queryDataStoreGraph({storeId:p.store.id,query:N.value,max_k:10})}finally{D.value=!1}}}function Q(o){r.value=o,m.value=null}function H(o){m.value=o,r.value=null}function Y(){r.value=null,m.value=null}function X(){l.openModal("NodeEditModal",{onConfirm:async o=>{try{await c.addGraphNode({storeId:p.store.id,nodeData:o}),l.addNotification("Node added successfully","success"),h()}catch(e){l.addNotification("Failed to add node","error"),console.error(e)}}})}function Z(){var o;l.openModal("EdgeEditModal",{sourceId:((o=r.value)==null?void 0:o.id)||"",onConfirm:async e=>{try{await c.addGraphEdge({storeId:p.store.id,edgeData:e}),l.addNotification("Edge added successfully","success"),h()}catch(a){l.addNotification("Failed to add edge","error"),console.error(a)}}})}function ee(){r.value&&l.openModal("NodeEditModal",{node:r.value,onConfirm:async o=>{try{await c.updateGraphNode({storeId:p.store.id,nodeId:r.value.id,nodeData:o}),l.addNotification("Node updated successfully","success"),h()}catch(e){l.addNotification("Failed to update node","error"),console.error(e)}}})}async function te(){if(!r.value)return;const{confirmed:o}=await l.showConfirmation({title:"Delete Node?",message:`Delete node "${r.value.label}" (ID: ${r.value.id})? This will also delete connected edges.`});if(o)try{await c.deleteGraphNode({storeId:p.store.id,nodeId:r.value.id}),l.addNotification("Node deleted","success"),h()}catch{l.addNotification("Failed to delete node","error")}}async function ae(){if(!m.value)return;const{confirmed:o}=await l.showConfirmation({title:"Delete Edge?",message:`Delete edge "${m.value.label}"?`});if(o)try{await c.deleteGraphEdge({storeId:p.store.id,edgeId:m.value.id}),l.addNotification("Edge deleted","success"),h()}catch{l.addNotification("Failed to delete edge","error")}}function oe(){I.value.click()}async function se(o){const e=o.target.files[0];if(e){l.addNotification("Importing ontology file...","info");try{const a=await c.extractTextFromFile(e);i.value.ontology=a,e.name.endsWith(".json")?v.value="json":e.name.endsWith(".yaml")||e.name.endsWith(".yml")?v.value="yaml":e.name.endsWith(".xml")||e.name.endsWith(".owl")||e.name.endsWith(".rdf")?v.value="xml":e.name.endsWith(".ttl")?v.value="python":v.value="markdown",l.addNotification("Ontology file imported successfully.","success")}catch(a){console.error("Ontology import failed:",a)}finally{I.value&&(I.value.value="")}}}function le(){L.value&&L.value.resetView()}function V(){const o=[{name:"Default (JSON)",language:"json",content:z},{name:"Simple (YAML)",language:"yaml",content:`entities:
  - Person
  - Place
relationships:
  - visited`},{name:"OWL/RDF (Turtle)",language:"python",content:`@prefix : <http://example.org/> .
:Person a :Class .
:knows a :ObjectProperty .`},{name:"Free Text (Markdown)",language:"markdown",content:`Define Entities:
- Person
- Location

Define Relations:
- Person lives in Location`}];try{const e=JSON.parse(localStorage.getItem("lollms_graph_presets")||"[]");G.value=[...o,...e]}catch{G.value=o}}function ne(){S.value&&(i.value.ontology=S.value.content,v.value=S.value.language||"json")}async function re(){const o=prompt("Enter a name for this ontology preset:");if(o){const e={name:o,language:v.value,content:i.value.ontology};try{const a=JSON.parse(localStorage.getItem("lollms_graph_presets")||"[]");a.push(e),localStorage.setItem("lollms_graph_presets",JSON.stringify(a)),V(),S.value=G.value[G.value.length-1],l.addNotification("Preset saved","success")}catch(a){console.error(a),l.addNotification("Failed to save preset","error")}}}return ge(()=>{var o;h(),V(),(o=A.value)!=null&&o.lollms_model_name&&(_.value=A.value.lollms_model_name),T.value.length===0&&c.fetchAvailableLollmsModels()}),j(()=>p.store.id,h),j(()=>p.task,(o,e)=>{e&&(e.status==="running"||e.status==="pending")&&!o&&h()}),(o,e)=>(s(),n("div",Ce,[t("div",Ie,[t("div",Ee,[t("div",Pe,[e[5]||(e[5]=t("h4",{class:"text-xs font-medium text-gray-500 dark:text-gray-400"},"Nodes",-1)),x.value?(s(),n("p",Me,"...")):(s(),n("p",Oe,d(f.value.nodes),1))]),t("div",Le,[e[6]||(e[6]=t("h4",{class:"text-xs font-medium text-gray-500 dark:text-gray-400"},"Edges",-1)),x.value?(s(),n("p",je,"...")):(s(),n("p",Fe,d(f.value.edges),1))])]),g.task?(s(),n("div",Ae,[t("h4",Te,[w(d(g.task.name)+" ",1),t("span",Re,d(g.task.progress)+"%",1)]),t("p",Ve,d(g.task.description),1),t("div",We,[t("div",{class:"bg-blue-600 dark:bg-blue-400 h-1.5 rounded-full transition-all duration-500",style:pe({width:g.task.progress+"%"})},null,4)])])):b("",!0),r.value?(s(),n("div",Ue,[t("div",ze,[t("h3",qe,d(r.value.label),1),t("span",Be,d(r.value.group),1)]),t("div",Je,"ID: "+d(r.value.id),1),t("div",Ke,[t("pre",$e,d(JSON.stringify(r.value.properties,null,2)),1)]),t("div",{class:"flex gap-2 pt-2"},[t("button",{onClick:ee,class:"btn btn-secondary btn-sm flex-1"},"Edit Properties"),t("button",{onClick:te,class:"btn btn-danger btn-sm flex-1"},"Delete")])])):b("",!0),m.value?(s(),n("div",Qe,[e[9]||(e[9]=t("h3",{class:"font-semibold text-lg border-b pb-2 dark:border-gray-700"},"Relationship",-1)),t("div",He,[t("span",Ye,d(m.value.label),1)]),t("div",Xe,[t("div",null,[e[7]||(e[7]=t("span",{class:"font-semibold"},"Source:",-1)),w(" "+d(m.value.source),1)]),t("div",null,[e[8]||(e[8]=t("span",{class:"font-semibold"},"Target:",-1)),w(" "+d(m.value.target),1)])]),t("div",{class:"flex gap-2 pt-2"},[t("button",{onClick:ae,class:"btn btn-danger btn-sm w-full"},"Delete Relationship")])])):b("",!0),t("div",Ze,[e[17]||(e[17]=t("h3",{class:"text-base font-semibold flex items-center gap-2"},[t("span",{class:"w-1 h-4 bg-primary-500 rounded-full"}),w(" Graph Actions ")],-1)),f.value.nodes>0?(s(),n("div",et,[t("button",{onClick:X,disabled:!!g.task,class:"btn btn-secondary btn-sm flex-1"},"Add Node",8,tt),t("button",{onClick:Z,disabled:!!g.task,class:"btn btn-secondary btn-sm flex-1"},"Add Edge",8,at),t("button",{onClick:le,class:"btn btn-ghost btn-sm px-2",title:"Fit Graph"},[y(fe,{class:"w-4 h-4"})])])):b("",!0),f.value.nodes>0?(s(),n("hr",ot)):b("",!0),t("div",st,[t("div",null,[e[11]||(e[11]=t("label",{for:"model-select",class:"block text-xs font-bold uppercase tracking-wider text-gray-500 mb-1"},"LLM Model",-1)),P(t("select",{id:"model-select","onUpdate:modelValue":e[0]||(e[0]=a=>_.value=a),class:"input-field text-sm"},[e[10]||(e[10]=t("option",{disabled:"",value:""},"Select a model",-1)),(s(!0),n(M,null,O(U(T),a=>(s(),n("optgroup",{key:a.label,label:a.label},[(s(!0),n(M,null,O(a.items,k=>(s(),n("option",{key:k.id,value:k.id},d(k.name),9,nt))),128))],8,lt))),128))],512),[[F,_.value]])]),t("div",null,[t("div",rt,[e[12]||(e[12]=t("label",{class:"block text-xs font-bold uppercase tracking-wider text-gray-500"},"Ontology Schema",-1)),t("div",dt,[t("button",{type:"button",onClick:oe,class:"text-xs text-primary-600 hover:text-primary-700 flex items-center gap-1",title:"Import File"},[y(me,{class:"w-3 h-3"})]),t("button",{type:"button",onClick:re,class:"text-xs text-primary-600 hover:text-primary-700 flex items-center gap-1",title:"Save as Preset"},[y(be,{class:"w-3 h-3"})])])]),t("div",it,[P(t("select",{"onUpdate:modelValue":e[1]||(e[1]=a=>S.value=a),onChange:ne,class:"input-field text-xs py-1"},[e[13]||(e[13]=t("option",{value:null,disabled:""},"Load Preset...",-1)),(s(!0),n(M,null,O(G.value,(a,k)=>(s(),n("option",{key:k,value:a},d(a.name),9,ut))),128))],544),[[F,S.value]]),P(t("select",{"onUpdate:modelValue":e[2]||(e[2]=a=>v.value=a),class:"input-field text-xs py-1 w-24"},e[14]||(e[14]=[ve('<option value="json">JSON</option><option value="yaml">YAML</option><option value="xml">XML</option><option value="markdown">MD</option><option value="python">Code</option>',5)]),512),[[F,v.value]])]),t("div",ct,[y(he,{modelValue:i.value.ontology,"onUpdate:modelValue":e[3]||(e[3]=a=>i.value.ontology=a),language:v.value,class:"h-full w-full text-xs"},null,8,["modelValue","language"])]),t("input",{type:"file",ref_key:"ontologyFileInput",ref:I,onChange:se,class:"hidden",accept:".owl,.rdf,.ttl,.jsonld,.pdf,.docx,.txt,.md,.json,.yaml,.yml,.xml"},null,544),e[15]||(e[15]=t("p",{class:"text-[10px] text-gray-400 mt-1"},"Defines the structure for the LLM to extract knowledge.",-1))])]),t("div",gt,[t("button",{onClick:R,disabled:!!g.task,class:"btn btn-primary btn-sm"},d(f.value.nodes>0?"Re-Generate":"Generate Graph"),9,pt),t("button",{onClick:J,disabled:!!g.task||f.value.nodes===0,class:"btn btn-secondary btn-sm"}," Update Graph ",8,ft)]),t("div",mt,[t("button",{onClick:K,disabled:!!g.task||f.value.nodes===0,class:"btn btn-ghost text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 w-full btn-sm flex items-center justify-center gap-2"},[y(ye,{class:"w-4 h-4"}),e[16]||(e[16]=w(" Wipe All Data "))],8,bt)])]),f.value.nodes>0?(s(),n("div",vt,[e[18]||(e[18]=t("h3",{class:"text-base font-semibold flex items-center gap-2"},[t("span",{class:"w-1 h-4 bg-green-500 rounded-full"}),w(" Query Graph ")],-1)),t("form",{onSubmit:xe($,["prevent"]),class:"flex gap-2"},[P(t("input",{"onUpdate:modelValue":e[4]||(e[4]=a=>N.value=a),type:"text",placeholder:"Search for concepts...",class:"input-field flex-grow text-sm"},null,512),[[ke,N.value]]),t("button",{type:"submit",disabled:D.value||!N.value.trim(),class:"btn btn-primary btn-sm px-4"},"Find",8,ht)],32),D.value?(s(),n("div",yt,[y(we,{class:"w-6 h-6 text-primary-500"})])):b("",!0),E.value.length>0?(s(),n("div",xt,[(s(!0),n(M,null,O(E.value,(a,k)=>(s(),n("div",{key:k,class:"p-2 bg-white dark:bg-gray-800 rounded border dark:border-gray-700 text-xs shadow-sm"},[t("pre",kt,d(a),1)]))),128))])):!D.value&&N.value&&E.value.length===0?(s(),n("div",wt," No results found. ")):b("",!0)])):b("",!0)]),t("div",_t,[f.value.nodes===0&&!x.value?(s(),n("div",Nt,[t("div",St,[t("div",Dt,[y(Ne,{class:"w-8 h-8"})]),e[20]||(e[20]=t("h3",{class:"text-xl font-bold text-gray-900 dark:text-white mb-2"},"No Graph Built",-1)),e[21]||(e[21]=t("p",{class:"text-gray-500 dark:text-gray-400 text-sm mb-6"},` This Data Store doesn't have a knowledge graph yet. Select a model and ontology schema on the left, then click "Generate Graph" to build one from your documents. `,-1)),t("button",{onClick:R,disabled:!!g.task||!_.value,class:"btn btn-primary w-full flex items-center justify-center gap-2"},[y(Se,{class:"w-5 h-5"}),e[19]||(e[19]=w(" Generate Graph "))],8,Gt),_.value?b("",!0):(s(),n("p",Ct,"Please select an LLM Model first."))])])):b("",!0),f.value.nodes>0||x.value?(s(),_e(U(q),{key:1,ref_key:"graphViewer",ref:L,nodes:C.value.nodes,edges:C.value.edges,"is-loading":x.value,onNodeSelect:Q,onEdgeSelect:H,onDeselect:Y},null,8,["nodes","edges","is-loading"])):b("",!0)])]))}};export{Et as default};
