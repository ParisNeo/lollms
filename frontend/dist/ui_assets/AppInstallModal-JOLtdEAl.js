import{u as T,c as k,L as u,m as P,a as f,o as n,w as N,b as t,d as L,g as y,h,aE as A,t as g,e as x,K as U,a0 as w,an as M,n as _,aF as $,aG as B,as as q}from"./index-Htkm6tp6.js";import{u as D}from"./admin-BqVfPfYE.js";import{_ as O}from"./GenericModal-Kg280xj0.js";const R={class:"text-sm text-gray-600 dark:text-gray-300"},j={class:"font-semibold text-gray-900 dark:text-white"},E={class:"mt-1 flex gap-2"},Z=["disabled"],z={key:1},F={class:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg"},G={class:"pt-4 mt-4 border-t dark:border-gray-600"},K={key:0,class:"mt-4"},H={class:"flex justify-end gap-3"},J=["disabled"],ee={__name:"AppInstallModal",setup(Q){const d=T(),m=D(),S=k(()=>d.modalData("appInstall")),o=k(()=>{var a;return(a=S.value)==null?void 0:a.app}),C=k(()=>{var a;return(a=S.value)==null?void 0:a.type}),s=u(null),p=u(!1),r=u("none"),b=u(""),v=u(!1),c=u(!1),l=u("unchecked");P(o,async a=>{if(a){s.value=null,l.value="unchecked",p.value=a.autostart??!1,r.value=a.authentication_type||"none",b.value=a.sso_redirect_uri||"",v.value=!1,c.value=!0;try{const e=await m.fetchNextAvailablePort();s.value=e,l.value="available"}catch{s.value=9601}finally{c.value=!1}}}),P(s,()=>{l.value="unchecked"});async function V(){if(!s.value){d.addNotification("Please enter a port number.","warning");return}c.value=!0;try{await m.fetchNextAvailablePort(s.value)===s.value?l.value="available":l.value="unavailable"}catch{l.value="unavailable"}finally{c.value=!1}}async function I(){if(!o.value)return;if(l.value!=="available"){d.addNotification("Please verify an available port before installing.","warning");return}v.value=!0;const a={repository:o.value.repository,folder_name:o.value.folder_name,port:s.value,autostart:p.value,authentication_type:r.value,sso_redirect_uri:r.value==="lollms_sso"?b.value:null};try{C.value==="mcps"?await m.installZooMcp(a):await m.installZooApp(a),r.value==="lollms_sso"&&d.addNotification("SSO enabled for new app. A server reboot is required for it to work correctly.","warning",15e3),d.closeModal("appInstall")}catch{}finally{v.value=!1}}return(a,e)=>(n(),f(O,{"modal-name":"appInstall",title:o.value?`Install ${C.value==="mcps"?"MCP":"App"}: ${o.value.name}`:"Install","max-width-class":"max-w-lg"},{body:N(()=>[o.value?(n(),x("form",{key:0,onSubmit:U(I,["prevent"]),class:"space-y-6"},[t("p",R,[e[5]||(e[5]=h(" Configure the installation settings for ")),t("span",j,g(o.value.name),1),e[6]||(e[6]=h(". "))]),t("div",null,[e[7]||(e[7]=t("label",{for:"app-port",class:"block text-sm font-medium"},"Port Number",-1)),t("div",E,[w(t("input",{id:"app-port","onUpdate:modelValue":e[0]||(e[0]=i=>s.value=i),type:"number",min:"1025",max:"65535",required:"",class:"input-field flex-grow",placeholder:"e.g., 9601"},null,512),[[M,s.value,void 0,{number:!0}]]),t("button",{onClick:V,type:"button",class:"btn btn-secondary w-28",disabled:c.value},[c.value?(n(),f(A,{key:0,class:"w-5 h-5 animate-spin"})):(n(),x("span",z,"Verify"))],8,Z)]),l.value!=="unchecked"?(n(),x("div",{key:0,class:_(["mt-2 text-sm flex items-center gap-1.5",l.value==="available"?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"])},[l.value==="available"?(n(),f($,{key:0,class:"w-4 h-4"})):(n(),f(B,{key:1,class:"w-4 h-4"})),t("span",null,"Port "+g(s.value)+" is "+g(l.value)+".",1)],2)):y("",!0)]),t("div",F,[e[8]||(e[8]=t("span",{class:"flex-grow flex flex-col"},[t("span",{class:"text-sm font-medium text-gray-900 dark:text-gray-100"},"Start on System Startup"),t("span",{class:"text-sm text-gray-500 dark:text-gray-400"},"Automatically launch this item when the main server starts.")],-1)),t("button",{onClick:e[1]||(e[1]=i=>p.value=!p.value),type:"button",class:_([p.value?"bg-blue-600":"bg-gray-200 dark:bg-gray-600","relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800"])},[t("span",{class:_([p.value?"translate-x-5":"translate-x-0","pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out"])},null,2)],2)]),t("div",G,[e[13]||(e[13]=t("h4",{class:"font-semibold text-lg"},"Authentication",-1)),e[14]||(e[14]=t("p",{class:"text-sm text-gray-500 dark:text-gray-400 mb-4"}," Configure how users will access this app. These settings can be changed later. ",-1)),t("div",null,[e[10]||(e[10]=t("label",{for:"install-auth-type",class:"block text-sm font-medium"},"Authentication Type",-1)),w(t("select",{id:"install-auth-type","onUpdate:modelValue":e[2]||(e[2]=i=>r.value=i),class:"input-field mt-1"},e[9]||(e[9]=[t("option",{value:"none"},"None",-1),t("option",{value:"bearer"},"Bearer Token (managed later in config)",-1),t("option",{value:"lollms_sso"},"LoLLMs SSO",-1)]),512),[[q,r.value]])]),r.value==="lollms_sso"?(n(),x("div",K,[e[11]||(e[11]=t("label",{for:"install-sso-redirect-uri",class:"block text-sm font-medium"},"Redirect URI",-1)),w(t("input",{id:"install-sso-redirect-uri","onUpdate:modelValue":e[3]||(e[3]=i=>b.value=i),type:"url",class:"input-field mt-1",placeholder:"e.g., https://myapp.com/callback"},null,512),[[M,b.value]]),e[12]||(e[12]=t("p",{class:"text-xs text-gray-500 mt-1"},"The callback URL registered with the app. A server reboot is required after enabling SSO.",-1))])):y("",!0)])],32)):y("",!0)]),footer:N(()=>[t("div",H,[t("button",{onClick:e[4]||(e[4]=i=>L(d).closeModal("appInstall")),type:"button",class:"btn btn-secondary"},"Cancel"),t("button",{onClick:I,type:"button",class:"btn btn-primary",disabled:v.value||l.value!=="available"},[v.value?(n(),f(A,{key:0,class:"w-5 h-5 mr-2 animate-spin"})):y("",!0),h(" "+g(v.value?"Installing...":"Confirm & Install"),1)],8,J)])]),_:1},8,["title"]))}};export{ee as default};
