import{a4 as ve,a7 as fe,R as Ce,u as Me,L as g,c as X,l as be,e as r,o as n,b as o,g as x,f as b,a6 as Ne,h as Q,ab as ce,t as y,aF as ye,dm as Se,aE as pe,F as C,r as N,a0 as j,ac as Z,n as P,an as ae,cG as De,cr as Ee,aq as Oe,M as Ve,P as xe,aD as Re,av as ge,m as le,i as je,ah as Le,a as se,ay as Te,a1 as Ue,K as I,aw as Pe,Y as Fe,ar as He,d as We,at as Ye,a9 as Xe}from"./index-CLx4cEXd.js";import ze from"./NodeCreatorModal-D3RFm3KO.js";import"./index-DT94rrBF.js";const Ae={class:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm p-4"},Ge={class:"bg-white dark:bg-gray-900 rounded-xl shadow-2xl w-full max-w-5xl h-[85vh] flex flex-col border dark:border-gray-700 overflow-hidden animate-in fade-in zoom-in-95 duration-200"},Je={class:"p-4 border-b dark:border-gray-700 flex justify-between items-center bg-gray-50 dark:bg-gray-800/80"},qe={class:"flex items-center gap-4"},Be={class:"text-xl font-bold text-gray-800 dark:text-gray-100 flex items-center gap-2"},Qe={class:"flex items-center gap-2 mt-0.5"},Ze={class:"text-[10px] font-black uppercase px-1.5 py-0.5 rounded bg-blue-100 dark:bg-blue-900/40 text-blue-600"},Ke={key:0,class:"text-[10px] text-gray-400 font-mono"},et={class:"flex-grow flex flex-col min-h-0 bg-gray-50 dark:bg-gray-900"},tt={key:0,class:"flex-grow overflow-y-auto p-6 space-y-6"},ot={class:"max-w-3xl mx-auto"},st={class:"flex items-center gap-3 mb-6"},at={class:"w-10 h-10 rounded-full bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center text-blue-600"},lt={key:0,class:"p-10 text-center border-2 border-dashed dark:border-gray-800 rounded-3xl"},nt={key:1,class:"grid grid-cols-1 gap-4"},rt={class:"flex justify-between items-center mb-3"},dt={class:"block text-[10px] font-black uppercase text-gray-400 tracking-widest"},it={class:"text-[9px] font-bold px-1.5 py-0.5 rounded bg-gray-100 dark:bg-gray-700 text-gray-500 uppercase"},ut=["onUpdate:modelValue"],ct=["onUpdate:modelValue","step"],pt={key:2,class:"flex items-center gap-3 py-2"},gt=["onClick"],vt={class:"text-sm font-medium"},ft=["onUpdate:modelValue"],bt={key:1,class:"flex-grow flex flex-col min-h-0"},yt={key:0,class:"px-6 py-4 bg-white dark:bg-gray-800 border-b dark:border-gray-700"},xt={class:"flex justify-between items-center mb-2"},ht={class:"text-xs font-mono text-gray-500"},mt={class:"h-1.5 w-full bg-gray-100 dark:bg-gray-700 rounded-full overflow-hidden"},wt={class:"flex-grow overflow-y-auto p-6"},kt={class:"max-w-4xl mx-auto space-y-6"},_t={key:0,class:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-2xl p-5 animate-in slide-in-from-top-2"},$t={class:"flex items-start gap-4"},It={class:"flex-grow min-w-0"},Ct={class:"mt-3 text-xs font-mono whitespace-pre-wrap overflow-x-auto bg-black/5 dark:bg-black/40 p-4 rounded-xl border dark:border-red-900/30 text-red-900 dark:text-red-300 max-h-80"},Mt={key:1,class:"grid grid-cols-1 gap-6"},Nt={class:"px-6 py-4 bg-gray-50 dark:bg-gray-800/50 border-b dark:border-gray-700 flex justify-between items-center"},St={class:"flex items-center gap-3"},Dt={class:"font-bold text-sm tracking-tight"},Et={class:"text-[10px] text-gray-400 font-mono bg-gray-100 dark:bg-gray-900 px-2 py-0.5 rounded-full"},Ot={class:"p-6"},Vt={key:0,class:"space-y-8"},Rt={class:"flex items-center gap-2 mb-3"},jt={class:"text-[9px] font-black uppercase text-gray-400 tracking-[0.2em] whitespace-nowrap"},Lt={key:0,class:"relative group/img max-w-2xl mx-auto"},Tt={class:"rounded-2xl overflow-hidden shadow-2xl border-4 border-white dark:border-gray-700 bg-gray-100 dark:bg-gray-900 ring-1 ring-black/5"},Ut=["src"],Pt={class:"absolute top-4 right-4 flex gap-2 opacity-0 group-hover/img:opacity-100 transition-opacity"},Ft=["onClick"],Ht=["onClick"],Wt={key:1,class:"prose dark:prose-invert max-w-none bg-white dark:bg-gray-900/50 p-6 rounded-2xl border dark:border-gray-700 shadow-inner"},Yt={key:2,class:"bg-gray-100 dark:bg-black/40 p-4 rounded-xl font-mono text-xs whitespace-pre-wrap border dark:border-gray-800 break-all overflow-x-auto"},Xt={key:1,class:"flex flex-col items-center py-10 text-gray-400 opacity-50"},zt={key:2,class:"flex flex-col items-center justify-center py-20 text-gray-400"},At={class:"p-4 border-t dark:border-gray-700 bg-white dark:bg-gray-800 flex justify-between items-center shrink-0"},Gt={class:"flex items-center gap-2"},Jt={class:"flex gap-3"},qt=["disabled"],Bt=["disabled"],Qt={__name:"FlowRunnerModal",props:{flowData:{type:Object,required:!0},flowId:{type:String,required:!0},flowName:{type:String,default:"Untitled Flow"}},emits:["close"],setup(L,{emit:ne}){const S=L,T=fe(),ee=Ce(),K=Me(),v=g("inputs"),p=g(!1),w=g(null),h=g(null),D=g(null),f=g({}),E=g(0),M=X(()=>{const c=S.flowData.nodes||[],d=S.flowData.edges||[],a=[];return c.forEach(u=>{(u.inputs||[]).forEach(_=>{var q;if(!d.some(V=>V.target===u.id&&V.targetHandle===_)){const V=T.nodeDefinitions.find(R=>R.name===u.type),B=V==null?void 0:V.inputs.find(R=>R.name===_),W=(B==null?void 0:B.type)||"string";if(f.value[u.id]||(f.value[u.id]={}),f.value[u.id][_]===void 0){const R=(q=u.data)==null?void 0:q[_];f.value[u.id][_]=R!==void 0?R:W==="int"||W==="float"?0:W==="boolean"?!1:""}a.push({key:`${u.id}-${_}`,nodeId:u.id,nodeLabel:u.label||u.id,inputName:_,type:W})}})}),a}),O=X(()=>{const c=S.flowData.nodes||[],d=S.flowData.edges||[];return c.filter(a=>{const u=a.outputs||[];return u.length===0?!0:!u.some(k=>d.some(_=>_.source===a.id&&_.sourceHandle===k))})});function $(c){return typeof c=="string"&&c.startsWith("data:image/")}function z(c,d){const a=T.nodeDefinitions.find(k=>k.name===c.type),u=a==null?void 0:a.outputs.find(k=>k.name.toLowerCase()===d.toLowerCase());return(u==null?void 0:u.type)||"any"}function A(c){return typeof c=="object"?JSON.stringify(c,null,2):c}async function F(){if(!p.value){p.value=!0,h.value=null,D.value=null,E.value=0,v.value="results";try{const c=await T.executeFlow(S.flowId,f.value);c!=null&&c.id&&(w.value=c.id,G(w.value))}catch(c){D.value="Failed to start workflow: "+c.message,p.value=!1}}}function G(c){const d=le(()=>ee.tasks.find(a=>a.id===c),a=>{a&&(E.value=a.progress||0,a.status==="completed"?(h.value=a.result,p.value=!1,d()):["failed","cancelled"].includes(a.status)&&(D.value=a.error||"Workflow failed.",p.value=!1,d()))},{immediate:!0,deep:!0})}function J(c){return h.value?h.value[c]:null}function te(c){K.openImageViewer({imageList:[{src:c,prompt:"Workflow Output"}],startIndex:0})}function H(c,d){const a=document.createElement("a");a.href=c,a.download=`${d}_${Date.now()}.png`,a.click()}return be(()=>{}),(c,d)=>(n(),r("div",Ae,[o("div",Ge,[o("div",Je,[o("div",qe,[v.value==="results"?(n(),r("button",{key:0,onClick:d[0]||(d[0]=a=>v.value="inputs"),class:"p-2 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-full transition-colors text-gray-500",title:"Back to Inputs"},[b(Ne,{class:"w-5 h-5"})])):x("",!0),o("div",null,[o("h3",Be,[b(ce,{class:"w-6 h-6 text-green-500"}),Q(" "+y(L.flowName),1)]),o("div",Qe,[o("span",Ze,y(v.value==="inputs"?"Step 1: Configuration":"Step 2: Execution"),1),w.value?(n(),r("span",Ke,"Task: "+y(w.value.split("-")[0]),1)):x("",!0)])])]),o("button",{onClick:d[1]||(d[1]=a=>c.$emit("close")),class:"text-gray-400 hover:text-red-500 transition-colors p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full"},[b(ye,{class:"w-6 h-6"})])]),o("div",et,[v.value==="inputs"?(n(),r("div",tt,[o("div",ot,[o("div",st,[o("div",at,[b(Se,{class:"w-6 h-6"})]),d[4]||(d[4]=o("div",null,[o("h4",{class:"font-bold text-gray-800 dark:text-white"},"Workflow Inputs"),o("p",{class:"text-xs text-gray-500"},"Configure the variables for this run.")],-1))]),M.value.length===0?(n(),r("div",lt,[b(pe,{class:"w-12 h-12 text-green-500 mx-auto mb-3 opacity-20"}),d[5]||(d[5]=o("p",{class:"text-gray-500"},"This workflow is self-contained and requires no manual inputs.",-1))])):(n(),r("div",nt,[(n(!0),r(C,null,N(M.value,a=>(n(),r("div",{key:a.key,class:"bg-white dark:bg-gray-800 p-5 rounded-2xl border dark:border-gray-700 shadow-sm transition-all focus-within:ring-2 focus-within:ring-blue-500/20"},[o("div",rt,[o("label",dt,[Q(y(a.nodeLabel)+" ",1),d[6]||(d[6]=o("span",{class:"text-gray-300 dark:text-gray-600 mx-1"},"/",-1)),Q(" "+y(a.inputName),1)]),o("span",it,y(a.type),1)]),a.type==="string"&&(f.value[a.nodeId][a.inputName].length>50||a.inputName.toLowerCase().includes("prompt"))?j((n(),r("textarea",{key:0,"onUpdate:modelValue":u=>f.value[a.nodeId][a.inputName]=u,class:"input-field w-full h-32 resize-none",placeholder:"Enter long text or prompt..."},null,8,ut)),[[Z,f.value[a.nodeId][a.inputName]]]):a.type==="int"||a.type==="float"?j((n(),r("input",{key:1,type:"number","onUpdate:modelValue":u=>f.value[a.nodeId][a.inputName]=u,class:"input-field w-full font-mono",step:a.type==="float"?"any":"1"},null,8,ct)),[[Z,f.value[a.nodeId][a.inputName],void 0,{number:!0}]]):a.type==="boolean"?(n(),r("div",pt,[o("button",{onClick:u=>f.value[a.nodeId][a.inputName]=!f.value[a.nodeId][a.inputName],class:P(["relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200",f.value[a.nodeId][a.inputName]?"bg-blue-600":"bg-gray-300 dark:bg-gray-700"])},[o("span",{class:P(["pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200",f.value[a.nodeId][a.inputName]?"translate-x-5":"translate-x-0"])},null,2)],10,gt),o("span",vt,y(f.value[a.nodeId][a.inputName]?"Enabled":"Disabled"),1)])):j((n(),r("input",{key:3,"onUpdate:modelValue":u=>f.value[a.nodeId][a.inputName]=u,class:"input-field w-full",placeholder:"Enter value..."},null,8,ft)),[[Z,f.value[a.nodeId][a.inputName]]])]))),128))]))])])):x("",!0),v.value==="results"?(n(),r("div",bt,[p.value?(n(),r("div",yt,[o("div",xt,[d[7]||(d[7]=o("span",{class:"text-xs font-bold text-blue-600 animate-pulse"},"WORKFLOW IN PROGRESS...",-1)),o("span",ht,y(E.value)+"%",1)]),o("div",mt,[o("div",{class:"h-full bg-blue-500 transition-all duration-500",style:ae({width:E.value+"%"})},null,4)])])):x("",!0),o("div",wt,[o("div",kt,[D.value?(n(),r("div",_t,[o("div",$t,[b(De,{class:"w-6 h-6 text-red-500 mt-1"}),o("div",It,[d[8]||(d[8]=o("h4",{class:"font-bold text-red-700 dark:text-red-400"},"Execution Error",-1)),o("pre",Ct,y(D.value),1),o("button",{onClick:d[2]||(d[2]=a=>v.value="inputs"),class:"mt-4 btn btn-secondary btn-sm"},"Adjust Inputs & Retry")])])])):x("",!0),h.value?(n(),r("div",Mt,[(n(!0),r(C,null,N(O.value,a=>(n(),r("div",{key:a.id,class:"bg-white dark:bg-gray-800 rounded-3xl border dark:border-gray-700 overflow-hidden shadow-sm hover:shadow-md transition-shadow"},[o("div",Nt,[o("div",St,[b(pe,{class:"w-5 h-5 text-green-500"}),o("span",Dt,y(a.label),1)]),o("span",Et,y(a.id),1)]),o("div",Ot,[J(a.id)?(n(),r("div",Vt,[(n(!0),r(C,null,N(J(a.id),(u,k)=>(n(),r("div",{key:k,class:"group"},[o("div",Rt,[d[9]||(d[9]=o("div",{class:"h-px flex-grow bg-gray-100 dark:bg-gray-700"},null,-1)),o("span",jt,y(k),1),d[10]||(d[10]=o("div",{class:"h-px flex-grow bg-gray-100 dark:bg-gray-700"},null,-1))]),z(a,k)==="image"||$(u)?(n(),r("div",Lt,[o("div",Tt,[o("img",{src:u,class:"w-full h-auto block"},null,8,Ut)]),o("div",Pt,[o("button",{onClick:_=>te(u),class:"p-2.5 bg-black/60 hover:bg-blue-600 text-white rounded-xl backdrop-blur-md shadow-lg transition-all active:scale-90",title:"Full Screen"},[b(Ee,{class:"w-5 h-5"})],8,Ft),o("button",{onClick:_=>H(u,k),class:"p-2.5 bg-black/60 hover:bg-green-600 text-white rounded-xl backdrop-blur-md shadow-lg transition-all active:scale-90",title:"Save Image"},[b(Oe,{class:"w-5 h-5"})],8,Ht)])])):z(a,k)==="markdown"?(n(),r("div",Wt,[b(Ve,{content:u},null,8,["content"])])):(n(),r("div",Yt,y(A(u)),1))]))),128))])):(n(),r("div",Xt,[b(xe,{class:"w-8 h-8 mb-2"}),d[11]||(d[11]=o("p",{class:"text-xs uppercase font-black tracking-widest"},"No Output Data",-1))]))])]))),128))])):x("",!0),p.value&&!h.value?(n(),r("div",zt,[b(Re,{class:"w-12 h-12 text-blue-500 animate-spin mb-4"}),d[12]||(d[12]=o("p",{class:"text-sm font-medium animate-pulse"},"Processing nodes...",-1))])):x("",!0)])])])):x("",!0)]),o("div",At,[o("div",Gt,[v.value==="results"&&!p.value?(n(),r("button",{key:0,onClick:d[3]||(d[3]=a=>v.value="inputs"),class:"btn btn-secondary flex items-center gap-2"},[b(ge,{class:"w-4 h-4"}),d[13]||(d[13]=Q(" Refine Inputs "))])):x("",!0)]),o("div",Jt,[v.value==="inputs"?(n(),r("button",{key:0,onClick:F,class:"btn btn-primary px-10 py-3 shadow-xl flex items-center gap-2 rounded-2xl transform hover:scale-105 active:scale-95 transition-all",disabled:p.value},[b(ce,{class:"w-6 h-6"}),d[14]||(d[14]=o("span",{class:"text-base font-black uppercase tracking-widest"},"Execute Workflow",-1))],8,qt)):x("",!0),v.value==="results"&&!p.value?(n(),r("button",{key:1,onClick:F,class:"btn btn-primary px-8 py-2.5 shadow-lg flex items-center gap-2",disabled:p.value},[b(ge,{class:"w-5 h-5"}),d[15]||(d[15]=Q(" Run Again "))],8,Bt)):x("",!0)])])])]))}},Zt=ve(Qt,[["__scopeId","data-v-bbc5b388"]]),Kt={class:"relative w-full h-full flex overflow-hidden"},eo={class:"w-64 bg-white dark:bg-gray-800 border-r dark:border-gray-700 flex flex-col z-10 flex-shrink-0"},to={class:"p-3 border-b dark:border-gray-700 flex justify-between items-center bg-gray-50/50 dark:bg-gray-900/30"},oo={class:"flex-grow overflow-y-auto custom-scrollbar"},so=["onClick"],ao={class:"text-xs font-bold text-gray-600 dark:text-gray-400"},lo={class:"p-2 space-y-1.5 animate-in fade-in slide-in-from-top-1"},no=["onDblclick","onDragend","title"],ro={class:"flex items-center justify-between"},io={class:"text-[11px] font-bold truncate pr-2"},uo={class:"flex items-center gap-1"},co=["onClick"],po={class:"absolute top-0 left-0 overflow-visible pointer-events-none w-full h-full",style:{width:"1px",height:"1px"}},go=["d","onClick"],vo=["d"],fo=["onMousedown"],bo={class:"px-2 py-1 border-b dark:border-gray-700/50 flex justify-between items-center bg-gray-50/50 dark:bg-gray-900/20 cursor-grab"},yo={class:"text-xs font-bold truncate select-none"},xo=["onClick"],ho={class:"p-2 space-y-2 relative"},mo=["onMousedown","onMouseup"],wo={class:"text-[10px] text-gray-500 ml-1 truncate flex-1 select-none"},ko=["onUpdate:modelValue"],_o=["label"],$o=["value"],Io=["onUpdate:modelValue"],Co=["onUpdate:modelValue"],Mo=["onUpdate:modelValue"],No={class:"text-[10px] text-gray-500 mr-1 truncate select-none"},So=["onMousedown","onMouseup"],Do={__name:"FlowEditor",props:{flow:{type:Object,required:!0}},setup(L,{expose:ne}){const S=L,T=fe(),ee=je(),K=Le(),v=g([]),p=g([]),w=g(1),h=g({x:0,y:0}),D=g(!1),f=g(!1),E=g(null),M=g({x:0,y:0}),O=g(!1),$=g(null),z=g({x:0,y:0}),A=g(!1),F=g(!1),G=g(null),J=g(!1),te=X(()=>ee.isAdmin),H=g({}),c=X(()=>{const t={};return T.nodeDefinitions.forEach(s=>{const e=s.category||"General";t[e]||(t[e]=[]),t[e].push({...s,type:s.name,color:s.color||"bg-gray-100 border-gray-500"})}),Object.keys(t).sort().reduce((s,e)=>(s[e]=t[e].sort((l,i)=>l.label.localeCompare(i.label)),s),{})});le(()=>S.flow,t=>{t&&t.data?(v.value=JSON.parse(JSON.stringify(t.data.nodes||[])),p.value=JSON.parse(JSON.stringify(t.data.edges||[]))):(v.value=[],p.value=[])},{immediate:!0}),le([v,p],()=>{S.flow&&(S.flow.data={nodes:v.value,edges:p.value})},{deep:!0}),be(()=>{T.fetchNodeDefinitions(),K.fetchAvailableLollmsModels(),localStorage.getItem("flow_tutorial_seen")||(J.value=!0,localStorage.setItem("flow_tutorial_seen","true"))});const d=X(()=>{const t={};return T.nodeDefinitions.forEach(s=>{t[s.name]=s}),t});function a(t){const s={string:"bg-gray-400",int:"bg-green-500",float:"bg-green-400",boolean:"bg-orange-500",image:"bg-pink-500",node_ref:"bg-indigo-500",list:"bg-cyan-500",model_selection:"bg-purple-400",any:"bg-white border-2 border-gray-400"};return s[t]||s.any}function u(t,s){var l;const e=d.value[t];return((l=e==null?void 0:e.inputs.find(i=>i.name===s))==null?void 0:l.type)||"any"}function k(t,s){var l;const e=d.value[t];return((l=e==null?void 0:e.outputs.find(i=>i.name===s))==null?void 0:l.type)||"any"}function _(t,s){return p.value.some(e=>e.target===t&&e.targetHandle===s)}function re(t){G.value=JSON.parse(JSON.stringify(t)),A.value=!0}function q(t){const s=(-h.value.x+(window.innerWidth/2-200))/w.value,e=(-h.value.y+window.innerHeight/2)/w.value;v.value.push({id:`node_${Date.now()}`,type:t.type,label:t.label,x:s>0?s:50,y:e>0?e:50,data:{},inputs:t.inputs.map(l=>l.name),outputs:t.outputs.map(l=>l.name),color:t.color})}function V(t){v.value=v.value.filter(s=>s.id!==t),p.value=p.value.filter(s=>s.source!==t&&s.target!==t)}function B(t){(t.button===1||t.button===0&&t.target.classList.contains("flow-canvas"))&&(D.value=!0,M.value={x:t.clientX,y:t.clientY})}function W(t){const s=t.currentTarget.getBoundingClientRect();if(z.value={x:(t.clientX-s.left-h.value.x)/w.value,y:(t.clientY-s.top-h.value.y)/w.value},D.value)h.value.x+=t.clientX-M.value.x,h.value.y+=t.clientY-M.value.y,M.value={x:t.clientX,y:t.clientY};else if(f.value&&E.value){const e=v.value.find(l=>l.id===E.value);e&&(e.x+=(t.clientX-M.value.x)/w.value,e.y+=(t.clientY-M.value.y)/w.value,M.value={x:t.clientX,y:t.clientY})}}function R(){D.value=!1,f.value=!1,E.value=null,O.value&&(O.value=!1,$.value=null)}function he(t){t.preventDefault();const s=t.deltaY>0?-.1:.1;w.value=Math.min(Math.max(.1,w.value+s),5)}function me(t,s){t.button===0&&(t.stopPropagation(),f.value=!0,E.value=s,M.value={x:t.clientX,y:t.clientY})}function de(t,s,e,l){t.stopPropagation(),O.value=!0,$.value={nodeId:s,handleId:e,type:l}}function ie(t,s,e,l){if(t.stopPropagation(),!O.value||!$.value)return;const i=$.value;if(i.nodeId!==s&&i.type!==l){const m=i.type==="output"?i:{nodeId:s,handleId:e},Y=i.type==="input"?i:{nodeId:s,handleId:e};if(i.type===l)return;p.value.find(U=>U.source===m.nodeId&&U.sourceHandle===m.handleId&&U.target===Y.nodeId&&U.targetHandle===Y.handleId)||p.value.push({id:`e_${Date.now()}`,source:m.nodeId,sourceHandle:m.handleId,target:Y.nodeId,targetHandle:Y.handleId})}O.value=!1,$.value=null}function we(t){p.value.splice(t,1)}function oe(t,s,e){const l=v.value.find(Ie=>Ie.id===t);if(!l)return{x:0,y:0};const i=(e==="input"?l.inputs:l.outputs).indexOf(s),m=192,Y=29,ue=8,U=24,$e=Y+ue+i*(U+8)+U/2;return{x:e==="input"?l.x:l.x+m,y:l.y+$e}}function ke(t){const s=oe(t.source,t.sourceHandle,"output"),e=oe(t.target,t.targetHandle,"input"),l=Math.abs(e.x-s.x)*.5;return`M ${s.x} ${s.y} C ${s.x+l} ${s.y}, ${e.x-l} ${e.y}, ${e.x} ${e.y}`}const _e=X(()=>{if(!O.value||!$.value)return"";const t=oe($.value.nodeId,$.value.handleId,$.value.type),s=z.value,e=Math.abs(s.x-t.x)*.5;return`M ${t.x} ${t.y} C ${t.x+($.value.type==="output"?e:-e)} ${t.y}, ${s.x-($.value.type==="output"?e:-e)} ${s.y}, ${s.x} ${s.y}`});return ne({openRunner:()=>F.value=!0}),(t,s)=>(n(),r("div",Kt,[o("div",eo,[o("div",to,[s[7]||(s[7]=o("span",{class:"font-black text-[10px] uppercase text-gray-500 tracking-widest"},"Logic Nodes",-1)),o("button",{onClick:s[0]||(s[0]=e=>J.value=!0),class:"text-blue-500 hover:text-blue-600"},[b(xe,{class:"w-4 h-4"})])]),o("div",oo,[(n(!0),r(C,null,N(c.value,(e,l)=>(n(),r("div",{key:l,class:"border-b dark:border-gray-700 last:border-0"},[o("button",{onClick:i=>H.value[l]=!H.value[l],class:"w-full flex items-center justify-between p-3 hover:bg-gray-100 dark:hover:bg-gray-700/50 transition-colors group"},[o("span",ao,y(l),1),b(Te,{class:P(["w-3 h-3 text-gray-400 transition-transform",{"rotate-90":!H.value[l]}])},null,8,["class"])],8,so),j(o("div",lo,[(n(!0),r(C,null,N(e,i=>(n(),r("div",{key:i.id,class:P(["group p-2 rounded border dark:border-gray-600 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700 transition-all active:scale-95 border-l-4 shadow-sm",i.color.split(" ").find(m=>m.startsWith("border-"))]),onDblclick:m=>q(i),draggable:"true",onDragend:m=>q(i),title:i.description},[o("div",ro,[o("span",io,y(i.label),1),o("div",uo,[te.value?(n(),r("button",{key:0,onClick:I(m=>re(i),["stop"]),class:"text-gray-400 hover:text-blue-500 p-0.5 opacity-0 group-hover:opacity-100"},[b(Pe,{class:"w-3 h-3"})],8,co)):x("",!0),b(Fe,{class:"w-3 h-3 text-gray-400 opacity-0 group-hover:opacity-100"})])])],42,no))),128))],512),[[Ue,!H.value[l]]])]))),128))]),s[8]||(s[8]=o("div",{class:"p-2 text-[9px] text-gray-400 text-center border-t dark:border-gray-700 bg-gray-50 dark:bg-gray-800/50 uppercase tracking-tighter"},"Double-click to spawn",-1))]),o("div",{class:"flex-grow relative bg-gray-100 dark:bg-gray-950 flow-canvas overflow-hidden cursor-grab active:cursor-grabbing pattern-grid",onMousedown:B,onMousemove:W,onMouseup:R,onWheel:he},[o("div",{class:"transform-origin-0-0 w-full h-full",style:ae({transform:`translate(${h.value.x}px, ${h.value.y}px) scale(${w.value})`})},[(n(),r("svg",po,[o("g",null,[(n(!0),r(C,null,N(p.value,(e,l)=>(n(),r("path",{key:e.id,d:ke(e),class:"stroke-gray-400 dark:stroke-gray-500 stroke-[3px] fill-none pointer-events-auto hover:stroke-blue-500",onClick:I(i=>we(l),["stop"])},null,8,go))),128)),O.value?(n(),r("path",{key:0,d:_e.value,class:"stroke-blue-400 stroke-[3px] fill-none","stroke-dasharray":"5,5"},null,8,vo)):x("",!0)])])),(n(!0),r(C,null,N(v.value,e=>(n(),r("div",{key:e.id,class:P(["absolute w-48 rounded-lg shadow-lg border-2 bg-white dark:bg-gray-800 flex flex-col",e.color]),style:ae({transform:`translate(${e.x}px, ${e.y}px)`}),onMousedown:I(l=>me(l,e.id),["stop"])},[o("div",bo,[o("span",yo,y(e.label),1),o("button",{onClick:I(l=>V(e.id),["stop"]),class:"text-gray-400 hover:text-red-500"},[b(ye,{class:"w-3 h-3"})],8,xo)]),o("div",ho,[(n(!0),r(C,null,N(e.inputs,l=>(n(),r("div",{key:l,class:"flex items-center relative h-6"},[o("div",{class:P(["w-3.5 h-3.5 rounded-full border-2 border-white dark:border-gray-800 absolute -left-[1.1rem] cursor-crosshair hover:scale-125 shadow-sm",a(u(e.type,l))]),onMousedown:I(i=>de(i,e.id,l,"input"),["stop"]),onMouseup:I(i=>ie(i,e.id,l,"input"),["stop"])},null,42,mo),o("span",wo,y(l),1),_(e.id,l)?x("",!0):(n(),r(C,{key:0},[u(e.type,l)==="model_selection"?j((n(),r("select",{key:0,"onUpdate:modelValue":i=>e.data[l]=i,class:"ml-auto w-24 h-5 text-[9px] border rounded bg-gray-50 dark:bg-gray-900",onMousedown:s[1]||(s[1]=I(()=>{},["stop"]))},[(n(!0),r(C,null,N(We(K).availableLLMModelsGrouped,i=>(n(),r("optgroup",{key:i.label,label:i.label},[(n(!0),r(C,null,N(i.items,m=>(n(),r("option",{key:m.id,value:m.id},y(m.name),9,$o))),128))],8,_o))),128))],40,ko)),[[He,e.data[l]]]):u(e.type,l)==="boolean"?j((n(),r("input",{key:1,type:"checkbox","onUpdate:modelValue":i=>e.data[l]=i,class:"ml-auto w-4 h-4",onMousedown:s[2]||(s[2]=I(()=>{},["stop"]))},null,40,Io)),[[Ye,e.data[l]]]):u(e.type,l)==="int"||u(e.type,l)==="float"?j((n(),r("input",{key:2,type:"number","onUpdate:modelValue":i=>e.data[l]=i,class:"ml-auto w-16 h-5 text-[9px] border rounded px-1 bg-gray-50 dark:bg-gray-900",onMousedown:s[3]||(s[3]=I(()=>{},["stop"]))},null,40,Co)),[[Z,e.data[l],void 0,{number:!0}]]):j((n(),r("input",{key:3,"onUpdate:modelValue":i=>e.data[l]=i,class:"ml-auto w-20 h-5 text-[9px] border rounded px-1 bg-gray-50 dark:bg-gray-900",onMousedown:s[4]||(s[4]=I(()=>{},["stop"]))},null,40,Mo)),[[Z,e.data[l]]])],64))]))),128)),(n(!0),r(C,null,N(e.outputs,l=>(n(),r("div",{key:l,class:"flex items-center justify-end relative h-6"},[o("span",No,y(l),1),o("div",{class:P(["w-3.5 h-3.5 rounded-full border-2 border-white dark:border-gray-800 absolute -right-[1.1rem] cursor-crosshair hover:scale-125 shadow-sm",a(k(e.type,l))]),onMousedown:I(i=>de(i,e.id,l,"output"),["stop"]),onMouseup:I(i=>ie(i,e.id,l,"output"),["stop"])},null,42,So)]))),128))])],46,fo))),128))],4)],32),(n(),se(Xe,{to:"body"},[A.value?(n(),se(ze,{key:0,nodeToEdit:G.value,onClose:s[5]||(s[5]=e=>{A.value=!1,G.value=null})},null,8,["nodeToEdit"])):x("",!0),F.value?(n(),se(Zt,{key:1,flowData:L.flow.data,flowId:L.flow.id,flowName:L.flow.name,onClose:s[6]||(s[6]=e=>F.value=!1)},null,8,["flowData","flowId","flowName"])):x("",!0)]))]))}},jo=ve(Do,[["__scopeId","data-v-2a513348"]]);export{jo as default};
