import{u as $,ad as B,j as A,c as h,N as y,l as L,a as N,o as n,w as _,b as a,t as g,K as P,e as d,W as p,ar as k,F as w,r as D,ap as R}from"./index-CpNEmBDf.js";import{_ as U}from"./GenericModal-DyRxZVIy.js";const V={key:0},q={class:"border-b border-gray-200 dark:border-gray-600 pb-2 mb-2"},W={class:"flex items-center space-x-3 cursor-pointer p-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700"},z={class:"max-h-60 overflow-y-auto space-y-1 pr-2"},I=["value"],j={class:"text-gray-700 dark:text-gray-300"},E={key:1,class:"mt-2 text-sm text-gray-500 bg-gray-50 dark:bg-gray-700/50 p-4 rounded-md"},K=["value"],Q=["disabled"],T=["disabled"],J={__name:"ShareDataStoreModal",setup(Y){const v=$(),F=B(),m=A(),b=h(()=>{var l;return(l=v.modalData("shareDataStore"))==null?void 0:l.store}),r=h(()=>m.friends),s=y([]),o=y(!1),i=y("read_query"),C=[{value:"read_query",label:"Read (Query)"},{value:"read_write",label:"Read/Write"},{value:"revectorize",label:"Read/Write & Revectorize"}],f=h({get:()=>r.value.length>0&&s.value.length===r.value.length,set:l=>{l?s.value=r.value.map(e=>e.id):s.value=[]}});L(()=>{m.friends.length===0&&m.fetchFriends()});async function S(){if(s.value.length===0||!b.value)return;o.value=!0;const l=s.value.length;try{const e={storeId:b.value.id,permissionLevel:i.value},u=s.value.map(t=>{const c=r.value.find(M=>M.id===t);return c?F.shareDataStore({...e,username:c.username}):Promise.resolve()});await Promise.all(u),v.addNotification(`Store shared with ${l} friend${l>1?"s":""}.`,"success"),x()}catch{}finally{o.value=!1}}function x(){s.value=[],i.value="read_query",v.closeModal("shareDataStore")}return(l,e)=>{var u;return n(),N(U,{modalName:"shareDataStore",title:`Share '${((u=b.value)==null?void 0:u.name)||"Data Store"}'`,"allow-overlay-close":!o.value},{body:_(()=>[a("form",{onSubmit:P(S,["prevent"]),class:"space-y-4"},[a("div",null,[e[4]||(e[4]=a("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Share with ",-1)),r.value.length>0?(n(),d("div",V,[a("div",q,[a("label",W,[p(a("input",{type:"checkbox","onUpdate:modelValue":e[0]||(e[0]=t=>f.value=t),class:"h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500"},null,512),[[k,f.value]]),e[3]||(e[3]=a("span",{class:"font-medium text-gray-800 dark:text-gray-200"},"Select All Friends",-1))])]),a("div",z,[(n(!0),d(w,null,D(r.value,t=>(n(),d("label",{key:t.id,class:"flex items-center space-x-3 cursor-pointer p-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700"},[p(a("input",{type:"checkbox",value:t.id,"onUpdate:modelValue":e[1]||(e[1]=c=>s.value=c),class:"h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500"},null,8,I),[[k,s.value]]),a("span",j,g(t.username),1)]))),128))])])):(n(),d("p",E," You don't have any friends to share with yet. Add some from the Friends page! "))]),a("div",null,[e[5]||(e[5]=a("label",{for:"permission-level",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"}," As ",-1)),p(a("select",{id:"permission-level","onUpdate:modelValue":e[2]||(e[2]=t=>i.value=t),class:"input-field mt-1"},[(n(),d(w,null,D(C,t=>a("option",{key:t.value,value:t.value},g(t.label),9,K)),64))],512),[[R,i.value]])])],32)]),footer:_(()=>[a("button",{type:"button",onClick:x,disabled:o.value,class:"btn btn-secondary"}," Cancel ",8,Q),a("button",{type:"button",onClick:S,disabled:o.value||s.value.length===0,class:"btn btn-primary"},g(o.value?"Sharing...":`Share with ${s.value.length} Friend${s.value.length!==1?"s":""}`),9,T)]),_:1},8,["title","allow-overlay-close"])}}};export{J as default};
