import{q as b,c as $,d as r,l as n,e as l,F as S,i as C,f as _,cO as T,ah as K,y as k,K as N,Z as z,G as F,m as D,x as P,ag as W,J as H,O as Z,o as Q,w as J,h as M,t as w,p as O,n as X,W as j,H as Y,aq as ee,V as te,j as L}from"./index-4tYqOs8q.js";import{u as ae}from"./admin-etPRT619.js";import{I as le}from"./IconArrowUp-o0kUT31o.js";import{_ as oe}from"./JsonRenderer-CALsNHQV.js";/* empty css                                                                 */const se={class:"space-y-2"},ne=["value","onInput"],re=["onClick","disabled"],ie=["onClick","disabled"],ue=["onClick"],de={class:"flex items-center gap-2"},ce=["onKeyup"],ye={__name:"StringListEditor",props:{modelValue:{type:[String,Array],default:""}},emits:["update:modelValue"],setup(E,{emit:p}){const x=E,m=p,a=b(""),d=$({get:()=>{const c=x.modelValue;return Array.isArray(c)?c.map(o=>String(o).trim()).filter(o=>o):typeof c=="string"?(c||"").split(",").map(o=>o.trim()).filter(o=>o):[]},set:c=>{m("update:modelValue",c.join(", "))}});function h(){a.value.trim()&&!d.value.includes(a.value.trim())&&(d.value=[...d.value,a.value.trim()],a.value="")}function V(c){const o=[...d.value];o.splice(c,1),d.value=o}function I(c,o){const v=[...d.value],y=c+o;y>=0&&y<v.length&&([v[c],v[y]]=[v[y],v[c]],d.value=v)}return(c,o)=>(n(),r("div",se,[(n(!0),r(S,null,C(d.value,(v,y)=>(n(),r("div",{key:y,class:"flex items-center gap-2"},[l("input",{type:"text",value:v,onInput:g=>{const U=[...d.value];U[y]=g.target.value,d.value=U},class:"input-field flex-grow"},null,40,ne),l("button",{onClick:g=>I(y,-1),disabled:y===0,class:"btn-icon",type:"button",title:"Move Up"},[_(le,{class:"w-4 h-4"})],8,re),l("button",{onClick:g=>I(y,1),disabled:y===d.value.length-1,class:"btn-icon",type:"button",title:"Move Down"},[_(T,{class:"w-4 h-4"})],8,ie),l("button",{onClick:g=>V(y),class:"btn-icon-danger",type:"button",title:"Remove"},[_(K,{class:"w-4 h-4"})],8,ue)]))),128)),l("div",de,[k(l("input",{type:"text","onUpdate:modelValue":o[0]||(o[0]=v=>a.value=v),onKeyup:z(F(h,["prevent"]),["enter"]),class:"input-field flex-grow",placeholder:"Add new origin"},null,40,ce),[[N,a.value]]),l("button",{onClick:h,class:"btn btn-secondary",type:"button"},[_(P,{class:"w-4 h-4 mr-1"}),o[1]||(o[1]=D(" Add"))])])]))}},pe={class:"bg-white dark:bg-gray-800 shadow-md rounded-lg"},ve={class:"text-lg font-bold text-gray-800 dark:text-gray-100 border-b pb-2"},fe={key:0,class:"mb-4 p-4 bg-blue-50 dark:bg-blue-900/20 border-l-4 border-blue-400 text-blue-800 dark:text-blue-200 rounded-r-lg text-sm"},me={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},be=["for"],ke={key:1,class:"flex items-center justify-between bg-gray-50 dark:bg-gray-700/30 p-3 rounded-lg border dark:border-gray-600"},_e={class:"text-xs text-gray-500"},he=["onClick"],ge=["onUpdate:modelValue"],we=["onUpdate:modelValue"],xe=["onUpdate:modelValue"],Se=["label"],Ce=["value"],Ve={key:5,class:"space-y-2"},Ie={class:"flex justify-between items-center"},Ue=["onClick"],$e=["onUpdate:modelValue"],Ae={key:1,class:"p-2 bg-gray-50 dark:bg-gray-900 rounded border dark:border-gray-700 max-h-40 overflow-y-auto"},Me={key:6,class:"flex gap-2"},Oe=["onUpdate:modelValue"],je=["onChange"],Ne=["onClick"],Fe=["type","onUpdate:modelValue"],De={key:1,class:"mt-4 flex flex-wrap gap-2"},Ee={class:"mt-8 pt-6 border-t border-gray-200 dark:border-gray-700 flex justify-end"},Je=["disabled"],Le={__name:"ServerSettings",setup(E){const p=ae(),x=H(),m=Z(),a=b({}),d=b(!1),h=b(!1);let V="{}";const I=b(null),c=b(null),o=b({}),v=["Server","Authentication","Registration","Defaults","Global LLM Overrides"],y=$(()=>{const s={};p.globalSettings.forEach(u=>{const f=u.category||"Other";s[f]||(s[f]=[]),s[f].push(u)});const t={};return v.forEach(u=>{s[u]&&(t[u]=s[u])}),Object.keys(s).forEach(u=>{v.includes(u)||(t[u]=s[u])}),t});$(()=>m.availableVectorizers);const g=$(()=>m.availableLLMModelsGrouped);Q(async()=>{p.globalSettings.length===0&&await p.fetchGlobalSettings(),m.availableLollmsModels.length===0&&await m.fetchAdminAvailableLollmsModels(),await m.fetchAvailableVectorizers()}),J(()=>p.globalSettings,U,{deep:!0,immediate:!0}),J(a,s=>{h.value=JSON.stringify(s)!==V},{deep:!0});function U(){const s={};p.globalSettings.forEach(t=>{if(t.type==="json"){try{s[t.key]=JSON.stringify(t.value,null,2)}catch{s[t.key]=t.value}o.value[t.key]=!1}else s[t.key]=t.value}),a.value=s,V=JSON.stringify(s),h.value=!1}function G(s){try{return JSON.parse(a.value[s])}catch{return{error:"Invalid JSON format"}}}async function R(s,t){const u=s.target.files[0];if(u){d.value=!0;try{const f=await p.uploadSslFile(u,t);a.value[t==="cert"?"ssl_certfile":"ssl_keyfile"]=f,x.addNotification(`${u.name} uploaded successfully.`,"success")}finally{d.value=!1}}}async function q(){d.value=!0;const s={};for(const t in a.value){const u=p.globalSettings.find(f=>f.key===t);if((u==null?void 0:u.type)==="json")try{s[t]=JSON.parse(a.value[t])}catch{x.addNotification(`Invalid JSON in ${u.description}`,"error"),d.value=!1;return}else s[t]=a.value[t]}try{await p.updateGlobalSettings(s),Object.keys(o.value).forEach(t=>o.value[t]=!1)}finally{d.value=!1}}async function B(){(await x.showConfirmation({title:"Generate Certificate?",message:"This will generate a new self-signed certificate. Restart required.",confirmText:"Generate"})).confirmed&&await p.generateSelfSignedCert()}return(s,t)=>(n(),r("div",pe,[t[6]||(t[6]=l("div",{class:"p-6 border-b border-gray-200 dark:border-gray-700"},[l("h3",{class:"text-xl font-semibold text-gray-900 dark:text-white"},"Server & Application Settings"),l("p",{class:"mt-1 text-sm text-gray-500 dark:text-gray-400"},"Configure global server behavior, security, and defaults.")],-1)),Object.keys(a.value).length?(n(),r("form",{key:0,onSubmit:F(q,["prevent"]),class:"p-6 space-y-12"},[(n(!0),r(S,null,C(y.value,(u,f)=>(n(),r("div",{key:f,class:"space-y-6"},[l("h4",ve,w(f),1),f==="Server"?(n(),r("div",fe," Note: Most server changes require a restart. ")):M("",!0),l("div",me,[(n(!0),r(S,null,C(u,e=>(n(),r("div",{key:e.key,class:O(["flex flex-col justify-center",{"md:col-span-2":["cors_origins_exceptions","ssl_certfile","ssl_keyfile"].includes(e.key)}])},[l("label",{for:e.key,class:"block text-sm font-medium mb-1"},w(e.description||e.key),9,be),e.key==="cors_origins_exceptions"?(n(),X(ye,{key:0,modelValue:a.value[e.key],"onUpdate:modelValue":i=>a.value[e.key]=i},null,8,["modelValue","onUpdate:modelValue"])):e.type==="boolean"?(n(),r("div",ke,[l("span",_e,w(e.description),1),l("button",{onClick:i=>a.value[e.key]=!a.value[e.key],type:"button",class:O([a.value[e.key]?"bg-blue-600":"bg-gray-300 dark:bg-gray-600","toggle-switch"])},[l("span",{class:O([a.value[e.key]?"translate-x-5":"translate-x-0","toggle-knob"])},null,2)],10,he)])):e.key==="registration_mode"?k((n(),r("select",{key:2,"onUpdate:modelValue":i=>a.value[e.key]=i,class:"input-field"},t[1]||(t[1]=[l("option",{value:"direct"},"Direct (Instantly Active)",-1),l("option",{value:"admin_approval"},"Admin Approval Required",-1)]),8,ge)),[[j,a.value[e.key]]]):e.key==="password_recovery_mode"?k((n(),r("select",{key:3,"onUpdate:modelValue":i=>a.value[e.key]=i,class:"input-field"},t[2]||(t[2]=[l("option",{value:"manual"},"Manual (Admin Managed)",-1),l("option",{value:"automatic"},"SMTP Server",-1),l("option",{value:"system_mail"},"System Mail Command",-1),l("option",{value:"outlook"},"Outlook (Windows)",-1)]),8,we)),[[j,a.value[e.key]]]):e.key==="default_lollms_model_name"?k((n(),r("select",{key:4,"onUpdate:modelValue":i=>a.value[e.key]=i,class:"input-field"},[t[3]||(t[3]=l("option",{value:""},"(None)",-1)),(n(!0),r(S,null,C(g.value,i=>(n(),r("optgroup",{key:i.label,label:i.label},[(n(!0),r(S,null,C(i.items,A=>(n(),r("option",{key:A.id,value:A.id},w(A.name),9,Ce))),128))],8,Se))),128))],8,xe)),[[j,a.value[e.key]]]):e.type==="json"?(n(),r("div",Ve,[l("div",Ie,[l("button",{onClick:i=>o.value[e.key]=!o.value[e.key],type:"button",class:"btn btn-secondary btn-xs"},w(o.value[e.key]?"View Rendered":"Edit Raw"),9,Ue)]),o.value[e.key]?k((n(),r("textarea",{key:0,"onUpdate:modelValue":i=>a.value[e.key]=i,rows:"5",class:"input-field font-mono text-xs"},null,8,$e)),[[N,a.value[e.key]]]):(n(),r("div",Ae,[_(oe,{json:G(e.key)},null,8,["json"])]))])):e.key==="ssl_certfile"||e.key==="ssl_keyfile"?(n(),r("div",Me,[k(l("input",{type:"text","onUpdate:modelValue":i=>a.value[e.key]=i,class:"input-field flex-grow text-xs font-mono"},null,8,Oe),[[N,a.value[e.key]]]),l("input",{type:"file",onChange:i=>R(i,e.key==="ssl_certfile"?"cert":"key"),class:"hidden",ref_for:!0,ref:e.key==="ssl_certfile"?"certFileInput":"keyFileInput"},null,40,je),l("button",{onClick:F(i=>(e.key==="ssl_certfile"?I.value:c.value).click(),["prevent"]),type:"button",class:"btn btn-secondary btn-xs"},"Upload",8,Ne)])):k((n(),r("input",{key:7,type:e.type==="string"?"text":"number","onUpdate:modelValue":i=>a.value[e.key]=i,class:"input-field"},null,8,Fe)),[[Y,a.value[e.key]]])],2))),128))]),f==="Server"?(n(),r("div",De,[l("button",{type:"button",onClick:B,class:"btn btn-secondary btn-sm flex items-center gap-2"},[_(ee,{class:"w-4 h-4"}),t[4]||(t[4]=D(" Auto-Cert"))]),l("button",{type:"button",onClick:t[0]||(t[0]=(...e)=>L(p).downloadCertificate&&L(p).downloadCertificate(...e)),class:"btn btn-secondary btn-sm flex items-center gap-2"},[_(te,{class:"w-4 h-4"}),t[5]||(t[5]=D(" Download Cert"))])])):M("",!0)]))),128)),l("div",Ee,[l("button",{type:"submit",class:"btn btn-primary",disabled:d.value||!h.value},w(d.value?"Saving...":"Save All Settings"),9,Je)])],32)):M("",!0)]))}},Ke=W(Le,[["__scopeId","data-v-0e6ff49c"]]);export{Ke as default};
