import{X as I,a2 as K,K as p,c as k,w as H,o as P,d as l,l as i,h as c,e,t as r,O as w,m as _,Y as W,a6 as F,F as y,i as B,j as A,W as X,n as M,cg as Y,ch as Q,H as C,ax as Z,J as G,f as ee,z as te}from"./index-CZNMIptP.js";import{u as se}from"./admin-B7P7solc.js";const ae={class:"space-y-8"},ne={key:0,class:"bg-white dark:bg-gray-800 shadow-md rounded-lg p-6"},ie={class:"text-xl font-semibold mb-4"},le={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},oe=["disabled"],de=["value"],re={key:0,class:"space-y-6 border-t dark:border-gray-700 pt-6"},ue={class:"text-sm text-gray-600 dark:text-gray-400"},ce=["for"],me={key:0,class:"text-red-500"},ve={class:"relative"},ge=["type","id","onUpdate:modelValue","required","placeholder"],fe=["onClick"],pe={class:"text-xs text-gray-500 mt-1"},_e={class:"flex items-center justify-between bg-gray-50 dark:bg-gray-700/50 p-3 rounded-md"},ye={class:"flex justify-end gap-3"},be=["disabled"],xe={class:"flex justify-between items-center mb-4 flex-wrap gap-4"},he={class:"flex items-center gap-4"},ke={key:0},we={key:1,class:"text-center p-6 bg-gray-50 dark:bg-gray-800/50 rounded-lg"},Be={key:2,class:"space-y-4"},Ae={class:"flex-grow"},Ce={class:"flex justify-between items-center"},Se={class:"flex items-center gap-3"},Me={class:"font-bold text-lg"},Re=["onClick","title"],Te={class:"flex gap-3"},Ve=["onClick"],De=["onClick"],$e={class:"text-sm text-gray-500"},Fe={class:"mt-2 text-xs space-y-1 text-gray-600 dark:text-gray-300"},Ge={key:0},Ne={class:"font-semibold capitalize"},Ee={key:0},Oe={key:1},je={class:"border-t dark:border-gray-700 pt-3 flex justify-end"},ze=["onClick"],Je={__name:"RAGBindingsSettings",setup(Ue){const u=se(),S=I(),{ragBindings:R,availableRagBindingTypes:b,isLoadingRagBindings:N,globalSettings:T}=K(u),m=p(!1),g=p(null),f=p(!1),v=p({}),V=()=>({id:null,alias:"",name:"",config:{},default_model_name:null,is_active:!0}),n=p(V()),x=k(()=>g.value!==null),h=k(()=>n.value.name?b.value.find(a=>a.name===n.value.name):null),E=k(()=>h.value?h.value.input_parameters||[]:[]),D=k({get(){if(!Array.isArray(T.value))return"mixed";const a=T.value.find(s=>s.key==="rag_model_display_mode");return a?a.value:"mixed"},set(a){u.updateGlobalSettings({rag_model_display_mode:a})}});H(()=>n.value.name,(a,s)=>{if(a!==s){const t=b.value.find(d=>d.name===a),o={};t&&t.input_parameters&&t.input_parameters.forEach(d=>{o[d.name]=d.default!==void 0?d.default:""}),n.value.config=o}}),P(()=>{u.fetchRagBindings(),u.fetchAvailableRagBindingTypes(),u.fetchGlobalSettings()});function O(){g.value=null,n.value=V(),v.value={},m.value=!0,window.scrollTo({top:0,behavior:"smooth"})}function j(a){g.value=a,n.value=JSON.parse(JSON.stringify(a)),n.value.config||(n.value.config={}),v.value={},m.value=!0,window.scrollTo({top:0,behavior:"smooth"})}function $(){m.value=!1,g.value=null}async function z(){if(!n.value.alias.trim()||!n.value.name){S.addNotification("Alias and Vectorizer Type are required.","warning");return}f.value=!0;try{const a={alias:n.value.alias,name:n.value.name,config:n.value.config||{},is_active:n.value.is_active,default_model_name:n.value.default_model_name||null};x.value?await u.updateRagBinding(g.value.id,a):await u.addRagBinding(a),$()}finally{f.value=!1}}async function U(a){await S.showConfirmation({title:`Delete RAG Binding '${a.alias}'?`,confirmText:"Delete"})&&await u.deleteRagBinding(a.id)}async function q(a){await u.updateRagBinding(a.id,{is_active:!a.is_active})}function L(a){const s=b.value.find(t=>t.name===a);return s?s.title:a}function J(a){S.openModal("manageModels",{binding:a,bindingType:"rag"})}return(a,s)=>(i(),l("div",ae,[m.value?(i(),l("div",ne,[e("h3",ie,r(x.value?"Edit RAG Binding":"Add New RAG Binding"),1),e("form",{onSubmit:G(z,["prevent"]),class:"space-y-6"},[e("div",le,[e("div",null,[s[4]||(s[4]=e("label",{for:"alias",class:"block text-sm font-medium"},[_("Alias "),e("span",{class:"text-red-500"},"*")],-1)),w(e("input",{type:"text",id:"alias","onUpdate:modelValue":s[0]||(s[0]=t=>n.value.alias=t),class:"input-field mt-1",required:"",placeholder:"e.g., local_embeddings"},null,512),[[W,n.value.alias]])]),e("div",null,[s[6]||(s[6]=e("label",{for:"name",class:"block text-sm font-medium"},[_("Vectorizer Type "),e("span",{class:"text-red-500"},"*")],-1)),w(e("select",{id:"name","onUpdate:modelValue":s[1]||(s[1]=t=>n.value.name=t),class:"input-field mt-1",required:"",disabled:x.value},[s[5]||(s[5]=e("option",{disabled:"",value:""},"Select a type",-1)),(i(!0),l(y,null,B(A(b),t=>(i(),l("option",{key:t.name,value:t.name},r(t.title),9,de))),128))],8,oe),[[F,n.value.name]])])]),h.value?(i(),l("div",re,[e("p",ue,r(h.value.description),1),(i(!0),l(y,null,B(E.value,t=>(i(),l("div",{key:t.name,class:"space-y-1"},[e("label",{for:`param-${t.name}`,class:"block text-sm font-medium capitalize"},[_(r(t.name.replace(/_/g," "))+" ",1),t.mandatory?(i(),l("span",me,"*")):c("",!0)],8,ce),e("div",ve,[w(e("input",{type:(t.name.includes("key")||t.name.includes("token"))&&!v.value[t.name]?"password":"text",id:`param-${t.name}`,"onUpdate:modelValue":o=>n.value.config[t.name]=o,class:"input-field",required:t.mandatory,placeholder:t.default},null,8,ge),[[X,n.value.config[t.name]]]),t.name.includes("key")||t.name.includes("token")?(i(),l("button",{key:0,type:"button",onClick:o=>v.value[t.name]=!v.value[t.name],class:"absolute inset-y-0 right-0 px-3 flex items-center text-gray-500"},[v.value[t.name]?(i(),M(Y,{key:0,class:"w-5 h-5"})):(i(),M(Q,{key:1,class:"w-5 h-5"}))],8,fe)):c("",!0)]),e("p",pe,r(t.description),1)]))),128))])):c("",!0),e("div",_e,[s[7]||(s[7]=e("span",{class:"flex-grow flex flex-col"},[e("span",{class:"text-sm font-medium"},"Active"),e("span",{class:"text-sm text-gray-500"},"Enable this binding for use in Data Stores.")],-1)),e("button",{onClick:s[2]||(s[2]=t=>n.value.is_active=!n.value.is_active),type:"button",class:C([n.value.is_active?"bg-blue-600":"bg-gray-200 dark:bg-gray-600","relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out"])},[e("span",{class:C([n.value.is_active?"translate-x-5":"translate-x-0","pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition-colors duration-200 ease-in-out"])},null,2)],2)]),e("div",ye,[e("button",{type:"button",onClick:$,class:"btn btn-secondary"},"Cancel"),e("button",{type:"submit",class:"btn btn-primary",disabled:f.value},[f.value?(i(),M(Z,{key:0,class:"w-5 h-5 mr-2"})):c("",!0),_(" "+r(f.value?"Saving...":x.value?"Save Changes":"Create Binding"),1)],8,be)])],32)])):c("",!0),e("div",null,[e("div",xe,[s[10]||(s[10]=e("h2",{class:"text-2xl font-bold"},"RAG Bindings",-1)),e("div",he,[e("div",null,[s[9]||(s[9]=e("label",{for:"rag-model-display-mode",class:"block text-xs font-medium text-gray-500 dark:text-gray-400"},"Model Display Mode",-1)),w(e("select",{id:"rag-model-display-mode","onUpdate:modelValue":s[3]||(s[3]=t=>D.value=t),class:"input-field mt-1"},s[8]||(s[8]=[e("option",{value:"mixed"},"Mixed (Alias or Original)",-1),e("option",{value:"aliased"},"Aliased Only",-1),e("option",{value:"original"},"Original Names Only",-1)]),512),[[F,D.value]])]),m.value?c("",!0):(i(),l("button",{key:0,onClick:O,class:"btn btn-primary self-end"},"+ Add RAG Binding"))])]),A(N)?(i(),l("div",ke,"Loading...")):A(R).length===0&&!m.value?(i(),l("div",we,s[11]||(s[11]=[e("p",null,"No RAG bindings configured.",-1)]))):(i(),l("div",Be,[(i(!0),l(y,null,B(A(R),t=>(i(),l("div",{key:t.id,class:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow-md flex flex-col gap-4"},[e("div",Ae,[e("div",Ce,[e("div",Se,[e("h4",Me,r(t.alias),1),e("button",{onClick:G(o=>q(t),["stop"]),type:"button",class:C([t.is_active?"bg-blue-600":"bg-gray-200 dark:bg-gray-600","relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out"]),title:t.is_active?"Deactivate":"Activate"},[e("span",{class:C([t.is_active?"translate-x-5":"translate-x-0","pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out"])},null,2)],10,Re)]),e("div",Te,[e("button",{onClick:o=>j(t),class:"text-sm font-medium text-blue-600 hover:underline"},"Edit",8,Ve),e("button",{onClick:o=>U(t),class:"text-sm font-medium text-red-600 hover:underline"},"Delete",8,De)])]),e("p",$e,r(L(t.name)),1),e("div",Fe,[(i(!0),l(y,null,B(t.config,(o,d)=>(i(),l(y,{key:d},[o?(i(),l("p",Ge,[e("span",Ne,r(d.replace(/_/g," "))+":",1),d.includes("key")||d.includes("token")?(i(),l("span",Ee,"********")):(i(),l("span",Oe,r(o),1))])):c("",!0)],64))),128))])]),e("div",je,[e("button",{onClick:o=>J(t),class:"btn btn-secondary btn-sm flex items-center gap-2"},[ee(te,{class:"w-4 h-4"}),s[12]||(s[12]=_(" Manage Models "))],8,ze)])]))),128))]))])]))}};export{Je as default};
