import{ao as R,u as X,R as se,T as Z,L as $,c as p,N as ae,m as F,e as g,o as i,b as e,g as T,f as d,aC as oe,av as ne,az as q,aD as W,t as _,as as J,K as H,ap as K,a4 as O,aA as re,l as Q,a0 as E,ac as le,a as C,h as ie,z as ee,dt as te,M as de,Y as ce,d as w,w as ue,F as ve,r as ge,n as S,aE as fe,dp as ye,aw as he,du as pe,dv as Y,cy as xe,cr as be,aF as me,dw as P,a1 as B,an as _e}from"./index-B_xFINIg.js";import{I as ke,a as we}from"./IconRedo-C5nUk9rz.js";const $e={class:"flex flex-col h-full overflow-hidden"},Ce={class:"flex-shrink-0 flex items-center justify-between gap-2 p-1.5 bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-t-lg"},De={class:"flex items-center gap-0.5"},Me=["disabled"],Te=["disabled"],Se=["disabled"],Ie=["disabled"],ze=["disabled"],Ee={key:0,class:"flex items-center gap-2 pr-2"},Ze={class:"text-[10px] font-bold text-blue-500"},Re={__name:"DiscussionZone",setup(L){const u=R(),k=X(),f=se(),{activeDiscussion:o}=Z(u),{tasks:m}=Z(f),y=$(null),s=$(!1),x=$([]),c=$(-1);let l=null,h=null;const v=p({get:()=>{var t;return((t=o.value)==null?void 0:t.discussion_data_zone)||""},set:t=>{o.value&&(u.setDiscussionDataZoneContent(o.value.id,t),clearTimeout(h),h=setTimeout(()=>{o.value&&ae.put(`/api/discussions/${o.value.id}/data_zone`,{content:t}).then(()=>{u.fetchContextStatus(o.value.id)})},1500))}}),b=p(()=>{if(!o.value)return!1;const t=u.activeAiTasks[o.value.id];if(!t||!t.taskId)return!1;const a=m.value.find(M=>M.id===t.taskId);return a?a.status==="running"||a.status==="pending":!1}),D=p(()=>{if(!o.value)return null;const t=u.activeAiTasks[o.value.id];return!t||!t.taskId?null:m.value.find(a=>a.id===t.taskId)}),I=p(()=>c.value>0),z=p(()=>c.value<x.value.length-1);function j(t){clearTimeout(l),l=setTimeout(()=>{x.value[c.value]!==t&&(c.value<x.value.length-1&&x.value.splice(c.value+1),x.value.push(t),c.value++)},750)}async function A(){I.value&&(s.value=!0,c.value--,v.value=x.value[c.value],await K(),s.value=!1)}async function V(){z.value&&(s.value=!0,c.value++,v.value=x.value[c.value],await K(),s.value=!1)}F(v,(t,a)=>{!s.value&&t!==a&&j(t)},{flush:"post"}),F(o,(t,a)=>{t&&(!a||t.id!==a.id)&&(x.value=[t.discussion_data_zone||""],c.value=0)},{immediate:!0});function U(t){y.value=t.view}function N(){o.value&&u.cloneDiscussion(o.value.id)}function n(){o.value&&u.refreshDataZones(o.value.id)}async function r(t){const a=Array.from(t.dataTransfer.files);a.length>0&&o.value&&(k.addNotification(`Extracting text from ${a.length} file(s)...`,"info"),await u.uploadAndEmbedFilesToDataZone(o.value.id,a,!1))}return(t,a)=>{var M;return i(),g("div",$e,[e("div",Ce,[e("div",De,[e("button",{onClick:A,class:"p-1.5 rounded hover:bg-gray-100 dark:hover:bg-gray-800 disabled:opacity-30",title:"Undo",disabled:!I.value||b.value},[d(ke,{class:"w-4 h-4"})],8,Me),e("button",{onClick:V,class:"p-1.5 rounded hover:bg-gray-100 dark:hover:bg-gray-800 disabled:opacity-30",title:"Redo",disabled:!z.value||b.value},[d(we,{class:"w-4 h-4"})],8,Te),a[3]||(a[3]=e("div",{class:"w-px h-4 bg-gray-200 dark:bg-gray-700 mx-1"},null,-1)),e("button",{onClick:N,class:"p-1.5 rounded hover:bg-gray-100 dark:hover:bg-gray-800 disabled:opacity-30",title:"Clone Data Zone",disabled:b.value},[d(oe,{class:"w-4 h-4"})],8,Se),e("button",{onClick:n,class:"p-1.5 rounded hover:bg-gray-100 dark:hover:bg-gray-800 disabled:opacity-30",title:"Refresh",disabled:b.value},[d(ne,{class:"w-4 h-4"})],8,Ie),e("button",{onClick:a[0]||(a[0]=G=>v.value=""),class:"p-1.5 rounded hover:bg-red-50 dark:hover:bg-red-900/20 text-red-500 disabled:opacity-30",title:"Clear Context",disabled:b.value},[d(q,{class:"w-4 h-4"})],8,ze)]),b.value?(i(),g("div",Ee,[d(W,{class:"w-3.5 h-3.5 text-blue-500 animate-spin"}),e("span",Ze,_((M=D.value)==null?void 0:M.progress)+"%",1)])):T("",!0)]),e("div",{onDragover:a[2]||(a[2]=H(()=>{},["prevent"])),onDrop:H(r,["prevent"]),class:"flex-1 min-h-0 border-x border-b border-gray-200 dark:border-gray-700 rounded-b-lg overflow-hidden relative"},[d(J,{ref:"discussionCodeMirrorEditor",modelValue:v.value,"onUpdate:modelValue":a[1]||(a[1]=G=>v.value=G),class:"h-full","read-only":b.value,renderable:!0,onReady:U},null,8,["modelValue","read-only"])],32)])}}},Le={class:"h-full flex flex-col border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden"},je={__name:"PersonalityZone",setup(L){const u=R(),k=p(()=>u.activeDiscussion),f=p(()=>{var o;return((o=k.value)==null?void 0:o.personality_data_zone)||""});return(o,m)=>(i(),g("div",Le,[d(J,{modelValue:f.value,"onUpdate:modelValue":m[0]||(m[0]=y=>f.value=y),class:"h-full","read-only":!0},null,8,["modelValue"])]))}},Ae={class:"flex flex-col h-full gap-3 overflow-hidden"},Ve={class:"flex items-center justify-between bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 p-2 rounded-lg shadow-sm flex-shrink-0"},Ue=["disabled"],Ne={class:"flex-1 flex flex-col gap-3 min-h-0"},Pe={class:"flex-1 flex flex-col min-h-[150px] border border-gray-200 dark:border-gray-700 rounded-lg bg-white dark:bg-gray-900/50 shadow-inner overflow-hidden"},Be={class:"p-2 border-b dark:border-gray-700 flex items-center justify-between bg-gray-50 dark:bg-gray-800/30"},Fe={class:"flex gap-2"},We={key:0,class:"text-[9px] font-mono text-gray-500"},He={key:1,class:"text-[9px] font-mono text-blue-500"},Xe={class:"flex-1 overflow-y-auto custom-scrollbar p-3"},Ge={key:0,class:"h-full flex flex-col items-center justify-center text-gray-400 opacity-40"},Ke={class:"h-64 border border-gray-200 dark:border-gray-700 rounded-lg bg-white dark:bg-gray-900 flex flex-col shadow-sm overflow-hidden flex-shrink-0"},Ye={class:"p-2 border-b dark:border-gray-700 flex justify-between items-center bg-gray-50/50 dark:bg-gray-800/30"},qe={class:"text-[10px] font-black uppercase text-gray-500"},Je={class:"flex-1 overflow-y-auto custom-scrollbar p-1"},Oe={key:0,class:"text-center py-6"},Qe={key:1,class:"text-center py-6 text-xs text-gray-400"},et={class:"flex items-center gap-3 min-w-0"},tt={class:"text-[10px] font-mono text-gray-400 font-bold w-5 text-center shrink-0"},st=["onClick"],at={class:"flex flex-col min-w-0"},ot=["title"],nt={class:"text-[10px] truncate text-gray-400"},rt={class:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity"},lt=["onClick"],it=["onClick"],dt={__name:"MemoryZone",setup(L){const u=R(),k=re(),f=X(),{memories:o,isLoading:m}=Z(k),y=$(""),s=$(new Set);function x(n){return n?Math.ceil(n.length/4):0}const c=p(()=>u.activeDiscussion),l=p(()=>{var n;return c.value&&((n=u.activeAiTasks[c.value.id])==null?void 0:n.type)==="memorize"}),h=p(()=>[...o.value].sort((n,r)=>new Date(n.created_at)-new Date(r.created_at))),v=p(()=>{const n=h.value.filter(r=>s.value.has(r.title));return n.length===0?"":n.map(r=>`[Memory #${h.value.findIndex(a=>a.id===r.id)+1}] ${r.title}: ${r.content}`).join(`

`)}),b=p(()=>x(v.value)),D=p(()=>{if(!y.value)return h.value;const n=y.value.toLowerCase();return h.value.filter(r=>r.title.toLowerCase().includes(n)||r.content.toLowerCase().includes(n))});function I(){c.value&&u.memorizeLTM(c.value.id)}function z(){f.openModal("memoryEditor")}function j(n){f.openModal("memoryEditor",{memory:n})}async function A(n){const r=o.value.find(a=>a.id===n);if(!r)return;const t=await f.showConfirmation({title:"Delete Memory?",message:`Permanently delete "${r.title}"?`,confirmText:"Delete"});t&&t.confirmed&&(s.value.delete(r.title),s.value=new Set(s.value),await k.deleteMemory(n))}function V(n){s.value.add(n),s.value=new Set(s.value)}function U(n){s.value.delete(n),s.value=new Set(s.value)}async function N(){await k.fetchMemories(),s.value.size===0&&o.value.length>0&&(o.value.forEach(n=>s.value.add(n.title)),s.value=new Set(s.value))}return F(o,n=>{const r=new Set(n.map(a=>a.title));let t=!1;for(const a of s.value)r.has(a)||(s.value.delete(a),t=!0);t&&(s.value=new Set(s.value))},{deep:!0}),Q(()=>{N()}),(n,r)=>(i(),g("div",Ae,[e("div",Ve,[E(e("input",{type:"text","onUpdate:modelValue":r[0]||(r[0]=t=>y.value=t),placeholder:"Filter bank...",class:"w-32 px-2 py-1 text-xs bg-gray-50 dark:bg-gray-900 border-none focus:ring-1 focus:ring-blue-500 rounded"},null,512),[[le,y.value]]),e("button",{onClick:I,class:"btn btn-primary btn-xs py-1 px-3 shadow-sm",disabled:l.value},[l.value?(i(),C(W,{key:0,class:"w-3.5 h-3.5 mr-1 animate-spin"})):(i(),C(ee,{key:1,class:"w-3.5 h-3.5 mr-1"})),r[1]||(r[1]=ie(" Memorize Chat "))],8,Ue)]),e("div",Ne,[e("div",Pe,[e("div",Be,[r[2]||(r[2]=e("span",{class:"text-[9px] font-black uppercase text-gray-400 tracking-tighter"},"Active Context Preview",-1)),e("div",Fe,[v.value?(i(),g("span",We,_(v.value.length)+" chars",1)):T("",!0),v.value?(i(),g("span",He,"~"+_(b.value)+" tokens",1)):T("",!0)])]),e("div",Xe,[v.value?(i(),C(de,{key:1,content:v.value,class:"prose-xs"},null,8,["content"])):(i(),g("div",Ge,[d(te,{class:"w-10 h-10 mb-2"}),r[3]||(r[3]=e("p",{class:"text-[10px] uppercase font-black tracking-widest"},"No Active Memories",-1))]))])]),e("div",Ke,[e("div",Ye,[e("span",qe,"Memory Bank ("+_(D.value.length)+")",1),e("button",{onClick:z,class:"p-1 rounded hover:bg-gray-200 dark:hover:bg-gray-700 text-blue-500",title:"Manual Memory Entry"},[d(ce,{class:"w-4 h-4"})])]),e("div",Je,[w(m)?(i(),g("div",Oe,[d(W,{class:"w-6 h-6 text-gray-300 animate-spin mx-auto"})])):D.value.length===0?(i(),g("div",Qe,"Empty")):(i(),C(pe,{key:2,name:"mem",tag:"div",class:"space-y-1"},{default:ue(()=>[(i(!0),g(ve,null,ge(D.value,(t,a)=>(i(),g("div",{key:t.id,class:S(["group p-2 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800/50 flex items-center justify-between transition-all border border-transparent",{"border-green-500/20 bg-green-50/10 dark:bg-green-900/5":s.value.has(t.title)}])},[e("div",et,[e("span",tt,"#"+_(a+1),1),e("button",{onClick:M=>s.value.has(t.title)?U(t.title):V(t.title),class:S(["flex-shrink-0 transition-colors",s.value.has(t.title)?"text-green-500":"text-gray-300 hover:text-gray-400"])},[s.value.has(t.title)?(i(),C(fe,{key:0,class:"w-5 h-5"})):(i(),C(ye,{key:1,class:"w-5 h-5"}))],10,st),e("div",at,[e("span",{class:"text-xs font-bold truncate text-gray-700 dark:text-gray-200",title:t.title},_(t.title),9,ot),e("span",nt,_(x(t.content))+" tokens",1)])]),e("div",rt,[e("button",{onClick:M=>j(t),class:"p-1.5 rounded hover:bg-white dark:hover:bg-gray-700 shadow-sm text-blue-500",title:"Edit"},[d(he,{class:"w-3.5 h-3.5"})],8,lt),e("button",{onClick:M=>A(t.id),class:"p-1.5 rounded hover:bg-red-50 dark:hover:bg-red-900/30 shadow-sm text-red-500",title:"Delete"},[d(q,{class:"w-3.5 h-3.5"})],8,it)])],2))),128))]),_:1}))])])])]))}},ct=O(dt,[["__scopeId","data-v-1e6950f0"]]),ut={class:"flex-1 flex flex-col min-w-0 overflow-hidden"},vt={class:"flex-shrink-0 bg-gray-50 dark:bg-gray-800/80 backdrop-blur-sm border-b border-gray-200 dark:border-gray-700 flex justify-between items-center p-2 h-12"},gt={class:"flex items-center gap-2 px-2"},ft={class:"flex items-center gap-1"},yt=["title"],ht={class:"flex-1 overflow-y-auto custom-scrollbar flex flex-col bg-gray-50/30 dark:bg-gray-900/30"},pt={class:"flex flex-col border-b border-gray-200 dark:border-gray-800 transition-all"},xt={class:"flex items-center gap-3"},bt={class:"p-1.5 rounded-md bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400"},mt={key:0,class:"text-xs text-gray-400 font-mono"},_t={class:"h-96 p-2 pt-0"},kt={class:"flex flex-col border-b border-gray-200 dark:border-gray-800 transition-all"},wt={class:"flex items-center gap-3"},$t={class:"p-1.5 rounded-md bg-purple-100 dark:bg-purple-900/30 text-purple-600 dark:text-purple-400"},Ct={key:0,class:"text-xs text-gray-400 font-mono"},Dt={class:"h-64 p-2 pt-0"},Mt={class:"flex flex-col flex-1 min-h-0"},Tt={class:"flex items-center gap-3"},St={class:"p-1.5 rounded-md bg-green-100 dark:bg-green-900/30 text-green-600 dark:text-green-400"},It={key:0,class:"text-xs text-gray-400 font-mono"},zt={class:"flex-1 p-2 pt-0 min-h-[300px]"},Et={__name:"DataZone",setup(L){const u=X(),k=R(),{liveDataZoneTokens:f}=Z(k),o=$(450),m=$(!1),y=p(()=>u.isDataZoneExpanded),s=$({discussion:!0,personality:!0,memory:!0});function x(c){m.value=!0;const l=c.clientX,h=o.value,v=D=>{m.value&&(o.value=Math.max(320,h-(D.clientX-l)))},b=()=>{m.value=!1,window.removeEventListener("mousemove",v),window.removeEventListener("mouseup",b),localStorage.setItem("lollms_dataZoneWidth",o.value)};window.addEventListener("mousemove",v),window.addEventListener("mouseup",b)}return Q(()=>{const c=localStorage.getItem("lollms_dataZoneWidth");c&&(o.value=parseInt(c,10))}),(c,l)=>(i(),g("div",{class:S(["relative h-full flex flex-shrink-0 border-l border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900 z-10 shadow-2xl",[y.value?"absolute inset-0 w-full":""]]),style:_e(y.value?{}:{width:`${o.value}px`})},[y.value?T("",!0):(i(),g("div",{key:0,onMousedown:H(x,["prevent"]),class:"absolute top-0 bottom-0 -left-1 w-2 cursor-col-resize z-20 hover:bg-blue-500/30 transition-colors"},null,32)),e("div",ut,[e("div",vt,[e("div",gt,[d(Y,{class:"w-4 h-4 text-gray-400"}),l[5]||(l[5]=e("h3",{class:"text-[10px] font-black text-gray-500 dark:text-gray-400 uppercase tracking-widest"},"Context Explorer",-1))]),e("div",ft,[e("button",{onClick:l[0]||(l[0]=h=>w(u).toggleDataZoneExpansion()),class:"p-1.5 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-500 transition-colors",title:y.value?"Shrink":"Expand"},[y.value?(i(),C(xe,{key:0,class:"w-4 h-4"})):(i(),C(be,{key:1,class:"w-4 h-4"}))],8,yt),e("button",{onClick:l[1]||(l[1]=h=>w(u).toggleDataZone()),class:"p-1.5 rounded-lg hover:bg-red-500 hover:text-white text-gray-500 transition-colors",title:"Close Sidebar"},[d(me,{class:"w-4 h-4"})])])]),e("div",ht,[e("div",pt,[e("button",{onClick:l[2]||(l[2]=h=>s.value.discussion=!s.value.discussion),class:"flex-shrink-0 w-full flex items-center justify-between p-4 hover:bg-gray-100 dark:hover:bg-gray-800/50 transition-colors group"},[e("div",xt,[e("div",bt,[d(Y,{class:"w-4 h-4"})]),l[6]||(l[6]=e("span",{class:"text-sm font-bold text-gray-700 dark:text-gray-200"},"Discussion Zone",-1)),w(f).discussion>0?(i(),g("span",mt,"("+_(w(f).discussion)+" tok)",1)):T("",!0)]),d(P,{class:S(["w-4 h-4 text-gray-400 transition-transform duration-300",{"rotate-180":!s.value.discussion}])},null,8,["class"])]),E(e("div",_t,[d(Re)],512),[[B,!s.value.discussion]])]),e("div",kt,[e("button",{onClick:l[3]||(l[3]=h=>s.value.personality=!s.value.personality),class:"flex-shrink-0 w-full flex items-center justify-between p-4 hover:bg-gray-100 dark:hover:bg-gray-800/50 transition-colors group"},[e("div",wt,[e("div",$t,[d(ee,{class:"w-4 h-4"})]),l[7]||(l[7]=e("span",{class:"text-sm font-bold text-gray-700 dark:text-gray-200"},"AI Personality",-1)),w(f).personality>0?(i(),g("span",Ct,"("+_(w(f).personality)+" tok)",1)):T("",!0)]),d(P,{class:S(["w-4 h-4 text-gray-400 transition-transform duration-300",{"rotate-180":!s.value.personality}])},null,8,["class"])]),E(e("div",Dt,[d(je)],512),[[B,!s.value.personality]])]),e("div",Mt,[e("button",{onClick:l[4]||(l[4]=h=>s.value.memory=!s.value.memory),class:"flex-shrink-0 w-full flex items-center justify-between p-4 hover:bg-gray-100 dark:hover:bg-gray-800/50 transition-colors group"},[e("div",Tt,[e("div",St,[d(te,{class:"w-4 h-4"})]),l[8]||(l[8]=e("span",{class:"text-sm font-bold text-gray-700 dark:text-gray-200"},"Long-Term Memory",-1)),w(f).memory>0?(i(),g("span",It,"("+_(w(f).memory)+" tok)",1)):T("",!0)]),d(P,{class:S(["w-4 h-4 text-gray-400 transition-transform duration-300",{"rotate-180":!s.value.memory}])},null,8,["class"])]),E(e("div",zt,[d(ct)],512),[[B,!s.value.memory]])])])])],6))}},Lt=O(Et,[["__scopeId","data-v-5372207d"]]);export{Lt as default};
