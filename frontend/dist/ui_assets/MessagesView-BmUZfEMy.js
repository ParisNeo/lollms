import{j as T,i as R,u as N,c as _,N as b,l as G,$ as U,e as o,o as n,b as t,g as w,f as c,V as q,W as A,ak as P,F as Y,r as J,n as D,a as C,R as K,U as W,t as m,K as L,cD as H,h as O,J as Q,cE as X,ax as Z,v as ee,cq as M,a1 as te,cF as se,q as ae}from"./index-7rLr_kL9.js";const re={class:"flex flex-col h-full bg-white dark:bg-gray-900"},ne={class:"p-4 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center shrink-0"},oe={key:0,class:"p-4 border-b border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800/50"},le={class:"flex justify-end gap-2"},ie={class:"flex-1 overflow-y-auto custom-scrollbar"},de={key:0,class:"p-4 text-center text-gray-500 text-sm"},ue={key:1,class:"p-8 text-center text-gray-500"},ce={key:2,class:"divide-y divide-gray-100 dark:divide-gray-800"},ge=["onClick"],me={class:"relative shrink-0"},_e={key:0,class:"w-10 h-10 rounded-full bg-blue-100 dark:bg-blue-900 flex items-center justify-center text-blue-600 dark:text-blue-300"},fe={key:2,class:"absolute -top-1 -right-1 w-5 h-5 bg-red-500 text-white text-xs font-bold rounded-full flex items-center justify-center ring-2 ring-white dark:ring-gray-900"},pe={class:"flex-1 min-w-0"},ye={class:"flex justify-between items-baseline mb-0.5"},he={class:"font-semibold text-sm text-gray-900 dark:text-gray-100 truncate pr-2"},ve={class:"text-[10px] text-gray-400 shrink-0"},be={class:"text-xs text-gray-500 dark:text-gray-400 truncate h-4"},xe={key:0,class:"opacity-90"},ke={key:1,class:"italic opacity-50"},we=["onClick"],Ce={key:0,class:"menu-dropdown absolute right-0 mt-1 w-32 bg-white dark:bg-gray-800 rounded shadow-lg border dark:border-gray-700 z-10 py-1"},$e=["onClick"],Se={__name:"ConversationList",props:{modelValue:{type:Number,default:null}},emits:["update:modelValue"],setup(x,{emit:i}){const f=x,p=i,l=T(),y=R(),k=N(),h=_(()=>l.conversations),v=_(()=>l.isLoadingConversations);_(()=>y.user);const r=b(!1),d=b(""),$=b([]);function j(a){if(!a)return"";const s=new Date(a),e=new Date;return s.toDateString()===e.toDateString()?s.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):s.toLocaleDateString()}function B(a){const s=a.partner_user_id||a.id;p("update:modelValue",s)}async function F(){d.value.trim()&&(await l.createGroupConversation(d.value,$.value),r.value=!1,d.value="",$.value=[])}const u=b(null);function E(a){u.value=u.value===a?null:a}function S(a){!a.target.closest(".menu-trigger")&&!a.target.closest(".menu-dropdown")&&(u.value=null)}G(()=>{document.addEventListener("click",S)}),U(()=>{document.removeEventListener("click",S)});async function I(a){const s=!!a.is_group,e=s?`Leave "${a.name}"?`:`Delete conversation with ${a.partner_username}?`,g=s?"You will be removed from this group.":"This will delete the conversation history for you.",{confirmed:z}=await k.showConfirmation({title:e,message:g,confirmText:s?"Leave":"Delete"});if(z){const V=s?a.id:a.partner_user_id;await l.deleteConversation(V,s),u.value=null,f.modelValue===V&&p("update:modelValue",null)}}return(a,s)=>(n(),o("div",re,[t("div",ne,[s[3]||(s[3]=t("h2",{class:"font-bold text-lg text-gray-800 dark:text-gray-200"},"Messages",-1)),t("button",{onClick:s[0]||(s[0]=e=>r.value=!r.value),class:"p-1.5 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800 text-blue-600 dark:text-blue-400",title:"New Group"},[c(q,{class:"w-5 h-5"})])]),r.value?(n(),o("div",oe,[A(t("input",{"onUpdate:modelValue":s[1]||(s[1]=e=>d.value=e),type:"text",placeholder:"Group Name",class:"input-field w-full mb-2 text-sm"},null,512),[[P,d.value]]),t("div",le,[t("button",{onClick:s[2]||(s[2]=e=>r.value=!1),class:"btn btn-secondary btn-sm"},"Cancel"),t("button",{onClick:F,class:"btn btn-primary btn-sm"},"Create")])])):w("",!0),t("div",ie,[v.value?(n(),o("div",de,"Loading conversations...")):h.value.length===0?(n(),o("div",ue,s[4]||(s[4]=[t("p",null,"No conversations yet.",-1),t("p",{class:"text-xs mt-1"},"Start a chat from your Friends list.",-1)]))):(n(),o("ul",ce,[(n(!0),o(Y,null,J(h.value,e=>(n(),o("li",{key:e.id+(e.is_group?"_g":"_u"),class:"relative group"},[t("button",{onClick:g=>B(e),class:D(["w-full p-3 flex items-start gap-3 hover:bg-gray-50 dark:hover:bg-gray-800/50 transition-colors text-left",{"bg-blue-50 dark:bg-blue-900/20":x.modelValue===(e.partner_user_id||e.id)}])},[t("div",me,[e.is_group?(n(),o("div",_e,[c(K,{class:"w-6 h-6"})])):(n(),C(W,{key:1,username:e.partner_username,icon:e.partner_icon,"size-class":"w-10 h-10"},null,8,["username","icon"])),e.unread_count>0?(n(),o("span",fe,m(e.unread_count>9?"9+":e.unread_count),1)):w("",!0)]),t("div",pe,[t("div",ye,[t("h3",he,m(e.name||e.partner_username),1),t("span",ve,m(j(e.last_message_at)),1)]),t("p",be,[e.last_message?(n(),o("span",xe,m(e.last_message),1)):(n(),o("span",ke,"No messages"))])])],10,ge),t("div",{class:D(["absolute right-2 top-8 opacity-0 group-hover:opacity-100 transition-opacity",{"opacity-100":u.value===(e.partner_user_id||e.id)}])},[t("button",{onClick:L(g=>E(e.partner_user_id||e.id),["stop"]),class:"menu-trigger p-1 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-500"},[c(H,{class:"w-4 h-4"})],8,we),u.value===(e.partner_user_id||e.id)?(n(),o("div",Ce,[t("button",{onClick:L(g=>I(e),["stop"]),class:"w-full text-left px-3 py-2 text-xs hover:bg-red-50 dark:hover:bg-red-900/30 text-red-600 dark:text-red-400 flex items-center gap-2"},[(n(),C(Q(e.is_group?X:Z),{class:"w-3 h-3"})),O(" "+m(e.is_group?"Leave Group":"Delete"),1)],8,$e)])):w("",!0)],2)]))),128))]))])]))}},Ve={class:"flex h-full bg-white dark:bg-gray-900 overflow-hidden"},De={class:"w-80 flex-shrink-0 border-r border-gray-200 dark:border-gray-700 h-full flex flex-col overflow-hidden"},Le={class:"flex-1 overflow-hidden"},Me={class:"p-4 border-t border-gray-200 dark:border-gray-700 flex-shrink-0"},Te={class:"flex-1 min-w-0 h-full flex flex-col relative"},Ne={key:1,class:"h-full flex flex-col items-center justify-center text-gray-500 dark:text-gray-400 bg-gray-50 dark:bg-gray-800/50"},Ge={class:"p-6 rounded-full bg-gray-100 dark:bg-gray-700 mb-4"},je={__name:"MessagesView",setup(x){const i=T(),f=N(),p=ae(),l=_(()=>i.activeConversationUserId),y=_(()=>l.value?i.activeConversations[l.value]:null);function k(v){const r=i.conversations.find(d=>d.partner_user_id===v);r&&i.openConversation({id:r.partner_user_id,username:r.partner_username,icon:r.partner_icon})}function h(){p.push("/")}return G(()=>{f.setPageTitle({title:"Messages",icon:ee(M)}),i.fetchConversations()}),U(()=>{f.setPageTitle({title:""})}),(v,r)=>(n(),o("div",Ve,[t("div",De,[t("div",Le,[c(Se,{"model-value":l.value,"onUpdate:modelValue":k},null,8,["model-value"])]),t("div",Me,[t("button",{onClick:h,class:"w-full flex items-center gap-3 px-3 py-2.5 text-sm font-medium text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors"},[c(te,{class:"w-5 h-5"}),r[0]||(r[0]=t("span",null,"Back to Discussion",-1))])])]),t("div",Te,[y.value?(n(),C(se,{key:0,conversation:y.value,class:"h-full"},null,8,["conversation"])):(n(),o("div",Ne,[t("div",Ge,[c(M,{class:"w-12 h-12 text-gray-400 dark:text-gray-500"})]),r[1]||(r[1]=t("h3",{class:"text-lg font-medium text-gray-900 dark:text-gray-200"},"Your Messages",-1)),r[2]||(r[2]=t("p",{class:"mt-1 text-sm"},"Select a conversation from the list to start chatting.",-1))]))])]))}};export{je as default};
