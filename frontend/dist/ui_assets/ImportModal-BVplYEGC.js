import{R as N,K as C,s as n,c as v,w as D,n as F,l as f,g,e as t,j as M,t as y,d as p,h as A,z as x,m as V,Z as h,F as j,i as B}from"./index-BT_1XIF6.js";import{_ as E}from"./GenericModal-YcKMPu1i.js";const O={class:"space-y-4"},R={key:0,class:"space-y-2"},U={class:"border dark:border-gray-600 rounded-md max-h-60 overflow-y-auto p-3 space-y-2"},J={class:"border-b dark:border-gray-600 pb-2 mb-2"},T={class:"flex items-center text-sm font-medium cursor-pointer"},$=["value"],L=["disabled"],W={__name:"ImportModal",setup(P){const k=N(),o=C(),d=n(null),m=n(null),i=n([]),l=n([]),u=n(!1),_=v(()=>o.isModalOpen("import"));D(_,a=>{a&&c()});const b=v({get:()=>i.value.length>0&&l.value.length===i.value.length,set:a=>{l.value=a?i.value.map(e=>e.discussion_id):[]}});function c(){d.value=null,i.value=[],l.value=[],m.value&&(m.value.value="")}async function w(a){const e=a.target.files[0];if(!e){c();return}if(e.type!=="application/json"){o.addNotification("Invalid file type. Please select a JSON file.","error"),c();return}d.value=e,o.addNotification("Reading file...","info");try{const s=await e.text(),r=JSON.parse(s);if(!r||!Array.isArray(r.discussions))throw new Error("Invalid import file format.");i.value=r.discussions,l.value=r.discussions.map(I=>I.discussion_id)}catch(s){o.addNotification(`Error reading file: ${s.message}`,"error"),c()}}async function S(){if(!d.value||l.value.length===0){o.addNotification("Please select a file and discussions to import.","warning");return}u.value=!0;try{await k.importDiscussions({file:d.value,discussionIdsToImport:l.value}),o.closeModal("import")}catch{}finally{u.value=!1}}return(a,e)=>(f(),F(E,{modalName:"import",title:"Import Discussions",maxWidthClass:"max-w-lg"},{body:g(()=>[t("div",O,[t("div",null,[e[3]||(e[3]=t("label",{for:"importFile",class:"block text-sm font-medium mb-1"},"Select Exported JSON File (.json)",-1)),t("input",{type:"file",id:"importFile",ref_key:"fileInputRef",ref:m,onChange:w,accept:".json",class:"block w-full text-sm file:mr-4 file:py-1.5 file:px-3 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-100 dark:file:bg-blue-900/50 file:text-blue-700 dark:file:text-blue-300 hover:file:bg-blue-200 dark:hover:file:bg-blue-800/50 border border-gray-300 dark:border-gray-600 rounded-md cursor-pointer"},null,544)]),i.value.length>0?(f(),p("div",R,[e[5]||(e[5]=t("p",{class:"text-sm text-gray-600 dark:text-gray-400"},"Select discussions to import from the file:",-1)),t("div",U,[t("div",J,[t("label",T,[x(t("input",{type:"checkbox","onUpdate:modelValue":e[0]||(e[0]=s=>b.value=s),class:"h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500 mr-2"},null,512),[[h,b.value]]),e[4]||(e[4]=V(" Select All / Deselect All "))])]),(f(!0),p(j,null,B(i.value,s=>(f(),p("label",{key:s.discussion_id,class:"flex items-center text-sm cursor-pointer p-1 rounded hover:bg-gray-100 dark:hover:bg-gray-700"},[x(t("input",{type:"checkbox",value:s.discussion_id,"onUpdate:modelValue":e[1]||(e[1]=r=>l.value=r),class:"h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500 mr-2"},null,8,$),[[h,l.value]]),t("span",null,y(s.title||"Untitled Discussion"),1)]))),128))])])):A("",!0)])]),footer:g(()=>[t("button",{onClick:e[2]||(e[2]=s=>M(o).closeModal("import")),class:"btn btn-secondary"},"Cancel"),t("button",{onClick:S,class:"btn btn-primary",disabled:u.value||l.value.length===0},y(u.value?"Importing...":"Import Selected"),9,L)]),_:1}))}};export{W as default};
