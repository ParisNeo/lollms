import{X as P,a0 as j,a2 as w,K as g,o as I,d as l,l as o,e as t,f as L,m as d,O as v,a6 as p,j as r,F as y,i as _,t as h,n as u,ax as x,x as R,h as O,aa as Z}from"./index-BETWUTlj.js";import{u as D}from"./admin-BOxMOks4.js";import{_ as B}from"./AdminView-Mwt--LsL.js";import"./PageViewLayout-l-f6leZm.js";import"./IconKey-B3IVckhh.js";const E={class:"space-y-8 pb-20"},Y={class:"bg-white dark:bg-gray-800 shadow-md rounded-lg overflow-hidden border border-red-200 dark:border-red-900/30"},G={class:"p-6 bg-red-50 dark:bg-red-950/20 border-b border-red-200 dark:border-red-900/30"},$={class:"flex items-center gap-3"},K={class:"p-6 space-y-6"},X={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},q=["disabled"],z=["value"],H=["value"],J=["value"],Q=["value"],W={class:"flex justify-end pt-4 border-t dark:border-gray-700"},ee=["disabled"],te={class:"bg-white dark:bg-gray-800 shadow-md rounded-lg"},se={class:"divide-y divide-gray-200 dark:divide-gray-700"},oe={class:"p-6 flex items-center justify-between gap-4"},ae=["disabled"],le={class:"p-6 flex items-center justify-between gap-4"},ie=["disabled"],fe={__name:"Operations",setup(ne){const i=D(),n=P(),m=j(),{adminAvailableLollmsModels:C,isLoadingLollmsModels:T}=w(i),{availableTtiModels:A,availableTtsModels:M,availableSttModels:S,availableItiModels:de}=w(m),b=g(!1),c=g(!1),f=g(!1),a=g({lollms_model_name:"",tti_binding_model_name:"",tts_binding_model_name:"",stt_binding_model_name:"",iti_binding_model_name:""});I(()=>{i.fetchAdminAvailableLollmsModels(),m.fetchAdminAvailableTtiModels(),m.fetchAdminAvailableTtsModels(),m.fetchAdminAvailableSttModels()});async function F(){if((await n.showConfirmation({title:"Purge Temporary Files?",message:"This will delete all temporary uploaded files older than 24 hours. This action cannot be undone.",confirmText:"Yes, Purge"})).confirmed){b.value=!0;try{await i.purgeUnusedUploads(),n.addNotification("Purge task started.","info")}finally{b.value=!1}}}async function U(){f.value=!0;try{await i.refreshZooCache(),n.addNotification("Zoo cache rebuild task started.","info")}finally{f.value=!1}}async function N(){if((await n.showConfirmation({title:"Force Global Configuration?",message:"This will instantly change the model settings for EVERY user in the system. Active sessions will be refreshed. Continue?",confirmText:"Yes, Force All",isDanger:!0})).confirmed){c.value=!0;try{const e=Object.fromEntries(Object.entries(a.value).filter(([s,V])=>V!==""));if(Object.keys(e).length===0){n.addNotification("Please select at least one model to force.","warning");return}await i.forceAllUsersConfig(e)}finally{c.value=!1}}}return(k,e)=>(o(),l("div",E,[t("div",Y,[t("div",G,[t("div",$,[L(B,{class:"w-6 h-6 text-red-600 dark:text-red-400"}),e[4]||(e[4]=t("h3",{class:"text-xl font-bold text-red-900 dark:text-red-100"},"Force Global AI Configuration",-1))]),e[5]||(e[5]=t("p",{class:"mt-2 text-sm text-red-700 dark:text-red-300"},[d(" Instantly override the model settings for "),t("b",null,"every registered user"),d(". Use this to migrate the whole server to new models or enforce specific bindings. ")],-1))]),t("div",K,[t("div",X,[t("div",null,[e[7]||(e[7]=t("label",{class:"block text-sm font-bold mb-1"},"Force LLM Model",-1)),v(t("select",{"onUpdate:modelValue":e[0]||(e[0]=s=>a.value.lollms_model_name=s),class:"input-field",disabled:r(T)},[e[6]||(e[6]=t("option",{value:""},"-- No Change --",-1)),(o(!0),l(y,null,_(r(C),s=>(o(),l("option",{key:s.id,value:s.id},h(s.name),9,z))),128))],8,q),[[p,a.value.lollms_model_name]])]),t("div",null,[e[9]||(e[9]=t("label",{class:"block text-sm font-bold mb-1"},"Force TTI (Images)",-1)),v(t("select",{"onUpdate:modelValue":e[1]||(e[1]=s=>a.value.tti_binding_model_name=s),class:"input-field"},[e[8]||(e[8]=t("option",{value:""},"-- No Change --",-1)),(o(!0),l(y,null,_(r(A),s=>(o(),l("option",{key:s.id,value:s.id},h(s.name),9,H))),128))],512),[[p,a.value.tti_binding_model_name]])]),t("div",null,[e[11]||(e[11]=t("label",{class:"block text-sm font-bold mb-1"},"Force TTS (Speech)",-1)),v(t("select",{"onUpdate:modelValue":e[2]||(e[2]=s=>a.value.tts_binding_model_name=s),class:"input-field"},[e[10]||(e[10]=t("option",{value:""},"-- No Change --",-1)),(o(!0),l(y,null,_(r(M),s=>(o(),l("option",{key:s.id,value:s.id},h(s.name),9,J))),128))],512),[[p,a.value.tts_binding_model_name]])]),t("div",null,[e[13]||(e[13]=t("label",{class:"block text-sm font-bold mb-1"},"Force STT (Voice-to-Text)",-1)),v(t("select",{"onUpdate:modelValue":e[3]||(e[3]=s=>a.value.stt_binding_model_name=s),class:"input-field"},[e[12]||(e[12]=t("option",{value:""},"-- No Change --",-1)),(o(!0),l(y,null,_(r(S),s=>(o(),l("option",{key:s.id,value:s.id},h(s.name),9,Q))),128))],512),[[p,a.value.stt_binding_model_name]])])]),t("div",W,[t("button",{onClick:N,class:"btn btn-danger flex items-center gap-2",disabled:c.value},[c.value?(o(),u(x,{key:0,class:"w-5 h-5 animate-spin"})):(o(),u(R,{key:1,class:"w-5 h-5"})),e[14]||(e[14]=d(" Apply to All Users "))],8,ee)])])]),t("div",te,[e[19]||(e[19]=t("div",{class:"p-6 border-b border-gray-200 dark:border-gray-700"},[t("h3",{class:"text-xl font-semibold text-gray-900 dark:text-white"},"Maintenance Operations")],-1)),t("div",se,[t("div",oe,[e[16]||(e[16]=t("div",null,[t("h4",{class:"font-bold text-gray-800 dark:text-gray-200"},"Purge Unused Uploads"),t("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"Deletes temporary files older than 24 hours that aren't attached to active discussions.")],-1)),t("button",{onClick:F,class:"btn btn-danger-outline whitespace-nowrap",disabled:b.value},[b.value?(o(),u(x,{key:0,class:"w-4 h-4 mr-2 animate-spin"})):O("",!0),e[15]||(e[15]=d(" Start Purge "))],8,ae)]),t("div",le,[e[18]||(e[18]=t("div",null,[t("h4",{class:"font-bold text-gray-800 dark:text-gray-200"},"Refresh Zoo Cache"),t("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"Force a background rescan of all Zoo repositories to update metadata and availability.")],-1)),t("button",{onClick:U,class:"btn btn-secondary whitespace-nowrap",disabled:f.value},[f.value?(o(),u(x,{key:0,class:"w-4 h-4 mr-2 animate-spin"})):(o(),u(Z,{key:1,class:"w-4 h-4 mr-2"})),e[17]||(e[17]=d(" Refresh Zoo "))],8,ie)])])])]))}};export{fe as default};
