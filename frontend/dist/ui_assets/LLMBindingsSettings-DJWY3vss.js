const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["ui_assets/BindingModelsManager-Bn7EVhWG.js","ui_assets/index-C3WkowhT.js","ui_assets/index-CS9XwHwO.css","ui_assets/admin-C-YlnQsG.js","ui_assets/BindingZoo-C-pw9c9z.js"])))=>i.map(i=>d[i]);
import{u as de,R as ue,az as H,r as p,b as E,S as J,d as ce,c as o,o as l,a as t,h as v,t as r,n as g,J as S,G as x,K,L as F,F as B,j as A,A as w,ed as me,aD as ve,f as O,aE as ge,ao as fe,M as be,p as U,g as T,ee as pe,y as ye,U as xe,ab as Z,a0 as _e,ai as Q}from"./index-C3WkowhT.js";import{u as ke}from"./admin-C-YlnQsG.js";import{_ as he}from"./JsonRenderer-C0xrDYe0.js";const we={class:"space-y-8"},Ce={key:0,class:"bg-white dark:bg-gray-800 shadow-md rounded-lg p-6"},Se={class:"flex justify-between items-center mb-4"},Be={class:"text-xl font-semibold"},Ae={key:0,class:"flex gap-2 text-sm font-medium overflow-x-auto"},Te={key:0},$e={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},Me=["disabled"],je=["value"],De={key:0,class:"space-y-6 border-t dark:border-gray-700 pt-6"},Ne=["innerHTML"],Ve=["for"],Ee={key:0,class:"text-red-500"},Le=["id","onUpdate:modelValue"],Fe=["value"],Oe={key:1},Ue={class:"relative"},ze=["type","id","onUpdate:modelValue","required","placeholder"],Ie=["onClick","title"],Pe={key:2,class:"flex items-center justify-between bg-gray-50 dark:bg-gray-700/50 p-3 rounded-md"},qe={class:"flex-grow flex flex-col pr-4"},Ge={class:"text-sm text-gray-500 dark:text-gray-400"},Re=["onClick"],He={class:"text-xs text-gray-500 mt-1"},Je={class:"flex items-center justify-between bg-gray-50 dark:bg-gray-700/50 p-3 rounded-md"},Ke={class:"flex justify-end gap-3"},Ze=["disabled"],Qe={key:1,class:"space-y-6"},We={key:0},Xe={class:"flex justify-between items-start mb-3"},Ye={class:"font-bold text-md flex items-center gap-2"},et={class:"text-sm text-gray-600 dark:text-gray-400 mt-1"},tt=["onClick","disabled"],st={key:0,class:"space-y-3 mb-4 p-3 bg-white dark:bg-gray-800 rounded border dark:border-gray-700"},nt={class:"block text-xs font-medium uppercase text-gray-500 dark:text-gray-400 mb-1"},at=["onUpdate:modelValue","placeholder"],lt={key:1,class:"flex items-center gap-2"},ot=["onClick"],it={class:"text-sm text-gray-600 dark:text-gray-400"},rt={key:1,class:"mt-4"},dt={class:"flex justify-between text-xs mb-1 font-semibold text-blue-600 dark:text-blue-400"},ut={class:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2"},ct={class:"text-xs text-gray-500 mt-1 truncate"},mt={key:2,class:"mt-4 p-3 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-md"},vt={key:0},gt={key:1,class:"whitespace-pre-wrap text-sm text-gray-800 dark:text-gray-200 font-mono"},ft={key:3,class:"mt-4 p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-md"},bt={class:"text-xs font-bold text-red-800 dark:text-red-300 mb-2 uppercase flex items-center gap-2"},pt={class:"text-sm text-red-700 dark:text-red-400"},yt={key:1,class:"text-center text-gray-500 py-8 border-2 border-dashed border-gray-200 dark:border-gray-700 rounded-lg"},xt={key:2},_t={key:3},kt={key:1},ht={class:"flex justify-between items-center mb-4 flex-wrap gap-4"},wt={class:"flex items-center gap-4"},Ct={key:0,class:"text-center p-6"},St={key:1,class:"text-center p-6 bg-gray-50 dark:bg-gray-800/50 rounded-lg"},Bt={key:2,class:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6"},At=["onClick"],Tt=["onClick","title"],$t={class:"flex-grow"},Mt={class:"flex items-center gap-3 mb-2"},jt={class:"font-bold text-lg text-gray-900 dark:text-white"},Dt={class:"text-xs text-gray-500 dark:text-gray-400"},Nt={class:"mt-3 text-sm text-gray-600 dark:text-gray-300"},Vt={key:0,class:"mb-1"},Et={class:"text-xs text-gray-400 truncate"},Lt={class:"border-t dark:border-gray-700 pt-3 flex justify-between items-center text-xs text-gray-500"},Ft=["onClick"],qt={__name:"LLMBindingsSettings",setup(Ot){const W=Z(()=>Q(()=>import("./BindingModelsManager-Bn7EVhWG.js"),__vite__mapDeps([0,1,2,3]))),X=Z(()=>Q(()=>import("./BindingZoo-C-pw9c9z.js"),__vite__mapDeps([4,1,2,3]))),f=ke(),$=de(),z=ue(),{bindings:I,availableBindingTypes:M,isLoadingBindings:Y,globalSettings:P}=H(f),{tasks:ee}=H(z),L=p(!1),_=p(null),j=p(!1),k=p({}),b=p({}),d=p("settings"),D=p(null),N=p(null),h=p(null),u=E(()=>D.value?ee.value.find(n=>n.id===D.value):null);J(u,n=>{n&&n.status==="completed"&&(h.value=n.result)},{deep:!0});const q=()=>({id:null,alias:"",name:"",config:{},default_model_name:"",is_active:!0}),i=p(q()),C=E(()=>_.value!==null),y=E(()=>i.value.name?M.value.find(n=>(n.binding_name||n.name)===i.value.name):null),te=E(()=>{if(!y.value)return[];const n=y.value.input_parameters||[],s=new Set(n.map(c=>c.name)),e=y.value.model_parameters||[],a=new Set(e.map(c=>c.name)),m=Object.keys(i.value.config||{}).filter(c=>!s.has(c)&&!a.has(c)&&c!=="model_name"&&c!=="model"&&c!=="class").map(c=>({name:c,type:typeof i.value.config[c]=="boolean"?"bool":typeof i.value.config[c]=="number"?"float":"str",description:"(Parameter not in binding description)",mandatory:!1}));return[...n.filter(c=>!a.has(c.name)&&c.name!=="model_name"),...m]});J(()=>i.value.name,(n,s)=>{if(n!==s&&!C.value){const e=M.value.find(m=>(m.binding_name||m.name)===n),a={};e&&e.input_parameters&&e.input_parameters.forEach(m=>{a[m.name]=m.default}),i.value.config=a}});const G=E({get(){if(!Array.isArray(P.value))return"mixed";const n=P.value.find(s=>s.key==="model_display_mode");return n?n.value:"mixed"},set(n){f.updateGlobalSettings({model_display_mode:n})}});ce(()=>{f.fetchBindings(),f.fetchAvailableBindingTypes(),f.fetchGlobalSettings()});function R(){_.value=null,i.value=q(),k.value={},b.value={},L.value=!0,d.value="settings",window.scrollTo({top:0,behavior:"smooth"})}function se(n){_.value=n,i.value=JSON.parse(JSON.stringify(n)),i.value.config||(i.value.config={}),k.value={};const s=M.value.find(e=>(e.binding_name||e.name)===n.name);if(s&&s.commands){const e={};s.commands.forEach(a=>{e[a.name]={},a.parameters&&a.parameters.forEach(m=>{e[a.name][m.name]=m.default!==void 0?m.default:""})}),b.value=e}else b.value={};D.value=null,h.value=null,N.value=null,L.value=!0,d.value="settings",window.scrollTo({top:0,behavior:"smooth"})}function V(){L.value=!1,_.value=null}function ne(n){return typeof n=="string"?n.split(",").map(s=>s.trim()).filter(s=>s):Array.isArray(n)?n.filter(s=>s):[]}async function ae(){if(!i.value.alias.trim()||!i.value.name){$.addNotification("Alias and Binding Type are required fields.","warning");return}j.value=!0;try{const n={alias:i.value.alias,name:i.value.name,config:i.value.config||{},is_active:i.value.is_active,default_model_name:i.value.default_model_name||null};C.value?await f.updateBinding(_.value.id,n):await f.addBinding(n),V()}catch(n){console.error("Submit failed:",n.message)}finally{j.value=!1}}async function le(n){await $.showConfirmation({title:`Delete Binding '${n.alias}'?`,message:"Are you sure? This action cannot be undone.",confirmText:"Delete"})&&await f.deleteBinding(n.id)}async function oe(n){await f.updateBinding(n.id,{is_active:!n.is_active})}function ie(n){const s=M.value.find(e=>(e.binding_name||e.name)===n);return s?s.title||s.name:n}async function re(n,s,e){D.value=null,h.value=null,N.value=n.name;try{$.addNotification(`Submitting command '${n.title||n.name}'...`,"info");const a=await f.executeBindingCommand(s,n.name,e);a&&a.id&&(D.value=a.id,z.addTask(a),$.addNotification(`Task started: ${n.title||n.name}`,"success"))}catch(a){console.error(a),$.addNotification(`Command submission failed: ${a.message}`,"error")}}return(n,s)=>(l(),o("div",we,[L.value?(l(),o("div",Ce,[t("div",Se,[t("h3",Be,r(C.value?"Edit Binding: "+i.value.alias:"Add New Binding"),1),C.value?(l(),o("div",Ae,[t("button",{onClick:s[0]||(s[0]=e=>d.value="settings"),class:g([{"text-blue-600 border-b-2 border-blue-600":d.value==="settings","text-gray-500 hover:text-gray-700":d.value!=="settings"},"px-3 py-2 whitespace-nowrap"])},"Settings",2),t("button",{onClick:s[1]||(s[1]=e=>d.value="commands"),class:g([{"text-blue-600 border-b-2 border-blue-600":d.value==="commands","text-gray-500 hover:text-gray-700":d.value!=="commands"},"px-3 py-2 whitespace-nowrap"])},"Commands",2),t("button",{onClick:s[2]||(s[2]=e=>d.value="zoo"),class:g([{"text-blue-600 border-b-2 border-blue-600":d.value==="zoo","text-gray-500 hover:text-gray-700":d.value!=="zoo"},"px-3 py-2 whitespace-nowrap"])},"Models Zoo",2),t("button",{onClick:s[3]||(s[3]=e=>d.value="models"),class:g([{"text-blue-600 border-b-2 border-blue-600":d.value==="models","text-gray-500 hover:text-gray-700":d.value!=="models"},"px-3 py-2 whitespace-nowrap"])},"Installed Models",2)])):v("",!0)]),d.value==="settings"?(l(),o("div",Te,[t("form",{onSubmit:U(ae,["prevent"]),class:"space-y-6"},[t("div",$e,[t("div",null,[s[9]||(s[9]=t("label",{for:"alias",class:"block text-sm font-medium"},[x("Alias "),t("span",{class:"text-red-500"},"*")],-1)),S(t("input",{type:"text",id:"alias","onUpdate:modelValue":s[4]||(s[4]=e=>i.value.alias=e),class:"input-field mt-1",required:"",placeholder:"e.g., local_ollama",autocomplete:"off"},null,512),[[K,i.value.alias]]),s[10]||(s[10]=t("p",{class:"text-xs text-gray-500 mt-1"},"A unique, short name for this configuration.",-1))]),t("div",null,[s[12]||(s[12]=t("label",{for:"name",class:"block text-sm font-medium"},[x("Binding Type "),t("span",{class:"text-red-500"},"*")],-1)),S(t("select",{id:"name","onUpdate:modelValue":s[5]||(s[5]=e=>i.value.name=e),class:"input-field mt-1",required:"",disabled:C.value},[s[11]||(s[11]=t("option",{disabled:"",value:""},"Select a type",-1)),(l(!0),o(B,null,A(w(M),e=>(l(),o("option",{key:e.binding_name||e.name,value:e.binding_name||e.name},r(e.title||e.name),9,je))),128))],8,Me),[[F,i.value.name]])])]),y.value?(l(),o("div",De,[t("div",{class:"text-sm text-gray-600 dark:text-gray-400 prose dark:prose-invert max-w-none",innerHTML:w(me)(y.value.description||"")},null,8,Ne),(l(!0),o(B,null,A(te.value,e=>(l(),o("div",{key:e.name,class:"space-y-1"},[t("label",{for:`param-${e.name}`,class:"block text-sm font-medium capitalize"},[x(r(e.name.replace(/_/g," "))+" ",1),e.mandatory?(l(),o("span",Ee,"*")):v("",!0)],8,Ve),e.options&&e.options.length>0?S((l(),o("select",{key:0,id:`param-${e.name}`,"onUpdate:modelValue":a=>i.value.config[e.name]=a,class:"input-field"},[(l(!0),o(B,null,A(ne(e.options),a=>(l(),o("option",{key:a,value:a},r(a),9,Fe))),128))],8,Le)),[[F,i.value.config[e.name]]]):["str","int","float"].includes(e.type)?(l(),o("div",Oe,[t("div",Ue,[S(t("input",{type:(e.name.includes("key")||e.name.includes("token"))&&!k.value[e.name]?"password":"text",id:`param-${e.name}`,"onUpdate:modelValue":a=>i.value.config[e.name]=a,class:"input-field",required:e.mandatory,placeholder:e.description,autocomplete:"off"},null,8,ze),[[ve,i.value.config[e.name]]]),e.name.includes("key")||e.name.includes("token")?(l(),o("button",{key:0,type:"button",onClick:a=>k.value[e.name]=!k.value[e.name],class:"absolute inset-y-0 right-0 px-3 flex items-center text-gray-500 hover:text-gray-700 dark:hover:text-gray-300",title:k.value[e.name]?"Hide":"Show"},[k.value[e.name]?(l(),O(ge,{key:0,class:"w-5 h-5"})):(l(),O(fe,{key:1,class:"w-5 h-5"}))],8,Ie)):v("",!0)])])):e.type==="bool"?(l(),o("div",Pe,[t("span",qe,[t("span",Ge,r(e.description),1)]),t("button",{onClick:a=>i.value.config[e.name]=!i.value.config[e.name],type:"button",class:g([i.value.config[e.name]?"bg-blue-600":"bg-gray-200 dark:bg-gray-600","relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out"])},[t("span",{class:g([i.value.config[e.name]?"translate-x-5":"translate-x-0","pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition-colors duration-200 ease-in-out"])},null,2)],10,Re)])):v("",!0),t("p",He,r(e.description),1)]))),128))])):v("",!0),t("div",Je,[s[13]||(s[13]=t("span",{class:"flex-grow flex flex-col"},[t("span",{class:"text-sm font-medium text-gray-900 dark:text-gray-100"},"Active"),t("span",{class:"text-sm text-gray-500 dark:text-gray-400"},"If disabled, users cannot see or use models from this binding.")],-1)),t("button",{onClick:s[6]||(s[6]=e=>i.value.is_active=!i.value.is_active),type:"button",class:g([i.value.is_active?"bg-blue-600":"bg-gray-200 dark:bg-gray-600","relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out"])},[t("span",{class:g([i.value.is_active?"translate-x-5":"translate-x-0","pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition-colors duration-200 ease-in-out"])},null,2)],2)]),t("div",Ke,[t("button",{type:"button",onClick:V,class:"btn btn-secondary"},"Close"),t("button",{type:"submit",class:"btn btn-primary",disabled:j.value},[j.value?(l(),O(be,{key:0,class:"w-5 h-5 mr-2"})):v("",!0),x(" "+r(j.value?"Saving...":C.value?"Save Changes":"Add Binding"),1)],8,Ze)])],32)])):d.value==="commands"?(l(),o("div",Qe,[y.value&&y.value.commands&&y.value.commands.length>0?(l(),o("div",We,[(l(!0),o(B,null,A(y.value.commands,e=>(l(),o("div",{key:e.name,class:"p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg border dark:border-gray-600 mb-4"},[t("div",Xe,[t("div",null,[t("h5",Ye,[T(pe,{class:"w-4 h-4 text-gray-500"}),x(" "+r(e.title||e.name),1)]),t("p",et,r(e.description),1)]),t("button",{type:"button",onClick:a=>re(e,_.value.id,b.value[e.name]),class:"btn btn-primary btn-sm flex items-center gap-2",disabled:u.value&&u.value.status==="running"},[T(ye,{class:"w-4 h-4"}),s[14]||(s[14]=x(" Execute "))],8,tt)]),e.parameters&&e.parameters.length>0?(l(),o("div",st,[(l(!0),o(B,null,A(e.parameters,a=>(l(),o("div",{key:a.name},[t("label",nt,r(a.name),1),a.type!=="bool"?S((l(),o("input",{key:0,type:"text","onUpdate:modelValue":m=>b.value[e.name][a.name]=m,class:"input-field text-sm",placeholder:a.default},null,8,at)),[[K,b.value[e.name][a.name]]]):(l(),o("div",lt,[t("button",{onClick:m=>b.value[e.name][a.name]=!b.value[e.name][a.name],type:"button",class:g([b.value[e.name][a.name]?"bg-blue-600":"bg-gray-200 dark:bg-gray-600","relative inline-flex h-5 w-9 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out"])},[t("span",{class:g([b.value[e.name][a.name]?"translate-x-4":"translate-x-0","pointer-events-none inline-block h-4 w-4 transform rounded-full bg-white shadow ring-0 transition-colors duration-200 ease-in-out"])},null,2)],10,ot),t("span",it,r(a.description),1)]))]))),128))])):v("",!0),u.value&&N.value===e.name&&(u.value.status==="running"||u.value.status==="pending")?(l(),o("div",rt,[t("div",dt,[s[15]||(s[15]=t("span",null,"Executing...",-1)),t("span",null,r(u.value.progress)+"%",1)]),t("div",ut,[t("div",{class:"bg-blue-600 h-2 rounded-full transition-all duration-300 relative overflow-hidden",style:xe({width:u.value.progress+"%"})},s[16]||(s[16]=[t("div",{class:"absolute inset-0 bg-white/20 animate-[pulse_2s_cubic-bezier(0.4,0,0.6,1)_infinite]"},null,-1)]),4)]),t("p",ct,r(u.value.description),1)])):v("",!0),h.value&&N.value===e.name&&u.value&&u.value.status==="completed"?(l(),o("div",mt,[s[17]||(s[17]=t("h6",{class:"text-xs font-bold text-green-800 dark:text-green-300 mb-2 uppercase flex items-center gap-2"},[t("span",{class:"w-2 h-2 rounded-full bg-green-500"}),x(" Success ")],-1)),typeof h.value=="object"?(l(),o("div",vt,[T(he,{json:h.value},null,8,["json"])])):(l(),o("div",gt,r(h.value),1))])):v("",!0),u.value&&N.value===e.name&&(u.value.status==="failed"||u.value.status==="cancelled")?(l(),o("div",ft,[t("h6",bt,[s[18]||(s[18]=t("span",{class:"w-2 h-2 rounded-full bg-red-500"},null,-1)),x(" "+r(u.value.status),1)]),t("p",pt,r(u.value.error),1)])):v("",!0)]))),128))])):(l(),o("div",yt," No commands available for this binding type. ")),t("div",{class:"flex justify-end gap-3 mt-4"},[t("button",{type:"button",onClick:V,class:"btn btn-secondary"},"Close")])])):d.value==="zoo"?(l(),o("div",xt,[T(w(X),{binding:_.value,"binding-type":"llm"},null,8,["binding"]),t("div",{class:"flex justify-end gap-3 mt-4"},[t("button",{type:"button",onClick:V,class:"btn btn-secondary"},"Close")])])):d.value==="models"?(l(),o("div",_t,[T(w(W),{binding:_.value,"binding-type":"llm"},null,8,["binding"]),t("div",{class:"flex justify-end gap-3 mt-4"},[t("button",{type:"button",onClick:V,class:"btn btn-secondary"},"Close")])])):v("",!0)])):(l(),o("div",kt,[t("div",ht,[s[21]||(s[21]=t("h2",{class:"text-2xl font-bold"},"LLM Bindings",-1)),t("div",wt,[t("div",null,[s[20]||(s[20]=t("label",{for:"model-display-mode",class:"block text-xs font-medium text-gray-500 dark:text-gray-400"},"Model Display Mode",-1)),S(t("select",{id:"model-display-mode","onUpdate:modelValue":s[7]||(s[7]=e=>G.value=e),class:"input-field mt-1"},s[19]||(s[19]=[t("option",{value:"mixed"},"Mixed (Alias or Original)",-1),t("option",{value:"aliased"},"Aliased Only",-1),t("option",{value:"original"},"Original Names Only",-1)]),512),[[F,G.value]])]),t("button",{onClick:R,class:"btn btn-primary self-end"},"+ Add New Binding")])]),w(Y)?(l(),o("div",Ct,"Loading bindings...")):w(I).length===0?(l(),o("div",St,[s[22]||(s[22]=t("p",null,"No LLM bindings configured yet.",-1)),t("button",{onClick:R,class:"mt-2 text-blue-600 hover:underline"},"Add your first one")])):(l(),o("div",Bt,[(l(!0),o(B,null,A(w(I),e=>(l(),o("div",{key:e.id,onClick:a=>se(e),class:"bg-white dark:bg-gray-800 p-5 rounded-lg shadow-md hover:shadow-lg transition-shadow cursor-pointer flex flex-col gap-4 border border-transparent hover:border-blue-500 group relative"},[t("div",{class:"absolute top-4 right-4 z-10",onClick:s[8]||(s[8]=U(()=>{},["stop"]))},[t("button",{onClick:a=>oe(e),type:"button",class:g([e.is_active?"bg-blue-600":"bg-gray-200 dark:bg-gray-600","relative inline-flex h-5 w-9 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out"]),title:e.is_active?"Deactivate":"Activate"},[t("span",{class:g([e.is_active?"translate-x-4":"translate-x-0","pointer-events-none inline-block h-4 w-4 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out"])},null,2)],10,Tt)]),t("div",$t,[t("div",Mt,[T(_e,{class:"w-8 h-8 text-blue-500"}),t("div",null,[t("h4",jt,r(e.alias),1),t("p",Dt,r(ie(e.name)),1)])]),t("div",Nt,[e.default_model_name?(l(),o("p",Vt,[s[23]||(s[23]=t("span",{class:"font-semibold"},"Default:",-1)),x(" "+r(e.default_model_name),1)])):v("",!0),t("p",Et,r(e.config?Object.keys(e.config).filter(a=>!a.includes("key")).join(", "):""),1)])]),t("div",Lt,[s[24]||(s[24]=t("span",null,"Click to edit",-1)),t("button",{onClick:U(a=>le(e),["stop"]),class:"text-red-500 hover:underline p-1"},"Delete",8,Ft)])],8,At))),128))]))]))]))}};export{qt as default};
