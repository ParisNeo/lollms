import{d5 as Q,d6 as G,d7 as W,d8 as Y,d9 as X,da as ee,db as te,dc as se,dd as ae,u as R,L as p,c as A,k as oe,a as z,o as l,w as V,b as e,t as c,d as E,e as r,f as I,ax as ne,ad as le,h as re,n as ie,a2 as de,j as ce,l as h,P as U,Y as ue,a6 as j,a8 as B,p as b,F as ve,m as me,U as pe,J as O}from"./index-x6ZZ9rZx.js";import{u as F}from"./admin-BhxeX2xU.js";import{L as fe}from"./chartjs-adapter-date-fns.esm-BgtRwq9H.js";import{_ as ge}from"./GenericModal-YfGAAqtG.js";const ye={key:0,class:"flex justify-center items-center h-96"},_e={key:1,class:"text-center h-96 flex items-center justify-center"},he={key:2},be={class:"h-96"},ke=["disabled"],xe={__name:"UserStatsModal",props:{userId:{type:Number,required:!0},username:{type:String,required:!0}},setup($){Q.register(G,W,Y,X,ee,te,se,ae);const u=$,g=F(),f=R(),_=p(null),m=p(!0),k=p(null),x=A(()=>({responsive:!0,maintainAspectRatio:!1,scales:{x:{type:"time",time:{unit:"day",tooltipFormat:"MMM d, yyyy",displayFormats:{day:"MMM d"}},grid:{color:f.currentTheme==="dark"?"rgba(255, 255, 255, 0.1)":"rgba(0, 0, 0, 0.1)"},ticks:{color:f.currentTheme==="dark"?"#cbd5e1":"#4b5563"}},y:{beginAtZero:!0,grid:{color:f.currentTheme==="dark"?"rgba(255, 255, 255, 0.1)":"rgba(0, 0, 0, 0.1)"},ticks:{color:f.currentTheme==="dark"?"#cbd5e1":"#4b5563",stepSize:1}}},plugins:{legend:{labels:{color:f.currentTheme==="dark"?"#cbd5e1":"#4b5563"}}}})),M=A(()=>{if(!_.value)return{labels:[],datasets:[]};const o=new Map;for(let n=29;n>=0;n--){const S=new Date;S.setDate(S.getDate()-n),o.set(S.toISOString().split("T")[0],{tasks:0,messages:0})}_.value.tasks_per_day.forEach(n=>{o.has(n.date)&&(o.get(n.date).tasks=n.count)}),_.value.messages_per_day.forEach(n=>{o.has(n.date)&&(o.get(n.date).messages=n.count)});const i=Array.from(o.keys()),d=Array.from(o.values()).map(n=>n.tasks),w=Array.from(o.values()).map(n=>n.messages);return{labels:i,datasets:[{label:"Tasks Created",backgroundColor:"#3b82f6",borderColor:"#3b82f6",data:d,tension:.1},{label:"AI Generations",backgroundColor:"#10b981",borderColor:"#10b981",data:w,tension:.1}]}});async function C(){m.value=!0;try{_.value=await g.fetchUserStats(u.userId)}finally{m.value=!1}}function v(){if(k.value&&k.value.chart){const o=document.createElement("a");o.href=k.value.chart.toBase64Image("image/png",1),o.download=`user_stats_${u.username}.png`,o.click()}else f.addNotification("Could not export chart.","error")}return oe(()=>u.userId,o=>{o&&C()},{immediate:!0}),(o,i)=>(l(),z(ge,{modalName:"userStats",title:`Usage Statistics for ${$.username}`,maxWidthClass:"max-w-4xl"},{body:V(()=>[m.value?(l(),r("div",ye,[I(ne,{class:"w-8 h-8 text-blue-500"})])):_.value?(l(),r("div",he,[i[2]||(i[2]=e("p",{class:"text-sm text-gray-500 mb-4"},"Showing activity for the last 30 days.",-1)),e("div",be,[I(E(fe),{data:M.value,options:x.value,ref_key:"chartRef",ref:k},null,8,["data","options"])])])):(l(),r("div",_e,i[1]||(i[1]=[e("p",{class:"text-gray-500"},"Could not load statistics for this user.",-1)])))]),footer:V(()=>[e("button",{onClick:C,class:"btn btn-secondary",disabled:m.value},c(m.value?"Reloading...":"Reload Data"),9,ke),e("button",{onClick:v,class:"btn btn-secondary"},"Export Image"),i[3]||(i[3]=e("div",{class:"flex-grow"},null,-1)),e("button",{onClick:i[0]||(i[0]=d=>E(f).closeModal("userStats")),class:"btn btn-primary"},"Close")]),_:1},8,["title"]))}},Ce={},we={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",class:"w-5 h-5"};function Se($,u){return l(),r("svg",we,u[0]||(u[0]=[e("path",{d:"M7.05025 1.53553C8.03344 0.552348 9.36692 0 10.7574 0C13.6528 0 16 2.34721 16 5.24264C16 6.63308 15.4477 7.96656 14.4645 8.94975L12.4142 11L11 9.58579L13.0503 7.53553C13.6584 6.92742 14 6.10264 14 5.24264C14 3.45178 12.5482 2 10.7574 2C9.89736 2 9.07258 2.34163 8.46447 2.94975L6.41421 5L5 3.58579L7.05025 1.53553Z"},null,-1),e("path",{d:"M7.53553 13.0503L9.58579 11L11 12.4142L8.94975 14.4645C7.96656 15.4477 6.63308 16 5.24264 16C2.34721 16 0 13.6528 0 10.7574C0 9.36693 0.552347 8.03344 1.53553 7.05025L3.58579 5L5 6.41421L2.94975 8.46447C2.34163 9.07258 2 9.89736 2 10.7574C2 12.5482 3.45178 14 5.24264 14C6.10264 14 6.92742 13.6584 7.53553 13.0503Z"},null,-1),e("path",{d:"M5.70711 11.7071L11.7071 5.70711L10.2929 4.29289L4.29289 10.2929L5.70711 11.7071Z"},null,-1)]))}const Le=le(Ce,[["render",Se]]),Me={class:"bg-white dark:bg-gray-800 shadow-sm rounded-lg overflow-hidden"},Ue={class:"px-4 py-5 sm:p-6 space-y-4"},Ae={class:"flex flex-wrap items-center justify-between gap-4"},$e={class:"flex items-center gap-2"},Ie=["disabled"],De=["disabled"],Ee={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},Ne={class:"border-t border-gray-200 dark:border-gray-700"},Te={key:0,class:"p-6 text-center text-gray-500"},Ve={key:1,class:"p-6 text-center text-gray-500"},je={key:2,class:"overflow-x-auto"},Be={class:"min-w-full divide-y divide-gray-200 dark:divide-gray-700"},Oe={class:"bg-gray-50 dark:bg-gray-700/50"},Re={scope:"col",class:"px-6 py-3"},ze={scope:"col",class:"table-header"},Fe={key:0},He={scope:"col",class:"table-header"},Ke={key:0},Pe={scope:"col",class:"table-header"},Ze={key:0},qe={scope:"col",class:"table-header"},Je={key:0},Qe={scope:"col",class:"table-header"},Ge={key:0},We={scope:"col",class:"table-header"},Ye={key:0},Xe={class:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700"},et={class:"px-6 py-4"},tt=["value"],st={class:"table-cell"},at={class:"flex items-center"},ot={class:"ml-4"},nt={class:"text-sm font-medium text-gray-900 dark:text-white"},lt={class:"text-sm text-gray-500 dark:text-gray-400"},rt={class:"table-cell"},it={class:"flex items-center gap-2"},dt=["title"],ct={class:"table-cell text-sm text-center font-mono text-gray-500 dark:text-gray-400"},ut=["title"],vt={class:"table-cell text-sm text-gray-500 dark:text-gray-400"},mt={class:"table-cell text-sm text-center text-gray-500 dark:text-gray-400"},pt={class:"table-cell text-sm text-center text-gray-500 dark:text-gray-400"},ft={class:"table-cell text-sm text-gray-500 dark:text-gray-400"},gt={class:"table-cell text-right text-sm font-medium"},yt={class:"flex items-center justify-end space-x-2"},_t=["onClick"],ht=["onClick"],bt=["onClick"],St={__name:"UserTable",setup($){const u=F(),g=R(),f=re(),_=ie(),{allUsers:m,isLoadingUsers:k}=de(u),x=p(""),M=p(null),C=p(null),v=p("username"),o=p("asc"),i=p(null),d=p([]),w=A(()=>({filter_online:M.value,filter_has_keys:C.value,sort_by:v.value,sort_order:o.value})),n=A(()=>{if(!x.value)return m.value;const a=x.value.toLowerCase();return m.value.filter(t=>t.username.toLowerCase().includes(a)||t.email&&t.email.toLowerCase().includes(a))}),S=A({get:()=>{const a=n.value.map(t=>t.id);return a.length===0?!1:d.value.length===a.length&&a.every(t=>d.value.includes(t))},set:a=>{const t=n.value.map(s=>s.id);a?d.value=[...new Set([...d.value,...t])]:d.value=d.value.filter(s=>!t.includes(s))}});function H(){const a=m.value.filter(t=>d.value.includes(t.id));if(a.length===0){g.addNotification("Please select at least one user.","warning");return}g.openModal("emailAllUsers",{users:a})}function K(){const a=m.value.filter(t=>d.value.includes(t.id));if(a.length===0){g.addNotification("Please select at least one user.","warning");return}g.openModal("emailList",{users:a})}function L(a){v.value===a?o.value=o.value==="asc"?"desc":"asc":(v.value=a,o.value="asc"),u.fetchAllUsers(w.value)}function N(){u.fetchAllUsers(w.value)}function P(a){if(!a)return"Never";const t=new Date(a),y=Math.round((new Date-t)/1e3);if(y<60)return`${y}s ago`;const D=Math.round(y/60);if(D<60)return`${D}m ago`;const T=Math.round(D/60);return T<24?`${T}h ago`:t.toLocaleString()}function Z(a){g.openModal("adminUserEdit",{user:a,onUserUpdated:()=>u.fetchAllUsers(w.value)})}function q(a){i.value=a,g.openModal("userStats",{userId:a.id,username:a.username})}async function J(a){await _.push("/"),f.openConversation({id:a.id,username:a.username,icon:a.icon})}return ce(()=>{u.fetchAllUsers(w.value)}),(a,t)=>(l(),r("div",Me,[e("div",Ue,[e("div",Ae,[t[11]||(t[11]=e("h3",{class:"text-base font-semibold leading-6 text-gray-900 dark:text-white"},"All Users",-1)),e("div",$e,[e("button",{onClick:K,class:"btn btn-secondary btn-sm",disabled:d.value.length===0},"Copy Emails",8,Ie),e("button",{onClick:H,class:"btn btn-secondary btn-sm",disabled:d.value.length===0},"Email Selected",8,De)])]),e("div",Ee,[U(e("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=s=>x.value=s),placeholder:"Search username/email...",class:"input-field md:col-span-2"},null,512),[[ue,x.value]]),U(e("select",{"onUpdate:modelValue":t[1]||(t[1]=s=>M.value=s),onChange:N,class:"input-field"},t[12]||(t[12]=[e("option",{value:null},"All Activity",-1),e("option",{value:!0},"Online",-1),e("option",{value:!1},"Offline",-1)]),544),[[j,M.value]]),U(e("select",{"onUpdate:modelValue":t[2]||(t[2]=s=>C.value=s),onChange:N,class:"input-field"},t[13]||(t[13]=[e("option",{value:null},"All API Keys",-1),e("option",{value:!0},"Has Keys",-1),e("option",{value:!1},"No Keys",-1)]),544),[[j,C.value]])])]),e("div",Ne,[E(k)?(l(),r("div",Te," Loading users... ")):n.value.length===0?(l(),r("div",Ve," No users found. ")):(l(),r("div",je,[e("table",Be,[e("thead",Oe,[e("tr",null,[e("th",Re,[U(e("input",{type:"checkbox","onUpdate:modelValue":t[3]||(t[3]=s=>S.value=s),class:"h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500"},null,512),[[B,S.value]])]),e("th",ze,[e("button",{onClick:t[4]||(t[4]=s=>L("username")),class:"flex items-center gap-1"},[t[14]||(t[14]=b("User ")),v.value==="username"?(l(),r("span",Fe,c(o.value==="asc"?"▲":"▼"),1)):h("",!0)])]),t[20]||(t[20]=e("th",{scope:"col",class:"table-header"},"Status",-1)),e("th",He,[e("button",{onClick:t[5]||(t[5]=s=>L("connection_count")),class:"flex items-center gap-1"},[t[15]||(t[15]=b("Connections")),v.value==="connection_count"?(l(),r("span",Ke,c(o.value==="asc"?"▲":"▼"),1)):h("",!0)])]),e("th",Pe,[e("button",{onClick:t[6]||(t[6]=s=>L("last_activity_at")),class:"flex items-center gap-1"},[t[16]||(t[16]=b("Last Seen ")),v.value==="last_activity_at"?(l(),r("span",Ze,c(o.value==="asc"?"▲":"▼"),1)):h("",!0)])]),e("th",qe,[e("button",{onClick:t[7]||(t[7]=s=>L("api_key_count")),class:"flex items-center gap-1"},[t[17]||(t[17]=b("API Keys ")),v.value==="api_key_count"?(l(),r("span",Je,c(o.value==="asc"?"▲":"▼"),1)):h("",!0)])]),e("th",Qe,[e("button",{onClick:t[8]||(t[8]=s=>L("task_count")),class:"flex items-center gap-1"},[t[18]||(t[18]=b("Tasks ")),v.value==="task_count"?(l(),r("span",Ge,c(o.value==="asc"?"▲":"▼"),1)):h("",!0)])]),e("th",We,[e("button",{onClick:t[9]||(t[9]=s=>L("created_at")),class:"flex items-center gap-1"},[t[19]||(t[19]=b("Joined ")),v.value==="created_at"?(l(),r("span",Ye,c(o.value==="asc"?"▲":"▼"),1)):h("",!0)])]),t[21]||(t[21]=e("th",{scope:"col",class:"relative px-6 py-3"},[e("span",{class:"sr-only"},"Actions")],-1))])]),e("tbody",Xe,[(l(!0),r(ve,null,me(n.value,s=>(l(),r("tr",{key:s.id,class:"hover:bg-gray-50 dark:hover:bg-gray-700/50"},[e("td",et,[U(e("input",{type:"checkbox",value:s.id,"onUpdate:modelValue":t[10]||(t[10]=y=>d.value=y),class:"h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500"},null,8,tt),[[B,d.value]])]),e("td",st,[e("div",at,[I(pe,{icon:s.icon,username:s.username,"size-class":"h-8 w-8"},null,8,["icon","username"]),e("div",ot,[e("div",nt,c(s.username),1),e("div",lt,c(s.email||"No email"),1)])])]),e("td",rt,[e("div",it,[e("span",{class:O(["w-3 h-3 rounded-full",s.is_online?"bg-green-500":"bg-gray-400"]),title:s.is_online?"Online":"Offline"},null,10,dt),e("span",{class:O([s.is_active?"status-badge-green":"status-badge-red","status-badge"])},c(s.is_active?"Active":"Inactive"),3)])]),e("td",ct,[e("div",{class:"flex items-center justify-center gap-1",title:`${s.connection_count} active connections`},[I(Le,{class:"w-4 h-4"}),b(" "+c(s.connection_count),1)],8,ut)]),e("td",vt,c(P(s.last_activity_at)),1),e("td",mt,c(s.api_key_count),1),e("td",pt,c(s.task_count),1),e("td",ft,c(new Date(s.created_at).toLocaleDateString()),1),e("td",gt,[e("div",yt,[e("button",{onClick:y=>q(s),title:"View Stats",class:"action-icon"},t[22]||(t[22]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})],-1)]),8,_t),e("button",{onClick:y=>J(s),title:"Send DM",class:"action-icon"},t[23]||(t[23]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})],-1)]),8,ht),e("button",{onClick:y=>Z(s),title:"Edit User",class:"action-icon"},t[24]||(t[24]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10"})],-1)]),8,bt)])])]))),128))])])]))]),i.value?(l(),z(xe,{key:0,userId:i.value.id,username:i.value.username},null,8,["userId","username"])):h("",!0)]))}};export{St as default};
