import{a4 as ve,R as me,u as ye,ag as fe,T as N,L as i,c as w,m as I,l as ge,e as o,o as a,b as s,g as m,n as B,f as h,aw as F,h as M,Y as be,a0 as d,an as $,as as z,F as S,r as P,t as c,d as O,a as we,aH as G,K as ke,aA as _e}from"./index-Htkm6tp6.js";import{u as xe}from"./admin-BqVfPfYE.js";import{A as he}from"./AppCard-B_5xCaGa.js";import{A as Se}from"./AppCardSkeleton-CfqQRgra.js";import"./AdminView-Bn1u6w6e.js";import"./PageViewLayout-CWdAC13R.js";/* empty css                                                                       */import"./IconKey-CNRx7rQG.js";import"./IconNoSymbol-C6TMQ0Qq.js";import"./IconArrowPath-OvR7F7V2.js";const Pe={class:"space-y-6"},Re={class:"border-b border-gray-200 dark:border-gray-700"},Ce={class:"-mb-px flex space-x-6"},Ae={key:0},Ie={class:"flex justify-between items-center mb-4"},Me={class:"flex gap-2"},$e={class:"space-y-4"},Ue={class:"grid grid-cols-1 lg:grid-cols-4 gap-4"},Ve={class:"relative lg:col-span-1"},Ze={class:"grid grid-cols-1 sm:grid-cols-3 lg:col-span-3 gap-4"},Te=["value"],Ne=["value"],ze={key:0,class:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 2xl:grid-cols-4 gap-6"},Le={key:1,class:"empty-state-card"},De={key:2},qe={class:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 2xl:grid-cols-4 gap-6"},je={key:0,class:"flex justify-between items-center mt-6"},Ee=["disabled"],Be={class:"text-sm text-gray-600 dark:text-gray-400"},Fe=["disabled"],Oe={key:1},Ge={class:"flex justify-between items-center mb-4"},He={key:0,class:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm mb-6"},Je={class:"flex items-center gap-x-4"},Ke={key:0},We=["required"],Qe={key:1},Ye=["required"],Xe={key:1,class:"text-center p-4"},et={key:2,class:"empty-state-card"},tt={key:3,class:"space-y-4"},st={class:"font-semibold"},lt={class:"text-sm text-gray-500"},at={class:"text-xs text-gray-400"},ot={class:"flex items-center gap-2"},nt=["onClick"],it=["onClick"],rt={__name:"PersonalitiesManagement",setup(ut){const u=xe(),H=me(),v=ye(),U=fe(),{personalityZooRepositories:J,isLoadingPersonalityZooRepositories:K,zooPersonalities:R,isLoadingZooPersonalities:W}=N(u),{publicPersonalities:Q}=N(U),{tasks:Y}=N(H),y=i("zoo"),n=i({type:"git",name:"",url:"",path:""}),k=i(!1),f=i(null),C=i(""),p=i("All"),_=i("All"),x=i("All"),L=i("name"),D=i("asc"),g=i(JSON.parse(localStorage.getItem("starredPersonalities")||"[]")),r=i(1),V=i(24);let q=null;const Z=w(()=>R.value.total||0),j=w(()=>R.value.pages||1),X=w(()=>{if(Z.value===0)return"Showing 0-0 of 0";const l=(r.value-1)*V.value+1,e=Math.min(r.value*V.value,Z.value);return`Showing ${l}-${e} of ${Z.value}`});async function b(){const l={page:r.value,page_size:V.value,sort_by:L.value,sort_order:D.value,category:p.value!=="All"&&p.value!=="Starred"?p.value:void 0,repository:x.value!=="All"?x.value:void 0,search_query:C.value||void 0,installation_status:_.value!=="All"?_.value:void 0};p.value==="Starred"&&(l.starred_names=g.value),await u.fetchZooPersonalities(l)}const E=w(()=>{const l=new Map;return(Y.value||[]).forEach(e=>{var t;if((t=e==null?void 0:e.name)!=null&&t.startsWith("Installing personality: ")&&(e.status==="running"||e.status==="pending")){const A=e.name.replace("Installing personality: ","");l.set(A,e)}}),(R.value.items||[]).map(e=>({...e,task:l.get(e.folder_name)||null}))});function ee(){clearTimeout(q),q=setTimeout(()=>{r.value=1,b()},300)}I([L,D,p,_,x],()=>{r.value=1,b()}),I(C,ee),I(r,b),I(g,l=>{localStorage.setItem("starredPersonalities",JSON.stringify(l)),p.value==="Starred"&&(r.value=1,b())},{deep:!0}),ge(()=>{U.fetchPersonalities(),u.fetchPersonalityZooRepositories(),b()});const T=w(()=>[...J.value||[]].sort((l,e)=>(l.name||"").localeCompare(e.name||""))),te=w(()=>["All","Starred",...R.value.categories||[]]);function se(l){return l?new Date(l).toLocaleString():"Never"}async function le(){if(!n.value.name){v.addNotification("Repository name is required.","warning");return}const l={name:n.value.name};n.value.type==="git"?l.url=n.value.url:l.path=n.value.path,f.value="add";try{await u.addPersonalityZooRepository(l),n.value={type:"git",name:"",url:"",path:""},k.value=!1}finally{f.value=null}}async function ae(l){f.value=l.id;try{await u.pullPersonalityZooRepository(l.id)}finally{f.value=null}}async function oe(l){if(await v.showConfirmation({title:`Delete Repository '${l.name}'?`})){f.value=l.id;try{await u.deletePersonalityZooRepository(l.id)}finally{f.value=null}}}async function ne(l){await u.installZooPersonality({repository:l.repository,folder_name:l.folder_name})}async function ie(l){const e=Q.value.find(t=>t.name===l.name&&t.owner_username==="System");e&&await v.showConfirmation({title:`Uninstall '${l.name}'?`})&&(await U.deletePersonality(e.id),await b())}async function re(l){const e=await u.fetchPersonalityReadme(l.repository,l.folder_name);v.openModal("sourceViewer",{title:`README: ${l.name}`,content:e,language:"markdown"})}function ue(l){const e=g.value.indexOf(l);e>-1?g.value.splice(e,1):g.value.push(l)}function de(l=null){v.openModal("personalityEditor",{personality:l})}function pe(){v.openModal("generatePersonality")}async function ce(){const l=await u.refreshZooCache();l&&v.openModal("tasksManager",{initialTaskId:l.id})}return(l,e)=>(a(),o("div",Pe,[s("div",Re,[s("nav",Ce,[s("button",{onClick:e[0]||(e[0]=t=>y.value="zoo"),class:B(["tab-button",y.value==="zoo"?"active":"inactive"])},"Zoo",2),s("button",{onClick:e[1]||(e[1]=t=>y.value="source"),class:B(["tab-button",y.value==="source"?"active":"inactive"])},"Repositories",2)])]),y.value==="zoo"?(a(),o("section",Ae,[s("div",Ie,[e[16]||(e[16]=s("h3",{class:"text-xl font-semibold"},"Personality Zoo",-1)),s("div",Me,[s("button",{onClick:ce,class:"btn btn-secondary",title:"Refresh Zoo Cache from all sources"},[h(F,{class:"w-4 h-4"})]),s("button",{onClick:pe,class:"btn btn-secondary"},"Generate from Prompt"),s("button",{onClick:e[2]||(e[2]=t=>de()),class:"btn btn-primary"},[h(be,{class:"w-4 h-4 mr-1"}),e[15]||(e[15]=M(" Create New"))])])]),s("div",$e,[s("div",Ue,[s("div",Ve,[d(s("input",{"onUpdate:modelValue":e[3]||(e[3]=t=>C.value=t),type:"text",placeholder:"Search Personalities...",class:"input-field w-full pl-10"},null,512),[[$,C.value]]),e[17]||(e[17]=s("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[s("svg",{class:"h-5 w-5 text-gray-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})])],-1))]),s("div",Ze,[d(s("select",{"onUpdate:modelValue":e[4]||(e[4]=t=>_.value=t),class:"input-field"},e[18]||(e[18]=[s("option",{value:"All"},"All Statuses",-1),s("option",{value:"Installed"},"Installed",-1),s("option",{value:"Uninstalled"},"Uninstalled",-1)]),512),[[z,_.value]]),d(s("select",{"onUpdate:modelValue":e[5]||(e[5]=t=>p.value=t),class:"input-field"},[(a(!0),o(S,null,P(te.value,t=>(a(),o("option",{key:t,value:t},c(t),9,Te))),128))],512),[[z,p.value]]),d(s("select",{"onUpdate:modelValue":e[6]||(e[6]=t=>x.value=t),class:"input-field"},[e[19]||(e[19]=s("option",{value:"All"},"All Sources",-1)),(a(!0),o(S,null,P(T.value,t=>(a(),o("option",{key:t.id,value:t.name},c(t.name),9,Ne))),128))],512),[[z,x.value]])])]),O(W)?(a(),o("div",ze,[(a(),o(S,null,P(8,t=>h(Se,{key:t})),64))])):E.value.length===0?(a(),o("div",Le,e[20]||(e[20]=[s("p",null,"No personalities found.",-1)]))):(a(),o("div",De,[s("div",qe,[(a(!0),o(S,null,P(E.value,t=>(a(),we(he,{key:`${t.repository}/${t.folder_name}`,app:t,task:t.task,"is-starred":g.value.includes(t.name),"item-type-name":"Personality",onStar:A=>ue(t.name),onInstall:ne,onUninstall:ie,onHelp:re},null,8,["app","task","is-starred","onStar"]))),128))]),j.value>1?(a(),o("div",je,[s("button",{onClick:e[7]||(e[7]=t=>r.value--),disabled:r.value===1,class:"btn btn-secondary"},"Previous",8,Ee),s("span",Be,c(X.value),1),s("button",{onClick:e[8]||(e[8]=t=>r.value++),disabled:r.value>=j.value,class:"btn btn-secondary"},"Next",8,Fe)])):m("",!0)]))])])):m("",!0),y.value==="source"?(a(),o("section",Oe,[s("div",Ge,[e[21]||(e[21]=s("h3",{class:"text-xl font-semibold"},"Personality Zoo Repositories",-1)),s("button",{onClick:e[9]||(e[9]=t=>k.value=!k.value),class:"btn btn-primary"},c(k.value?"Cancel":"Add Repository"),1)]),k.value?(a(),o("div",He,[s("form",{onSubmit:ke(le,["prevent"]),class:"space-y-4"},[s("div",Je,[s("label",null,[d(s("input",{type:"radio","onUpdate:modelValue":e[10]||(e[10]=t=>n.value.type=t),value:"git",class:"radio-input"},null,512),[[G,n.value.type]]),e[22]||(e[22]=M(" Git"))]),s("label",null,[d(s("input",{type:"radio","onUpdate:modelValue":e[11]||(e[11]=t=>n.value.type=t),value:"local",class:"radio-input"},null,512),[[G,n.value.type]]),e[23]||(e[23]=M(" Local"))])]),s("div",null,[e[24]||(e[24]=s("label",null,"Name",-1)),d(s("input",{"onUpdate:modelValue":e[12]||(e[12]=t=>n.value.name=t),type:"text",class:"input-field",required:""},null,512),[[$,n.value.name]])]),n.value.type==="git"?(a(),o("div",Ke,[e[25]||(e[25]=s("label",null,"URL",-1)),d(s("input",{"onUpdate:modelValue":e[13]||(e[13]=t=>n.value.url=t),type:"url",class:"input-field",required:n.value.type==="git"},null,8,We),[[$,n.value.url]])])):m("",!0),n.value.type==="local"?(a(),o("div",Qe,[e[26]||(e[26]=s("label",null,"Path",-1)),d(s("input",{"onUpdate:modelValue":e[14]||(e[14]=t=>n.value.path=t),type:"text",class:"input-field",required:n.value.type==="local"},null,8,Ye),[[$,n.value.path]])])):m("",!0),e[27]||(e[27]=s("div",{class:"flex justify-end"},[s("button",{type:"submit",class:"btn btn-primary"},"Add")],-1))],32)])):m("",!0),O(K)?(a(),o("div",Xe,"Loading...")):T.value.length===0?(a(),o("div",et,e[28]||(e[28]=[s("p",null,"No repositories added.",-1)]))):(a(),o("div",tt,[(a(!0),o(S,null,P(T.value,t=>(a(),o("div",{key:t.id,class:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm flex items-center justify-between"},[s("div",null,[s("p",st,c(t.name),1),s("p",lt,c(t.url),1),s("p",at,"Pulled: "+c(se(t.last_pulled_at)),1)]),s("div",ot,[s("button",{onClick:A=>ae(t),class:"btn btn-secondary btn-sm"},[h(F,{class:"w-4 h-4 mr-1"}),M(c(t.type==="git"?"Pull":"Rescan"),1)],8,nt),t.is_deletable?(a(),o("button",{key:0,onClick:A=>oe(t),class:"btn btn-danger btn-sm"},[h(_e,{class:"w-4 h-4"})],8,it)):m("",!0)])]))),128))]))])):m("",!0)]))}},kt=ve(rt,[["__scopeId","data-v-d702d02e"]]);export{kt as default};
