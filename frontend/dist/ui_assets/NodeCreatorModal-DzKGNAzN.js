import{Z,a2 as Q,u as X,c$ as ee,d0 as U,L as c,c as te,j as oe,e as n,o as l,b as t,l as _,t as k,f as i,m as x,aB as $,J as S,O as se,aD as D,T as d,a7 as f,R as O,F as j,n as E,ap as A,cq as J,ax as M,as as ae,y as le,V as B,aq as R,w as ne,aa as ie,a as re,M as z,a9 as de}from"./index-DsFmVrVf.js";import{json as ue}from"./index-BxhruCxp.js";const ce={class:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm p-4"},pe={class:"bg-white dark:bg-gray-900 rounded-xl shadow-2xl w-full max-w-7xl h-[90vh] flex flex-col border dark:border-gray-700 overflow-hidden animate-in fade-in zoom-in-95 duration-200"},be={class:"p-4 border-b dark:border-gray-700 flex justify-between items-center bg-gray-50 dark:bg-gray-800/80"},fe={class:"flex items-center gap-3"},ve={class:"text-xl font-bold text-gray-800 dark:text-gray-100"},xe={key:0,class:"flex items-center gap-2 text-xs text-blue-500 font-medium bg-blue-50 dark:bg-blue-900/30 px-2 py-1 rounded-full"},ge={class:"flex items-center gap-2"},me={class:"flex-grow flex min-h-0 relative"},ye={class:"w-full md:w-1/3 flex flex-col border-r dark:border-gray-700 bg-gray-50/50 dark:bg-gray-900/50"},we={class:"p-4 flex-grow overflow-y-auto custom-scrollbar space-y-6"},ke={class:"space-y-3"},he={class:"grid grid-cols-1 gap-3"},_e=["disabled"],Ne={class:"space-y-2"},Ce={class:"flex justify-between items-center border-b dark:border-gray-700 pb-1"},Ve={key:0,class:"text-center py-4 text-xs text-gray-400 italic bg-gray-100 dark:bg-gray-800 rounded"},Ie={key:1,class:"space-y-2"},Se=["onUpdate:modelValue"],Te=["onUpdate:modelValue"],Ue=["onClick"],$e={class:"space-y-2"},De={class:"flex justify-between items-center border-b dark:border-gray-700 pb-1"},Oe={key:0,class:"text-center py-4 text-xs text-gray-400 italic bg-gray-100 dark:bg-gray-800 rounded"},je={key:1,class:"space-y-2"},Ee=["onUpdate:modelValue"],Ae=["onUpdate:modelValue"],Je=["onClick"],Me={class:"w-full md:w-2/3 flex flex-col h-full bg-gray-900 text-gray-200 relative"},Be={class:"flex-shrink-0 p-2 bg-gray-800 border-b border-gray-700 flex justify-between items-center"},Re={class:"flex items-center gap-2"},ze={key:0,class:"flex items-center gap-2"},Fe={class:"relative group"},Ge=["disabled"],qe={class:"flex-grow relative flex flex-col min-h-0"},Le={class:"flex-grow relative overflow-hidden"},Pe={key:0,class:"absolute bottom-0 left-0 right-0 bg-gray-800/95 backdrop-blur border-t border-gray-700 p-4 shadow-xl z-20 max-h-[60%] overflow-y-auto custom-scrollbar"},Ke={class:"flex justify-between items-start mb-2"},He={class:"flex-grow flex flex-col p-4 space-y-4 bg-gray-900 overflow-y-auto"},We={class:"grid grid-cols-2 gap-4 h-1/2 min-h-[200px]"},Ye={class:"flex flex-col"},Ze={class:"flex flex-col"},Qe={class:"flex-grow border border-gray-700 rounded bg-black/50 p-2 font-mono text-xs overflow-auto text-green-400 whitespace-pre-wrap"},Xe={class:"flex justify-between items-center pt-2 border-t border-gray-800"},et={key:0,class:"text-xs text-red-400 font-mono flex-grow pr-4 max-h-20 overflow-y-auto"},tt={key:1,class:"flex-grow"},ot=["disabled"],st={class:"p-4 border-t dark:border-gray-700 flex justify-between items-center bg-gray-50 dark:bg-gray-800 rounded-b-lg"},at={class:"flex gap-3"},lt={__name:"NodeCreatorModal",props:{nodeToEdit:{type:Object,default:null}},emits:["close"],setup(F,{emit:G}){const N=F,q=G,C=Q(),V=X(),L=[ee(),U],P=[ue(),U],p=c("code"),g=c(!1),m=c(!1),b=c(!1),y=c(""),w=c(`{
  "input": "test value"
}`),I=c(""),v=c(""),o=c({id:null,name:"",label:"",description:"",color:"bg-indigo-100 dark:bg-indigo-900 border-indigo-500",inputs:[{name:"input",type:"string"}],outputs:[{name:"output",type:"string"}],code:`import json
import base64

class CustomNode:
    def execute(self, inputs, context):
        # Your logic here
        # inputs: dict of values from connected nodes
        # context.lollms_client: access to AI services
        
        val = inputs.get("input", "default")
        
        # Example: Generate Text
        # res = context.lollms_client.generate_text(f"Process {val}")
        
        return {"output": val}
`}),h=te(()=>!!N.nodeToEdit);oe(()=>{if(N.nodeToEdit){o.value=JSON.parse(JSON.stringify(N.nodeToEdit)),o.value.description||(o.value.description="");const a={};o.value.inputs.forEach(e=>a[e.name]=e.type==="int"?0:"test"),w.value=JSON.stringify(a,null,2)}});function K(){o.value.inputs.push({name:"new_input",type:"string"})}function H(){o.value.outputs.push({name:"new_output",type:"string"})}async function T(){if(!(!y.value.trim()||m.value)){m.value=!0;try{const e=(await z.post("/api/flows/generate_code",{prompt:y.value})).data;if(e){o.value.name=e.name||o.value.name,o.value.label=e.label||o.value.label,o.value.description=e.description||o.value.description,e.color&&(o.value.color=e.color),e.inputs&&(o.value.inputs=e.inputs),e.outputs&&(o.value.outputs=e.outputs),await de(),e.code&&(o.value.code=e.code);const s={};(e.inputs||[]).forEach(r=>{r.type==="int"?s[r.name]=0:r.type==="boolean"?s[r.name]=!1:s[r.name]="test"}),w.value=JSON.stringify(s,null,2),V.addNotification("Node design updated by AI!","success"),y.value=""}}catch(a){console.error("Design generation failed:",a),V.addNotification("Design generation failed. Check console for details.","error")}finally{m.value=!1}}}async function W(){if(b.value)return;b.value=!0,v.value="",I.value="";let a={};try{a=JSON.parse(w.value)}catch{v.value="Invalid JSON in inputs",b.value=!1;return}try{const e=await z.post("/api/flows/test_code",{code:o.value.code,inputs:a});e.data.status==="success"?I.value=JSON.stringify(e.data.output,null,2):v.value=e.data.error+(e.data.traceback?`

${e.data.traceback}`:"")}catch{v.value="Network or server error during test."}finally{b.value=!1}}async function Y(){if(!o.value.name||!o.value.code){V.addNotification("Name and Code are required","warning");return}let a;h.value?a=await C.updateNodeDefinition(o.value.id,o.value):a=await C.createNodeDefinition(o.value),a&&(await C.fetchNodeDefinitions(),q("close"))}return(a,e)=>(l(),n("div",ce,[t("div",pe,[t("div",be,[t("div",fe,[t("h3",ve,k(h.value?"Edit Node":"Create Node"),1),m.value?(l(),n("div",xe,[i($,{class:"w-3.5 h-3.5 animate-spin"}),e[13]||(e[13]=x(" Designing node... "))])):_("",!0)]),t("div",ge,[t("button",{onClick:e[0]||(e[0]=s=>g.value=!g.value),class:S(["btn btn-secondary btn-sm",{"bg-blue-100 text-blue-600":g.value}])},[i(se,{class:"w-4 h-4 mr-1"}),e[14]||(e[14]=x(" API Docs "))],2),t("button",{onClick:e[1]||(e[1]=s=>a.$emit("close")),class:"text-gray-400 hover:text-red-500 transition-colors p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full"},[i(D,{class:"w-6 h-6"})])])]),t("div",me,[t("div",ye,[t("div",we,[t("div",ke,[e[19]||(e[19]=t("h4",{class:"text-xs font-black uppercase text-gray-400 tracking-widest border-b dark:border-gray-700 pb-1"},"Metadata",-1)),t("div",he,[t("div",null,[e[15]||(e[15]=t("label",{class:"block text-[10px] font-bold uppercase text-gray-500 mb-1"},"ID (Internal)",-1)),d(t("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>o.value.name=s),class:"input-field w-full text-xs font-mono",placeholder:"unique_node_id",disabled:h.value},null,8,_e),[[f,o.value.name]])]),t("div",null,[e[16]||(e[16]=t("label",{class:"block text-[10px] font-bold uppercase text-gray-500 mb-1"},"Label (Display)",-1)),d(t("input",{"onUpdate:modelValue":e[3]||(e[3]=s=>o.value.label=s),class:"input-field w-full text-xs",placeholder:"My Custom Node"},null,512),[[f,o.value.label]])]),t("div",null,[e[17]||(e[17]=t("label",{class:"block text-[10px] font-bold uppercase text-gray-500 mb-1"},"Color (Tailwind)",-1)),d(t("input",{"onUpdate:modelValue":e[4]||(e[4]=s=>o.value.color=s),class:"input-field w-full text-xs font-mono",placeholder:"bg-blue-100 border-blue-500"},null,512),[[f,o.value.color]])]),t("div",null,[e[18]||(e[18]=t("label",{class:"block text-[10px] font-bold uppercase text-gray-500 mb-1"},"Description",-1)),d(t("textarea",{"onUpdate:modelValue":e[5]||(e[5]=s=>o.value.description=s),class:"input-field w-full text-xs h-16 resize-none",placeholder:"What does this node do?"},null,512),[[f,o.value.description]])])])]),t("div",Ne,[t("div",Ce,[e[21]||(e[21]=t("h4",{class:"text-xs font-black uppercase text-gray-400 tracking-widest"},"Inputs",-1)),t("button",{onClick:K,class:"text-blue-500 hover:text-blue-600 text-xs font-bold flex items-center gap-1"},[i(O,{class:"w-3 h-3"}),e[20]||(e[20]=x(" Add"))])]),o.value.inputs.length===0?(l(),n("div",Ve,"No inputs defined")):(l(),n("div",Ie,[(l(!0),n(j,null,E(o.value.inputs,(s,r)=>(l(),n("div",{key:"in"+r,class:"flex gap-2 items-center bg-white dark:bg-gray-800 p-2 rounded border dark:border-gray-700 shadow-sm group"},[d(t("input",{"onUpdate:modelValue":u=>s.name=u,placeholder:"key_name",class:"input-field-sm flex-1 !text-xs font-mono"},null,8,Se),[[f,s.name]]),d(t("select",{"onUpdate:modelValue":u=>s.type=u,class:"input-field-sm w-28 !text-xs"},e[22]||(e[22]=[J('<option value="string" data-v-92f95f7d>String</option><option value="int" data-v-92f95f7d>Int</option><option value="float" data-v-92f95f7d>Float</option><option value="boolean" data-v-92f95f7d>Bool</option><option value="image" data-v-92f95f7d>Image</option><option value="node_ref" data-v-92f95f7d>NodeRef</option><option value="model_selection" data-v-92f95f7d>Model Sel</option><option value="any" data-v-92f95f7d>Any</option>',8)]),8,Te),[[A,s.type]]),t("button",{onClick:u=>o.value.inputs.splice(r,1),class:"text-gray-400 hover:text-red-500 transition-colors"},[i(M,{class:"w-3.5 h-3.5"})],8,Ue)]))),128))]))]),t("div",$e,[t("div",De,[e[24]||(e[24]=t("h4",{class:"text-xs font-black uppercase text-gray-400 tracking-widest"},"Outputs",-1)),t("button",{onClick:H,class:"text-green-500 hover:text-green-600 text-xs font-bold flex items-center gap-1"},[i(O,{class:"w-3 h-3"}),e[23]||(e[23]=x(" Add"))])]),o.value.outputs.length===0?(l(),n("div",Oe,"No outputs defined")):(l(),n("div",je,[(l(!0),n(j,null,E(o.value.outputs,(s,r)=>(l(),n("div",{key:"out"+r,class:"flex gap-2 items-center bg-white dark:bg-gray-800 p-2 rounded border dark:border-gray-700 shadow-sm group"},[d(t("input",{"onUpdate:modelValue":u=>s.name=u,placeholder:"key_name",class:"input-field-sm flex-1 !text-xs font-mono"},null,8,Ee),[[f,s.name]]),d(t("select",{"onUpdate:modelValue":u=>s.type=u,class:"input-field-sm w-24 !text-xs"},e[25]||(e[25]=[J('<option value="string" data-v-92f95f7d>String</option><option value="int" data-v-92f95f7d>Integer</option><option value="float" data-v-92f95f7d>Float</option><option value="boolean" data-v-92f95f7d>Boolean</option><option value="image" data-v-92f95f7d>Image</option><option value="list" data-v-92f95f7d>List</option><option value="any" data-v-92f95f7d>Any</option>',7)]),8,Ae),[[A,s.type]]),t("button",{onClick:u=>o.value.outputs.splice(r,1),class:"text-gray-400 hover:text-red-500 transition-colors"},[i(M,{class:"w-3.5 h-3.5"})],8,Je)]))),128))]))])])]),t("div",Me,[t("div",Be,[t("div",Re,[e[26]||(e[26]=t("span",{class:"text-xs font-mono text-blue-400 font-bold px-2"},"code.py",-1)),e[27]||(e[27]=t("div",{class:"h-4 w-px bg-gray-600"},null,-1)),t("button",{onClick:e[6]||(e[6]=s=>p.value="code"),class:S(["px-3 py-1 rounded text-xs font-medium transition-colors",p.value==="code"?"bg-blue-600 text-white":"text-gray-400 hover:text-white"])},"Editor",2),t("button",{onClick:e[7]||(e[7]=s=>p.value="test"),class:S(["px-3 py-1 rounded text-xs font-medium transition-colors",p.value==="test"?"bg-green-600 text-white":"text-gray-400 hover:text-white"])},"Test / Debug",2)]),p.value==="code"?(l(),n("div",ze,[t("div",Fe,[d(t("input",{"onUpdate:modelValue":e[8]||(e[8]=s=>y.value=s),onKeydown:ae(T,["enter"]),class:"bg-gray-900 border border-gray-600 text-xs text-gray-200 rounded-l-md px-2 py-1 w-48 focus:w-64 transition-all focus:outline-none focus:border-blue-500",placeholder:"e.g. Node that takes text and reverses it"},null,544),[[f,y.value]]),t("button",{onClick:T,class:"bg-blue-600 hover:bg-blue-500 text-white text-xs px-3 py-1 rounded-r-md font-medium border-t border-b border-r border-blue-600",disabled:m.value},[i(le,{class:"w-3 h-3 inline mr-1"}),e[28]||(e[28]=x(" AI Design "))],8,Ge)])])):_("",!0)]),d(t("div",qe,[t("div",Le,[i(R,{modelValue:o.value.code,"onUpdate:modelValue":e[9]||(e[9]=s=>o.value.code=s),class:"absolute inset-0 h-full w-full text-sm",extensions:L},null,8,["modelValue"])]),i(ie,{"enter-active-class":"transition ease-out duration-200","enter-from-class":"opacity-0 translate-y-4","enter-to-class":"opacity-100 translate-y-0","leave-active-class":"transition ease-in duration-150","leave-from-class":"opacity-100 translate-y-0","leave-to-class":"opacity-0 translate-y-4"},{default:ne(()=>[g.value?(l(),n("div",Pe,[t("div",Ke,[e[29]||(e[29]=t("h4",{class:"text-sm font-bold text-blue-400"},"Context API Reference",-1)),t("button",{onClick:e[10]||(e[10]=s=>g.value=!1),class:"text-gray-400 hover:text-white"},[i(D,{class:"w-4 h-4"})])]),e[30]||(e[30]=t("div",{class:"grid grid-cols-1 md:grid-cols-2 gap-4 text-xs text-gray-300"},[t("div",null,[t("p",{class:"font-bold text-white mb-1"},"Structure"),t("pre",{class:"bg-black/50 p-2 rounded mb-2 overflow-x-auto"},`class CustomNode:
    def execute(self, inputs, context):
        # inputs: dict
        # return dict (keys match outputs)`),t("p",{class:"font-bold text-white mb-1"},"Text Generation"),t("code",{class:"block bg-black/50 p-1 rounded mb-1"},"context.lollms_client.generate_text(prompt, system_prompt=None)"),t("p",{class:"font-bold text-white mb-1"},"Get Specific Model Client"),t("code",{class:"block bg-black/50 p-1 rounded mb-1"},'client = context.get_client(model_name="binding/model")')]),t("div",null,[t("p",{class:"font-bold text-white mb-1"},"Image Generation (TTI)"),t("code",{class:"block bg-black/50 p-1 rounded mb-1"},"img_bytes = context.lollms_client.tti.generate_image(prompt, width=512, height=512)"),t("p",{class:"text-gray-500 mb-2"},"Returns bytes. Convert to base64 string for output."),t("p",{class:"font-bold text-white mb-1"},"Audio (TTS)"),t("code",{class:"block bg-black/50 p-1 rounded mb-1"},"wav_bytes = context.lollms_client.tts.tts_audio(text)")])],-1))])):_("",!0)]),_:1})],512),[[B,p.value==="code"]]),d(t("div",He,[t("div",We,[t("div",Ye,[e[31]||(e[31]=t("label",{class:"text-xs font-bold text-gray-400 mb-2 uppercase"},"Test Inputs (JSON)",-1)),i(R,{modelValue:w.value,"onUpdate:modelValue":e[11]||(e[11]=s=>w.value=s),extensions:P,class:"flex-grow border border-gray-700 rounded bg-gray-800"},null,8,["modelValue"])]),t("div",Ze,[e[32]||(e[32]=t("label",{class:"text-xs font-bold text-gray-400 mb-2 uppercase"},"Output Result",-1)),t("div",Qe,k(I.value),1)])]),t("div",Xe,[v.value?(l(),n("div",et,k(v.value),1)):(l(),n("div",tt)),t("button",{onClick:W,class:"btn btn-primary btn-sm",disabled:b.value},[b.value?(l(),re($,{key:0,class:"w-4 h-4 mr-2 animate-spin"})):_("",!0),x(" "+k(b.value?"Running...":"Run Test"),1)],8,ot)])],512),[[B,p.value==="test"]])])]),t("div",st,[e[33]||(e[33]=t("div",{class:"text-xs text-gray-500 italic"}," All inputs and outputs are dictionary keys. ",-1)),t("div",at,[t("button",{onClick:e[12]||(e[12]=s=>a.$emit("close")),class:"btn btn-secondary"},"Cancel"),t("button",{onClick:Y,class:"btn btn-primary px-6 shadow-lg"},k(h.value?"Update Node":"Create Node"),1)])])])]))}},rt=Z(lt,[["__scopeId","data-v-92f95f7d"]]);export{rt as default};
