import{aj as X,d as o,l as i,h as m,e as l,t as h,f as q,cV as Z,F as k,H,u as _,a0 as ee,X as te,a2 as Y,K as w,c as S,o as se,w as N,m as le,aC as re,O as F,Y as ae,a6 as ie,i as B,n as z,j as b}from"./index-BETWUTlj.js";const oe=["title"],ne=["title"],de=["title"],ue={key:0,xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 text-yellow-400",viewBox:"0 0 20 20",fill:"currentColor"},ye={key:1,xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 hover:text-yellow-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},ce={key:1,class:"absolute inset-0 bg-gray-500/30 dark:bg-gray-900/50 flex items-center justify-center rounded-lg z-10"},ge={class:"flex items-start space-x-3 mb-2 pr-8"},ve=["title"],fe=["src"],me={key:1,xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},he={class:"flex-grow"},pe=["title"],xe=["title"],we=["title"],be=["title"],ke=["title"],Se={class:"mt-auto flex justify-end items-center space-x-3 border-t dark:border-gray-600 pt-3"},Ce={__name:"PersonalityCard",props:{personality:{type:Object,required:!0},isUserPersonality:{type:Boolean,default:!1},isActive:{type:Boolean,default:!1},isSaving:{type:Boolean,default:!1},isStarred:{type:Boolean,default:!1},isShared:{type:Boolean,default:!1},sharedBy:{type:String,default:""}},emits:["edit","delete","clone","select","toggle-star","share"],setup(a,{emit:p}){const c=a,g=p;function u(d){d.stopPropagation(),g(c.isUserPersonality?"edit":"clone",c.personality)}function C(d){d.stopPropagation(),g("delete",c.personality)}function M(d){d.stopPropagation(),g("toggle-star",c.personality)}function y(d){d.stopPropagation(),g("share",c.personality)}function v(){g("select",c.personality)}return(d,n)=>(i(),o("div",{class:H(["relative flex flex-col h-full bg-white dark:bg-gray-800 border dark:border-gray-700 rounded-lg shadow p-4 transition-all hover:shadow-lg cursor-pointer overflow-hidden",{"ring-2 ring-offset-2 ring-green-500 dark:ring-offset-gray-900 !border-green-500":a.isActive,"opacity-50 pointer-events-none":a.isSaving}]),onClick:v,title:a.isShared?`Shared by ${a.sharedBy}`:`Select personality: ${a.personality.name}`},[a.isShared?(i(),o("div",{key:0,class:"shared-banner",title:`This personality was sent to you by ${a.sharedBy}`},n[0]||(n[0]=[l("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-3 w-3",viewBox:"0 0 20 20",fill:"currentColor"},[l("path",{d:"M15 8a3 3 0 10-2.977-2.63l-4.94 2.47a3 3 0 100 4.319l4.94 2.47a3 3 0 10.895-1.789l-4.94-2.47a3.027 3.027 0 000-.74l4.94-2.47C13.456 7.68 14.19 8 15 8z"})],-1)]),8,ne)):m("",!0),l("button",{onClick:M,class:"absolute top-2 right-2 p-1 rounded-full text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-yellow-500 z-10",title:a.isStarred?"Unstar personality":"Star personality"},[a.isStarred?(i(),o("svg",ue,n[1]||(n[1]=[l("path",{d:"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"},null,-1)]))):(i(),o("svg",ye,n[2]||(n[2]=[l("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"},null,-1)])))],8,de),a.isSaving?(i(),o("div",ce,n[3]||(n[3]=[l("svg",{class:"animate-spin h-8 w-8 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[l("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),l("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)]))):m("",!0),l("div",ge,[l("div",{class:"flex-shrink-0 w-10 h-10 rounded-full bg-gray-200 dark:bg-gray-600 flex items-center justify-center overflow-hidden",title:a.personality.name},[a.personality.icon_base64?(i(),o("img",{key:0,src:a.personality.icon_base64,alt:"icon",class:"w-full h-full object-cover"},null,8,fe)):(i(),o("svg",me,n[4]||(n[4]=[l("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"},null,-1)])))],8,ve),l("div",he,[l("h6",{class:"font-semibold text-gray-800 dark:text-gray-100",title:a.personality.name},h(a.personality.name),9,pe),!a.isUserPersonality&&!a.isShared?(i(),o("p",{key:0,class:"text-xs text-gray-500 dark:text-gray-400",title:`Author: ${a.personality.author||"System"}`},"by "+h(a.personality.author||"System"),9,xe)):m("",!0),a.isShared?(i(),o("p",{key:1,class:"text-xs text-gray-500 dark:text-gray-400",title:`Sent by: ${a.sharedBy}`},"from "+h(a.sharedBy),9,we)):m("",!0),a.personality.category?(i(),o("p",{key:2,class:"text-xs text-blue-500 dark:text-blue-400 bg-blue-100 dark:bg-blue-900/50 px-1.5 py-0.5 rounded-full inline-block mt-1",title:`Category: ${a.personality.category}`},h(a.personality.category),9,be)):m("",!0)])]),l("p",{class:"text-sm text-gray-600 dark:text-gray-300 mb-4 line-clamp-3",title:a.personality.description},h(a.personality.description||"No description provided."),9,ke),l("div",Se,[a.isUserPersonality?(i(),o("button",{key:0,onClick:y,class:"p-1 text-gray-400 hover:text-gray-600 dark:hover:text-gray-200",title:"Send to User"},[q(Z,{class:"h-4 w-4"})])):m("",!0),n[5]||(n[5]=l("div",{class:"flex-grow"},null,-1)),a.isUserPersonality?(i(),o(k,{key:1},[l("button",{onClick:u,class:"font-medium text-sm text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300",title:"Edit this personality"},"Edit"),l("button",{onClick:C,class:"font-medium text-sm text-red-600 hover:text-red-800 dark:text-red-400 dark:hover:text-red-300",title:"Delete this personality"},"Delete")],64)):(i(),o("button",{key:2,onClick:u,class:"font-medium text-sm text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300",title:"Make a copy and edit it"},"Clone & Edit"))])],10,oe))}},L=X(Ce,[["__scopeId","data-v-8c31f288"]]),Pe={class:"flex justify-between items-center mb-4 flex-wrap gap-2"},$e={class:"flex items-center gap-2"},Ae={class:"my-6 grid grid-cols-1 md:grid-cols-2 gap-4"},Be={class:"relative"},Me=["value"],De={class:"space-y-10"},Ue={key:0},Ee={key:0,class:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4"},Ie={key:1,class:"italic text-sm text-gray-500 p-2"},Te={class:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4"},je={key:0,class:"italic text-sm text-gray-500 p-2 mt-4"},Ne={key:1,class:"italic text-sm text-gray-500 p-2 mt-4"},ze={key:0,class:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4"},Le={key:1,class:"italic text-sm text-gray-500 p-2"},G="lollms-starred-personalities",Oe={__name:"PersonalitiesSettings",setup(a){const p=_(),c=ee(),g=te(),{user:u}=Y(p),{userPersonalities:C,publicPersonalities:M}=Y(c),y=w(""),v=w(null),d=w(""),n=w("All"),f=w(new Set),V=w(null),O=S(()=>[...C.value,...M.value]),J=S(()=>{const t=new Set(["All","Starred"]);return O.value.forEach(e=>{e.category&&t.add(e.category)}),Array.from(t).sort((e,s)=>e==="All"?-1:s==="All"?1:e==="Starred"?-1:s==="Starred"?1:e.localeCompare(s))}),P=S(()=>{let t=O.value;n.value==="Starred"?t=t.filter(s=>f.value.has(s.id)):n.value!=="All"&&(t=t.filter(s=>s.category===n.value));const e=d.value.toLowerCase().trim();return e&&(t=t.filter(s=>s.name.toLowerCase().includes(e)||s.description&&s.description.toLowerCase().includes(e))),t}),D=S(()=>P.value.filter(t=>!t.is_public&&t.owner_username!=="System")),R=S(()=>P.value.filter(t=>t.is_public||t.owner_username==="System")),$=t=>t.author&&t.author.startsWith("Sent by "),U=t=>$(t)?t.author.replace("Sent by ","").trim():"";se(()=>{c.fetchPersonalities();try{const t=localStorage.getItem(G);t&&(f.value=new Set(JSON.parse(t)))}catch(t){console.error("Failed to load starred personalities from localStorage:",t),f.value=new Set}u.value&&(y.value=u.value.active_personality_id||"",n.value=u.value.personalities_view_category||"All")}),N(()=>{var t;return(t=u.value)==null?void 0:t.active_personality_id},t=>{y.value=t||""}),N(()=>{var t;return(t=u.value)==null?void 0:t.personalities_view_category},t=>{n.value=t||"All"}),N(n,t=>{u.value&&t!==(u.value.personalities_view_category||"All")&&p.updateUserPreferences({personalities_view_category:t})});async function A(t){const e=new Set(f.value);e.has(t.id)?e.delete(t.id):e.add(t.id),f.value=e;try{localStorage.setItem(G,JSON.stringify(Array.from(e)))}catch(s){console.error("Failed to save starred personalities:",s),g.showToast({message:"Could not save favorite status.",type:"error"})}}async function E(t){if(!v.value){if(!t||y.value===t.id){await I();return}v.value=t.id;try{await p.updateUserPreferences({active_personality_id:t.id})}finally{v.value=null}}}async function I(){if(!(!y.value||v.value)){v.value=y.value;try{await p.updateUserPreferences({active_personality_id:null})}finally{v.value=null}}}function x(t=null){let e;t?(e={...t},(t.is_public||t.owner_username==="System")&&!p.user.is_admin&&(e.id=null,e.is_public=!1,e.owner_type="user")):e={id:null,name:"",category:"",description:"",prompt_text:"",is_public:!1,icon_base64:null},g.openModal("personalityEditor",{personality:e})}function K(){g.openModal("generatePersonality")}async function T(t){await g.showConfirmation({title:`Delete ${t.name}`,message:"Are you sure you want to delete this personality? This cannot be undone.",confirmText:"Delete"})&&(y.value===t.id&&await I(),f.value.has(t.id)&&A(t),await c.deletePersonality(t.id))}async function j(t){g.openModal("sharePersonality",{personalityId:t.id,title:t.name})}function Q(){V.value.click()}async function W(t){const e=t.target.files[0];e&&(await c.importPersonality(e),t.target.value="")}return(t,e)=>(i(),o("section",null,[l("div",Pe,[e[23]||(e[23]=l("h4",{class:"text-lg font-semibold"},"Personalities",-1)),l("div",$e,[l("input",{type:"file",ref_key:"importInputRef",ref:V,onChange:W,class:"hidden",accept:".zip"},null,544),l("button",{onClick:Q,class:"btn btn-secondary flex items-center gap-2",title:"Import from Zip"},[q(re,{class:"w-4 h-4"}),e[22]||(e[22]=le(" Import "))]),l("button",{onClick:e[0]||(e[0]=s=>K()),class:"btn btn-primary"},"Generate from Prompt"),l("button",{onClick:e[1]||(e[1]=s=>x()),class:"btn btn-secondary"},"+ Create New")])]),l("div",Ae,[l("div",Be,[F(l("input",{type:"text","onUpdate:modelValue":e[2]||(e[2]=s=>d.value=s),placeholder:"Search personalities...",class:"input-field w-full !pr-10"},null,512),[[ae,d.value]]),d.value?(i(),o("button",{key:0,onClick:e[3]||(e[3]=s=>d.value=""),class:"absolute inset-y-0 right-0 flex items-center pr-3 text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"},e[24]||(e[24]=[l("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[l("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))):m("",!0)]),l("div",null,[F(l("select",{"onUpdate:modelValue":e[4]||(e[4]=s=>n.value=s),class:"input-field w-full"},[(i(!0),o(k,null,B(J.value,s=>(i(),o("option",{key:s,value:s},h(s),9,Me))),128))],512),[[ie,n.value]])])]),l("div",De,[n.value==="Starred"?(i(),o("div",Ue,[e[25]||(e[25]=l("h5",{class:"text-md font-semibold mb-4"},"Starred Personalities",-1)),P.value.length>0?(i(),o("div",Ee,[(i(!0),o(k,null,B(P.value,s=>(i(),z(L,{key:s.id,personality:s,"is-user-personality":s.owner_username===b(u).username||b(u)&&b(u).is_admin,"is-active":s.id===y.value,"is-saving":s.id===v.value,"is-starred":f.value.has(s.id),"is-shared":$(s),"shared-by":U(s),onSelect:e[5]||(e[5]=r=>E(r)),onToggleStar:e[6]||(e[6]=r=>A(r)),onClone:e[7]||(e[7]=r=>x(r)),onEdit:e[8]||(e[8]=r=>x(r)),onDelete:e[9]||(e[9]=r=>T(r)),onShare:e[10]||(e[10]=r=>j(r))},null,8,["personality","is-user-personality","is-active","is-saving","is-starred","is-shared","shared-by"]))),128))])):(i(),o("p",Ie,h(d.value?"No starred personalities match your search.":"You haven't starred any personalities yet. Click the star icon on a personality to add it here."),1))])):(i(),o(k,{key:1},[l("div",null,[e[27]||(e[27]=l("h5",{class:"text-md font-semibold mb-4"},"Your Personalities",-1)),l("div",Te,[l("div",{onClick:I,class:H(["flex flex-col items-center justify-center h-full min-h-[160px] bg-white dark:bg-gray-800 border-2 border-dashed dark:border-gray-600 rounded-lg p-4 transition-all hover:border-gray-400 dark:hover:border-gray-500 cursor-pointer",{"!border-solid ring-2 ring-offset-2 ring-green-500 dark:ring-offset-gray-900 !border-green-500":!y.value}])},e[26]||(e[26]=[l("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 text-gray-400 mb-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"1.5"},[l("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636"})],-1),l("span",{class:"font-semibold text-sm text-gray-700 dark:text-gray-300"},"No Personality",-1),l("span",{class:"text-xs text-gray-500 dark:text-gray-400"},"(Default)",-1)]),2),(i(!0),o(k,null,B(D.value,s=>(i(),z(L,{key:s.id,personality:s,"is-user-personality":!0,"is-active":s.id===y.value,"is-saving":s.id===v.value,"is-starred":f.value.has(s.id),"is-shared":$(s),"shared-by":U(s),onSelect:e[11]||(e[11]=r=>E(r)),onToggleStar:e[12]||(e[12]=r=>A(r)),onEdit:e[13]||(e[13]=r=>x(r)),onDelete:e[14]||(e[14]=r=>T(r)),onShare:e[15]||(e[15]=r=>j(r))},null,8,["personality","is-active","is-saving","is-starred","is-shared","shared-by"]))),128))]),D.value.length===0&&b(C).length===0&&n.value==="All"&&!d.value?(i(),o("p",je," You haven't created any personalities yet. ")):D.value.length===0?(i(),o("p",Ne," No matches found in your personalities. ")):m("",!0)]),l("div",null,[e[28]||(e[28]=l("h5",{class:"text-md font-semibold mb-4"},"Public & System Personalities",-1)),R.value.length>0?(i(),o("div",ze,[(i(!0),o(k,null,B(R.value,s=>(i(),z(L,{key:s.id,personality:s,"is-user-personality":b(u)&&b(u).is_admin,"is-active":s.id===y.value,"is-saving":s.id===v.value,"is-starred":f.value.has(s.id),"is-shared":$(s),"shared-by":U(s),onSelect:e[16]||(e[16]=r=>E(r)),onToggleStar:e[17]||(e[17]=r=>A(r)),onClone:e[18]||(e[18]=r=>x(r)),onEdit:e[19]||(e[19]=r=>x(r)),onDelete:e[20]||(e[20]=r=>T(r)),onShare:e[21]||(e[21]=r=>j(r))},null,8,["personality","is-user-personality","is-active","is-saving","is-starred","is-shared","shared-by"]))),128))])):(i(),o("p",Le,h(d.value||n.value!=="All"?"No matches found in public personalities.":"No public personalities available."),1))])],64))])]))}};export{Oe as default};
