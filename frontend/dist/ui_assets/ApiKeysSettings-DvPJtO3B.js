import{ah as M,u as L,i as q,T as A,L as x,c as f,l as z,m as K,e as i,o as n,b as e,g as h,d as c,n as b,t as l,K as S,a0 as D,ac as V,F as E,r as R,at as B,h as O,f as U,az as Y}from"./index-iFocv_fM.js";const $={class:"space-y-10"},F={class:"bg-white dark:bg-gray-800 shadow-md rounded-lg"},j={class:"p-4 sm:p-6"},G={class:"space-y-4 mb-6"},H={class:"p-4 border rounded-lg dark:border-gray-700"},J={key:0,class:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm"},Q={class:"p-3 bg-gray-50 dark:bg-gray-700/50 rounded-md"},W={class:"text-gray-500 dark:text-gray-400"},X={class:"p-3 bg-gray-50 dark:bg-gray-700/50 rounded-md"},Z={class:"text-gray-500 dark:text-gray-400"},ee={key:0,class:"text-center"},te={key:1},ae={class:"flex-grow w-full"},se=["disabled"],le={key:0},oe={class:"border-t border-gray-200 dark:border-gray-700"},re={key:0,class:"p-6 text-center text-gray-500 dark:text-gray-400"},ie={key:1},ne={key:0,class:"px-4 sm:px-6 py-2 bg-blue-50 dark:bg-blue-900/20 flex items-center justify-between transition-all"},de={class:"flex items-center gap-4"},ce={class:"text-sm font-semibold text-blue-800 dark:text-blue-200"},ue={role:"list",class:"divide-y divide-gray-200 dark:divide-gray-700"},ye=["value"],ge={class:"flex-grow ml-2"},pe={class:"text-sm font-semibold text-gray-900 dark:text-white"},me={class:"text-sm text-gray-500 dark:text-gray-400 font-mono"},be={class:"text-xs text-gray-500 dark:text-gray-400 text-right"},ve=["onClick"],he={__name:"ApiKeysSettings",setup(xe){const d=M(),u=L(),C=q(),{apiKeys:y}=A(d),{user:o}=A(C),g=x(""),p=x(!1),s=x(new Set),m=f(()=>o.value?o.value.openai_api_service_enabled||o.value.ollama_service_enabled:!1),_=f(()=>y.value.length>0),v=f({get:()=>_.value&&s.value.size===y.value.length,set:a=>{a?s.value=new Set(y.value.map(t=>t.id)):s.value.clear()}});z(()=>{if(m.value&&d.apiKeys.length===0)try{d.fetchApiKeys()}catch{console.log("couldn't fetch api key (this is expected if the service is not enabled by the admin)")}}),K(m,a=>{if(a&&d.apiKeys.length===0)try{d.fetchApiKeys()}catch{console.log("couldn't fetch api key (this is expected if the service is not enabled by the admin)")}}),K(y,()=>{s.value.clear()});function k(a){return a?new Date(a).toLocaleString():"Never"}async function T(){if(!g.value.trim()){u.addNotification("Please provide an alias for the new key.","warning");return}p.value=!0;try{const a=await d.addApiKey(g.value.trim());u.openModal("newApiKey",{keyData:a}),g.value=""}catch{}finally{p.value=!1}}async function I(a){await u.showConfirmation({title:`Delete key '${a.alias}'?`,message:"This will permanently revoke the key. This action cannot be undone.",confirmText:"Delete Key"})&&await d.deleteSingleApiKey(a.id)}async function N(){const a=Array.from(s.value);if(a.length===0){u.addNotification("No keys selected for deletion.","warning");return}await u.showConfirmation({title:`Delete ${a.length} API Key(s)?`,message:"This will permanently revoke the selected keys. This action cannot be undone.",confirmText:"Delete Selected"})&&await d.deleteMultipleApiKeys(a)}function P(){v.value=!v.value}return(a,t)=>(n(),i("div",$,[e("div",F,[t[10]||(t[10]=e("div",{class:"p-4 sm:p-6 border-b border-gray-200 dark:border-gray-700"},[e("h2",{class:"text-xl font-bold leading-6 text-gray-900 dark:text-white"},"API Keys"),e("p",{class:"mt-1 max-w-2xl text-sm text-gray-500 dark:text-gray-400"}," Manage your API keys for accessing the LoLLMs backend with OpenAI-compatible tools. ")],-1)),e("div",j,[e("div",G,[e("div",H,[t[5]||(t[5]=e("h3",{class:"font-semibold text-lg mb-2"},"API Service Status",-1)),c(o)?(n(),i("div",J,[e("div",Q,[t[3]||(t[3]=e("p",{class:"font-medium text-gray-800 dark:text-gray-200"},"OpenAI-Compatible API",-1)),e("p",{class:b(c(o).openai_api_service_enabled?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400")}," Status: "+l(c(o).openai_api_service_enabled?"Enabled":"Disabled"),3),e("p",W," Key Required: "+l(c(o).openai_api_require_key?"Yes":"No"),1)]),e("div",X,[t[4]||(t[4]=e("p",{class:"font-medium text-gray-800 dark:text-gray-200"},"Ollama-Compatible API",-1)),e("p",{class:b(c(o).ollama_service_enabled?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400")}," Status: "+l(c(o).ollama_service_enabled?"Enabled":"Disabled"),3),e("p",Z," Key Required: "+l(c(o).ollama_require_key?"Yes":"No"),1)])])):h("",!0),t[6]||(t[6]=e("p",{class:"text-xs text-gray-500 mt-2"},"API keys below can be used for any enabled service that requires a key.",-1))])]),m.value?(n(),i("div",te,[e("form",{onSubmit:S(T,["prevent"]),class:"flex flex-col sm:flex-row items-start sm:items-end gap-4"},[e("div",ae,[t[8]||(t[8]=e("label",{for:"keyAlias",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"New Key Alias",-1)),D(e("input",{type:"text",id:"keyAlias","onUpdate:modelValue":t[0]||(t[0]=r=>g.value=r),class:"input-field mt-1",placeholder:"e.g., My Research Tool",required:""},null,512),[[V,g.value]])]),e("button",{type:"submit",class:"btn btn-primary w-full sm:w-auto",disabled:p.value},l(p.value?"Creating...":"Create New Key"),9,se)],32)])):(n(),i("div",ee,t[7]||(t[7]=[e("div",{class:"p-4 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800/50 rounded-lg"},[e("p",{class:"text-sm text-yellow-800 dark:text-yellow-200"}," All API services are currently disabled by the administrator. ")],-1)])))]),m.value?(n(),i("div",le,[e("div",oe,[_.value?(n(),i("div",ie,[s.value.size>0?(n(),i("div",ne,[e("div",de,[e("span",ce,l(s.value.size)+" selected",1),e("button",{onClick:P,class:"text-sm font-medium text-blue-600 hover:underline"},l(v.value?"Deselect All":"Select All"),1)]),e("button",{onClick:N,class:"btn btn-danger btn-sm"}," Delete Selected ")])):h("",!0),e("ul",ue,[(n(!0),i(E,null,R(c(y),r=>(n(),i("li",{key:r.id,class:b(["px-4 py-4 sm:px-6 flex items-center gap-4 group transition-colors duration-150",{"bg-blue-50 dark:bg-blue-900/40":s.value.has(r.id)}])},[D(e("input",{type:"checkbox",value:r.id,"onUpdate:modelValue":t[1]||(t[1]=w=>s.value=w),onClick:t[2]||(t[2]=S(()=>{},["stop"])),class:"h-4 w-4 rounded border-gray-300 dark:border-gray-600 text-blue-600 focus:ring-blue-500"},null,8,ye),[[B,s.value]]),e("div",ge,[e("p",pe,l(r.alias),1),e("p",me,[O(l(r.key_prefix),1),t[9]||(t[9]=e("span",null,"...",-1))])]),e("div",be,[e("p",null,"Last used: "+l(k(r.last_used_at)),1),e("p",null,"Created: "+l(k(r.created_at)),1)]),e("button",{onClick:w=>I(r),class:b(["p-2 rounded-full text-gray-400 hover:bg-red-100 hover:text-red-600 dark:hover:bg-red-900/50 dark:hover:text-red-400 opacity-0 group-hover:opacity-100 transition-opacity",{"opacity-100":s.value.size>0}]),title:"Delete this key"},[U(Y,{class:"h-5 w-5"})],10,ve)],2))),128))])])):(n(),i("div",re," You have not created any API keys yet. "))])])):h("",!0)])]))}};export{he as default};
