const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["ui_assets/BindingModelsManager-DgraIzTu.js","ui_assets/index-BztlMlxc.js","ui_assets/index-BOdou5EQ.css","ui_assets/admin-DdhxCg1C.js","ui_assets/BindingZoo-BHY-6GEp.js"])))=>i.map(i=>d[i]);
import{u as de,s as ue,r as c,h as E,l as ce,x as me,d as o,o as a,z as N,a as t,e as g,t as r,n as u,f as C,j as M,v as F,y as L,F as x,A as h,i as B,C as ve,c as U,ca as ge,cb as fe,$ as be,b as O,ar as H,ae as ye,w as K,V as Q}from"./index-BztlMlxc.js";import{useAdminStore as pe}from"./admin-DdhxCg1C.js";import{_ as _e}from"./GenericModal-DF57XP4_.js";const xe={class:"space-y-8"},he={key:0,class:"bg-white dark:bg-gray-800 shadow-md rounded-lg p-6"},ke={class:"flex justify-between items-center mb-4"},we={class:"text-xl font-semibold"},Ce={key:0,class:"flex gap-2 text-sm font-medium"},Be={key:0},$e={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},Se=["disabled"],Ae=["value"],Me={key:0,class:"space-y-6 border-t dark:border-gray-700 pt-6"},Te={class:"text-sm text-gray-600 dark:text-gray-400"},Ve=["for"],je={key:0,class:"text-red-500"},De=["id","onUpdate:modelValue"],Ee=["value"],Ne={key:1},Fe={class:"relative"},Le=["type","id","onUpdate:modelValue","required","placeholder"],Ue=["onClick","title"],Oe={key:2,class:"flex items-center justify-between bg-gray-50 dark:bg-gray-700/50 p-3 rounded-md"},ze={class:"flex-grow flex flex-col pr-4"},Ie={class:"text-sm text-gray-500 dark:text-gray-400"},Pe=["onClick"],qe={class:"text-xs text-gray-500 mt-1"},Re={key:1,class:"mt-6 border-t dark:border-gray-700 pt-6"},Ge={class:"grid grid-cols-1 gap-4"},Je={class:"flex justify-between items-start mb-3"},Ze={class:"font-bold text-md"},He={class:"text-sm text-gray-600 dark:text-gray-400"},Ke={key:0,class:"space-y-3 mb-4"},Qe={class:"block text-xs font-medium uppercase text-gray-500 dark:text-gray-400 mb-1"},We=["onUpdate:modelValue","placeholder"],Xe={key:1,class:"flex items-center gap-2"},Ye=["onClick"],et={class:"text-sm"},tt={class:"flex justify-end"},nt=["onClick"],st={class:"flex items-center justify-between bg-gray-50 dark:bg-gray-700/50 p-3 rounded-md"},at={class:"flex justify-end gap-3"},lt=["disabled"],ot={key:1},it={key:2},rt={key:1},dt={class:"flex justify-between items-center mb-4 flex-wrap gap-4"},ut={class:"flex items-center gap-4"},ct={key:0,class:"text-center p-6"},mt={key:1,class:"text-center p-6 bg-gray-50 dark:bg-gray-800/50 rounded-lg"},vt={key:2,class:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6"},gt=["onClick"],ft=["onClick","title"],bt={class:"flex-grow"},yt={class:"flex items-center gap-3 mb-2"},pt={class:"font-bold text-lg text-gray-900 dark:text-white"},_t={class:"text-xs text-gray-500 dark:text-gray-400"},xt={class:"mt-3 text-sm text-gray-600 dark:text-gray-300"},ht={key:0,class:"mb-1"},kt={class:"text-xs text-gray-400 truncate"},wt={class:"border-t dark:border-gray-700 pt-3 flex justify-between items-center text-xs text-gray-500"},Ct=["onClick"],Bt={class:"space-y-4"},$t={key:0,class:"text-center text-gray-500"},St={key:1,class:"flex gap-4"},At={class:"w-1/3 border-r dark:border-gray-700 pr-4 space-y-2"},Mt=["onClick"],Tt={class:"w-2/3 pl-2"},Vt={key:0},jt={class:"font-bold text-lg mb-2"},Dt={class:"text-sm text-gray-600 dark:text-gray-400 mb-4"},Et={key:0,class:"space-y-3 mb-4 bg-gray-50 dark:bg-gray-800 p-3 rounded-md border dark:border-gray-700"},Nt={class:"block text-xs font-medium uppercase text-gray-500 dark:text-gray-400 mb-1"},Ft=["onUpdate:modelValue","placeholder"],Lt={key:1,class:"flex items-center gap-2"},Ut=["onClick"],Ot={class:"text-sm"},zt={class:"flex justify-end"},It=["disabled"],Pt={key:1,class:"h-full flex items-center justify-center text-gray-400 text-sm"},Zt={__name:"LLMBindingsSettings",setup(qt){const W=H(()=>Q(()=>import("./BindingModelsManager-DgraIzTu.js"),__vite__mapDeps([0,1,2,3]))),X=H(()=>Q(()=>import("./BindingZoo-BHY-6GEp.js"),__vite__mapDeps([4,1,2,3]))),f=pe(),$=de(),{bindings:z,availableBindingTypes:S,isLoadingBindings:Y,globalSettings:I}=ue(f),T=c(!1),p=c(null),A=c(!1),k=c({}),b=c({}),d=c("settings"),V=c(!1),P=c(null),q=c([]),m=c(null),y=c({}),j=c(!1),R=()=>({id:null,alias:"",name:"",config:{},default_model_name:"",is_active:!0}),i=c(R()),w=E(()=>p.value!==null),_=E(()=>i.value.name?S.value.find(l=>l.binding_name===i.value.name):null),ee=E(()=>{if(!_.value)return[];const l=_.value.input_parameters||[],n=new Set(l.map(s=>s.name)),e=Object.keys(i.value.config||{}).filter(s=>!n.has(s)&&s!=="model_name").map(s=>({name:s,type:typeof i.value.config[s]=="boolean"?"bool":typeof i.value.config[s]=="number"?"float":"str",description:"(Parameter not in binding description)",mandatory:!1}));return[...l.filter(s=>s.name!=="model_name"),...e]});ce(()=>i.value.name,(l,n)=>{if(l!==n&&!w.value){const e=S.value.find(v=>v.binding_name===l),s={};e&&e.input_parameters&&e.input_parameters.forEach(v=>{s[v.name]=v.default}),i.value.config=s}});const G=E({get(){if(!Array.isArray(I.value))return"mixed";const l=I.value.find(n=>n.key==="model_display_mode");return l?l.value:"mixed"},set(l){f.updateGlobalSettings({model_display_mode:l})}});me(()=>{f.fetchBindings(),f.fetchAvailableBindingTypes(),f.fetchGlobalSettings()});function J(){p.value=null,i.value=R(),k.value={},b.value={},T.value=!0,d.value="settings",window.scrollTo({top:0,behavior:"smooth"})}function te(l){p.value=l,i.value=JSON.parse(JSON.stringify(l)),i.value.config||(i.value.config={}),k.value={};const n=S.value.find(e=>e.binding_name===l.name);if(n&&n.commands){const e={};n.commands.forEach(s=>{e[s.name]={},s.parameters&&s.parameters.forEach(v=>{e[s.name][v.name]=v.default!==void 0?v.default:""})}),b.value=e}else b.value={};T.value=!0,d.value="settings",window.scrollTo({top:0,behavior:"smooth"})}function D(){T.value=!1,p.value=null}function ne(l){return typeof l=="string"?l.split(",").map(n=>n.trim()).filter(n=>n):Array.isArray(l)?l.filter(n=>n):[]}async function se(){if(!i.value.alias.trim()||!i.value.name){$.addNotification("Alias and Binding Type are required fields.","warning");return}A.value=!0;try{const l={alias:i.value.alias,name:i.value.name,config:i.value.config||{},is_active:i.value.is_active,default_model_name:i.value.default_model_name||null};w.value?await f.updateBinding(p.value.id,l):await f.addBinding(l),D()}catch(l){console.error("Submit failed:",l.message)}finally{A.value=!1}}async function ae(l){await $.showConfirmation({title:`Delete Binding '${l.alias}'?`,message:"Are you sure? This action cannot be undone.",confirmText:"Delete"})&&await f.deleteBinding(l.id)}async function le(l){await f.updateBinding(l.id,{is_active:!l.is_active})}function oe(l){const n=S.value.find(e=>e.binding_name===l);return n?n.title:l}async function Z(l,n,e){try{$.addNotification(`Submitting command '${l.title||l.name}'...`,"info");const s=await f.executeBindingCommand(n,l.name,e);if(s)return $.addNotification(`Task started: ${l.title||l.name}. Check Task Manager for progress.`,"success",5e3),s}catch(s){console.error(s),$.addNotification(`Command submission failed: ${s.message}`,"error")}}function ie(l){m.value=l,y.value={},l.parameters&&l.parameters.forEach(n=>{y.value[n.name]=n.default!==void 0?n.default:""})}async function re(){if(!(!m.value||!P.value)){j.value=!0;try{await Z(m.value,P.value.id,y.value),V.value=!1}finally{j.value=!1}}}return(l,n)=>(a(),o("div",xe,[T.value?(a(),o("div",he,[t("div",ke,[t("h3",we,r(w.value?"Edit Binding: "+i.value.alias:"Add New Binding"),1),w.value?(a(),o("div",Ce,[t("button",{onClick:n[0]||(n[0]=e=>d.value="settings"),class:u([{"text-blue-600 border-b-2 border-blue-600":d.value==="settings","text-gray-500 hover:text-gray-700":d.value!=="settings"},"px-3 py-2"])},"Settings",2),t("button",{onClick:n[1]||(n[1]=e=>d.value="zoo"),class:u([{"text-blue-600 border-b-2 border-blue-600":d.value==="zoo","text-gray-500 hover:text-gray-700":d.value!=="zoo"},"px-3 py-2"])},"Models Zoo",2),t("button",{onClick:n[2]||(n[2]=e=>d.value="models"),class:u([{"text-blue-600 border-b-2 border-blue-600":d.value==="models","text-gray-500 hover:text-gray-700":d.value!=="models"},"px-3 py-2"])},"Installed Models",2)])):g("",!0)]),d.value==="settings"?(a(),o("div",Be,[t("form",{onSubmit:O(se,["prevent"]),class:"space-y-6"},[t("div",$e,[t("div",null,[n[10]||(n[10]=t("label",{for:"alias",class:"block text-sm font-medium"},[M("Alias "),t("span",{class:"text-red-500"},"*")],-1)),C(t("input",{type:"text",id:"alias","onUpdate:modelValue":n[3]||(n[3]=e=>i.value.alias=e),class:"input-field mt-1",required:"",placeholder:"e.g., local_ollama",autocomplete:"off"},null,512),[[F,i.value.alias]]),n[11]||(n[11]=t("p",{class:"text-xs text-gray-500 mt-1"},"A unique, short name for this configuration.",-1))]),t("div",null,[n[13]||(n[13]=t("label",{for:"name",class:"block text-sm font-medium"},[M("Binding Type "),t("span",{class:"text-red-500"},"*")],-1)),C(t("select",{id:"name","onUpdate:modelValue":n[4]||(n[4]=e=>i.value.name=e),class:"input-field mt-1",required:"",disabled:w.value},[n[12]||(n[12]=t("option",{disabled:"",value:""},"Select a type",-1)),(a(!0),o(x,null,h(B(S),e=>(a(),o("option",{key:e.binding_name,value:e.binding_name},r(e.title),9,Ae))),128))],8,Se),[[L,i.value.name]])])]),_.value?(a(),o("div",Me,[t("p",Te,r(_.value.description),1),(a(!0),o(x,null,h(ee.value,e=>(a(),o("div",{key:e.name,class:"space-y-1"},[t("label",{for:`param-${e.name}`,class:"block text-sm font-medium capitalize"},[M(r(e.name.replace(/_/g," "))+" ",1),e.mandatory?(a(),o("span",je,"*")):g("",!0)],8,Ve),e.options&&e.options.length>0?C((a(),o("select",{key:0,id:`param-${e.name}`,"onUpdate:modelValue":s=>i.value.config[e.name]=s,class:"input-field"},[(a(!0),o(x,null,h(ne(e.options),s=>(a(),o("option",{key:s,value:s},r(s),9,Ee))),128))],8,De)),[[L,i.value.config[e.name]]]):["str","int","float"].includes(e.type)?(a(),o("div",Ne,[t("div",Fe,[C(t("input",{type:(e.name.includes("key")||e.name.includes("token"))&&!k.value[e.name]?"password":"text",id:`param-${e.name}`,"onUpdate:modelValue":s=>i.value.config[e.name]=s,class:"input-field",required:e.mandatory,placeholder:e.description,autocomplete:"off"},null,8,Le),[[ve,i.value.config[e.name]]]),e.name.includes("key")||e.name.includes("token")?(a(),o("button",{key:0,type:"button",onClick:s=>k.value[e.name]=!k.value[e.name],class:"absolute inset-y-0 right-0 px-3 flex items-center text-gray-500 hover:text-gray-700 dark:hover:text-gray-300",title:k.value[e.name]?"Hide":"Show"},[k.value[e.name]?(a(),U(ge,{key:0,class:"w-5 h-5"})):(a(),U(fe,{key:1,class:"w-5 h-5"}))],8,Ue)):g("",!0)])])):e.type==="bool"?(a(),o("div",Oe,[t("span",ze,[t("span",Ie,r(e.description),1)]),t("button",{onClick:s=>i.value.config[e.name]=!i.value.config[e.name],type:"button",class:u([i.value.config[e.name]?"bg-blue-600":"bg-gray-200 dark:bg-gray-600","relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out"])},[t("span",{class:u([i.value.config[e.name]?"translate-x-5":"translate-x-0","pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition-colors duration-200 ease-in-out"])},null,2)],10,Pe)])):g("",!0),t("p",qe,r(e.description),1)]))),128))])):g("",!0),w.value&&_.value&&_.value.commands&&_.value.commands.length>0?(a(),o("div",Re,[n[14]||(n[14]=t("h4",{class:"text-lg font-semibold mb-4"},"Binding Commands",-1)),t("div",Ge,[(a(!0),o(x,null,h(_.value.commands,e=>(a(),o("div",{key:e.name,class:"p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg border dark:border-gray-600"},[t("div",Je,[t("div",null,[t("h5",Ze,r(e.title||e.name),1),t("p",He,r(e.description),1)])]),e.parameters&&e.parameters.length>0?(a(),o("div",Ke,[(a(!0),o(x,null,h(e.parameters,s=>(a(),o("div",{key:s.name},[t("label",Qe,r(s.name),1),s.type!=="bool"?C((a(),o("input",{key:0,type:"text","onUpdate:modelValue":v=>b.value[e.name][s.name]=v,class:"input-field text-sm",placeholder:s.default},null,8,We)),[[F,b.value[e.name][s.name]]]):(a(),o("div",Xe,[t("button",{onClick:v=>b.value[e.name][s.name]=!b.value[e.name][s.name],type:"button",class:u([b.value[e.name][s.name]?"bg-blue-600":"bg-gray-200 dark:bg-gray-600","relative inline-flex h-5 w-9 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out"])},[t("span",{class:u([b.value[e.name][s.name]?"translate-x-4":"translate-x-0","pointer-events-none inline-block h-4 w-4 transform rounded-full bg-white shadow ring-0 transition-colors duration-200 ease-in-out"])},null,2)],10,Ye),t("span",et,r(s.description),1)]))]))),128))])):g("",!0),t("div",tt,[t("button",{type:"button",onClick:s=>Z(e,p.value.id,b.value[e.name]),class:"btn btn-primary btn-sm"},"Execute",8,nt)])]))),128))])])):g("",!0),t("div",st,[n[15]||(n[15]=t("span",{class:"flex-grow flex flex-col"},[t("span",{class:"text-sm font-medium text-gray-900 dark:text-gray-100"},"Active"),t("span",{class:"text-sm text-gray-500 dark:text-gray-400"},"If disabled, users cannot see or use models from this binding.")],-1)),t("button",{onClick:n[5]||(n[5]=e=>i.value.is_active=!i.value.is_active),type:"button",class:u([i.value.is_active?"bg-blue-600":"bg-gray-200 dark:bg-gray-600","relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out"])},[t("span",{class:u([i.value.is_active?"translate-x-5":"translate-x-0","pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition-colors duration-200 ease-in-out"])},null,2)],2)]),t("div",at,[t("button",{type:"button",onClick:D,class:"btn btn-secondary"},"Close"),t("button",{type:"submit",class:"btn btn-primary",disabled:A.value},[A.value?(a(),U(be,{key:0,class:"w-5 h-5 mr-2"})):g("",!0),M(" "+r(A.value?"Saving...":w.value?"Save Changes":"Add Binding"),1)],8,lt)])],32)])):d.value==="zoo"?(a(),o("div",ot,[N(B(X),{binding:p.value,"binding-type":"llm"},null,8,["binding"]),t("div",{class:"flex justify-end gap-3 mt-4"},[t("button",{type:"button",onClick:D,class:"btn btn-secondary"},"Close")])])):d.value==="models"?(a(),o("div",it,[N(B(W),{binding:p.value,"binding-type":"llm"},null,8,["binding"]),t("div",{class:"flex justify-end gap-3 mt-4"},[t("button",{type:"button",onClick:D,class:"btn btn-secondary"},"Close")])])):g("",!0)])):(a(),o("div",rt,[t("div",dt,[n[18]||(n[18]=t("h2",{class:"text-2xl font-bold"},"LLM Bindings",-1)),t("div",ut,[t("div",null,[n[17]||(n[17]=t("label",{for:"model-display-mode",class:"block text-xs font-medium text-gray-500 dark:text-gray-400"},"Model Display Mode",-1)),C(t("select",{id:"model-display-mode","onUpdate:modelValue":n[6]||(n[6]=e=>G.value=e),class:"input-field mt-1"},n[16]||(n[16]=[t("option",{value:"mixed"},"Mixed (Alias or Original)",-1),t("option",{value:"aliased"},"Aliased Only",-1),t("option",{value:"original"},"Original Names Only",-1)]),512),[[L,G.value]])]),t("button",{onClick:J,class:"btn btn-primary self-end"},"+ Add New Binding")])]),B(Y)?(a(),o("div",ct,"Loading bindings...")):B(z).length===0?(a(),o("div",mt,[n[19]||(n[19]=t("p",null,"No LLM bindings configured yet.",-1)),t("button",{onClick:J,class:"mt-2 text-blue-600 hover:underline"},"Add your first one")])):(a(),o("div",vt,[(a(!0),o(x,null,h(B(z),e=>(a(),o("div",{key:e.id,onClick:s=>te(e),class:"bg-white dark:bg-gray-800 p-5 rounded-lg shadow-md hover:shadow-lg transition-shadow cursor-pointer flex flex-col gap-4 border border-transparent hover:border-blue-500 group relative"},[t("div",{class:"absolute top-4 right-4 z-10",onClick:n[7]||(n[7]=O(()=>{},["stop"]))},[t("button",{onClick:s=>le(e),type:"button",class:u([e.is_active?"bg-blue-600":"bg-gray-200 dark:bg-gray-600","relative inline-flex h-5 w-9 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out"]),title:e.is_active?"Deactivate":"Activate"},[t("span",{class:u([e.is_active?"translate-x-4":"translate-x-0","pointer-events-none inline-block h-4 w-4 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out"])},null,2)],10,ft)]),t("div",bt,[t("div",yt,[N(ye,{class:"w-8 h-8 text-blue-500"}),t("div",null,[t("h4",pt,r(e.alias),1),t("p",_t,r(oe(e.name)),1)])]),t("div",xt,[e.default_model_name?(a(),o("p",ht,[n[20]||(n[20]=t("span",{class:"font-semibold"},"Default:",-1)),M(" "+r(e.default_model_name),1)])):g("",!0),t("p",kt,r(e.config?Object.keys(e.config).filter(s=>!s.includes("key")).join(", "):""),1)])]),t("div",wt,[n[21]||(n[21]=t("span",null,"Click to edit",-1)),t("button",{onClick:O(s=>ae(e),["stop"]),class:"text-red-500 hover:underline p-1"},"Delete",8,Ct)])],8,gt))),128))]))])),N(_e,{visible:V.value,title:"Binding Commands",onClose:n[9]||(n[9]=e=>V.value=!1)},{footer:K(()=>[t("button",{onClick:n[8]||(n[8]=e=>V.value=!1),class:"btn btn-secondary"},"Close")]),default:K(()=>[t("div",Bt,[q.value.length?(a(),o("div",St,[t("div",At,[(a(!0),o(x,null,h(q.value,e=>(a(),o("button",{key:e.name,onClick:s=>ie(e),class:u(["w-full text-left px-3 py-2 rounded-md text-sm transition-colors",m.value&&m.value.name===e.name?"bg-blue-100 dark:bg-blue-900 text-blue-700 dark:text-blue-200 font-medium":"hover:bg-gray-100 dark:hover:bg-gray-700"])},r(e.title||e.name),11,Mt))),128))]),t("div",Tt,[m.value?(a(),o("div",Vt,[t("h4",jt,r(m.value.title||m.value.name),1),t("p",Dt,r(m.value.description),1),m.value.parameters&&m.value.parameters.length?(a(),o("div",Et,[(a(!0),o(x,null,h(m.value.parameters,e=>(a(),o("div",{key:e.name},[t("label",Nt,r(e.name),1),e.type!=="bool"?C((a(),o("input",{key:0,type:"text","onUpdate:modelValue":s=>y.value[e.name]=s,class:"input-field text-sm",placeholder:e.default},null,8,Ft)),[[F,y.value[e.name]]]):(a(),o("div",Lt,[t("button",{onClick:s=>y.value[e.name]=!y.value[e.name],type:"button",class:u([y.value[e.name]?"bg-blue-600":"bg-gray-200 dark:bg-gray-600","relative inline-flex h-5 w-9 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out"])},[t("span",{class:u([y.value[e.name]?"translate-x-4":"translate-x-0","pointer-events-none inline-block h-4 w-4 transform rounded-full bg-white shadow ring-0 transition-colors duration-200 ease-in-out"])},null,2)],10,Ut),t("span",Ot,r(e.description),1)]))]))),128))])):g("",!0),t("div",zt,[t("button",{onClick:re,class:"btn btn-primary",disabled:j.value},r(j.value?"Starting Task...":"Execute Command"),9,It)])])):(a(),o("div",Pt," Select a command to view details. "))])])):(a(),o("div",$t," No commands available for this binding. "))])]),_:1},8,["visible"])]))}};export{Zt as default};
