import{a7 as G,r as m,a as L,a8 as M,q as k,D as Q,s as X,y as R,c as Y,w as ee,o as te,b as T,e as V,d as u,g as b,l as d,j as U,h as D,f as t,i as j,v as F,p as I,A as f,cd as ae,K as oe,J as se,k as _,am as ne,cU as ie,t as A,O as re,W as le,_ as ce,ak as de,ab as ue,ae as fe,aj as pe,F as B,B as P,aw as ve,a5 as be,a4 as ge,cV as ke,af as ye,U as me,cW as we}from"./index-GJY6etPD.js";import{_ as he}from"./PageViewLayout-DZpmQE8Y.js";import{I as xe}from"./IconArchiveBox-BS_vPSaT.js";const _e=G("notebooks",()=>{const v=m([]),o=m(null),n=m(!1),p=L(),N=M();async function w(){n.value=!0;try{const r=await k.get("/api/notebooks");v.value=r.data}finally{n.value=!1}}async function i(r){const l=v.value.find(c=>c.id===r);l&&(o.value=l),await w(),o.value=v.value.find(c=>c.id===r)||null}async function S(){if(o.value)try{const r=await k.put(`/api/notebooks/${o.value.id}`,{title:o.value.title,content:o.value.content,artefacts:o.value.artefacts});o.value=r.data;const l=v.value.findIndex(c=>c.id===r.data.id);l!==-1&&(v.value[l]=r.data)}catch{p.addNotification("Failed to save notebook.","error")}}async function g(r){if(!o.value)return;const l=new FormData;l.append("file",r);try{await k.post(`/api/notebooks/${o.value.id}/upload`,l),await w(),o.value=v.value.find(c=>c.id===o.value.id),p.addNotification(`Uploaded ${r.name}`,"success")}catch(c){p.addNotification(`Upload failed: ${r.name}. ${c.message}`,"error"),console.error(c)}}async function h(r,l){if(o.value)try{await k.post(`/api/notebooks/${o.value.id}/artefact`,{title:r,content:l}),await w(),o.value=v.value.find(c=>c.id===o.value.id),p.addNotification(`Saved "${r}" as source.`,"success")}catch(c){p.addNotification(`Failed to save source: ${c.message}`,"error")}}async function C(r){if(o.value)try{const l=await k.post(`/api/notebooks/${o.value.id}/scrape`,{url:r});N.addTask(l.data),p.addNotification(`Scraping task started for ${r}`,"info")}catch(l){p.addNotification(`Scrape request failed: ${l.message}`,"error")}}async function y(r){if(o.value)try{const l=new FormData;l.append("prompt",r);const c=await k.post(`/api/notebooks/${o.value.id}/process`,l);N.addTask(c.data),p.addNotification("AI processing started.","info")}catch{p.addNotification("Failed to start AI processing.","error")}}function x(){v.value=[],o.value=null}return{notebooks:v,activeNotebook:o,isLoading:n,fetchNotebooks:w,selectNotebook:i,saveActive:S,uploadSource:g,createTextArtefact:h,scrapeUrl:C,processWithAi:y,$reset:x}}),Ne={class:"p-2 space-y-4"},Se={class:"space-y-1"},Ce=["onClick"],$e={class:"truncate font-semibold text-sm"},Te=["onClick"],Ie={key:0,class:"absolute inset-0 bg-blue-500/10 border-4 border-dashed border-blue-500 rounded-lg z-50 flex items-center justify-center m-4 pointer-events-none"},Ae={class:"p-3 border-b dark:border-gray-700 flex items-center justify-between shadow-sm"},Ue={class:"flex items-center gap-3 flex-grow"},De={class:"flex items-center gap-2 flex-shrink-0"},Re={class:"bg-gray-100 dark:bg-gray-800 p-1 rounded-lg flex gap-1"},Ve={class:"flex-grow flex min-h-0 relative"},je={class:"flex-grow flex flex-col min-w-0 border-r dark:border-gray-700"},Fe={key:0,class:"px-4 py-2 bg-blue-50 dark:bg-blue-900/40 border-b flex items-center justify-between gap-4"},Be={class:"text-xs font-black text-blue-700 dark:text-blue-300 truncate uppercase"},Pe={class:"w-32 h-1.5 bg-blue-200 dark:bg-blue-800 rounded-full overflow-hidden"},Le={class:"flex-grow overflow-hidden relative"},Me={key:0,class:"absolute inset-0 overflow-y-auto p-8 custom-scrollbar"},We={class:"p-4 border-t dark:border-gray-700 bg-gray-50 dark:bg-gray-800/50"},Ee={class:"max-w-4xl mx-auto flex gap-2 items-center"},Oe=["disabled"],ze={class:"w-80 flex-shrink-0 flex flex-col bg-gray-50/50 dark:bg-gray-900/30"},Ke={class:"p-3 border-b dark:border-gray-700 flex justify-between items-center"},qe={class:"flex gap-1"},He={class:"flex-grow overflow-y-auto p-2 space-y-2 custom-scrollbar"},Je={class:"flex items-center justify-between mb-2"},Ze={class:"flex items-center gap-2 min-w-0"},Ge=["title"],Qe=["onClick"],Xe=["onClick"],Ye={key:0,class:"text-center py-10 text-[10px] uppercase font-bold text-gray-400 opacity-50 italic px-4"},et={key:1,class:"h-full flex items-center justify-center text-gray-500 italic text-sm"},tt={__name:"NotebookStudioView",setup(v){const o=L(),n=_e(),p=X(),N=M(),{notebooks:w,activeNotebook:i}=R(n),{tasks:S}=R(N),g=m(""),h=m(!1),C=m(null),y=m(!0),x=Y(()=>i.value?S.value.find(s=>s.name.includes(i.value.id)&&(s.status==="running"||s.status==="pending")):null);async function r(){try{const s=await k.post("/api/notebooks",{title:"New Research",content:""});await n.fetchNotebooks(),await n.selectNotebook(s.data.id)}catch{o.addNotification("Failed to create notebook.","error")}}async function l(s){await o.showConfirmation({title:"Delete Notebook?"})&&(await n.selectNotebook(s),await k.delete(`/api/notebooks/${s}`),await n.fetchNotebooks(),n.activeNotebook=null)}async function c(s){s.is_loaded=!s.is_loaded,await n.saveActive()}async function W(s){await o.showConfirmation({title:"Remove Source?"})&&(i.value.artefacts=i.value.artefacts.filter(e=>e.filename!==s),await n.saveActive())}async function E(){if(!i.value)return;const{confirmed:s,value:e}=await o.showConfirmation({title:"Send to Chat",message:"Append notebook content to discussion context:",inputType:"select",inputOptions:Object.values(p.discussions).map(a=>({text:a.title,value:a.id})),confirmText:"Send"});s&&e&&(await p.appendToDataZone({discussionId:e,content:i.value.content}),o.addNotification("Content sent to chat.","success"))}async function O(s){h.value=!1;const e=Array.from(s.dataTransfer.files);!i.value||e.length===0||(o.addNotification(`Uploading ${e.length} source(s)...`,"info"),await Promise.all(e.map(a=>n.uploadSource(a))))}function z(){C.value.click()}async function K(s){const e=Array.from(s.target.files);!i.value||e.length===0||(o.addNotification(`Uploading ${e.length} source(s)...`,"info"),await Promise.all(e.map(a=>n.uploadSource(a))),s.target.value="")}async function q(){if(!i.value)return;const{confirmed:s,value:e}=await o.showConfirmation({title:"Scrape URL",message:"Enter URL to scrape content from:",inputType:"text",inputPlaceholder:"https://example.com",confirmText:"Scrape"});s&&e&&await n.scrapeUrl(e)}async function H(){i.value&&(await n.selectNotebook(i.value.id),o.addNotification("Notebook refreshed.","success"))}async function J(){if(!i.value)return;const{confirmed:s,value:e}=await o.showConfirmation({title:"Convert to Source",message:"Enter a title for the new source artefact:",inputType:"text",inputPlaceholder:"My Notebook Notes",confirmText:"Convert"});s&&e&&await n.createTextArtefact(e,i.value.content)}return ee(S,s=>{i.value&&s.find(a=>a.status==="completed"&&a.result&&a.result.notebook_id===i.value.id)&&n.selectNotebook(i.value.id)},{deep:!0}),te(n.fetchNotebooks),(s,e)=>(u(),T(he,{title:"Notebook Studio","title-icon":we},{sidebar:V(()=>[t("div",Ne,[t("button",{onClick:r,class:"btn btn-primary w-full flex items-center justify-center gap-2 py-3"},[f(ye,{class:"w-5 h-5"}),e[11]||(e[11]=_(" New Notebook "))]),t("div",Se,[(u(!0),b(B,null,P(d(w),a=>{var $;return u(),b("div",{key:a.id,onClick:Z=>d(n).selectNotebook(a.id),class:I(["p-3 rounded-xl cursor-pointer flex justify-between items-center group transition-all",(($=d(i))==null?void 0:$.id)===a.id?"bg-blue-600 text-white":"hover:bg-gray-100 dark:hover:bg-gray-800 text-gray-700 dark:text-gray-300"])},[t("span",$e,A(a.title),1),t("button",{onClick:U(Z=>l(a.id),["stop"]),class:"opacity-0 group-hover:opacity-100 p-1 hover:text-red-400"},[f(me,{class:"w-4 h-4"})],8,Te)],10,Ce)}),128))])])]),main:V(()=>[d(i)?(u(),b("div",{key:0,class:"h-full flex flex-col bg-white dark:bg-gray-900 relative",onDragover:e[9]||(e[9]=U(a=>h.value=!0,["prevent"])),onDragleave:e[10]||(e[10]=a=>h.value=!1),onDrop:U(O,["prevent"])},[h.value?(u(),b("div",Ie,e[12]||(e[12]=[t("p",{class:"text-2xl font-black text-blue-600 uppercase"},"Drop Research Sources Here",-1)]))):D("",!0),t("div",Ae,[t("div",Ue,[j(t("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>d(i).title=a),onBlur:e[1]||(e[1]=(...a)=>d(n).saveActive&&d(n).saveActive(...a)),class:"text-lg font-black bg-transparent border-none focus:ring-0 w-full"},null,544),[[F,d(i).title]])]),t("div",De,[t("div",Re,[t("button",{onClick:e[2]||(e[2]=a=>y.value=!0),class:I(["p-1.5 rounded transition-colors",y.value?"bg-white dark:bg-gray-600 shadow-sm text-blue-600":"text-gray-500"]),title:"View"},[f(ae,{class:"w-4 h-4"})],2),t("button",{onClick:e[3]||(e[3]=a=>y.value=!1),class:I(["p-1.5 rounded transition-colors",y.value?"text-gray-500":"bg-white dark:bg-gray-600 shadow-sm text-blue-600"]),title:"Edit"},[f(oe,{class:"w-4 h-4"})],2)]),e[16]||(e[16]=t("div",{class:"h-6 w-px bg-gray-300 dark:bg-gray-700 mx-1"},null,-1)),t("button",{onClick:H,class:"btn btn-secondary btn-sm",title:"Refresh"},[f(se,{class:"w-4 h-4"})]),t("button",{onClick:J,class:"btn btn-secondary btn-sm gap-2",title:"Save content as a new source"},[f(xe,{class:"w-4 h-4"}),e[13]||(e[13]=_(" Src "))]),t("button",{onClick:E,class:"btn btn-secondary btn-sm gap-2"},[f(ne,{class:"w-4 h-4"}),e[14]||(e[14]=_(" Chat"))]),t("button",{onClick:e[4]||(e[4]=(...a)=>d(n).saveActive&&d(n).saveActive(...a)),class:"btn btn-primary btn-sm gap-2"},[f(ie,{class:"w-4 h-4"}),e[15]||(e[15]=_(" Save"))])])]),t("div",Ve,[t("div",je,[x.value?(u(),b("div",Fe,[t("span",Be,A(x.value.description),1),t("div",Pe,[t("div",{class:"h-full bg-blue-600 transition-all duration-300",style:re({width:x.value.progress+"%"})},null,4)])])):D("",!0),t("div",Le,[y.value?(u(),b("div",Me,[f(le,{content:d(i).content,class:"prose dark:prose-invert max-w-none"},null,8,["content"])])):(u(),T(ce,{key:1,modelValue:d(i).content,"onUpdate:modelValue":e[5]||(e[5]=a=>d(i).content=a),onBlur:d(n).saveActive,class:"h-full"},null,8,["modelValue","onBlur"]))]),t("div",We,[t("div",Ee,[j(t("input",{"onUpdate:modelValue":e[6]||(e[6]=a=>g.value=a),placeholder:"Instruct AI to process this notebook...",class:"input-field flex-grow shadow-inner",onKeyup:e[7]||(e[7]=de(a=>{d(n).processWithAi(g.value),g.value=""},["enter"]))},null,544),[[F,g.value]]),t("button",{onClick:e[8]||(e[8]=a=>{d(n).processWithAi(g.value),g.value=""}),disabled:!!x.value,class:"btn btn-primary gap-2 min-w-[120px]"},[f(ue,{class:"w-5 h-5"}),e[17]||(e[17]=_("Process"))],8,Oe)])])]),t("div",ze,[t("div",Ke,[e[18]||(e[18]=t("span",{class:"font-black text-[10px] uppercase text-gray-500 tracking-widest"},"Research Sources",-1)),t("div",qe,[t("button",{onClick:z,class:"p-1 hover:bg-gray-200 dark:hover:bg-gray-700 rounded text-gray-500",title:"Upload File"},[f(fe,{class:"w-4 h-4"})]),t("input",{type:"file",ref_key:"fileInput",ref:C,onChange:K,multiple:"",class:"hidden"},null,544),t("button",{onClick:q,class:"p-1 hover:bg-gray-200 dark:hover:bg-gray-700 rounded text-gray-500",title:"Scrape URL"},[f(pe,{class:"w-4 h-4"})])])]),t("div",He,[(u(!0),b(B,null,P(d(i).artefacts,a=>(u(),b("div",{key:a.filename,class:"p-3 bg-white dark:bg-gray-800 rounded-lg border dark:border-gray-700 shadow-sm group"},[t("div",Je,[t("div",Ze,[f(ve,{class:"w-4 h-4 text-blue-400 shrink-0"}),t("span",{class:"text-xs truncate font-bold",title:a.filename},A(a.filename),9,Ge)]),t("button",{onClick:$=>W(a.filename),class:"text-gray-400 hover:text-red-500 opacity-0 group-hover:opacity-100"},[f(be,{class:"w-4 h-4"})],8,Qe)]),t("button",{onClick:$=>c(a),class:I(["w-full flex items-center justify-between text-[10px] font-bold uppercase tracking-tighter px-2 py-1 rounded transition-colors",a.is_loaded?"bg-blue-50 text-blue-600":"bg-gray-100 text-gray-400"])},[t("span",null,A(a.is_loaded?"Loaded":"Deactivated"),1),a.is_loaded?(u(),T(ge,{key:0,class:"w-3 h-3"})):(u(),T(ke,{key:1,class:"w-3 h-3"}))],10,Xe)]))),128)),d(i).artefacts.length===0?(u(),b("div",Ye," Drop files here or use buttons above to add sources. ")):D("",!0)])])])],32)):(u(),b("div",et,"Select or create a notebook to begin."))]),_:1}))}},nt=Q(tt,[["__scopeId","data-v-6ecd8f1d"]]);export{nt as default};
