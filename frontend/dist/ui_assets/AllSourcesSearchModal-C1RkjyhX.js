import{X as T,c as p,K as x,w as B,$ as L,n as V,l as m,g as S,e as l,j as A,O as N,d as f,h as D,Y as q,t as b,f as I,ag as C,F,i as H}from"./index-CZNMIptP.js";import{_ as U}from"./GenericModal-DlcvRk3V.js";/* empty css                                                                 */const j={class:"p-4 space-y-4"},K={class:"relative"},O={key:0,class:"absolute inset-y-0 right-0 flex items-center pr-3 text-sm"},W=["disabled"],X=["disabled"],Y={class:"max-h-[60vh] overflow-y-auto space-y-4 pr-2 all-sources-search-container"},z={class:"font-semibold text-lg mb-2"},G=["id","innerHTML"],ee={__name:"AllSourcesSearchModal",setup(J){const k=T(),M=p(()=>k.modalData("allSourcesSearch")),n=p(()=>{var t;return((t=M.value)==null?void 0:t.sources)||[]}),r=x(""),g=x([]),o=x(-1),s=p(()=>g.value.length);B(r,t=>{if(!t){g.value=[],o.value=-1;return}const e=new RegExp(t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"gi"),a=[];let c=0;n.value.forEach((u,i)=>{if(u.content){let v;for(;(v=e.exec(u.content))!==null;)a.push({sourceIndex:i,sourceTitle:u.title,matchIndex:c++,matchIndexInContent:v.index})}}),g.value=a,a.length>0?(o.value=0,L(()=>y(0))):o.value=-1});function E(t){if(!t)return"";if(!r.value)return t;const e=new RegExp(`(${r.value.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")})`,"gi");return t.replace(e,'<mark class="bg-yellow-300 dark:bg-yellow-600 rounded">$1</mark>')}function y(t){const e=g.value[t];if(!e)return;const a=document.getElementById(`all-sources-content-${e.sourceIndex}`);if(a){const c=a.querySelectorAll("mark");let u=0;for(let d=0;d<e.sourceIndex;d++)if(n.value[d].content){const h=new RegExp(r.value.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"gi");u+=(n.value[d].content.match(h)||[]).length}(n.value[e.sourceIndex].content.match(new RegExp(r.value.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"gi"))||[]).length;let i=-1;const v=new RegExp(r.value.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"gi");let _=0,$;for(;($=v.exec(n.value[e.sourceIndex].content))!==null;){if($.index===e.matchIndexInContent){i=_;break}_++}if(i>-1){document.querySelectorAll(".all-sources-search-container mark").forEach(R=>R.classList.remove("current-search-highlight"));const h=c[i];h&&(h.classList.add("current-search-highlight"),h.scrollIntoView({behavior:"smooth",block:"center"}))}}}function w(t){if(s.value===0)return;let e=o.value+t;e<0&&(e=s.value-1),e>=s.value&&(e=0),o.value=e,y(e)}return(t,e)=>(m(),V(U,{modalName:"allSourcesSearch",title:"Search All Sources",maxWidthClass:"max-w-5xl"},{body:S(()=>[l("div",j,[l("div",K,[N(l("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=a=>r.value=a),placeholder:"Search in all source contents...",class:"input-field w-full pr-32",autofocus:""},null,512),[[q,r.value]]),r.value?(m(),f("div",O,[l("span",null,b(s.value>0?o.value+1:0)+" / "+b(s.value),1),l("button",{onClick:e[1]||(e[1]=a=>w(-1)),class:"ml-2 p-1 rounded hover:bg-gray-200 dark:hover:bg-gray-600",disabled:s.value===0},[I(C,{class:"w-4 h-4 transform rotate-180"})],8,W),l("button",{onClick:e[2]||(e[2]=a=>w(1)),class:"p-1 rounded hover:bg-gray-200 dark:hover:bg-gray-600",disabled:s.value===0},[I(C,{class:"w-4 h-4"})],8,X)])):D("",!0)]),l("div",Y,[(m(!0),f(F,null,H(n.value,(a,c)=>(m(),f("div",{key:c,class:"p-4 border rounded-lg dark:border-gray-700"},[l("h3",z,b(a.title),1),l("div",{id:`all-sources-content-${c}`,class:"whitespace-pre-wrap break-words text-sm bg-gray-50 dark:bg-gray-800/50 p-2 rounded-md",innerHTML:E(a.content)},null,8,G)]))),128))])])]),footer:S(()=>[l("button",{onClick:e[3]||(e[3]=a=>A(k).closeModal("allSourcesSearch")),type:"button",class:"btn btn-secondary"},"Close")]),_:1}))}};export{ee as default};
