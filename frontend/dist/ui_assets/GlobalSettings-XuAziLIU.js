import{u as C,r as p,h as V,x as M,l as x,d as n,o as i,a as o,b as U,F as S,A as w,t as y,e as F,f as m,y as G,C as L,n as O,v as A,z as D,i as B}from"./index-CGf9GErn.js";import{useAdminStore as R}from"./admin-DaSz6GoL.js";import{_ as $}from"./JsonRenderer-CmkbKNvs.js";/* empty css                                                                 */const I={class:"bg-white dark:bg-gray-800 shadow-md rounded-lg"},P={class:"space-y-10"},T={class:"text-lg font-medium text-gray-800 dark:text-gray-200 border-b border-gray-200 dark:border-gray-600 pb-2 mb-6"},z={class:"space-y-8"},q={key:0},H=["for"],K=["id","onUpdate:modelValue"],Q={key:1},W=["for"],X=["type","step","id","onUpdate:modelValue"],Y={key:2},Z={class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},ee={class:"mt-2"},te=["onClick"],oe={key:3},ae={class:"flex justify-between items-center mb-1"},se=["for"],re=["onClick"],le={key:0},ne=["id","onUpdate:modelValue"],ie={key:1,class:"mt-2 p-4 rounded-md bg-gray-50 dark:bg-gray-900/50 border border-gray-200 dark:border-gray-700"},de={class:"mt-8 pt-5 border-t border-gray-200 dark:border-gray-700"},ce={class:"flex justify-end"},ue=["disabled"],ye={key:1,class:"p-6 text-center"},fe={key:2,class:"p-6 text-center"},_e={__name:"GlobalSettings",setup(pe){const d=R(),N=C(),s=p({}),f=p(!1),v=p(!1);let _="{}";const c=p({}),b=V(()=>{const a=d.globalSettings.filter(t=>t.category!=="Email Settings"&&t.category!=="Server"&&t.category!=="Registration"&&t.category!=="Defaults"&&t.key!=="password_recovery_mode"),u=["Authentication","Global LLM Overrides"],l=a.reduce((t,h)=>{const k=h.category||"General";return t[k]||(t[k]=[]),t[k].push(h),t},{}),e={};return u.forEach(t=>{l[t]&&(e[t]=l[t])}),Object.keys(l).forEach(t=>{u.includes(t)||(e[t]=l[t])}),e});M(()=>{d.globalSettings.length===0?d.fetchGlobalSettings():g()}),x(()=>d.globalSettings,g,{deep:!0}),x(s,r=>{v.value=JSON.stringify(r)!==_},{deep:!0});function g(){const r={};d.globalSettings.length>0&&(d.globalSettings.forEach(a=>{if(a.type==="json"){try{r[a.key]=JSON.stringify(a.value,null,2)}catch{r[a.key]=a.value}c.value[a.key]=!1}else r[a.key]=a.value}),s.value=r,_=JSON.parse(JSON.stringify(r)),v.value=!1)}function j(r){try{return JSON.parse(s.value[r])}catch(a){return{error:"Invalid JSON format in text editor",details:a.message}}}function J(r){c.value[r]=!c.value[r]}async function E(){f.value=!0;const r=Object.values(b.value).flat(),a={};let u=!1;for(const l of r){const e=l.key;if(s.value.hasOwnProperty(e))if(l.type==="json")try{a[e]=JSON.parse(s.value[e])}catch{N.addNotification(`Invalid JSON format for '${l.description}'. Please fix it before saving.`,"error"),u=!0}else a[e]=s.value[e]}if(u){f.value=!1;return}try{await d.updateGlobalSettings(a),Object.keys(c.value).forEach(l=>c.value[l]=!1)}catch{}finally{f.value=!1}}return(r,a)=>(i(),n("div",I,[a[3]||(a[3]=o("div",{class:"p-6 border-b border-gray-200 dark:border-gray-700"},[o("h3",{class:"text-xl font-semibold leading-6 text-gray-900 dark:text-white"}," Application Settings "),o("p",{class:"mt-1 text-sm text-gray-500 dark:text-gray-400"}," Manage miscellaneous application-wide settings. ")],-1)),Object.keys(b.value).length?(i(),n("form",{key:0,onSubmit:U(E,["prevent"]),class:"p-6"},[o("div",P,[(i(!0),n(S,null,w(b.value,(u,l)=>(i(),n("div",{key:l},[o("h4",T,y(l),1),o("div",z,[(i(!0),n(S,null,w(u,e=>(i(),n("div",{key:e.key},[e.key.includes("force_")&&e.key.includes("_mode")?(i(),n("div",q,[o("label",{for:e.key,class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},y(e.description),9,H),m(o("select",{id:e.key,"onUpdate:modelValue":t=>s.value[e.key]=t,class:"input-field mt-1"},a[0]||(a[0]=[o("option",{value:"disabled"},"Disabled",-1),o("option",{value:"force_once"},"Force Once (set user preference)",-1),o("option",{value:"force_always"},"Force Always (override session)",-1)]),8,K),[[G,s.value[e.key]]])])):["string","integer","float"].includes(e.type)?(i(),n("div",Q,[o("label",{for:e.key,class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},y(e.description),9,W),m(o("input",{type:e.type==="string"?"text":"number",step:e.type==="float"?"0.1":"1",id:e.key,"onUpdate:modelValue":t=>s.value[e.key]=t,class:"input-field mt-1"},null,8,X),[[L,s.value[e.key]]])])):e.type==="boolean"?(i(),n("div",Y,[o("label",Z,y(e.description),1),o("div",ee,[o("button",{onClick:t=>s.value[e.key]=!s.value[e.key],type:"button",class:O([s.value[e.key]?"bg-blue-600":"bg-gray-200 dark:bg-gray-600","relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800"])},[o("span",{class:O([s.value[e.key]?"translate-x-5":"translate-x-0","pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out"])},null,2)],10,te)])])):e.type==="json"?(i(),n("div",oe,[o("div",ae,[o("label",{for:e.key,class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},y(e.description),9,se),o("button",{onClick:t=>J(e.key),type:"button",class:"btn btn-secondary btn-xs"},y(c.value[e.key]?"View Rendered":"Edit Raw"),9,re)]),c.value[e.key]?(i(),n("div",le,[m(o("textarea",{id:e.key,"onUpdate:modelValue":t=>s.value[e.key]=t,rows:"8",class:"input-field w-full font-mono text-xs !leading-relaxed",placeholder:"Enter valid JSON here..."},null,8,ne),[[A,s.value[e.key]]])])):(i(),n("div",ie,[D($,{json:j(e.key)},null,8,["json"])]))])):F("",!0)]))),128))])]))),128))]),o("div",de,[o("div",ce,[o("button",{type:"submit",class:"btn btn-primary",disabled:f.value||!v.value},y(f.value?"Saving...":"Save Settings"),9,ue)])])],32)):B(d).isLoadingSettings?(i(),n("div",ye,a[1]||(a[1]=[o("p",{class:"text-gray-500"},"Loading settings...",-1)]))):(i(),n("div",fe,a[2]||(a[2]=[o("p",{class:"text-gray-500"},"No application settings available.",-1)])))]))}};export{_e as default};
