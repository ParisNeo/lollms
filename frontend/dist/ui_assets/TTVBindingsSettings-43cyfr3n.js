const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["ui_assets/BindingModelsManager-DmfZp1EE.js","ui_assets/index-CZ57W16T.js","ui_assets/index-HfzKwilw.css","ui_assets/admin-oSQkGxSZ.js","ui_assets/BindingZoo-Dyd7FjW3.js"])))=>i.map(i=>d[i]);
import{u as le,R as ie,T as q,L as v,c as D,m as R,l as re,e as i,o as l,b as t,g as f,t as u,n as m,a0 as j,h as x,ac as de,ar as H,F as S,r as V,d as h,cx as ue,a3 as ce,a as F,aJ as ve,aK as me,aD as ge,K as I,f as $,cy as fe,ab as be,s as J,H as K}from"./index-CZ57W16T.js";import{u as ye}from"./admin-oSQkGxSZ.js";import{I as pe}from"./IconVideoCamera-wqxu-7mN.js";const _e={class:"space-y-8"},xe={key:0,class:"bg-white dark:bg-gray-800 shadow-md rounded-lg p-6"},he={class:"flex justify-between items-center mb-4"},ke={class:"text-xl font-semibold"},we={key:0,class:"flex gap-2 text-sm font-medium overflow-x-auto"},Te={key:0},Ce={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},Be=["disabled"],Ae=["value"],Se={key:0,class:"space-y-6 border-t dark:border-gray-700 pt-6"},Ve=["innerHTML"],$e=["for"],Ne={key:0,class:"text-red-500"},De=["id","onUpdate:modelValue"],je=["value"],Ee={key:1},Me={class:"relative"},Fe=["type","id","onUpdate:modelValue","required","placeholder"],Ie=["onClick","title"],Le={key:2,class:"flex items-center justify-between bg-gray-50 dark:bg-gray-700/50 p-3 rounded-md"},Pe={class:"flex-grow flex flex-col pr-4"},ze={class:"text-sm text-gray-500 dark:text-gray-400"},Oe=["onClick"],Ue={class:"text-xs text-gray-500 mt-1"},qe={class:"flex items-center justify-between bg-gray-50 dark:bg-gray-700/50 p-3 rounded-md"},Re={class:"flex justify-end gap-3"},He=["disabled"],Je={key:1,class:"space-y-6"},Ke={key:0},Ge={class:"flex justify-between items-start mb-3"},Ze={class:"font-bold text-md flex items-center gap-2"},Qe={class:"text-sm text-gray-600 dark:text-gray-400 mt-1"},We=["onClick","disabled"],Xe={key:1,class:"text-center text-gray-500 py-8 border-2 border-dashed border-gray-200 dark:border-gray-700 rounded-lg"},Ye={key:2},et={key:3},tt={key:1},nt={class:"flex justify-between items-center mb-4 flex-wrap gap-4"},st={class:"flex items-center gap-4"},at={key:0,class:"text-center p-6"},ot={key:1,class:"text-center p-6 bg-gray-50 dark:bg-gray-800/50 rounded-lg"},lt={key:2,class:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6"},it=["onClick"],rt=["onClick"],dt={class:"flex-grow"},ut={class:"flex items-center gap-3 mb-2"},ct={class:"font-bold text-lg text-gray-900 dark:text-white"},vt={class:"text-xs text-gray-500 dark:text-gray-400"},mt={class:"mt-3 text-sm text-gray-600 dark:text-gray-300"},gt={key:0,class:"mb-1"},ft={class:"text-xs text-gray-400 truncate"},bt={class:"border-t dark:border-gray-700 pt-3 flex justify-between items-center text-xs text-gray-500"},yt=["onClick"],wt={__name:"TTVBindingsSettings",setup(pt){const G=J(()=>K(()=>import("./BindingModelsManager-DmfZp1EE.js"),__vite__mapDeps([0,1,2,3]))),Z=J(()=>K(()=>import("./BindingZoo-Dyd7FjW3.js"),__vite__mapDeps([4,1,2,3]))),b=ye(),w=le(),L=ie(),{ttvBindings:P,availableTtvBindingTypes:y,isLoadingTtvBindings:Q}=q(b),{tasks:W}=q(L),T=v(!1),p=v(null),C=v(!1),_=v({}),N=v({}),r=v("settings"),B=v(null),z=v(null),E=v(null),M=D(()=>B.value?W.value.find(s=>s.id===B.value):null);R(M,s=>{s&&s.status==="completed"&&(E.value=s.result)},{deep:!0});const O=()=>({id:null,alias:"",name:"",config:{},default_model_name:"",is_active:!0}),a=v(O()),k=D(()=>p.value!==null),g=D(()=>!a.value.name||!Array.isArray(y.value)?null:y.value.find(s=>(s.binding_name||s.name)===a.value.name)),X=D(()=>{if(!g.value)return[];const s=g.value.input_parameters||[],n=new Set(s.map(d=>d.name)),e=g.value.model_parameters||[],o=new Set(e.map(d=>d.name)),c=Object.keys(a.value.config||{}).filter(d=>!n.has(d)&&!o.has(d)&&d!=="model_name"&&d!=="model"&&d!=="class").map(d=>({name:d,type:typeof a.value.config[d]=="boolean"?"bool":typeof a.value.config[d]=="number"?"float":"str",description:"(Parameter not in binding description)",mandatory:!1}));return[...s.filter(d=>!o.has(d.name)&&d.name!=="model_name"),...c]});R(()=>a.value.name,(s,n)=>{if(s!==n&&!k.value){if(!Array.isArray(y.value))return;const e=y.value.find(c=>(c.binding_name||c.name)===s),o={};e&&e.input_parameters&&e.input_parameters.forEach(c=>{o[c.name]=c.default}),a.value.config=o}}),re(()=>{b.fetchTtvBindings(),b.fetchAvailableTtvBindingTypes()});function U(){p.value=null,a.value=O(),_.value={},N.value={},T.value=!0,r.value="settings",window.scrollTo({top:0,behavior:"smooth"})}function Y(s){p.value=s,a.value=JSON.parse(JSON.stringify(s)),a.value.config||(a.value.config={}),_.value={};const n=y.value.find(e=>(e.binding_name||e.name)===s.name);if(n&&n.commands){const e={};n.commands.forEach(o=>{e[o.name]={},o.parameters&&o.parameters.forEach(c=>{e[o.name][c.name]=c.default!==void 0?c.default:""})}),N.value=e}else N.value={};B.value=null,E.value=null,z.value=null,T.value=!0,r.value="settings",window.scrollTo({top:0,behavior:"smooth"})}function A(){T.value=!1,p.value=null}function ee(s){return typeof s=="string"?s.split(",").map(n=>n.trim()).filter(n=>n):Array.isArray(s)?s.filter(n=>n):[]}async function te(){if(!a.value.alias.trim()||!a.value.name){w.addNotification("Alias and Binding Type are required fields.","warning");return}C.value=!0;try{const s={alias:a.value.alias,name:a.value.name,config:a.value.config||{},is_active:a.value.is_active,default_model_name:a.value.default_model_name||null};k.value?await b.updateTtvBinding(p.value.id,s):await b.addTtvBinding(s),A()}catch(s){console.error("Submit failed:",s.message)}finally{C.value=!1}}async function ne(s){await w.showConfirmation({title:`Delete TTV Binding '${s.alias}'?`,message:"Are you sure?",confirmText:"Delete"})&&await b.deleteTtvBinding(s.id)}async function se(s){await b.updateTtvBinding(s.id,{is_active:!s.is_active})}function ae(s){if(!Array.isArray(y.value))return s;const n=y.value.find(e=>(e.binding_name||e.name)===s);return n?n.title||n.name:s}async function oe(s,n,e){B.value=null,E.value=null,z.value=s.name;try{w.addNotification(`Submitting command '${s.title||s.name}'...`,"info");const o=await b.executeTtvBindingCommand(n,s.name,e);o&&o.id&&(B.value=o.id,L.addTask(o),w.addNotification(`Task started: ${s.title||s.name}`,"success"))}catch(o){console.error(o),w.addNotification(`Command submission failed: ${o.message}`,"error")}}return(s,n)=>(l(),i("div",_e,[T.value?(l(),i("div",xe,[t("div",he,[t("h3",ke,u(k.value?"Edit TTV Binding: "+a.value.alias:"Add New TTV Binding"),1),k.value?(l(),i("div",we,[t("button",{onClick:n[0]||(n[0]=e=>r.value="settings"),class:m([{"text-blue-600 border-b-2 border-blue-600":r.value==="settings","text-gray-500 hover:text-gray-700":r.value!=="settings"},"px-3 py-2 whitespace-nowrap"])},"Settings",2),t("button",{onClick:n[1]||(n[1]=e=>r.value="commands"),class:m([{"text-blue-600 border-b-2 border-blue-600":r.value==="commands","text-gray-500 hover:text-gray-700":r.value!=="commands"},"px-3 py-2 whitespace-nowrap"])},"Commands",2),t("button",{onClick:n[2]||(n[2]=e=>r.value="zoo"),class:m([{"text-blue-600 border-b-2 border-blue-600":r.value==="zoo","text-gray-500 hover:text-gray-700":r.value!=="zoo"},"px-3 py-2 whitespace-nowrap"])},"Models Zoo",2),t("button",{onClick:n[3]||(n[3]=e=>r.value="models"),class:m([{"text-blue-600 border-b-2 border-blue-600":r.value==="models","text-gray-500 hover:text-gray-700":r.value!=="models"},"px-3 py-2 whitespace-nowrap"])},"Installed Models",2)])):f("",!0)]),r.value==="settings"?(l(),i("div",Te,[t("form",{onSubmit:I(te,["prevent"]),class:"space-y-6"},[t("div",Ce,[t("div",null,[n[8]||(n[8]=t("label",{for:"alias",class:"block text-sm font-medium"},[x("Alias "),t("span",{class:"text-red-500"},"*")],-1)),j(t("input",{type:"text",id:"alias","onUpdate:modelValue":n[4]||(n[4]=e=>a.value.alias=e),class:"input-field mt-1",required:"",placeholder:"e.g., local_video",autocomplete:"off"},null,512),[[de,a.value.alias]])]),t("div",null,[n[10]||(n[10]=t("label",{for:"name",class:"block text-sm font-medium"},[x("Binding Type "),t("span",{class:"text-red-500"},"*")],-1)),j(t("select",{id:"name","onUpdate:modelValue":n[5]||(n[5]=e=>a.value.name=e),class:"input-field mt-1",required:"",disabled:k.value},[n[9]||(n[9]=t("option",{disabled:"",value:""},"Select a type",-1)),(l(!0),i(S,null,V(h(y),e=>(l(),i("option",{key:e.binding_name||e.name,value:e.binding_name||e.name},u(e.title||e.name),9,Ae))),128))],8,Be),[[H,a.value.name]])])]),g.value?(l(),i("div",Se,[t("div",{class:"text-sm text-gray-600 dark:text-gray-400 prose dark:prose-invert max-w-none",innerHTML:h(ue)(g.value.description||"")},null,8,Ve),(l(!0),i(S,null,V(X.value,e=>(l(),i("div",{key:e.name,class:"space-y-1"},[t("label",{for:`param-${e.name}`,class:"block text-sm font-medium capitalize"},[x(u(e.name.replace(/_/g," "))+" ",1),e.mandatory?(l(),i("span",Ne,"*")):f("",!0)],8,$e),e.options&&e.options.length>0?j((l(),i("select",{key:0,id:`param-${e.name}`,"onUpdate:modelValue":o=>a.value.config[e.name]=o,class:"input-field"},[(l(!0),i(S,null,V(ee(e.options),o=>(l(),i("option",{key:o,value:o},u(o),9,je))),128))],8,De)),[[H,a.value.config[e.name]]]):["str","int","float"].includes(e.type)?(l(),i("div",Ee,[t("div",Me,[j(t("input",{type:(e.name.includes("key")||e.name.includes("token"))&&!_.value[e.name]?"password":"text",id:`param-${e.name}`,"onUpdate:modelValue":o=>a.value.config[e.name]=o,class:"input-field",required:e.mandatory,placeholder:e.description,autocomplete:"off"},null,8,Fe),[[ce,a.value.config[e.name]]]),e.name.includes("key")||e.name.includes("token")?(l(),i("button",{key:0,type:"button",onClick:o=>_.value[e.name]=!_.value[e.name],class:"absolute inset-y-0 right-0 px-3 flex items-center text-gray-500 hover:text-gray-700",title:_.value[e.name]?"Hide":"Show"},[_.value[e.name]?(l(),F(ve,{key:0,class:"w-5 h-5"})):(l(),F(me,{key:1,class:"w-5 h-5"}))],8,Ie)):f("",!0)])])):e.type==="bool"?(l(),i("div",Le,[t("span",Pe,[t("span",ze,u(e.description),1)]),t("button",{onClick:o=>a.value.config[e.name]=!a.value.config[e.name],type:"button",class:m([a.value.config[e.name]?"bg-blue-600":"bg-gray-200 dark:bg-gray-600","relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out"])},[t("span",{class:m([a.value.config[e.name]?"translate-x-5":"translate-x-0","pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition-colors duration-200 ease-in-out"])},null,2)],10,Oe)])):f("",!0),t("p",Ue,u(e.description),1)]))),128))])):f("",!0),t("div",qe,[n[11]||(n[11]=t("span",{class:"flex-grow flex flex-col"},[t("span",{class:"text-sm font-medium text-gray-900 dark:text-gray-100"},"Active"),t("span",{class:"text-sm text-gray-500 dark:text-gray-400"},"If disabled, this TTV service will not be available.")],-1)),t("button",{onClick:n[6]||(n[6]=e=>a.value.is_active=!a.value.is_active),type:"button",class:m([a.value.is_active?"bg-blue-600":"bg-gray-200 dark:bg-gray-600","relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out"])},[t("span",{class:m([a.value.is_active?"translate-x-5":"translate-x-0","pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition-colors duration-200 ease-in-out"])},null,2)],2)]),t("div",Re,[t("button",{type:"button",onClick:A,class:"btn btn-secondary"},"Cancel"),t("button",{type:"submit",class:"btn btn-primary",disabled:C.value},[C.value?(l(),F(ge,{key:0,class:"w-5 h-5 mr-2"})):f("",!0),x(" "+u(C.value?"Saving...":k.value?"Save Changes":"Add Binding"),1)],8,He)])],32)])):r.value==="commands"?(l(),i("div",Je,[g.value&&g.value.commands&&g.value.commands.length>0?(l(),i("div",Ke,[(l(!0),i(S,null,V(g.value.commands,e=>(l(),i("div",{key:e.name,class:"p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg border dark:border-gray-600 mb-4"},[t("div",Ge,[t("div",null,[t("h5",Ze,[$(fe,{class:"w-4 h-4 text-gray-500"}),x(u(e.title||e.name),1)]),t("p",Qe,u(e.description),1)]),t("button",{type:"button",onClick:o=>oe(e,p.value.id,N.value[e.name]),class:"btn btn-primary btn-sm flex items-center gap-2",disabled:M.value&&M.value.status==="running"},[$(be,{class:"w-4 h-4"}),n[12]||(n[12]=x("Execute"))],8,We)])]))),128))])):(l(),i("div",Xe,"No commands available.")),t("div",{class:"flex justify-end gap-3 mt-4"},[t("button",{type:"button",onClick:A,class:"btn btn-secondary"},"Close")])])):r.value==="zoo"?(l(),i("div",Ye,[$(h(Z),{binding:p.value,"binding-type":"ttv"},null,8,["binding"]),t("div",{class:"flex justify-end gap-3 mt-4"},[t("button",{type:"button",onClick:A,class:"btn btn-secondary"},"Close")])])):r.value==="models"?(l(),i("div",et,[$(h(G),{binding:p.value,"binding-type":"ttv"},null,8,["binding"]),t("div",{class:"flex justify-end gap-3 mt-4"},[t("button",{type:"button",onClick:A,class:"btn btn-secondary"},"Close")])])):f("",!0)])):(l(),i("div",tt,[t("div",nt,[n[13]||(n[13]=t("h2",{class:"text-2xl font-bold"},"Text-to-Video Bindings",-1)),t("div",st,[T.value?f("",!0):(l(),i("button",{key:0,onClick:U,class:"btn btn-primary self-end"},"+ Add New TTV Binding"))])]),h(Q)?(l(),i("div",at,"Loading TTV bindings...")):h(P).length===0?(l(),i("div",ot,[n[14]||(n[14]=t("p",null,"No TTV bindings configured yet.",-1)),t("button",{onClick:U,class:"mt-2 text-blue-600 hover:underline"},"Add your first one")])):(l(),i("div",lt,[(l(!0),i(S,null,V(h(P),e=>(l(),i("div",{key:e.id,onClick:o=>Y(e),class:"bg-white dark:bg-gray-800 p-5 rounded-lg shadow-md hover:shadow-lg transition-shadow cursor-pointer flex flex-col gap-4 border border-transparent hover:border-blue-500 group relative"},[t("div",{class:"absolute top-4 right-4 z-10",onClick:n[7]||(n[7]=I(()=>{},["stop"]))},[t("button",{onClick:o=>se(e),type:"button",class:m([e.is_active?"bg-blue-600":"bg-gray-200 dark:bg-gray-600","relative inline-flex h-5 w-9 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out"])},[t("span",{class:m([e.is_active?"translate-x-4":"translate-x-0","pointer-events-none inline-block h-4 w-4 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out"])},null,2)],10,rt)]),t("div",dt,[t("div",ut,[$(pe,{class:"w-8 h-8 text-blue-500"}),t("div",null,[t("h4",ct,u(e.alias),1),t("p",vt,u(ae(e.name)),1)])]),t("div",mt,[e.default_model_name?(l(),i("p",gt,[n[15]||(n[15]=t("span",{class:"font-semibold"},"Default:",-1)),x(" "+u(e.default_model_name),1)])):f("",!0),t("p",ft,u(e.config?Object.keys(e.config).filter(o=>!o.includes("key")).join(", "):""),1)])]),t("div",bt,[n[16]||(n[16]=t("span",null,"Click to edit",-1)),t("button",{onClick:I(o=>ne(e),["stop"]),class:"text-red-500 hover:underline p-1"},"Delete",8,yt)])],8,it))),128))]))]))]))}};export{wt as default};
