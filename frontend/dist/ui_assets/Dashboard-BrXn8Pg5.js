import{u as L}from"./admin-etPRT619.js";import{ag as T,c$ as R,d0 as V,d1 as I,d2 as P,dh as E,d3 as J,d4 as F,d5 as O,d6 as Q,d7 as K,di as X,J as B,q as A,c as k,d as i,l as n,e,p as $,f as p,m as S,V as j,n as U,B as Y,Q as z,o as W,j as b,g as N,t as _,F as ee,i as te,U as ae,ao as H,h as M,dj as se,$ as ne,s as D}from"./index-4tYqOs8q.js";import{L as oe,B as q}from"./chartjs-adapter-date-fns.esm-vhNG_ekM.js";import{_ as le}from"./GenericModal-CtZwNhiR.js";const re={class:"space-y-6"},ie={class:"bg-white dark:bg-gray-800 rounded-lg shadow p-5"},de={class:"flex justify-between items-center mb-4 flex-wrap gap-2"},ce={class:"inline-flex rounded-md shadow-sm",role:"group"},ue={class:"flex items-center gap-2"},ge={class:"h-96"},pe={key:0,class:"flex items-center justify-center h-full"},ve={key:1,class:"flex items-center justify-center h-full"},me={key:2,class:"h-full"},be={__name:"GlobalStatsChart",props:{stats:{type:Object,default:null},isLoading:{type:Boolean,default:!1}},setup(x){R.register(V,I,P,E,J,F,O,Q,K,X);const s=x,o=B(),a=A("daily"),d=A(null),c=k(()=>a.value==="daily"||a.value==="weekly_stats"?oe:q),y=k(()=>({responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:a.value==="daily"||a.value==="weekly_stats"},title:{display:!0,text:l.value,color:o.currentTheme==="dark"?"#e5e7eb":"#1f2937"}},scales:{x:{type:a.value==="daily"?"time":"category",time:{unit:"day",tooltipFormat:"MMM d, yyyy"},grid:{color:o.currentTheme==="dark"?"rgba(255, 255, 255, 0.1)":"rgba(0, 0, 0, 0.1)"},ticks:{color:o.currentTheme==="dark"?"#cbd5e1":"#4b5563"}},y:{beginAtZero:!0,grid:{color:o.currentTheme==="dark"?"rgba(255, 255, 255, 0.1)":"rgba(0, 0, 0, 0.1)"},ticks:{color:o.currentTheme==="dark"?"#cbd5e1":"#4b5563"}}}})),l=k(()=>{switch(a.value){case"mean":return"Average Daily Generations by Weekday";case"variance":return"Generation Variance by Weekday";case"weekly_stats":return"Weekly Generation Statistics (Mean Â± Std Dev)";case"daily":default:return"Total AI Generations (Last 30 Days)"}}),u=k(()=>{if(!s.stats)return{labels:[],datasets:[]};const r=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"];if(a.value==="daily")return{labels:s.stats.generations_per_day.map(t=>t.date),datasets:[{label:"Generations",data:s.stats.generations_per_day.map(t=>t.count),borderColor:"#3b82f6",backgroundColor:"rgba(59, 130, 246, 0.2)",tension:.1,fill:!0}]};if(a.value==="mean")return{labels:r,datasets:[{label:"Mean Generations",data:r.map(t=>s.stats.mean_per_weekday[t]),backgroundColor:"#10b981"}]};if(a.value==="variance")return{labels:r,datasets:[{label:"Variance",data:r.map(t=>s.stats.variance_per_weekday[t]),backgroundColor:"#f59e0b"}]};if(a.value==="weekly_stats"){const t=r.map(g=>s.stats.mean_per_weekday[g]),h=r.map(g=>Math.sqrt(s.stats.variance_per_weekday[g])),w=t.map((g,C)=>g+h[C]),f=t.map((g,C)=>Math.max(0,g-h[C]));return{labels:r,datasets:[{label:"Mean",data:t,borderColor:"#3b82f6",backgroundColor:"rgba(59, 130, 246, 0.5)",tension:.1,pointRadius:4,pointBackgroundColor:"#3b82f6"},{label:"Std. Deviation Range",data:w,borderColor:"transparent",backgroundColor:"rgba(59, 130, 246, 0.15)",pointRadius:0,fill:"+1"},{label:"Lower Bound",data:f,borderColor:"transparent",backgroundColor:"transparent",pointRadius:0,showInLegend:!1}]}}return{labels:[],datasets:[]}});function v(){if(d.value&&d.value.chart){const r=document.createElement("a");r.href=d.value.chart.toBase64Image("image/png",1),r.download=`lollms_global_stats_${a.value}.png`,r.click()}else o.addNotification("Could not export chart image.","error")}function m(){if(!s.stats){o.addNotification("No data to export.","warning");return}let r="data:text/csv;charset=utf-8,",t=[];if(a.value==="daily")t.push(["date","generation_count"]),s.stats.generations_per_day.forEach(f=>{t.push([f.date,f.count])});else if(a.value==="weekly_stats")t.push(["weekday","mean","variance","std_deviation"]),["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"].forEach(g=>{const C=s.stats.mean_per_weekday[g],G=s.stats.variance_per_weekday[g],Z=Math.sqrt(G);t.push([g,C,G,Z])});else{t.push(["weekday",a.value]);const f=a.value==="mean"?s.stats.mean_per_weekday:s.stats.variance_per_weekday;Object.entries(f).forEach(([g,C])=>{t.push([g,C])})}r+=t.map(f=>f.join(",")).join(`
`);const h=encodeURI(r),w=document.createElement("a");w.setAttribute("href",h),w.setAttribute("download",`lollms_global_stats_${a.value}.csv`),document.body.appendChild(w),w.click(),document.body.removeChild(w)}return(r,t)=>(n(),i("div",re,[t[8]||(t[8]=e("h3",{class:"text-xl font-semibold leading-6 text-gray-900 dark:text-white"}," Global Usage Statistics ",-1)),e("div",ie,[e("div",de,[e("div",ce,[e("button",{onClick:t[0]||(t[0]=h=>a.value="daily"),type:"button",class:$(["btn-group",{active:a.value==="daily"}])},"Daily",2),e("button",{onClick:t[1]||(t[1]=h=>a.value="weekly_stats"),type:"button",class:$(["btn-group",{active:a.value==="weekly_stats"}])},"Weekly Stats",2),e("button",{onClick:t[2]||(t[2]=h=>a.value="mean"),type:"button",class:$(["btn-group",{active:a.value==="mean"}])},"Mean",2),e("button",{onClick:t[3]||(t[3]=h=>a.value="variance"),type:"button",class:$(["btn-group",{active:a.value==="variance"}])},"Variance",2)]),e("div",ue,[e("button",{onClick:v,class:"btn btn-secondary btn-sm",title:"Export as PNG"},[p(j,{class:"w-4 h-4 mr-1"}),t[4]||(t[4]=S(" PNG "))]),e("button",{onClick:m,class:"btn btn-secondary btn-sm",title:"Export as CSV"},[p(j,{class:"w-4 h-4 mr-1"}),t[5]||(t[5]=S(" CSV "))])])]),e("div",ge,[x.isLoading?(n(),i("div",pe,t[6]||(t[6]=[e("p",{class:"text-gray-500"},"Loading chart data...",-1)]))):x.stats?(n(),i("div",me,[(n(),U(Y(c.value),{data:u.value,options:y.value,ref_key:"chartRef",ref:d},null,8,["data","options"]))])):(n(),i("div",ve,t[7]||(t[7]=[e("p",{class:"text-gray-500"},"Could not load statistics.",-1)])))])])]))}},ye=T(be,[["__scopeId","data-v-a10fe633"]]),_e={class:"bg-white dark:bg-gray-800 p-6 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700 h-96 flex flex-col"},fe={class:"flex-grow relative"},he={key:0,class:"absolute inset-0 flex items-center justify-center"},ke={key:1,class:"absolute inset-0 flex items-center justify-center"},xe={__name:"ModelUsageChart",setup(x){R.register(V,I,P,E,F,O);const s=L(),{modelUsageStats:o,isLoadingModelUsageStats:a}=z(s);W(()=>{s.fetchModelUsageStats()});const d=k(()=>{const y=Array.isArray(o.value)?o.value:[],l=y.map(v=>v.model_name),u=y.map(v=>v.count);return{labels:l,datasets:[{label:"Users",backgroundColor:"#3B82F6",borderRadius:4,data:u,barPercentage:.6,categoryPercentage:.8}]}}),c={indexAxis:"y",responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{mode:"index",intersect:!1}},scales:{x:{beginAtZero:!0,grid:{color:"#374151"},ticks:{stepSize:1,color:"#9CA3AF",precision:0}},y:{grid:{display:!1},ticks:{color:"#9CA3AF",autoSkip:!1,callback:function(y){const l=this.getLabelForValue(y);return l.length>35?l.substr(0,35)+"...":l}}}}};return(y,l)=>(n(),i("div",_e,[l[2]||(l[2]=e("h3",{class:"text-lg font-semibold text-gray-900 dark:text-white mb-1"}," User Default Model Preferences ",-1)),l[3]||(l[3]=e("p",{class:"text-xs text-gray-500 dark:text-gray-400 mb-4"}," Count of users currently assigned to each model. ",-1)),e("div",fe,[b(a)?(n(),i("div",he,l[0]||(l[0]=[e("p",{class:"text-gray-500"},"Loading stats...",-1)]))):!b(o)||b(o).length===0?(n(),i("div",ke,l[1]||(l[1]=[e("p",{class:"text-gray-500"},"No data available.",-1)]))):(n(),U(b(q),{key:2,data:d.value,options:c},null,8,["data"]))])]))}},we={key:0,class:"text-center p-6 text-gray-500"},Ce={key:1,class:"space-y-4"},$e={class:"flex justify-between items-center bg-blue-50 dark:bg-blue-900/20 p-3 rounded-lg"},Se={class:"text-sm font-medium text-blue-800 dark:text-blue-200"},Ae=["disabled"],Me={class:"divide-y divide-gray-200 dark:divide-gray-700 max-h-96 overflow-y-auto"},Ue={class:"flex items-center"},De={class:"ml-3"},Le={class:"text-sm font-medium text-gray-900 dark:text-white"},Te={class:"text-xs text-gray-500"},Be={class:"text-xs text-gray-400"},Ge=["onClick"],je={__name:"PendingUsersModal",setup(x){const s=B(),o=L(),a=k(()=>o.allUsers),d=k(()=>a.value.filter(u=>!u.is_active)),c=A(!1);async function y(u){try{await o.activateUser(u.id)}catch{s.addNotification("Failed to activate user","error")}}async function l(){c.value=!0;try{for(const u of d.value)await o.activateUser(u.id);s.closeModal("pendingUsers")}finally{c.value=!1}}return(u,v)=>(n(),U(le,{"modal-name":"pendingUsers",title:"Pending User Approvals"},{body:N(()=>[d.value.length===0?(n(),i("div",we," No pending users found. ")):(n(),i("div",Ce,[e("div",$e,[e("span",Se,_(d.value.length)+" users waiting.",1),e("button",{onClick:l,class:"btn btn-primary btn-sm",disabled:c.value},_(c.value?"Activating...":"Activate All"),9,Ae)]),e("ul",Me,[(n(!0),i(ee,null,te(d.value,m=>(n(),i("li",{key:m.id,class:"py-3 flex items-center justify-between"},[e("div",Ue,[p(ae,{icon:m.icon,username:m.username,"size-class":"h-10 w-10"},null,8,["icon","username"]),e("div",De,[e("p",Le,_(m.username),1),e("p",Te,_(m.email||"No email"),1),e("p",Be,"Registered: "+_(new Date(m.created_at).toLocaleDateString()),1)])]),e("button",{onClick:r=>y(m),class:"btn-icon text-green-600 hover:bg-green-50 dark:hover:bg-green-900/20",title:"Approve"},[p(H,{class:"w-6 h-6"})],8,Ge)]))),128))])]))]),footer:N(()=>[e("button",{onClick:v[0]||(v[0]=m=>b(s).closeModal("pendingUsers")),class:"btn btn-secondary"},"Close")]),_:1}))}},Ne={},Re={class:"w-5 h-5 fill-current"};function Ve(x,s){return n(),i("div",Re,s[0]||(s[0]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},[e("path",{d:"M12 17a2 2 0 1 0 0-4 2 2 0 0 0 0 4zm6-7h-1V7a5 5 0 0 0-10 0v3H6a2 2 0 0 0-2 2v7a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-7a2 2 0 0 0-2-2zm-7-3a3 3 0 0 1 6 0v3H11V7zm7 12H6v-7h12v7z"})],-1)]))}const Ie=T(Ne,[["render",Ve]]),Pe={class:"space-y-8 animate-fade-in p-2"},Ee={class:"flex flex-col md:flex-row md:items-center justify-between gap-4"},Fe={key:0,class:"flex items-center gap-4 mt-1 text-sm text-gray-500 dark:text-gray-400"},Oe={class:"flex items-center gap-1"},ze={key:0,class:"flex items-center gap-1 text-green-600 dark:text-green-400"},We={key:1,class:"flex items-center gap-1 text-yellow-600 dark:text-yellow-400"},He=["disabled"],qe={key:0,class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6"},Ze={class:"metric-card"},Je={class:"metric-value"},Qe={class:"metric-icon bg-blue-100 dark:bg-blue-900/30 text-blue-600"},Ke={class:"metric-value"},Xe={class:"metric-icon bg-orange-100 dark:bg-orange-900/30 text-orange-600"},Ye={key:0,class:"absolute top-0 right-0 -mt-1 -mr-1 flex h-3 w-3"},et={class:"metric-card"},tt={class:"metric-value"},at={class:"metric-icon bg-green-100 dark:bg-green-900/30 text-green-600"},st={class:"metric-card"},nt={class:"metric-value"},ot={class:"metric-icon bg-purple-100 dark:bg-purple-900/30 text-purple-600"},lt={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},rt={__name:"Dashboard",setup(x){const s=A(null),o=A(!0),a=B(),d=L(),{serverInfo:c,globalGenerationStats:y,isLoadingGlobalGenerationStats:l}=z(d),u=k(()=>{var r;return((r=s.value)==null?void 0:r.pending_approval)||0});async function v(){o.value=!0;try{await Promise.all([d.fetchDashboardStats(),d.fetchServerInfo(),d.fetchGlobalGenerationStats()]),s.value=d.dashboardStats}finally{o.value=!1}}function m(){a.openModal("pendingUsers")}return W(v),(r,t)=>(n(),i("div",Pe,[e("div",Ee,[e("div",null,[t[2]||(t[2]=e("h2",{class:"text-2xl font-bold text-gray-900 dark:text-white"},"System Dashboard",-1)),b(c)?(n(),i("div",Fe,[e("span",Oe,[e("span",{class:$(["w-2 h-2 rounded-full",b(c).https_enabled?"bg-green-500":"bg-yellow-500"])},null,2),S(" "+_(b(c).url),1)]),b(c).https_enabled?(n(),i("span",ze,[p(se,{class:"w-3 h-3"}),t[0]||(t[0]=S(" HTTPS Active"))])):(n(),i("span",We,[p(Ie,{class:"w-3 h-3"}),t[1]||(t[1]=S(" HTTP Only"))]))])):M("",!0)]),e("button",{onClick:v,class:"btn btn-secondary btn-sm",disabled:o.value},[p(ne,{class:$(["w-4 h-4 mr-2",{"animate-spin":o.value}])},null,8,["class"]),t[3]||(t[3]=S(" Refresh "))],8,He)]),s.value?(n(),i("div",qe,[e("div",Ze,[e("div",null,[t[4]||(t[4]=e("p",{class:"metric-label"},"Total Users",-1)),e("p",Je,_(s.value.total_users),1)]),e("div",Qe,[p(D,{class:"w-6 h-6"})])]),e("div",{class:"metric-card cursor-pointer hover:ring-2 ring-orange-400 transition-all",onClick:m,title:"Click to manage pending users"},[e("div",null,[t[5]||(t[5]=e("p",{class:"metric-label"},"Pending Approval",-1)),e("p",Ke,_(u.value),1)]),e("div",Xe,[p(D,{class:"w-6 h-6"}),u.value>0?(n(),i("span",Ye,t[6]||(t[6]=[e("span",{class:"animate-ping absolute inline-flex h-full w-full rounded-full bg-orange-400 opacity-75"},null,-1),e("span",{class:"relative inline-flex rounded-full h-3 w-3 bg-orange-500"},null,-1)]))):M("",!0)])]),e("div",et,[e("div",null,[t[7]||(t[7]=e("p",{class:"metric-label"},"Active (24h)",-1)),e("p",tt,_(s.value.active_users_24h),1)]),e("div",at,[p(H,{class:"w-6 h-6"})])]),e("div",st,[e("div",null,[t[8]||(t[8]=e("p",{class:"metric-label"},"New (7d)",-1)),e("p",nt,_(s.value.new_users_7d),1)]),e("div",ot,[p(D,{class:"w-6 h-6"})])])])):M("",!0),e("div",lt,[p(ye,{stats:b(y),"is-loading":b(l)},null,8,["stats","is-loading"]),p(xe)]),b(a).activeModal==="pendingUsers"?(n(),U(je,{key:1})):M("",!0)]))}},gt=T(rt,[["__scopeId","data-v-983e643e"]]);export{gt as default};
