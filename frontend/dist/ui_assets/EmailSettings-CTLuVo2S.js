import{N as y,c as k,l as S,m as c,e as r,o as d,b as t,K as M,W as l,ap as h,cp as f,g as p,h as u,ak as i,ar as P,t as _,d as T}from"./index-7rLr_kL9.js";import{u as V}from"./admin-Bo8e158b.js";const U={class:"bg-white dark:bg-gray-800 shadow-md rounded-lg"},A={class:"space-y-8"},E={class:"mt-4"},G={key:0,class:"p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg"},L={key:1,class:"p-4 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800/50 rounded-lg"},N={key:2,class:"space-y-6 pt-4"},C={class:"grid grid-cols-1 gap-y-6 sm:grid-cols-2 sm:gap-x-6"},F={class:"sm:col-span-2"},O={class:"sm:col-span-2"},B={key:3,class:"space-y-6 pt-4"},I={class:"grid grid-cols-1 gap-y-6 sm:grid-cols-2 sm:gap-x-6"},W={class:"sm:col-span-2"},j={class:"sm:col-span-2"},q={class:"sm:col-span-2"},D={class:"relative flex items-start"},J={class:"flex h-6 items-center"},R={class:"mt-8 pt-5 border-t border-gray-200 dark:border-gray-700"},H={class:"flex justify-end"},K=["disabled"],Y={key:1,class:"p-6 text-center"},z={class:"text-gray-500"},$={__name:"EmailSettings",setup(Q){const n=V(),s=y({}),m=y(!1),g=y(!1);let v="{}";const x=k(()=>n.globalSettings.filter(o=>o.category==="Email Settings"||o.key==="password_recovery_mode"));S(()=>{n.globalSettings.length===0?n.fetchGlobalSettings():b()}),c(()=>n.globalSettings,b,{deep:!0}),c(s,o=>{g.value=JSON.stringify(o)!==v},{deep:!0});function b(){const o={};x.value.length>0&&(x.value.forEach(e=>{o[e.key]=e.value}),s.value=o,v=JSON.stringify(s.value),g.value=!1)}async function w(){m.value=!0;try{const o={...s.value};(o.smtp_password===null||o.smtp_password==="")&&delete o.smtp_password,await n.updateGlobalSettings(o),o.smtp_password&&(s.value.smtp_password="")}catch{}finally{m.value=!1}}return(o,e)=>(d(),r("div",U,[e[23]||(e[23]=t("div",{class:"p-6 border-b border-gray-200 dark:border-gray-700"},[t("h3",{class:"text-xl font-semibold leading-6 text-gray-900 dark:text-white"}," Email & Password Recovery "),t("p",{class:"mt-1 text-sm text-gray-500 dark:text-gray-400"}," Configure the method for sending system emails and managing password recovery. ")],-1)),Object.keys(s.value).length?(d(),r("form",{key:0,onSubmit:M(w,["prevent"]),class:"p-6"},[t("div",A,[t("div",null,[e[10]||(e[10]=t("label",{for:"password_recovery_mode",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Email Sending Method",-1)),l(t("select",{id:"password_recovery_mode","onUpdate:modelValue":e[0]||(e[0]=a=>s.value.password_recovery_mode=a),class:"input-field mt-1"},e[9]||(e[9]=[f('<option value="manual">Manual (Admin Managed)</option><option value="gmail">Gmail</option><option value="automatic">SMTP Server</option><option value="system_mail">System Mail Command</option><option value="outlook">Outlook (Windows only)</option>',5)]),512),[[h,s.value.password_recovery_mode]])]),t("div",E,[s.value.password_recovery_mode==="manual"?(d(),r("div",G,e[11]||(e[11]=[t("p",{class:"text-sm text-gray-600 dark:text-gray-300"},[u(" In "),t("span",{class:"font-semibold"},"Manual Mode"),u(", the system will not send any emails. When a user requests a password reset, a notification will be sent to administrators in the UI. Admins must then manually generate a reset link and send it to the user. ")],-1)]))):p("",!0),s.value.password_recovery_mode==="system_mail"?(d(),r("div",L,e[12]||(e[12]=[t("p",{class:"text-sm text-yellow-800 dark:text-yellow-200"},[t("span",{class:"font-semibold"},"System Mail Mode"),u(" uses the server's built-in `mail` command (e.g., from `mailutils`). This is a simpler alternative to SMTP but requires the command to be installed and properly configured on the server's operating system. ")],-1)]))):p("",!0),s.value.password_recovery_mode==="gmail"?(d(),r("div",N,[e[15]||(e[15]=f('<div class="p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800/50 rounded-lg"><p class="text-sm text-red-800 dark:text-red-200"><span class="font-semibold">Gmail Mode</span> uses Gmail&#39;s SMTP servers automatically. </p><p class="text-xs text-red-700 dark:text-red-300 mt-2"><strong>Important:</strong> You must use an <strong>App Password</strong> if 2-Step Verification is enabled on your Google Account. Regular passwords often do not work. <a href="https://support.google.com/accounts/answer/185833" target="_blank" class="underline hover:text-red-900 dark:hover:text-red-100">Learn how to create an App Password</a>. </p></div>',1)),t("div",C,[t("div",F,[e[13]||(e[13]=t("label",{for:"gmail_user",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Gmail Address",-1)),l(t("input",{type:"email",id:"gmail_user","onUpdate:modelValue":e[1]||(e[1]=a=>s.value.smtp_user=a),class:"input-field mt-1",placeholder:"your.name@gmail.com",autocomplete:"email"},null,512),[[i,s.value.smtp_user]])]),t("div",O,[e[14]||(e[14]=t("label",{for:"gmail_password",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"App Password",-1)),l(t("input",{type:"password",id:"gmail_password","onUpdate:modelValue":e[2]||(e[2]=a=>s.value.smtp_password=a),class:"input-field mt-1",placeholder:"xxxx xxxx xxxx xxxx",autocomplete:"new-password"},null,512),[[i,s.value.smtp_password]])])])])):p("",!0),s.value.password_recovery_mode==="automatic"?(d(),r("div",B,[e[22]||(e[22]=t("div",{class:"p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800/50 rounded-lg"},[t("p",{class:"text-sm text-blue-800 dark:text-blue-200"},[t("span",{class:"font-semibold"},"SMTP Mode"),u(" provides the most reliable way to send emails. Fill in your SMTP provider's details below. ")])],-1)),t("div",I,[t("div",null,[e[16]||(e[16]=t("label",{for:"smtp_host",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"SMTP Host",-1)),l(t("input",{type:"text",id:"smtp_host","onUpdate:modelValue":e[3]||(e[3]=a=>s.value.smtp_host=a),class:"input-field mt-1"},null,512),[[i,s.value.smtp_host]])]),t("div",null,[e[17]||(e[17]=t("label",{for:"smtp_port",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"SMTP Port",-1)),l(t("input",{type:"number",id:"smtp_port","onUpdate:modelValue":e[4]||(e[4]=a=>s.value.smtp_port=a),class:"input-field mt-1"},null,512),[[i,s.value.smtp_port]])]),t("div",W,[e[18]||(e[18]=t("label",{for:"smtp_from_email",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"From Email Address",-1)),l(t("input",{type:"email",id:"smtp_from_email","onUpdate:modelValue":e[5]||(e[5]=a=>s.value.smtp_from_email=a),class:"input-field mt-1"},null,512),[[i,s.value.smtp_from_email]])]),t("div",j,[e[19]||(e[19]=t("label",{for:"smtp_user",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"SMTP Username",-1)),l(t("input",{type:"text",id:"smtp_user","onUpdate:modelValue":e[6]||(e[6]=a=>s.value.smtp_user=a),class:"input-field mt-1",autocomplete:"off"},null,512),[[i,s.value.smtp_user]])]),t("div",q,[e[20]||(e[20]=t("label",{for:"smtp_password",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"SMTP Password",-1)),l(t("input",{type:"password",id:"smtp_password","onUpdate:modelValue":e[7]||(e[7]=a=>s.value.smtp_password=a),class:"input-field mt-1",placeholder:"Leave blank to keep existing password",autocomplete:"new-password"},null,512),[[i,s.value.smtp_password]])]),t("div",D,[t("div",J,[l(t("input",{id:"smtp_use_tls","onUpdate:modelValue":e[8]||(e[8]=a=>s.value.smtp_use_tls=a),type:"checkbox",class:"h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-600"},null,512),[[P,s.value.smtp_use_tls]])]),e[21]||(e[21]=t("div",{class:"ml-3 text-sm leading-6"},[t("label",{for:"smtp_use_tls",class:"font-medium text-gray-900 dark:text-gray-100"},"Use TLS"),t("p",{class:"text-gray-500 dark:text-gray-400"},"Enable TLS encryption for the connection.")],-1))])])])):p("",!0)])]),t("div",R,[t("div",H,[t("button",{type:"submit",class:"btn btn-primary",disabled:m.value||!g.value},_(m.value?"Saving...":"Save Settings"),9,K)])])],32)):(d(),r("div",Y,[t("p",z,_(T(n).isLoadingSettings?"Loading settings...":"Could not load email settings."),1)]))]))}};export{$ as default};
