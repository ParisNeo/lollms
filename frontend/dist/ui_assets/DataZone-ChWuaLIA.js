import{s as P,a as W,a8 as te,y as U,r as k,c as y,q as se,w as X,g as b,d,f as e,h as H,A as o,a2 as ae,J as oe,U as K,a3 as V,t as Z,_ as O,j as B,n as q,D as G,H as re,i as E,v as ne,b as $,k as le,ab as Q,db as Y,W as ie,af as de,l as N,F as ce,B as ue,p as C,a4 as ve,K as ge,o as fe,dc as J,a5 as be,au as j,O as pe}from"./index-GJY6etPD.js";import{I as ye,a as he}from"./IconRedo-BxA1vHRl.js";import{useMemoriesStore as me}from"./memories--Mo6DYaf.js";import{I as xe}from"./IconMaximize-C1EvP3T_.js";import{I as _e}from"./IconMinimize-BM7wJisy.js";const ke={class:"flex flex-col h-full overflow-hidden"},we={class:"flex-shrink-0 flex items-center justify-between gap-2 p-1.5 bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-t-lg"},$e={class:"flex items-center gap-0.5"},Ce=["disabled"],De=["disabled"],Me=["disabled"],Ie=["disabled"],Te=["disabled"],Se={key:0,class:"flex items-center gap-2 pr-2"},ze={class:"text-[10px] font-bold text-blue-500"},Ze={__name:"DiscussionZone",setup(D){const c=P(),f=W(),p=te(),{activeDiscussion:s}=U(c),{tasks:i}=U(p),h=k(null),u=k(!1),t=k([]),l=k(-1);let m=null,w=null;const x=y({get:()=>{var a;return((a=s.value)==null?void 0:a.discussion_data_zone)||""},set:a=>{s.value&&(c.setDiscussionDataZoneContent(s.value.id,a),clearTimeout(w),w=setTimeout(()=>{s.value&&se.put(`/api/discussions/${s.value.id}/data_zone`,{content:a}).then(()=>{c.fetchContextStatus(s.value.id)})},1500))}}),_=y(()=>{if(!s.value)return!1;const a=c.activeAiTasks[s.value.id];if(!a||!a.taskId)return!1;const n=i.value.find(z=>z.id===a.taskId);return n?n.status==="running"||n.status==="pending":!1}),R=y(()=>{if(!s.value)return null;const a=c.activeAiTasks[s.value.id];return!a||!a.taskId?null:i.value.find(n=>n.id===a.taskId)}),M=y(()=>l.value>0),I=y(()=>l.value<t.value.length-1);function L(a){clearTimeout(m),m=setTimeout(()=>{t.value[l.value]!==a&&(l.value<t.value.length-1&&t.value.splice(l.value+1),t.value.push(a),l.value++)},750)}async function r(){M.value&&(u.value=!0,l.value--,x.value=t.value[l.value],await q(),u.value=!1)}async function v(){I.value&&(u.value=!0,l.value++,x.value=t.value[l.value],await q(),u.value=!1)}X(x,(a,n)=>{!u.value&&a!==n&&L(a)},{flush:"post"}),X(s,(a,n)=>{a&&(!n||a.id!==n.id)&&(t.value=[a.discussion_data_zone||""],l.value=0)},{immediate:!0});function T(a){h.value=a.view}function g(){s.value&&c.cloneDiscussion(s.value.id)}function S(){s.value&&c.refreshDataZones(s.value.id)}async function ee(a){const n=Array.from(a.dataTransfer.files);n.length>0&&s.value&&(f.addNotification(`Extracting text from ${n.length} file(s)...`,"info"),await c.uploadAndEmbedFilesToDataZone(s.value.id,n,!1))}return(a,n)=>{var z;return d(),b("div",ke,[e("div",we,[e("div",$e,[e("button",{onClick:r,class:"p-1.5 rounded hover:bg-gray-100 dark:hover:bg-gray-800 disabled:opacity-30",title:"Undo",disabled:!M.value||_.value},[o(ye,{class:"w-4 h-4"})],8,Ce),e("button",{onClick:v,class:"p-1.5 rounded hover:bg-gray-100 dark:hover:bg-gray-800 disabled:opacity-30",title:"Redo",disabled:!I.value||_.value},[o(he,{class:"w-4 h-4"})],8,De),n[3]||(n[3]=e("div",{class:"w-px h-4 bg-gray-200 dark:bg-gray-700 mx-1"},null,-1)),e("button",{onClick:g,class:"p-1.5 rounded hover:bg-gray-100 dark:hover:bg-gray-800 disabled:opacity-30",title:"Clone Data Zone",disabled:_.value},[o(ae,{class:"w-4 h-4"})],8,Me),e("button",{onClick:S,class:"p-1.5 rounded hover:bg-gray-100 dark:hover:bg-gray-800 disabled:opacity-30",title:"Refresh",disabled:_.value},[o(oe,{class:"w-4 h-4"})],8,Ie),e("button",{onClick:n[0]||(n[0]=F=>x.value=""),class:"p-1.5 rounded hover:bg-red-50 dark:hover:bg-red-900/20 text-red-500 disabled:opacity-30",title:"Clear Context",disabled:_.value},[o(K,{class:"w-4 h-4"})],8,Te)]),_.value?(d(),b("div",Se,[o(V,{class:"w-3.5 h-3.5 text-blue-500 animate-spin"}),e("span",ze,Z((z=R.value)==null?void 0:z.progress)+"%",1)])):H("",!0)]),e("div",{onDragover:n[2]||(n[2]=B(()=>{},["prevent"])),onDrop:B(ee,["prevent"]),class:"flex-1 min-h-0 border-x border-b border-gray-200 dark:border-gray-700 rounded-b-lg overflow-hidden relative"},[o(O,{ref:"discussionCodeMirrorEditor",modelValue:x.value,"onUpdate:modelValue":n[1]||(n[1]=F=>x.value=F),class:"h-full","read-only":_.value,renderable:!0,onReady:T},null,8,["modelValue","read-only"])],32)])}}},Ee={class:"h-full flex flex-col border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden"},Re={__name:"PersonalityZone",setup(D){const c=P(),f=y(()=>c.activeDiscussion),p=y(()=>{var s;return((s=f.value)==null?void 0:s.personality_data_zone)||""});return(s,i)=>(d(),b("div",Ee,[o(O,{modelValue:p.value,"onUpdate:modelValue":i[0]||(i[0]=h=>p.value=h),class:"h-full","read-only":!0},null,8,["modelValue"])]))}},Le={class:"flex flex-col h-full gap-3 overflow-hidden"},je={class:"flex items-center justify-between bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 p-2 rounded-lg shadow-sm"},Ae=["disabled"],Ue={class:"flex-1 flex flex-col gap-3 min-h-0"},Ve={class:"flex-1 flex flex-col min-h-[150px] border border-gray-200 dark:border-gray-700 rounded-lg bg-white dark:bg-gray-900/50 shadow-inner overflow-hidden"},Be={class:"p-2 border-b dark:border-gray-700 flex items-center justify-between bg-gray-50 dark:bg-gray-800/30"},Ne={key:0,class:"text-[9px] font-mono text-gray-500"},Pe={class:"flex-1 overflow-y-auto custom-scrollbar p-3"},We={key:0,class:"h-full flex flex-col items-center justify-center text-gray-400 opacity-40"},He={class:"h-64 border border-gray-200 dark:border-gray-700 rounded-lg bg-white dark:bg-gray-900 flex flex-col shadow-sm overflow-hidden"},Fe={class:"p-2 border-b dark:border-gray-700 flex justify-between items-center bg-gray-50/50 dark:bg-gray-800/30"},Xe={class:"text-[10px] font-black uppercase text-gray-500"},qe={class:"flex-1 overflow-y-auto custom-scrollbar p-1"},Je={key:0,class:"text-center py-6"},Ke={key:1,class:"space-y-1"},Oe={class:"flex items-center gap-3 min-w-0"},Ge=["onClick"],Qe={class:"text-xs font-bold truncate text-gray-700 dark:text-gray-200"},Ye={class:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity"},et=["onClick"],tt=["onClick"],st={__name:"MemoryZone",setup(D){const c=P(),f=me(),p=W(),{memories:s,isLoading:i}=U(f),h=k(""),u=k(new Set),t=y(()=>c.activeDiscussion),l=y(()=>{var r;return t.value&&((r=c.activeAiTasks[t.value.id])==null?void 0:r.type)==="memorize"}),m=y(()=>s.value.filter(r=>u.value.has(r.title)).map(r=>`--- Memory: ${r.title} ---
${r.content}
--- End Memory: ${r.title} ---`).join(`

`)),w=y(()=>{if(!h.value)return s.value;const r=h.value.toLowerCase();return s.value.filter(v=>v.title.toLowerCase().includes(r)||v.content.toLowerCase().includes(r))});function x(){t.value&&c.memorizeLTM(t.value.id)}function _(){p.openModal("memoryEditor")}function R(r){p.openModal("memoryEditor",{memory:r})}async function M(r){const v=s.value.find(g=>g.id===r);if(!v)return;await p.showConfirmation({title:"Delete Memory?",message:`Permanently delete "${v.title}"?`,confirmText:"Delete"})&&await f.deleteMemory(r)}function I(r){u.value.add(r)}function L(r){u.value.delete(r)}return(r,v)=>{const T=re("IconCircle");return d(),b("div",Le,[e("div",je,[E(e("input",{type:"text","onUpdate:modelValue":v[0]||(v[0]=g=>h.value=g),placeholder:"Filter bank...",class:"w-32 px-2 py-1 text-xs bg-gray-50 dark:bg-gray-900 border-none focus:ring-1 focus:ring-blue-500 rounded"},null,512),[[ne,h.value]]),e("button",{onClick:x,class:"btn btn-primary btn-xs py-1 px-3 shadow-sm",disabled:l.value},[l.value?(d(),$(V,{key:0,class:"w-3.5 h-3.5 mr-1 animate-spin"})):(d(),$(Q,{key:1,class:"w-3.5 h-3.5 mr-1"})),v[1]||(v[1]=le(" Memorize Chat "))],8,Ae)]),e("div",Ue,[e("div",Ve,[e("div",Be,[v[2]||(v[2]=e("span",{class:"text-[9px] font-black uppercase text-gray-400 tracking-tighter"},"Active Context Preview",-1)),m.value?(d(),b("span",Ne,Z(m.value.length)+" chars",1)):H("",!0)]),e("div",Pe,[m.value?(d(),$(ie,{key:1,content:m.value,class:"prose-xs"},null,8,["content"])):(d(),b("div",We,[o(Y,{class:"w-10 h-10 mb-2"}),v[3]||(v[3]=e("p",{class:"text-[10px] uppercase font-black tracking-widest"},"No Active Memories",-1))]))])]),e("div",He,[e("div",Fe,[e("span",Xe,"Memory Bank ("+Z(w.value.length)+")",1),e("button",{onClick:_,class:"p-1 rounded hover:bg-gray-200 dark:hover:bg-gray-700 text-blue-500",title:"Manual Memory Entry"},[o(de,{class:"w-4 h-4"})])]),e("div",qe,[N(i)?(d(),b("div",Je,[o(V,{class:"w-6 h-6 text-gray-300 animate-spin mx-auto"})])):(d(),b("div",Ke,[(d(!0),b(ce,null,ue(w.value,g=>(d(),b("div",{key:g.id,class:C(["group p-2 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800/50 flex items-center justify-between transition-all border border-transparent",{"border-green-500/20 bg-green-50/10 dark:bg-green-900/5":u.value.has(g.title)}])},[e("div",Oe,[e("button",{onClick:S=>u.value.has(g.title)?L(g.title):I(g.title),class:C(["flex-shrink-0 transition-colors",u.value.has(g.title)?"text-green-500":"text-gray-300 hover:text-gray-400"])},[u.value.has(g.title)?(d(),$(ve,{key:0,class:"w-5 h-5"})):(d(),$(T,{key:1,class:"w-5 h-5"}))],10,Ge),e("span",Qe,Z(g.title),1)]),e("div",Ye,[e("button",{onClick:S=>R(g),class:"p-1.5 rounded hover:bg-white dark:hover:bg-gray-700 shadow-sm text-blue-500",title:"Edit"},[o(ge,{class:"w-3.5 h-3.5"})],8,et),e("button",{onClick:S=>M(g.id),class:"p-1.5 rounded hover:bg-red-50 dark:hover:bg-red-900/30 shadow-sm text-red-500",title:"Delete"},[o(K,{class:"w-3.5 h-3.5"})],8,tt)])],2))),128))]))])])])])}}},at=G(st,[["__scopeId","data-v-dd2433c1"]]),A={__name:"IconChevronDown",props:{class:{type:String,default:"w-6 h-6"}},setup(D){return(c,f)=>(d(),b("svg",{xmlns:"http://www.w3.org/2000/svg",class:C(D.class),viewBox:"0 0 20 20",fill:"currentColor"},f[0]||(f[0]=[e("path",{"fill-rule":"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z","clip-rule":"evenodd"},null,-1)]),2))}},ot={class:"flex-1 flex flex-col min-w-0 overflow-hidden"},rt={class:"flex-shrink-0 bg-gray-50 dark:bg-gray-800/80 backdrop-blur-sm border-b border-gray-200 dark:border-gray-700 flex justify-between items-center p-2 h-12"},nt={class:"flex items-center gap-2 px-2"},lt={class:"flex items-center gap-1"},it=["title"],dt={class:"flex-1 overflow-y-auto custom-scrollbar flex flex-col bg-gray-50/30 dark:bg-gray-900/30"},ct={class:"flex flex-col border-b border-gray-200 dark:border-gray-800 transition-all"},ut={class:"flex items-center gap-3"},vt={class:"p-1.5 rounded-md bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400"},gt={class:"h-96 p-2 pt-0"},ft={class:"flex flex-col border-b border-gray-200 dark:border-gray-800 transition-all"},bt={class:"flex items-center gap-3"},pt={class:"p-1.5 rounded-md bg-purple-100 dark:bg-purple-900/30 text-purple-600 dark:text-purple-400"},yt={class:"h-64 p-2 pt-0"},ht={class:"flex flex-col flex-1 min-h-0"},mt={class:"flex items-center gap-3"},xt={class:"p-1.5 rounded-md bg-green-100 dark:bg-green-900/30 text-green-600 dark:text-green-400"},_t={class:"flex-1 p-2 pt-0 min-h-[300px]"},kt={__name:"DataZone",setup(D){const c=W(),f=k(450),p=k(!1),s=y(()=>c.isDataZoneExpanded),i=k({discussion:!1,personality:!0,memory:!0});function h(u){p.value=!0;const t=u.clientX,l=f.value,m=x=>{p.value&&(f.value=Math.max(320,l-(x.clientX-t)))},w=()=>{p.value=!1,window.removeEventListener("mousemove",m),window.removeEventListener("mouseup",w),localStorage.setItem("lollms_dataZoneWidth",f.value)};window.addEventListener("mousemove",m),window.addEventListener("mouseup",w)}return fe(()=>{const u=localStorage.getItem("lollms_dataZoneWidth");u&&(f.value=parseInt(u,10))}),(u,t)=>(d(),b("div",{class:C(["relative h-full flex flex-shrink-0 border-l border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900 z-10 shadow-2xl",[s.value?"absolute inset-0 w-full":""]]),style:pe(s.value?{}:{width:`${f.value}px`})},[s.value?H("",!0):(d(),b("div",{key:0,onMousedown:B(h,["prevent"]),class:"absolute top-0 bottom-0 -left-1 w-2 cursor-col-resize z-20 hover:bg-blue-500/30 transition-colors"},null,32)),e("div",ot,[e("div",rt,[e("div",nt,[o(J,{class:"w-4 h-4 text-gray-400"}),t[5]||(t[5]=e("h3",{class:"text-[10px] font-black text-gray-500 dark:text-gray-400 uppercase tracking-widest"},"Context Explorer",-1))]),e("div",lt,[e("button",{onClick:t[0]||(t[0]=l=>N(c).toggleDataZoneExpansion()),class:"p-1.5 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-500 transition-colors",title:s.value?"Shrink":"Expand"},[s.value?(d(),$(_e,{key:0,class:"w-4 h-4"})):(d(),$(xe,{key:1,class:"w-4 h-4"}))],8,it),e("button",{onClick:t[1]||(t[1]=l=>N(c).toggleDataZone()),class:"p-1.5 rounded-lg hover:bg-red-500 hover:text-white text-gray-500 transition-colors",title:"Close Sidebar"},[o(be,{class:"w-4 h-4"})])])]),e("div",dt,[e("div",ct,[e("button",{onClick:t[2]||(t[2]=l=>i.value.discussion=!i.value.discussion),class:"flex-shrink-0 w-full flex items-center justify-between p-4 hover:bg-gray-100 dark:hover:bg-gray-800/50 transition-colors group"},[e("div",ut,[e("div",vt,[o(J,{class:"w-4 h-4"})]),t[6]||(t[6]=e("span",{class:"text-sm font-bold text-gray-700 dark:text-gray-200"},"Discussion Zone",-1))]),o(A,{class:C(["w-4 h-4 text-gray-400 transition-transform duration-300",{"rotate-180":!i.value.discussion}])},null,8,["class"])]),E(e("div",gt,[o(Ze)],512),[[j,!i.value.discussion]])]),e("div",ft,[e("button",{onClick:t[3]||(t[3]=l=>i.value.personality=!i.value.personality),class:"flex-shrink-0 w-full flex items-center justify-between p-4 hover:bg-gray-100 dark:hover:bg-gray-800/50 transition-colors group"},[e("div",bt,[e("div",pt,[o(Q,{class:"w-4 h-4"})]),t[7]||(t[7]=e("span",{class:"text-sm font-bold text-gray-700 dark:text-gray-200"},"AI Personality",-1))]),o(A,{class:C(["w-4 h-4 text-gray-400 transition-transform duration-300",{"rotate-180":!i.value.personality}])},null,8,["class"])]),E(e("div",yt,[o(Re)],512),[[j,!i.value.personality]])]),e("div",ht,[e("button",{onClick:t[4]||(t[4]=l=>i.value.memory=!i.value.memory),class:"flex-shrink-0 w-full flex items-center justify-between p-4 hover:bg-gray-100 dark:hover:bg-gray-800/50 transition-colors group"},[e("div",mt,[e("div",xt,[o(Y,{class:"w-4 h-4"})]),t[8]||(t[8]=e("span",{class:"text-sm font-bold text-gray-700 dark:text-gray-200"},"Long-Term Memory",-1))]),o(A,{class:C(["w-4 h-4 text-gray-400 transition-transform duration-300",{"rotate-180":!i.value.memory}])},null,8,["class"])]),E(e("div",_t,[o(at)],512),[[j,!i.value.memory]])])])])],6))}},It=G(kt,[["__scopeId","data-v-0e2b8dc1"]]);export{It as default};
