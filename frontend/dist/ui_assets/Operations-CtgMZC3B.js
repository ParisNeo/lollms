import{a4 as h,e as a,o as r,b as e,u as S,L as p,W as N,f as n,h as d,X as v,aF as I,aE as A,g as l,aw as B,ar as x,aA as R,dl as U,a0 as $,an as j,N as g}from"./index-DjgpTDIL.js";const F={},M={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor"};function V(b,s){return r(),a("svg",M,s[0]||(s[0]=[e("path",{d:"M3.375 3C2.339 3 1.5 3.84 1.5 4.875v.75c0 1.036.84 1.875 1.875 1.875h17.25c1.035 0 1.875-.84 1.875-1.875v-.75C22.5 3.839 21.66 3 20.625 3H3.375z"},null,-1),e("path",{"fill-rule":"evenodd",d:"M3.087 9l.54 9.176A3 3 0 006.62 21h10.757a3 3 0 002.995-2.824L20.913 9H3.087zm6.163 3.75A.75.75 0 0110 12h4a.75.75 0 010 1.5h-4a.75.75 0 01-.75-.75z","clip-rule":"evenodd"},null,-1)]))}const D=h(F,[["render",V]]),z={},E={width:"50px",height:"50px",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function H(b,s){return r(),a("svg",E,s[0]||(s[0]=[e("path",{d:"M12 7V12L14.5 10.5M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)]))}const L=h(z,[["render",H]]),W={class:"space-y-8"},O={class:"text-lg font-bold text-gray-900 dark:text-white mb-4 flex items-center gap-2"},G={key:0,class:"flex flex-col items-center justify-center p-12 bg-gray-50 dark:bg-gray-900 rounded-xl border border-gray-200 dark:border-gray-700 text-center animate-fade-in mb-6"},q={class:"mb-6 relative"},X={key:0,class:"p-4 bg-green-100 dark:bg-green-900/30 rounded-full text-green-600"},Z={key:1,class:"p-4 bg-blue-50 dark:bg-blue-900/20 rounded-full text-blue-600 relative"},J={class:"absolute inset-0 flex items-center justify-center"},K={class:"text-2xl font-bold text-gray-900 dark:text-white mb-2"},Q={key:0},Y={key:1},ee={key:2},te={key:3},se={class:"text-gray-500 dark:text-gray-400 max-w-md"},ae={key:0},re={key:1},oe={key:2},ne={key:3},ie={key:1,class:"grid grid-cols-1 md:grid-cols-2 gap-6"},le={class:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 flex flex-col items-start gap-4"},de={class:"p-3 rounded-full bg-orange-100 dark:bg-orange-900/30 text-orange-600"},ce={class:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 flex flex-col items-start gap-4"},ue={class:"p-3 rounded-full bg-blue-100 dark:bg-blue-900/30 text-blue-600"},ge={class:"grid grid-cols-1 lg:grid-cols-2 gap-8"},pe={class:"text-lg font-bold text-gray-900 dark:text-white mb-4 flex items-center gap-2"},fe={class:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 divide-y divide-gray-200 dark:divide-gray-700"},me={class:"p-5 flex items-center justify-between"},he={class:"p-5 flex items-center justify-between"},be={class:"text-lg font-bold text-gray-900 dark:text-white mb-4 flex items-center gap-2"},ye={class:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700"},ve={class:"space-y-3"},xe=["disabled"],we={__name:"Operations",setup(b){const s=S(),f=p(!1),o=p(""),c=p(null),u=p("");async function w(){await s.showConfirmation({title:"Reboot Server?",message:"This will restart the application process. All current connections will be dropped.",confirmText:"Reboot Now",isDanger:!0})&&y("/api/admin/system/reboot","rebooting")}async function k(){await s.showConfirmation({title:"Update & Restart?",message:"This will pull the latest code from Git, reinstall dependencies, and restart the server. This may take several minutes.",confirmText:"Update Now",isDanger:!0})&&y("/api/admin/system/update","updating")}async function _(){if(await s.showConfirmation({title:"Purge Temporary Files?",message:"This will delete unused temporary uploads older than 24 hours. This is safe to run.",confirmText:"Purge"}))try{await g.post("/api/admin/purge-unused-uploads"),s.addNotification("Purge task started.","success")}catch{s.addNotification("Failed to start purge task.","error")}}async function C(){if(await s.showConfirmation({title:"Prune Task History?",message:"This will delete records of finished tasks older than the retention period (default 7 days).",confirmText:"Prune"}))try{await g.post("/api/admin/tasks/prune"),s.addNotification("Pruning task started.","success")}catch{s.addNotification("Failed to start pruning.","error")}}async function T(){if(!u.value){s.addNotification("Please set a password for the backup archive.","warning");return}try{await g.post("/api/admin/backup/create",{password:u.value}),s.addNotification("Backup task started. Check the Tasks tab for progress.","success"),u.value=""}catch{s.addNotification("Failed to start backup.","error")}}async function y(i,t){f.value=!0,o.value=t;try{await g.post(i),o.value="reconnecting",P()}catch(m){s.addNotification(`Action failed: ${m.message}`,"error"),f.value=!1,o.value=""}}function P(){c.value&&clearInterval(c.value),setTimeout(()=>{c.value=setInterval(async()=>{try{await g.get("/api/public/version",{timeout:2e3}),clearInterval(c.value),o.value="success",s.addNotification("Server is back online!","success"),setTimeout(()=>{window.location.reload()},1500)}catch{console.log("Waiting for server...")}},3e3)},5e3)}return N(()=>{c.value&&clearInterval(c.value)}),(i,t)=>(r(),a("div",W,[e("div",null,[e("h3",O,[n(v,{class:"w-5 h-5 text-blue-500"}),t[1]||(t[1]=d(" Server Control "))]),f.value?(r(),a("div",G,[e("div",q,[o.value==="success"?(r(),a("div",X,[n(I,{class:"w-16 h-16"})])):(r(),a("div",Z,[n(v,{class:"w-16 h-16 opacity-50"}),e("div",J,[n(A,{class:"w-10 h-10 animate-spin text-blue-600"})])]))]),e("h3",K,[o.value==="rebooting"?(r(),a("span",Q,"Rebooting Server...")):l("",!0),o.value==="updating"?(r(),a("span",Y,"Updating System...")):l("",!0),o.value==="reconnecting"?(r(),a("span",ee,"Waiting for Connection...")):l("",!0),o.value==="success"?(r(),a("span",te,"Server Online!")):l("",!0)]),e("p",se,[o.value==="rebooting"?(r(),a("span",ae,"The application process is restarting. This usually takes 5-10 seconds.")):l("",!0),o.value==="updating"?(r(),a("span",re,"Downloading updates and reinstalling requirements. This may take a few minutes depending on your internet connection.")):l("",!0),o.value==="reconnecting"?(r(),a("span",oe,"The server is starting up. We are pinging it automatically and will refresh the page once it responds.")):l("",!0),o.value==="success"?(r(),a("span",ne,"Redirecting you to the dashboard...")):l("",!0)])])):(r(),a("div",ie,[e("div",le,[e("div",de,[n(B,{class:"w-8 h-8"})]),t[2]||(t[2]=e("div",null,[e("h4",{class:"text-lg font-bold text-gray-900 dark:text-white"},"Reboot Server"),e("p",{class:"text-sm text-gray-500 dark:text-gray-400 mt-1"}," Restarts the python application process. Useful for applying configuration changes or clearing memory leaks. ")],-1)),e("button",{onClick:w,class:"btn btn-secondary w-full mt-auto"}," Reboot Now ")]),e("div",ce,[e("div",ue,[n(x,{class:"w-8 h-8"})]),t[3]||(t[3]=e("div",null,[e("h4",{class:"text-lg font-bold text-gray-900 dark:text-white"},"Update & Restart"),e("p",{class:"text-sm text-gray-500 dark:text-gray-400 mt-1"},[d(" Pulls latest code from Git, updates dependencies, and restarts. "),e("span",{class:"text-yellow-600 dark:text-yellow-500 font-semibold"},"Service will be unavailable during update.")])],-1)),e("button",{onClick:k,class:"btn btn-primary w-full mt-auto"}," Update System ")])]))]),e("div",ge,[e("div",null,[e("h3",pe,[n(D,{class:"w-5 h-5 text-purple-500"}),t[4]||(t[4]=d(" Maintenance "))]),e("div",fe,[e("div",me,[t[6]||(t[6]=e("div",null,[e("h4",{class:"font-medium text-gray-900 dark:text-white"},"Purge Temporary Files"),e("p",{class:"text-xs text-gray-500 mt-1"},"Deletes uploads older than 24h that are not in use.")],-1)),e("button",{onClick:_,class:"btn btn-secondary btn-sm flex items-center gap-2"},[n(R,{class:"w-4 h-4"}),t[5]||(t[5]=d(" Purge "))])]),e("div",he,[t[8]||(t[8]=e("div",null,[e("h4",{class:"font-medium text-gray-900 dark:text-white"},"Prune Task History"),e("p",{class:"text-xs text-gray-500 mt-1"},"Cleans up logs from old completed/failed background tasks.")],-1)),e("button",{onClick:C,class:"btn btn-secondary btn-sm flex items-center gap-2"},[n(L,{class:"w-4 h-4"}),t[7]||(t[7]=d(" Prune "))])])])]),e("div",null,[e("h3",be,[n(U,{class:"w-5 h-5 text-green-500"}),t[9]||(t[9]=d(" Backup & Security "))]),e("div",ye,[t[12]||(t[12]=e("h4",{class:"font-medium text-gray-900 dark:text-white mb-2"},"Create Secure Backup",-1)),t[13]||(t[13]=e("p",{class:"text-sm text-gray-500 mb-4"}," Creates an AES-256 encrypted zip archive of the `data/` folder (databases, configs, and personal files). ",-1)),e("div",ve,[e("div",null,[t[10]||(t[10]=e("label",{class:"text-xs font-medium text-gray-700 dark:text-gray-300"},"Archive Password",-1)),$(e("input",{type:"password","onUpdate:modelValue":t[0]||(t[0]=m=>u.value=m),class:"input-field w-full mt-1",placeholder:"Enter a strong password"},null,512),[[j,u.value]])]),e("button",{onClick:T,disabled:!u.value,class:"btn btn-primary w-full flex items-center justify-center gap-2"},[n(x,{class:"w-4 h-4"}),t[11]||(t[11]=d(" Create Backup "))],8,xe)])])])])]))}},_e=h(we,[["__scopeId","data-v-2013830b"]]);export{_e as default};
