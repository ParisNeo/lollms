import{a4 as R,u as E,c as w,L as f,m as q,a as S,o as s,w as L,b as t,d as z,g as v,h as J,aD as B,t as k,e as n,f as Y,K as G,a0 as r,n as b,ac as y,ar as I,a1 as T,F as j,r as O,at as H,a3 as Q,aJ as W,aK as X}from"./index-iFocv_fM.js";import{u as Z}from"./admin-CJ_SN5eB.js";import{_ as ee}from"./GenericModal-Brlmu_NN.js";const te={key:0,class:"flex justify-center items-center p-8"},ae={key:0,class:"p-4 bg-yellow-100 dark:bg-yellow-900/30 text-yellow-800 dark:text-yellow-300 rounded-lg text-sm"},le=["disabled"],se={key:0,class:"border-b border-gray-200 dark:border-gray-700"},oe={class:"-mb-px flex space-x-6"},ne={class:"space-y-4"},ie={class:"toggle-container"},ue={class:"toggle-container"},re={class:"pt-4 mt-4 border-t dark:border-gray-600"},de={key:0,class:"mt-4"},pe={key:1,class:"mt-4 space-y-4"},ve={class:"space-y-5"},ce=["for"],me={class:"mt-1 relative"},be=["onUpdate:modelValue","disabled"],ge=["onUpdate:modelValue","disabled"],fe=["value"],ye={key:2,class:"flex items-center"},_e=["id","onUpdate:modelValue","disabled"],xe=["for"],he={key:3,class:"relative"},we=["type","onUpdate:modelValue","disabled"],ke=["onClick"],Ce={key:0,class:"mt-1 text-xs text-yellow-500"},Se={class:"flex justify-end gap-3"},Ve=["disabled"],Ue={__name:"AppConfigModal",setup(Ae){const _=E(),C=Z(),F=w(()=>_.modalData("appConfig")),d=w(()=>{var o;return(o=F.value)==null?void 0:o.app}),p=f(!1),g=f(null),a=f({}),c=f({}),x=f({}),m=f("system"),V=w(()=>{var o;return((o=d.value)==null?void 0:o.status)==="running"}),h=w(()=>g.value&&g.value.properties&&Object.keys(g.value.properties).length>0),P=w(()=>h.value?Object.entries(g.value.properties).sort(([,o],[,e])=>(o.order||999)-(e.order||999)):[]);q(d,async o=>{if(o){p.value=!0,m.value="system",g.value=null,a.value={},c.value={},x.value={};try{const e=await C.fetchAppConfigSchema(o.id);if(e&&Object.keys(e.properties||{}).length>0){g.value=e;const{config:l,metadata:i}=await C.fetchAppConfig(o.id);a.value={...o,...l},a.value.authentication_type||(a.value.authentication_type="none"),c.value=i}else a.value={...o},a.value.authentication_type||(a.value.authentication_type="none")}catch(e){console.error("Failed to load app configuration:",e),_.addNotification("Could not load app configuration.","error"),_.closeModal("appConfig")}finally{p.value=!1}}},{immediate:!0,deep:!0});function K(o){x.value[o]=!x.value[o]}async function U(){if(d.value){p.value=!0;try{h.value&&await C.updateAppConfig(d.value.id,a.value);const o={name:a.value.name,description:a.value.description,port:a.value.port,autostart:a.value.autostart,allow_openai_api_access:a.value.allow_openai_api_access,authentication_type:a.value.authentication_type,authentication_key:a.value.authentication_key,sso_redirect_uri:a.value.sso_redirect_uri};await C.updateInstalledApp(d.value.id,o),_.closeModal("appConfig")}finally{p.value=!1}}}return(o,e)=>(s(),S(ee,{"modal-name":"appConfig",title:d.value?`Configure: ${d.value.name}`:"Configure App","max-width-class":h.value?"max-w-2xl":"max-w-lg"},{body:L(()=>[p.value?(s(),n("div",te,[Y(B,{class:"w-8 h-8 text-gray-500 animate-spin"}),e[11]||(e[11]=t("span",{class:"ml-3 text-gray-500"},"Loading configuration...",-1))])):d.value?(s(),n("form",{key:1,onSubmit:G(U,["prevent"]),class:"space-y-6"},[V.value?(s(),n("div",ae," This app is currently running. You must stop it before changing its configuration. ")):v("",!0),t("fieldset",{disabled:V.value,class:"space-y-6"},[h.value?(s(),n("div",se,[t("nav",oe,[t("button",{type:"button",onClick:e[0]||(e[0]=l=>m.value="system"),class:b([m.value==="system"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300","whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm"])},"System Settings",2),t("button",{type:"button",onClick:e[1]||(e[1]=l=>m.value="app"),class:b([m.value==="app"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300","whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm"])},"App Settings",2)])])):v("",!0),r(t("div",ne,[e[22]||(e[22]=t("h4",{class:"font-semibold text-lg"},"System Settings",-1)),t("div",null,[e[12]||(e[12]=t("label",{for:"app-name",class:"label"},"Name",-1)),r(t("input",{id:"app-name","onUpdate:modelValue":e[2]||(e[2]=l=>a.value.name=l),type:"text",class:"input-field mt-1"},null,512),[[y,a.value.name]])]),t("div",null,[e[13]||(e[13]=t("label",{for:"app-desc",class:"label"},"Description",-1)),r(t("textarea",{id:"app-desc","onUpdate:modelValue":e[3]||(e[3]=l=>a.value.description=l),rows:"3",class:"input-field mt-1"},null,512),[[y,a.value.description]])]),t("div",null,[e[14]||(e[14]=t("label",{for:"app-port",class:"label"},"Port Number",-1)),r(t("input",{id:"app-port","onUpdate:modelValue":e[4]||(e[4]=l=>a.value.port=l),type:"number",min:"1025",max:"65535",required:"",class:"input-field mt-1"},null,512),[[y,a.value.port,void 0,{number:!0}]])]),t("div",ie,[e[15]||(e[15]=t("span",{class:"toggle-label"},"Start on System Startup",-1)),t("button",{onClick:e[5]||(e[5]=l=>a.value.autostart=!a.value.autostart),type:"button",class:b([a.value.autostart?"bg-blue-600":"bg-gray-200 dark:bg-gray-600","toggle-switch"])},[t("span",{class:b([a.value.autostart?"translate-x-5":"translate-x-0","toggle-knob"])},null,2)],2)]),t("div",ue,[e[16]||(e[16]=t("span",{class:"toggle-label"},"Allow OpenAI API Access",-1)),t("button",{onClick:e[6]||(e[6]=l=>a.value.allow_openai_api_access=!a.value.allow_openai_api_access),type:"button",class:b([a.value.allow_openai_api_access?"bg-blue-600":"bg-gray-200 dark:bg-gray-600","toggle-switch"])},[t("span",{class:b([a.value.allow_openai_api_access?"translate-x-5":"translate-x-0","toggle-knob"])},null,2)],2)]),t("div",re,[e[21]||(e[21]=t("h4",{class:"font-semibold text-lg"},"Authentication",-1)),t("div",null,[e[18]||(e[18]=t("label",{for:"service-auth-type",class:"label"},"Authentication Type",-1)),r(t("select",{id:"service-auth-type","onUpdate:modelValue":e[7]||(e[7]=l=>a.value.authentication_type=l),class:"input-field"},e[17]||(e[17]=[t("option",{value:"none"},"None",-1),t("option",{value:"bearer"},"Bearer Token",-1),t("option",{value:"lollms_sso"},"LoLLMs SSO",-1)]),512),[[I,a.value.authentication_type]])]),a.value.authentication_type==="bearer"?(s(),n("div",de,[e[19]||(e[19]=t("label",{for:"service-auth-key",class:"label"},"Authentication Key",-1)),r(t("input",{id:"service-auth-key","onUpdate:modelValue":e[8]||(e[8]=l=>a.value.authentication_key=l),type:"password",class:"input-field",placeholder:"Enter Bearer token"},null,512),[[y,a.value.authentication_key]])])):v("",!0),a.value.authentication_type==="lollms_sso"?(s(),n("div",pe,[t("div",null,[e[20]||(e[20]=t("label",{for:"sso-redirect-uri",class:"label"},"Redirect URI",-1)),r(t("input",{id:"sso-redirect-uri","onUpdate:modelValue":e[9]||(e[9]=l=>a.value.sso_redirect_uri=l),type:"url",class:"input-field",placeholder:"e.g., https://myapp.com/callback"},null,512),[[y,a.value.sso_redirect_uri]])])])):v("",!0)])],512),[[T,m.value==="system"]]),r(t("div",ve,[e[23]||(e[23]=t("h4",{class:"font-semibold text-lg"},"App Settings",-1)),(s(!0),n(j,null,O(P.value,([l,i])=>{var A,M,$,N,D;return s(),n("div",{key:l},[t("label",{for:`config-${l}`,class:"block text-sm font-medium"},k(i.title||l),9,ce),t("div",me,[i.format==="multiline"?r((s(),n("textarea",{key:0,"onUpdate:modelValue":u=>a.value[l]=u,class:"input-field h-24",disabled:(A=c.value.env_overrides)==null?void 0:A.includes(l)},null,8,be)),[[y,a.value[l]]]):i.enum?r((s(),n("select",{key:1,"onUpdate:modelValue":u=>a.value[l]=u,class:"input-field",disabled:(M=c.value.env_overrides)==null?void 0:M.includes(l)},[(s(!0),n(j,null,O(i.enum,u=>(s(),n("option",{key:u,value:u},k(u),9,fe))),128))],8,ge)),[[I,a.value[l]]]):i.type==="boolean"?(s(),n("div",ye,[r(t("input",{id:`config-${l}`,type:"checkbox","onUpdate:modelValue":u=>a.value[l]=u,class:"h-4 w-4 rounded",disabled:($=c.value.env_overrides)==null?void 0:$.includes(l)},null,8,_e),[[H,a.value[l]]]),t("label",{for:`config-${l}`,class:"ml-2 text-sm"},k(i.description),9,xe)])):(s(),n("div",he,[r(t("input",{type:i.sensitive&&!x.value[l]?"password":i.type==="integer"?"number":"text","onUpdate:modelValue":u=>a.value[l]=u,class:b(["input-field",{"pr-10":i.sensitive}]),disabled:(N=c.value.env_overrides)==null?void 0:N.includes(l)},null,10,we),[[Q,a.value[l]]]),i.sensitive?(s(),n("button",{key:0,type:"button",onClick:u=>K(l),class:"absolute inset-y-0 right-0 pr-3 flex items-center"},[x.value[l]?(s(),S(W,{key:0,class:"h-5 w-5"})):(s(),S(X,{key:1,class:"h-5 w-5"}))],8,ke)):v("",!0)]))]),(D=c.value.env_overrides)!=null&&D.includes(l)?(s(),n("p",Ce,"Managed by '"+k(i.envVar)+"' environment variable.",1)):v("",!0)])}),128))],512),[[T,m.value==="app"&&h.value]])],8,le)],32)):v("",!0)]),footer:L(()=>[t("div",Se,[t("button",{onClick:e[10]||(e[10]=l=>z(_).closeModal("appConfig")),type:"button",class:"btn btn-secondary"},"Cancel"),t("button",{onClick:U,type:"button",class:"btn btn-primary",disabled:p.value||V.value},[p.value?(s(),S(B,{key:0,class:"w-5 h-5 mr-2 animate-spin"})):v("",!0),J(" "+k(p.value?"Saving...":"Save Changes"),1)],8,Ve)])]),_:1},8,["title","max-width-class"]))}},De=R(Ue,[["__scopeId","data-v-456e7da6"]]);export{De as default};
