import{a6 as fe,l as ge,u as ye,m as me,s as z,r as A,c as b,w as S,o as be,a as i,b as l,d as s,k as y,n as B,p as v,v as C,e as u,q as _,C as we,F as w,i as h,t as g,y as T,f as P,g as M,bu as O,A as he,I as ke,h as xe}from"./index-Dja5al8n.js";import Ae from"./IconArrowUp-DrGA3eHa.js";import Se from"./IconArrowDown-xlvDB4Yz.js";import{A as $e,a as Re}from"./AppCardSkeleton-BdUMQccW.js";import"./IconArrowUpCircle-C2zX0kXO.js";import"./IconGlobeAlt-CCKuKt2J.js";import"./IconPlayCircle-CO9K00fu.js";import"./IconWrenchScrewdriver-BpyF9K2q.js";const Ce={class:"space-y-6"},_e={class:"border-b border-gray-200 dark:border-gray-700"},Ie={class:"-mb-px flex space-x-6","aria-label":"Sub Tabs"},Ue={key:0},Te={class:"space-y-4"},Pe={class:"grid grid-cols-1 lg:grid-cols-4 gap-4"},Me={class:"relative lg:col-span-1"},Ve={class:"grid grid-cols-1 sm:grid-cols-3 lg:col-span-3 gap-4"},Fe=["value"],Ze=["value"],De={class:"flex items-center gap-2"},Le=["value"],Ne={key:0,class:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 2xl:grid-cols-4 gap-6"},ze={key:1,class:"empty-state-card"},Be={key:2},Oe={class:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 2xl:grid-cols-4 gap-6"},qe={key:0,class:"flex justify-between items-center mt-6"},je=["disabled"],Ee={class:"text-sm text-gray-600 dark:text-gray-400"},He=["disabled"],Ke={key:1},Qe={class:"flex justify-between items-center mb-4 flex-wrap gap-2"},Je={key:0,class:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm mb-6"},We={class:"flex items-center gap-x-4"},Ge={key:0},Xe=["required"],Ye={key:1},et=["required"],tt={key:1,class:"text-center p-4"},at={key:2,class:"empty-state-card"},st={key:3,class:"space-y-4"},nt={class:"font-semibold"},ot={class:"text-sm text-gray-500"},lt={class:"text-xs text-gray-400"},it={class:"flex items-center gap-2"},rt=["onClick"],dt=["onClick"],ut={__name:"AppsManagement",setup(pt){const r=ge(),V=ye(),p=me(),{appFilters:o}=r,{zooRepositories:F,isLoadingZooRepositories:q,zooApps:$,isLoadingZooApps:j}=z(r),{tasks:E}=z(V),f=A("zoo"),d=A({type:"git",name:"",url:"",path:""}),k=A(!1),c=A(null),x=A(JSON.parse(localStorage.getItem("starredApps")||"[]"));let Z=null;const H=[{value:"last_update_date",label:"Last Updated"},{value:"creation_date",label:"Creation Date"},{value:"name",label:"Name"},{value:"author",label:"Author"}],I=b(()=>$.value.total||0),D=b(()=>$.value.pages||1),K=b(()=>{if(I.value===0)return"Showing 0-0 of 0";const t=(o.currentPage-1)*o.pageSize+1,e=Math.min(o.currentPage*o.pageSize,I.value);return`Showing ${t}-${e} of ${I.value}`});function Q(){clearTimeout(Z),Z=setTimeout(()=>{o.currentPage!==1?o.currentPage=1:r.fetchZooApps()},300)}S(()=>[o.sortKey,o.sortOrder,o.selectedCategory,o.installationStatusFilter,o.selectedRepository],()=>{o.currentPage!==1?o.currentPage=1:r.fetchZooApps()}),S(()=>o.searchQuery,Q),S(()=>o.currentPage,r.fetchZooApps),S(x,t=>{localStorage.setItem("starredApps",JSON.stringify(t))},{deep:!0}),S(f,t=>{t==="zoo"&&r.fetchZooApps(),t==="source"&&r.fetchZooRepositories()}),be(()=>{f.value==="zoo"&&r.fetchZooApps(),f.value==="source"&&r.fetchZooRepositories()});const U=b(()=>{const t=new Map,e="Installing app: ",a=/^(Updating app|Start app|Stop app|Fixing item|Purging item): .* \(([a-fA-F0-9-]+)\)$/;return(E.value||[]).forEach(n=>{if(n!=null&&n.name&&(n.status==="running"||n.status==="pending")){let m;if(n.name.startsWith(e))m=`folder:${n.name.replace(e,"")}`;else{const N=n.name.match(a);N&&(m=`id:${N[2]}`)}m&&(!t.has(m)||new Date(n.created_at)>new Date(t.get(m).created_at))&&t.set(m,n)}}),($.value.items||[]).map(n=>({...n,task:t.get(`folder:${n.folder_name}`)||(n.id?t.get(`id:${n.id}`):null)}))}),R=b(()=>Array.isArray(F.value)?[...F.value].sort((t,e)=>(t.name||"").localeCompare(e.name||"")):[]),J=b(()=>["All","Starred",...$.value.categories||[]]);function W(t){const e=x.value.indexOf(t);e>-1?x.value.splice(e,1):x.value.push(t)}function G(t){return t?new Date(t).toLocaleString():"Never"}async function X(){if(!d.value.name){p.addNotification("Repository name is required.","warning");return}const t={name:d.value.name};d.value.type==="git"?t.url=d.value.url:t.path=d.value.path,c.value="add";try{await r.addZooRepository(t),d.value={type:"git",name:"",url:"",path:""},k.value=!1}finally{c.value=null}}async function Y(t){c.value=t.id;try{await r.pullZooRepository(t.id)}finally{c.value=null}}async function ee(t){if(await p.showConfirmation({title:`Delete Repository '${t.name}'?`})){c.value=t.id;try{await r.deleteZooRepository(t.id)}finally{c.value=null}}}function te(t){p.openModal("appInstall",{app:t,type:"apps"})}async function ae(t){await p.showConfirmation({title:`Update '${t.name}'?`,confirmText:"Update"})&&await r.updateApp(t.id)}async function L(t,e){c.value=`${e}-${t}`;try{e==="start"&&await r.startApp(t),e==="stop"&&await r.stopApp(t)}finally{c.value=null}}async function se(t){if(await p.showConfirmation({title:`Uninstall '${t.name}'?`,confirmText:"Uninstall"})){c.value=`uninstall-${t.id}`;try{await r.uninstallApp(t.id)}finally{c.value=null}}}function ne(t){p.openModal("appConfig",{app:t})}function oe(t){p.openModal("appLog",{app:t})}async function le(t){const e=await r.fetchAppReadme(t.repository,t.folder_name);p.openModal("sourceViewer",{title:`README: ${t.name}`,content:e,language:"markdown"})}async function ie(t){await V.cancelTask(t)}function re(t){p.openModal("tasksManager",{initialTaskId:t})}async function de(){await r.syncInstallations()}async function ue(t){await p.showConfirmation({title:`Purge '${t.name}'?`,message:"This will permanently delete the installation folder.",confirmText:"Purge"})&&await r.purgeBrokenInstallation(t)}async function pe(t){await p.showConfirmation({title:`Fix '${t.name}'?`,message:"This will attempt to re-create the database entry for this item.",confirmText:"Fix"})&&await r.fixBrokenInstallation(t)}function ce(t){p.openModal("appDetails",{app:t})}function ve(){p.openModal("serviceRegistration",{itemType:"app",ownerType:"system",onRegistered:r.fetchZooApps})}return(t,e)=>(l(),i("div",Ce,[s("div",_e,[s("nav",Ie,[s("button",{onClick:e[0]||(e[0]=a=>f.value="zoo"),class:B(["tab-button",f.value==="zoo"?"active":"inactive"])},"Zoo",2),s("button",{onClick:e[1]||(e[1]=a=>f.value="source"),class:B(["tab-button",f.value==="source"?"active":"inactive"])},"Repositories",2)])]),f.value==="zoo"?(l(),i("section",Ue,[s("div",{class:"flex justify-between items-center mb-4 flex-wrap gap-2"},[e[16]||(e[16]=s("h3",{class:"text-xl font-semibold"},"App Zoo",-1)),s("div",{class:"flex items-center gap-2"},[s("button",{onClick:ve,class:"btn btn-secondary"},"Register External App"),s("button",{onClick:de,class:"btn btn-secondary-outline",title:"Repair broken installations and remove orphaned DB entries."},"Sync Installations")])]),s("div",Te,[s("div",Pe,[s("div",Me,[v(s("input",{type:"text","onUpdate:modelValue":e[2]||(e[2]=a=>u(o).searchQuery=a),placeholder:"Search apps...",class:"input-field w-full pl-10"},null,512),[[C,u(o).searchQuery]]),e[17]||(e[17]=s("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[s("svg",{class:"h-5 w-5 text-gray-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})])],-1))]),s("div",Ve,[v(s("select",{"onUpdate:modelValue":e[3]||(e[3]=a=>u(o).installationStatusFilter=a),class:"input-field"},e[18]||(e[18]=[we('<option value="All" data-v-0eea2ef2>All Statuses</option><option value="Installed" data-v-0eea2ef2>Installed</option><option value="Uninstalled" data-v-0eea2ef2>Uninstalled</option><option value="Registered" data-v-0eea2ef2>Registered</option><option value="Broken" data-v-0eea2ef2>Broken</option>',5)]),512),[[_,u(o).installationStatusFilter]]),v(s("select",{"onUpdate:modelValue":e[4]||(e[4]=a=>u(o).selectedCategory=a),class:"input-field"},[(l(!0),i(w,null,h(J.value,a=>(l(),i("option",{key:a,value:a},g(a),9,Fe))),128))],512),[[_,u(o).selectedCategory]]),v(s("select",{"onUpdate:modelValue":e[5]||(e[5]=a=>u(o).selectedRepository=a),class:"input-field"},[e[19]||(e[19]=s("option",{value:"All"},"All Sources",-1)),e[20]||(e[20]=s("option",{value:"Registered"},"Registered",-1)),(l(!0),i(w,null,h(R.value,a=>(l(),i("option",{key:a.id,value:a.name},g(a.name),9,Ze))),128))],512),[[_,u(o).selectedRepository]])])]),s("div",De,[v(s("select",{"onUpdate:modelValue":e[6]||(e[6]=a=>u(o).sortKey=a),class:"input-field w-48"},[(l(),i(w,null,h(H,a=>s("option",{key:a.value,value:a.value},"Sort by "+g(a.label),9,Le)),64))],512),[[_,u(o).sortKey]]),s("button",{onClick:e[7]||(e[7]=a=>u(o).sortOrder=u(o).sortOrder==="asc"?"desc":"asc"),class:"btn btn-secondary p-2"},[u(o).sortOrder==="asc"?(l(),T(Ae,{key:0,class:"w-5 h-5"})):(l(),T(Se,{key:1,class:"w-5 h-5"}))])]),u(j)?(l(),i("div",Ne,[(l(),i(w,null,h(8,a=>P($e,{key:a})),64))])):!U.value||U.value.length===0?(l(),i("div",ze,e[21]||(e[21]=[s("h4",{class:"font-semibold"},"No Apps Found",-1)]))):(l(),i("div",Be,[s("div",Oe,[(l(!0),i(w,null,h(U.value,a=>(l(),T(Re,{key:a.id||`${a.repository}/${a.folder_name}`,app:a,task:a.task,"is-starred":x.value.includes(a.name),onStar:n=>W(a.name),onInstall:n=>te(a),onUpdate:n=>ae(a),onUninstall:n=>se(a),onHelp:n=>le(a),onViewTask:re,onCancelInstall:n=>ie(a.task.id),onStart:n=>L(a.id,"start"),onStop:n=>L(a.id,"stop"),onConfigure:n=>ne(a),onFix:n=>pe(a),onPurge:n=>ue(a),onDetails:ce,onLogs:n=>oe(a)},null,8,["app","task","is-starred","onStar","onInstall","onUpdate","onUninstall","onHelp","onCancelInstall","onStart","onStop","onConfigure","onFix","onPurge","onLogs"]))),128))]),D.value>1?(l(),i("div",qe,[s("button",{onClick:e[8]||(e[8]=a=>t.currentPage--),disabled:t.currentPage===1,class:"btn btn-secondary"},"Previous",8,je),s("span",Ee,g(K.value),1),s("button",{onClick:e[9]||(e[9]=a=>t.currentPage++),disabled:t.currentPage>=D.value,class:"btn btn-secondary"},"Next",8,He)])):y("",!0)]))])])):y("",!0),f.value==="source"?(l(),i("section",Ke,[s("div",Qe,[e[22]||(e[22]=s("h3",{class:"text-xl font-semibold"},"App Zoo Repositories",-1)),s("button",{onClick:e[10]||(e[10]=a=>k.value=!k.value),class:"btn btn-primary"},g(k.value?"Cancel":"Add Repository"),1)]),k.value?(l(),i("div",Je,[s("form",{onSubmit:he(X,["prevent"]),class:"space-y-4"},[s("div",We,[s("label",null,[v(s("input",{type:"radio","onUpdate:modelValue":e[11]||(e[11]=a=>d.value.type=a),value:"git",class:"radio-input"},null,512),[[O,d.value.type]]),e[23]||(e[23]=M(" Git"))]),s("label",null,[v(s("input",{type:"radio","onUpdate:modelValue":e[12]||(e[12]=a=>d.value.type=a),value:"local",class:"radio-input"},null,512),[[O,d.value.type]]),e[24]||(e[24]=M(" Local"))])]),s("div",null,[e[25]||(e[25]=s("label",null,"Name",-1)),v(s("input",{"onUpdate:modelValue":e[13]||(e[13]=a=>d.value.name=a),type:"text",class:"input-field",required:""},null,512),[[C,d.value.name]])]),d.value.type==="git"?(l(),i("div",Ge,[e[26]||(e[26]=s("label",null,"URL",-1)),v(s("input",{"onUpdate:modelValue":e[14]||(e[14]=a=>d.value.url=a),type:"url",class:"input-field",required:d.value.type==="git"},null,8,Xe),[[C,d.value.url]])])):y("",!0),d.value.type==="local"?(l(),i("div",Ye,[e[27]||(e[27]=s("label",null,"Path",-1)),v(s("input",{"onUpdate:modelValue":e[15]||(e[15]=a=>d.value.path=a),type:"text",class:"input-field",required:d.value.type==="local"},null,8,et),[[C,d.value.path]])])):y("",!0),e[28]||(e[28]=s("div",{class:"flex justify-end"},[s("button",{type:"submit",class:"btn btn-primary"},"Add")],-1))],32)])):y("",!0),u(q)?(l(),i("div",tt,"Loading...")):!R.value||R.value.length===0?(l(),i("div",at,e[29]||(e[29]=[s("p",null,"No repositories added.",-1)]))):(l(),i("div",st,[(l(!0),i(w,null,h(R.value,a=>(l(),i("div",{key:a.id,class:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm flex items-center justify-between"},[s("div",null,[s("p",nt,g(a.name),1),s("p",ot,g(a.url),1),s("p",lt,"Pulled: "+g(G(a.last_pulled_at)),1)]),s("div",it,[s("button",{onClick:n=>Y(a),class:"btn btn-secondary btn-sm"},[P(ke,{class:"w-4 h-4 mr-1"}),M(g(a.type==="git"?"Pull":"Rescan"),1)],8,rt),a.is_deletable?(l(),i("button",{key:0,onClick:n=>ee(a),class:"btn btn-danger btn-sm"},[P(xe,{class:"w-4 h-4"})],8,dt)):y("",!0)])]))),128))]))])):y("",!0)]))}},ht=fe(ut,[["__scopeId","data-v-0eea2ef2"]]);export{ht as default};
