import{X as Ae,bg as Ie,bt as $e,m as Te,bh as ee,f as p,c as w,bq as U,bi as Re,a as o,o as n,e as s,h as b,Z as k,j as v,bu as L,t as f,w as Ue,bo as Pe,g as y,q as te,bS as se,v as Z,bs as Ne,bk as h,F as S,i as A,s as De,bj as B,b as W,bT as Ve,bU as Le,bV as Ze}from"./index-CNm5rzXd.js";import je from"./IconArrowUp-Vbln4KZq.js";import qe from"./IconArrowDown-BIiF54S6.js";import Fe from"./IconGlobeAlt-C2KiTc5X.js";import{A as ze,a as ae}from"./AppCardSkeleton-u6c6OGmP.js";import"./IconArrowUpCircle-SZApygRM.js";import"./IconPlayCircle-uB1Huso5.js";const Ee={class:"space-y-6"},Oe={class:"border-b border-gray-200 dark:border-gray-700"},Be={class:"-mb-px flex space-x-6","aria-label":"Sub Tabs"},We={key:0},Ge={class:"flex justify-between items-center mb-4 flex-wrap gap-2"},He={class:"flex items-center gap-2"},Je=["disabled"],Ke={key:0,class:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm mb-6 overflow-hidden"},Qe={class:"flex items-center gap-x-4 border-b pb-4 dark:border-gray-700"},Xe={class:"flex items-center gap-x-2 cursor-pointer text-sm font-medium"},Ye={class:"flex items-center gap-x-2 cursor-pointer text-sm font-medium"},et={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},tt={key:0,class:"md:col-span-2"},st=["required"],at={key:1,class:"md:col-span-2"},lt=["required"],nt={class:"flex justify-end"},ot=["disabled"],it={key:0,class:"text-center p-4"},rt={key:1,class:"empty-state-card"},dt={key:2,class:"space-y-4"},ut={class:"flex-grow truncate"},ct={class:"flex items-center gap-2"},pt={class:"font-semibold"},vt={class:"text-sm text-gray-500"},mt=["title"],ft={class:"text-xs text-gray-400 mt-1"},gt={class:"flex items-center gap-x-2 flex-shrink-0"},bt=["onClick","disabled"],yt={class:"ml-1"},ht=["onClick","disabled"],_t={key:1},xt={class:"flex justify-between items-center mb-4 flex-wrap gap-2"},wt=["disabled"],kt={class:"space-y-4"},Ct={class:"grid grid-cols-1 lg:grid-cols-3 gap-4"},Mt={class:"relative lg:col-span-1"},St={class:"grid grid-cols-2 lg:col-span-2 gap-4"},At=["value"],It={class:"flex items-center gap-2"},$t=["value"],Tt={key:0,class:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 2xl:grid-cols-4 gap-6"},Rt={key:1,class:"empty-state-card"},Ut={key:2},Pt={class:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 2xl:grid-cols-4 gap-6"},Nt={key:0,class:"mt-6 flex justify-between items-center"},Dt={class:"text-sm text-gray-500"},Vt={class:"flex gap-2"},Lt=["disabled"],Zt=["disabled"],jt={key:2},qt={class:"flex justify-between items-center mb-4"},Ft={class:"flex items-center gap-2"},zt=["disabled"],Et={key:0,class:"text-center p-10"},Ot={key:1,class:"empty-state-card"},Bt={key:2,class:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 2xl:grid-cols-4 gap-6"},Wt={class:"bg-white dark:bg-gray-800 rounded-b-lg p-2 flex justify-around items-center text-sm border-t border-gray-200 dark:border-gray-700"},Gt=["href"],Ht=["onClick"],Jt=["onClick"],Kt=["onClick"],Qt={__name:"McpsManagement",setup(Xt){const r=Ie(),G=$e(),c=Te(),{mcpZooRepositories:H,isLoadingMcpZooRepositories:le,zooMcps:C,isLoadingZooMcps:j,installedApps:ne,isLoadingInstalledApps:q}=ee(r),{tasks:J}=ee(G),m=p("available_items"),i=p({type:"git",name:"",url:"",path:""}),I=p(!1),u=p(null),P=p(""),_=p("All"),$=p("All"),N=p(!1),D=p("last_update_date"),T=p("desc"),M=p(JSON.parse(localStorage.getItem("starredItems")||"[]")),g=p(1),F=p(24);let K=null;const oe=[{value:"last_update_date",label:"Last Updated"},{value:"creation_date",label:"Creation Date"},{value:"name",label:"Name"},{value:"author",label:"Author"}],Q=w(()=>C.value.total||0),ie=w(()=>C.value.pages||1),re=w(()=>{const a=(g.value-1)*F.value+1,e=Math.min(g.value*F.value,Q.value);return`Showing ${a}-${e} of ${Q.value}`}),de=w(()=>C.value.items?C.value.items.reduce((a,e)=>(a[e.repository]=(a[e.repository]||0)+1,a),{}):{});async function R(){if(_.value==="Starred")return;const a={page:g.value,page_size:F.value,sort_by:D.value,sort_order:T.value,category:_.value!=="All"?_.value:void 0,search_query:P.value||void 0,installation_status:$.value!=="All"?$.value:void 0};await r.fetchZooMcps(a)}function ue(){clearTimeout(K),K=setTimeout(()=>{g.value=1,R()},300)}U(()=>i.value.type,a=>{a==="git"?i.value.path="":i.value.url=""}),U([m,D,T,_,$],()=>{g.value=1,m.value==="available_items"&&R()}),U(P,ue),U(g,R),U(M,a=>{localStorage.setItem("starredItems",JSON.stringify(a))},{deep:!0}),Re(()=>{r.fetchMcpZooRepositories(),r.fetchInstalledApps(),R()});const z=w(()=>{if(!Array.isArray(C.value.items))return[];let a=C.value.items;_.value==="Starred"&&(a=a.filter(l=>M.value.includes(l.name)));const e=new Map,t=["Installing MCP: ","Updating app: "];return J.value.forEach(l=>{if(l!=null&&l.name){for(const d of t)if(l.name.startsWith(d)&&(l.status==="running"||l.status==="pending")){const x=l.name.replace(d,"");(!e.has(x)||new Date(l.created_at)>new Date(e.get(x).created_at))&&e.set(x,l);break}}}),a.map(l=>({...l,task:e.get(l.name)||e.get(l.folder_name)||null}))}),E=w(()=>Array.isArray(H.value)?[...H.value].sort((a,e)=>(a.name||"").localeCompare(e.name||"")):[]),ce=w(()=>C.value.categories||["All","Starred"]),O=w(()=>{const e=[...ne.value.filter(l=>l.item_type==="mcp")].sort((l,d)=>(l.name||"").localeCompare(d.name||"")),t=new Map;return J.value.forEach(l=>{if(!(l!=null&&l.name))return;let d="",x=null;l.name.startsWith("Start app: ")?(d=l.name.replace("Start app: ",""),x="starting"):l.name.startsWith("Stop app: ")?(d=l.name.replace("Stop app: ",""),x="stopping"):l.name.startsWith("Updating app: ")&&(d=l.name.replace("Updating app: ",""),x="updating"),d&&(l.status==="running"||l.status==="pending")&&(!t.has(d)||new Date(l.created_at)>new Date(t.get(d).created_at))&&t.set(d,{task:l,activityType:x})}),e.map(l=>{const d=t.get(l.name);return{...l,task:d?d.task:null,activity_status:d?d.activityType:null}})});function pe(a){const e=M.value.indexOf(a);e>-1?M.value.splice(e,1):M.value.push(a)}function ve(a){return a?new Date(a).toLocaleString():"Never"}async function me(){if(!i.value.name){c.addNotification("Repository name is required.","warning");return}const a={name:i.value.name};if(i.value.type==="git"){if(!i.value.url){c.addNotification("Git URL is required.","warning");return}a.url=i.value.url}else{if(!i.value.path){c.addNotification("Local Folder Path is required.","warning");return}a.path=i.value.path}u.value="add";try{await r.addMcpZooRepository(a),i.value={type:"git",name:"",url:"",path:""},I.value=!1}finally{u.value=null}}async function fe(a){u.value=a.id;try{await r.pullMcpZooRepository(a.id)}finally{u.value=null}}async function ge(){N.value=!0;try{await r.pullAllMcpZooRepositories()}finally{N.value=!1}}async function be(a){if(await c.showConfirmation({title:`Delete Repository '${a.name}'?`,message:"This will remove the repository and its cached files. This action cannot be undone.",confirmText:"Delete"})){u.value=a.id;try{await r.deleteMcpZooRepository(a.id)}finally{u.value=null}}}function ye(a){c.openModal("appInstall",{app:a,type:"mcps"})}async function X(a){await c.showConfirmation({title:`Update '${a.name}'?`,message:"This will update the MCP to the latest version while preserving your configuration. The MCP will be stopped during the update.",confirmText:"Update"})&&await r.updateApp(a.id)}async function V(a,e){u.value=`${e}-${a}`;try{e==="start"&&await r.startApp(a),e==="stop"&&await r.stopApp(a)}finally{u.value=null}}async function Y(a){if(await c.showConfirmation({title:`Uninstall '${a.name}'?`,message:"This will permanently delete all files. This cannot be undone.",confirmText:"Uninstall"})){u.value=`uninstall-${a.id}`;try{await r.uninstallApp(a.id)}finally{u.value=null}}}function he(a){c.openModal("sourceViewer",{title:`Details: ${a.name}`,content:a.description||"No description available.",language:"text"})}function _e(a){c.openModal("appConfig",{app:a})}function xe(a){c.openModal("serviceRegistration",{item:a,itemType:"mcp",isInstalled:!0})}async function we(a){const e=await r.fetchAppLog(a.id);c.openModal("sourceViewer",{title:`Logs: ${a.name}`,content:e||"No log content found.",language:"log"})}async function ke(a){const e=await r.fetchMcpReadme(a.repository,a.folder_name);c.openModal("sourceViewer",{title:`README: ${a.name}`,content:e,language:"markdown"})}async function Ce(a){await G.cancelTask(a)}function Me(a){c.openModal("tasksManager",{initialTaskId:a})}async function Se(){await c.showConfirmation({title:"Sync Installations?",message:'This will scan for installed items on disk that are missing from the database and try to repair them. It will also remove database entries for items that no longer exist on disk. This can fix "ghost" installations.',confirmText:"Sync Now"})&&await r.syncInstallations()}return(a,e)=>(n(),o("div",Ee,[s("div",Oe,[s("nav",Be,[s("button",{onClick:e[0]||(e[0]=t=>m.value="repositories"),class:k(["tab-button",m.value==="repositories"?"active":"inactive"])},"Repositories",2),s("button",{onClick:e[1]||(e[1]=t=>m.value="available_items"),class:k(["tab-button",m.value==="available_items"?"active":"inactive"])},"Available",2),s("button",{onClick:e[2]||(e[2]=t=>m.value="installed_apps"),class:k(["tab-button",m.value==="installed_apps"?"active":"inactive"])},"Installed",2)])]),m.value==="repositories"?(n(),o("section",We,[s("div",Ge,[e[18]||(e[18]=s("h3",{class:"text-xl font-semibold"},"MCP Zoo Repositories",-1)),s("div",He,[s("button",{onClick:ge,class:"btn btn-secondary",disabled:N.value},[v(L,{class:k(["w-4 h-4",{"animate-spin":N.value}])},null,8,["class"]),e[17]||(e[17]=s("span",{class:"ml-2"},"Pull All",-1))],8,Je),s("button",{onClick:e[3]||(e[3]=t=>I.value=!I.value),class:"btn btn-primary"},f(I.value?"Cancel":"Add Repository"),1)])]),v(Ne,{name:"form-fade"},{default:Ue(()=>[I.value?(n(),o("div",Ke,[s("form",{onSubmit:Pe(me,["prevent"]),class:"space-y-4"},[s("div",Qe,[s("label",Xe,[y(s("input",{type:"radio","onUpdate:modelValue":e[4]||(e[4]=t=>i.value.type=t),value:"git",class:"radio-input"},null,512),[[se,i.value.type]]),e[19]||(e[19]=te(" Git Repository"))]),s("label",Ye,[y(s("input",{type:"radio","onUpdate:modelValue":e[5]||(e[5]=t=>i.value.type=t),value:"local",class:"radio-input"},null,512),[[se,i.value.type]]),e[20]||(e[20]=te(" Local Folder"))])]),s("div",et,[s("div",null,[e[21]||(e[21]=s("label",{for:"repo-name-mcp",class:"block text-sm font-medium mb-1"},"Name",-1)),y(s("input",{id:"repo-name-mcp","onUpdate:modelValue":e[6]||(e[6]=t=>i.value.name=t),type:"text",class:"input-field",placeholder:"e.g., Official MCP Zoo",required:""},null,512),[[Z,i.value.name]])]),i.value.type==="git"?(n(),o("div",tt,[e[22]||(e[22]=s("label",{for:"repo-url-mcp",class:"block text-sm font-medium mb-1"},"Git URL",-1)),y(s("input",{id:"repo-url-mcp","onUpdate:modelValue":e[7]||(e[7]=t=>i.value.url=t),type:"url",class:"input-field",placeholder:"https://github.com/ParisNeo/lollms_mcps_zoo.git",required:i.value.type==="git"},null,8,st),[[Z,i.value.url]])])):b("",!0),i.value.type==="local"?(n(),o("div",at,[e[23]||(e[23]=s("label",{for:"repo-path-mcp",class:"block text-sm font-medium mb-1"},"Full Folder Path",-1)),y(s("input",{id:"repo-path-mcp","onUpdate:modelValue":e[8]||(e[8]=t=>i.value.path=t),type:"text",class:"input-field",placeholder:"e.g., C:\\lollms-zoos\\my-mcps-zoo",required:i.value.type==="local"},null,8,lt),[[Z,i.value.path]])])):b("",!0)]),s("div",nt,[s("button",{type:"submit",class:"btn btn-primary",disabled:u.value==="add"},f(u.value==="add"?"Adding...":"Add Repository"),9,ot)])],32)])):b("",!0)]),_:1}),h(le)?(n(),o("div",it,"Loading repositories...")):!E.value||E.value.length===0?(n(),o("div",rt,e[24]||(e[24]=[s("p",null,"No MCP Zoo repositories added.",-1)]))):(n(),o("div",dt,[(n(!0),o(S,null,A(E.value,t=>(n(),o("div",{key:t.id,class:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm flex flex-col md:flex-row md:items-center justify-between gap-4"},[s("div",ut,[s("div",ct,[s("span",{class:k(["px-2 py-0.5 text-xs font-semibold rounded-full",t.type==="git"?"bg-blue-100 text-blue-800 dark:bg-blue-900/50 dark:text-blue-300":"bg-green-100 text-green-800 dark:bg-green-900/50 dark:text-green-300"])},f(t.type),3),s("p",pt,f(t.name),1),s("span",vt,"("+f(de.value[t.name]||0)+" items)",1)]),s("p",{class:"text-sm text-gray-500 font-mono truncate mt-1",title:t.url},f(t.url),9,mt),s("p",ft,"Last updated: "+f(ve(t.last_pulled_at)),1)]),s("div",gt,[s("button",{onClick:l=>fe(t),class:"btn btn-secondary btn-sm",disabled:u.value===t.id},[v(L,{class:k(["w-4 h-4",{"animate-spin":u.value===t.id}])},null,8,["class"]),s("span",yt,f(t.type==="git"?"Pull":"Rescan"),1)],8,bt),t.is_deletable?(n(),o("button",{key:0,onClick:l=>be(t),class:"btn btn-danger btn-sm",disabled:u.value===t.id},[v(De,{class:"w-4 h-4"})],8,ht)):b("",!0)])]))),128))]))])):b("",!0),m.value==="available_items"?(n(),o("section",_t,[s("div",xt,[e[26]||(e[26]=s("h3",{class:"text-xl font-semibold"},"Available MCPs",-1)),s("button",{onClick:R,class:"btn btn-secondary",disabled:h(j)},[v(L,{class:k(["w-4 h-4",{"animate-spin":h(j)}])},null,8,["class"]),e[25]||(e[25]=s("span",{class:"ml-2"},"Rescan",-1))],8,wt)]),s("div",kt,[s("div",Ct,[s("div",Mt,[y(s("input",{type:"text","onUpdate:modelValue":e[9]||(e[9]=t=>P.value=t),placeholder:"Search MCPs...",class:"input-field w-full pl-10"},null,512),[[Z,P.value]]),e[27]||(e[27]=s("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[s("svg",{class:"h-5 w-5 text-gray-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})])],-1))]),s("div",St,[y(s("select",{"onUpdate:modelValue":e[10]||(e[10]=t=>$.value=t),class:"input-field"},e[28]||(e[28]=[s("option",{value:"All"},"All Statuses",-1),s("option",{value:"Installed"},"Installed",-1),s("option",{value:"Uninstalled"},"Uninstalled",-1)]),512),[[B,$.value]]),y(s("select",{"onUpdate:modelValue":e[11]||(e[11]=t=>_.value=t),class:"input-field"},[(n(!0),o(S,null,A(ce.value,t=>(n(),o("option",{key:t,value:t},f(t),9,At))),128))],512),[[B,_.value]])])]),s("div",It,[y(s("select",{"onUpdate:modelValue":e[12]||(e[12]=t=>D.value=t),class:"input-field w-48"},[(n(),o(S,null,A(oe,t=>s("option",{key:t.value,value:t.value},"Sort by "+f(t.label),9,$t)),64))],512),[[B,D.value]]),s("button",{onClick:e[13]||(e[13]=t=>T.value=T.value==="asc"?"desc":"asc"),class:"btn btn-secondary p-2"},[T.value==="asc"?(n(),W(je,{key:0,class:"w-5 h-5"})):(n(),W(qe,{key:1,class:"w-5 h-5"}))])]),h(j)?(n(),o("div",Tt,[(n(),o(S,null,A(8,t=>v(ze,{key:t})),64))])):!z.value||z.value.length===0?(n(),o("div",Rt,e[29]||(e[29]=[s("h4",{class:"font-semibold"},"No MCPs Found",-1),s("p",{class:"text-sm"},"No MCPs match your criteria. Please add and pull a repository or adjust your filters.",-1)]))):(n(),o("div",Ut,[s("div",Pt,[(n(!0),o(S,null,A(z.value,t=>(n(),W(ae,{key:`${t.repository}/${t.folder_name}`,app:t,task:t.task,"is-starred":M.value.includes(t.name),"item-type-name":"MCP",onStar:l=>pe(t.name),onInstall:l=>ye(t),onUpdate:l=>X(t),onUninstall:l=>Y(t),onDetails:l=>he(t),onHelp:l=>ke(t),onViewTask:Me,onCancelInstall:l=>Ce(t.task.id),onStart:l=>V(t.id,"start"),onStop:l=>V(t.id,"stop")},null,8,["app","task","is-starred","onStar","onInstall","onUpdate","onUninstall","onDetails","onHelp","onCancelInstall","onStart","onStop"]))),128))]),_.value!=="Starred"?(n(),o("div",Nt,[s("p",Dt,f(re.value),1),s("div",Vt,[s("button",{onClick:e[14]||(e[14]=t=>g.value--),disabled:g.value<=1,class:"btn btn-secondary"},"Previous",8,Lt),s("button",{onClick:e[15]||(e[15]=t=>g.value++),disabled:g.value>=ie.value,class:"btn btn-secondary"},"Next",8,Zt)])])):b("",!0)]))])])):b("",!0),m.value==="installed_apps"?(n(),o("section",jt,[s("div",qt,[e[31]||(e[31]=s("h3",{class:"text-xl font-semibold"},"Installed MCPs",-1)),s("div",Ft,[s("button",{onClick:Se,class:"btn btn-secondary-outline",title:"Repair broken installations and remove orphaned DB entries."},"Sync Installations"),s("button",{onClick:e[16]||(e[16]=(...t)=>h(r).fetchInstalledApps&&h(r).fetchInstalledApps(...t)),class:"btn btn-secondary",disabled:h(q)},[v(L,{class:k(["w-4 h-4",{"animate-spin":h(q)}])},null,8,["class"]),e[30]||(e[30]=s("span",{class:"ml-2"},"Refresh",-1))],8,zt)])]),h(q)?(n(),o("div",Et,"Loading...")):!O.value||O.value.length===0?(n(),o("div",Ot,e[32]||(e[32]=[s("h4",{class:"font-semibold"},"No MCPs Installed",-1),s("p",{class:"text-sm"},'Go to "Available" to install an MCP.',-1)]))):(n(),o("div",Bt,[(n(!0),o(S,null,A(O.value,t=>(n(),o("div",{key:t.id,class:"flex flex-col"},[v(ae,{app:t,task:t.task,"item-type-name":"MCP",onUpdate:l=>X(t),onUninstall:l=>Y(t),onStart:l=>V(t.id,"start"),onStop:l=>V(t.id,"stop")},null,8,["app","task","onUpdate","onUninstall","onStart","onStop"]),s("div",Wt,[t.status==="running"&&t.url?(n(),o("a",{key:0,href:t.url,target:"_blank",class:"btn-footer",title:"Open"},[v(Fe,{class:"w-5 h-5"})],8,Gt)):b("",!0),s("button",{onClick:l=>xe(t),class:"btn-footer",title:"Edit Registration"},[v(Ve,{class:"w-5 h-5"})],8,Ht),t.has_config_schema?(n(),o("button",{key:1,onClick:l=>_e(t),class:"btn-footer",title:"Configure"},[v(Le,{class:"w-5 h-5"})],8,Jt)):b("",!0),s("button",{onClick:l=>we(t),class:"btn-footer",title:"Logs"},[v(Ze,{class:"w-5 h-5"})],8,Kt)])]))),128))]))])):b("",!0)]))}},os=Ae(Qt,[["__scopeId","data-v-cf34420e"]]);export{os as default};
