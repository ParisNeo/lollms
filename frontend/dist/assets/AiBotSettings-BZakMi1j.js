import{c7 as K,ae as R,a as q,c1 as T,r as f,c as S,o as J,w as U,b as i,d as l,h as e,n as m,g as n,l as r,q as z,i as A,cb as H,c2 as M,F as C,m as N,t as c,v as _,j as F,e as W,cc as Q,P as X,W as Y}from"./index-DnjdbnqE.js";const Z={class:"bg-white dark:bg-gray-800 shadow-md rounded-lg"},tt={class:"space-y-8"},et={class:"relative flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg"},at={class:"space-y-6 pt-6 border-t dark:border-gray-600"},ot={class:"flex items-center gap-2 mb-1"},st=["disabled"],lt=["label"],it=["value"],nt=["value"],rt={key:0},dt={class:"space-y-6 pt-6 border-t dark:border-gray-600"},ut={class:"flex items-center justify-between"},bt=["disabled"],mt={key:0,class:"animate-spin"},_t={class:"relative flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg"},pt={key:0},gt={class:"space-y-6 pt-6 border-t dark:border-gray-600"},vt={class:"flex items-center justify-between"},ft=["disabled"],ct={key:0,class:"animate-spin"},yt={class:"relative flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg"},xt={key:0,class:"space-y-4"},kt={key:0},wt={key:1},ht={key:2},St={class:"mt-8 pt-5 border-t border-gray-200 dark:border-gray-700"},At={class:"flex justify-end"},Mt=["disabled"],Vt={__name:"AiBotSettings",setup(Ct){const p=K(),w=R(),b=q(),{globalSettings:Nt,aiBotSettings:y,isLoadingAiBotSettings:Bt,adminAvailableLollmsModels:x,isLoadingLollmsModels:B}=T(p),{publicPersonalities:P,userDataStores:j}=T(w),a=f({ai_bot_enabled:!1,ai_bot_system_prompt:"",lollms_model_name:"",active_personality_id:"",ai_bot_auto_post:!1,ai_bot_post_interval:24,ai_bot_content_mode:"static_text",ai_bot_static_content:"",ai_bot_file_path:"",ai_bot_generation_prompt:"Generate an interesting and engaging social media post based on the provided context. Keep it under 500 characters.",ai_bot_rag_datastore_ids:[],ai_bot_moderation_enabled:!1,ai_bot_moderation_criteria:""}),k=f(!1),g=f(!1),v=f(!1),h=f(!1);let V="{}";const D=S(()=>P.value.map(s=>({id:s.id,name:`${s.name} (by ${s.author})`}))),I=S(()=>j.value.map(s=>({id:s.id,name:s.name}))),L=S(()=>{const s={};return x.value?(x.value.forEach(t=>{let o="Aliases",u=t.name;if(t.binding)o=t.binding;else if(t.name&&t.name.includes("/")){const d=t.name.split("/");o=d[0],u=d.slice(1).join("/")}o=o.charAt(0).toUpperCase()+o.slice(1),s[o]||(s[o]=[]),s[o].push({...t,displayName:u})}),Object.keys(s).sort().reduce((t,o)=>(t[o]=s[o].sort((u,d)=>u.displayName.localeCompare(d.displayName)),t),{})):{}});J(()=>{y.value||p.fetchAiBotSettings(),x.value.length===0&&p.fetchAdminAvailableLollmsModels(),P.value.length===0&&w.fetchPersonalities(),w.fetchDataStores()}),U(y,E,{deep:!0}),U(a,s=>{h.value=JSON.stringify(s)!==V},{deep:!0});function E(){if(!y.value)return;const s=y.value,t={lollms_model_name:s.lollms_model_name||"",active_personality_id:s.active_personality_id||"",ai_bot_enabled:s.ai_bot_enabled??!1,ai_bot_system_prompt:s.ai_bot_system_prompt||"",ai_bot_auto_post:s.ai_bot_auto_post??!1,ai_bot_post_interval:s.ai_bot_post_interval||24,ai_bot_content_mode:s.ai_bot_content_mode||"static_text",ai_bot_static_content:s.ai_bot_static_content||"",ai_bot_file_path:s.ai_bot_file_path||"",ai_bot_generation_prompt:s.ai_bot_generation_prompt||"",ai_bot_rag_datastore_ids:s.ai_bot_rag_datastore_ids||[],ai_bot_moderation_enabled:s.ai_bot_moderation_enabled??!1,ai_bot_moderation_criteria:s.ai_bot_moderation_criteria||"Be polite and respectful."};a.value=t,V=JSON.stringify(a.value),h.value=!1}async function $(){k.value=!0;try{const s={...a.value};await p.updateAiBotSettings(s),b.addNotification("Settings saved successfully","success")}catch(s){console.error(s),b.addNotification("Failed to save settings","error")}finally{k.value=!1}}async function G(){if(confirm("This will force the bot to generate and publish a post immediately using the current settings. Continue?")){g.value=!0;try{await Y.post("/api/admin/trigger-post"),b.addNotification("Post generation task started!","success")}catch(s){console.error(s),b.addNotification("Failed to trigger post.","error")}finally{g.value=!1}}}async function O(){if(confirm("This will scan all old posts and comments that haven't been validated yet. Content violating the criteria will be flagged. Continue?")){v.value=!0;try{await p.triggerBatchModeration(),b.addNotification("Batch moderation task started! Check Tasks for progress.","success")}catch(s){console.error(s),b.addNotification("Failed to trigger moderation.","error")}finally{v.value=!1}}}return(s,t)=>(l(),i("div",Z,[t[36]||(t[36]=e("div",{class:"p-6 border-b border-gray-200 dark:border-gray-700"},[e("h3",{class:"text-xl font-semibold leading-6 text-gray-900 dark:text-white"}," AI Bot Settings "),e("p",{class:"mt-1 text-sm text-gray-500 dark:text-gray-400"}," Configure the automated AI assistant for @lollms replies, auto-posting, and moderation. ")],-1)),e("form",{onSubmit:X($,["prevent"]),class:"p-6"},[e("div",tt,[e("div",et,[t[13]||(t[13]=e("span",{class:"flex-grow flex flex-col"},[e("span",{class:"text-sm font-medium text-gray-900 dark:text-gray-100"},"Enable AI Bot Responses"),e("span",{class:"text-sm text-gray-500 dark:text-gray-400"},"Allow the bot to reply to @lollms mentions.")],-1)),e("button",{onClick:t[0]||(t[0]=o=>a.value.ai_bot_enabled=!a.value.ai_bot_enabled),type:"button",class:m([a.value.ai_bot_enabled?"bg-blue-600":"bg-gray-200 dark:bg-gray-600","relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out"])},[e("span",{class:m([a.value.ai_bot_enabled?"translate-x-5":"translate-x-0","pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out"])},null,2)],2)]),e("div",at,[e("div",null,[e("div",ot,[t[14]||(t[14]=e("label",{for:"bot-model",class:"block text-sm font-medium"},"Bot Model",-1)),A(B)?(l(),z(H,{key:0,class:"w-4 h-4 text-blue-500 animate-spin"})):n("",!0)]),r(e("select",{id:"bot-model","onUpdate:modelValue":t[1]||(t[1]=o=>a.value.lollms_model_name=o),class:"input-field mt-1",disabled:A(B)&&A(x).length===0},[t[15]||(t[15]=e("option",{value:""},"-- Select a Model --",-1)),(l(!0),i(C,null,N(L.value,(o,u)=>(l(),i("optgroup",{key:u,label:u},[(l(!0),i(C,null,N(o,d=>(l(),i("option",{key:d.id,value:d.id},c(d.displayName),9,it))),128))],8,lt))),128))],8,st),[[M,a.value.lollms_model_name]]),t[16]||(t[16]=e("p",{class:"mt-1 text-xs text-gray-500"},"The model the bot will use for all system-level generations.",-1))]),e("div",null,[t[18]||(t[18]=e("label",{for:"bot-personality",class:"block text-sm font-medium"},"Bot Personality",-1)),r(e("select",{id:"bot-personality","onUpdate:modelValue":t[2]||(t[2]=o=>a.value.active_personality_id=o),class:"input-field mt-1"},[t[17]||(t[17]=e("option",{value:""},"-- Use Default System Prompt --",-1)),(l(!0),i(C,null,N(D.value,o=>(l(),i("option",{key:o.id,value:o.id},c(o.name),9,nt))),128))],512),[[M,a.value.active_personality_id]]),t[19]||(t[19]=e("p",{class:"mt-1 text-xs text-gray-500"},"Select a personality to define the bot's behavior.",-1))]),a.value.active_personality_id?n("",!0):(l(),i("div",rt,[t[20]||(t[20]=e("label",{for:"bot-prompt",class:"block text-sm font-medium"},"Default System Prompt",-1)),r(e("textarea",{id:"bot-prompt","onUpdate:modelValue":t[3]||(t[3]=o=>a.value.ai_bot_system_prompt=o),rows:"3",class:"input-field mt-1"},null,512),[[_,a.value.ai_bot_system_prompt]])]))]),e("div",dt,[e("div",ut,[t[21]||(t[21]=e("h4",{class:"text-lg font-medium text-gray-900 dark:text-white"},"Moderation",-1)),a.value.ai_bot_moderation_enabled?(l(),i("button",{key:0,type:"button",onClick:O,disabled:v.value,class:"btn btn-warning btn-sm flex items-center gap-2"},[v.value?(l(),i("span",mt,"⌛")):n("",!0),F(" "+c(v.value?"Starting...":"Moderate All Old Content"),1)],8,bt)):n("",!0)]),e("div",_t,[t[22]||(t[22]=e("span",{class:"flex-grow flex flex-col"},[e("span",{class:"text-sm font-medium text-gray-900 dark:text-gray-100"},"Enable Moderation"),e("span",{class:"text-sm text-gray-500 dark:text-gray-400"},"Bot will scan new posts/comments and remove violations.")],-1)),e("button",{onClick:t[4]||(t[4]=o=>a.value.ai_bot_moderation_enabled=!a.value.ai_bot_moderation_enabled),type:"button",class:m([a.value.ai_bot_moderation_enabled?"bg-blue-600":"bg-gray-200 dark:bg-gray-600","relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out"])},[e("span",{class:m([a.value.ai_bot_moderation_enabled?"translate-x-5":"translate-x-0","pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out"])},null,2)],2)]),a.value.ai_bot_moderation_enabled?(l(),i("div",pt,[t[23]||(t[23]=e("label",{class:"block text-sm font-medium"},"Moderation Criteria",-1)),r(e("textarea",{"onUpdate:modelValue":t[5]||(t[5]=o=>a.value.ai_bot_moderation_criteria=o),rows:"3",class:"input-field mt-1",placeholder:"e.g. No hate speech, be polite..."},null,512),[[_,a.value.ai_bot_moderation_criteria]]),t[24]||(t[24]=e("p",{class:"mt-1 text-xs text-gray-500"},"The rules the AI will use to judge content.",-1))])):n("",!0)]),e("div",gt,[e("div",vt,[t[25]||(t[25]=e("h4",{class:"text-lg font-medium text-gray-900 dark:text-white"},"Auto-Posting Feed",-1)),a.value.ai_bot_auto_post?(l(),i("button",{key:0,type:"button",onClick:G,disabled:g.value,class:"btn btn-secondary btn-sm flex items-center gap-2"},[g.value?(l(),i("span",ct,"⌛")):n("",!0),F(" "+c(g.value?"Generating...":"Trigger Post Now"),1)],8,ft)):n("",!0)]),e("div",yt,[t[26]||(t[26]=e("span",{class:"flex-grow flex flex-col"},[e("span",{class:"text-sm font-medium text-gray-900 dark:text-gray-100"},"Enable Auto-Posting"),e("span",{class:"text-sm text-gray-500 dark:text-gray-400"},"The bot will post to the main feed periodically based on provided material.")],-1)),e("button",{onClick:t[6]||(t[6]=o=>a.value.ai_bot_auto_post=!a.value.ai_bot_auto_post),type:"button",class:m([a.value.ai_bot_auto_post?"bg-blue-600":"bg-gray-200 dark:bg-gray-600","relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out"])},[e("span",{class:m([a.value.ai_bot_auto_post?"translate-x-5":"translate-x-0","pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out"])},null,2)],2)]),a.value.ai_bot_auto_post?(l(),i("div",xt,[e("div",null,[t[27]||(t[27]=e("label",{class:"block text-sm font-medium"},"Posting Interval (Hours)",-1)),r(e("input",{type:"number","onUpdate:modelValue":t[7]||(t[7]=o=>a.value.ai_bot_post_interval=o),min:"1",step:"0.5",class:"input-field mt-1"},null,512),[[_,a.value.ai_bot_post_interval]])]),e("div",null,[t[29]||(t[29]=e("label",{class:"block text-sm font-medium"},"Content Source",-1)),r(e("select",{"onUpdate:modelValue":t[8]||(t[8]=o=>a.value.ai_bot_content_mode=o),class:"input-field mt-1"},t[28]||(t[28]=[e("option",{value:"static_text"},"Manual Text (Knowledge Base)",-1),e("option",{value:"rag"},"RAG Datastores",-1),e("option",{value:"file"},"File Path (Server Side)",-1)]),512),[[M,a.value.ai_bot_content_mode]])]),a.value.ai_bot_content_mode==="static_text"?(l(),i("div",kt,[t[30]||(t[30]=e("label",{class:"block text-sm font-medium"},"Knowledge Base Material",-1)),r(e("textarea",{"onUpdate:modelValue":t[9]||(t[9]=o=>a.value.ai_bot_static_content=o),rows:"6",class:"input-field mt-1",placeholder:"Paste interesting facts, news, or context here..."},null,512),[[_,a.value.ai_bot_static_content]])])):n("",!0),a.value.ai_bot_content_mode==="rag"?(l(),i("div",wt,[t[31]||(t[31]=e("label",{class:"block text-sm font-medium mb-1"},"Select Datastores",-1)),W(Q,{options:I.value.map(o=>({label:o.name,value:o.id})),modelValue:a.value.ai_bot_rag_datastore_ids,"onUpdate:modelValue":t[10]||(t[10]=o=>a.value.ai_bot_rag_datastore_ids=o),placeholder:"Choose datastores..."},null,8,["options","modelValue"]),t[32]||(t[32]=e("p",{class:"mt-1 text-xs text-gray-500"},"The bot will query these stores for content relevant to the generation prompt.",-1))])):n("",!0),a.value.ai_bot_content_mode==="file"?(l(),i("div",ht,[t[33]||(t[33]=e("label",{class:"block text-sm font-medium"},"Absolute File Path",-1)),r(e("input",{type:"text","onUpdate:modelValue":t[11]||(t[11]=o=>a.value.ai_bot_file_path=o),class:"input-field mt-1",placeholder:"/path/to/interesting_content.txt"},null,512),[[_,a.value.ai_bot_file_path]])])):n("",!0),e("div",null,[t[34]||(t[34]=e("label",{class:"block text-sm font-medium"},"Generation Prompt",-1)),r(e("textarea",{"onUpdate:modelValue":t[12]||(t[12]=o=>a.value.ai_bot_generation_prompt=o),rows:"3",class:"input-field mt-1"},null,512),[[_,a.value.ai_bot_generation_prompt]]),t[35]||(t[35]=e("p",{class:"mt-1 text-xs text-gray-500"},"Instructions for the AI on how to use the material to create a post.",-1))])])):n("",!0)])]),e("div",St,[e("div",At,[e("button",{type:"submit",class:"btn btn-primary",disabled:k.value||!h.value},c(k.value?"Saving...":"Save Settings"),9,Mt)])])],32)]))}};export{Vt as default};
