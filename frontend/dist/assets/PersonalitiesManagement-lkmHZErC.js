import{ad as ve,c7 as me,b_ as ye,a as fe,ae as ge,c1 as T,r as i,c as k,w as I,o as be,b as o,d as a,h as s,g as m,n as B,e as h,ce as F,j as M,k as ke,l as d,v as $,c2 as z,F as S,m as P,t as p,i as O,q as we,cf as G,P as _e,a5 as xe}from"./index-DnjdbnqE.js";import{A as he}from"./AppCard-CPvxpkmz.js";import{A as Se}from"./AppCardSkeleton-Did311VZ.js";import"./AdminView-B-2DgGxP.js";import"./PageViewLayout-3HT6v2az.js";import"./IconSquares2x2-D5sOEYFZ.js";import"./IconPlayCircle-CuCtO7Ea.js";import"./IconNoSymbol-BynFhtz6.js";const Pe={class:"space-y-6"},Re={class:"border-b border-gray-200 dark:border-gray-700"},Ce={class:"-mb-px flex space-x-6"},Ae={key:0},Ie={class:"flex justify-between items-center mb-4"},Me={class:"flex gap-2"},$e={class:"space-y-4"},Ue={class:"grid grid-cols-1 lg:grid-cols-4 gap-4"},Ve={class:"relative lg:col-span-1"},Ze={class:"grid grid-cols-1 sm:grid-cols-3 lg:col-span-3 gap-4"},Ne=["value"],Te=["value"],ze={key:0,class:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 2xl:grid-cols-4 gap-6"},qe={key:1,class:"empty-state-card"},De={key:2},Le={class:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 2xl:grid-cols-4 gap-6"},je={key:0,class:"flex justify-between items-center mt-6"},Ee=["disabled"],Be={class:"text-sm text-gray-600 dark:text-gray-400"},Fe=["disabled"],Oe={key:1},Ge={class:"flex justify-between items-center mb-4"},He={key:0,class:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm mb-6"},Je={class:"flex items-center gap-x-4"},We={key:0},Ke=["required"],Qe={key:1},Xe=["required"],Ye={key:1,class:"text-center p-4"},et={key:2,class:"empty-state-card"},tt={key:3,class:"space-y-4"},st={class:"font-semibold"},lt={class:"text-sm text-gray-500"},at={class:"text-xs text-gray-400"},ot={class:"flex items-center gap-2"},nt=["onClick"],it=["onClick"],rt={__name:"PersonalitiesManagement",setup(ut){const u=me(),H=ye(),v=fe(),U=ge(),{personalityZooRepositories:J,isLoadingPersonalityZooRepositories:W,zooPersonalities:R,isLoadingZooPersonalities:K}=T(u),{publicPersonalities:Q}=T(U),{tasks:X}=T(H),y=i("zoo"),n=i({type:"git",name:"",url:"",path:""}),w=i(!1),f=i(null),C=i(""),c=i("All"),_=i("All"),x=i("All"),q=i("name"),D=i("asc"),g=i(JSON.parse(localStorage.getItem("starredPersonalities")||"[]")),r=i(1),V=i(24);let L=null;const Z=k(()=>R.value.total||0),j=k(()=>R.value.pages||1),Y=k(()=>{if(Z.value===0)return"Showing 0-0 of 0";const l=(r.value-1)*V.value+1,e=Math.min(r.value*V.value,Z.value);return`Showing ${l}-${e} of ${Z.value}`});async function b(){const l={page:r.value,page_size:V.value,sort_by:q.value,sort_order:D.value,category:c.value!=="All"&&c.value!=="Starred"?c.value:void 0,repository:x.value!=="All"?x.value:void 0,search_query:C.value||void 0,installation_status:_.value!=="All"?_.value:void 0};c.value==="Starred"&&(l.starred_names=g.value),await u.fetchZooPersonalities(l)}const E=k(()=>{const l=new Map;return(X.value||[]).forEach(e=>{var t;if((t=e==null?void 0:e.name)!=null&&t.startsWith("Installing personality: ")&&(e.status==="running"||e.status==="pending")){const A=e.name.replace("Installing personality: ","");l.set(A,e)}}),(R.value.items||[]).map(e=>({...e,task:l.get(e.folder_name)||null}))});function ee(){clearTimeout(L),L=setTimeout(()=>{r.value=1,b()},300)}I([q,D,c,_,x],()=>{r.value=1,b()}),I(C,ee),I(r,b),I(g,l=>{localStorage.setItem("starredPersonalities",JSON.stringify(l)),c.value==="Starred"&&(r.value=1,b())},{deep:!0}),be(()=>{U.fetchPersonalities(),u.fetchPersonalityZooRepositories(),b()});const N=k(()=>[...J.value||[]].sort((l,e)=>(l.name||"").localeCompare(e.name||""))),te=k(()=>["All","Starred",...R.value.categories||[]]);function se(l){return l?new Date(l).toLocaleString():"Never"}async function le(){if(!n.value.name){v.addNotification("Repository name is required.","warning");return}const l={name:n.value.name};n.value.type==="git"?l.url=n.value.url:l.path=n.value.path,f.value="add";try{await u.addPersonalityZooRepository(l),n.value={type:"git",name:"",url:"",path:""},w.value=!1}finally{f.value=null}}async function ae(l){f.value=l.id;try{await u.pullPersonalityZooRepository(l.id)}finally{f.value=null}}async function oe(l){if(await v.showConfirmation({title:`Delete Repository '${l.name}'?`})){f.value=l.id;try{await u.deletePersonalityZooRepository(l.id)}finally{f.value=null}}}async function ne(l){await u.installZooPersonality({repository:l.repository,folder_name:l.folder_name})}async function ie(l){const e=Q.value.find(t=>t.name===l.name&&t.owner_username==="System");e&&await v.showConfirmation({title:`Uninstall '${l.name}'?`})&&(await U.deletePersonality(e.id),await b())}async function re(l){const e=await u.fetchPersonalityReadme(l.repository,l.folder_name);v.openModal("sourceViewer",{title:`README: ${l.name}`,content:e,language:"markdown"})}function ue(l){const e=g.value.indexOf(l);e>-1?g.value.splice(e,1):g.value.push(l)}function de(l=null){v.openModal("personalityEditor",{personality:l})}function ce(){v.openModal("generatePersonality")}async function pe(){const l=await u.refreshZooCache();l&&v.openModal("tasksManager",{initialTaskId:l.id})}return(l,e)=>(a(),o("div",Pe,[s("div",Re,[s("nav",Ce,[s("button",{onClick:e[0]||(e[0]=t=>y.value="zoo"),class:B(["tab-button",y.value==="zoo"?"active":"inactive"])},"Zoo",2),s("button",{onClick:e[1]||(e[1]=t=>y.value="source"),class:B(["tab-button",y.value==="source"?"active":"inactive"])},"Repositories",2)])]),y.value==="zoo"?(a(),o("section",Ae,[s("div",Ie,[e[16]||(e[16]=s("h3",{class:"text-xl font-semibold"},"Personality Zoo",-1)),s("div",Me,[s("button",{onClick:pe,class:"btn btn-secondary",title:"Refresh Zoo Cache from all sources"},[h(F,{class:"w-4 h-4"})]),s("button",{onClick:ce,class:"btn btn-secondary"},"Generate from Prompt"),s("button",{onClick:e[2]||(e[2]=t=>de()),class:"btn btn-primary"},[h(ke,{class:"w-4 h-4 mr-1"}),e[15]||(e[15]=M(" Create New"))])])]),s("div",$e,[s("div",Ue,[s("div",Ve,[d(s("input",{"onUpdate:modelValue":e[3]||(e[3]=t=>C.value=t),type:"text",placeholder:"Search Personalities...",class:"input-field w-full pl-10"},null,512),[[$,C.value]]),e[17]||(e[17]=s("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[s("svg",{class:"h-5 w-5 text-gray-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})])],-1))]),s("div",Ze,[d(s("select",{"onUpdate:modelValue":e[4]||(e[4]=t=>_.value=t),class:"input-field"},e[18]||(e[18]=[s("option",{value:"All"},"All Statuses",-1),s("option",{value:"Installed"},"Installed",-1),s("option",{value:"Uninstalled"},"Uninstalled",-1)]),512),[[z,_.value]]),d(s("select",{"onUpdate:modelValue":e[5]||(e[5]=t=>c.value=t),class:"input-field"},[(a(!0),o(S,null,P(te.value,t=>(a(),o("option",{key:t,value:t},p(t),9,Ne))),128))],512),[[z,c.value]]),d(s("select",{"onUpdate:modelValue":e[6]||(e[6]=t=>x.value=t),class:"input-field"},[e[19]||(e[19]=s("option",{value:"All"},"All Sources",-1)),(a(!0),o(S,null,P(N.value,t=>(a(),o("option",{key:t.id,value:t.name},p(t.name),9,Te))),128))],512),[[z,x.value]])])]),O(K)?(a(),o("div",ze,[(a(),o(S,null,P(8,t=>h(Se,{key:t})),64))])):E.value.length===0?(a(),o("div",qe,e[20]||(e[20]=[s("p",null,"No personalities found.",-1)]))):(a(),o("div",De,[s("div",Le,[(a(!0),o(S,null,P(E.value,t=>(a(),we(he,{key:`${t.repository}/${t.folder_name}`,app:t,task:t.task,"is-starred":g.value.includes(t.name),"item-type-name":"Personality",onStar:A=>ue(t.name),onInstall:ne,onUninstall:ie,onHelp:re},null,8,["app","task","is-starred","onStar"]))),128))]),j.value>1?(a(),o("div",je,[s("button",{onClick:e[7]||(e[7]=t=>r.value--),disabled:r.value===1,class:"btn btn-secondary"},"Previous",8,Ee),s("span",Be,p(Y.value),1),s("button",{onClick:e[8]||(e[8]=t=>r.value++),disabled:r.value>=j.value,class:"btn btn-secondary"},"Next",8,Fe)])):m("",!0)]))])])):m("",!0),y.value==="source"?(a(),o("section",Oe,[s("div",Ge,[e[21]||(e[21]=s("h3",{class:"text-xl font-semibold"},"Personality Zoo Repositories",-1)),s("button",{onClick:e[9]||(e[9]=t=>w.value=!w.value),class:"btn btn-primary"},p(w.value?"Cancel":"Add Repository"),1)]),w.value?(a(),o("div",He,[s("form",{onSubmit:_e(le,["prevent"]),class:"space-y-4"},[s("div",Je,[s("label",null,[d(s("input",{type:"radio","onUpdate:modelValue":e[10]||(e[10]=t=>n.value.type=t),value:"git",class:"radio-input"},null,512),[[G,n.value.type]]),e[22]||(e[22]=M(" Git"))]),s("label",null,[d(s("input",{type:"radio","onUpdate:modelValue":e[11]||(e[11]=t=>n.value.type=t),value:"local",class:"radio-input"},null,512),[[G,n.value.type]]),e[23]||(e[23]=M(" Local"))])]),s("div",null,[e[24]||(e[24]=s("label",null,"Name",-1)),d(s("input",{"onUpdate:modelValue":e[12]||(e[12]=t=>n.value.name=t),type:"text",class:"input-field",required:""},null,512),[[$,n.value.name]])]),n.value.type==="git"?(a(),o("div",We,[e[25]||(e[25]=s("label",null,"URL",-1)),d(s("input",{"onUpdate:modelValue":e[13]||(e[13]=t=>n.value.url=t),type:"url",class:"input-field",required:n.value.type==="git"},null,8,Ke),[[$,n.value.url]])])):m("",!0),n.value.type==="local"?(a(),o("div",Qe,[e[26]||(e[26]=s("label",null,"Path",-1)),d(s("input",{"onUpdate:modelValue":e[14]||(e[14]=t=>n.value.path=t),type:"text",class:"input-field",required:n.value.type==="local"},null,8,Xe),[[$,n.value.path]])])):m("",!0),e[27]||(e[27]=s("div",{class:"flex justify-end"},[s("button",{type:"submit",class:"btn btn-primary"},"Add")],-1))],32)])):m("",!0),O(W)?(a(),o("div",Ye,"Loading...")):N.value.length===0?(a(),o("div",et,e[28]||(e[28]=[s("p",null,"No repositories added.",-1)]))):(a(),o("div",tt,[(a(!0),o(S,null,P(N.value,t=>(a(),o("div",{key:t.id,class:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm flex items-center justify-between"},[s("div",null,[s("p",st,p(t.name),1),s("p",lt,p(t.url),1),s("p",at,"Pulled: "+p(se(t.last_pulled_at)),1)]),s("div",ot,[s("button",{onClick:A=>ae(t),class:"btn btn-secondary btn-sm"},[h(F,{class:"w-4 h-4 mr-1"}),M(p(t.type==="git"?"Pull":"Rescan"),1)],8,nt),t.is_deletable?(a(),o("button",{key:0,onClick:A=>oe(t),class:"btn btn-danger btn-sm"},[h(xe,{class:"w-4 h-4"})],8,it)):m("",!0)])]))),128))]))])):m("",!0)]))}},bt=ve(rt,[["__scopeId","data-v-d702d02e"]]);export{bt as default};
