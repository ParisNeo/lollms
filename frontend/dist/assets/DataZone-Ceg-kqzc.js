import{a4 as ve,cG as pe,a as $e,r as p,c as d,d as o,f as s,g as e,A as H,i as c,cC as Oe,t as E,h as U,L as He,I as Ze,j as q,y as Nt,F as Y,z as Q,C as V,bR as Bt,bS as lt,Q as Ce,cQ as rt,cp as Ot,R as it,s as ne,e as z,J as ct,B as we,bN as dt,x as le,m as S,bO as re,cR as Ht,cS as Xt,cT as ut,q as qt,D as Yt,b as Qt,u as ft,p as Jt,w as Ue,o as mt,E as Kt,G as es,cU as ts,a2 as ce,cI as ss,cV as vt,cW as pt,bU as nt,cX as gt,n as as,_ as os,cY as Be,v as de,H as Xe,bT as Le,k as ze,cZ as ns,c_ as Ee,c$ as ls,d0 as rs,N as is,d1 as cs}from"./index-B1TwNHE9.js";import{_ as ds}from"./LanguageSelector-D83TrWWc.js";import{useMemoriesStore as us}from"./memories-CpRGIbqy.js";const fs={class:"artefact-header"},ms={class:"artefact-info"},vs={class:"artefact-details"},ps=["title"],gs={class:"artefact-actions"},ys={class:"artefact-body"},hs={class:"w-full"},bs=["value"],xs={class:"grid grid-cols-2 gap-1 w-full mt-1.5"},ks={__name:"ArtefactCard",props:{artefactGroup:{type:Object,required:!0}},setup(W){var B;const n=W,u=pe(),k=$e(),y=p(((B=n.artefactGroup.versions[0])==null?void 0:B.version)||1),h=d(()=>n.artefactGroup.isAnyVersionLoaded),C=d(()=>u.promptLoadedArtefacts.has(n.artefactGroup.title)),b=d(()=>h.value?n.artefactGroup.versions.find(l=>l.is_loaded):null),T=d(()=>({"loaded-data-zone":h.value,"loaded-prompt":C.value&&!h.value}));async function R(){await u.loadArtefactToContext({discussionId:u.currentDiscussionId,artefactTitle:n.artefactGroup.title,version:y.value})}function $(){u.loadArtefactToPrompt({discussionId:u.currentDiscussionId,artefactTitle:n.artefactGroup.title,version:y.value})}async function I(){b.value&&await u.unloadArtefactFromContext({discussionId:u.currentDiscussionId,artefactTitle:n.artefactGroup.title,version:b.value.version})}function N(){u.unloadArtefactFromPrompt(n.artefactGroup.title)}async function L(){const l=await u.fetchArtefactContent({discussionId:u.currentDiscussionId,artefactTitle:n.artefactGroup.title,version:y.value});l&&k.openModal("artefactEditor",{artefact:l,discussionId:u.currentDiscussionId})}async function j(){await k.showConfirmation({title:`Delete Artefact '${n.artefactGroup.title}'?`,message:"This will permanently delete the artefact and all its versions.",confirmText:"Delete"})&&await u.deleteArtefact({discussionId:u.currentDiscussionId,artefactTitle:n.artefactGroup.title})}return(l,f)=>(s(),o("div",{class:H(["artefact-card group",T.value])},[e("div",fs,[e("div",ms,[e("div",{class:H(["artefact-icon",{"loaded-data-zone":h.value,"loaded-prompt":C.value}])},[c(Oe,{class:"w-4 h-4"})],2),e("div",vs,[e("h5",{class:"artefact-title",title:W.artefactGroup.title},E(W.artefactGroup.title),9,ps)])]),e("div",gs,[e("button",{onClick:U(L,["stop"]),class:"artefact-action-btn",title:"Edit Content"},[c(He,{class:"w-3 h-3"})]),e("button",{onClick:U(j,["stop"]),class:"artefact-action-btn artefact-action-btn-danger",title:"Delete Artefact"},[c(Ze,{class:"w-3 h-3"})])])]),e("div",ys,[e("div",hs,[q(e("select",{"onUpdate:modelValue":f[0]||(f[0]=m=>y.value=m),onClick:f[1]||(f[1]=U(()=>{},["stop"])),class:"version-select"},[(s(!0),o(Y,null,Q(W.artefactGroup.versions,m=>(s(),o("option",{key:m.version,value:m.version}," Version "+E(m.version),9,bs))),128))],512),[[Nt,y.value]])]),e("div",xs,[h.value?(s(),o("button",{key:1,onClick:U(I,["stop"]),class:"load-btn loaded-data-zone-btn",title:"Unload from Data Zone"},[c(lt,{class:"w-3 h-3"}),f[3]||(f[3]=V(" Unload DZ "))])):(s(),o("button",{key:0,onClick:U(R,["stop"]),class:"load-btn",title:"Load to Data Zone"},[c(Bt,{class:"w-3 h-3"}),f[2]||(f[2]=V(" Load DZ "))])),C.value?(s(),o("button",{key:3,onClick:U(N,["stop"]),class:"load-btn loaded-prompt-btn",title:"Unload from Prompt"},[c(rt,{class:"w-3 h-3"}),f[5]||(f[5]=V(" Unload PMPT "))])):(s(),o("button",{key:2,onClick:U($,["stop"]),class:"load-btn",title:"Load to Prompt"},[c(Ce,{class:"w-3 h-3"}),f[4]||(f[4]=V(" Load PMPT "))]))])])],2))}},_s=ve(ks,[["__scopeId","data-v-be9a61b1"]]),ws={},Cs={width:"800px",height:"800px",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function $s(W,n){return s(),o("svg",Cs,n[0]||(n[0]=[e("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M9.83824 18.4467C10.0103 18.7692 10.1826 19.0598 10.3473 19.3173C8.59745 18.9238 7.07906 17.9187 6.02838 16.5383C6.72181 16.1478 7.60995 15.743 8.67766 15.4468C8.98112 16.637 9.40924 17.6423 9.83824 18.4467ZM11.1618 17.7408C10.7891 17.0421 10.4156 16.1695 10.1465 15.1356C10.7258 15.0496 11.3442 15 12.0001 15C12.6559 15 13.2743 15.0496 13.8535 15.1355C13.5844 16.1695 13.2109 17.0421 12.8382 17.7408C12.5394 18.3011 12.2417 18.7484 12 19.0757C11.7583 18.7484 11.4606 18.3011 11.1618 17.7408ZM9.75 12C9.75 12.5841 9.7893 13.1385 9.8586 13.6619C10.5269 13.5594 11.2414 13.5 12.0001 13.5C12.7587 13.5 13.4732 13.5593 14.1414 13.6619C14.2107 13.1384 14.25 12.5841 14.25 12C14.25 11.4159 14.2107 10.8616 14.1414 10.3381C13.4732 10.4406 12.7587 10.5 12.0001 10.5C11.2414 10.5 10.5269 10.4406 9.8586 10.3381C9.7893 10.8615 9.75 11.4159 9.75 12ZM8.38688 10.0288C8.29977 10.6478 8.25 11.3054 8.25 12C8.25 12.6946 8.29977 13.3522 8.38688 13.9712C7.11338 14.3131 6.05882 14.7952 5.24324 15.2591C4.76698 14.2736 4.5 13.168 4.5 12C4.5 10.832 4.76698 9.72644 5.24323 8.74088C6.05872 9.20472 7.1133 9.68686 8.38688 10.0288ZM10.1465 8.86445C10.7258 8.95042 11.3442 9 12.0001 9C12.6559 9 13.2743 8.95043 13.8535 8.86447C13.5844 7.83055 13.2109 6.95793 12.8382 6.2592C12.5394 5.69894 12.2417 5.25156 12 4.92432C11.7583 5.25156 11.4606 5.69894 11.1618 6.25918C10.7891 6.95791 10.4156 7.83053 10.1465 8.86445ZM15.6131 10.0289C15.7002 10.6479 15.75 11.3055 15.75 12C15.75 12.6946 15.7002 13.3521 15.6131 13.9711C16.8866 14.3131 17.9412 14.7952 18.7568 15.2591C19.233 14.2735 19.5 13.1679 19.5 12C19.5 10.8321 19.233 9.72647 18.7568 8.74093C17.9413 9.20477 16.8867 9.6869 15.6131 10.0289ZM17.9716 7.46178C17.2781 7.85231 16.39 8.25705 15.3224 8.55328C15.0189 7.36304 14.5908 6.35769 14.1618 5.55332C13.9897 5.23077 13.8174 4.94025 13.6527 4.6827C15.4026 5.07623 16.921 6.08136 17.9716 7.46178ZM8.67765 8.55325C7.61001 8.25701 6.7219 7.85227 6.02839 7.46173C7.07906 6.08134 8.59745 5.07623 10.3472 4.6827C10.1826 4.94025 10.0103 5.23076 9.83823 5.5533C9.40924 6.35767 8.98112 7.36301 8.67765 8.55325ZM15.3224 15.4467C15.0189 16.637 14.5908 17.6423 14.1618 18.4467C13.9897 18.7692 13.8174 19.0598 13.6527 19.3173C15.4026 18.9238 16.921 17.9186 17.9717 16.5382C17.2782 16.1477 16.3901 15.743 15.3224 15.4467ZM12 21C16.9706 21 21 16.9706 21 12C21 7.02944 16.9706 3 12 3C7.02944 3 3 7.02944 3 12C3 16.9706 7.02944 21 12 21Z",fill:"currentColor"},null,-1)]))}const Is=ve(ws,[["render",$s]]),Ds={},Ts={width:"50px",height:"50px",stroke:"currentColor",viewBox:"0 0 64 64",version:"1.1","xml:space":"preserve",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"};function As(W,n){return s(),o("svg",Ts,n[0]||(n[0]=[Ot('<g id="Layer_1"></g><g id="Layer_2"><g><path d="M9.1,46.9c-3.3,0-6,2.7-6,6c0,3.3,2.7,6,6,6c3.3,0,6-2.7,6-6C15.1,49.6,12.4,46.9,9.1,46.9z M12,55.8    c-0.7,0.7-1.7,1.2-2.8,1.2c-1.1,0-2.1-0.4-2.8-1.2C5.6,55,5.1,54,5.1,52.9c0-1.1,0.4-2.1,1.2-2.8C7,49.4,8,48.9,9.1,48.9    c1.1,0,2.1,0.4,2.8,1.2c0.7,0.7,1.2,1.7,1.2,2.8C13.1,54,12.7,55,12,55.8z"></path><path d="M24.4,46.9c-3.3,0-6,2.7-6,6c0,3.3,2.7,6,6,6c3.3,0,6-2.7,6-6C30.4,49.6,27.7,46.9,24.4,46.9z M27.2,55.8    c-0.7,0.7-1.7,1.2-2.8,1.2c-1.1,0-2.1-0.4-2.8-1.2c-0.7-0.7-1.2-1.7-1.2-2.8c0-1.1,0.4-2.1,1.2-2.8c0.7-0.7,1.7-1.2,2.8-1.2    c1.1,0,2.1,0.4,2.8,1.2c0.7,0.7,1.2,1.7,1.2,2.8C28.4,54,27.9,55,27.2,55.8z"></path><path d="M39.6,46.9c-3.3,0-6,2.7-6,6c0,3.3,2.7,6,6,6c3.3,0,6-2.7,6-6C45.6,49.6,42.9,46.9,39.6,46.9z M42.5,55.8    c-0.7,0.7-1.7,1.2-2.8,1.2c-1.1,0-2.1-0.4-2.8-1.2c-0.7-0.7-1.2-1.7-1.2-2.8c0-1.1,0.4-2.1,1.2-2.8c0.7-0.7,1.7-1.2,2.8-1.2    c1.1,0,2.1,0.4,2.8,1.2c0.7,0.7,1.2,1.7,1.2,2.8C43.6,54,43.2,55,42.5,55.8z"></path><path d="M22.9,39c0-3.3-2.7-6-6-6c-3.3,0-6,2.7-6,6c0,3.3,2.7,6,6,6C20.2,45,22.9,42.3,22.9,39z M19.7,41.8C19,42.5,18,43,16.9,43    c-1.1,0-2.1-0.4-2.8-1.2c-0.7-0.7-1.2-1.7-1.2-2.8c0-1.1,0.4-2.1,1.2-2.8c0.7-0.7,1.7-1.2,2.8-1.2c1.1,0,2.1,0.4,2.8,1.2    c0.7,0.7,1.2,1.7,1.2,2.8C20.9,40.1,20.4,41.1,19.7,41.8z"></path><path d="M38.1,39c0-3.3-2.7-6-6-6c-3.3,0-6,2.7-6,6c0,3.3,2.7,6,6,6C35.4,45,38.1,42.3,38.1,39z M35,41.8    c-0.7,0.7-1.7,1.2-2.8,1.2c-1.1,0-2.1-0.4-2.8-1.2c-0.7-0.7-1.2-1.7-1.2-2.8c0-1.1,0.4-2.1,1.2-2.8C30,35.4,31,35,32.1,35    c1.1,0,2.1,0.4,2.8,1.2c0.7,0.7,1.2,1.7,1.2,2.8C36.1,40.1,35.7,41.1,35,41.8z"></path><path d="M53.4,39c0-3.3-2.7-6-6-6c-3.3,0-6,2.7-6,6c0,3.3,2.7,6,6,6C50.7,45,53.4,42.3,53.4,39z M50.2,41.8    c-0.7,0.7-1.7,1.2-2.8,1.2c-1.1,0-2.1-0.4-2.8-1.2c-0.7-0.7-1.2-1.7-1.2-2.8c0-1.1,0.4-2.1,1.2-2.8c0.7-0.7,1.7-1.2,2.8-1.2    c1.1,0,2.1,0.4,2.8,1.2c0.7,0.7,1.2,1.7,1.2,2.8C51.4,40.1,50.9,41.1,50.2,41.8z"></path><path d="M24.5,31c3.3,0,6-2.7,6-6c0-3.3-2.7-6-6-6c-3.3,0-6,2.7-6,6C18.5,28.3,21.2,31,24.5,31z M21.7,22.2    c0.7-0.7,1.7-1.2,2.8-1.2c1.1,0,2.1,0.4,2.8,1.2c0.7,0.7,1.2,1.7,1.2,2.8c0,1.1-0.4,2.1-1.2,2.8c-0.7,0.7-1.7,1.2-2.8,1.2    c-1.1,0-2.1-0.4-2.8-1.2c-0.7-0.7-1.2-1.7-1.2-2.8C20.5,23.9,20.9,22.9,21.7,22.2z"></path><path d="M33.8,25c0,3.3,2.7,6,6,6c3.3,0,6-2.7,6-6c0-3.3-2.7-6-6-6C36.4,19,33.8,21.7,33.8,25z M36.9,22.2    c0.7-0.7,1.7-1.2,2.8-1.2c1.1,0,2.1,0.4,2.8,1.2c0.7,0.7,1.2,1.7,1.2,2.8c0,1.1-0.4,2.1-1.2,2.8c-0.7,0.7-1.7,1.2-2.8,1.2    c-1.1,0-2.1-0.4-2.8-1.2c-0.7-0.7-1.2-1.7-1.2-2.8C35.8,23.9,36.2,22.9,36.9,22.2z"></path><path d="M32.1,17.1c3.3,0,6-2.7,6-6c0-3.3-2.7-6-6-6c-3.3,0-6,2.7-6,6C26.1,14.4,28.8,17.1,32.1,17.1z M29.3,8.2    C30,7.5,31,7.1,32.1,7.1c1.1,0,2.1,0.4,2.8,1.2c0.7,0.7,1.2,1.7,1.2,2.8c0,1.1-0.4,2.1-1.2,2.8c-0.7,0.7-1.7,1.2-2.8,1.2    c-1.1,0-2.1-0.4-2.8-1.2c-0.7-0.7-1.2-1.7-1.2-2.8C28.1,10,28.6,9,29.3,8.2z"></path><path d="M54.9,46.9c-3.3,0-6,2.7-6,6c0,3.3,2.7,6,6,6c3.3,0,6-2.7,6-6C60.9,49.6,58.2,46.9,54.9,46.9z M57.7,55.8    c-0.7,0.7-1.7,1.2-2.8,1.2c-1.1,0-2.1-0.4-2.8-1.2c-0.7-0.7-1.2-1.7-1.2-2.8c0-1.1,0.4-2.1,1.2-2.8c0.7-0.7,1.7-1.2,2.8-1.2    c1.1,0,2.1,0.4,2.8,1.2c0.7,0.7,1.2,1.7,1.2,2.8C58.9,54,58.4,55,57.7,55.8z"></path></g></g>',2)]))}const Ms=ve(Ds,[["render",As]]),Ss={key:0,class:"absolute inset-0 bg-blue-500/20 border-2 border-dashed border-blue-500 rounded-lg z-10 flex items-center justify-center"},Ps={class:"flex justify-between items-center mb-2 flex-shrink-0"},zs=["disabled"],Ls=["disabled"],Es={key:1,class:"flex-grow flex flex-col min-h-0"},Zs={class:"flex-grow min-h-0 overflow-y-auto custom-scrollbar"},Us={key:"artefacts-loading",class:"loading-state"},Rs={key:"artefacts-empty",class:"flex flex-col items-center justify-center h-full text-center p-4 bg-gray-50 dark:bg-gray-800/50 rounded"},Fs={key:"artefacts-list",class:"artefacts-list space-y-2"},Vs={__name:"ArtefactZone",setup(W){const n=pe(),u=$e();it();const{activeDiscussionArtefacts:k,isLoadingArtefacts:y}=ne(n),h=p(!1),C=p(!1),b=p(null),T=p(null),R=p(!1),$=d(()=>n.activeDiscussion),I=d(()=>{if(!k.value||!Array.isArray(k.value))return[];const g=k.value.reduce((i,D)=>(D&&D.title&&(i[D.title]||(i[D.title]={title:D.title,versions:[]}),i[D.title].versions.push(D)),i),{});return Object.values(g).forEach(i=>{i.versions.sort((D,ee)=>ee.version-D.version),i.isAnyVersionLoaded=i.versions.some(D=>D.is_loaded)}),Object.values(g)});function N(){$.value&&n.fetchArtefacts($.value.id)}async function L(){if(!$.value)return;(await u.showConfirmation({title:"Load All Artefacts?",message:`This will clear the current Discussion Data Zone and load all ${I.value.length} artefact(s).`,confirmText:"Load All"})).confirmed&&n.loadAllArtefactsToDataZone($.value.id)}function j(){$.value&&u.openModal("artefactEditor",{discussionId:$.value.id})}function B(){var g;(g=b.value)==null||g.click()}function l(){var g;(g=T.value)==null||g.click()}function f(){const g=prompt("Please enter the URL to import:");g&&$.value&&n.importArtefactFromUrl($.value.id,g)}async function m(g){const i=Array.from(g.target.files||[]);if(!i.length||!$.value)return;const D=["application/pdf","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.openxmlformats-officedocument.presentationml.presentation"],ee=[".pdf",".docx",".pptx",".msg"],J=[];for(const Z of i){let te=!0;const A=`.${Z.name.split(".").pop()}`.toLowerCase();(D.includes(Z.type)||ee.includes(A))&&(te=(await u.showConfirmation({title:`Extract Images from ${Z.name}?`,message:'This file may contain images. Do you want to extract and add them to the discussion context? Choosing "Text Only" may be faster.',confirmText:"Yes, Extract Images",cancelText:"No, Text Only"})).confirmed),J.push({file:Z,extractImages:te})}if(J.length!==0){h.value=!0;try{await Promise.all(J.map(({file:Z,extractImages:te})=>n.addArtefact({discussionId:$.value.id,file:Z,extractImages:te})))}finally{h.value=!1,b.value&&(b.value.value=""),T.value&&(T.value.value="")}}}function _(g){g.currentTarget.contains(g.relatedTarget)||(R.value=!1)}async function P(g){R.value=!1,g.preventDefault(),g.stopPropagation();const i=g.dataTransfer.items,D=[];function ee(A){return new Promise((M,X)=>{A.readEntries(M,X)})}async function J(A){const M=A.createReader();let X=[],oe;do oe=await ee(M),X=X.concat(oe);while(oe.length>0);return X}async function Z(A){if(A.isFile)await new Promise((M,X)=>A.file(oe=>{D.push(oe),M()},X));else if(A.isDirectory){const M=await J(A);for(const X of M)await Z(X)}}const te=[];for(let A=0;A<i.length;A++){const M=i[A].webkitGetAsEntry();M&&te.push(Z(M))}await Promise.all(te),D.length&&await m({target:{files:D}})}return(g,i)=>(s(),o("div",{onDragover:i[2]||(i[2]=U(D=>R.value=!0,["prevent"])),onDragleave:U(_,["prevent"]),onDrop:U(P,["prevent"]),class:"p-2 flex flex-col min-h-0 flex-grow relative"},[e("input",{type:"file",ref_key:"artefactFileInput",ref:b,onChange:m,multiple:"",class:"hidden",accept:".pdf,.docx,.pptx,.xlsx,.msg,.vcf,.txt,.md,.py,.js,.ts,.html,.css,.c,.cpp,.h,.hpp,.cs,.java,.json,.xml,.sh,.vhd,.v,.rb,.php,.go,.rs,.swift,.kt,.yaml,.yml,.sql,.log,.csv,image/png,image/jpeg,image/gif,image/webp,image/bmp,image/tiff"},null,544),e("input",{type:"file",ref_key:"artefactFolderInput",ref:T,onChange:m,webkitdirectory:"",directory:"",multiple:"",class:"hidden"},null,544),R.value?(s(),o("div",Ss,i[3]||(i[3]=[e("p",{class:"font-semibold text-blue-600"},"Drop files or folders to upload",-1)]))):z("",!0),e("div",Ps,[e("button",{onClick:i[0]||(i[0]=D=>C.value=!C.value),class:"flex items-center gap-2 text-sm font-semibold w-full text-left"},[c(Oe,{class:"w-4 h-4"}),i[4]||(i[4]=V()),i[5]||(i[5]=e("span",null,"Artefacts",-1)),c(ct,{class:H(["w-4 h-4 ml-auto transition-transform",{"rotate-90":!C.value}])},null,8,["class"])]),e("div",{onClick:i[1]||(i[1]=U(()=>{},["stop"])),class:"flex items-center gap-1"},[c(ut,{icon:"menu",buttonClass:"btn-icon-flat",title:"Artefact Actions"},{default:we(()=>[e("button",{onClick:N,class:"menu-item"},[c(dt,{class:H(["w-4 h-4 mr-2",{"animate-spin":le(y)}])},null,8,["class"]),i[6]||(i[6]=e("span",null,"Refresh Artefacts",-1))]),e("button",{onClick:L,class:"menu-item"},[c(Ms,{class:"w-4 h-4 mr-2"}),i[7]||(i[7]=e("span",null,"Load All to Context",-1))]),i[12]||(i[12]=e("div",{class:"menu-divider"},null,-1)),e("button",{onClick:j,class:"menu-item"},[c(He,{class:"w-4 h-4 mr-2"}),i[8]||(i[8]=e("span",null,"Create Manual",-1))]),e("button",{onClick:f,class:"menu-item"},[c(Is,{class:"w-4 h-4 mr-2"}),i[9]||(i[9]=e("span",null,"Import from URL",-1))]),e("button",{onClick:B,class:"menu-item",disabled:h.value},[h.value?(s(),S(re,{key:0,class:"w-4 h-4 mr-2"})):(s(),S(Ht,{key:1,class:"w-4 h-4 mr-2"})),i[10]||(i[10]=e("span",null,"Upload File(s)",-1))],8,zs),e("button",{onClick:l,class:"menu-item",disabled:h.value},[h.value?(s(),S(re,{key:0,class:"w-4 h-4 mr-2"})):(s(),S(Xt,{key:1,class:"w-4 h-4 mr-2"})),i[11]||(i[11]=e("span",null,"Upload Folder",-1))],8,Ls)]),_:1})])]),C.value?z("",!0):(s(),o("div",Es,[e("div",Zs,[le(y)?(s(),o("div",Us,[c(re,{class:"w-6 h-6 text-gray-400 animate-spin mx-auto mb-2"}),i[13]||(i[13]=e("p",{class:"text-xs text-gray-500"},"Loading...",-1))])):I.value.length===0?(s(),o("div",Rs,[c(Oe,{class:"w-10 h-10 text-gray-400 mb-2"}),i[15]||(i[15]=e("p",{class:"text-xs text-gray-500 mb-3"},"No artefacts yet",-1)),e("button",{onClick:B,class:"btn btn-secondary btn-sm"},[c(Ce,{class:"w-3 h-3 mr-1"}),i[14]||(i[14]=V("Add Artefact"))])])):(s(),o("div",Fs,[(s(!0),o(Y,null,Q(I.value,D=>(s(),S(_s,{key:D.title,"artefact-group":D},null,8,["artefact-group"]))),128))]))])]))],32))}},js={},Gs={xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"};function Ws(W,n){return s(),o("svg",Gs,n[0]||(n[0]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M3 10h10a8 8 0 018 8v2M3 10l4-4m-4 4l4 4"},null,-1)]))}const Ns=ve(js,[["render",Ws]]),Bs={},Os={xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"};function Hs(W,n){return s(),o("svg",Os,n[0]||(n[0]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M21 10h-10a8 8 0 00-8 8v2m18-10l-4-4m4 4l-4 4"},null,-1)]))}const Xs=ve(Bs,[["render",Hs]]),qs={class:"flex-1 flex flex-col min-h-0"},Ys={key:0,class:"px-3 pt-2 pb-1 border-b border-gray-200 dark:border-gray-700 relative group flex-shrink-0"},Qs={class:"flex items-center gap-2 text-xs text-gray-600 dark:text-gray-400 font-mono"},Js={class:"flex items-center gap-1.5 flex-shrink-0"},Ks=["title"],ea=["title"],ta=["title"],sa=["title"],aa={class:"flex-shrink-0 pl-2"},oa={class:"absolute bottom-full left-0 mb-2 w-auto p-2 bg-white dark:bg-gray-900 border dark:border-gray-600 rounded-lg shadow-lg text-xs opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none z-10"},na={class:"flex flex-wrap gap-1"},la=["title"],ra={class:"flex-grow flex min-h-0"},ia={class:"flex-grow flex min-h-0"},ca={key:0,class:"absolute inset-2 bg-blue-500/20 border-2 border-dashed border-blue-500 rounded-lg z-10 flex items-center justify-center pointer-events-none"},da={class:"flex-shrink-0 px-1 pb-2 flex items-center justify-between gap-4"},ua={class:"flex items-center gap-1"},fa=["disabled"],ma=["disabled"],va=["disabled"],pa=["disabled"],ga=["disabled"],ya=["disabled"],ha={class:"flex-grow min-h-0 border dark:border-gray-700 rounded-md overflow-hidden"},ba={class:"p-2 border-b dark:border-gray-700 flex flex-col max-h-[50%] min-h-0"},xa={class:"flex justify-between items-center mb-2 flex-shrink-0"},ka=["disabled"],_a=["disabled"],wa={key:0,class:"overflow-y-auto custom-scrollbar min-h-0"},Ca={key:0,class:"text-center py-4 text-xs text-gray-500 bg-gray-50 dark:bg-gray-800/50 rounded"},$a={key:1,class:"image-grid"},Ia=["src"],Da={class:"image-overlay"},Ta=["onClick"],Aa=["onClick","title"],Ma=["onClick"],Sa={class:"flex-shrink-0 p-2 border-t border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800/50"},Pa={key:0,class:"p-2 space-y-2"},za={key:0},La={class:"flex justify-between items-center text-xs font-semibold"},Ea={class:"text-gray-600 dark:text-gray-300"},Za={class:"font-mono text-gray-500 dark:text-gray-400"},Ua={class:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-1.5"},Ra=["title"],Fa={key:1,class:"flex items-center space-x-3 h-[42px]"},Va={key:1,class:"relative flex items-center"},ja=["onClick"],Ga={class:"truncate"},Wa={class:"p-2 sticky top-0 bg-white dark:bg-gray-800 z-10"},Na={class:"max-h-60 overflow-y-auto"},Ba={class:"category-header"},Oa=["onClick"],Ha=["src"],Xa={class:"truncate"},qa={class:"p-2 sticky top-0 bg-white dark:bg-gray-800 z-10"},Ya={class:"max-h-60 overflow-y-auto"},Qa={class:"category-header"},Ja=["onClick"],Ka=["src"],eo={class:"truncate"},to={key:3,class:"my-1 border-t dark:border-gray-600"},so={class:"absolute right-1.5 top-1/2 -translate-y-1/2 flex items-center gap-2"},ao=["disabled","title"],oo={key:2,class:"ml-2 text-sm"},no=["disabled","title"],lo={key:2,class:"ml-2 text-sm"},ro={__name:"DiscussionZone",setup(W){const n=pe(),u=$e(),k=qt(),y=Yt(),h=Qt(),C=it(),{on:b,off:T}=Kt(),R=ft(),{promptLoadedArtefacts:$,activeDiscussionContextStatus:I,dataZonesTokensFromContext:N,currentModelVisionSupport:L}=ne(n),{lollmsPrompts:j,systemPromptsByZooCategory:B,userPromptsByCategory:l}=ne(y),{availableTtiModels:f}=ne(k),{tasks:m}=ne(h),_=p(null),P=p(!1),g=p(!1),i=p(384),D=p(!1),ee=p(null),J=p(!1),Z=p(""),te=p(null),A=p([]),M=p(-1);let X=null,oe=null;const Ie=p(""),Re=p(""),De=p(!1),x=d(()=>n.activeDiscussion),ae=d({get:()=>{var t;return((t=x.value)==null?void 0:t.discussion_data_zone)||""},set:t=>{x.value&&(n.setDiscussionDataZoneContent(x.value.id,t),clearTimeout(oe),oe=setTimeout(()=>{x.value&&Jt.put(`/api/discussions/${x.value.id}/data_zone`,{content:t}).then(()=>{n.fetchContextStatus(x.value.id)}).catch(a=>{console.error("Failed to save data zone content:",a),u.addNotification("Failed to auto-save data zone.","error")})},1500))}}),ue=d(()=>{var t;return((t=x.value)==null?void 0:t.discussion_images)||[]}),Fe=d(()=>{var t;return((t=x.value)==null?void 0:t.active_discussion_images)||[]}),Te=d(()=>{var t;return x.value&&((t=n.activeAiTasks[x.value.id])==null?void 0:t.type)==="summarize"}),Ae=d(()=>{var t;return x.value&&((t=n.activeAiTasks[x.value.id])==null?void 0:t.type)==="generate_image"}),O=d(()=>{if(!x.value)return!1;const t=n.activeAiTasks[x.value.id];if(!t||!t.taskId)return!1;const a=m.value.find(r=>r.id===t.taskId);return a?a.status==="running"||a.status==="pending":!1}),fe=d(()=>{if(!x.value)return null;const t=n.activeAiTasks[x.value.id];return!t||!t.taskId?null:m.value.find(a=>a.id===t.taskId)}),yt=d(()=>f.value.length>0),qe=d(()=>M.value>0),Ye=d(()=>M.value<A.value.length-1),Qe=d(()=>R.user),ge=d(()=>n.activeDiscussionContextStatus),ht=d(()=>{var t,a;return((t=Qe.value)==null?void 0:t.show_token_counter)&&((a=Qe.value)==null?void 0:a.user_ui_level)>=2&&ge.value}),Ve=d(()=>{var t;return((t=ge.value)==null?void 0:t.max_tokens)||1}),ye=d(()=>{var t,a,r,v,w;return((w=(v=(r=(a=(t=ge.value)==null?void 0:t.zones)==null?void 0:a.system_context)==null?void 0:r.breakdown)==null?void 0:v.system_prompt)==null?void 0:w.tokens)||0}),he=d(()=>N.value),be=d(()=>{var t,a,r,v;return((v=(r=(a=(t=ge.value)==null?void 0:t.zones)==null?void 0:a.message_history)==null?void 0:r.breakdown)==null?void 0:v.text_tokens)||0}),xe=d(()=>{var t,a,r,v;return((v=(r=(a=(t=ge.value)==null?void 0:t.zones)==null?void 0:a.message_history)==null?void 0:r.breakdown)==null?void 0:v.image_tokens)||0}),Je=d(()=>ye.value+he.value+be.value+xe.value),ke=t=>Ve.value>0?t/Ve.value*100:0,bt=d(()=>{const t=[];return ye.value>0&&t.push({label:"S",value:ye.value,title:"System Prompt",colorClass:"bg-blue-100 dark:bg-blue-900/50"}),he.value>0&&t.push({label:"D",value:he.value,title:"Data Zones",colorClass:"bg-yellow-100 dark:bg-yellow-900/50"}),be.value>0&&t.push({label:"H",value:be.value,title:"History (Text)",colorClass:"bg-green-100 dark:bg-green-900/50"}),xe.value>0&&t.push({label:"I",value:xe.value,title:"History (Images)",colorClass:"bg-teal-100 dark:bg-teal-900/50"}),t.length===0&&t.push({label:"Empty",value:0,title:"Empty context",colorClass:"bg-gray-100 dark:bg-gray-900/50"}),t}),Me=d(()=>ke(ye.value)),je=d(()=>ke(he.value)),Ke=d(()=>ke(be.value)),xt=d(()=>ke(xe.value)),_e=d(()=>ke(Je.value)),kt=d(()=>{const t=_e.value;return t>=90?"border-red-500 dark:border-red-400":t>=75?"border-yellow-500 dark:border-yellow-400":"border-gray-300 dark:border-gray-600"}),_t=d(()=>_e.value>90),wt=d(()=>_e.value>100?"Context limit exceeded! The model may not see all of your message.":_e.value>90?"You are approaching the context limit. Consider shortening your message or data zones.":"");function Ct(){x.value&&u.openModal("contextViewer")}const Ge=d(()=>{if(!Array.isArray(j.value))return[];const t=Ie.value.toLowerCase();return t?j.value.filter(a=>a.name.toLowerCase().includes(t)):j.value}),et=d(()=>{const t=Ie.value.toLowerCase(),a=l.value;if(!a||typeof a!="object")return{};if(!t)return a;const r={};for(const v in a){const w=a[v].filter(se=>se.name.toLowerCase().includes(t));w.length>0&&(r[v]=w)}return r}),tt=d(()=>{const t=Re.value.toLowerCase(),a=B.value;if(!a||typeof a!="object")return{};if(!t)return a;const r={};for(const v in a){const w=a[v].filter(se=>se.name.toLowerCase().includes(t));w.length>0&&(r[v]=w)}return r});function $t(t){_.value=t.view}function We(t){const a=r=>{Z.value=r,Le(()=>{var v;return(v=te.value)==null?void 0:v.focus()})};/@<.*?>@/g.test(t)?u.openModal("fillPlaceholders",{promptTemplate:t,onConfirm:r=>a(r)}):a(t)}function It(t){A.value=[t],M.value=0}function Dt(t){clearTimeout(X),X=setTimeout(()=>{A.value[M.value]!==t&&(M.value<A.value.length-1&&A.value.splice(M.value+1),A.value.push(t),M.value++)},750)}async function Tt(){qe.value&&(P.value=!0,M.value--,ae.value=A.value[M.value],await Le(),P.value=!1)}async function At(){Ye.value&&(P.value=!0,M.value++,ae.value=A.value[M.value],await Le(),P.value=!1)}Ue(ae,(t,a)=>{!P.value&&t!==a&&Dt(t)},{flush:"post"}),Ue(x,(t,a)=>{t&&(!a||t.id!==a.id)&&(t.discussion_data_zone===void 0&&n.refreshDataZones(t.id),It(t.discussion_data_zone||""))},{immediate:!0,deep:!0});function Mt(t){D.value=!0;const a=t.clientX,r=i.value;document.body.style.cursor="col-resize",document.body.style.userSelect="none";function v(se){var G;if(!D.value)return;const Se=se.clientX-a,me=r-Se,F=(((G=document.querySelector(".flex-grow.flex.min-h-0"))==null?void 0:G.clientWidth)||window.innerWidth)*.75;i.value=Math.min(me,F)}function w(){D.value=!1,document.body.style.cursor="",document.body.style.userSelect="",window.removeEventListener("mousemove",v),window.removeEventListener("mouseup",w),localStorage.setItem("lollms_artefactListWidth",i.value)}window.addEventListener("mousemove",v),window.addEventListener("mouseup",w)}function St(){x.value&&n.cloneDiscussion(x.value.id)}function Pt(){x.value&&u.openModal("contextToArtefact")}function zt(){x.value&&n.refreshDataZones(x.value.id)}async function Lt(){(await u.showConfirmation({title:`Delete All ${ue.value.length} Images?`,message:"This will remove all images from this discussion's context. This action cannot be undone.",confirmText:"Delete All"})).confirmed&&n.deleteAllDiscussionImages()}function Et(){var t;(t=ee.value)==null||t.click()}async function Zt(t){const a=Array.from(t.target.files);if(!(!a.length||!x.value)){J.value=!0;try{await Promise.all(a.map(r=>n.uploadDiscussionImage(r)))}finally{J.value=!1,ee.value&&(ee.value.value="")}}}function Ut(){x.value&&n.summarizeDiscussionDataZone(x.value.id,Z.value)}function Rt(){if(!x.value)return;let t=Z.value.trim()||ae.value.trim();if(!t){u.addNotification("Please provide a prompt to generate an image.","warning");return}n.generateImageFromDataZone(x.value.id,t)}function Ft(){C.push({path:"/settings",query:{tab:"prompts"}})}function Ne(t){return!Fe.value||Fe.value.length<=t||Fe.value[t]}function st(t){Z.value=t}function at(){$.value.size===0&&(Z.value="")}function ot(t){Z.value=""}function Vt(t){u.openImageViewer({imageList:ue.value.map(a=>({src:`data:image/png;base64,${a}`,prompt:"Image from Data Zone"})),startIndex:t})}function jt(t){t.currentTarget.contains(t.relatedTarget)||(De.value=!1)}async function Gt(t){De.value=!1;const a=t.dataTransfer.items,r=[];function v(F){return new Promise((G,K)=>{F.readEntries(G,K)})}async function w(F){const G=F.createReader();let K=[],ie;do ie=await v(G),K=K.concat(ie);while(ie.length>0);return K}async function se(F){if(F.isFile)await new Promise((G,K)=>F.file(ie=>{r.push(ie),G()},K));else if(F.isDirectory){const G=await w(F);for(const K of G)await se(K)}}const Se=[];for(let F=0;F<a.length;F++){const G=a[F].webkitGetAsEntry();G&&Se.push(se(G))}await Promise.all(Se);const me=r;if(me.length>0&&x.value){u.addNotification(`Processing ${me.length} file(s)...`,"info");let F=L.value;const G=["application/pdf","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.openxmlformats-officedocument.presentationml.presentation"],K=[".pdf",".docx",".pptx",".msg"],ie=me.some(Pe=>{const Wt=`.${Pe.name.split(".").pop()}`.toLowerCase();return G.includes(Pe.type)||K.includes(Wt)});if(L.value&&ie){const{confirmed:Pe}=await u.showConfirmation({title:"Extract Images?",message:"Some of the dropped files may contain images. Do you want to extract them? This may take longer.",confirmText:"Yes, Extract Images",cancelText:"No, Text Only"});F=Pe}await n.uploadAndEmbedFilesToDataZone(x.value.id,me,F)}}return mt(()=>{const t=localStorage.getItem("lollms_artefactListWidth");t&&(i.value=parseInt(t,10)),b("artefact:load-to-prompt",st),b("artefact:unload-from-prompt",at),b("discussion_zone:processed",ot)}),es(()=>{T("artefact:load-to-prompt",st),T("artefact:unload-from-prompt",at),T("discussion_zone:processed",ot)}),(t,a)=>(s(),o("div",qs,[ht.value?(s(),o("div",Ys,[e("div",Qs,[e("div",Js,[c(ts,{class:"w-4 h-4 flex-shrink-0"}),e("button",{onClick:Ct,class:"cursor-pointer hover:underline flex-shrink-0",title:"View full context breakdown"},"Context:")]),e("div",{class:H(["flex-grow w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2 relative overflow-hidden border transition-colors duration-300",kt.value])},[e("div",{class:"progress-segment bg-blue-500",style:ce({width:`${Me.value}%`}),title:`System Prompt: ${ye.value.toLocaleString()} tokens`},null,12,Ks),e("div",{class:"progress-segment bg-yellow-500",style:ce({left:`${Me.value}%`,width:`${je.value}%`}),title:`Data Zones: ${he.value.toLocaleString()} tokens`},null,12,ea),e("div",{class:"progress-segment bg-green-500",style:ce({left:`${Me.value+je.value}%`,width:`${Ke.value}%`}),title:`History (Text): ${be.value.toLocaleString()} tokens`},null,12,ta),e("div",{class:"progress-segment bg-teal-500",style:ce({left:`${Me.value+je.value+Ke.value}%`,width:`${xt.value}%`}),title:`History (Images): ${xe.value.toLocaleString()} tokens`},null,12,sa)],2),e("span",aa,E(Je.value.toLocaleString())+" / "+E(Ve.value.toLocaleString()),1)]),_t.value?(s(),o("p",{key:0,class:H(["mt-1.5 text-xs text-center",_e.value>100?"text-red-600 dark:text-red-400":"text-yellow-600 dark:text-yellow-400"])},E(wt.value),3)):z("",!0),e("div",oa,[a[10]||(a[10]=e("h4",{class:"font-bold mb-1 whitespace-nowrap"},"Context Breakdown",-1)),e("div",na,[(s(!0),o(Y,null,Q(bt.value,r=>(s(),o("span",{title:`${r.title}: ${r.value.toLocaleString()} tokens`,class:H(["px-1.5 py-0.5 rounded",r.colorClass])},E(r.label)+": "+E(r.value.toLocaleString()),11,la))),256))])])])):z("",!0),e("div",ra,[e("input",{type:"file",ref_key:"discussionImageInput",ref:ee,onChange:Zt,class:"hidden",accept:"image/*,application/pdf",multiple:""},null,544),e("div",ia,[e("div",{onDragover:a[2]||(a[2]=U(r=>De.value=!0,["prevent"])),onDragleave:U(jt,["prevent"]),onDrop:U(Gt,["prevent"]),class:"flex-grow flex flex-col min-h-0 p-2 relative"},[De.value?(s(),o("div",ca,a[11]||(a[11]=[e("p",{class:"font-semibold text-blue-600"},"Drop files to add to Data Zone",-1)]))):z("",!0),e("div",da,[e("div",ua,[e("button",{onClick:Tt,class:"action-btn-sm",title:"Undo",disabled:!qe.value||O.value},[c(Ns,{class:"w-4 h-4"})],8,fa),e("button",{onClick:At,class:"action-btn-sm",title:"Redo",disabled:!Ye.value||O.value},[c(Xs,{class:"w-4 h-4"})],8,ma),a[12]||(a[12]=e("div",{class:"w-px h-5 bg-gray-200 dark:bg-gray-600 mx-1"},null,-1)),e("button",{onClick:St,class:"action-btn-sm",title:"Clone Discussion & Artefacts",disabled:O.value},[c(ss,{class:"w-4 h-4"})],8,va),e("button",{onClick:Pt,class:"action-btn-sm",title:"Save as Artefact",disabled:O.value},[c(vt,{class:"w-4 h-4"})],8,pa),e("button",{onClick:zt,class:"action-btn-sm",title:"Refresh Data",disabled:O.value},[c(dt,{class:"w-4 h-4"})],8,ga),e("button",{onClick:a[0]||(a[0]=r=>ae.value=""),class:"action-btn-sm-danger",title:"Clear All Text",disabled:O.value},[c(Ze,{class:"w-4 h-4"})],8,ya)])]),e("div",ha,[c(pt,{ref:"discussionCodeMirrorEditor",modelValue:ae.value,"onUpdate:modelValue":a[1]||(a[1]=r=>ae.value=r),class:"h-full","read-only":O.value,renderable:!0,onReady:$t},null,8,["modelValue","read-only"])])],32),e("div",{onMousedown:U(Mt,["prevent"]),class:"resizer"},null,32),e("div",{style:ce({width:`${i.value}px`}),class:"flex-shrink-0 border-l border-gray-200 dark:border-gray-700 flex flex-col h-full min-w-[256px]"},[e("div",ba,[e("div",xa,[e("button",{onClick:a[3]||(a[3]=r=>g.value=!g.value),class:"flex items-center gap-2 text-sm font-semibold w-full text-left"},[c(nt,{class:"w-4 h-4"}),a[13]||(a[13]=V()),a[14]||(a[14]=e("span",null,"Images",-1)),c(ct,{class:H(["w-4 h-4 ml-auto transition-transform",{"rotate-90":!g.value}])},null,8,["class"])]),e("div",{onClick:a[4]||(a[4]=U(()=>{},["stop"])),class:"flex items-center gap-1"},[e("button",{onClick:Lt,class:"action-btn-sm-danger",title:"Delete All Images",disabled:ue.value.length===0||O.value},[c(Ze,{class:"w-4 h-4"})],8,ka),e("button",{onClick:Et,class:"action-btn-sm",title:"Add Image(s)",disabled:J.value||O.value},[J.value?(s(),S(re,{key:0,class:"w-4 h-4 animate-spin"})):(s(),S(Ce,{key:1,class:"w-4 h-4"}))],8,_a)])]),g.value?z("",!0):(s(),o("div",wa,[ue.value.length===0&&!J.value?(s(),o("div",Ca,"No images yet")):(s(),o("div",$a,[(s(!0),o(Y,null,Q(ue.value,(r,v)=>(s(),o("div",{key:r.substring(0,20)+v,class:"image-card group"},[e("img",{src:"data:image/png;base64,"+r,class:H(["image-thumbnail",{"grayscale opacity-50":!Ne(v)}])},null,10,Ia),e("div",Da,[e("button",{onClick:w=>Vt(v),class:"overlay-btn",title:"View"},[c(gt,{class:"w-3 h-3"})],8,Ta),e("button",{onClick:w=>le(n).toggleDiscussionImage(v),class:"overlay-btn",title:Ne(v)?"Deactivate":"Activate"},[Ne(v)?(s(),S(as,{key:0,class:"w-3 h-3"})):(s(),S(os,{key:1,class:"w-3 h-3"}))],8,Aa),e("button",{onClick:w=>le(n).deleteDiscussionImage(v),class:"overlay-btn overlay-btn-danger",title:"Delete"},[c(rt,{class:"w-3 h-3"})],8,Ma)])]))),128))]))]))]),c(Vs,{"is-task-running":O.value},null,8,["is-task-running"])],4)])]),e("div",Sa,[O.value?(s(),o("div",Pa,[fe.value?(s(),o("div",za,[e("div",La,[e("span",Ea,E(fe.value.name),1),e("span",Za,E(fe.value.progress)+"%",1)]),e("div",Ua,[e("div",{class:"bg-blue-600 h-1.5 rounded-full",style:ce({width:`${fe.value.progress}%`})},null,4)]),e("p",{class:"text-xs text-gray-500 dark:text-gray-400 truncate",title:fe.value.description},E(fe.value.description),9,Ra)])):(s(),o("div",Fa,[c(re,{class:"h-6 w-6 text-blue-500 animate-spin"}),a[15]||(a[15]=e("p",{class:"text-sm font-semibold text-gray-600 dark:text-gray-300"},"Initializing task...",-1))]))])):(s(),o("div",Va,[c(ut,{title:"Prompts",icon:"ticket",collection:"ui","button-class":"btn-icon absolute left-1.5 top-1/2 -translate-y-1/2 z-10"},{default:we(()=>[Ge.value.length>0?(s(),S(Be,{key:0,title:"Default",icon:"lollms",collection:"ui"},{default:we(()=>[(s(!0),o(Y,null,Q(Ge.value,r=>(s(),o("button",{key:r.id,onClick:v=>We(r.content),class:"menu-item text-sm"},[e("span",Ga,E(r.name),1)],8,ja))),128))]),_:1})):z("",!0),Object.keys(le(l)).length>0?(s(),S(Be,{key:1,title:"User",icon:"user",collection:"ui"},{default:we(()=>[e("div",Wa,[q(e("input",{type:"text","onUpdate:modelValue":a[5]||(a[5]=r=>Ie.value=r),onClick:a[6]||(a[6]=U(()=>{},["stop"])),placeholder:"Search user prompts...",class:"input-field w-full text-sm"},null,512),[[de,Ie.value]])]),a[17]||(a[17]=V()),e("div",Na,[(s(!0),o(Y,null,Q(et.value,(r,v)=>(s(),o("div",{key:v},[e("h3",Ba,E(v),1),a[16]||(a[16]=V()),(s(!0),o(Y,null,Q(r,w=>(s(),o("button",{key:w.id,onClick:se=>We(w.content),class:"menu-item text-sm"},[w.icon?(s(),o("img",{key:0,src:w.icon,class:"h-5 w-5 rounded-md object-cover mr-2 flex-shrink-0",alt:"Icon"},null,8,Ha)):z("",!0),e("span",Xa,E(w.name),1)],8,Oa))),128))]))),128))])]),_:1})):z("",!0),Object.keys(le(B)).length>0?(s(),S(Be,{key:2,title:"Zoo",icon:"server",collection:"ui"},{default:we(()=>[e("div",qa,[q(e("input",{type:"text","onUpdate:modelValue":a[7]||(a[7]=r=>Re.value=r),onClick:a[8]||(a[8]=U(()=>{},["stop"])),placeholder:"Search zoo...",class:"input-field w-full text-sm"},null,512),[[de,Re.value]])]),a[19]||(a[19]=V()),e("div",Ya,[(s(!0),o(Y,null,Q(tt.value,(r,v)=>(s(),o("div",{key:v},[e("h3",Qa,E(v),1),a[18]||(a[18]=V()),(s(!0),o(Y,null,Q(r,w=>(s(),o("button",{key:w.id,onClick:se=>We(w.content),class:"menu-item text-sm"},[w.icon?(s(),o("img",{key:0,src:w.icon,class:"h-5 w-5 rounded-md object-cover mr-2 flex-shrink-0",alt:"Icon"},null,8,Ka)):z("",!0),e("span",eo,E(w.name),1)],8,Ja))),128))]))),128))])]),_:1})):z("",!0),Ge.value.length+Object.keys(et.value).length+Object.keys(tt.value).length>0?(s(),o("div",to)):z("",!0),e("button",{onClick:Ft,class:"menu-item text-sm font-medium text-blue-600 dark:text-blue-400"},"Manage My Prompts...")]),_:1}),q(e("textarea",{ref_key:"dataZonePromptTextareaRef",ref:te,"onUpdate:modelValue":a[9]||(a[9]=r=>Z.value=r),placeholder:"Enter a prompt to process content...",class:"enhanced-textarea w-full !pl-10 !pr-24"},null,512),[[de,Z.value]]),e("div",so,[yt.value&&!Te.value?(s(),o("button",{key:0,onClick:Rt,class:"btn btn-primary !py-2 !px-3 flex items-center",disabled:O.value||!ae.value.trim()&&!Z.value.trim(),title:Ae.value?"Generating image...":"Generate an image using the prompt"},[Ae.value?(s(),S(re,{key:0,class:"w-5 h-5 animate-spin"})):(s(),S(nt,{key:1,class:"w-5 h-5"})),Ae.value?(s(),o("span",oo,"Generating...")):z("",!0)],8,ao)):z("",!0),Ae.value?z("",!0):(s(),o("button",{key:1,onClick:Ut,class:"btn btn-secondary !py-2 !px-3 flex items-center",disabled:O.value||!ae.value.trim()&&ue.value.length===0&&!Z.value.trim(),title:Te.value?"Processing text...":"Process the text in the data zone using the prompt"},[Te.value?(s(),S(re,{key:0,class:"w-5 h-5 animate-spin"})):(s(),S(Xe,{key:1,class:"w-5 h-5"})),Te.value?(s(),o("span",lo,"Processing...")):z("",!0)],8,no))])]))])]))}},io={class:"flex-1 flex flex-col min-h-0"},co={class:"flex-shrink-0 px-3 py-2 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between gap-4"},uo=["disabled"],fo={class:"flex-grow min-h-0 p-3 overflow-y-auto custom-scrollbar space-y-6"},mo={class:"p-4 bg-gray-50 dark:bg-gray-800/50 border dark:border-gray-700 rounded-lg"},vo={class:"flex items-center justify-between mb-3"},po={class:"relative inline-flex items-center cursor-pointer"},go={key:0,class:"text-xs text-gray-500 dark:text-gray-400 mb-3"},yo={key:1,class:"text-xs text-gray-500 dark:text-gray-400 mb-3"},ho={key:2,class:"grid grid-cols-1 sm:grid-cols-2 gap-x-4 gap-y-2 text-sm"},bo={class:"text-gray-800 dark:text-gray-200"},xo={class:"px-2 py-0.5 bg-gray-200 dark:bg-gray-700 rounded text-xs"},ko={class:"p-3 bg-gray-50 dark:bg-gray-800/50 border dark:border-gray-700 rounded-lg flex items-center justify-between"},_o={class:"relative inline-flex items-center cursor-pointer"},wo={class:"p-3 bg-gray-50 dark:bg-gray-800/50 border dark:border-gray-700 rounded-lg flex items-center justify-between"},Co={class:"relative inline-flex items-center cursor-pointer"},$o={class:"p-3 bg-gray-50 dark:bg-gray-800/50 border dark:border-gray-700 rounded-lg"},Io={class:"flex items-center justify-between mb-2"},Do={class:"relative inline-flex items-center cursor-pointer"},To={key:0,class:"mt-2 text-xs text-gray-500 dark:text-gray-400"},Ao={key:1,class:"mt-2 text-xs text-gray-500 dark:text-gray-400"},Mo={class:"space-y-4"},So={__name:"UserZone",setup(W){const n=ft(),{user:u}=ne(n),k=p(""),y=p(""),h=p(""),C=p(!1),b=p(!0),T=p(!1),R=p("auto"),$=p(!1),I=p(!1);function N(){u.value&&(k.value=u.value.data_zone||"",y.value=u.value.coding_style_constraints||"",h.value=u.value.programming_language_preferences||"",C.value=u.value.tell_llm_os||!1,b.value=u.value.share_dynamic_info_with_llm??!0,T.value=u.value.fun_mode||!1,R.value=u.value.ai_response_language||"auto",$.value=u.value.force_ai_response_language||!1,Le(()=>{I.value=!1}))}Ue(u,N,{immediate:!0,deep:!0}),Ue([k,y,h,C,b,T,R,$],()=>{I.value=!0});const L=[{label:"Date",placeholder:"{{date}}"},{label:"Time",placeholder:"{{time}}"},{label:"Date & Time",placeholder:"{{datetime}}"},{label:"Username",placeholder:"{{user_name}}"}];async function j(){I.value&&(await n.updateUserPreferences({data_zone:k.value,coding_style_constraints:y.value,programming_language_preferences:h.value,tell_llm_os:C.value,share_dynamic_info_with_llm:b.value,fun_mode:T.value,ai_response_language:R.value,force_ai_response_language:$.value}),I.value=!1)}return(B,l)=>(s(),o("div",io,[e("div",co,[l[8]||(l[8]=e("span",{class:"text-sm font-medium text-gray-600 dark:text-gray-300"},"Global User Context",-1)),e("button",{onClick:j,class:"btn btn-secondary btn-sm",disabled:!I.value},[c(vt,{class:"w-4 h-4 mr-1.5"}),V(" "+E(I.value?"Save Changes":"Saved"),1)],8,uo)]),e("div",fo,[e("div",mo,[e("div",vo,[l[10]||(l[10]=e("h3",{class:"text-sm font-semibold text-gray-700 dark:text-gray-200"},"Dynamic Information",-1)),e("label",po,[q(e("input",{type:"checkbox","onUpdate:modelValue":l[0]||(l[0]=f=>b.value=f),class:"sr-only peer"},null,512),[[ze,b.value]]),l[9]||(l[9]=e("div",{class:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"},null,-1))])]),b.value?(s(),o("p",go,"The AI will automatically know the following information. You can use these placeholders in your prompts.")):(s(),o("p",yo,"Dynamic information is currently disabled and will not be sent to the AI.")),b.value?(s(),o("div",ho,[(s(),o(Y,null,Q(L,f=>e("div",{key:f.label,class:"flex justify-between items-center"},[e("span",bo,E(f.label)+":",1),e("code",xo,E(f.placeholder),1)])),64))])):z("",!0)]),e("div",ko,[l[12]||(l[12]=e("div",{class:"flex-grow"},[e("h3",{class:"text-sm font-semibold text-gray-700 dark:text-gray-200"},"Fun Mode ðŸŽ‰"),e("p",{class:"text-xs text-gray-500 dark:text-gray-400"},"Ask the AI to be more humorous and witty.")],-1)),e("label",_o,[q(e("input",{type:"checkbox","onUpdate:modelValue":l[1]||(l[1]=f=>T.value=f),class:"sr-only peer"},null,512),[[ze,T.value]]),l[11]||(l[11]=e("div",{class:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"},null,-1))])]),e("div",wo,[l[14]||(l[14]=e("div",{class:"flex-grow"},[e("h3",{class:"text-sm font-semibold text-gray-700 dark:text-gray-200"},"Operating System"),e("p",{class:"text-xs text-gray-500 dark:text-gray-400"},"Inform the AI about your current operating system.")],-1)),e("label",Co,[q(e("input",{type:"checkbox","onUpdate:modelValue":l[2]||(l[2]=f=>C.value=f),class:"sr-only peer"},null,512),[[ze,C.value]]),l[13]||(l[13]=e("div",{class:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"},null,-1))])]),e("div",$o,[e("div",Io,[l[16]||(l[16]=e("h3",{class:"text-sm font-semibold text-gray-700 dark:text-gray-200"},"AI Response Language",-1)),e("label",Do,[q(e("input",{type:"checkbox","onUpdate:modelValue":l[3]||(l[3]=f=>$.value=f),class:"sr-only peer"},null,512),[[ze,$.value]]),l[15]||(l[15]=e("div",{class:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"},null,-1))])]),c(ds,{modelValue:R.value,"onUpdate:modelValue":l[4]||(l[4]=f=>R.value=f),id:"aiResponseLanguage","include-auto":!0,disabled:!$.value},null,8,["modelValue","disabled"]),$.value?(s(),o("p",To,"Force the AI to respond in a specific language. 'Auto' will match the user's prompt language.")):(s(),o("p",Ao,"Language enforcement is disabled. The AI will respond based on its training and personality."))]),e("div",Mo,[e("div",null,[l[17]||(l[17]=e("label",{class:"block text-sm font-semibold mb-2 text-gray-700 dark:text-gray-200"},"Coding Style Constraints",-1)),q(e("textarea",{"onUpdate:modelValue":l[5]||(l[5]=f=>y.value=f),class:"styled-textarea",placeholder:"e.g., Always follow PEP8 for Python code. Use pathlib instead of os.path."},null,512),[[de,y.value]])]),e("div",null,[l[18]||(l[18]=e("label",{class:"block text-sm font-semibold mb-2 text-gray-700 dark:text-gray-200"},"Programming Language & Library Preferences",-1)),q(e("textarea",{"onUpdate:modelValue":l[6]||(l[6]=f=>h.value=f),class:"styled-textarea",placeholder:"e.g., I prefer solutions in Python 3.10+. For web development, use Vue.js with Tailwind CSS."},null,512),[[de,h.value]])]),e("div",null,[l[19]||(l[19]=e("label",{class:"block text-sm font-semibold mb-2 text-gray-700 dark:text-gray-200"},"General Info / Notes",-1)),q(e("textarea",{"onUpdate:modelValue":l[7]||(l[7]=f=>k.value=f),class:"styled-textarea",placeholder:"Add any other information about yourself or general instructions for the AI."},null,512),[[de,k.value]])])])])]))}},Po=ve(So,[["__scopeId","data-v-97f8e308"]]),zo={class:"flex-1 flex flex-col min-h-0 p-2"},Lo={class:"flex-grow min-h-0 border dark:border-gray-700 rounded-md overflow-hidden"},Eo={__name:"PersonalityZone",setup(W){const n=pe(),u=d(()=>n.activeDiscussion),k=d(()=>{var y;return((y=u.value)==null?void 0:y.personality_data_zone)||""});return(y,h)=>(s(),o("div",zo,[e("div",Lo,[c(pt,{modelValue:k.value,"onUpdate:modelValue":h[0]||(h[0]=C=>k.value=C),class:"h-full","read-only":!0},null,8,["modelValue"])])]))}},Zo={class:"flex-1 flex flex-col min-h-0"},Uo={class:"flex-shrink-0 px-3 py-2 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between gap-4"},Ro={class:"flex-grow min-h-0 flex"},Fo={class:"flex-grow flex flex-col min-w-0 p-2"},Vo={class:"flex-grow min-h-0 border dark:border-gray-700 rounded-md overflow-hidden"},jo={class:"rendered-prose-container h-full p-2"},Go={class:"w-64 flex-shrink-0 border-l border-gray-200 dark:border-gray-700 flex flex-col p-2"},Wo={class:"sidebar-section"},No={class:"section-header"},Bo={class:"section-title"},Oo={class:"section-actions"},Ho={class:"px-1 pb-2"},Xo={class:"section-content flex-grow min-h-0 overflow-y-auto"},qo={key:0,class:"loading-state"},Yo={key:1,class:"empty-state"},Qo={key:2,class:"memories-list space-y-2"},Jo={class:"memory-header"},Ko={class:"memory-info"},en={class:"memory-details"},tn=["title"],sn={class:"memory-actions"},an=["onClick"],on=["onClick"],nn={class:"memory-controls"},ln=["onClick"],rn=["onClick"],cn={__name:"MemoryZone",setup(W){const n=pe(),u=us(),k=$e(),{memories:y,isLoading:h}=ne(u),C=p(""),b=p(new Set),T=d(()=>n.activeDiscussion),R=d(()=>{var m;return T.value&&((m=n.activeAiTasks[T.value.id])==null?void 0:m.type)==="memorize"}),$=d(()=>y.value.filter(m=>b.value.has(m.title)).map(m=>`--- Memory: ${m.title} ---
${m.content}
--- End Memory: ${m.title} ---`).join(`

`)),I=d(()=>{if(!C.value)return y.value;const m=C.value.toLowerCase();return y.value.filter(_=>_.title.toLowerCase().includes(m)||_.content.toLowerCase().includes(m))});function N(){T.value&&n.memorizeLTM(T.value.id)}function L(){k.openModal("memoryEditor")}function j(m){k.openModal("memoryEditor",{memory:m})}async function B(m){const _=y.value.find(g=>g.id===m);if(!_)return;await k.showConfirmation({title:`Delete Memory '${_.title}'?`,message:"This will permanently delete this memory from your memory bank.",confirmText:"Delete"})&&await u.deleteMemory(m)}function l(m){b.value.add(m),k.addNotification(`Memory "${m}" loaded to context`,"success")}function f(m){b.value.delete(m),k.addNotification(`Memory "${m}" removed from context`,"info")}return(m,_)=>(s(),o("div",Zo,[e("div",Uo,[_[2]||(_[2]=e("span",{class:"text-sm font-medium text-gray-600 dark:text-gray-300"},"Long-Term Memory",-1)),e("button",{onClick:N,class:"btn btn-secondary btn-sm",title:"Memorize Current Discussion"},[c(Xe,{class:H(["w-4 h-4 mr-1.5",{"animate-pulse":R.value}])},null,8,["class"]),_[1]||(_[1]=V("Memorize "))])]),e("div",Ro,[e("div",Fo,[e("div",Vo,[e("div",jo,[c(ns,{content:$.value},null,8,["content"])])])]),e("div",Go,[e("div",Wo,[e("div",No,[e("h4",Bo,[c(Ee,{class:"w-4 h-4"}),_[3]||(_[3]=V(" Memory Bank"))]),e("div",Oo,[e("button",{onClick:L,class:"action-btn-sm",title:"Create New Memory"},[c(Ce,{class:"w-4 h-4"})])])]),e("div",Ho,[q(e("input",{type:"text","onUpdate:modelValue":_[0]||(_[0]=P=>C.value=P),placeholder:"Search memories...",class:"w-full px-2 py-1.5 text-xs bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-md focus:ring-1 focus:ring-yellow-500 focus:border-yellow-500"},null,512),[[de,C.value]])]),e("div",Xo,[le(h)?(s(),o("div",qo,[c(re,{class:"w-6 h-6 text-gray-400 animate-spin mx-auto mb-2"}),_[4]||(_[4]=e("p",{class:"text-xs text-gray-500"},"Loading...",-1))])):I.value.length===0?(s(),o("div",Yo,[c(Ee,{class:"w-8 h-8 text-gray-400 mx-auto mb-2"}),_[5]||(_[5]=e("p",{class:"text-xs text-gray-500 mb-3"},"No memories",-1))])):(s(),o("div",Qo,[(s(!0),o(Y,null,Q(I.value,P=>(s(),o("div",{key:P.id,class:"memory-card"},[e("div",Jo,[e("div",Ko,[e("div",{class:H(["memory-icon",{loaded:b.value.has(P.title)}])},[c(Ee,{class:"w-4 h-4"})],2),e("div",en,[e("h5",{class:"memory-title",title:P.title},E(P.title),9,tn)])]),e("div",sn,[e("button",{onClick:g=>j(P),class:"memory-action-btn",title:"Edit Memory"},[c(He,{class:"w-3 h-3"})],8,an),e("button",{onClick:g=>B(P.id),class:"memory-action-btn memory-action-btn-danger",title:"Delete Memory"},[c(Ze,{class:"w-3 h-3"})],8,on)])]),e("div",nn,[b.value.has(P.title)?(s(),o("button",{key:0,onClick:g=>f(P.title),class:"memory-load-btn loaded",title:"Remove from Context"},[c(lt,{class:"w-3 h-3"}),_[6]||(_[6]=V("In Context"))],8,ln)):(s(),o("button",{key:1,onClick:g=>l(P.title),class:"memory-load-btn",title:"Add to Context"},[c(Ce,{class:"w-3 h-3"}),_[7]||(_[7]=V("Add to Context"))],8,rn))])]))),128))]))])])])])]))}},dn={class:"h-full flex flex-col bg-white dark:bg-gray-800 shadow-xl flex-grow min-w-0"},un={class:"flex-shrink-0 bg-gray-50 dark:bg-gray-800/50 border-b border-gray-200 dark:border-gray-700"},fn={class:"flex items-center justify-between px-2"},mn={class:"flex space-x-1","aria-label":"Data Zone Tabs"},vn=["onClick"],pn={key:0,class:"px-1.5 py-0.5 bg-gray-200 dark:bg-gray-600 text-xs rounded-full font-mono"},gn=["title"],xn={__name:"DataZone",setup(W){const n=$e(),u=pe(),{liveDataZoneTokens:k}=ne(u),y=p("discussion"),h=p(768),C=p(!1),b=d(()=>n.isDataZoneExpanded),T=I=>I>1e3?`${(I/1e3).toFixed(1)}K`:I.toString(),R=d(()=>[{id:"discussion",label:"Discussion",icon:ls,tokenCount:k.value.discussion},{id:"user",label:"User",icon:rs,tokenCount:k.value.user},{id:"personality",label:"Personality",icon:Xe,tokenCount:k.value.personality},{id:"ltm",label:"Memory",icon:Ee,tokenCount:k.value.memory}]);function $(I){C.value=!0;const N=I.clientX,L=h.value;document.body.style.cursor="col-resize",document.body.style.userSelect="none";function j(l){if(!C.value)return;const f=l.clientX-N,m=L-f,_=320,P=window.innerWidth*.75;h.value=Math.max(_,Math.min(m,P))}function B(){C.value=!1,document.body.style.cursor="",document.body.style.userSelect="",window.removeEventListener("mousemove",j),window.removeEventListener("mouseup",B),localStorage.setItem("lollms_dataZoneWidth",h.value)}window.addEventListener("mousemove",j),window.addEventListener("mouseup",B)}return mt(()=>{const I=localStorage.getItem("lollms_dataZoneWidth");I&&(h.value=parseInt(I,10))}),(I,N)=>(s(),o("div",{class:H(["relative h-full flex",[b.value?"w-full":"flex-shrink-0"]]),style:ce(b.value?{}:{width:`${h.value}px`})},[e("div",{onMousedown:U($,["prevent"]),class:"flex-shrink-0 w-2 cursor-col-resize bg-gray-200 dark:bg-gray-700 hover:bg-blue-400 transition-colors duration-200"},null,32),e("aside",dn,[e("div",un,[e("div",fn,[e("nav",mn,[(s(!0),o(Y,null,Q(R.value,L=>(s(),o("button",{key:L.id,onClick:j=>y.value=L.id,class:H(["flex items-center gap-2 px-3 py-2.5 text-sm font-medium rounded-t-md border-b-2",y.value===L.id?"border-blue-500 text-blue-600 dark:text-blue-400 bg-white dark:bg-gray-800":"border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200"])},[(s(),S(is(L.icon),{class:"w-4 h-4"})),e("span",null,E(L.label),1),L.tokenCount>0?(s(),o("span",pn,E(T(L.tokenCount)),1)):z("",!0)],10,vn))),128))]),e("button",{onClick:N[0]||(N[0]=L=>le(n).toggleDataZoneExpansion()),class:"action-btn",title:b.value?"Shrink":"Expand"},[b.value?(s(),S(cs,{key:0,class:"w-5 h-5"})):(s(),S(gt,{key:1,class:"w-5 h-5"}))],8,gn)])]),y.value==="discussion"?(s(),S(ro,{key:0})):z("",!0),y.value==="user"?(s(),S(Po,{key:1})):z("",!0),y.value==="personality"?(s(),S(Eo,{key:2})):z("",!0),y.value==="ltm"?(s(),S(cn,{key:3})):z("",!0)])],6))}};export{xn as default};
