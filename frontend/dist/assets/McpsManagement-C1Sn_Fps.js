import{a2 as Ce,a5 as Ae,aj as Me,m as $e,a6 as te,f as v,c as x,ae as N,a7 as Se,a as o,o as l,e as s,h as u,a4 as g,j as c,ak as L,t as p,w as Ie,ad as Te,g as A,v as F,ai as Re,a8 as _,F as k,i as M,s as se,af as W,b as q,q as ae,al as Ue,am as Pe,an as De,ao as Ne,ap as Le}from"./index-D7WRMwdF.js";import Ve from"./IconArrowUpCircle-BNZNXUY6.js";import je from"./IconArrowUp-34p1_gne.js";import Ze from"./IconArrowDown-t1p4Za8X.js";import ze from"./IconGlobeAlt-QqLvWplO.js";import{A as Ee,a as Oe}from"./AppCardSkeleton-BdN4ZCsC.js";const Fe={class:"space-y-6"},We={class:"border-b border-gray-200 dark:border-gray-700"},qe={class:"-mb-px flex space-x-6","aria-label":"Sub Tabs"},Be={key:0},Ge={class:"flex justify-between items-center mb-4 flex-wrap gap-2"},He={class:"flex items-center gap-2"},Je=["disabled"],Ke={key:0,class:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm mb-6 overflow-hidden"},Qe={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},Xe={class:"md:col-span-2"},Ye={class:"flex justify-end"},et=["disabled"],tt={key:0,class:"text-center p-4"},st={key:1,class:"empty-state-card"},at={key:2,class:"space-y-4"},nt={class:"flex-grow truncate"},lt={class:"font-semibold"},ot={class:"text-sm text-gray-500 font-mono truncate"},it={class:"text-xs text-gray-400 mt-1"},rt={class:"flex items-center gap-x-2 flex-shrink-0"},dt=["onClick","disabled"],ct=["onClick","disabled"],ut={key:1},pt={class:"flex justify-between items-center mb-4 flex-wrap gap-2"},vt=["disabled"],mt={class:"space-y-4"},ft={class:"grid grid-cols-1 lg:grid-cols-3 gap-4"},bt={class:"relative lg:col-span-1"},gt={class:"grid grid-cols-2 lg:col-span-2 gap-4"},yt=["value"],_t={class:"flex items-center gap-2"},ht=["value"],wt={key:0,class:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 2xl:grid-cols-4 gap-6"},kt={key:1,class:"empty-state-card"},xt={key:2},Ct={class:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 2xl:grid-cols-4 gap-6"},At={key:0,class:"mt-6 flex justify-between items-center"},Mt={class:"text-sm text-gray-500"},$t={class:"flex gap-2"},St=["disabled"],It=["disabled"],Tt={key:2},Rt={class:"flex justify-between items-center mb-4"},Ut=["disabled"],Pt={key:0,class:"text-center p-10"},Dt={key:1,class:"empty-state-card"},Nt={key:2,class:"space-y-4"},Lt={class:"flex items-center gap-4 flex-grow truncate"},Vt=["src"],jt={class:"flex-grow truncate"},Zt={class:"font-semibold truncate"},zt={class:"text-xs text-gray-500 font-mono truncate"},Et={key:0},Ot={key:0,class:"text-yellow-500 font-semibold"},Ft={class:"flex items-center gap-x-2 flex-shrink-0 flex-wrap justify-end"},Wt={class:"capitalize"},qt=["onClick"],Bt=["onClick"],Gt=["href"],Ht=["onClick"],Jt=["onClick"],Kt=["onClick"],Qt=["onClick","disabled"],Xt=["onClick","disabled"],Yt=["onClick"],es={__name:"McpsManagement",setup(ts){const d=Ae(),B=Me(),m=$e(),{mcpZooRepositories:G,isLoadingMcpZooRepositories:ne,zooMcps:$,isLoadingZooMcps:V,installedApps:le,isLoadingInstalledApps:j}=te(d),{tasks:H}=te(B),f=v("available_items"),y=v({name:"",url:""}),S=v(!1),i=v(null),U=v(""),h=v("All"),I=v("All"),P=v(!1),D=v("last_update_date"),T=v("desc"),C=v(JSON.parse(localStorage.getItem("starredItems")||"[]")),b=v(1),Z=v(24);let J=null;const oe=[{value:"last_update_date",label:"Last Updated"},{value:"creation_date",label:"Creation Date"},{value:"name",label:"Name"},{value:"author",label:"Author"}],K=x(()=>$.value.total||0),ie=x(()=>$.value.pages||1),re=x(()=>{const a=(b.value-1)*Z.value+1,t=Math.min(b.value*Z.value,K.value);return`Showing ${a}-${t} of ${K.value}`});async function R(){if(h.value==="Starred")return;const a={page:b.value,page_size:Z.value,sort_by:D.value,sort_order:T.value,category:h.value!=="All"?h.value:void 0,search_query:U.value||void 0,installation_status:I.value!=="All"?I.value:void 0};await d.fetchZooMcps(a)}function de(){clearTimeout(J),J=setTimeout(()=>{b.value=1,R()},300)}N([f,D,T,h,I],()=>{b.value=1,f.value==="available_items"&&R()}),N(U,de),N(b,R),N(C,a=>{localStorage.setItem("starredItems",JSON.stringify(a))},{deep:!0}),Se(()=>{d.fetchMcpZooRepositories(),d.fetchInstalledApps(),R()});const z=x(()=>{if(!Array.isArray($.value.items))return[];let a=$.value.items;h.value==="Starred"&&(a=a.filter(n=>C.value.includes(n.name)));const t=new Map,e=["Installing MCP: ","Updating app: "];return H.value.forEach(n=>{if(n!=null&&n.name){for(const r of e)if(n.name.startsWith(r)&&(n.status==="running"||n.status==="pending")){const w=n.name.replace(r,"");(!t.has(w)||new Date(n.created_at)>new Date(t.get(w).created_at))&&t.set(w,n);break}}}),a.map(n=>({...n,task:t.get(n.name)||t.get(n.folder_name)||null}))}),E=x(()=>Array.isArray(G.value)?[...G.value].sort((a,t)=>(a.name||"").localeCompare(t.name||"")):[]),ce=x(()=>$.value.categories||["All","Starred"]),O=x(()=>{const t=[...le.value.filter(n=>n.item_type==="mcp")].sort((n,r)=>(n.name||"").localeCompare(r.name||"")),e=new Map;return H.value.forEach(n=>{if(!(n!=null&&n.name))return;let r="",w=null;n.name.startsWith("Start app: ")?(r=n.name.replace("Start app: ",""),w="starting"):n.name.startsWith("Stop app: ")?(r=n.name.replace("Stop app: ",""),w="stopping"):n.name.startsWith("Updating app: ")&&(r=n.name.replace("Updating app: ",""),w="updating"),r&&(n.status==="running"||n.status==="pending")&&(!e.has(r)||new Date(n.created_at)>new Date(e.get(r).created_at))&&e.set(r,{task:n,activityType:w})}),t.map(n=>{const r=e.get(n.name);return{...n,task:r?r.task:null,activity_status:r?r.activityType:null}})});function ue(a){const t=C.value.indexOf(a);t>-1?C.value.splice(t,1):C.value.push(a)}function pe(a){return a?new Date(a).toLocaleString():"Never"}async function ve(){if(!y.value.name||!y.value.url){m.addNotification("Repository name and URL are required.","warning");return}i.value="add";try{await d.addMcpZooRepository(y.value.name,y.value.url),y.value={name:"",url:""},S.value=!1}finally{i.value=null}}async function me(a){i.value=a.id;try{await d.pullMcpZooRepository(a.id)}finally{i.value=null}}async function fe(){P.value=!0;try{await d.pullAllMcpZooRepositories()}finally{P.value=!1}}async function be(a){if(await m.showConfirmation({title:`Delete Repository '${a.name}'?`,message:"This will remove the repository and its cached files. This action cannot be undone.",confirmText:"Delete"})){i.value=a.id;try{await d.deleteMcpZooRepository(a.id)}finally{i.value=null}}}function ge(a){m.openModal("appInstall",{app:a,type:"mcps"})}async function Q(a){await m.showConfirmation({title:`Update '${a.name}'?`,message:"This will update the MCP to the latest version while preserving your configuration. The MCP will be stopped during the update.",confirmText:"Update"})&&await d.updateApp(a.id)}async function X(a,t){i.value=`${t}-${a}`;try{t==="start"&&await d.startApp(a),t==="stop"&&await d.stopApp(a)}finally{i.value=null}}async function Y(a){if(await m.showConfirmation({title:`Uninstall '${a.name}'?`,message:"This will permanently delete all files. This cannot be undone.",confirmText:"Uninstall"})){i.value=`uninstall-${a.id}`;try{await d.uninstallApp(a.id)}finally{i.value=null}}}function ye(a){m.openModal("sourceViewer",{title:`Details: ${a.name}`,content:a.description||"No description available.",language:"text"})}function _e(a){m.openModal("appConfig",{app:a})}function he(a){m.openModal("serviceRegistration",{item:a,itemType:"mcp",isInstalled:!0})}async function we(a){const t=await d.fetchAppLog(a.id);m.openModal("sourceViewer",{title:`Logs: ${a.name}`,content:t||"No log content found.",language:"log"})}async function ke(a){const t=await d.fetchMcpReadme(a.repository,a.folder_name);m.openModal("sourceViewer",{title:`README: ${a.name}`,content:t,language:"markdown"})}async function xe(a){await B.cancelTask(a)}function ee(a){m.openModal("tasksManager",{initialTaskId:a})}return(a,t)=>(l(),o("div",Fe,[s("div",We,[s("nav",qe,[s("button",{onClick:t[0]||(t[0]=e=>f.value="repositories"),class:g(["tab-button",f.value==="repositories"?"active":"inactive"])},"Repositories",2),s("button",{onClick:t[1]||(t[1]=e=>f.value="available_items"),class:g(["tab-button",f.value==="available_items"?"active":"inactive"])},"Available",2),s("button",{onClick:t[2]||(t[2]=e=>f.value="installed_apps"),class:g(["tab-button",f.value==="installed_apps"?"active":"inactive"])},"Installed",2)])]),f.value==="repositories"?(l(),o("section",Be,[s("div",Ge,[t[15]||(t[15]=s("h3",{class:"text-xl font-semibold"},"MCP Zoo Repositories",-1)),s("div",He,[s("button",{onClick:fe,class:"btn btn-secondary",disabled:P.value},[c(L,{class:g(["w-4 h-4",{"animate-spin":P.value}])},null,8,["class"]),t[14]||(t[14]=s("span",{class:"ml-2"},"Pull All",-1))],8,Je),s("button",{onClick:t[3]||(t[3]=e=>S.value=!S.value),class:"btn btn-primary"},p(S.value?"Cancel":"Add Repository"),1)])]),c(Re,{name:"form-fade"},{default:Ie(()=>[S.value?(l(),o("div",Ke,[s("form",{onSubmit:Te(ve,["prevent"]),class:"space-y-4"},[s("div",Qe,[s("div",null,[t[16]||(t[16]=s("label",{for:"repo-name-mcp",class:"block text-sm font-medium"},"Name",-1)),A(s("input",{id:"repo-name-mcp","onUpdate:modelValue":t[4]||(t[4]=e=>y.value.name=e),type:"text",class:"input-field mt-1",placeholder:"e.g., Official MCP Zoo",required:""},null,512),[[F,y.value.name]])]),s("div",Xe,[t[17]||(t[17]=s("label",{for:"repo-url-mcp",class:"block text-sm font-medium"},"Git URL",-1)),A(s("input",{id:"repo-url-mcp","onUpdate:modelValue":t[5]||(t[5]=e=>y.value.url=e),type:"url",class:"input-field mt-1",placeholder:"https://github.com/ParisNeo/lollms_mcps_zoo.git",required:""},null,512),[[F,y.value.url]])])]),s("div",Ye,[s("button",{type:"submit",class:"btn btn-primary",disabled:i.value==="add"},p(i.value==="add"?"Adding...":"Add Repository"),9,et)])],32)])):u("",!0)]),_:1}),_(ne)?(l(),o("div",tt,"Loading repositories...")):!E.value||E.value.length===0?(l(),o("div",st,t[18]||(t[18]=[s("p",null,"No MCP Zoo repositories added.",-1)]))):(l(),o("div",at,[(l(!0),o(k,null,M(E.value,e=>(l(),o("div",{key:e.id,class:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm flex flex-col md:flex-row md:items-center justify-between gap-4"},[s("div",nt,[s("p",lt,p(e.name),1),s("p",ot,p(e.url),1),s("p",it,"Last updated: "+p(pe(e.last_pulled_at)),1)]),s("div",rt,[s("button",{onClick:n=>me(e),class:"btn btn-secondary btn-sm",disabled:i.value===e.id},[c(L,{class:g(["w-4 h-4",{"animate-spin":i.value===e.id}])},null,8,["class"]),t[19]||(t[19]=s("span",{class:"ml-1"},"Pull",-1))],8,dt),e.is_deletable?(l(),o("button",{key:0,onClick:n=>be(e),class:"btn btn-danger btn-sm",disabled:i.value===e.id},[c(se,{class:"w-4 h-4"})],8,ct)):u("",!0)])]))),128))]))])):u("",!0),f.value==="available_items"?(l(),o("section",ut,[s("div",pt,[t[21]||(t[21]=s("h3",{class:"text-xl font-semibold"},"Available MCPs",-1)),s("button",{onClick:R,class:"btn btn-secondary",disabled:_(V)},[c(L,{class:g(["w-4 h-4",{"animate-spin":_(V)}])},null,8,["class"]),t[20]||(t[20]=s("span",{class:"ml-2"},"Rescan",-1))],8,vt)]),s("div",mt,[s("div",ft,[s("div",bt,[A(s("input",{type:"text","onUpdate:modelValue":t[6]||(t[6]=e=>U.value=e),placeholder:"Search MCPs...",class:"input-field w-full pl-10"},null,512),[[F,U.value]]),t[22]||(t[22]=s("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[s("svg",{class:"h-5 w-5 text-gray-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})])],-1))]),s("div",gt,[A(s("select",{"onUpdate:modelValue":t[7]||(t[7]=e=>I.value=e),class:"input-field"},t[23]||(t[23]=[s("option",{value:"All"},"All Statuses",-1),s("option",{value:"Installed"},"Installed",-1),s("option",{value:"Uninstalled"},"Uninstalled",-1)]),512),[[W,I.value]]),A(s("select",{"onUpdate:modelValue":t[8]||(t[8]=e=>h.value=e),class:"input-field"},[(l(!0),o(k,null,M(ce.value,e=>(l(),o("option",{key:e,value:e},p(e),9,yt))),128))],512),[[W,h.value]])])]),s("div",_t,[A(s("select",{"onUpdate:modelValue":t[9]||(t[9]=e=>D.value=e),class:"input-field w-48"},[(l(),o(k,null,M(oe,e=>s("option",{key:e.value,value:e.value},"Sort by "+p(e.label),9,ht)),64))],512),[[W,D.value]]),s("button",{onClick:t[10]||(t[10]=e=>T.value=T.value==="asc"?"desc":"asc"),class:"btn btn-secondary p-2"},[T.value==="asc"?(l(),q(je,{key:0,class:"w-5 h-5"})):(l(),q(Ze,{key:1,class:"w-5 h-5"}))])]),_(V)?(l(),o("div",wt,[(l(),o(k,null,M(8,e=>c(Ee,{key:e})),64))])):!z.value||z.value.length===0?(l(),o("div",kt,t[24]||(t[24]=[s("h4",{class:"font-semibold"},"No MCPs Found",-1),s("p",{class:"text-sm"},"No MCPs match your criteria. Please add and pull a repository or adjust your filters.",-1)]))):(l(),o("div",xt,[s("div",Ct,[(l(!0),o(k,null,M(z.value,e=>(l(),q(Oe,{key:`${e.repository}/${e.folder_name}`,app:e,task:e.task,"is-starred":C.value.includes(e.name),"item-type-name":"MCP",onStar:n=>ue(e.name),onInstall:n=>ge(e),onUpdate:n=>Q(e),onUninstall:n=>Y(e),onDetails:n=>ye(e),onHelp:n=>ke(e),onViewTask:ee,onCancelInstall:n=>xe(e.task.id)},null,8,["app","task","is-starred","onStar","onInstall","onUpdate","onUninstall","onDetails","onHelp","onCancelInstall"]))),128))]),h.value!=="Starred"?(l(),o("div",At,[s("p",Mt,p(re.value),1),s("div",$t,[s("button",{onClick:t[11]||(t[11]=e=>b.value--),disabled:b.value<=1,class:"btn btn-secondary"},"Previous",8,St),s("button",{onClick:t[12]||(t[12]=e=>b.value++),disabled:b.value>=ie.value,class:"btn btn-secondary"},"Next",8,It)])])):u("",!0)]))])])):u("",!0),f.value==="installed_apps"?(l(),o("section",Tt,[s("div",Rt,[t[26]||(t[26]=s("h3",{class:"text-xl font-semibold"},"Installed MCPs",-1)),s("button",{onClick:t[13]||(t[13]=(...e)=>_(d).fetchInstalledApps&&_(d).fetchInstalledApps(...e)),class:"btn btn-secondary",disabled:_(j)},[c(L,{class:g(["w-4 h-4",{"animate-spin":_(j)}])},null,8,["class"]),t[25]||(t[25]=s("span",{class:"ml-2"},"Refresh",-1))],8,Ut)]),_(j)?(l(),o("div",Pt,"Loading...")):!O.value||O.value.length===0?(l(),o("div",Dt,t[27]||(t[27]=[s("h4",{class:"font-semibold"},"No MCPs Installed",-1),s("p",{class:"text-sm"},'Go to "Available" to install an MCP.',-1)]))):(l(),o("div",Nt,[(l(!0),o(k,null,M(O.value,e=>(l(),o("div",{key:e.id,class:g(["bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm flex flex-col md:flex-row md:items-center justify-between gap-4 transition-colors duration-300",{"bg-blue-50 dark:bg-blue-900/30 animate-pulse":e.activity_status==="starting","bg-yellow-50 dark:bg-yellow-900/30 animate-pulse":e.activity_status==="stopping","bg-purple-50 dark:bg-purple-900/30 animate-pulse":e.activity_status==="updating"}])},[s("div",Lt,[e.icon?(l(),o("img",{key:0,src:e.icon,class:"h-10 w-10 rounded-md flex-shrink-0 object-cover",alt:"Icon"},null,8,Vt)):u("",!0),s("div",jt,[s("p",Zt,p(e.name),1),s("p",zt,[ae("Port: "+p(e.port)+" ",1),e.version?(l(),o("span",Et,[ae(" | v"+p(e.version)+" ",1),e.update_available?(l(),o("span",Ot,"(repo: v"+p(e.repo_version)+")",1)):u("",!0)])):u("",!0)])])]),s("div",Ft,[e.activity_status?(l(),o(k,{key:0},[s("div",{class:g(["flex items-center gap-2 text-sm font-semibold",{"text-blue-700 dark:text-blue-300":e.activity_status==="starting","text-yellow-700 dark:text-yellow-300":e.activity_status==="stopping","text-purple-700 dark:text-purple-300":e.activity_status==="updating"}])},[c(Ue,{class:"w-5 h-5"}),s("span",Wt,p(e.activity_status)+"...",1)],2),s("button",{onClick:n=>ee(e.task.id),class:"btn btn-secondary btn-sm !p-1.5",title:"View Task Details"},[c(Pe,{class:"w-4 h-4"})],8,qt)],64)):(l(),o(k,{key:1},[e.update_available?(l(),o("button",{key:0,onClick:n=>Q(e),class:"btn btn-warning btn-sm p-2",title:"Update"},[c(Ve,{class:"w-5 h-5"})],8,Bt)):u("",!0),s("span",{class:g(["px-2 py-1 text-xs font-semibold rounded-full",{"bg-green-100 text-green-800 dark:bg-green-900/50 dark:text-green-300":e.status==="running","bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300":e.status==="stopped","bg-red-100 text-red-800 dark:bg-red-900/50 dark:text-red-300":e.status==="error"}])},p(e.status),3),e.status==="running"&&e.url?(l(),o("a",{key:1,href:e.url,target:"_blank",class:"btn btn-secondary btn-sm p-2",title:"Open"},[c(ze,{class:"w-5 h-5"})],8,Gt)):u("",!0),s("button",{onClick:n=>he(e),class:"btn btn-secondary btn-sm p-2",title:"Edit Registration"},[c(De,{class:"w-5 h-5"})],8,Ht),e.has_config_schema?(l(),o("button",{key:2,onClick:n=>_e(e),class:"btn btn-secondary btn-sm p-2",title:"Configure"},[c(Ne,{class:"w-5 h-5"})],8,Jt)):u("",!0),s("button",{onClick:n=>we(e),class:"btn btn-secondary btn-sm p-2",title:"Logs"},[c(Le,{class:"w-5 h-5"})],8,Kt),e.status!=="running"?(l(),o("button",{key:3,onClick:n=>X(e.id,"start"),class:"btn btn-success btn-sm p-2",disabled:i.value===`start-${e.id}`,title:"Start"},"Start",8,Qt)):u("",!0),e.status==="running"||e.status==="error"&&e.pid?(l(),o("button",{key:4,onClick:n=>X(e.id,"stop"),class:"btn btn-warning btn-sm p-2",disabled:i.value===`stop-${e.id}`,title:"Stop"},"Stop",8,Xt)):u("",!0),s("button",{onClick:n=>Y(e),class:"btn btn-danger btn-sm p-2",title:"Uninstall"},[c(se,{class:"w-5 h-5"})],8,Yt)],64))])],2))),128))]))])):u("",!0)]))}},rs=Ce(es,[["__scopeId","data-v-f4fbc0a2"]]);export{rs as default};
