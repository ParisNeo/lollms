import{V as bt,ci as se,x as me,r as m,j as v,c as n,b as o,g as e,n as I,k as l,bT as Ce,t as j,D as Ge,E as ue,h as Q,v as xt,F as R,i as V,A,Z as ze,cj as $e,a as _t,q as kt,a1 as wt,s as ee,w as Ee,o as We,y as Ct,z as $t,ck as Dt,M as Re,cl as De,f as G,N as Fe,d as C,bH as Ve,I as je,B as b,P as X,Y as te,e as W,cm as Be,J as At,H as It,cn as Tt,co as Mt,p as re,cp as ke,l as ce,cq as Lt,_ as Ae,bJ as we,u as Pt,cr as St,cs as de,ct as Ut,cu as Zt,cv as zt,cw as Et}from"./index-DM7VGb2z.js";import Rt from"./IconSave-CUAu49br.js";import Ne from"./IconUndo-CHGRlpxB.js";import Oe from"./IconRedo-6SRVV-Tu.js";import Vt from"./IconWeb-D2NF83YH.js";import jt from"./IconGather-KG3ljDgf.js";import{useMemoriesStore as Gt}from"./memories-LSZRr3W1.js";const Wt={class:"artefact-header"},Ft={class:"artefact-info"},Bt={class:"artefact-details"},Nt=["title"],Ot={class:"artefact-actions"},Ht={class:"artefact-body"},Xt={class:"w-full"},qt=["value"],Jt={class:"grid grid-cols-2 gap-1 w-full mt-1.5"},Kt={__name:"ArtefactCard",props:{artefactGroup:{type:Object,required:!0},isLoadedToPrompt:{type:Boolean,default:!1}},emits:["load-to-prompt","unload-from-prompt"],setup(L,{emit:c}){var N;const u=L,x=c,f=se(),k=me(),g=m(((N=u.artefactGroup.versions[0])==null?void 0:N.version)||1);m(!1);const p=v(()=>u.artefactGroup.isAnyVersionLoaded),T=v(()=>p.value?u.artefactGroup.versions.find(w=>w.is_loaded):null),S=v(()=>p.value?"loaded-data-zone":u.isLoadedToPrompt?"loaded-prompt":"");async function F(){await f.loadArtefactToContext({discussionId:f.currentDiscussionId,artefactTitle:u.artefactGroup.title,version:g.value})}function D(){x("load-to-prompt",u.artefactGroup.title,g.value)}async function P(){await f.unloadArtefactFromContext({discussionId:f.currentDiscussionId,artefactTitle:u.artefactGroup.title,version:T.value.version})}function $(){x("unload-from-prompt",u.artefactGroup.title)}async function z(){const w=await f.fetchArtefactContent({discussionId:f.currentDiscussionId,artefactTitle:u.artefactGroup.title,version:g.value});w&&k.openModal("artefactEditor",{artefact:w,discussionId:f.currentDiscussionId})}async function B(){await k.showConfirmation({title:`Delete Artefact '${u.artefactGroup.title}'?`,message:"This will permanently delete the artefact and all its versions.",confirmText:"Delete"})&&await f.deleteArtefact({discussionId:f.currentDiscussionId,artefactTitle:u.artefactGroup.title})}return(w,i)=>(o(),n("div",{class:I(["artefact-card group",S.value])},[e("div",Wt,[e("div",Ft,[e("div",{class:I(["artefact-icon",{"loaded-data-zone":p.value,"loaded-prompt":L.isLoadedToPrompt}])},[l(Ce,{class:"w-4 h-4"})],2),e("div",Bt,[e("h5",{class:"artefact-title",title:L.artefactGroup.title},j(L.artefactGroup.title),9,Nt)])]),e("div",Ot,[e("button",{onClick:z,class:"artefact-action-btn",title:"Edit Content"},[l(Ge,{class:"w-3 h-3"})]),e("button",{onClick:B,class:"artefact-action-btn artefact-action-btn-danger",title:"Delete Artefact"},[l(ue,{class:"w-3 h-3"})])])]),e("div",Ht,[e("div",Xt,[Q(e("select",{"onUpdate:modelValue":i[0]||(i[0]=r=>g.value=r),class:"version-select"},[(o(!0),n(R,null,V(L.artefactGroup.versions,r=>(o(),n("option",{key:r.version,value:r.version}," Version "+j(r.version),9,qt))),128))],512),[[xt,g.value]])]),e("div",Jt,[e("button",{onClick:F,class:I(["load-btn",{"loaded-data-zone-btn":p.value}]),title:"Load to Data Zone"},[l(ze,{class:"w-3 h-3"}),i[1]||(i[1]=A(" Load DZ "))],2),e("button",{onClick:P,class:I(["load-btn",{"loaded-data-zone-btn":p.value}]),title:"Unload from Data Zone"},[l($e,{class:"w-3 h-3"}),i[2]||(i[2]=A(" Unload DZ "))],2),e("button",{onClick:D,class:I(["load-btn",{"loaded-prompt-btn":L.isLoadedToPrompt}]),title:"Load to Prompt"},[l(ze,{class:"w-3 h-3"}),i[3]||(i[3]=A(" Load PMPT "))],2),e("button",{onClick:$,class:I(["load-btn",{"loaded-prompt-btn":L.isLoadedToPrompt}]),title:"Unload from Prompt"},[l($e,{class:"w-3 h-3"}),i[4]||(i[4]=A(" Unload PMPT "))],2)])])],2))}},Yt=bt(Kt,[["__scopeId","data-v-81fc828c"]]),Qt={class:"flex-1 flex flex-col min-h-0"},es={class:"flex-grow flex flex-col min-h-0"},ts={class:"flex-grow flex min-h-0"},ss={class:"flex-grow flex flex-col min-h-0 p-2"},os={class:"flex-shrink-0 px-1 pb-2 flex items-center justify-between gap-4"},as={class:"flex items-center gap-1"},ns=["disabled"],ls=["disabled"],is={class:"flex-grow min-h-0 border dark:border-gray-700 rounded-md overflow-hidden"},rs={class:"p-2 border-b dark:border-gray-700 flex flex-col"},cs={class:"flex justify-between items-center mb-2 flex-shrink-0"},ds=["disabled"],us=["disabled"],ms={key:0,class:"overflow-y-auto custom-scrollbar min-h-0"},fs={key:0,class:"text-center py-4 text-xs text-gray-500 bg-gray-50 dark:bg-gray-800/50 rounded"},vs={key:1,class:"image-grid"},ps=["src"],ys={class:"image-overlay"},hs=["onClick"],gs=["onClick","title"],bs=["onClick"],xs={key:0,class:"absolute inset-0 bg-blue-500/20 border-2 border-dashed border-blue-500 rounded-lg z-10 flex items-center justify-center"},_s={class:"flex justify-between items-center mb-2 flex-shrink-0"},ks=["disabled"],ws={key:1,class:"flex-grow flex flex-col min-h-0"},Cs={class:"flex-grow min-h-0 overflow-y-auto custom-scrollbar"},$s={key:"artefacts-loading",class:"loading-state"},Ds={key:"artefacts-empty",class:"flex flex-col items-center justify-center h-full text-center p-4 bg-gray-50 dark:bg-gray-800/50 rounded"},As={key:"artefacts-list",class:"artefacts-list space-y-2"},Is={class:"flex-shrink-0 p-2 border-t border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800/50"},Ts={class:"relative flex items-center"},Ms=["onClick"],Ls={class:"truncate"},Ps={class:"p-2 sticky top-0 bg-white dark:bg-gray-800 z-10"},Ss={class:"max-h-60 overflow-y-auto"},Us={class:"category-header"},Zs=["onClick"],zs=["src"],Es={class:"truncate"},Rs={class:"p-2 sticky top-0 bg-white dark:bg-gray-800 z-10"},Vs={class:"max-h-60 overflow-y-auto"},js={class:"category-header"},Gs=["onClick"],Ws=["src"],Fs={class:"truncate"},Bs={key:3,class:"my-1 border-t dark:border-gray-600"},Ns={class:"absolute right-1.5 top-1/2 -translate-y-1/2 flex items-center gap-2"},Os=["disabled","title"],Hs={key:2,class:"ml-2 text-sm"},Xs=["disabled","title"],qs={key:2,class:"ml-2 text-sm"},Js={__name:"DiscussionZone",setup(L){const c=se(),u=me(),x=_t(),f=kt(),k=wt(),{on:g,off:p}=Ct(),{liveDataZoneTokens:T,activeDiscussionArtefacts:S,isLoadingArtefacts:F,promptLoadedArtefacts:D}=ee(c),{lollmsPrompts:P,systemPromptsByZooCategory:$,userPromptsByCategory:z}=ee(f),{availableTtiModels:B}=ee(x),N=m(null),w=m(!1),i=m(!1);m("");const r=m(!1),_=m(!1),E=m(!1),q=m(384),fe=m(!1),oe=m(null),ae=m(null),J=m(!1),O=m(""),He=m(null),ne=m(!1),U=m([]),M=m(-1);let ve=null;const le=m(""),pe=m(""),d=v(()=>c.activeDiscussion),Z=v({get:()=>{var s;return((s=d.value)==null?void 0:s.discussion_data_zone)||""},set:s=>{d.value&&c.setDiscussionDataZoneContent(d.value.id,s)}}),ie=v(()=>{var s;return((s=d.value)==null?void 0:s.discussion_images)||[]}),ye=v(()=>{var s;return((s=d.value)==null?void 0:s.active_discussion_images)||[]}),K=v(()=>{var s;return d.value&&((s=c.activeAiTasks[d.value.id])==null?void 0:s.type)==="summarize"}),Y=v(()=>{var s;return d.value&&((s=c.activeAiTasks[d.value.id])==null?void 0:s.type)==="generate_image"}),he=v(()=>K.value||Y.value),Xe=v(()=>({readOnly:he.value})),qe=v(()=>B.value.length>0),Ie=v(()=>M.value>0),Te=v(()=>M.value<U.value.length-1),ge=v(()=>{if(!S.value||!Array.isArray(S.value))return[];const s=S.value.reduce((t,a)=>(t[a.title]||(t[a.title]={title:a.title,versions:[]}),t[a.title].versions.push(a),t),{});return Object.values(s).forEach(t=>{t.versions.sort((a,y)=>y.version-a.version),t.isAnyVersionLoaded=t.versions.some(a=>a.is_loaded)}),Object.values(s)}),be=v(()=>{if(!Array.isArray(P.value))return[];const s=le.value.toLowerCase();return s?P.value.filter(t=>t.name.toLowerCase().includes(s)):P.value}),Me=v(()=>{const s=le.value.toLowerCase(),t=z.value;if(!t||typeof t!="object")return{};if(!s)return t;const a={};for(const y in t){const h=t[y].filter(H=>H.name.toLowerCase().includes(s));h.length>0&&(a[y]=h)}return a}),Le=v(()=>{const s=pe.value.toLowerCase(),t=$.value;if(!t||typeof t!="object")return{};if(!s)return t;const a={};for(const y in t){const h=t[y].filter(H=>H.name.toLowerCase().includes(s));h.length>0&&(a[y]=h)}return a});function Je(s){U.value=[s],M.value=0}function Ke(s){clearTimeout(ve),ve=setTimeout(()=>{U.value[M.value]!==s&&(M.value<U.value.length-1&&U.value.splice(M.value+1),U.value.push(s),M.value++)},750)}async function Ye(){Ie.value&&(w.value=!0,M.value--,Z.value=U.value[M.value],await we(),w.value=!1)}async function Qe(){Te.value&&(w.value=!0,M.value++,Z.value=U.value[M.value],await we(),w.value=!1)}Ee(Z,s=>{w.value||Ke(s)}),Ee(d,(s,t)=>{s&&(!t||s.id!==t.id)&&Je(s.discussion_data_zone||"")},{immediate:!0,deep:!0});function et(s){fe.value=!0;const t=s.clientX,a=q.value;document.body.style.cursor="col-resize",document.body.style.userSelect="none";function y(H){var Ze;if(!fe.value)return;const yt=H.clientX-t,ht=a-yt,gt=(((Ze=document.querySelector(".flex-grow.flex.min-h-0"))==null?void 0:Ze.clientWidth)||window.innerWidth)*.75;q.value=Math.min(ht,gt)}function h(){fe.value=!1,document.body.style.cursor="",document.body.style.userSelect="",window.removeEventListener("mousemove",y),window.removeEventListener("mouseup",h),localStorage.setItem("lollms_artefactListWidth",q.value)}window.addEventListener("mousemove",y),window.addEventListener("mouseup",h)}function tt(){d.value&&c.cloneDiscussion(d.value.id)}function st(){d.value&&u.openModal("contextToArtefact")}function ot(){d.value&&c.refreshDataZones(d.value.id)}async function at(){await u.showConfirmation({title:"Delete All Images?",message:"This will remove all images from this discussion's context.",confirmText:"Delete All"})&&c.deleteAllDiscussionImages()}function nt(){var s;(s=ae.value)==null||s.click()}async function lt(s){const t=Array.from(s.target.files);if(!(!t.length||!d.value)){J.value=!0;try{await Promise.all(t.map(a=>c.uploadDiscussionImage(a)))}finally{J.value=!1,ae.value&&(ae.value.value="")}}}function it(){d.value&&c.fetchArtefacts(d.value.id)}async function rt(){if(!d.value)return;await u.showConfirmation({title:"Load All Artefacts?",message:`This will clear the current Discussion Data Zone and load all ${ge.value.length} artefact(s).`,confirmText:"Load All"})&&c.loadAllArtefactsToContext(d.value.id)}function ct(){d.value&&u.openModal("artefactEditor",{discussionId:d.value.id})}function Pe(){var s;(s=oe.value)==null||s.click()}async function Se(s){const t=Array.from(s.target.files||[]);if(!(!t.length||!d.value)){r.value=!0;try{await Promise.all(t.map(a=>c.addArtefact({discussionId:d.value.id,file:a})))}finally{r.value=!1,oe.value&&(oe.value.value="")}}}function dt(s){s.currentTarget.contains(s.relatedTarget)||(ne.value=!1)}async function ut(s){ne.value=!1;const t=Array.from(s.dataTransfer.files);t.length&&await Se({target:{files:t}})}function mt(){d.value&&c.summarizeDiscussionDataZone(d.value.id,O.value)}function ft(){if(!d.value)return;let s=O.value.trim()||Z.value.trim();if(!s){u.addNotification("Please provide a prompt to generate an image.","warning");return}c.generateImageFromDataZone(d.value.id,s)}function xe(s){/@<.*?>@/g.test(s)?u.openModal("fillPlaceholders",{promptTemplate:s,onConfirm:t=>{O.value=t}}):O.value=s}function vt(){k.push({path:"/settings",query:{tab:"prompts"}})}function _e(s){return!ye.value||ye.value.length<=s||ye.value[s]}function Ue({discussionId:s,newContent:t}){d.value&&d.value.id===s&&pt(t)}function pt(s){Z.value!==s&&(clearTimeout(ve),M.value<U.value.length-1&&U.value.splice(M.value+1),U.value.push(s),M.value++,w.value=!0,Z.value=s,we(()=>{w.value=!1}))}return We(()=>{const s=localStorage.getItem("lollms_artefactListWidth");s&&(q.value=parseInt(s,10)),g("discussion:dataZoneUpdated",Ue)}),$t(()=>{p("discussion:dataZoneUpdated",Ue)}),(s,t)=>(o(),n("div",Qt,[e("div",es,[e("input",{type:"file",ref_key:"artefactFileInput",ref:oe,onChange:Se,multiple:"",class:"hidden"},null,544),e("input",{type:"file",ref_key:"discussionImageInput",ref:ae,onChange:lt,class:"hidden",accept:"image/*,application/pdf",multiple:""},null,544),e("div",ts,[e("div",ss,[e("div",os,[e("div",as,[e("button",{onClick:Ye,class:"action-btn-sm",title:"Undo",disabled:!Ie.value},[l(Ne,{class:"w-4 h-4"})],8,ns),e("button",{onClick:Qe,class:"action-btn-sm",title:"Redo",disabled:!Te.value},[l(Oe,{class:"w-4 h-4"})],8,ls),t[13]||(t[13]=e("div",{class:"w-px h-5 bg-gray-200 dark:bg-gray-600 mx-1"},null,-1)),e("button",{onClick:tt,class:"action-btn-sm",title:"Clone Discussion & Artefacts"},[l(Dt,{class:"w-4 h-4"})]),e("button",{onClick:st,class:"action-btn-sm",title:"Save as Artefact"},[l(Rt,{class:"w-4 h-4"})]),e("button",{onClick:ot,class:"action-btn-sm",title:"Refresh Data"},[l(Re,{class:"w-4 h-4"})]),e("button",{onClick:t[0]||(t[0]=a=>Z.value=""),class:"action-btn-sm-danger",title:"Clear All Text"},[l(ue,{class:"w-4 h-4"})])])]),e("div",is,[l(De,{ref_key:"discussionCodeMirrorEditor",ref:N,modelValue:Z.value,"onUpdate:modelValue":t[1]||(t[1]=a=>Z.value=a),class:"h-full",options:Xe.value},null,8,["modelValue","options"])])]),e("div",{onMousedown:G(et,["prevent"]),class:"resizer"},null,32),e("div",{style:Fe({width:`${q.value}px`}),class:"flex-shrink-0 border-l border-gray-200 dark:border-gray-700 flex flex-col h-full min-w-[256px]"},[e("div",rs,[e("div",cs,[e("button",{onClick:t[2]||(t[2]=a=>_.value=!_.value),class:"flex items-center gap-2 text-sm font-semibold w-full text-left"},[l(Ve,{class:"w-4 h-4"}),t[14]||(t[14]=A()),t[15]||(t[15]=e("span",null,"Images",-1)),l(je,{class:I(["w-4 h-4 ml-auto transition-transform",{"rotate-90":!_.value}])},null,8,["class"])]),e("div",{onClick:t[3]||(t[3]=G(()=>{},["stop"])),class:"flex items-center gap-1"},[e("button",{onClick:at,class:"action-btn-sm-danger",title:"Delete All Images",disabled:ie.value.length===0},[l(ue,{class:"w-4 h-4"})],8,ds),e("button",{onClick:nt,class:"action-btn-sm",title:"Add Image(s)",disabled:J.value},[J.value?(o(),b(X,{key:0,class:"w-4 h-4 animate-spin"})):(o(),b(te,{key:1,class:"w-4 h-4"}))],8,us)])]),_.value?C("",!0):(o(),n("div",ms,[ie.value.length===0&&!J.value?(o(),n("div",fs,"No images yet")):(o(),n("div",vs,[(o(!0),n(R,null,V(ie.value,(a,y)=>(o(),n("div",{key:a.substring(0,20)+y,class:"image-card group"},[e("img",{src:"data:image/png;base64,"+a,class:I(["image-thumbnail",{"grayscale opacity-50":!_e(y)}])},null,10,ps),e("div",ys,[e("button",{onClick:h=>{W(u).openImageViewer("data:image/png;base64,"+a)},class:"overlay-btn",title:"View"},[l(Be,{class:"w-3 h-3"})],8,hs),e("button",{onClick:h=>W(c).toggleDiscussionImageActivation(y),class:"overlay-btn",title:_e(y)?"Deactivate":"Activate"},[_e(y)?(o(),b(At,{key:0,class:"w-3 h-3"})):(o(),b(It,{key:1,class:"w-3 h-3"}))],8,gs),e("button",{onClick:h=>W(c).deleteDiscussionImage(y),class:"overlay-btn overlay-btn-danger",title:"Delete"},[l(Tt,{class:"w-3 h-3"})],8,bs)])]))),128))]))]))]),e("div",{onDragover:t[7]||(t[7]=G(a=>ne.value=!0,["prevent"])),onDragleave:G(dt,["prevent"]),onDrop:G(ut,["prevent"]),class:"p-2 flex flex-col min-h-0 flex-grow relative"},[ne.value?(o(),n("div",xs,t[16]||(t[16]=[e("p",{class:"font-semibold text-blue-600"},"Drop files to upload",-1)]))):C("",!0),e("div",_s,[e("button",{onClick:t[4]||(t[4]=a=>E.value=!E.value),class:"flex items-center gap-2 text-sm font-semibold w-full text-left"},[l(Ce,{class:"w-4 h-4"}),t[17]||(t[17]=A()),t[18]||(t[18]=e("span",null,"Artefacts",-1)),l(je,{class:I(["w-4 h-4 ml-auto transition-transform",{"rotate-90":!E.value}])},null,8,["class"])]),e("div",{onClick:t[6]||(t[6]=G(()=>{},["stop"])),class:"flex items-center gap-1"},[e("button",{onClick:it,class:"action-btn-sm",title:"Refresh Artefacts"},[l(Re,{class:I(["w-4 h-4",{"animate-spin":W(F)}])},null,8,["class"])]),e("button",{onClick:rt,class:"action-btn-sm",title:"Load All Artefacts to Context"},[l(jt,{class:"w-4 h-4"})]),e("button",{onClick:ct,class:"action-btn-sm",title:"Create Artefact"},[l(te,{class:"w-4 h-4"})]),e("button",{onClick:t[5]||(t[5]=a=>i.value=!i.value),class:I(["action-btn-sm",{"bg-gray-200 dark:bg-gray-700":i.value}]),title:"Import from URL"},[l(Vt,{class:"w-4 h-4"})],2),e("button",{onClick:Pe,class:"action-btn-sm",title:"Upload Artefact",disabled:r.value},[r.value?(o(),b(X,{key:0,class:"w-4 h-4 animate-spin"})):(o(),b(Mt,{key:1,class:"w-4 h-4"}))],8,ks)])]),E.value?C("",!0):(o(),n("div",ws,[e("div",Cs,[W(F)?(o(),n("div",$s,[l(X,{class:"w-6 h-6 text-gray-400 animate-spin mx-auto mb-2"}),t[19]||(t[19]=e("p",{class:"text-xs text-gray-500"},"Loading...",-1))])):ge.value.length===0?(o(),n("div",Ds,[l(Ce,{class:"w-10 h-10 text-gray-400 mb-2"}),t[21]||(t[21]=e("p",{class:"text-xs text-gray-500 mb-3"},"No artefacts yet",-1)),e("button",{onClick:Pe,class:"btn btn-secondary btn-sm"},[l(te,{class:"w-3 h-3 mr-1"}),t[20]||(t[20]=A("Add Artefact"))])])):(o(),n("div",As,[(o(!0),n(R,null,V(ge.value,a=>(o(),b(Yt,{key:a.title,"artefact-group":a},null,8,["artefact-group"]))),128))]))])]))],32)],4)])]),e("div",Is,[e("div",Ts,[l(Lt,{title:"Prompts",icon:"ticket",collection:"ui","button-class":"btn-icon absolute left-1.5 top-1/2 -translate-y-1/2 z-10"},{default:re(()=>[be.value.length>0?(o(),b(ke,{key:0,title:"Default",icon:"lollms",collection:"ui"},{default:re(()=>[(o(!0),n(R,null,V(be.value,a=>(o(),n("button",{key:a.id,onClick:y=>xe(a.content),class:"menu-item text-sm"},[e("span",Ls,j(a.name),1)],8,Ms))),128))]),_:1})):C("",!0),Object.keys(W(z)).length>0?(o(),b(ke,{key:1,title:"User",icon:"user",collection:"ui"},{default:re(()=>[e("div",Ps,[Q(e("input",{type:"text","onUpdate:modelValue":t[8]||(t[8]=a=>le.value=a),onClick:t[9]||(t[9]=G(()=>{},["stop"])),placeholder:"Search user prompts...",class:"input-field w-full text-sm"},null,512),[[ce,le.value]])]),t[23]||(t[23]=A()),e("div",Ss,[(o(!0),n(R,null,V(Me.value,(a,y)=>(o(),n("div",{key:y},[e("h3",Us,j(y),1),t[22]||(t[22]=A()),(o(!0),n(R,null,V(a,h=>(o(),n("button",{key:h.id,onClick:H=>xe(h.content),class:"menu-item text-sm"},[h.icon?(o(),n("img",{key:0,src:h.icon,class:"h-5 w-5 rounded-md object-cover mr-2 flex-shrink-0",alt:"Icon"},null,8,zs)):C("",!0),e("span",Es,j(h.name),1)],8,Zs))),128))]))),128))])]),_:1})):C("",!0),Object.keys(W($)).length>0?(o(),b(ke,{key:2,title:"Zoo",icon:"server",collection:"ui"},{default:re(()=>[e("div",Rs,[Q(e("input",{type:"text","onUpdate:modelValue":t[10]||(t[10]=a=>pe.value=a),onClick:t[11]||(t[11]=G(()=>{},["stop"])),placeholder:"Search zoo...",class:"input-field w-full text-sm"},null,512),[[ce,pe.value]])]),t[25]||(t[25]=A()),e("div",Vs,[(o(!0),n(R,null,V(Le.value,(a,y)=>(o(),n("div",{key:y},[e("h3",js,j(y),1),t[24]||(t[24]=A()),(o(!0),n(R,null,V(a,h=>(o(),n("button",{key:h.id,onClick:H=>xe(h.content),class:"menu-item text-sm"},[h.icon?(o(),n("img",{key:0,src:h.icon,class:"h-5 w-5 rounded-md object-cover mr-2 flex-shrink-0",alt:"Icon"},null,8,Ws)):C("",!0),e("span",Fs,j(h.name),1)],8,Gs))),128))]))),128))])]),_:1})):C("",!0),be.value.length+Object.keys(Me.value).length+Object.keys(Le.value).length>0?(o(),n("div",Bs)):C("",!0),e("button",{onClick:vt,class:"menu-item text-sm font-medium text-blue-600 dark:text-blue-400"},"Manage My Prompts...")]),_:1}),Q(e("textarea",{ref_key:"dataZonePromptTextareaRef",ref:He,"onUpdate:modelValue":t[12]||(t[12]=a=>O.value=a),placeholder:"Enter a prompt to process content...",class:"enhanced-textarea w-full !pl-10 !pr-24"},null,512),[[ce,O.value]]),e("div",Ns,[qe.value&&!K.value?(o(),n("button",{key:0,onClick:ft,class:"btn btn-primary !py-2 !px-3 flex items-center",disabled:he.value||!Z.value.trim()&&!O.value.trim(),title:Y.value?"Generating image...":"Generate an image using the prompt"},[Y.value?(o(),b(X,{key:0,class:"w-5 h-5 animate-spin"})):(o(),b(Ve,{key:1,class:"w-5 h-5"})),Y.value?(o(),n("span",Hs,"Generating...")):C("",!0)],8,Os)):C("",!0),Y.value?C("",!0):(o(),n("button",{key:1,onClick:mt,class:"btn btn-secondary !py-2 !px-3 flex items-center",disabled:he.value||!Z.value.trim()&&ie.value.length===0&&!O.value.trim(),title:K.value?"Processing text...":"Process the text in the data zone using the prompt"},[K.value?(o(),b(X,{key:0,class:"w-5 h-5 animate-spin"})):(o(),b(Ae,{key:1,class:"w-5 h-5"})),K.value?(o(),n("span",qs,"Processing...")):C("",!0)],8,Xs))])])])]))}},Ks={class:"flex-1 flex flex-col min-h-0"},Ys={class:"flex-shrink-0 px-3 py-2 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between gap-4"},Qs={class:"flex items-center gap-1"},eo=["disabled"],to=["disabled"],so={class:"flex-grow min-h-0 p-2"},oo={__name:"UserZone",setup(L){const c=Pt(),u=v({get:()=>{var p;return((p=c.user)==null?void 0:p.data_zone)||""},set:p=>{c.updateDataZone(p)}}),x=m(!1),f=m(!1),k=()=>{},g=()=>{};return(p,T)=>(o(),n("div",Ks,[e("div",Ys,[T[1]||(T[1]=e("span",{class:"text-sm font-medium text-gray-600 dark:text-gray-300"},"Global User Context",-1)),e("div",Qs,[e("button",{onClick:k,class:"action-btn-sm",title:"Undo",disabled:!x.value},[l(Ne,{class:"w-4 h-4"})],8,eo),e("button",{onClick:g,class:"action-btn-sm",title:"Redo",disabled:!f.value},[l(Oe,{class:"w-4 h-4"})],8,to)])]),e("div",so,[l(De,{modelValue:u.value,"onUpdate:modelValue":T[0]||(T[0]=S=>u.value=S),class:"h-full border dark:border-gray-700 rounded-md"},null,8,["modelValue"])])]))}},ao={class:"flex-1 flex flex-col min-h-0 p-2"},no={class:"flex-grow min-h-0 border dark:border-gray-700 rounded-md overflow-hidden"},lo={__name:"PersonalityZone",setup(L){const c=se(),u=v(()=>c.activeDiscussion),x=v(()=>{var k;return((k=u.value)==null?void 0:k.personality_data_zone)||""}),f={readOnly:!0};return(k,g)=>(o(),n("div",ao,[e("div",no,[l(De,{modelValue:x.value,"onUpdate:modelValue":g[0]||(g[0]=p=>x.value=p),class:"h-full",options:f},null,8,["modelValue"])])]))}},io={class:"flex-1 flex flex-col min-h-0"},ro={class:"flex-shrink-0 px-3 py-2 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between gap-4"},co={class:"flex-grow min-h-0 flex"},uo={class:"flex-grow flex flex-col min-w-0 p-2"},mo={class:"flex-grow min-h-0 border dark:border-gray-700 rounded-md overflow-hidden"},fo={class:"rendered-prose-container h-full p-2"},vo={class:"w-64 flex-shrink-0 border-l border-gray-200 dark:border-gray-700 flex flex-col p-2"},po={class:"sidebar-section"},yo={class:"section-header"},ho={class:"section-title"},go={class:"section-actions"},bo={class:"px-1 pb-2"},xo={class:"section-content flex-grow min-h-0 overflow-y-auto"},_o={key:0,class:"loading-state"},ko={key:1,class:"empty-state"},wo={key:2,class:"memories-list space-y-2"},Co={class:"memory-header"},$o={class:"memory-info"},Do={class:"memory-details"},Ao=["title"],Io={class:"memory-actions"},To=["onClick"],Mo=["onClick"],Lo={class:"memory-controls"},Po=["onClick"],So=["onClick"],Uo={__name:"MemoryZone",setup(L){const c=se(),u=Gt(),x=me(),{memories:f,isLoading:k}=ee(u),g=m(""),p=m(new Set),T=v(()=>c.activeDiscussion),S=v(()=>{var i;return T.value&&((i=c.activeAiTasks[T.value.id])==null?void 0:i.type)==="memorize"}),F=v(()=>f.value.filter(i=>p.value.has(i.title)).map(i=>`--- Memory: ${i.title} ---
${i.content}
--- End Memory: ${i.title} ---`).join(`

`)),D=v(()=>{if(!g.value)return f.value;const i=g.value.toLowerCase();return f.value.filter(r=>r.title.toLowerCase().includes(i)||r.content.toLowerCase().includes(i))});function P(){T.value&&c.memorizeLTM(T.value.id)}function $(){x.openModal("memoryEditor")}function z(i){x.openModal("memoryEditor",{memory:i})}async function B(i){const r=f.value.find(E=>E.id===i);if(!r)return;await x.showConfirmation({title:`Delete Memory '${r.title}'?`,message:"This will permanently delete this memory from your memory bank.",confirmText:"Delete"})&&await u.deleteMemory(i)}function N(i){p.value.add(i),x.addNotification(`Memory "${i}" loaded to context`,"success")}function w(i){p.value.delete(i),x.addNotification(`Memory "${i}" removed from context`,"info")}return(i,r)=>(o(),n("div",io,[e("div",ro,[r[2]||(r[2]=e("span",{class:"text-sm font-medium text-gray-600 dark:text-gray-300"},"Long-Term Memory",-1)),e("button",{onClick:P,class:"btn btn-secondary btn-sm",title:"Memorize Current Discussion"},[l(Ae,{class:I(["w-4 h-4 mr-1.5",{"animate-pulse":S.value}])},null,8,["class"]),r[1]||(r[1]=A("Memorize "))])]),e("div",co,[e("div",uo,[e("div",mo,[e("div",fo,[l(St,{content:F.value},null,8,["content"])])])]),e("div",vo,[e("div",po,[e("div",yo,[e("h4",ho,[l(de,{class:"w-4 h-4"}),r[3]||(r[3]=A(" Memory Bank"))]),e("div",go,[e("button",{onClick:$,class:"action-btn-sm",title:"Create New Memory"},[l(te,{class:"w-4 h-4"})])])]),e("div",bo,[Q(e("input",{type:"text","onUpdate:modelValue":r[0]||(r[0]=_=>g.value=_),placeholder:"Search memories...",class:"w-full px-2 py-1.5 text-xs bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-md focus:ring-1 focus:ring-yellow-500 focus:border-yellow-500"},null,512),[[ce,g.value]])]),e("div",xo,[W(k)?(o(),n("div",_o,[l(X,{class:"w-6 h-6 text-gray-400 animate-spin mx-auto mb-2"}),r[4]||(r[4]=e("p",{class:"text-xs text-gray-500"},"Loading...",-1))])):D.value.length===0?(o(),n("div",ko,[l(de,{class:"w-8 h-8 text-gray-400 mx-auto mb-2"}),r[5]||(r[5]=e("p",{class:"text-xs text-gray-500 mb-3"},"No memories",-1))])):(o(),n("div",wo,[(o(!0),n(R,null,V(D.value,_=>(o(),n("div",{key:_.id,class:"memory-card"},[e("div",Co,[e("div",$o,[e("div",{class:I(["memory-icon",{loaded:p.value.has(_.title)}])},[l(de,{class:"w-4 h-4"})],2),e("div",Do,[e("h5",{class:"memory-title",title:_.title},j(_.title),9,Ao)])]),e("div",Io,[e("button",{onClick:E=>z(_),class:"memory-action-btn",title:"Edit Memory"},[l(Ge,{class:"w-3 h-3"})],8,To),e("button",{onClick:E=>B(_.id),class:"memory-action-btn memory-action-btn-danger",title:"Delete Memory"},[l(ue,{class:"w-3 h-3"})],8,Mo)])]),e("div",Lo,[p.value.has(_.title)?(o(),n("button",{key:0,onClick:E=>w(_.title),class:"memory-load-btn loaded",title:"Remove from Context"},[l($e,{class:"w-3 h-3"}),r[6]||(r[6]=A("In Context"))],8,Po)):(o(),n("button",{key:1,onClick:E=>N(_.title),class:"memory-load-btn",title:"Add to Context"},[l(te,{class:"w-3 h-3"}),r[7]||(r[7]=A("Add to Context"))],8,So))])]))),128))]))])])])])]))}},Zo={class:"h-full flex flex-col bg-white dark:bg-gray-800 shadow-xl flex-grow min-w-0"},zo={class:"flex-shrink-0 bg-gray-50 dark:bg-gray-800/50 border-b border-gray-200 dark:border-gray-700"},Eo={class:"flex items-center justify-between px-2"},Ro={class:"flex space-x-1","aria-label":"Data Zone Tabs"},Vo=["onClick"],jo={key:0,class:"px-1.5 py-0.5 bg-gray-200 dark:bg-gray-600 text-xs rounded-full font-mono"},Go=["title"],qo={__name:"DataZone",setup(L){const c=me(),u=se(),{liveDataZoneTokens:x}=ee(u),f=m("discussion"),k=m(768),g=m(!1),p=v(()=>c.isDataZoneExpanded),T=D=>D>1e3?`${(D/1e3).toFixed(1)}K`:D.toString(),S=v(()=>[{id:"discussion",label:"Discussion",icon:Ut,tokenCount:x.value.discussion},{id:"user",label:"User",icon:Zt,tokenCount:x.value.user},{id:"personality",label:"Personality",icon:Ae,tokenCount:x.value.personality},{id:"ltm",label:"Memory",icon:de,tokenCount:x.value.memory}]);function F(D){g.value=!0;const P=D.clientX,$=k.value;document.body.style.cursor="col-resize",document.body.style.userSelect="none";function z(N){if(!g.value)return;const w=N.clientX-P,i=$-w,r=320,_=window.innerWidth*.75;k.value=Math.max(r,Math.min(i,_))}function B(){g.value=!1,document.body.style.cursor="",document.body.style.userSelect="",window.removeEventListener("mousemove",z),window.removeEventListener("mouseup",B),localStorage.setItem("lollms_dataZoneWidth",k.value)}window.addEventListener("mousemove",z),window.addEventListener("mouseup",B)}return We(()=>{const D=localStorage.getItem("lollms_dataZoneWidth");D&&(k.value=parseInt(D,10))}),(D,P)=>(o(),n("div",{class:I(["relative h-full flex",[p.value?"w-full":"flex-shrink-0"]]),style:Fe(p.value?{}:{width:`${k.value}px`})},[e("div",{onMousedown:G(F,["prevent"]),class:"flex-shrink-0 w-2 cursor-col-resize bg-gray-200 dark:bg-gray-700 hover:bg-blue-400 transition-colors duration-200"},null,32),e("aside",Zo,[e("div",zo,[e("div",Eo,[e("nav",Ro,[(o(!0),n(R,null,V(S.value,$=>(o(),n("button",{key:$.id,onClick:z=>f.value=$.id,class:I(["flex items-center gap-2 px-3 py-2.5 text-sm font-medium rounded-t-md border-b-2",f.value===$.id?"border-blue-500 text-blue-600 dark:text-blue-400 bg-white dark:bg-gray-800":"border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200"])},[(o(),b(zt($.icon),{class:"w-4 h-4"})),e("span",null,j($.label),1),$.tokenCount>0?(o(),n("span",jo,j(T($.tokenCount)),1)):C("",!0)],10,Vo))),128))]),e("button",{onClick:P[0]||(P[0]=$=>W(c).toggleDataZoneExpansion()),class:"action-btn",title:p.value?"Shrink":"Expand"},[p.value?(o(),b(Et,{key:0,class:"w-5 h-5"})):(o(),b(Be,{key:1,class:"w-5 h-5"}))],8,Go)])]),f.value==="discussion"?(o(),b(Js,{key:0})):C("",!0),f.value==="user"?(o(),b(oo,{key:1})):C("",!0),f.value==="personality"?(o(),b(lo,{key:2})):C("",!0),f.value==="ltm"?(o(),b(Uo,{key:3})):C("",!0)])],6))}};export{qo as default};
