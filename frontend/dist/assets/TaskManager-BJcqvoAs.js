import{av as _,s as h,r as w,o as T,c as C,w as S,b as a,e as r,f as e,p as d,h as p,y as c,aw as D,C as u,E as L,F as y,x as k,t as o,am as R,d as I}from"./index-DAkTFgzy.js";const N={class:"space-y-6"},A={class:"flex items-center justify-between"},B=["disabled"],E={class:"grid grid-cols-1 md:grid-cols-3 gap-6"},M={class:"md:col-span-1 bg-white dark:bg-gray-800 rounded-lg shadow-sm overflow-hidden"},V={class:"max-h-[60vh] overflow-y-auto"},j={key:0,class:"p-4 text-center text-gray-500"},F={key:1,class:"p-4 text-center text-gray-500"},z={key:2,class:"divide-y dark:divide-gray-700"},O=["onClick"],P={class:"flex justify-between items-center mb-1"},$=["title"],q={class:"w-full bg-gray-200 rounded-full h-1.5 dark:bg-gray-600"},G={class:"md:col-span-2 bg-white dark:bg-gray-800 rounded-lg shadow-sm"},H={key:0,class:"h-full flex items-center justify-center"},J={key:1,class:"flex flex-col h-full"},K={class:"p-4 border-b dark:border-gray-700"},Q={class:"font-semibold truncate"},U={class:"text-xs text-gray-500 dark:text-gray-400"},W={class:"p-4 space-y-2 text-sm"},X={key:0,class:"text-red-500 p-2 bg-red-50 dark:bg-red-900/20 rounded"},Y={class:"flex-grow p-4 border-t dark:border-gray-700 overflow-hidden flex flex-col"},Z={class:"flex-grow bg-gray-100 dark:bg-gray-900 rounded p-2 overflow-y-auto font-mono text-xs"},ee={class:"text-gray-400 mr-2"},le={__name:"TaskManager",setup(te){const i=_(),{tasks:f,isLoadingTasks:b}=h(i),l=w(null);T(()=>{i.fetchTasks()});const g=C(()=>Array.isArray(f.value)?[...f.value].sort((n,t)=>new Date(t.created_at)-new Date(n.created_at)):[]);S(g,n=>{if(l.value&&!n.some(t=>t.id===l.value.id))l.value=null;else if(l.value){const t=n.find(s=>s.id===l.value.id);t&&(l.value=t)}});function v(n){return n?new Date(n).toLocaleString():"N/A"}function m(n){switch(n){case"running":return{color:"blue",text:"Running"};case"completed":return{color:"green",text:"Completed"};case"failed":return{color:"red",text:"Failed"};case"cancelled":return{color:"yellow",text:"Cancelled"};case"pending":default:return{color:"gray",text:"Pending"}}}return(n,t)=>(r(),a("div",N,[e("div",A,[t[3]||(t[3]=e("div",null,[e("h2",{class:"text-xl font-bold"},"Background Task Manager"),e("p",{class:"text-sm text-gray-500"},"Monitor and manage background processes like installations.")],-1)),e("div",null,[e("button",{onClick:t[0]||(t[0]=(...s)=>d(i).fetchTasks&&d(i).fetchTasks(...s)),class:"btn btn-secondary mr-2",disabled:d(b)},[p(D,{class:c(["w-4 h-4",{"animate-spin":d(b)}])},null,8,["class"])],8,B),e("button",{onClick:t[1]||(t[1]=(...s)=>d(i).clearCompletedTasks&&d(i).clearCompletedTasks(...s)),class:"btn btn-danger"},[p(L,{class:"w-4 h-4 mr-2"}),t[2]||(t[2]=u(" Clear Completed "))])])]),e("div",E,[e("div",M,[t[4]||(t[4]=e("div",{class:"p-4 border-b dark:border-gray-700"},[e("h3",{class:"font-semibold"},"Tasks")],-1)),e("div",V,[d(b)&&g.value.length===0?(r(),a("div",j,"Loading...")):g.value.length===0?(r(),a("div",F,"No tasks found.")):(r(),a("ul",z,[(r(!0),a(y,null,k(g.value,s=>(r(),a("li",{key:s.id},[e("button",{onClick:x=>l.value=s,class:c(["w-full text-left p-4 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors",{"bg-blue-50 dark:bg-blue-900/30":l.value&&l.value.id===s.id}])},[e("div",P,[e("p",{class:"font-medium truncate",title:s.name},o(s.name),9,$),e("span",{class:c(["text-xs px-2 py-0.5 rounded-full",{"bg-blue-100 text-blue-800 dark:bg-blue-900/50 dark:text-blue-300":s.status==="running","bg-green-100 text-green-800 dark:bg-green-900/50 dark:text-green-300":s.status==="completed","bg-red-100 text-red-800 dark:bg-red-900/50 dark:text-red-300":s.status==="failed","bg-yellow-100 text-yellow-800 dark:bg-yellow-900/50 dark:text-yellow-300":s.status==="cancelled","bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300":s.status==="pending"}])},o(m(s.status).text),3)]),e("div",q,[e("div",{class:c(["h-1.5 rounded-full",{"bg-blue-500":s.status==="running","bg-green-500":s.status==="completed","bg-red-500":s.status==="failed"}]),style:R({width:s.progress+"%"})},null,6)])],10,O)]))),128))]))])]),e("div",G,[l.value?(r(),a("div",J,[e("div",K,[e("h3",Q,o(l.value.name),1),e("p",U,"ID: "+o(l.value.id),1)]),e("div",W,[e("p",null,[t[6]||(t[6]=e("strong",null,"Status:",-1)),u(" "+o(m(l.value.status).text),1)]),e("p",null,[t[7]||(t[7]=e("strong",null,"Created:",-1)),u(" "+o(v(l.value.created_at)),1)]),e("p",null,[t[8]||(t[8]=e("strong",null,"Started:",-1)),u(" "+o(v(l.value.started_at)),1)]),e("p",null,[t[9]||(t[9]=e("strong",null,"Completed:",-1)),u(" "+o(v(l.value.completed_at)),1)]),l.value.error?(r(),a("div",X,[t[10]||(t[10]=e("strong",null,"Error:",-1)),u(" "+o(l.value.error),1)])):I("",!0)]),e("div",Y,[t[11]||(t[11]=e("h4",{class:"font-semibold mb-2 flex-shrink-0"},"Logs",-1)),e("div",Z,[(r(!0),a(y,null,k(l.value.logs,(s,x)=>(r(),a("p",{key:x,class:c({"text-red-500":s.level==="CRITICAL"||s.level==="ERROR"})},[e("span",ee,o(new Date(s.timestamp).toLocaleTimeString()),1),e("span",null,o(s.message),1)],2))),128))])])])):(r(),a("div",H,t[5]||(t[5]=[e("p",{class:"text-gray-500"},"Select a task to view its details and logs.",-1)])))])])]))}};export{le as default};
