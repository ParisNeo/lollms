import{r as S,c as C,b as r,d as o,h as t,F as b,m as x,e as w,cK as H,a5 as J,l as f,v as D,a8 as z,P as N,j as M,k as W,ad as Q,c7 as X,a as Y,ae as Z,o as ee,w as T,g as A,n as v,q as te,t as g,$ as P,G as le,a3 as ae,c2 as F,i as se}from"./index-SgmW0kWi.js";import{I as oe}from"./IconArrowUp-D2j7XCF5.js";import{I as re}from"./IconLock-kwmkanHA.js";const ne={class:"space-y-2"},ie=["value","onInput"],de=["onClick","disabled"],ue=["onClick","disabled"],ce=["onClick"],pe={class:"flex items-center gap-2"},ye=["onKeyup"],ve={__name:"StringListEditor",props:{modelValue:{type:[String,Array],default:""}},emits:["update:modelValue"],setup(j,{emit:p}){const I=j,V=p,a=S(""),i=C({get:()=>{const u=I.modelValue;return Array.isArray(u)?u.map(d=>String(d).trim()).filter(d=>d):typeof u=="string"?(u||"").split(",").map(d=>d.trim()).filter(d=>d):[]},set:u=>{V("update:modelValue",u.join(", "))}});function m(){a.value.trim()&&!i.value.includes(a.value.trim())&&(i.value=[...i.value,a.value.trim()],a.value="")}function U(u){const d=[...i.value];d.splice(u,1),i.value=d}function k(u,d){const y=[...i.value],c=u+d;c>=0&&c<y.length&&([y[u],y[c]]=[y[c],y[u]],i.value=y)}return(u,d)=>(o(),r("div",ne,[(o(!0),r(b,null,x(i.value,(y,c)=>(o(),r("div",{key:c,class:"flex items-center gap-2"},[t("input",{type:"text",value:y,onInput:_=>{const $=[...i.value];$[c]=_.target.value,i.value=$},class:"input-field flex-grow"},null,40,ie),t("button",{onClick:_=>k(c,-1),disabled:c===0,class:"btn-icon",type:"button",title:"Move Up"},[w(oe,{class:"w-4 h-4"})],8,de),t("button",{onClick:_=>k(c,1),disabled:c===i.value.length-1,class:"btn-icon",type:"button",title:"Move Down"},[w(H,{class:"w-4 h-4"})],8,ue),t("button",{onClick:_=>U(c),class:"btn-icon-danger",type:"button",title:"Remove"},[w(J,{class:"w-4 h-4"})],8,ce)]))),128)),t("div",pe,[f(t("input",{type:"text","onUpdate:modelValue":d[0]||(d[0]=y=>a.value=y),onKeyup:z(N(m,["prevent"]),["enter"]),class:"input-field flex-grow",placeholder:"Add new origin"},null,40,ye),[[D,a.value]]),t("button",{onClick:m,class:"btn btn-secondary",type:"button"},[w(W,{class:"w-4 h-4 mr-1"}),d[1]||(d[1]=M(" Add"))])])]))}},ge={class:"bg-white dark:bg-gray-800 shadow-md rounded-lg"},be={class:"space-y-12"},fe={key:0},me={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},ke=["for"],_e={key:1,class:"flex items-center justify-between bg-gray-50 dark:bg-gray-700/30 p-3 rounded-lg border dark:border-gray-600"},he={class:"text-sm text-gray-700 dark:text-gray-300"},xe=["onClick"],we=["type","step","id","onUpdate:modelValue","readonly"],Se={class:"border-t pt-8 dark:border-gray-700"},Ce={class:"settings-category-title flex items-center gap-2 mb-6"},Ie={class:"bg-gray-50 dark:bg-gray-700/20 p-6 rounded-xl border dark:border-gray-700"},Ve={class:"flex items-center justify-between mb-6 pb-6 border-b dark:border-gray-600"},Ue={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},$e={class:"flex gap-2 mt-1"},Ae={class:"flex gap-2 mt-1"},Ne={class:"flex flex-wrap gap-4 pt-6 mt-2"},Me=["disabled"],Le=["disabled"],Fe={key:1,class:"border-t pt-8 dark:border-gray-700"},De={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},je={key:0,class:"flex items-center justify-between h-full bg-gray-50 dark:bg-gray-700/30 p-3 rounded-lg border dark:border-gray-600"},Ee={class:"text-sm font-medium text-gray-700 dark:text-gray-300 pr-4"},Te=["onClick"],Pe=["for"],qe=["id","onUpdate:modelValue"],Ge={key:2,class:"border-t pt-8 dark:border-gray-700"},Re={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},Be={key:0,class:"flex items-center justify-between h-full bg-gray-50 dark:bg-gray-700/30 p-3 rounded-lg border dark:border-gray-600"},Ke={class:"text-sm font-medium text-gray-700 dark:text-gray-300 pr-4"},Oe=["onClick"],He=["for"],Je=["id","onUpdate:modelValue"],ze=["label"],We=["value"],Qe=["id","onUpdate:modelValue"],Xe=["value"],Ye=["type","id","onUpdate:modelValue"],Ze={class:"mt-8 pt-6 border-t border-gray-200 dark:border-gray-700"},et={class:"flex justify-end"},tt=["disabled"],lt={key:1,class:"p-12 text-center text-gray-500"},at={key:0,class:"animate-pulse"},st={key:1},ot={__name:"ServerSettings",setup(j){const p=X(),I=Y(),V=Z(),a=S({}),i=S(!1),m=S(!1);let U="{}";const k=S(null),u=S(null),d=[{value:0,label:"Beginner"},{value:1,label:"Novice"},{value:2,label:"Intermediate"},{value:3,label:"Advanced"},{value:4,label:"Expert"}],y=C(()=>p.globalSettings.filter(n=>n.category==="Server")),c=C(()=>p.globalSettings.filter(n=>n.category==="Registration")),_=C(()=>p.globalSettings.filter(n=>n.category==="Defaults")),$=C(()=>V.availableLollmsModels),q=C(()=>{const n={};return $.value?($.value.forEach(l=>{let e="Other",s=l.name;if(l.name.includes("/")){const h=l.name.split("/");e=h[0],s=h.slice(1).join("/")}n[e]||(n[e]=[]),n[e].push({...l,displayName:s})}),Object.keys(n).sort().reduce((l,e)=>(l[e]=n[e].sort((s,h)=>s.displayName.localeCompare(h.displayName)),l),{})):{}});ee(async()=>{p.globalSettings.length===0&&await p.fetchGlobalSettings(),V.availableLollmsModels.length===0&&await V.fetchAdminAvailableLollmsModels()}),T(()=>p.globalSettings,G,{deep:!0,immediate:!0}),T(a,n=>{m.value=JSON.stringify(n)!==U},{deep:!0});function G(){const n=p.globalSettings;if(!n||n.length===0){a.value={},U="{}",m.value=!1;return}const l={};n.filter(s=>["Server","Registration","Defaults"].includes(s.category)).forEach(s=>{l[s.key]=s.value}),a.value=l,U=JSON.stringify(l),m.value=!1}async function E(n,l){const e=n.target.files[0];if(e){i.value=!0;try{const s=await p.uploadSslFile(e,l);l==="cert"?a.value.ssl_certfile=s:l==="key"&&(a.value.ssl_keyfile=s),I.addNotification(`${e.name} uploaded successfully.`,"success")}finally{i.value=!1,k.value&&k.value.length>0&&(k.value[0].value=""),u.value&&u.value.length>0&&(u.value[0].value="")}}}async function R(){i.value=!0;try{await p.updateGlobalSettings({...a.value}),I.addNotification("Settings saved. A server restart may be required for some changes to take effect.","info",8e3)}finally{i.value=!1}}async function B(){if((await I.showConfirmation({title:"Generate Certificate?",message:"This will generate a new self-signed certificate and overwrite existing SSL settings. A server restart will be required.",confirmText:"Generate & Enable"})).confirmed){i.value=!0;try{await p.generateSelfSignedCert()}catch{}finally{i.value=!1}}}function K(){p.downloadCertificate()}function O(n){return["cors_origins_exceptions","data_path","huggingface_cache_path","ssl_certfile","ssl_keyfile"].includes(n)}return(n,l)=>(o(),r("div",ge,[l[19]||(l[19]=t("div",{class:"p-6 border-b border-gray-200 dark:border-gray-700"},[t("h3",{class:"text-xl font-semibold leading-6 text-gray-900 dark:text-white"},"Server Settings"),t("p",{class:"mt-1 text-sm text-gray-500 dark:text-gray-400"},"Manage core server behavior, user registration, and defaults for new users.")],-1)),Object.keys(a.value).length?(o(),r("form",{key:0,onSubmit:N(R,["prevent"]),class:"p-6"},[t("div",be,[y.value.length>0?(o(),r("div",fe,[l[7]||(l[7]=t("h4",{class:"settings-category-title"},"Server Configuration",-1)),l[8]||(l[8]=t("div",{class:"mb-6 p-4 bg-blue-50 dark:bg-blue-900/20 border-l-4 border-blue-400 text-blue-800 dark:text-blue-200 rounded-r-lg"},[t("p",{class:"text-sm font-medium"},"Note: Changing server host, port, or SSL settings requires a server restart.")],-1)),t("div",me,[(o(!0),r(b,null,x(y.value.filter(e=>!["ssl_certfile","ssl_keyfile","https_enabled"].includes(e.key)),e=>(o(),r("div",{key:e.key,class:v(["setting-card",{"md:col-span-2":O(e.key)}])},[t("label",{for:e.key,class:"label mb-2"},g(e.description),9,ke),e.key==="cors_origins_exceptions"?(o(),te(ve,{key:0,modelValue:a.value[e.key],"onUpdate:modelValue":s=>a.value[e.key]=s},null,8,["modelValue","onUpdate:modelValue"])):e.type==="boolean"?(o(),r("div",_e,[t("span",he,g(e.description),1),t("button",{onClick:s=>a.value[e.key]=!a.value[e.key],type:"button",class:v([a.value[e.key]?"bg-blue-600":"bg-gray-300 dark:bg-gray-600","toggle-switch"])},[t("span",{class:v([a.value[e.key]?"translate-x-5":"translate-x-0","toggle-knob"])},null,2)],10,xe)])):f((o(),r("input",{key:2,type:e.type==="string"?"text":"number",step:e.type==="float"?"0.1":"1",id:e.key,"onUpdate:modelValue":s=>a.value[e.key]=s,class:v(["input-field w-full",{"bg-gray-100 dark:bg-gray-700 cursor-not-allowed opacity-75":e.key==="data_path"||e.key==="huggingface_cache_path"}]),readonly:e.key==="data_path"||e.key==="huggingface_cache_path"},null,10,we)),[[P,a.value[e.key]]])],2))),128))])])):A("",!0),t("div",Se,[t("h4",Ce,[w(re,{class:"w-5 h-5 text-green-600 dark:text-green-400"}),l[9]||(l[9]=M(" HTTPS Configuration "))]),t("div",Ie,[t("div",Ve,[l[10]||(l[10]=t("div",null,[t("h5",{class:"text-base font-semibold text-gray-900 dark:text-gray-100"},"Enable Secure Connection"),t("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"Toggle HTTPS support. Requires valid certificate files.")],-1)),t("button",{onClick:l[0]||(l[0]=e=>a.value.https_enabled=!a.value.https_enabled),type:"button",class:v([a.value.https_enabled?"bg-green-500":"bg-gray-300 dark:bg-gray-600","toggle-switch"])},[t("span",{class:v([a.value.https_enabled?"translate-x-5":"translate-x-0","toggle-knob"])},null,2)],2)]),t("div",Ue,[t("div",null,[l[11]||(l[11]=t("label",{class:"label"},"SSL Certificate",-1)),t("div",$e,[f(t("input",{type:"text","onUpdate:modelValue":l[1]||(l[1]=e=>a.value.ssl_certfile=e),class:"input-field flex-grow text-xs font-mono",placeholder:"/path/to/cert.pem"},null,512),[[D,a.value.ssl_certfile]]),t("input",{type:"file",ref_key:"certFileInput",ref:k,onChange:l[2]||(l[2]=e=>E(e,"cert")),class:"hidden"},null,544),t("button",{onClick:l[3]||(l[3]=N(e=>n.$refs.certFileInput.click(),["prevent"])),type:"button",class:"btn btn-secondary text-xs whitespace-nowrap"},"Upload PEM")])]),t("div",null,[l[12]||(l[12]=t("label",{class:"label"},"SSL Private Key",-1)),t("div",Ae,[f(t("input",{type:"text","onUpdate:modelValue":l[4]||(l[4]=e=>a.value.ssl_keyfile=e),class:"input-field flex-grow text-xs font-mono",placeholder:"/path/to/key.pem"},null,512),[[D,a.value.ssl_keyfile]]),t("input",{type:"file",ref_key:"keyFileInput",ref:u,onChange:l[5]||(l[5]=e=>E(e,"key")),class:"hidden"},null,544),t("button",{onClick:l[6]||(l[6]=N(e=>n.$refs.keyFileInput.click(),["prevent"])),type:"button",class:"btn btn-secondary text-xs whitespace-nowrap"},"Upload PEM")])])]),t("div",Ne,[t("button",{type:"button",onClick:B,class:"btn btn-primary flex items-center gap-2",disabled:i.value},[w(le,{class:"w-4 h-4"}),l[13]||(l[13]=M(" Auto-Generate Self-Signed Cert "))],8,Me),t("button",{type:"button",onClick:K,class:"btn btn-secondary flex items-center gap-2",disabled:!a.value.ssl_certfile},[w(ae,{class:"w-4 h-4"}),l[14]||(l[14]=M(" Download Certificate "))],8,Le)])])]),c.value.length>0?(o(),r("div",Fe,[l[16]||(l[16]=t("h4",{class:"settings-category-title"},"New User Registration",-1)),t("div",De,[(o(!0),r(b,null,x(c.value,e=>(o(),r("div",{key:e.key,class:v(["setting-card",{"md:col-span-2":e.key==="registration_mode"&&e.description.length>50}])},[e.type==="boolean"?(o(),r("div",je,[t("span",Ee,g(e.description),1),t("button",{onClick:s=>a.value[e.key]=!a.value[e.key],type:"button",class:v([a.value[e.key]?"bg-blue-600":"bg-gray-300 dark:bg-gray-600","toggle-switch flex-shrink-0"])},[t("span",{class:v([a.value[e.key]?"translate-x-5":"translate-x-0","toggle-knob"])},null,2)],10,Te)])):e.key==="registration_mode"?(o(),r(b,{key:1},[t("label",{for:e.key,class:"label mb-1"},g(e.description),9,Pe),f(t("select",{id:e.key,"onUpdate:modelValue":s=>a.value[e.key]=s,class:"input-field w-full"},l[15]||(l[15]=[t("option",{value:"direct"},"Direct (Instantly Active)",-1),t("option",{value:"admin_approval"},"Admin Approval Required",-1)]),8,qe),[[F,a.value[e.key]]])],64)):A("",!0)],2))),128))])])):A("",!0),_.value.length>0?(o(),r("div",Ge,[l[18]||(l[18]=t("h4",{class:"settings-category-title"},"Defaults for New Users",-1)),t("div",Re,[(o(!0),r(b,null,x(_.value,e=>(o(),r("div",{key:e.key,class:"setting-card"},[e.type==="boolean"?(o(),r("div",Be,[t("span",Ke,g(e.description),1),t("button",{onClick:s=>a.value[e.key]=!a.value[e.key],type:"button",class:v([a.value[e.key]?"bg-blue-600":"bg-gray-300 dark:bg-gray-600","toggle-switch flex-shrink-0"])},[t("span",{class:v([a.value[e.key]?"translate-x-5":"translate-x-0","toggle-knob"])},null,2)],10,Oe)])):(o(),r(b,{key:1},[t("label",{for:e.key,class:"label mb-1"},g(e.description),9,He),e.key==="default_lollms_model_name"?f((o(),r("select",{key:0,id:e.key,"onUpdate:modelValue":s=>a.value[e.key]=s,class:"input-field w-full"},[l[17]||(l[17]=t("option",{value:""},"(None - User Selects)",-1)),(o(!0),r(b,null,x(q.value,(s,h)=>(o(),r("optgroup",{key:h,label:h},[(o(!0),r(b,null,x(s,L=>(o(),r("option",{key:L.id,value:L.id},g(L.displayName),9,We))),128))],8,ze))),128))],8,Je)),[[F,a.value[e.key]]]):e.key==="default_user_ui_level"?f((o(),r("select",{key:1,id:e.key,"onUpdate:modelValue":s=>a.value[e.key]=s,class:"input-field w-full"},[(o(),r(b,null,x(d,s=>t("option",{key:s.value,value:s.value},g(s.label),9,Xe)),64))],8,Qe)),[[F,a.value[e.key],void 0,{number:!0}]]):f((o(),r("input",{key:2,type:e.type==="string"?"text":"number",id:e.key,"onUpdate:modelValue":s=>a.value[e.key]=s,class:"input-field w-full"},null,8,Ye)),[[P,a.value[e.key]]])],64))]))),128))])])):A("",!0)]),t("div",Ze,[t("div",et,[t("button",{type:"submit",class:"btn btn-primary",disabled:i.value||!m.value},g(i.value?"Saving...":"Save All Settings"),9,tt)])])],32)):(o(),r("div",lt,[se(p).isLoadingSettings?(o(),r("p",at,"Loading settings...")):(o(),r("p",st,"Could not load server settings."))]))]))}},dt=Q(ot,[["__scopeId","data-v-75e63a7d"]]);export{dt as default};
