import{C as S,a as T,s as E,r as f,c as B,b as i,e as l,f as t,h as N,v as V,l as j,L as g,d as m,t as n,F as R,m as H,y as _,j as k}from"./index-CJMgpJWs.js";const q={class:"bg-white dark:bg-gray-800 shadow-sm rounded-lg overflow-hidden"},F={class:"px-4 py-5 sm:p-6 space-y-4"},P={class:"border-t border-gray-200 dark:border-gray-700"},Q={key:0,class:"p-6 text-center text-gray-500"},Y={key:1,class:"p-6 text-center text-gray-500"},z={key:2,class:"overflow-x-auto"},I={class:"min-w-full divide-y divide-gray-200 dark:divide-gray-700"},K={class:"bg-gray-50 dark:bg-gray-700/50"},O={scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider"},Z={key:0},G={scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider"},J={key:0},W={scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider"},X={key:0},ee={scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider"},te={key:0},se={class:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700"},ae={class:"px-6 py-4 whitespace-nowrap"},oe={class:"flex items-center"},ne={class:"ml-4"},re={class:"text-sm font-medium text-gray-900 dark:text-white"},ie={class:"text-sm text-gray-500 dark:text-gray-400"},le={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400"},de={class:"px-6 py-4 whitespace-nowrap"},ce={class:"flex flex-col gap-1 items-start"},ue={key:0,class:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-yellow-100 text-yellow-800 dark:bg-yellow-900/50 dark:text-yellow-300",title:"This user has requested a password reset."},xe={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400"},me={class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium"},ve={class:"flex items-center justify-end space-x-3"},pe=["onClick"],ge={class:"sr-only"},ye=["onClick"],fe={class:"sr-only"},he=["onClick","title"],we={class:"sr-only"},_e=["onClick"],ke={class:"sr-only"},Ce={__name:"UserTable",setup(be){const x=S(),u=T(),{allUsers:b,isLoadingUsers:U}=E(x),v=f(""),d=f("username"),c=f("asc"),h=B(()=>{let a=[...b.value];if(v.value){const e=v.value.toLowerCase();a=a.filter(s=>s.username.toLowerCase().includes(e)||s.email&&s.email.toLowerCase().includes(e))}return d.value&&a.sort((e,s)=>{let o=e[d.value],r=s[d.value];return d.value==="last_activity_at"?(o=o?new Date(o).getTime():0,r=r?new Date(r).getTime():0):typeof o=="string"&&(o=o.toLowerCase(),r=r?r.toLowerCase():""),o<r?c.value==="asc"?-1:1:o>r?c.value==="asc"?1:-1:0}),a});function p(a){d.value===a?c.value=c.value==="asc"?"desc":"asc":(d.value=a,c.value="asc")}function C(a){if(!a)return"Never";const e=new Date(a),o=Math.round((new Date-e)/1e3);if(o<60)return`${o}s ago`;const r=Math.round(o/60);if(r<60)return`${r}m ago`;const y=Math.round(r/60);if(y<24)return`${y}h ago`;const w=Math.round(y/24);return w<7?`${w}d ago`:e.toLocaleDateString()}function $(a){return a.password_reset_token&&new Date(a.reset_token_expiry)>new Date}function A(a){u.openModal("adminUserEdit",{user:a,onUserUpdated:()=>x.fetchAllUsers()})}function L(a){u.openModal("adminUserEmail",{user:a,onSend:async({subject:e,body:s})=>{await x.sendEmailToUsers(e,s,[a.id])}})}async function D(a){const e=a.is_active?"deactivate":"activate";if(await u.showConfirmation({title:`${e.charAt(0).toUpperCase()+e.slice(1)} User?`,message:`Are you sure you want to ${e} the user "${a.username}"?`,confirmText:`Yes, ${e}`}))try{await k.post(`/api/admin/users/${a.id}/${e}`),u.addNotification(`User ${a.username} has been ${e}d.`,"success"),x.fetchAllUsers()}catch{}}async function M(a){if(await u.showConfirmation({title:"Delete User?",message:`This will permanently delete the user "${a.username}" and all associated data. This action cannot be undone.`,confirmText:"Yes, Delete User"}))try{await k.delete(`/api/admin/users/${a.id}`),u.addNotification(`User ${a.username} has been deleted.`,"success"),x.fetchAllUsers()}catch{}}return(a,e)=>(l(),i("div",q,[t("div",F,[e[5]||(e[5]=t("div",null,[t("h3",{class:"text-base font-semibold leading-6 text-gray-900 dark:text-white"},"All Users"),t("p",{class:"mt-1 max-w-2xl text-sm text-gray-500 dark:text-gray-400"},"A sortable and searchable list of all registered users.")],-1)),N(t("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=s=>v.value=s),placeholder:"Search by username or email...",class:"input-field max-w-sm"},null,512),[[V,v.value]])]),t("div",P,[j(U)?(l(),i("div",Q," Loading users... ")):h.value.length===0?(l(),i("div",Y," No users found. ")):(l(),i("div",z,[t("table",I,[t("thead",K,[t("tr",null,[t("th",O,[t("button",{onClick:e[1]||(e[1]=s=>p("username")),class:"flex items-center gap-1"},[e[6]||(e[6]=g(" User ")),d.value==="username"?(l(),i("span",Z,n(c.value==="asc"?"▲":"▼"),1)):m("",!0)])]),t("th",G,[t("button",{onClick:e[2]||(e[2]=s=>p("last_activity_at")),class:"flex items-center gap-1"},[e[7]||(e[7]=g(" Last Seen ")),d.value==="last_activity_at"?(l(),i("span",J,n(c.value==="asc"?"▲":"▼"),1)):m("",!0)])]),t("th",W,[t("button",{onClick:e[3]||(e[3]=s=>p("is_active")),class:"flex items-center gap-1"},[e[8]||(e[8]=g(" Status ")),d.value==="is_active"?(l(),i("span",X,n(c.value==="asc"?"▲":"▼"),1)):m("",!0)])]),t("th",ee,[t("button",{onClick:e[4]||(e[4]=s=>p("is_admin")),class:"flex items-center gap-1"},[e[9]||(e[9]=g(" Role ")),d.value==="is_admin"?(l(),i("span",te,n(c.value==="asc"?"▲":"▼"),1)):m("",!0)])]),e[10]||(e[10]=t("th",{scope:"col",class:"relative px-6 py-3"},[t("span",{class:"sr-only"},"Actions")],-1))])]),t("tbody",se,[(l(!0),i(R,null,H(h.value,s=>(l(),i("tr",{key:s.id,class:"hover:bg-gray-50 dark:hover:bg-gray-700/50"},[t("td",ae,[t("div",oe,[t("div",ne,[t("div",re,n(s.username),1),t("div",ie,n(s.email||"No email"),1)])])]),t("td",le,n(C(s.last_activity_at)),1),t("td",de,[t("div",ce,[t("span",{class:_([s.is_active?"bg-green-100 text-green-800 dark:bg-green-900/50 dark:text-green-300":"bg-red-100 text-red-800 dark:bg-red-900/50 dark:text-red-300","px-2 inline-flex text-xs leading-5 font-semibold rounded-full"])},n(s.is_active?"Active":"Inactive"),3),$(s)?(l(),i("span",ue," Reset Pending ")):m("",!0)])]),t("td",xe,n(s.is_admin?"Admin":"User"),1),t("td",me,[t("div",ve,[t("button",{onClick:o=>A(s),title:"Edit User",class:"text-gray-400 hover:text-blue-600 dark:hover:text-blue-400"},[t("span",ge,"Edit "+n(s.username),1),e[11]||(e[11]=t("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"w-5 h-5"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10"})],-1))],8,pe),t("button",{onClick:o=>L(s),title:"Email User",class:"text-gray-400 hover:text-blue-600 dark:hover:text-blue-400"},[t("span",fe,"Email "+n(s.username),1),e[12]||(e[12]=t("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"w-5 h-5"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M21.75 6.75v10.5a2.25 2.25 0 0 1-2.25 2.25h-15a2.25 2.25 0 0 1-2.25-2.25V6.75m19.5 0A2.25 2.25 0 0 0 19.5 4.5h-15a2.25 2.25 0 0 0-2.25 2.25m19.5 0v.243a2.25 2.25 0 0 1-1.07 1.916l-7.5 4.615a2.25 2.25 0 0 1-2.36 0L3.32 8.91a2.25 2.25 0 0 1-1.07-1.916V6.75"})],-1))],8,ye),t("button",{onClick:o=>D(s),title:s.is_active?"Deactivate User":"Activate User",class:_({"text-green-500 hover:text-yellow-600 dark:text-green-400 dark:hover:text-yellow-400":s.is_active,"text-red-500 hover:text-green-600 dark:text-red-400 dark:hover:text-green-400":!s.is_active})},[t("span",we,n(s.is_active?"Deactivate":"Activate")+" "+n(s.username),1),e[13]||(e[13]=t("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"w-5 h-5"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M5.636 5.636a9 9 0 1 0 12.728 0M12 3v9"})],-1))],10,he),t("button",{onClick:o=>M(s),title:"Delete User",class:"text-red-500 hover:text-red-700 dark:text-red-400 dark:hover:text-red-300"},[t("span",ke,"Delete "+n(s.username),1),e[14]||(e[14]=t("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"w-5 h-5"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"})],-1))],8,_e)])])]))),128))])])]))])]))}};export{Ce as default};
