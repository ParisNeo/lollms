import{a1 as ge,l as be,u as we,m as ke,s as H,r as u,c as y,w as T,o as he,a as n,b as s,d as l,k as m,n as G,p as v,v as M,q as V,F as b,i as w,t as f,y as q,e as J,f as z,g as B,bu as W,A as xe,I as Ae,h as _e}from"./index-DnyZSjWo.js";import Se from"./IconArrowUp-Z7M0YgIK.js";import Ce from"./IconArrowDown-BHOE3wpW.js";import{A as $e,a as Ue}from"./AppCardSkeleton-CEZ418Ox.js";import"./IconArrowUpCircle-CD49qfiF.js";import"./IconGlobeAlt-CXVR0hCA.js";import"./IconPlayCircle-CQyDZQps.js";const Re={class:"space-y-6"},Ie={class:"border-b border-gray-200 dark:border-gray-700"},Te={class:"-mb-px flex space-x-6","aria-label":"Sub Tabs"},Me={key:0},Ve={class:"space-y-4"},Ne={class:"grid grid-cols-1 lg:grid-cols-4 gap-4"},De={class:"relative lg:col-span-1"},Le={class:"grid grid-cols-1 sm:grid-cols-3 lg:col-span-3 gap-4"},Pe=["value"],Ze=["value"],qe={class:"flex items-center gap-2"},ze=["value"],Be={key:0,class:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 2xl:grid-cols-4 gap-6"},je={key:1,class:"empty-state-card"},Fe={key:2},Ee={class:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 2xl:grid-cols-4 gap-6"},Oe={key:0,class:"flex justify-between items-center mt-6"},He=["disabled"],Ge={class:"text-sm text-gray-600 dark:text-gray-400"},Je=["disabled"],We={key:1},Ke={class:"flex justify-between items-center mb-4 flex-wrap gap-2"},Qe={key:0,class:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm mb-6"},Xe={class:"flex items-center gap-x-4"},Ye={key:0},et=["required"],tt={key:1},at=["required"],lt={key:1,class:"text-center p-4"},st={key:2,class:"empty-state-card"},nt={key:3,class:"space-y-4"},ot={class:"font-semibold"},it={class:"text-sm text-gray-500"},rt={class:"text-xs text-gray-400"},ut={class:"flex items-center gap-2"},dt=["onClick"],pt=["onClick"],ct={__name:"AppsManagement",setup(vt){const i=be(),j=we(),d=ke(),{zooRepositories:N,isLoadingZooRepositories:K,zooApps:k,isLoadingZooApps:Q}=H(i),{tasks:X}=H(j),g=u("zoo"),o=u({type:"git",name:"",url:"",path:""}),h=u(!1),p=u(null),$=u(""),x=u("All"),A=u("All"),_=u("All"),U=u("last_update_date"),S=u("desc"),C=u(JSON.parse(localStorage.getItem("starredApps")||"[]")),c=u(1),D=u(24);let F=null;const Y=[{value:"last_update_date",label:"Last Updated"},{value:"creation_date",label:"Creation Date"},{value:"name",label:"Name"},{value:"author",label:"Author"}],L=y(()=>k.value.total||0),E=y(()=>k.value.pages||1),ee=y(()=>{if(L.value===0)return"Showing 0-0 of 0";const a=(c.value-1)*D.value+1,t=Math.min(c.value*D.value,L.value);return`Showing ${a}-${t} of ${L.value}`}),te=y(()=>{const a={};return(N.value||[]).forEach(t=>a[t.name]=0),(k.value.items||[]).forEach(t=>{a.hasOwnProperty(t.repository)&&a[t.repository]++}),a});async function R(){const a={page:c.value,page_size:D.value,sort_by:U.value,sort_order:S.value,category:x.value!=="All"?x.value:void 0,repository:_.value!=="All"?_.value:void 0,search_query:$.value||void 0,installation_status:A.value!=="All"?A.value:void 0};await i.fetchZooApps(a)}function ae(){clearTimeout(F),F=setTimeout(()=>{c.value=1,R()},300)}T([U,S,x,A,_],()=>{c.value=1,R()}),T($,ae),T(c,R),T(C,a=>{localStorage.setItem("starredApps",JSON.stringify(a))},{deep:!0}),he(()=>{i.fetchZooRepositories(),i.fetchInstalledApps(),R()});const P=y(()=>{const a=new Map,t=["Installing app: ","Updating app: ","Start app: ","Stop app: "];return(X.value||[]).forEach(e=>{if(e!=null&&e.name&&(e.status==="running"||e.status==="pending")){for(const r of t)if(e.name.startsWith(r)){const Z=e.name.replace(r,"");(!a.has(Z)||new Date(e.created_at)>new Date(a.get(Z).created_at))&&a.set(Z,e);break}}}),(k.value.items||[]).map(e=>({...e,task:a.get(e.name)||a.get(e.folder_name)||null}))}),I=y(()=>Array.isArray(N.value)?[...N.value].sort((a,t)=>(a.name||"").localeCompare(t.name||"")):[]),le=y(()=>["All","Starred",...k.value.categories||[]]);function se(a){const t=C.value.indexOf(a);t>-1?C.value.splice(t,1):C.value.push(a)}function ne(a){return a?new Date(a).toLocaleString():"Never"}async function oe(){if(!o.value.name){d.addNotification("Repository name is required.","warning");return}const a={name:o.value.name};if(o.value.type==="git"){if(!o.value.url){d.addNotification("Git URL is required.","warning");return}a.url=o.value.url}else{if(!o.value.path){d.addNotification("Local Folder Path is required.","warning");return}a.path=o.value.path}p.value="add";try{await i.addZooRepository(a),o.value={type:"git",name:"",url:"",path:""},h.value=!1}finally{p.value=null}}async function ie(a){p.value=a.id;try{await i.pullZooRepository(a.id)}finally{p.value=null}}async function re(a){if(await d.showConfirmation({title:`Delete Repository '${a.name}'?`})){p.value=a.id;try{await i.deleteZooRepository(a.id)}finally{p.value=null}}}function ue(a){d.openModal("appInstall",{app:a,type:"apps"})}async function de(a){await d.showConfirmation({title:`Update '${a.name}'?`,confirmText:"Update"})&&await i.updateApp(a.id)}async function O(a,t){p.value=`${t}-${a}`;try{t==="start"&&await i.startApp(a),t==="stop"&&await i.stopApp(a)}finally{p.value=null}}async function pe(a){if(await d.showConfirmation({title:`Uninstall '${a.name}'?`,confirmText:"Uninstall"})){p.value=`uninstall-${a.id}`;try{await i.uninstallApp(a.id)}finally{p.value=null}}}function ce(a){d.openModal("appConfig",{app:a})}async function ve(a){const t=await i.fetchAppReadme(a.repository,a.folder_name);d.openModal("sourceViewer",{title:`README: ${a.name}`,content:t,language:"markdown"})}async function fe(a){await j.cancelTask(a)}function ye(a){d.openModal("tasksManager",{initialTaskId:a})}async function me(){await i.syncInstallations()}return(a,t)=>(s(),n("div",Re,[l("div",Ie,[l("nav",Te,[l("button",{onClick:t[0]||(t[0]=e=>g.value="zoo"),class:G(["tab-button",g.value==="zoo"?"active":"inactive"])},"Zoo",2),l("button",{onClick:t[1]||(t[1]=e=>g.value="source"),class:G(["tab-button",g.value==="source"?"active":"inactive"])},"Source",2)])]),g.value==="zoo"?(s(),n("section",Me,[l("div",{class:"flex justify-between items-center mb-4 flex-wrap gap-2"},[t[16]||(t[16]=l("h3",{class:"text-xl font-semibold"},"App Zoo",-1)),l("button",{onClick:me,class:"btn btn-secondary-outline",title:"Repair broken installations and remove orphaned DB entries."},"Sync Installations")]),l("div",Ve,[l("div",Ne,[l("div",De,[v(l("input",{type:"text","onUpdate:modelValue":t[2]||(t[2]=e=>$.value=e),placeholder:"Search apps...",class:"input-field w-full pl-10"},null,512),[[M,$.value]]),t[17]||(t[17]=l("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[l("svg",{class:"h-5 w-5 text-gray-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[l("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})])],-1))]),l("div",Le,[v(l("select",{"onUpdate:modelValue":t[3]||(t[3]=e=>A.value=e),class:"input-field"},t[18]||(t[18]=[l("option",{value:"All"},"All Statuses",-1),l("option",{value:"Installed"},"Installed",-1),l("option",{value:"Uninstalled"},"Uninstalled",-1),l("option",{value:"Broken"},"Broken",-1)]),512),[[V,A.value]]),v(l("select",{"onUpdate:modelValue":t[4]||(t[4]=e=>x.value=e),class:"input-field"},[(s(!0),n(b,null,w(le.value,e=>(s(),n("option",{key:e,value:e},f(e),9,Pe))),128))],512),[[V,x.value]]),v(l("select",{"onUpdate:modelValue":t[5]||(t[5]=e=>_.value=e),class:"input-field"},[t[19]||(t[19]=l("option",{value:"All"},"All Sources",-1)),(s(!0),n(b,null,w(I.value,e=>(s(),n("option",{key:e.id,value:e.name},f(e.name),9,Ze))),128))],512),[[V,_.value]])])]),l("div",qe,[v(l("select",{"onUpdate:modelValue":t[6]||(t[6]=e=>U.value=e),class:"input-field w-48"},[(s(),n(b,null,w(Y,e=>l("option",{key:e.value,value:e.value},"Sort by "+f(e.label),9,ze)),64))],512),[[V,U.value]]),l("button",{onClick:t[7]||(t[7]=e=>S.value=S.value==="asc"?"desc":"asc"),class:"btn btn-secondary p-2"},[S.value==="asc"?(s(),q(Se,{key:0,class:"w-5 h-5"})):(s(),q(Ce,{key:1,class:"w-5 h-5"}))])]),J(Q)?(s(),n("div",Be,[(s(),n(b,null,w(8,e=>z($e,{key:e})),64))])):!P.value||P.value.length===0?(s(),n("div",je,t[20]||(t[20]=[l("h4",{class:"font-semibold"},"No Apps Found",-1),l("p",{class:"text-sm"},"No apps match your criteria. Please add and pull a repository or adjust your filters.",-1)]))):(s(),n("div",Fe,[l("div",Ee,[(s(!0),n(b,null,w(P.value,e=>(s(),q(Ue,{key:e.id||`${e.repository}/${e.folder_name}`,app:e,task:e.task,"is-starred":C.value.includes(e.name),onStar:r=>se(e.name),onInstall:r=>ue(e),onUpdate:r=>de(e),onUninstall:r=>pe(e),onHelp:r=>ve(e),onViewTask:ye,onCancelInstall:r=>fe(e.task.id),onStart:r=>O(e.id,"start"),onStop:r=>O(e.id,"stop"),onConfigure:r=>ce(e)},null,8,["app","task","is-starred","onStar","onInstall","onUpdate","onUninstall","onHelp","onCancelInstall","onStart","onStop","onConfigure"]))),128))]),E.value>1?(s(),n("div",Oe,[l("button",{onClick:t[8]||(t[8]=e=>c.value--),disabled:c.value===1,class:"btn btn-secondary"},"Previous",8,He),l("span",Ge,f(ee.value),1),l("button",{onClick:t[9]||(t[9]=e=>c.value++),disabled:c.value>=E.value,class:"btn btn-secondary"},"Next",8,Je)])):m("",!0)]))])])):m("",!0),g.value==="source"?(s(),n("section",We,[l("div",Ke,[t[21]||(t[21]=l("h3",{class:"text-xl font-semibold"},"App Zoo Repositories",-1)),l("button",{onClick:t[10]||(t[10]=e=>h.value=!h.value),class:"btn btn-primary"},f(h.value?"Cancel":"Add Repository"),1)]),h.value?(s(),n("div",Qe,[l("form",{onSubmit:xe(oe,["prevent"]),class:"space-y-4"},[l("div",Xe,[l("label",null,[v(l("input",{type:"radio","onUpdate:modelValue":t[11]||(t[11]=e=>o.value.type=e),value:"git",class:"radio-input"},null,512),[[W,o.value.type]]),t[22]||(t[22]=B(" Git"))]),l("label",null,[v(l("input",{type:"radio","onUpdate:modelValue":t[12]||(t[12]=e=>o.value.type=e),value:"local",class:"radio-input"},null,512),[[W,o.value.type]]),t[23]||(t[23]=B(" Local"))])]),l("div",null,[t[24]||(t[24]=l("label",null,"Name",-1)),v(l("input",{"onUpdate:modelValue":t[13]||(t[13]=e=>o.value.name=e),type:"text",class:"input-field",required:""},null,512),[[M,o.value.name]])]),o.value.type==="git"?(s(),n("div",Ye,[t[25]||(t[25]=l("label",null,"URL",-1)),v(l("input",{"onUpdate:modelValue":t[14]||(t[14]=e=>o.value.url=e),type:"url",class:"input-field",required:o.value.type==="git"},null,8,et),[[M,o.value.url]])])):m("",!0),o.value.type==="local"?(s(),n("div",tt,[t[26]||(t[26]=l("label",null,"Path",-1)),v(l("input",{"onUpdate:modelValue":t[15]||(t[15]=e=>o.value.path=e),type:"text",class:"input-field",required:o.value.type==="local"},null,8,at),[[M,o.value.path]])])):m("",!0),t[27]||(t[27]=l("div",{class:"flex justify-end"},[l("button",{type:"submit",class:"btn btn-primary"},"Add")],-1))],32)])):m("",!0),J(K)?(s(),n("div",lt,"Loading...")):!I.value||I.value.length===0?(s(),n("div",st,t[28]||(t[28]=[l("p",null,"No repositories added.",-1)]))):(s(),n("div",nt,[(s(!0),n(b,null,w(I.value,e=>(s(),n("div",{key:e.id,class:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm flex items-center justify-between"},[l("div",null,[l("p",ot,f(e.name)+" ("+f(te.value[e.name]||0)+")",1),l("p",it,f(e.url),1),l("p",rt,"Pulled: "+f(ne(e.last_pulled_at)),1)]),l("div",ut,[l("button",{onClick:r=>ie(e),class:"btn btn-secondary btn-sm"},[z(Ae,{class:"w-4 h-4 mr-1"}),B(f(e.type==="git"?"Pull":"Rescan"),1)],8,dt),e.is_deletable?(s(),n("button",{key:0,onClick:r=>re(e),class:"btn btn-danger btn-sm"},[z(_e,{class:"w-4 h-4"})],8,pt)):m("",!0)])]))),128))]))])):m("",!0)]))}},ht=ge(ct,[["__scopeId","data-v-79f62bef"]]);export{ht as default};
