import{S as Q,u as Y,a as H,q as W,s as R,r as f,bJ as X,bK as Z,bL as ee,bM as te,bN as se,w as M,bO as ae,z as m,o as le,c as n,b as o,g as l,d as h,B as O,k as E,bT as $,t as b,m as oe,h as L,N as ne,e as A,f as V,j as re,F as N,i as j,n as F,bP as ie,T as de,bQ as ue,A as ce,G as fe,bS as ve}from"./index-M-FQSTxP.js";const me={class:"space-y-8"},be={class:"space-y-6"},ge={class:"relative"},ye={class:"flex items-center space-x-3 truncate"},pe=["src"],he={key:1,class:"w-8 h-8 flex-shrink-0 text-gray-500 dark:text-gray-400 flex items-center justify-center bg-gray-200 dark:bg-gray-700 rounded-md"},_e={class:"min-w-0 text-left"},xe={class:"block font-semibold truncate"},ke={class:"p-2 sticky top-0 bg-white dark:bg-gray-800 z-10 border-b dark:border-gray-700"},we={class:"p-1 flex-grow overflow-y-auto"},Se={key:0,class:"text-center p-4 text-sm text-gray-500"},Te={key:1,class:"text-center p-4 text-sm text-gray-500"},Ce={class:"px-2 py-1.5 text-xs font-bold text-gray-600 dark:text-gray-300"},Me=["onClick"],Oe={class:"flex items-center space-x-3 truncate"},Ee=["src"],Le={class:"truncate text-left"},Ne={class:"font-medium truncate text-sm"},je={key:0,class:"p-4 border rounded-lg dark:border-gray-700 space-y-4"},Fe={class:"font-medium"},De={class:"font-mono text-blue-600 dark:text-blue-400"},Ue={key:0,class:"text-sm text-gray-500"},ze=["for"],Be=["type","step","id","onUpdate:modelValue","placeholder"],Re={key:1,class:"mt-1"},$e=["onClick"],Ae={class:"flex justify-end gap-3 pt-4 border-t dark:border-gray-600"},Ve=["disabled"],Ie=["disabled"],Pe={key:1,class:"p-4 border border-yellow-300 dark:border-yellow-700 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg text-sm text-yellow-800 dark:text-yellow-200 flex items-center gap-3"},Ge={__name:"TTSSettings",setup(Je){const S=Y(),_=H();W();const{user:g}=R(S),{availableTtsModels:D,availableTtsModelsGrouped:U}=R(_),u=f({}),y=f(!1),p=f(!1);let x="{}";const v=f(!1),T=f(null),C=f(null),k=f(""),{floatingStyles:I}=X(T,C,{placement:"bottom-start",whileElementsMounted:Z,middleware:[ee(5),te(),se({padding:5})]}),P={mounted:(t,e)=>{t.clickOutsideEvent=s=>{const r=T.value;t===s.target||t.contains(s.target)||r!=null&&r.contains(s.target)||e.value()},document.addEventListener("mousedown",t.clickOutsideEvent)},unmounted:t=>{document.removeEventListener("mousedown",t.clickOutsideEvent)}};M(v,t=>{t&&ae(()=>{const e=C.value;if(e){const s=e.querySelector(".menu-item-button.selected");s&&s.scrollIntoView({block:"nearest"})}})});const d=m({get:()=>{var t;return(t=g.value)==null?void 0:t.tts_binding_model_name},set:t=>{S.updateUserPreferences({tts_binding_model_name:t})}}),i=m(()=>!d.value||D.value.length===0?null:D.value.find(t=>t.id===d.value)||null),w=m(()=>{var e;if(!((e=i.value)!=null&&e.alias))return[];const t=["icon","title","description","allow_parameters_override"];return Object.entries(i.value.alias).filter(([s])=>!t.includes(s)).map(([s,r])=>({name:s,type:typeof r=="boolean"?"bool":typeof r=="number"?"float":"str",default:r}))}),G=m(()=>!g.value||!d.value||!g.value.tts_models_config?{}:g.value.tts_models_config[d.value]||{}),z=m(()=>{var t;return(t=i.value)!=null&&t.alias?i.value.alias.allow_parameters_override!==!1:!0}),B=m(()=>{if(!k.value)return U.value;const t=k.value.toLowerCase(),e=[];for(const s of U.value)if(s.items){const r=s.items.filter(a=>a.name.toLowerCase().includes(t));r.length>0&&e.push({...s,items:r})}return e});function J(t){d.value=t,v.value=!1}M(i,t=>{if(t){const e={};w.value.forEach(s=>{e[s.name]=G.value[s.name]??t.alias[s.name]??s.default}),u.value=e,x=JSON.stringify(e),p.value=!1}else u.value={},x="{}",p.value=!1},{immediate:!0,deep:!0}),M(u,t=>{p.value=JSON.stringify(t)!==x},{deep:!0});async function q(){var t;if(d.value){y.value=!0;try{const e=g.value.tts_models_config||{},s={...e[d.value]||{},...u.value};(t=i.value)!=null&&t.alias&&Object.keys(s).forEach(a=>{(s[a]===i.value.alias[a]||s[a]===""||s[a]===null)&&delete s[a]});const r={...e,[d.value]:s};Object.keys(r[d.value]).length===0&&delete r[d.value],await S.updateUserPreferences({tts_models_config:r}),x=JSON.stringify(u.value),p.value=!1}finally{y.value=!1}}}function K(){var e;const t={};(e=i.value)!=null&&e.alias&&w.value.forEach(s=>{t[s.name]=i.value.alias[s.name]??s.default}),u.value=t}return le(()=>{_.availableTtsModels.length===0&&_.fetchAvailableTtsModels()}),(t,e)=>{var s,r;return o(),n("div",me,[e[7]||(e[7]=l("div",null,[l("h3",{class:"text-xl font-semibold leading-6 text-gray-900 dark:text-white"}," Speech Generation (TTS) Parameters "),l("p",{class:"mt-1 text-sm text-gray-500 dark:text-gray-400"}," Configure default parameters for your selected Text-to-Speech model. ")],-1)),l("div",be,[l("div",null,[e[4]||(e[4]=l("label",{class:"block text-base font-medium mb-2"},"Active Speech Generation Model",-1)),l("div",ge,[l("button",{ref_key:"ttsTriggerRef",ref:T,onClick:e[0]||(e[0]=a=>v.value=!v.value),type:"button",class:"toolbox-select truncate w-full flex items-center justify-between"},[l("div",ye,[(s=i.value)!=null&&s.icon_base64?(o(),n("img",{key:0,src:i.value.icon_base64,class:"h-8 w-8 rounded-md object-cover"},null,8,pe)):(o(),n("span",he,[E($,{class:"w-5 h-5"})])),l("div",_e,[l("span",xe,b(((r=i.value)==null?void 0:r.name)||"Select a Speech Model"),1)])]),e[3]||(e[3]=l("svg",{class:"w-4 h-4 text-gray-400 flex-shrink-0",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor"},[l("path",{"fill-rule":"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z","clip-rule":"evenodd"})],-1))],512),(o(),O(ue,{to:"body"},[E(de,{"enter-active-class":"transition ease-out duration-100","enter-from-class":"transform opacity-0 scale-95","enter-to-class":"transform opacity-100 scale-100","leave-active-class":"transition ease-in duration-75","leave-from-class":"transform opacity-100 scale-100","leave-to-class":"transform opacity-0 scale-95"},{default:oe(()=>[v.value?L((o(),n("div",{key:0,ref_key:"ttsFloatingRef",ref:C,style:ne(A(I)),class:"z-50 w-80 origin-top-left rounded-md bg-white dark:bg-gray-800 shadow-lg ring-1 ring-black ring-opacity-5 dark:ring-gray-700 focus:outline-none py-1 flex flex-col max-h-[50vh]"},[l("div",ke,[L(l("input",{type:"text","onUpdate:modelValue":e[1]||(e[1]=a=>k.value=a),onClick:e[2]||(e[2]=V(()=>{},["stop"])),placeholder:"Search TTS models...",class:"input-field-sm w-full"},null,512),[[re,k.value]])]),l("div",we,[A(_).isLoadingTtsModels?(o(),n("div",Se,"Loading TTS models...")):B.value.length===0?(o(),n("div",Te,"No TTS models found.")):h("",!0),(o(!0),n(N,null,j(B.value,a=>(o(),n("div",{key:a.label},[l("h4",Ce,b(a.label),1),(o(!0),n(N,null,j(a.items,c=>(o(),n("button",{key:c.id,onClick:qe=>J(c.id),class:F(["menu-item-button",{selected:d.value===c.id}])},[l("div",Oe,[c.icon_base64?(o(),n("img",{key:0,src:c.icon_base64,class:"h-6 w-6 rounded-md object-cover flex-shrink-0"},null,8,Ee)):(o(),O($,{key:1,class:"w-6 h-6 text-gray-500 dark:text-gray-400 flex-shrink-0"})),l("div",Le,[l("p",Ne,b(c.name),1)])]),d.value===c.id?(o(),O(ie,{key:0,class:"w-5 h-5 text-blue-600 dark:text-blue-400 flex-shrink-0"})):h("",!0)],10,Me))),128))]))),128))])],4)),[[P,()=>v.value=!1]]):h("",!0)]),_:1})]))])]),d.value&&i.value&&z.value?(o(),n("div",je,[l("h4",Fe,[e[5]||(e[5]=ce("Configuration for: ")),l("span",De,b(i.value.name),1)]),w.value.length===0?(o(),n("div",Ue," This model has no parameters exposed for user configuration. ")):(o(),n("form",{key:1,onSubmit:V(q,["prevent"]),class:"space-y-4"},[(o(!0),n(N,null,j(w.value,a=>(o(),n("div",{key:a.name},[l("label",{for:`tts-param-${a.name}`,class:"block text-sm font-medium capitalize"},b(a.name.replace(/_/g," ")),9,ze),["str","int","float"].includes(a.type)?L((o(),n("input",{key:0,type:a.type==="str"?"text":"number",step:a.type==="float"?"0.01":"1",id:`tts-param-${a.name}`,"onUpdate:modelValue":c=>u.value[a.name]=c,class:"input-field mt-1",placeholder:`Default: ${i.value.alias[a.name]}`},null,8,Be)),[[fe,u.value[a.name]]]):a.type==="bool"?(o(),n("div",Re,[l("button",{onClick:c=>u.value[a.name]=!u.value[a.name],type:"button",class:F([u.value[a.name]?"bg-blue-600":"bg-gray-200 dark:bg-gray-600","relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out"])},[l("span",{class:F([u.value[a.name]?"translate-x-5":"translate-x-0","pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition-colors duration-200 ease-in-out"])},null,2)],10,$e)])):h("",!0)]))),128)),l("div",Ae,[l("button",{type:"button",onClick:K,class:"btn btn-secondary",disabled:y.value},"Reset to Defaults",8,Ve),l("button",{type:"submit",class:"btn btn-primary",disabled:y.value||!p.value},b(y.value?"Saving...":"Save Changes"),9,Ie)])],32))])):d.value&&i.value&&!z.value?(o(),n("div",Pe,[E(ve,{class:"w-5 h-5 flex-shrink-0"}),e[6]||(e[6]=l("span",null,"An administrator has locked the parameters for this model alias. Your personal settings will be ignored.",-1))])):h("",!0)])])}}},Qe=Q(Ge,[["__scopeId","data-v-0ca96cd1"]]);export{Qe as default};
