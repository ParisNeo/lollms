import{$ as G,c as n,b as a,a2 as j,g as t,W as I,s as R,k as m,d as w,e as _,z as h,n as C,cA as E,t as l,Z as T,J as x,B as D,F as S,i as z,bV as F,bW as W,bX as O,bY as Z,cB as q,bZ as J,b_ as X,b$ as Y,c0 as K,c1 as Q,cC as tt,G as B,r as U,a5 as P,y as et,cD as st,o as at,cE as nt,U as rt,N as ot}from"./index-BLQ4K_Yi.js";import{L as lt,B as dt,I as it}from"./chartjs-adapter-date-fns.esm-DnoVNF5G.js";import{I as ct}from"./IconGlobeAlt-Dlyuynil.js";const ut={},gt={fill:"currentColor",height:"800px",width:"800px",version:"1.1",id:"Capa_1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512","xml:space":"preserve"};function pt($,u){return a(),n("svg",gt,u[0]||(u[0]=[j(`<g><path d="M480.003,128H48c0-22.056-17.944-40-40-40c-4.418,0-8,3.582-8,8s3.582,8,8,8c13.234,0,24,10.766,24,24v288\r
		c0,4.418,3.582,8,8,8s8-3.582,8-8v-8h16.01C77.238,408,88,397.238,88,384.01V384h392.003C497.646,384,512,369.646,512,352.003\r
		V159.997C512,142.354,497.646,128,480.003,128z M496,352.003c0,8.821-7.176,15.997-15.997,15.997H80c-4.418,0-8,3.582-8,8v8.01\r
		c0,4.406-3.584,7.99-7.99,7.99H48V144h432.003c8.821,0,15.997,7.176,15.997,15.997V352.003z"></path><path d="M240,192c-22.922,0-43.057,12.12-54.363,30.28c-0.784,0.849-1.379,1.856-1.737,2.954c-5.03,9.136-7.9,19.621-7.9,30.766\r
		c0,11.406,3.013,22.115,8.264,31.399c0.187,0.398,0.407,0.778,0.656,1.14C196.078,307.354,216.586,320,240,320\r
		c35.29,0,64-28.71,64-64c0-11.406-3.013-22.115-8.264-31.399c-0.187-0.398-0.407-0.778-0.656-1.14\r
		C283.922,204.646,263.414,192,240,192z M192,256c0-4.395,0.605-8.648,1.717-12.695c3.596,3.178,8.453,6.73,15.035,10.53\r
		c6.376,3.681,11.742,6.078,16.208,7.612c-2.622,2.061-5.987,4.385-10.208,6.821c-8.449,4.878-14.816,7.039-18.36,7.752\r
		C193.58,269.922,192,263.144,192,256z M288,256c0,4.103-0.52,8.087-1.493,11.891c-3.617-3.227-8.542-6.848-15.259-10.726\r
		c-5.96-3.441-11.036-5.758-15.321-7.298c2.483-1.885,5.564-3.966,9.321-6.135c8.447-4.876,14.816-7.039,18.36-7.752\r
		C286.42,242.078,288,248.856,288,256z M273.948,222.099c-4.562,1.524-10.087,3.96-16.699,7.777\r
		c-6.252,3.61-10.952,6.997-14.49,10.051C242.31,236.682,242,232.717,242,228c0-9.763,1.314-16.361,2.469-19.785\r
		C255.934,209.279,266.244,214.384,273.948,222.099z M227.619,209.627C226.655,214.344,226,220.354,226,228\r
		c0,7.056,0.557,12.721,1.401,17.26c-3.022-1.232-6.59-2.938-10.65-5.282c-8.302-4.793-13.33-9.159-15.769-11.883\r
		C207.376,219.18,216.739,212.535,227.619,209.627z M206.049,289.898c4.564-1.524,10.086-3.954,16.702-7.774\r
		c6.252-3.61,10.952-6.997,14.49-10.051C237.69,275.318,238,279.283,238,284c0,9.763-1.314,16.361-2.469,19.785\r
		C224.065,302.721,213.753,297.615,206.049,289.898z M252.381,302.373C253.345,297.656,254,291.646,254,284\r
		c0-7.633-0.653-13.635-1.614-18.347c3.066,1.237,6.708,2.97,10.863,5.368c8.764,5.06,13.892,9.652,16.163,12.33\r
		C273.012,292.546,263.486,299.405,252.381,302.373z"></path><path d="M440,168c-4.418,0-8,3.582-8,8s3.582,8,8,8c8.822,0,16,7.178,16,16v112c0,8.822-7.178,16-16,16H240\r
		c-39.701,0-72-32.299-72-72s32.299-72,72-72h168c4.418,0,8-3.582,8-8s-3.582-8-8-8H240c-48.523,0-88,39.477-88,88s39.477,88,88,88\r
		h200c17.645,0,32-14.355,32-32V200C472,182.355,457.645,168,440,168z"></path><path d="M112,232H88c-8.822,0-16,7.178-16,16v16c0,8.822,7.178,16,16,16h24c8.822,0,16-7.178,16-16v-16\r
		C128,239.178,120.822,232,112,232z M88,264v-16h24l0.001,16H88z"></path><path d="M112,176H88c-8.822,0-16,7.178-16,16v16c0,8.822,7.178,16,16,16h24c8.822,0,16-7.178,16-16v-16\r
		C128,183.178,120.822,176,112,176z M88,208v-16h24l0.001,16H88z"></path><path d="M112,288H88c-8.822,0-16,7.178-16,16v16c0,8.822,7.178,16,16,16h24c8.822,0,16-7.178,16-16v-16\r
		C128,295.178,120.822,288,112,288z M88,320v-16h24l0.001,16H88z"></path><path d="M432,200h-24c-4.418,0-8,3.582-8,8s3.582,8,8,8h24c4.418,0,8-3.582,8-8S436.418,200,432,200z"></path><path d="M432,296h-24c-4.418,0-8,3.582-8,8s3.582,8,8,8h24c4.418,0,8-3.582,8-8S436.418,296,432,296z"></path><path d="M432,224h-24c-4.418,0-8,3.582-8,8s3.582,8,8,8h24c4.418,0,8-3.582,8-8S436.418,224,432,224z"></path><path d="M432,248h-24c-4.418,0-8,3.582-8,8s3.582,8,8,8h24c4.418,0,8-3.582,8-8S436.418,248,432,248z"></path><path d="M432,272h-24c-4.418,0-8,3.582-8,8s3.582,8,8,8h24c4.418,0,8-3.582,8-8S436.418,272,432,272z"></path></g>`,1)]))}const N=G(ut,[["render",pt]]),yt={},_t={width:"20px",height:"20px",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function mt($,u){return a(),n("svg",_t,u[0]||(u[0]=[t("path",{d:"M20.5 11L18.7396 7.60473C18.253 6.65855 18.0097 6.18545 17.6514 5.84012C17.3346 5.5347 16.9544 5.30272 16.5379 5.16065C16.067 5 15.535 5 14.471 5H9.52901C8.46503 5 7.93304 5 7.46209 5.16065C7.04558 5.30272 6.66542 5.5347 6.34859 5.84012C5.99034 6.18545 5.74703 6.65855 5.26042 7.60473L3.5 11M20.5 11C20.6981 11.3853 20.7658 11.5446 20.8357 11.747C20.8977 11.9267 20.9426 12.1119 20.9696 12.3002C21 12.5121 21 12.7287 21 13.162V14.2C21 15.8802 21 16.7202 20.673 17.362C20.3854 17.9265 19.9265 18.3854 19.362 18.673C18.7202 19 17.8802 19 16.2 19H7.8C6.11984 19 5.27976 19 4.63803 18.673C4.07354 18.3854 3.6146 17.9265 3.32698 17.362C3 16.7202 3 15.8802 3 14.2V13.162C3 12.7287 3 12.5121 3.03041 12.3002C3.05741 12.1119 3.10225 11.9267 3.16432 11.747C3.23421 11.5446 3.30186 11.3853 3.5 11M20.5 11H3.5M15 15H17",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)]))}const V=G(yt,[["render",mt]]),vt={class:"space-y-6"},ht={class:"flex items-center justify-between"},bt=["disabled"],xt={key:0,class:"text-center p-8"},ft={key:1,class:"space-y-6"},kt={class:"grid grid-cols-1 md:grid-cols-3 gap-6"},wt={class:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow-md"},Ct={class:"flex items-center"},$t={class:"mt-2 text-2xl font-bold text-gray-900 dark:text-white"},Mt={class:"text-sm text-gray-500 dark:text-gray-400"},St={class:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow-md"},zt={class:"flex items-center"},At={class:"mt-2 text-2xl font-bold text-gray-900 dark:text-white"},Ut={class:"text-sm text-gray-500 dark:text-gray-400"},Dt={class:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow-md"},Gt={class:"flex items-center"},Lt={key:0,class:"mt-2 text-2xl font-bold text-gray-900 dark:text-white"},Tt={key:1,class:"text-sm text-gray-500 dark:text-gray-400"},Pt={key:2,class:"mt-2 text-lg text-gray-500 dark:text-gray-400"},Nt={class:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow-md"},Vt={class:"flex items-center mb-2"},It={class:"text-sm text-gray-600 dark:text-gray-300 space-y-1"},Bt={class:"font-medium text-gray-900 dark:text-white"},Ht={class:"font-medium text-gray-900 dark:text-white"},jt={class:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2.5 mt-3"},Rt={class:"flex items-center mb-2"},Et={class:"font-semibold text-gray-800 dark:text-gray-200"},Ft={key:0,class:"ml-3 text-xs font-semibold px-2 py-0.5 rounded-full bg-blue-100 text-blue-800 dark:bg-blue-900/50 dark:text-blue-300"},Wt={key:1,class:"ml-2 text-xs font-semibold px-2 py-0.5 rounded-full bg-green-100 text-green-800 dark:bg-green-900/50 dark:text-green-300"},Ot={class:"text-sm text-gray-600 dark:text-gray-300 space-y-1"},Zt={class:"font-medium text-gray-900 dark:text-white"},qt={class:"font-medium text-gray-900 dark:text-white"},Jt={class:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2.5 mt-3"},Xt={class:"flex items-center mb-2"},Yt={class:"font-semibold text-gray-800 dark:text-gray-200"},Kt={class:"text-sm text-gray-600 dark:text-gray-300 space-y-1"},Qt={class:"font-medium text-gray-900 dark:text-white"},te={class:"font-medium text-gray-900 dark:text-white"},ee={class:"font-medium text-gray-900 dark:text-white"},se={class:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2.5 mt-3"},ae={key:1,class:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow-md text-center text-gray-500 dark:text-gray-400"},ne={key:2,class:"text-center p-8"},re={__name:"SystemStatus",setup($){const u=I(),{systemStatus:i,isLoadingSystemStatus:d}=R(u),p=m(()=>{var o;return((o=i.value)==null?void 0:o.gpus)||[]}),M=m(()=>p.value.reduce((o,e)=>o+e.vram_used_gb,0)),g=m(()=>p.value.reduce((o,e)=>o+e.vram_total_gb,0)),A=m(()=>g.value>0?M.value/g.value*100:0),k=m(()=>{if(!i.value||!i.value.disks)return null;let o=i.value.disks.find(e=>e.is_data_disk);return!o&&i.value.disks.length>0&&(o=i.value.disks[0]),o}),y=o=>o==null?"N/A":`${o.toFixed(1)} GB`,f=o=>o==null?"N/A":`${o.toFixed(2)}%`;return(o,e)=>(a(),n("div",vt,[t("div",ht,[e[1]||(e[1]=t("h2",{class:"text-2xl font-bold text-gray-900 dark:text-white"},"System Status",-1)),t("button",{onClick:e[0]||(e[0]=(...r)=>_(u).fetchSystemStatus&&_(u).fetchSystemStatus(...r)),class:"btn btn-secondary btn-sm",disabled:_(d)},[h(E,{class:C(["w-4 h-4",{"animate-spin":_(d)}])},null,8,["class"])],8,bt)]),_(d)&&!_(i)?(a(),n("div",xt,e[2]||(e[2]=[t("p",null,"Loading system status...",-1)]))):_(i)?(a(),n("div",ft,[t("div",kt,[t("div",wt,[t("div",Ct,[h(N,{class:"w-6 h-6 mr-3 text-gray-400"}),e[3]||(e[3]=t("h3",{class:"text-lg font-semibold text-gray-800 dark:text-gray-200"},"GPU VRAM",-1))]),t("p",$t,l(g.value>0?`${y(M.value)} / ${y(g.value)}`:"N/A"),1),t("p",Mt,l(g.value>0?`(${f(A.value)})`:"No compatible GPU found"),1)]),t("div",St,[t("div",zt,[h(T,{class:"w-6 h-6 mr-3 text-gray-400"}),e[4]||(e[4]=t("h3",{class:"text-lg font-semibold text-gray-800 dark:text-gray-200"},"CPU RAM",-1))]),t("p",At,l(y(_(i).cpu_ram_used_gb))+" / "+l(y(_(i).cpu_ram_total_gb)),1),t("p",Ut,"("+l(f(_(i).cpu_ram_usage_percent))+")",1)]),t("div",Dt,[t("div",Gt,[h(V,{class:"w-6 h-6 mr-3 text-gray-400"}),e[5]||(e[5]=t("h3",{class:"text-lg font-semibold text-gray-800 dark:text-gray-200"},"Data Disk",-1))]),k.value?(a(),n("p",Lt,l(y(k.value.used_gb))+" / "+l(y(k.value.total_gb)),1)):w("",!0),k.value?(a(),n("p",Tt,"("+l(f(k.value.usage_percent))+")",1)):(a(),n("p",Pt,"No disk info"))])]),t("div",Nt,[t("div",Vt,[h(T,{class:"w-5 h-5 mr-2 text-gray-400"}),e[6]||(e[6]=t("h4",{class:"font-semibold text-gray-800 dark:text-gray-200"},"CPU RAM Usage Details",-1))]),t("div",It,[t("p",null,[e[7]||(e[7]=x("Available: ")),t("span",Bt,l(y(_(i).cpu_ram_available_gb)),1)]),t("p",null,[e[8]||(e[8]=x("Usage: ")),t("span",Ht,l(y(_(i).cpu_ram_used_gb))+" / "+l(y(_(i).cpu_ram_total_gb))+" ("+l(f(_(i).cpu_ram_usage_percent))+")",1)])]),t("div",jt,[t("div",{class:"bg-gradient-to-r from-blue-400 to-purple-500 h-2.5 rounded-full",style:D({width:_(i).cpu_ram_usage_percent+"%"})},null,4)])]),(a(!0),n(S,null,z(_(i).disks,r=>(a(),n("div",{key:r.mount_point,class:C(["p-4 rounded-lg shadow-md border-l-4",{"bg-white dark:bg-gray-800 border-transparent":!r.is_app_disk&&!r.is_data_disk,"bg-blue-50 dark:bg-blue-900/20 border-blue-500":r.is_data_disk&&!r.is_app_disk,"bg-green-50 dark:bg-green-900/20 border-green-500":r.is_app_disk&&!r.is_data_disk,"bg-gradient-to-r from-green-50 to-blue-50 dark:from-green-900/20 dark:to-blue-900/20 border-purple-500":r.is_app_disk&&r.is_data_disk}])},[t("div",Rt,[h(V,{class:"w-5 h-5 mr-2 text-gray-400"}),t("h4",Et,"Disk: "+l(r.mount_point),1),r.is_data_disk?(a(),n("span",Ft,"Data")):w("",!0),r.is_app_disk?(a(),n("span",Wt,"App")):w("",!0)]),t("div",Ot,[t("p",null,[e[9]||(e[9]=x("Available: ")),t("span",Zt,l(y(r.available_gb)),1)]),t("p",null,[e[10]||(e[10]=x("Usage: ")),t("span",qt,l(y(r.used_gb))+" / "+l(y(r.total_gb))+" ("+l(f(r.usage_percent))+")",1)])]),t("div",Jt,[t("div",{class:"bg-gradient-to-r from-cyan-400 to-teal-500 h-2.5 rounded-full",style:D({width:r.usage_percent+"%"})},null,4)])],2))),128)),p.value.length>0?(a(!0),n(S,{key:0},z(p.value,(r,b)=>(a(),n("div",{key:r.id,class:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow-md"},[t("div",Xt,[h(N,{class:"w-5 h-5 mr-2 text-gray-400"}),t("h4",Yt,"GPU "+l(b+1)+" Usage Details",1)]),t("div",Kt,[t("p",null,[e[11]||(e[11]=x("Model: ")),t("span",Qt,l(r.name),1)]),t("p",null,[e[12]||(e[12]=x("Available VRAM: ")),t("span",te,l(y(r.vram_total_gb-r.vram_used_gb)),1)]),t("p",null,[e[13]||(e[13]=x("Usage: ")),t("span",ee,l(y(r.vram_used_gb))+" / "+l(y(r.vram_total_gb))+" ("+l(f(r.vram_usage_percent))+")",1)])]),t("div",se,[t("div",{class:"bg-gradient-to-r from-indigo-500 to-pink-500 h-2.5 rounded-full",style:D({width:r.vram_usage_percent+"%"})},null,4)])]))),128)):(a(),n("div",ae,e[14]||(e[14]=[t("p",null,"No NVIDIA GPU detected or pynvml library not installed on the server.",-1)])))])):_(d)?w("",!0):(a(),n("div",ne,e[15]||(e[15]=[t("p",{class:"text-red-500"},"Failed to load system status. Please check server logs.",-1)])))]))}},oe={class:"space-y-6"},le={class:"bg-white dark:bg-gray-800 rounded-lg shadow p-5"},de={class:"flex justify-between items-center mb-4 flex-wrap gap-2"},ie={class:"inline-flex rounded-md shadow-sm",role:"group"},ce={class:"flex items-center gap-2"},ue={class:"h-96"},ge={key:0,class:"flex items-center justify-center h-full"},pe={key:1,class:"flex items-center justify-center h-full"},ye={key:2,class:"h-full"},_e={__name:"GlobalStatsChart",props:{stats:{type:Object,default:null},isLoading:{type:Boolean,default:!1}},setup($){F.register(W,O,Z,q,J,X,Y,K,Q,tt);const u=$,i=B(),d=U("daily"),p=U(null),M=m(()=>d.value==="daily"||d.value==="weekly_stats"?lt:dt),g=m(()=>({responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:d.value==="daily"||d.value==="weekly_stats"},title:{display:!0,text:A.value,color:i.currentTheme==="dark"?"#e5e7eb":"#1f2937"}},scales:{x:{type:d.value==="daily"?"time":"category",time:{unit:"day",tooltipFormat:"MMM d, yyyy"},grid:{color:i.currentTheme==="dark"?"rgba(255, 255, 255, 0.1)":"rgba(0, 0, 0, 0.1)"},ticks:{color:i.currentTheme==="dark"?"#cbd5e1":"#4b5563"}},y:{beginAtZero:!0,grid:{color:i.currentTheme==="dark"?"rgba(255, 255, 255, 0.1)":"rgba(0, 0, 0, 0.1)"},ticks:{color:i.currentTheme==="dark"?"#cbd5e1":"#4b5563"}}}})),A=m(()=>{switch(d.value){case"mean":return"Average Daily Generations by Weekday";case"variance":return"Generation Variance by Weekday";case"weekly_stats":return"Weekly Generation Statistics (Mean ± Std Dev)";case"daily":default:return"Total AI Generations (Last 30 Days)"}}),k=m(()=>{if(!u.stats)return{labels:[],datasets:[]};const o=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"];if(d.value==="daily")return{labels:u.stats.generations_per_day.map(e=>e.date),datasets:[{label:"Generations",data:u.stats.generations_per_day.map(e=>e.count),borderColor:"#3b82f6",backgroundColor:"rgba(59, 130, 246, 0.2)",tension:.1,fill:!0}]};if(d.value==="mean")return{labels:o,datasets:[{label:"Mean Generations",data:o.map(e=>u.stats.mean_per_weekday[e]),backgroundColor:"#10b981"}]};if(d.value==="variance")return{labels:o,datasets:[{label:"Variance",data:o.map(e=>u.stats.variance_per_weekday[e]),backgroundColor:"#f59e0b"}]};if(d.value==="weekly_stats"){const e=o.map(s=>u.stats.mean_per_weekday[s]),r=o.map(s=>Math.sqrt(u.stats.variance_per_weekday[s])),b=e.map((s,c)=>s+r[c]),v=e.map((s,c)=>Math.max(0,s-r[c]));return{labels:o,datasets:[{label:"Mean",data:e,borderColor:"#3b82f6",backgroundColor:"rgba(59, 130, 246, 0.5)",tension:.1,pointRadius:4,pointBackgroundColor:"#3b82f6"},{label:"Std. Deviation Range",data:b,borderColor:"transparent",backgroundColor:"rgba(59, 130, 246, 0.15)",pointRadius:0,fill:"+1"},{label:"Lower Bound",data:v,borderColor:"transparent",backgroundColor:"transparent",pointRadius:0,showInLegend:!1}]}}return{labels:[],datasets:[]}});function y(){if(p.value&&p.value.chart){const o=document.createElement("a");o.href=p.value.chart.toBase64Image("image/png",1),o.download=`lollms_global_stats_${d.value}.png`,o.click()}else i.addNotification("Could not export chart image.","error")}function f(){if(!u.stats){i.addNotification("No data to export.","warning");return}let o="data:text/csv;charset=utf-8,",e=[];if(d.value==="daily")e.push(["date","generation_count"]),u.stats.generations_per_day.forEach(v=>{e.push([v.date,v.count])});else if(d.value==="weekly_stats")e.push(["weekday","mean","variance","std_deviation"]),["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"].forEach(s=>{const c=u.stats.mean_per_weekday[s],L=u.stats.variance_per_weekday[s],H=Math.sqrt(L);e.push([s,c,L,H])});else{e.push(["weekday",d.value]);const v=d.value==="mean"?u.stats.mean_per_weekday:u.stats.variance_per_weekday;Object.entries(v).forEach(([s,c])=>{e.push([s,c])})}o+=e.map(v=>v.join(",")).join(`
`);const r=encodeURI(o),b=document.createElement("a");b.setAttribute("href",r),b.setAttribute("download",`lollms_global_stats_${d.value}.csv`),document.body.appendChild(b),b.click(),document.body.removeChild(b)}return(o,e)=>(a(),n("div",oe,[e[8]||(e[8]=t("h3",{class:"text-xl font-semibold leading-6 text-gray-900 dark:text-white"}," Global Usage Statistics ",-1)),t("div",le,[t("div",de,[t("div",ie,[t("button",{onClick:e[0]||(e[0]=r=>d.value="daily"),type:"button",class:C(["btn-group",{active:d.value==="daily"}])},"Daily",2),t("button",{onClick:e[1]||(e[1]=r=>d.value="weekly_stats"),type:"button",class:C(["btn-group",{active:d.value==="weekly_stats"}])},"Weekly Stats",2),t("button",{onClick:e[2]||(e[2]=r=>d.value="mean"),type:"button",class:C(["btn-group",{active:d.value==="mean"}])},"Mean",2),t("button",{onClick:e[3]||(e[3]=r=>d.value="variance"),type:"button",class:C(["btn-group",{active:d.value==="variance"}])},"Variance",2)]),t("div",ce,[t("button",{onClick:y,class:"btn btn-secondary btn-sm",title:"Export as PNG"},[h(P,{class:"w-4 h-4 mr-1"}),e[4]||(e[4]=x(" PNG "))]),t("button",{onClick:f,class:"btn btn-secondary btn-sm",title:"Export as CSV"},[h(P,{class:"w-4 h-4 mr-1"}),e[5]||(e[5]=x(" CSV "))])])]),t("div",ue,[$.isLoading?(a(),n("div",ge,e[6]||(e[6]=[t("p",{class:"text-gray-500"},"Loading chart data...",-1)]))):$.stats?(a(),n("div",ye,[(a(),et(st(M.value),{data:k.value,options:g.value,ref_key:"chartRef",ref:p},null,8,["data","options"]))])):(a(),n("div",pe,e[7]||(e[7]=[t("p",{class:"text-gray-500"},"Could not load statistics.",-1)])))])])]))}},me=G(_e,[["__scopeId","data-v-a10fe633"]]),ve={class:"space-y-12"},he={class:"space-y-6"},be={class:"flex items-center justify-between"},xe=["disabled"],fe={key:0,class:"grid grid-cols-1 gap-5 sm:grid-cols-2 lg:grid-cols-5"},ke={key:1,class:"grid grid-cols-1 gap-5 sm:grid-cols-2 lg:grid-cols-5"},we={class:"flex items-center"},Ce={class:"flex-shrink-0"},$e={class:"h-6 w-6 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},Me=["d"],Se={class:"ml-5 w-0 flex-1"},ze={class:"text-sm font-medium text-gray-500 dark:text-gray-400 truncate"},Ae={class:"text-2xl font-bold text-gray-900 dark:text-white"},Ue={key:2,class:"text-center p-10 bg-white dark:bg-gray-800 rounded-lg shadow"},De={class:"grid grid-cols-1 lg:grid-cols-2 gap-8"},Ge={class:"space-y-6"},Le={class:"bg-white dark:bg-gray-800 rounded-lg shadow p-5"},Te={key:0,class:"text-center py-4"},Pe={key:1,class:"space-y-4 text-sm"},Ne={class:"flex items-center gap-3"},Ve={class:"font-mono text-gray-700 dark:text-gray-300"},Ie={key:0,class:"pl-8"},Be={class:"space-y-1 list-disc list-inside"},He=["href"],je={class:"flex items-center gap-3"},Re={class:"font-mono text-gray-700 dark:text-gray-300"},Ee={key:1},Fe={class:"space-y-1 pl-8 list-disc list-inside"},We={class:"font-mono"},Oe={class:"pt-4 border-t dark:border-gray-700 text-xs text-gray-500 dark:text-gray-400"},Ze={class:"space-y-6"},qe={class:"bg-white dark:bg-gray-800 rounded-lg shadow p-5"},Je={class:"flex items-center justify-between mb-4"},Xe={key:0,class:"text-lg font-bold text-gray-700 dark:text-gray-200"},Ye={key:0,class:"text-center py-4"},Ke={key:1,class:"text-center py-4 text-gray-500"},Qe={key:2,class:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-2 xl:grid-cols-3 gap-4"},ts={class:"truncate"},es=["title"],ss={class:"flex items-center text-xs text-gray-500 dark:text-gray-400",title:"Active Connections"},as={class:"space-y-6"},ns={class:"bg-white dark:bg-gray-800 rounded-lg shadow p-5"},rs={class:"flex items-center justify-between"},is={__name:"Dashboard",setup($){const u=U(null),i=U(!0),d=B(),p=I();m(()=>p.connectedUsers);const M=m(()=>p.isLoadingConnectedUsers),g=m(()=>p.serverInfo),A=m(()=>p.isLoadingServerInfo),k=m(()=>p.allUsers),y=m(()=>p.globalGenerationStats),f=m(()=>p.isLoadingGlobalGenerationStats),o=m(()=>k.value.filter(v=>v.is_online)),e=U([{key:"total_users",label:"Total Users",icon:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"},{key:"active_users_24h",label:"Active in 24h",icon:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"},{key:"new_users_7d",label:"New in 7d",icon:"M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"},{key:"pending_approval",label:"Pending Approval",icon:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"},{key:"pending_password_resets",label:"Password Resets",icon:"M15 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"}]);async function r(){i.value=!0;try{await Promise.all([p.fetchAllUsers(),p.fetchDashboardStats(),p.fetchSystemStatus(),p.fetchServerInfo(),p.fetchGlobalGenerationStats()]),u.value=p.dashboardStats}catch{d.addNotification("Could not load dashboard statistics.","error")}finally{i.value=!1}}async function b(){const v=await d.showConfirmation({title:"Purge Temporary Files?",message:"This will permanently delete temporary files from all users that are older than 24 hours. This action cannot be undone. Check the Task Manager for progress.",confirmText:"Purge Now",cancelText:"Cancel"});v&&v.confirmed&&(p.purgeUnusedUploads(),d.addNotification("Purge task has been started.","info"))}return at(r),(v,s)=>(a(),n("div",ve,[t("div",he,[t("div",be,[s[2]||(s[2]=t("h3",{class:"text-xl font-semibold leading-6 text-gray-900 dark:text-white"}," Application Overview ",-1)),t("button",{onClick:r,class:"btn btn-secondary btn-sm",disabled:i.value},[(a(),n("svg",{xmlns:"http://www.w3.org/2000/svg",class:C(["h-4 w-4",{"animate-spin":i.value}]),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},s[0]||(s[0]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h5M20 20v-5h-5M4 4l16 16"},null,-1)]),2)),s[1]||(s[1]=t("span",{class:"ml-2"},"Refresh",-1))],8,xe)]),i.value?(a(),n("div",fe,[(a(),n(S,null,z(5,c=>t("div",{key:c,class:"bg-white dark:bg-gray-800/50 rounded-lg shadow p-5 animate-pulse"},s[3]||(s[3]=[t("div",{class:"h-6 bg-gray-200 dark:bg-gray-700 rounded w-3/4 mb-4"},null,-1),t("div",{class:"h-10 bg-gray-200 dark:bg-gray-700 rounded w-1/2"},null,-1)]))),64))])):u.value?(a(),n("div",ke,[(a(!0),n(S,null,z(e.value,c=>(a(),n("div",{key:c.key,class:"bg-white dark:bg-gray-800 rounded-lg shadow p-5 flex flex-col justify-between"},[t("div",null,[t("div",we,[t("div",Ce,[(a(),n("svg",$e,[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:c.icon},null,8,Me)]))]),t("div",Se,[t("dl",null,[t("dt",ze,l(c.label),1),t("dd",null,[t("div",Ae,l(u.value[c.key]),1)])])])])])]))),128))])):(a(),n("div",Ue,s[4]||(s[4]=[t("p",{class:"text-gray-500"},"Could not load dashboard data.",-1)])))]),h(me,{stats:y.value,"is-loading":f.value},null,8,["stats","is-loading"]),t("div",De,[t("div",Ge,[s[10]||(s[10]=t("h3",{class:"text-xl font-semibold leading-6 text-gray-900 dark:text-white"}," Server Information ",-1)),t("div",Le,[A.value?(a(),n("div",Te,s[5]||(s[5]=[t("p",null,"Loading server info...",-1)]))):g.value?(a(),n("div",Pe,[t("div",Ne,[h(nt,{class:"w-5 h-5 text-gray-400"}),s[6]||(s[6]=t("span",{class:"font-semibold"},"Address:",-1)),t("span",Ve,l(g.value.host)+":"+l(g.value.port),1),t("span",{class:C(["px-2 py-0.5 text-xs rounded-full",g.value.https_enabled?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"])},l(g.value.https_enabled?"HTTPS":"HTTP"),3)]),g.value.host==="0.0.0.0"&&g.value.local_ips&&g.value.local_ips.length>0?(a(),n("div",Ie,[s[7]||(s[7]=t("h4",{class:"font-semibold text-gray-600 dark:text-gray-300 mb-1"},"Accessible Addresses:",-1)),t("ul",Be,[(a(!0),n(S,null,z(g.value.local_ips,c=>(a(),n("li",{key:c},[t("a",{href:`${g.value.https_enabled?"https":"http"}://${c}:${g.value.port}`,target:"_blank",class:"font-mono text-blue-600 dark:text-blue-400 hover:underline"},l(c)+":"+l(g.value.port),9,He)]))),128))])])):w("",!0),t("div",je,[h(ct,{class:"w-5 h-5 text-gray-400"}),s[8]||(s[8]=t("span",{class:"font-semibold"},"CORS Origins:",-1)),t("span",Re,l(g.value.cors_origins.join(", ")||"None"),1)]),g.value.active_ports.length>0?(a(),n("div",Ee,[s[9]||(s[9]=t("h4",{class:"font-semibold mt-4 mb-2"},"Active App Ports:",-1)),t("ul",Fe,[(a(!0),n(S,null,z(g.value.active_ports,c=>(a(),n("li",{key:c.app_id},[t("span",We,l(c.port),1),x(" - "+l(c.app_name),1)]))),128))])])):w("",!0),t("div",Oe," LoLLMs v"+l(g.value.lollms_version)+" | Python "+l(g.value.python_version.split(" ")[0]),1)])):w("",!0)])]),t("div",Ze,[s[13]||(s[13]=t("h3",{class:"text-xl font-semibold leading-6 text-gray-900 dark:text-white"}," Live Connections ",-1)),t("div",qe,[t("div",Je,[s[11]||(s[11]=t("div",null,[t("h4",{class:"font-semibold text-gray-800 dark:text-gray-100"},"Currently Connected Users"),t("p",{class:"text-sm text-gray-500 dark:text-gray-400 mt-1"}," Users with an active WebSocket connection. ")],-1)),M.value?w("",!0):(a(),n("span",Xe,l(o.value.length),1))]),M.value?(a(),n("div",Ye,s[12]||(s[12]=[t("p",{class:"text-gray-500"},"Loading connected users...",-1)]))):o.value.length===0?(a(),n("div",Ke," No users are currently connected. ")):(a(),n("ul",Qe,[(a(!0),n(S,null,z(o.value,c=>(a(),n("li",{key:c.id,class:"flex items-center space-x-3 p-2 bg-gray-50 dark:bg-gray-700/50 rounded-lg"},[h(rt,{icon:c.icon,username:c.username,"size-class":"h-8 w-8"},null,8,["icon","username"]),t("div",ts,[t("span",{class:"font-medium text-sm truncate",title:c.username},l(c.username),9,es),t("div",ss,[h(it,{class:"w-3 h-3 mr-1"}),x(" "+l(c.connection_count),1)])])]))),128))]))])])]),t("div",as,[s[16]||(s[16]=t("h3",{class:"text-xl font-semibold leading-6 text-gray-900 dark:text-white"}," Maintenance Actions ",-1)),t("div",ns,[t("div",rs,[s[15]||(s[15]=t("div",null,[t("h4",{class:"font-semibold text-gray-800 dark:text-gray-100"},"Purge Temporary Files"),t("p",{class:"text-sm text-gray-500 dark:text-gray-400 mt-1"}," Delete all user-uploaded files in temporary folders that are older than 24 hours. This does not affect discussions, artefacts, or data stores. ")],-1)),t("button",{onClick:b,class:"btn btn-danger flex items-center"},[h(ot,{class:"w-4 h-4 mr-2"}),s[14]||(s[14]=t("span",null,"Purge Now",-1))])])])]),h(re)]))}};export{is as default};
