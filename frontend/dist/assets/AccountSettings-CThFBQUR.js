import{u as I,a as B,c as F,r,o as M,b as $,d as j,e as p,f as e,w as P,g as E,_ as q,t as _,h as n,v as x,i as h,j as b,k as A}from"./index-BpPGy0H-.js";import{_ as N,a as C}from"./IconEyeOff-zQY_1yzX.js";const G={key:0,class:"space-y-10"},J={class:"bg-white dark:bg-gray-800 shadow-md rounded-lg"},L={class:"border-t border-gray-200 dark:border-gray-700 p-4 sm:p-6"},T={class:"flex-shrink-0 flex flex-col items-center space-y-2 w-full md:w-40"},z=["disabled"],W={class:"flex-grow space-y-6"},H={class:"grid grid-cols-1 sm:grid-cols-2 gap-6"},K={class:"flex justify-end"},O=["disabled"],Q={class:"bg-white dark:bg-gray-800 shadow-md rounded-lg"},R={class:"border-t border-gray-200 dark:border-gray-700"},X={class:"mt-1 relative"},Y=["type"],Z={class:"mt-1 relative"},ee=["type"],te={class:"mt-1 relative"},ae=["type"],se={class:"flex justify-end"},le=["disabled"],ne={__name:"AccountSettings",setup(re){const d=I(),u=B(),o=F(()=>d.user),s=r({first_name:"",family_name:"",email:"",birth_date:""}),c=r(!1),l=r({current_password:"",new_password:""}),f=r(""),v=r(!1),y=r(!1),m=r(!1),g=r(!1),w=r(null);M(()=>{o.value&&(s.value.first_name=o.value.first_name||"",s.value.family_name=o.value.family_name||"",s.value.email=o.value.email||"",s.value.birth_date=o.value.birth_date||"")});async function U(){c.value=!0;try{await d.updateUserProfile(s.value)}catch{}finally{c.value=!1}}async function S(){if(l.value.new_password!==f.value){u.addNotification("New passwords do not match.","error");return}if(l.value.new_password.length<8){u.addNotification("New password must be at least 8 characters long.","error");return}v.value=!0;try{await d.changePassword(l.value),l.value.current_password="",l.value.new_password="",f.value=""}catch{}finally{v.value=!1}}const V=()=>{var i;(i=w.value)==null||i.click()},D=async i=>{const t=i.target.files[0];if(!t)return;g.value=!0,u.addNotification("Uploading icon...","info");const a=new FormData;a.append("file",t);try{const k=await A.put("/api/auth/me/icon",a,{headers:{"Content-Type":"multipart/form-data"}});d.user&&(d.user.icon=k.data.icon_url),u.addNotification("Icon updated successfully!","success")}catch{u.addNotification("Icon upload failed.","error")}finally{g.value=!1,w.value&&(w.value.value="")}};return(i,t)=>o.value?(p(),$("div",G,[e("div",J,[t[14]||(t[14]=e("div",{class:"p-4 sm:p-6"},[e("h2",{class:"text-xl font-bold leading-6 text-gray-900 dark:text-white"},"Profile"),e("p",{class:"mt-1 max-w-2xl text-sm text-gray-500 dark:text-gray-400"},"Manage your public profile and personal information.")],-1)),e("div",L,[e("form",{onSubmit:P(U,["prevent"]),class:"flex flex-col md:flex-row gap-8"},[e("div",T,[E(q,{icon:o.value.icon,username:o.value.username,"size-class":"h-28 w-28"},null,8,["icon","username"]),e("input",{type:"file",ref_key:"fileInput",ref:w,onChange:D,accept:"image/png, image/jpeg, image/webp",class:"hidden"},null,544),e("button",{type:"button",onClick:V,disabled:g.value,class:"btn btn-secondary w-full"},_(g.value?"Uploading...":"Change Icon"),9,z),t[9]||(t[9]=e("p",{class:"text-xs text-center text-gray-500 dark:text-gray-400"},"Max 5MB (JPG, PNG, WEBP)",-1))]),e("div",W,[e("div",H,[e("div",null,[t[10]||(t[10]=e("label",{for:"firstName",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"First Name",-1)),n(e("input",{type:"text",id:"firstName","onUpdate:modelValue":t[0]||(t[0]=a=>s.value.first_name=a),class:"input-field mt-1",placeholder:"Jane"},null,512),[[x,s.value.first_name]])]),e("div",null,[t[11]||(t[11]=e("label",{for:"familyName",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Family Name",-1)),n(e("input",{type:"text",id:"familyName","onUpdate:modelValue":t[1]||(t[1]=a=>s.value.family_name=a),class:"input-field mt-1",placeholder:"Doe"},null,512),[[x,s.value.family_name]])])]),e("div",null,[t[12]||(t[12]=e("label",{for:"email",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Email Address",-1)),n(e("input",{type:"email",id:"email","onUpdate:modelValue":t[2]||(t[2]=a=>s.value.email=a),class:"input-field mt-1",placeholder:"you@example.com"},null,512),[[x,s.value.email]])]),e("div",null,[t[13]||(t[13]=e("label",{for:"birthDate",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Birth Date",-1)),n(e("input",{type:"date",id:"birthDate","onUpdate:modelValue":t[3]||(t[3]=a=>s.value.birth_date=a),class:"input-field mt-1"},null,512),[[x,s.value.birth_date]])]),e("div",K,[e("button",{type:"submit",class:"btn btn-primary",disabled:c.value},_(c.value?"Saving...":"Save Profile"),9,O)])])],32)])]),e("div",Q,[t[18]||(t[18]=e("div",{class:"px-4 py-5 sm:p-6"},[e("h2",{class:"text-xl font-bold leading-6 text-gray-900 dark:text-white"},"Change Password"),e("p",{class:"mt-1 max-w-2xl text-sm text-gray-500 dark:text-gray-400"},"Ensure your account is using a long, random password to stay secure.")],-1)),e("div",R,[e("form",{onSubmit:P(S,["prevent"]),class:"p-4 sm:p-6 space-y-6"},[e("div",null,[t[15]||(t[15]=e("label",{for:"currentPassword",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Current Password",-1)),e("div",X,[n(e("input",{type:y.value?"text":"password",id:"currentPassword","onUpdate:modelValue":t[4]||(t[4]=a=>l.value.current_password=a),required:"",class:"input-field pr-10",autocomplete:"current-password"},null,8,Y),[[h,l.value.current_password]]),e("button",{type:"button",onClick:t[5]||(t[5]=a=>y.value=!y.value),class:"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600 dark:hover:text-gray-200"},[y.value?(p(),b(N,{key:0,class:"w-5 h-5"})):(p(),b(C,{key:1,class:"w-5 h-5"}))])])]),e("div",null,[t[16]||(t[16]=e("label",{for:"newPassword",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"New Password",-1)),e("div",Z,[n(e("input",{type:m.value?"text":"password",id:"newPassword","onUpdate:modelValue":t[6]||(t[6]=a=>l.value.new_password=a),required:"",minlength:"8",class:"input-field pr-10",autocomplete:"new-password"},null,8,ee),[[h,l.value.new_password]]),e("button",{type:"button",onClick:t[7]||(t[7]=a=>m.value=!m.value),class:"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600 dark:hover:text-gray-200"},[m.value?(p(),b(N,{key:0,class:"w-5 h-5"})):(p(),b(C,{key:1,class:"w-5 h-5"}))])])]),e("div",null,[t[17]||(t[17]=e("label",{for:"confirmPassword",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Confirm New Password",-1)),e("div",te,[n(e("input",{type:m.value?"text":"password",id:"confirmPassword","onUpdate:modelValue":t[8]||(t[8]=a=>f.value=a),required:"",class:"input-field pr-10",autocomplete:"new-password"},null,8,ae),[[h,f.value]])])]),e("div",se,[e("button",{type:"submit",class:"btn btn-primary",disabled:v.value},_(v.value?"Changing...":"Change Password"),9,le)])],32)])])])):j("",!0)}};export{ne as default};
