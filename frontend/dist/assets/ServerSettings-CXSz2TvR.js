import{r as C,c as V,b as n,d as o,h as t,F as b,m as g,e as m,cN as W,a5 as H,l as k,v as F,a8 as J,P as N,j as $,k as Y,ad as Q,c7 as X,a as Z,ae as ee,o as te,w as z,g as L,n as v,q as le,t as f,$ as G,cY as ae,G as se,a3 as D,c2 as M,i as oe}from"./index-DnjdbnqE.js";import{I as ne}from"./IconArrowUp-h17zmnr8.js";const re={class:"space-y-2"},ie=["value","onInput"],de=["onClick","disabled"],ue=["onClick","disabled"],ce=["onClick"],pe={class:"flex items-center gap-2"},ye=["onKeyup"],ve={__name:"StringListEditor",props:{modelValue:{type:[String,Array],default:""}},emits:["update:modelValue"],setup(T,{emit:c}){const U=T,_=c,a=C(""),i=V({get:()=>{const u=U.modelValue;return Array.isArray(u)?u.map(d=>String(d).trim()).filter(d=>d):typeof u=="string"?(u||"").split(",").map(d=>d.trim()).filter(d=>d):[]},set:u=>{_("update:modelValue",u.join(", "))}});function h(){a.value.trim()&&!i.value.includes(a.value.trim())&&(i.value=[...i.value,a.value.trim()],a.value="")}function I(u){const d=[...i.value];d.splice(u,1),i.value=d}function x(u,d){const y=[...i.value],p=u+d;p>=0&&p<y.length&&([y[u],y[p]]=[y[p],y[u]],i.value=y)}return(u,d)=>(o(),n("div",re,[(o(!0),n(b,null,g(i.value,(y,p)=>(o(),n("div",{key:p,class:"flex items-center gap-2"},[t("input",{type:"text",value:y,onInput:w=>{const A=[...i.value];A[p]=w.target.value,i.value=A},class:"input-field flex-grow"},null,40,ie),t("button",{onClick:w=>x(p,-1),disabled:p===0,class:"btn-icon",type:"button",title:"Move Up"},[m(ne,{class:"w-4 h-4"})],8,de),t("button",{onClick:w=>x(p,1),disabled:p===i.value.length-1,class:"btn-icon",type:"button",title:"Move Down"},[m(W,{class:"w-4 h-4"})],8,ue),t("button",{onClick:w=>I(p),class:"btn-icon-danger",type:"button",title:"Remove"},[m(H,{class:"w-4 h-4"})],8,ce)]))),128)),t("div",pe,[k(t("input",{type:"text","onUpdate:modelValue":d[0]||(d[0]=y=>a.value=y),onKeyup:J(N(h,["prevent"]),["enter"]),class:"input-field flex-grow",placeholder:"Add new origin"},null,40,ye),[[F,a.value]]),t("button",{onClick:h,class:"btn btn-secondary",type:"button"},[m(Y,{class:"w-4 h-4 mr-1"}),d[1]||(d[1]=$(" Add"))])])]))}},be={class:"bg-white dark:bg-gray-800 shadow-md rounded-lg"},fe={class:"space-y-12"},ge={key:0},ke={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},me=["for"],_e={key:1,class:"flex items-center justify-between bg-gray-50 dark:bg-gray-700/30 p-3 rounded-lg border dark:border-gray-600"},he={class:"text-sm text-gray-700 dark:text-gray-300"},xe=["onClick"],we=["type","step","id","onUpdate:modelValue","readonly"],Se={class:"border-t pt-8 dark:border-gray-700"},Ce={class:"settings-category-title flex items-center gap-2"},Ve={class:"bg-gray-50 dark:bg-gray-700/20 p-6 rounded-xl border dark:border-gray-700"},$e={class:"flex items-center justify-between mb-6 pb-6 border-b dark:border-gray-600"},Ue={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},Ie={class:"flex gap-2 mt-1"},Ae={class:"flex gap-2 mt-1"},Le={class:"flex flex-wrap gap-4 pt-6 mt-2"},Me=["disabled"],Ne=["disabled"],De={class:"flex gap-2"},Fe=["disabled"],Te=["disabled"],je={key:1,class:"border-t pt-8 dark:border-gray-700"},Ee={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},ze={key:0,class:"flex items-center justify-between h-full bg-gray-50 dark:bg-gray-700/30 p-3 rounded-lg border dark:border-gray-600"},Ge={class:"text-sm font-medium text-gray-700 dark:text-gray-300 pr-4"},Pe=["onClick"],qe=["for"],Re=["id","onUpdate:modelValue"],Be={key:2,class:"border-t pt-8 dark:border-gray-700"},Ke={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},Oe={key:0,class:"flex items-center justify-between h-full bg-gray-50 dark:bg-gray-700/30 p-3 rounded-lg border dark:border-gray-600"},We={class:"text-sm font-medium text-gray-700 dark:text-gray-300 pr-4"},He=["onClick"],Je=["for"],Ye=["id","onUpdate:modelValue"],Qe=["label"],Xe=["value"],Ze=["id","onUpdate:modelValue"],et=["label"],tt=["value"],lt=["id","onUpdate:modelValue"],at=["value"],st=["type","id","onUpdate:modelValue"],ot={class:"mt-8 pt-6 border-t border-gray-200 dark:border-gray-700"},nt={class:"flex justify-end"},rt=["disabled"],it={key:1,class:"p-12 text-center text-gray-500"},dt={key:0,class:"animate-pulse"},ut={key:1},ct={__name:"ServerSettings",setup(T){const c=X(),U=Z(),_=ee(),a=C({}),i=C(!1),h=C(!1);let I="{}";const x=C(null),u=C(null),d=[{value:0,label:"Beginner"},{value:1,label:"Novice"},{value:2,label:"Intermediate"},{value:3,label:"Advanced"},{value:4,label:"Expert"}],y=V(()=>c.globalSettings.filter(r=>r.category==="Server")),p=V(()=>c.globalSettings.filter(r=>r.category==="Registration")),w=V(()=>c.globalSettings.filter(r=>r.category==="Defaults")),A=V(()=>_.availableVectorizers),P=V(()=>_.availableLLMModelsGrouped);te(async()=>{c.globalSettings.length===0&&await c.fetchGlobalSettings(),_.availableLollmsModels.length===0&&await _.fetchAdminAvailableLollmsModels(),await _.fetchAvailableVectorizers()}),z(()=>c.globalSettings,q,{deep:!0,immediate:!0}),z(a,r=>{h.value=JSON.stringify(r)!==I},{deep:!0});function q(){const r=c.globalSettings;if(!r||r.length===0){a.value={},I="{}",h.value=!1;return}const l={};r.filter(s=>["Server","Registration","Defaults"].includes(s.category)).forEach(s=>{l[s.key]=s.value}),a.value=l,I=JSON.stringify(l),h.value=!1}async function j(r,l){const e=r.target.files[0];if(e){i.value=!0;try{const s=await c.uploadSslFile(e,l);l==="cert"?a.value.ssl_certfile=s:l==="key"&&(a.value.ssl_keyfile=s),U.addNotification(`${e.name} uploaded successfully.`,"success")}finally{i.value=!1,x.value&&x.value.length>0&&(x.value[0].value=""),u.value&&u.value.length>0&&(u.value[0].value="")}}}async function R(){i.value=!0;try{await c.updateGlobalSettings({...a.value}),U.addNotification("Settings saved. A server restart may be required for some changes to take effect.","info",8e3)}finally{i.value=!1}}async function B(){const r=await U.showConfirmation({title:"Generate Certificate?",message:"This will generate a new self-signed certificate and overwrite existing SSL settings. A server restart will be required.",confirmText:"Generate & Enable"});if(typeof r=="object"?r.confirmed:r){i.value=!0;try{await c.generateSelfSignedCert()}catch{}finally{i.value=!1}}}function K(){c.downloadCertificate()}function E(r){c.downloadTrustScript(r)}function O(r){return["cors_origins_exceptions","data_path","huggingface_cache_path","ssl_certfile","ssl_keyfile"].includes(r)}return(r,l)=>(o(),n("div",be,[l[24]||(l[24]=t("div",{class:"p-6 border-b border-gray-200 dark:border-gray-700"},[t("h3",{class:"text-xl font-semibold leading-6 text-gray-900 dark:text-white"},"Server Settings"),t("p",{class:"mt-1 text-sm text-gray-500 dark:text-gray-400"},"Manage core server behavior, user registration, and defaults for new users.")],-1)),Object.keys(a.value).length?(o(),n("form",{key:0,onSubmit:N(R,["prevent"]),class:"p-6"},[t("div",fe,[y.value.length>0?(o(),n("div",ge,[l[9]||(l[9]=t("h4",{class:"settings-category-title"},"Server Configuration",-1)),l[10]||(l[10]=t("div",{class:"mb-6 p-4 bg-blue-50 dark:bg-blue-900/20 border-l-4 border-blue-400 text-blue-800 dark:text-blue-200 rounded-r-lg"},[t("p",{class:"text-sm font-medium"},"Note: Changing server host, port, or SSL settings requires a server restart.")],-1)),t("div",ke,[(o(!0),n(b,null,g(y.value.filter(e=>!["ssl_certfile","ssl_keyfile","https_enabled"].includes(e.key)),e=>(o(),n("div",{key:e.key,class:v(["setting-card",{"md:col-span-2":O(e.key)}])},[t("label",{for:e.key,class:"label mb-2"},f(e.description),9,me),e.key==="cors_origins_exceptions"?(o(),le(ve,{key:0,modelValue:a.value[e.key],"onUpdate:modelValue":s=>a.value[e.key]=s},null,8,["modelValue","onUpdate:modelValue"])):e.type==="boolean"?(o(),n("div",_e,[t("span",he,f(e.description),1),t("button",{onClick:s=>a.value[e.key]=!a.value[e.key],type:"button",class:v([a.value[e.key]?"bg-blue-600":"bg-gray-300 dark:bg-gray-600","toggle-switch"])},[t("span",{class:v([a.value[e.key]?"translate-x-5":"translate-x-0","toggle-knob"])},null,2)],10,xe)])):k((o(),n("input",{key:2,type:e.type==="string"?"text":"number",step:e.type==="float"?"0.1":"1",id:e.key,"onUpdate:modelValue":s=>a.value[e.key]=s,class:v(["input-field w-full",{"bg-gray-100 dark:bg-gray-700 cursor-not-allowed opacity-75":e.key==="data_path"||e.key==="huggingface_cache_path"}]),readonly:e.key==="data_path"||e.key==="huggingface_cache_path"},null,10,we)),[[G,a.value[e.key]]])],2))),128))])])):L("",!0),t("div",Se,[t("h4",Ce,[m(ae,{class:"w-5 h-5 text-green-600 dark:text-green-400"}),l[11]||(l[11]=$(" HTTPS Configuration "))]),t("div",Ve,[t("div",$e,[l[12]||(l[12]=t("div",null,[t("h5",{class:"text-base font-semibold text-gray-900 dark:text-gray-100"},"Enable Secure Connection"),t("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"Toggle HTTPS support. Requires valid certificate files.")],-1)),t("button",{onClick:l[0]||(l[0]=e=>a.value.https_enabled=!a.value.https_enabled),type:"button",class:v([a.value.https_enabled?"bg-green-500":"bg-gray-300 dark:bg-gray-600","toggle-switch"])},[t("span",{class:v([a.value.https_enabled?"translate-x-5":"translate-x-0","toggle-knob"])},null,2)],2)]),t("div",Ue,[t("div",null,[l[13]||(l[13]=t("label",{class:"label"},"SSL Certificate",-1)),t("div",Ie,[k(t("input",{type:"text","onUpdate:modelValue":l[1]||(l[1]=e=>a.value.ssl_certfile=e),class:"input-field flex-grow text-xs font-mono",placeholder:"/path/to/cert.pem"},null,512),[[F,a.value.ssl_certfile]]),t("input",{type:"file",ref_key:"certFileInput",ref:x,onChange:l[2]||(l[2]=e=>j(e,"cert")),class:"hidden"},null,544),t("button",{onClick:l[3]||(l[3]=N(e=>r.$refs.certFileInput.click(),["prevent"])),type:"button",class:"btn btn-secondary text-xs whitespace-nowrap"},"Upload PEM")])]),t("div",null,[l[14]||(l[14]=t("label",{class:"label"},"SSL Private Key",-1)),t("div",Ae,[k(t("input",{type:"text","onUpdate:modelValue":l[4]||(l[4]=e=>a.value.ssl_keyfile=e),class:"input-field flex-grow text-xs font-mono",placeholder:"/path/to/key.pem"},null,512),[[F,a.value.ssl_keyfile]]),t("input",{type:"file",ref_key:"keyFileInput",ref:u,onChange:l[5]||(l[5]=e=>j(e,"key")),class:"hidden"},null,544),t("button",{onClick:l[6]||(l[6]=N(e=>r.$refs.keyFileInput.click(),["prevent"])),type:"button",class:"btn btn-secondary text-xs whitespace-nowrap"},"Upload PEM")])])]),t("div",Le,[t("button",{type:"button",onClick:B,class:"btn btn-primary flex items-center gap-2",disabled:i.value},[m(se,{class:"w-4 h-4"}),l[15]||(l[15]=$(" Auto-Generate Self-Signed Cert "))],8,Me),t("button",{type:"button",onClick:K,class:"btn btn-secondary flex items-center gap-2",disabled:!a.value.ssl_certfile},[m(D,{class:"w-4 h-4"}),l[16]||(l[16]=$(" Download Certificate "))],8,Ne),t("div",De,[t("button",{type:"button",onClick:l[7]||(l[7]=e=>E("windows")),class:"btn btn-secondary flex items-center gap-2",disabled:!a.value.ssl_certfile,title:"Download .bat script to trust cert on Windows"},[m(D,{class:"w-4 h-4"}),l[17]||(l[17]=$(" Trust Script (Win) "))],8,Fe),t("button",{type:"button",onClick:l[8]||(l[8]=e=>E("linux")),class:"btn btn-secondary flex items-center gap-2",disabled:!a.value.ssl_certfile,title:"Download .sh script to trust cert on Linux"},[m(D,{class:"w-4 h-4"}),l[18]||(l[18]=$(" Trust Script (Linux) "))],8,Te)])])])]),p.value.length>0?(o(),n("div",je,[l[20]||(l[20]=t("h4",{class:"settings-category-title"},"New User Registration",-1)),t("div",Ee,[(o(!0),n(b,null,g(p.value,e=>(o(),n("div",{key:e.key,class:v(["setting-card",{"md:col-span-2":e.key==="registration_mode"&&e.description.length>50}])},[e.type==="boolean"?(o(),n("div",ze,[t("span",Ge,f(e.description),1),t("button",{onClick:s=>a.value[e.key]=!a.value[e.key],type:"button",class:v([a.value[e.key]?"bg-blue-600":"bg-gray-300 dark:bg-gray-600","toggle-switch flex-shrink-0"])},[t("span",{class:v([a.value[e.key]?"translate-x-5":"translate-x-0","toggle-knob"])},null,2)],10,Pe)])):e.key==="registration_mode"?(o(),n(b,{key:1},[t("label",{for:e.key,class:"label mb-1"},f(e.description),9,qe),k(t("select",{id:e.key,"onUpdate:modelValue":s=>a.value[e.key]=s,class:"input-field w-full"},l[19]||(l[19]=[t("option",{value:"direct"},"Direct (Instantly Active)",-1),t("option",{value:"admin_approval"},"Admin Approval Required",-1)]),8,Re),[[M,a.value[e.key]]])],64)):L("",!0)],2))),128))])])):L("",!0),w.value.length>0?(o(),n("div",Be,[l[23]||(l[23]=t("h4",{class:"settings-category-title"},"Defaults for New Users",-1)),t("div",Ke,[(o(!0),n(b,null,g(w.value,e=>(o(),n("div",{key:e.key,class:"setting-card"},[e.type==="boolean"?(o(),n("div",Oe,[t("span",We,f(e.description),1),t("button",{onClick:s=>a.value[e.key]=!a.value[e.key],type:"button",class:v([a.value[e.key]?"bg-blue-600":"bg-gray-300 dark:bg-gray-600","toggle-switch flex-shrink-0"])},[t("span",{class:v([a.value[e.key]?"translate-x-5":"translate-x-0","toggle-knob"])},null,2)],10,He)])):(o(),n(b,{key:1},[t("label",{for:e.key,class:"label mb-1"},f(e.description),9,Je),e.key==="default_lollms_model_name"?k((o(),n("select",{key:0,id:e.key,"onUpdate:modelValue":s=>a.value[e.key]=s,class:"input-field w-full"},[l[21]||(l[21]=t("option",{value:""},"(None - User Selects)",-1)),(o(!0),n(b,null,g(P.value,s=>(o(),n("optgroup",{key:s.label,label:s.label},[(o(!0),n(b,null,g(s.items,S=>(o(),n("option",{key:S.id,value:S.id},f(S.name),9,Xe))),128))],8,Qe))),128))],8,Ye)),[[M,a.value[e.key]]]):e.key==="default_safe_store_vectorizer"?k((o(),n("select",{key:1,id:e.key,"onUpdate:modelValue":s=>a.value[e.key]=s,class:"input-field w-full"},[l[22]||(l[22]=t("option",{value:"",disabled:""},"Select Vectorizer Model",-1)),(o(!0),n(b,null,g(A.value,s=>(o(),n("optgroup",{key:s.id,label:s.alias||s.vectorizer_name},[(o(!0),n(b,null,g(s.models,S=>(o(),n("option",{key:S.value,value:`${s.alias}/${S.value}`},f(S.name),9,tt))),128))],8,et))),128))],8,Ze)),[[M,a.value[e.key]]]):e.key==="default_user_ui_level"?k((o(),n("select",{key:2,id:e.key,"onUpdate:modelValue":s=>a.value[e.key]=s,class:"input-field w-full"},[(o(),n(b,null,g(d,s=>t("option",{key:s.value,value:s.value},f(s.label),9,at)),64))],8,lt)),[[M,a.value[e.key],void 0,{number:!0}]]):k((o(),n("input",{key:3,type:e.type==="string"?"text":"number",id:e.key,"onUpdate:modelValue":s=>a.value[e.key]=s,class:"input-field w-full"},null,8,st)),[[G,a.value[e.key]]])],64))]))),128))])])):L("",!0)]),t("div",ot,[t("div",nt,[t("button",{type:"submit",class:"btn btn-primary",disabled:i.value||!h.value},f(i.value?"Saving...":"Save All Settings"),9,rt)])])],32)):(o(),n("div",it,[oe(c).isLoadingSettings?(o(),n("p",dt,"Loading settings...")):(o(),n("p",ut,"Could not load server settings."))]))]))}},vt=Q(ct,[["__scopeId","data-v-49ba1327"]]);export{vt as default};
