import{ad as Pe,b as l,d as a,h as t,ck as Ve,ae as Ae,a as je,s as Ne,cl as Ue,b_ as ze,c1 as L,r as _,c as M,w as Ee,o as Be,C as Le,K as Re,a0 as Fe,q as se,i as d,g,j as k,cb as q,t as v,al as Oe,e as u,G as W,l as b,v as R,cm as T,cn as Ge,c2 as oe,co as qe,F as P,m as F,f as We,y as Ze,p as He,a9 as Ke,a5 as Ye,ce as ne,k as Je,a3 as Qe,P as C,z as Xe,W as et,$ as tt,a2 as st,ak as ot,n as ae,a7 as nt,cp as at,c5 as lt}from"./index-DnjdbnqE.js";const it={},rt={xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"};function dt(le,p){return a(),l("svg",rt,p[0]||(p[0]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6.827 6.175A2.31 2.31 0 0 1 5.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 0 0 2.25 2.25h15A2.25 2.25 0 0 0 21.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 0 0-1.134-.175 2.31 2.31 0 0 1-1.64-1.055l-.822-1.316a2.192 2.192 0 0 0-1.736-1.039 48.776 48.776 0 0 0-5.232 0 2.192 2.192 0 0 0-1.736 1.039l-.821 1.316Z"},null,-1),t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M16.5 12.75a4.5 4.5 0 1 1-9 0 4.5 4.5 0 0 1 9 0ZM18.75 10.5h.008v.008h-.008V10.5Z"},null,-1)]))}const ut=Pe(it,[["render",dt]]),ct={class:"flex items-center gap-2"},pt=["disabled"],mt={key:0,class:"absolute inset-0 bg-blue-500/20 border-4 border-dashed border-blue-500 rounded-lg z-20 flex items-center justify-center m-4 pointer-events-none"},ft={class:"flex-grow min-h-0 flex"},gt={class:"w-96 flex-shrink-0 bg-white dark:bg-gray-800 border-r dark:border-gray-700 flex flex-col"},vt={class:"flex-grow p-4 space-y-4 overflow-y-auto custom-scrollbar"},bt={class:"flex justify-between items-center mb-1"},ht=["disabled"],xt={class:"relative mt-1"},wt={class:"flex justify-between items-center mb-1"},yt=["disabled"],_t={class:"relative mt-1"},kt={class:"pt-4 border-t dark:border-gray-600 space-y-2"},Ct=["disabled"],St={class:"pt-4 border-t dark:border-gray-600"},It={class:"flex items-center justify-between"},$t=["title"],Dt={key:0,class:"mt-4 grid grid-cols-2 gap-4 items-end"},Mt={key:0},Tt=["for"],Pt=["id","onUpdate:modelValue"],Vt=["value"],At=["type","step","id","onUpdate:modelValue","placeholder"],jt={class:"p-4 border-t dark:border-gray-700 flex-shrink-0"},Nt={class:"flex-grow overflow-y-auto p-4 sm:p-6 flex flex-col"},Ut={class:"flex-grow min-h-0 bg-white dark:bg-gray-800 p-4 rounded-lg shadow-md flex flex-col"},zt={class:"flex justify-between items-center mb-4 flex-shrink-0 flex-wrap gap-2"},Et={class:"flex items-center gap-2"},Bt={class:"text-lg font-semibold"},Lt={key:0,class:"flex items-center gap-2"},Rt={class:"text-sm text-gray-500"},Ft={class:"flex items-center gap-2"},Ot={for:"upload-image-btn",class:"btn btn-secondary btn-sm cursor-pointer"},Gt={key:0,class:"flex-shrink-0 mb-4"},qt={class:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4"},Wt=["title"],Zt={class:"w-full bg-gray-300 dark:bg-gray-600 rounded-full h-1 mt-2"},Ht={key:1,class:"flex-grow flex items-center justify-center"},Kt={key:2,class:"flex-grow flex items-center justify-center text-center text-gray-500"},Yt={key:3,class:"flex-grow overflow-y-auto custom-scrollbar -m-2 p-2"},Jt={class:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4"},Qt=["onClick"],Xt={class:"absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity flex flex-col justify-between p-2 text-white"},es={class:"flex justify-end"},ts={key:0,class:"w-3 h-3 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},ss=["title"],os={key:0,class:"absolute top-1 left-1 bg-red-500 text-white text-xs font-bold rounded-full w-5 h-5 flex items-center justify-center z-10"},ns={class:"absolute bottom-1 right-1 flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity"},as=["onClick"],ls=["onClick"],is=["onClick"],ds={__name:"ImageStudioView",setup(le){const p=Ve(),V=Ae(),c=je(),Z=Ne(),S=Ue(),ie=ze(),H=Xe(),{images:h,isLoading:re,isGenerating:K,prompt:f,negativePrompt:y,imageSize:I,nImages:A,seed:$,generationParams:x}=L(p),{user:de}=L(Z),{imageGenerationTasks:ue,imageGenerationTasksCount:Y}=L(ie),{currentModelVisionSupport:ce}=L(S),j=_(!1),D=_(null),J=_(""),Q=_("description"),i=_([]),w=M(()=>i.value.length>0),X=M({get:()=>h.value.length>0&&i.value.length===h.value.length,set:o=>{i.value=o?h.value.map(e=>e.id):[]}}),N=_(!1),U=M(()=>{var o;return(o=de.value)==null?void 0:o.tti_binding_model_name}),z=M(()=>!U.value||V.availableTtiModels.length===0?null:V.availableTtiModels.find(o=>o.id===U.value)),ee=M(()=>{var n;if(!((n=z.value)!=null&&n.binding_params))return[];const o=w.value?z.value.binding_params.edit_parameters||[]:z.value.binding_params.generation_parameters||[],e=["prompt","negative_prompt","image","mask","width","height","n","seed","size"];return o.filter(s=>!e.includes(s.name))});function pe(o){return typeof o=="string"?o.split(",").map(e=>e.trim()).filter(e=>e):Array.isArray(o)?o.filter(e=>e):[]}Ee(z,o=>{o&&ee.value.forEach(e=>{e.name in x.value||(x.value[e.name]=e.default)})},{immediate:!0,deep:!0}),Be(()=>{c.setPageTitle({title:"Image Studio",icon:Le(Re)}),p.fetchImages(),V.availableTtiModels.length===0&&V.fetchAvailableTtiModels(),Object.keys(S.discussions).length===0&&S.loadDiscussions(),window.addEventListener("paste",te)}),Fe(()=>{c.setPageTitle({title:""}),window.removeEventListener("paste",te)});function E(o){return i.value.includes(o)}function me(o){const e=i.value.indexOf(o);e>-1?i.value.splice(e,1):i.value.push(o)}async function fe(){if(!f.value.trim()||!U.value){c.addNotification("A prompt and model are required.","warning");return}const o={prompt:f.value,negative_prompt:y.value,model:U.value,seed:$.value,...x.value};if(w.value){const[e,n]=I.value.split("x").map(Number);await p.editImage({...o,image_ids:i.value,width:e,height:n})}else await p.generateImage({...o,size:I.value,n:A.value})}async function ge(o,e={}){var s;if(o!=="negative_prompt"&&!f.value.trim()){c.addNotification("Please enter a prompt to enhance.","warning");return}const n={prompt:f.value,negative_prompt:y.value,target:o,model:(s=Z.user)==null?void 0:s.lollms_model_name,instructions:e.instructions||"",mode:e.mode||"description"};if(w.value&&ce.value&&i.value.length>0){c.addNotification("Enhancing prompt with image context...","info");const r=[];for(const m of i.value)try{const G=await et.get(`/api/image-studio/${m}/file`,{responseType:"blob"}),De=await new Promise((Me,Te)=>{const B=new FileReader;B.onloadend=()=>Me(B.result.split(",")[1]),B.onerror=Te,B.readAsDataURL(G.data)});r.push(De)}catch(G){console.error(`Failed to fetch and encode image ${m}`,G),c.addNotification(`Could not load image ${m} for context.`,"warning")}r.length>0&&(n.image_b64s=r)}await p.enhanceImagePrompt(n)}function O(o){c.openModal("enhancePrompt",{instructions:J.value,mode:Q.value,onConfirm:({instructions:e,mode:n})=>{J.value=e,Q.value=n,ge(o,{instructions:e,mode:n})}})}function ve(){H.push("/image-studio/edit/new")}function be(o){f.value=o.prompt,y.value=o.negative_prompt,$.value=o.seed,c.addNotification("Prompt and parameters have been reused.","success")}function he(o){H.push(`/image-studio/edit/${o.id}`)}function xe(o,e){c.openImageViewer({imageList:h.value.map(n=>({...n,src:`/api/image-studio/${n.id}/file`})),startIndex:e})}async function we(o){const e=Array.from(o.target.files);e.length>0&&(c.addNotification(`Uploading ${e.length} image(s)...`,"info"),await p.uploadImages(e))}async function ye(){(await c.showConfirmation({title:`Delete ${i.value.length} Images?`,message:"This action cannot be undone.",confirmText:"Delete"})).confirmed&&(await Promise.all(i.value.map(e=>p.deleteImage(e))),i.value=[])}async function _e(){if(!w.value)return;const{confirmed:o,value:e}=await c.showConfirmation({title:`Move ${i.value.length} Images to Discussion`,message:"Select a discussion:",confirmText:"Move",inputType:"select",inputOptions:S.sortedDiscussions.map(n=>({text:n.title,value:n.id})),inputValue:S.currentDiscussionId});o&&e&&(await Promise.all(i.value.map(n=>p.moveImageToDiscussion(n,e))),i.value=[])}function ke(o){o.preventDefault(),N.value=!0}function Ce(o){o.currentTarget.contains(o.relatedTarget)||(N.value=!1)}async function Se(o){o.preventDefault(),N.value=!1;const e=Array.from(o.dataTransfer.files).filter(n=>n.type.startsWith("image/"));e.length>0&&(c.addNotification(`Uploading ${e.length} image(s)...`,"info"),await p.uploadImages(e))}async function te(o){const e=(o.clipboardData||window.clipboardData).items;if(!e)return;const n=[];for(const s of e)if(s.kind==="file"&&s.type.startsWith("image/")){const r=s.getAsFile();if(r){const m=(r.type.split("/")[1]||"png").toLowerCase().replace("jpeg","jpg");n.push(new File([r],`pasted_image_${Date.now()}_${Math.random().toString(36).substr(2,9)}.${m}`,{type:r.type}))}}n.length>0&&(o.preventDefault(),c.addNotification(`Pasting ${n.length} image(s)...`,"info"),await p.uploadImages(n))}function Ie(){c.openModal("cameraCapture")}async function $e(){await p.fetchImages(),c.addNotification("Image gallery refreshed.","success")}return(o,e)=>{const n=Ze("router-link");return a(),l(P,null,[(a(),se(Oe,{to:"#global-header-actions-target"},[t("div",ct,[t("button",{onClick:fe,class:"btn btn-primary",disabled:d(K)||D.value},[d(K)||D.value?(a(),se(q,{key:0,class:"w-5 h-5 mr-2 animate-spin"})):g("",!0),k(" "+v(w.value?"Apply":"Generate"),1)],8,pt)])])),t("div",{class:"h-full flex flex-col bg-gray-50 dark:bg-gray-900",onDragover:C(ke,["prevent"]),onDragleave:C(Ce,["prevent"]),onDrop:C(Se,["prevent"])},[N.value?(a(),l("div",mt,e[10]||(e[10]=[t("p",{class:"text-2xl font-bold text-blue-600"},"Drop images anywhere to upload",-1)]))):g("",!0),t("div",ft,[t("div",gt,[t("div",vt,[t("div",null,[t("div",bt,[e[11]||(e[11]=t("label",{for:"prompt",class:"block text-sm font-medium"},"Prompt",-1)),t("button",{onClick:e[0]||(e[0]=s=>O("prompt")),class:"btn-icon",title:"Enhance prompt with AI",disabled:D.value},[u(W,{class:"w-4 h-4"})],8,ht)]),t("div",xt,[b(t("textarea",{id:"prompt","onUpdate:modelValue":e[1]||(e[1]=s=>T(f)?f.value=s:null),rows:"4",class:"input-field",placeholder:"A photorealistic image of..."},null,512),[[R,d(f)]])])]),t("div",null,[t("div",wt,[e[12]||(e[12]=t("label",{for:"negative-prompt",class:"block text-sm font-medium"},"Negative Prompt",-1)),t("button",{onClick:e[2]||(e[2]=s=>O("negative_prompt")),class:"btn-icon",title:"Enhance negative prompt with AI",disabled:D.value},[u(W,{class:"w-4 h-4"})],8,yt)]),t("div",_t,[b(t("textarea",{id:"negative-prompt","onUpdate:modelValue":e[3]||(e[3]=s=>T(y)?y.value=s:null),rows:"3",class:"input-field",placeholder:"ugly, blurry, bad anatomy..."},null,512),[[R,d(y)]])])]),t("div",kt,[t("button",{onClick:e[4]||(e[4]=s=>O("both")),class:"btn btn-secondary w-full",disabled:D.value},[u(W,{class:"w-4 h-4 mr-2"}),e[13]||(e[13]=k(" Enhance Both Prompts "))],8,Ct)]),t("div",St,[t("div",It,[e[14]||(e[14]=t("h3",{class:"text-sm font-semibold"},"Generation Settings",-1)),t("button",{onClick:e[5]||(e[5]=s=>j.value=!j.value),class:"btn-icon-flat",title:j.value?"Hide Settings":"Show Settings"},[u(Ge,{class:"w-5 h-5"})],8,$t)]),j.value?(a(),l("div",Dt,[w.value?g("",!0):(a(),l("div",Mt,[e[15]||(e[15]=t("label",{for:"n",class:"block text-sm font-medium"},"Number",-1)),b(t("input",{id:"n","onUpdate:modelValue":e[6]||(e[6]=s=>T(A)?A.value=s:null),type:"number",min:"1",max:"10",class:"input-field mt-1"},null,512),[[R,d(A),void 0,{number:!0}]])])),t("div",null,[e[17]||(e[17]=t("label",{for:"size",class:"block text-sm font-medium"},"Size",-1)),b(t("select",{id:"size","onUpdate:modelValue":e[7]||(e[7]=s=>T(I)?I.value=s:null),class:"input-field mt-1"},e[16]||(e[16]=[qe('<option value="1024x1024">1024x1024 (Square 1:1)</option><option value="1152x896">1152x896 (Landscape ~4:3)</option><option value="896x1152">896x1152 (Portrait ~3:4)</option><option value="1216x832">1216x832 (Landscape ~3:2)</option><option value="832x1216">832x1216 (Portrait ~2:3)</option><option value="1344x768">1344x768 (Widescreen 16:9)</option><option value="768x1344">768x1344 (Tall 9:16)</option><option value="1536x640">1536x640 (Cinematic ~2.4:1)</option><option value="640x1536">640x1536 (Tall Cinematic ~1:2.4)</option><option value="512x512">512x512 (Small Square)</option>',10)]),512),[[oe,d(I)]])]),t("div",null,[e[18]||(e[18]=t("label",{for:"seed",class:"block text-sm font-medium"},"Seed",-1)),b(t("input",{id:"seed","onUpdate:modelValue":e[8]||(e[8]=s=>T($)?$.value=s:null),type:"number",class:"input-field mt-1",placeholder:"-1 for random"},null,512),[[R,d($),void 0,{number:!0}]])]),(a(!0),l(P,null,F(ee.value,s=>(a(),l("div",{key:s.name},[t("label",{for:`param-${s.name}`,class:"block text-sm font-medium capitalize"},v(s.name.replace(/_/g," ")),9,Tt),s.options&&s.options.length>0?b((a(),l("select",{key:0,id:`param-${s.name}`,"onUpdate:modelValue":r=>d(x)[s.name]=r,class:"input-field mt-1"},[(a(!0),l(P,null,F(pe(s.options),r=>(a(),l("option",{key:r,value:r},v(r),9,Vt))),128))],8,Pt)),[[oe,d(x)[s.name]]]):b((a(),l("input",{key:1,type:s.type==="str"?"text":"number",step:s.type==="float"?"0.1":"1",id:`param-${s.name}`,"onUpdate:modelValue":r=>d(x)[s.name]=r,class:"input-field mt-1",placeholder:s.default},null,8,At)),[[tt,d(x)[s.name]]])]))),128))])):g("",!0)])]),t("div",jt,[u(n,{to:"/",class:"w-full flex items-center gap-3 px-3 py-2.5 text-sm font-medium text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",title:"Back to Main App"},{default:We(()=>[u(st,{class:"w-5 h-5"}),e[19]||(e[19]=t("span",null,"Back to App",-1))]),_:1})])]),t("div",Nt,[t("div",Ut,[t("div",zt,[t("div",Et,[b(t("input",{type:"checkbox","onUpdate:modelValue":e[9]||(e[9]=s=>X.value=s),class:"h-4 w-4 rounded",title:"Select All"},null,512),[[He,X.value]]),t("h3",Bt,"Your Images ("+v(d(h).length)+")",1)]),w.value?(a(),l("div",Lt,[t("span",Rt,v(i.value.length)+" selected",1),t("button",{onClick:_e,class:"btn btn-secondary btn-sm",title:"Move to Discussion"},[u(Ke,{class:"w-4 h-4"})]),t("button",{onClick:ye,class:"btn btn-danger btn-sm",title:"Delete Selected"},[u(Ye,{class:"w-4 h-4"})])])):g("",!0),t("div",Ft,[t("button",{onClick:$e,class:"btn btn-secondary btn-sm"},[u(ne,{class:"w-4 h-4 mr-2"}),e[20]||(e[20]=k(" Refresh "))]),t("button",{onClick:Ie,class:"btn btn-secondary btn-sm"},[u(ut,{class:"w-4 h-4 mr-2"}),e[21]||(e[21]=k(" Take Photo "))]),t("button",{onClick:ve,class:"btn btn-secondary btn-sm"},[u(Je,{class:"w-4 h-4 mr-2"}),e[22]||(e[22]=k(" Create Blank Image "))]),t("label",Ot,[u(Qe,{class:"w-4 h-4 mr-2"}),e[23]||(e[23]=k(" Upload ")),t("input",{id:"upload-image-btn",type:"file",onChange:we,class:"hidden",accept:"image/*",multiple:""},null,32)])])]),d(Y)>0?(a(),l("div",Gt,[t("div",qt,[(a(!0),l(P,null,F(d(ue),s=>(a(),l("div",{key:s.id,class:"relative aspect-square rounded-lg bg-gray-200 dark:bg-gray-700/50 flex flex-col items-center justify-center p-2 text-center overflow-hidden"},[e[24]||(e[24]=t("div",{class:"absolute inset-0 bg-blue-500/10 animate-pulse"},null,-1)),u(q,{class:"w-8 h-8 text-blue-500 mb-2 animate-spin"}),t("p",{class:"text-xs font-medium text-gray-600 dark:text-gray-300 truncate w-full",title:s.name},v(s.name),9,Wt),t("div",Zt,[t("div",{class:"bg-blue-500 h-1 rounded-full",style:ot({width:s.progress+"%"})},null,4)])]))),128))])])):g("",!0),d(re)?(a(),l("div",Ht,[u(q,{class:"w-8 h-8 text-gray-500 animate-spin"})])):d(h).length===0&&d(Y)===0?(a(),l("div",Kt,e[25]||(e[25]=[t("div",null,[t("p",null,"No images yet."),t("p",{class:"text-sm"},"Drop, paste, or use the form to generate some!")],-1)]))):(a(),l("div",Yt,[t("div",Jt,[(a(!0),l(P,null,F(d(h),(s,r)=>(a(),l("div",{key:s.id,onClick:m=>me(s.id),class:ae(["relative aspect-square rounded-lg overflow-hidden group cursor-pointer border-4",E(s.id)?"border-red-500":"border-transparent"])},[u(nt,{src:`/api/image-studio/${s.id}/file`,class:"w-full h-full object-cover transition-transform group-hover:scale-105"},null,8,["src"]),t("div",Xt,[t("div",es,[t("div",{class:ae(["w-5 h-5 rounded-full border-2 flex items-center justify-center",E(s.id)?"bg-red-500 border-white":"bg-black/30 border-white/50"])},[E(s.id)?(a(),l("svg",ts,e[26]||(e[26]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"3",d:"M5 13l4 4L19 7"},null,-1)]))):g("",!0)],2)]),t("p",{class:"text-xs line-clamp-3",title:s.prompt},v(s.prompt),9,ss)]),E(s.id)?(a(),l("div",os,v(i.value.indexOf(s.id)+1),1)):g("",!0),t("div",ns,[t("button",{onClick:C(m=>be(s),["stop"]),class:"p-1.5 bg-black/50 rounded-full hover:bg-black/80",title:"Reuse Prompt & Settings"},[u(ne,{class:"w-4 h-4 text-white"})],8,as),t("button",{onClick:C(m=>xe(s,r),["stop"]),class:"p-1.5 bg-black/50 rounded-full hover:bg-black/80",title:"View Full Size"},[u(at,{class:"w-4 h-4 text-white"})],8,ls),t("button",{onClick:C(m=>he(s),["stop"]),class:"p-1.5 bg-black/50 rounded-full hover:bg-black/80",title:"Inpaint/Edit"},[u(lt,{class:"w-4 h-4 text-white"})],8,is)])],10,Qt))),128))])]))])])])],32)],64)}}};export{ds as default};
