import{_ as S,z as L,u as A,c as a,b as n,d as t,j as x,F as h,l as w,t as f,A as T,n as k,w as _,e as g,v as b,m as U,x as C,i as N,f as D,B as V,a as m,C as p}from"./index-BrFYYvK5.js";function M(i){if(!i)return"Never";const e=new Date,d=new Date(i),u=Math.floor((e-d)/1e3);if(u<2)return"Just now";if(u<60)return`${u}s ago`;const s=Math.floor(u/60);if(s<60)return`${s}m ago`;const o=Math.floor(s/60);if(o<24)return`${o}h ago`;const l=Math.floor(o/24);return l<7?`${l}d ago`:d.toLocaleDateString()}const P={name:"UserTable",props:{users:{type:Array,required:!0},isLoading:{type:Boolean,default:!1},activeSessions:{type:Array,default:()=>[]}},emits:["delete-user","reset-password","activate-user"],computed:{...L(A,{currentUser:i=>i.user})},methods:{formatTimeAgo:M}},z={class:"overflow-x-auto"},F={class:"min-w-full divide-y dark:divide-gray-600"},R={class:"bg-white dark:bg-gray-800 divide-y dark:divide-gray-700"},E={key:0},q={key:1},B={class:"px-4 py-2 text-xs font-mono text-gray-500 dark:text-gray-400"},O={class:"px-4 py-2 text-sm font-medium text-gray-900 dark:text-gray-100"},j={class:"px-4 py-2 text-sm"},I={key:0,class:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800 dark:bg-green-900/50 dark:text-green-300"},G={key:1,class:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-yellow-100 text-yellow-800 dark:bg-yellow-900/50 dark:text-yellow-300"},K={class:"px-4 py-2 text-sm text-gray-500 dark:text-gray-400"},J={class:"flex items-center space-x-2"},Y={key:0,class:"h-2 w-2 rounded-full bg-green-500 animate-pulse",title:"Online now"},H=["title"],Q={class:"px-4 py-2 text-sm"},W={key:0,class:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800 dark:bg-blue-900/50 dark:text-blue-300"},X={key:1,class:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-gray-100 text-gray-800 dark:bg-gray-600 dark:text-gray-200"},Z=["title"],$={class:"px-4 py-2 text-sm space-x-2 whitespace-nowrap"},ee=["onClick"],te=["onClick","disabled"],se=["onClick","disabled"];function ie(i,e,d,u,s,o){return n(),a("div",z,[t("table",F,[e[2]||(e[2]=t("thead",{class:"bg-gray-50 dark:bg-gray-700"},[t("tr",null,[t("th",{scope:"col",class:"px-4 py-3 text-left text-xs font-medium uppercase tracking-wider"},"ID"),t("th",{scope:"col",class:"px-4 py-3 text-left text-xs font-medium uppercase tracking-wider"},"Username"),t("th",{scope:"col",class:"px-4 py-3 text-left text-xs font-medium uppercase tracking-wider"},"Status"),t("th",{scope:"col",class:"px-4 py-3 text-left text-xs font-medium uppercase tracking-wider"},"Last Seen"),t("th",{scope:"col",class:"px-4 py-3 text-left text-xs font-medium uppercase tracking-wider"},"Admin"),t("th",{scope:"col",class:"px-4 py-3 text-left text-xs font-medium uppercase tracking-wider"},"LLM Model"),t("th",{scope:"col",class:"px-4 py-3 text-left text-xs font-medium uppercase tracking-wider"},"Actions")])],-1)),t("tbody",R,[d.isLoading?(n(),a("tr",E,e[0]||(e[0]=[t("td",{colspan:"7",class:"px-4 py-4 text-center text-sm italic text-gray-500"},"Loading users...",-1)]))):!d.users||d.users.length===0?(n(),a("tr",q,e[1]||(e[1]=[t("td",{colspan:"7",class:"px-4 py-4 text-center text-sm italic text-gray-500"},"No users found.",-1)]))):x("",!0),(n(!0),a(h,null,w(d.users,l=>(n(),a("tr",{key:l.id,class:"hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors duration-150"},[t("td",B,f(l.id),1),t("td",O,f(l.username),1),t("td",j,[l.is_active?(n(),a("span",I,"Active")):(n(),a("span",G,"Inactive"))]),t("td",K,[t("div",J,[d.activeSessions.includes(l.username)?(n(),a("span",Y)):x("",!0),t("span",{title:l.last_activity_at?new Date(l.last_activity_at).toLocaleString():"Never"},f(o.formatTimeAgo(l.last_activity_at)),9,H)])]),t("td",Q,[l.is_admin?(n(),a("span",W,"Yes")):(n(),a("span",X,"No"))]),t("td",{class:"px-4 py-2 text-xs truncate text-gray-500 dark:text-gray-400",title:l.lollms_model_name},f(l.lollms_model_name||"-"),9,Z),t("td",$,[l.is_active?x("",!0):(n(),a("button",{key:0,onClick:r=>i.$emit("activate-user",l.id),class:"btn btn-success !py-1 !px-2 text-xs",title:"Activate User"},"Activate",8,ee)),t("button",{onClick:r=>i.$emit("reset-password",l.id),disabled:l.id===i.currentUser.id,class:"btn btn-secondary !py-1 !px-2 text-xs",title:"Reset Password"},"Reset Pass",8,te),t("button",{onClick:r=>i.$emit("delete-user",l.id),disabled:l.id===i.currentUser.id,class:"btn btn-danger !py-1 !px-2 text-xs",title:"Delete User"},"Delete",8,se)])]))),128))])])])}const re=S(P,[["render",ie]]),ae={name:"AdminPanel",components:{UserTable:re},data(){return{users:[],activeSessions:[],isLoadingUsers:!1,newUser:{username:"",password:"",email:"",lollms_model_name:"",safe_store_vectorizer:"",is_admin:!1},settings:{},originalSettings:{},isLoadingSettings:!1,activeTab:"users"}},computed:{isSettingsChanged(){var i;for(const e in this.settings)if(this.settings[e]!==((i=this.originalSettings[e])==null?void 0:i.value))return!0;return!1},categorizedSettings(){const i={},e=Object.keys(this.originalSettings).sort();for(const d of e){const u=this.originalSettings[d];i[u.category]||(i[u.category]=[]),i[u.category].push(u)}return i}},created(){this.fetchDataForActiveTab()},methods:{async setActiveTab(i){this.activeTab!==i&&(this.activeTab=i,await this.fetchDataForActiveTab())},async fetchDataForActiveTab(){this.activeTab==="users"?await this.fetchUsers():this.activeTab==="settings"&&await this.fetchSettings()},async fetchUsers(){this.isLoadingUsers=!0;try{const[i,e]=await Promise.all([p.get("/api/admin/users"),p.get("/api/admin/active-sessions")]);this.users=i.data,this.activeSessions=e.data}catch{m().addNotification("Failed to load user data.","error")}finally{this.isLoadingUsers=!1}},async fetchSettings(){this.isLoadingSettings=!0;try{const e=(await p.get("/api/admin/settings")).data,d={},u={};e.forEach(s=>{d[s.key]=s.value,u[s.key]={...s}}),this.settings=d,this.originalSettings=u}catch{m().addNotification("Failed to load global settings.","error")}finally{this.isLoadingSettings=!1}},resetSettings(){const i={};for(const e in this.originalSettings)i[e]=this.originalSettings[e].value;this.settings=i,m().addNotification("Changes have been discarded.","info")},async saveSettings(){const i=m();if(!this.isSettingsChanged){i.addNotification("No changes to save.","info");return}this.isLoadingSettings=!0;try{await p.put("/api/admin/settings",{configs:this.settings}),i.addNotification("Global settings updated successfully. Changes will take full effect on user re-login or server restart.","success",6e3),await this.fetchSettings()}catch{}finally{this.isLoadingSettings=!1}},async addUser(){const i=m();if(!this.newUser.username||!this.newUser.password||!this.newUser.email){i.addNotification("Username, email, and password are required.","warning");return}this.isLoadingUsers=!0;try{await p.post("/api/admin/users",this.newUser),i.addNotification(`User '${this.newUser.username}' created successfully.`,"success"),this.resetNewUserForm(),await this.fetchUsers()}catch{}finally{this.isLoadingUsers=!1}},async deleteUser(i){const e=m();if(confirm("Are you sure you want to delete this user? This will also remove all their data and cannot be undone.")){this.isLoadingUsers=!0;try{await p.delete(`/api/admin/users/${i}`),e.addNotification("User deleted successfully.","success"),await this.fetchUsers()}catch{}finally{this.isLoadingUsers=!1}}},async resetPassword(i){const e=m(),d=prompt("Enter a new password for the user (min 8 characters):");if(!d||d.length<8){e.addNotification("Password reset cancelled or password too short.","warning");return}try{await p.post(`/api/admin/users/${i}/reset-password`,{new_password:d}),e.addNotification("User's password has been reset.","success")}catch{}},async activateUser(i){this.isLoadingUsers=!0;const e=m();try{await p.post(`/api/admin/users/${i}/activate`),e.addNotification("User has been activated successfully.","success"),await this.fetchUsers()}catch{}finally{this.isLoadingUsers=!1}},resetNewUserForm(){this.newUser={username:"",password:"",email:"",lollms_model_name:"",safe_store_vectorizer:"",is_admin:!1}}}},ne={class:"border-b border-gray-200 dark:border-gray-700 mb-6"},oe={class:"-mb-px flex space-x-6","aria-label":"Tabs"},le={key:0},de={class:"bg-gray-100 dark:bg-gray-700/50 p-4 rounded-lg shadow-sm mb-6"},ce={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"},ue={class:"flex items-center"},ge={class:"text-right"},me=["disabled"],pe={class:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm"},fe={class:"flex justify-between items-center mb-3 border-b dark:border-gray-600 pb-2"},ye=["disabled"],be={key:0},xe={key:1},he={key:1},we={class:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm"},ve={class:"flex justify-between items-center mb-4 border-b dark:border-gray-600 pb-3"},ke={class:"space-x-2"},_e=["disabled"],Ue=["disabled"],Se={key:0},Le={key:1},Ae={key:0,class:"text-center p-8 text-gray-500"},Te={class:"text-lg font-medium text-gray-900 dark:text-gray-100 mb-4"},Ce={class:"space-y-6 bg-gray-50 dark:bg-gray-700/50 p-4 rounded-md"},Ne=["for"],De={class:"mt-2"},Ve=["for"],Me=["onUpdate:modelValue","id"],Pe={class:"ml-3 text-sm font-medium text-gray-900 dark:text-gray-200"},ze=["onUpdate:modelValue","id"],Fe=["type","step","onUpdate:modelValue","id"],Re={class:"text-xs text-gray-500 dark:text-gray-400 mt-2"},Ee={class:"bg-gray-200 dark:bg-gray-600 px-1 rounded"};function qe(i,e,d,u,s,o){const l=T("UserTable");return n(),a("div",null,[e[25]||(e[25]=t("h4",{class:"text-lg font-semibold mb-4"},"Administration",-1)),t("div",ne,[t("nav",oe,[t("button",{onClick:e[0]||(e[0]=r=>o.setActiveTab("users")),class:k([[s.activeTab==="users"?"border-blue-500 text-blue-600 dark:border-blue-400 dark:text-blue-300":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-200 dark:hover:border-gray-500"],"whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm transition-colors duration-200"])}," User Management ",2),t("button",{onClick:e[1]||(e[1]=r=>o.setActiveTab("settings")),class:k([[s.activeTab==="settings"?"border-blue-500 text-blue-600 dark:border-blue-400 dark:text-blue-300":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-200 dark:hover:border-gray-500"],"whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm transition-colors duration-200"])}," Global Settings ",2)])]),s.activeTab==="users"?(n(),a("div",le,[t("section",de,[e[19]||(e[19]=t("h2",{class:"text-md font-semibold mb-3 border-b dark:border-gray-600 pb-2"},"Add New User",-1)),t("form",{onSubmit:e[8]||(e[8]=_((...r)=>o.addUser&&o.addUser(...r),["prevent"])),class:"space-y-4"},[t("div",ce,[t("div",null,[e[13]||(e[13]=t("label",{for:"newUsername",class:"block text-sm font-medium"},"Username",-1)),g(t("input",{type:"text","onUpdate:modelValue":e[2]||(e[2]=r=>s.newUser.username=r),id:"newUsername",required:"",minlength:"3",class:"input-field mt-1"},null,512),[[b,s.newUser.username]])]),t("div",null,[e[14]||(e[14]=t("label",{for:"newEmail",class:"block text-sm font-medium"},"Email",-1)),g(t("input",{type:"email","onUpdate:modelValue":e[3]||(e[3]=r=>s.newUser.email=r),id:"newEmail",required:"",class:"input-field mt-1"},null,512),[[b,s.newUser.email]])]),t("div",null,[e[15]||(e[15]=t("label",{for:"newPassword",class:"block text-sm font-medium"},"Password (min 8 chars)",-1)),g(t("input",{type:"password","onUpdate:modelValue":e[4]||(e[4]=r=>s.newUser.password=r),id:"newPassword",required:"",minlength:"8",class:"input-field mt-1"},null,512),[[b,s.newUser.password]])]),t("div",null,[e[16]||(e[16]=t("label",{for:"newLollmsModel",class:"block text-sm font-medium"},"Default LoLLMs Model (Optional)",-1)),g(t("input",{type:"text","onUpdate:modelValue":e[5]||(e[5]=r=>s.newUser.lollms_model_name=r),id:"newLollmsModel",class:"input-field mt-1",placeholder:"Uses global default if empty"},null,512),[[b,s.newUser.lollms_model_name]])]),t("div",null,[e[17]||(e[17]=t("label",{for:"newSafeStoreVectorizer",class:"block text-sm font-medium"},"Default Vectorizer (Optional)",-1)),g(t("input",{type:"text","onUpdate:modelValue":e[6]||(e[6]=r=>s.newUser.safe_store_vectorizer=r),id:"newSafeStoreVectorizer",class:"input-field mt-1",placeholder:"Uses global default if empty"},null,512),[[b,s.newUser.safe_store_vectorizer]])])]),t("div",ue,[g(t("input",{type:"checkbox","onUpdate:modelValue":e[7]||(e[7]=r=>s.newUser.is_admin=r),id:"newUserIsAdmin",class:"h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500"},null,512),[[U,s.newUser.is_admin]]),e[18]||(e[18]=t("label",{for:"newUserIsAdmin",class:"ml-2 block text-sm"},"Grant Administrator Privileges",-1))]),t("div",ge,[t("button",{type:"submit",class:"btn btn-primary",disabled:s.isLoadingUsers},"Add User",8,me)])],32)]),t("section",pe,[t("div",fe,[e[20]||(e[20]=t("h2",{class:"text-md font-semibold"},"Manage Existing Users",-1)),t("button",{onClick:e[9]||(e[9]=(...r)=>o.fetchUsers&&o.fetchUsers(...r)),class:"btn btn-secondary !py-1 !px-2 text-xs",disabled:s.isLoadingUsers},[s.isLoadingUsers?(n(),a("span",be,"Refreshing...")):(n(),a("span",xe,"Refresh List"))],8,ye)]),C(l,{users:s.users,"active-sessions":s.activeSessions,isLoading:s.isLoadingUsers,onDeleteUser:o.deleteUser,onResetPassword:o.resetPassword,onActivateUser:o.activateUser},null,8,["users","active-sessions","isLoading","onDeleteUser","onResetPassword","onActivateUser"])])])):x("",!0),s.activeTab==="settings"?(n(),a("div",he,[t("section",we,[t("div",ve,[e[21]||(e[21]=t("h2",{class:"text-md font-semibold"},"Application Settings",-1)),t("div",ke,[t("button",{onClick:e[10]||(e[10]=(...r)=>o.resetSettings&&o.resetSettings(...r)),class:"btn btn-secondary",disabled:!o.isSettingsChanged||s.isLoadingSettings},"Reset",8,_e),t("button",{onClick:e[11]||(e[11]=(...r)=>o.saveSettings&&o.saveSettings(...r)),class:"btn btn-primary",disabled:!o.isSettingsChanged||s.isLoadingSettings},[s.isLoadingSettings?(n(),a("span",Se,"Saving...")):(n(),a("span",Le,"Save Changes"))],8,Ue)])]),s.isLoadingSettings?(n(),a("div",Ae," Loading settings... ")):(n(),a("form",{key:1,onSubmit:e[12]||(e[12]=_((...r)=>o.saveSettings&&o.saveSettings(...r),["prevent"])),class:"space-y-8"},[(n(!0),a(h,null,w(o.categorizedSettings,(r,v)=>(n(),a("div",{key:v},[t("h3",Te,f(v),1),t("div",Ce,[(n(!0),a(h,null,w(r,c=>(n(),a("div",{key:c.key},[t("label",{for:`setting-${c.key}`,class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},f(c.description),9,Ne),t("div",De,[c.type==="boolean"?(n(),a("label",{key:0,for:`setting-${c.key}`,class:"relative inline-flex items-center cursor-pointer"},[g(t("input",{type:"checkbox","onUpdate:modelValue":y=>s.settings[c.key]=y,class:"sr-only peer",id:`setting-${c.key}`},null,8,Me),[[U,s.settings[c.key]]]),e[22]||(e[22]=t("div",{class:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-600 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-500 peer-checked:bg-blue-600"},null,-1)),t("span",Pe,f(s.settings[c.key]?"Enabled":"Disabled"),1)],8,Ve)):c.key==="registration_mode"?g((n(),a("select",{key:1,"onUpdate:modelValue":y=>s.settings[c.key]=y,id:`setting-${c.key}`,class:"input-field max-w-sm"},e[23]||(e[23]=[t("option",{value:"direct"},"Direct (instantly active)",-1),t("option",{value:"admin_approval"},"Admin Approval",-1)]),8,ze)),[[N,s.settings[c.key]]]):g((n(),a("input",{key:2,type:c.type==="string"?"text":"number",step:c.type==="float"?"0.1":"1","onUpdate:modelValue":y=>s.settings[c.key]=y,id:`setting-${c.key}`,class:"input-field max-w-sm"},null,8,Fe)),[[D,s.settings[c.key],void 0,{number:!0}]])]),t("p",Re,[e[24]||(e[24]=V("Key: ")),t("code",Ee,f(c.key),1)])]))),128))])]))),128))],32))])])):x("",!0)])}const Oe=S(ae,[["render",qe]]);export{Oe as default};
