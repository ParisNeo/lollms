import{W as J,G as P,s as H,r as p,k as C,w as K,o as Q,c as o,b as i,d as c,g as t,t as d,h as _,J as b,j as R,v as M,F as g,i as x,e as S,O as W,y as L,P as Z,Q as X,n as h,f as Y,z as ee,Z as te}from"./index-BbeTE7bb.js";const ne={class:"space-y-8"},se={key:0,class:"bg-white dark:bg-gray-800 shadow-md rounded-lg p-6"},ae={class:"text-xl font-semibold mb-4"},le={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},ie=["disabled"],oe=["value"],de={key:0,class:"space-y-6 border-t dark:border-gray-700 pt-6"},re={class:"text-sm text-gray-600 dark:text-gray-400"},ue=["for"],ce={key:0,class:"text-red-500"},me=["id","onUpdate:modelValue"],fe=["value"],ge={key:1},ve={class:"relative"},ye=["type","id","onUpdate:modelValue","required","placeholder"],pe=["onClick","title"],_e={key:2,class:"flex items-center justify-between bg-gray-50 dark:bg-gray-700/50 p-3 rounded-md"},be={class:"flex-grow flex flex-col pr-4"},xe={class:"text-sm text-gray-500 dark:text-gray-400"},he=["onClick"],ke={class:"text-xs text-gray-500 mt-1"},we={class:"flex items-center justify-between bg-gray-50 dark:bg-gray-700/50 p-3 rounded-md"},Be={class:"flex justify-end gap-3"},Ce=["disabled"],Se={class:"flex justify-between items-center mb-4 flex-wrap gap-4"},Ae={class:"flex items-center gap-4"},Me={key:0,class:"text-center p-6"},Te={key:1,class:"text-center p-6 bg-gray-50 dark:bg-gray-800/50 rounded-lg"},De={key:2,class:"space-y-4"},Ve={class:"flex items-start gap-4"},$e=["title"],Fe={class:"flex-grow"},Ne={class:"flex justify-between items-center"},Le={class:"font-bold text-lg text-gray-900 dark:text-white"},Oe={class:"flex gap-3"},je=["onClick"],Ue=["onClick"],qe={class:"text-sm text-gray-500 dark:text-gray-400"},Ee={class:"mt-2 text-xs space-y-1 text-gray-600 dark:text-gray-300"},ze={key:0},Ge={class:"font-semibold capitalize"},Ie={key:0},Je={key:1},Pe={key:0},He={class:"border-t dark:border-gray-700 pt-3 flex justify-end"},Ke=["onClick"],We={__name:"LLMBindingsSettings",setup(Qe){const u=J(),A=P(),{bindings:T,availableBindingTypes:k,isLoadingBindings:O,globalSettings:D}=H(u),f=p(!1),v=p(null),w=p(!1),m=p({}),V=()=>({id:null,alias:"",name:"",config:{},default_model_name:"",is_active:!0}),s=p(V()),y=C(()=>v.value!==null),B=C(()=>s.value.name?k.value.find(a=>a.binding_name===s.value.name):null),j=C(()=>{if(!B.value)return[];const a=B.value.input_parameters||[],n=new Set(a.map(l=>l.name)),e=Object.keys(s.value.config||{}).filter(l=>!n.has(l)&&l!=="model_name").map(l=>({name:l,type:typeof s.value.config[l]=="boolean"?"bool":typeof s.value.config[l]=="number"?"float":"str",description:"(Parameter not in binding description)",mandatory:!1}));return[...a.filter(l=>l.name!=="model_name"),...e]});K(()=>s.value.name,(a,n)=>{if(a!==n&&!y.value){const e=k.value.find(r=>r.binding_name===a),l={};e&&e.input_parameters&&e.input_parameters.forEach(r=>{l[r.name]=r.default}),s.value.config=l}});const $=C({get(){if(!Array.isArray(D.value))return"mixed";const a=D.value.find(n=>n.key==="model_display_mode");return a?a.value:"mixed"},set(a){u.updateGlobalSettings({model_display_mode:a})}});Q(()=>{u.fetchBindings(),u.fetchAvailableBindingTypes(),u.fetchGlobalSettings()});function F(){v.value=null,s.value=V(),m.value={},f.value=!0,window.scrollTo({top:0,behavior:"smooth"})}function U(a){v.value=a,s.value=JSON.parse(JSON.stringify(a)),s.value.config||(s.value.config={}),m.value={},f.value=!0,window.scrollTo({top:0,behavior:"smooth"})}function N(){f.value=!1,v.value=null}function q(a){return typeof a=="string"?a.split(",").map(n=>n.trim()).filter(n=>n):Array.isArray(a)?a.filter(n=>n):[]}async function E(){if(!s.value.alias.trim()||!s.value.name){A.addNotification("Alias and Binding Type are required fields.","warning");return}w.value=!0;try{const a={alias:s.value.alias,name:s.value.name,config:s.value.config||{},is_active:s.value.is_active,default_model_name:s.value.default_model_name||null};y.value?await u.updateBinding(v.value.id,a):await u.addBinding(a),N()}catch(a){console.error("Submit failed:",a.message)}finally{w.value=!1}}async function z(a){await A.showConfirmation({title:`Delete Binding '${a.alias}'?`,message:"Are you sure? This action cannot be undone.",confirmText:"Delete"})&&await u.deleteBinding(a.id)}function G(a){A.openModal("manageModels",{binding:a,bindingType:"llm"})}function I(a){const n=k.value.find(e=>e.binding_name===a);return n?n.title:a}return(a,n)=>(i(),o("div",ne,[f.value?(i(),o("div",se,[t("h3",ae,d(y.value?"Edit Binding":"Add New Binding"),1),t("form",{onSubmit:Y(E,["prevent"]),class:"space-y-6"},[t("div",le,[t("div",null,[n[4]||(n[4]=t("label",{for:"alias",class:"block text-sm font-medium"},[b("Alias "),t("span",{class:"text-red-500"},"*")],-1)),_(t("input",{type:"text",id:"alias","onUpdate:modelValue":n[0]||(n[0]=e=>s.value.alias=e),class:"input-field mt-1",required:"",placeholder:"e.g., local_ollama",autocomplete:"off"},null,512),[[R,s.value.alias]]),n[5]||(n[5]=t("p",{class:"text-xs text-gray-500 mt-1"},"A unique, short name for this configuration.",-1))]),t("div",null,[n[7]||(n[7]=t("label",{for:"name",class:"block text-sm font-medium"},[b("Binding Type "),t("span",{class:"text-red-500"},"*")],-1)),_(t("select",{id:"name","onUpdate:modelValue":n[1]||(n[1]=e=>s.value.name=e),class:"input-field mt-1",required:"",disabled:y.value},[n[6]||(n[6]=t("option",{disabled:"",value:""},"Select a type",-1)),(i(!0),o(g,null,x(S(k),e=>(i(),o("option",{key:e.binding_name,value:e.binding_name},d(e.title),9,oe))),128))],8,ie),[[M,s.value.name]])])]),B.value?(i(),o("div",de,[t("p",re,d(B.value.description),1),(i(!0),o(g,null,x(j.value,e=>(i(),o("div",{key:e.name,class:"space-y-1"},[t("label",{for:`param-${e.name}`,class:"block text-sm font-medium capitalize"},[b(d(e.name.replace(/_/g," "))+" ",1),e.mandatory?(i(),o("span",ce,"*")):c("",!0)],8,ue),e.options&&e.options.length>0?_((i(),o("select",{key:0,id:`param-${e.name}`,"onUpdate:modelValue":l=>s.value.config[e.name]=l,class:"input-field"},[(i(!0),o(g,null,x(q(e.options),l=>(i(),o("option",{key:l,value:l},d(l),9,fe))),128))],8,me)),[[M,s.value.config[e.name]]]):["str","int","float"].includes(e.type)?(i(),o("div",ge,[t("div",ve,[_(t("input",{type:(e.name.includes("key")||e.name.includes("token"))&&!m.value[e.name]?"password":"text",id:`param-${e.name}`,"onUpdate:modelValue":l=>s.value.config[e.name]=l,class:"input-field",required:e.mandatory,placeholder:e.description,autocomplete:"off"},null,8,ye),[[W,s.value.config[e.name]]]),e.name.includes("key")||e.name.includes("token")?(i(),o("button",{key:0,type:"button",onClick:l=>m.value[e.name]=!m.value[e.name],class:"absolute inset-y-0 right-0 px-3 flex items-center text-gray-500 hover:text-gray-700 dark:hover:text-gray-300",title:m.value[e.name]?"Hide":"Show"},[m.value[e.name]?(i(),L(Z,{key:0,class:"w-5 h-5"})):(i(),L(X,{key:1,class:"w-5 h-5"}))],8,pe)):c("",!0)])])):e.type==="bool"?(i(),o("div",_e,[t("span",be,[t("span",xe,d(e.description),1)]),t("button",{onClick:l=>s.value.config[e.name]=!s.value.config[e.name],type:"button",class:h([s.value.config[e.name]?"bg-blue-600":"bg-gray-200 dark:bg-gray-600","relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out"])},[t("span",{class:h([s.value.config[e.name]?"translate-x-5":"translate-x-0","pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition-colors duration-200 ease-in-out"])},null,2)],10,he)])):c("",!0),t("p",ke,d(e.description),1)]))),128))])):c("",!0),t("div",we,[n[8]||(n[8]=t("span",{class:"flex-grow flex flex-col"},[t("span",{class:"text-sm font-medium text-gray-900 dark:text-gray-100"},"Active"),t("span",{class:"text-sm text-gray-500 dark:text-gray-400"},"If disabled, users cannot see or use models from this binding.")],-1)),t("button",{onClick:n[2]||(n[2]=e=>s.value.is_active=!s.value.is_active),type:"button",class:h([s.value.is_active?"bg-blue-600":"bg-gray-200 dark:bg-gray-600","relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out"])},[t("span",{class:h([s.value.is_active?"translate-x-5":"translate-x-0","pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition-colors duration-200 ease-in-out"])},null,2)],2)]),t("div",Be,[t("button",{type:"button",onClick:N,class:"btn btn-secondary"},"Cancel"),t("button",{type:"submit",class:"btn btn-primary",disabled:w.value},d(w.value?"Saving...":y.value?"Save Changes":"Add Binding"),9,Ce)])],32)])):c("",!0),t("div",null,[t("div",Se,[n[11]||(n[11]=t("h2",{class:"text-2xl font-bold"},"LLM Bindings",-1)),t("div",Ae,[t("div",null,[n[10]||(n[10]=t("label",{for:"model-display-mode",class:"block text-xs font-medium text-gray-500 dark:text-gray-400"},"Model Display Mode",-1)),_(t("select",{id:"model-display-mode","onUpdate:modelValue":n[3]||(n[3]=e=>$.value=e),class:"input-field mt-1"},n[9]||(n[9]=[t("option",{value:"mixed"},"Mixed (Alias or Original)",-1),t("option",{value:"aliased"},"Aliased Only",-1),t("option",{value:"original"},"Original Names Only",-1)]),512),[[M,$.value]])]),f.value?c("",!0):(i(),o("button",{key:0,onClick:F,class:"btn btn-primary self-end"},"+ Add New Binding"))])]),S(O)?(i(),o("div",Me,"Loading bindings...")):S(T).length===0&&!f.value?(i(),o("div",Te,[n[12]||(n[12]=t("p",null,"No LLM bindings configured yet.",-1)),t("button",{onClick:F,class:"mt-2 text-blue-600 hover:underline"},"Add your first one")])):(i(),o("div",De,[(i(!0),o(g,null,x(S(T),e=>(i(),o("div",{key:e.id,class:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow-md flex flex-col gap-4"},[t("div",Ve,[t("span",{class:h(["mt-1 h-3 w-3 rounded-full flex-shrink-0",e.is_active?"bg-green-500":"bg-gray-400"]),title:e.is_active?"Active":"Inactive"},null,10,$e),t("div",Fe,[t("div",Ne,[t("h4",Le,d(e.alias),1),t("div",Oe,[t("button",{onClick:l=>U(e),class:"text-sm font-medium text-blue-600 hover:underline"},"Edit",8,je),t("button",{onClick:l=>z(e),class:"text-sm font-medium text-red-600 hover:underline"},"Delete",8,Ue)])]),t("p",qe,d(I(e.name)),1),t("div",Ee,[(i(!0),o(g,null,x(e.config,(l,r)=>(i(),o(g,{key:r},[l&&r!=="model_name"?(i(),o("p",ze,[t("span",Ge,d(r.replace(/_/g," "))+":",1),r.includes("key")||r.includes("token")?(i(),o("span",Ie,"********")):(i(),o("span",Je,d(l),1))])):c("",!0)],64))),128)),e.default_model_name?(i(),o("p",Pe,[n[13]||(n[13]=t("span",{class:"font-semibold"},"Default Model:",-1)),b(" "+d(e.default_model_name),1)])):c("",!0)])])]),t("div",He,[t("button",{onClick:l=>G(e),class:"btn btn-secondary btn-sm flex items-center gap-2"},[ee(te,{class:"w-4 h-4"}),n[14]||(n[14]=b(" Manage Models "))],8,Ke)])]))),128))]))])]))}};export{We as default};
