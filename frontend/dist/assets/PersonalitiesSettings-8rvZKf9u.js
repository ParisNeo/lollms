import{z as G,b as i,e as o,f as s,d as b,t as m,F as S,y as V,u as J,n as Y,a as H,s as z,r as x,c as w,o as K,w as $,i as L,v as Q,q as W,x as T,l as I,p as B}from"./index-Cr_pE5VZ.js";const X={key:0,xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 text-yellow-400",viewBox:"0 0 20 20",fill:"currentColor"},Z={key:1,xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 hover:text-yellow-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},ee={key:0,class:"absolute inset-0 bg-gray-500/30 dark:bg-gray-900/50 flex items-center justify-center rounded-lg z-10"},te={class:"flex items-start space-x-3 mb-2 pr-8"},se={class:"flex-shrink-0 w-10 h-10 rounded-full bg-gray-200 dark:bg-gray-600 flex items-center justify-center overflow-hidden"},le=["src"],re={key:1,xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},oe={class:"flex-grow"},ae={class:"font-semibold text-gray-800 dark:text-gray-100"},ie={key:0,class:"text-xs text-gray-500 dark:text-gray-400"},ne={key:1,class:"text-xs text-blue-500 dark:text-blue-400 bg-blue-100 dark:bg-blue-900/50 px-1.5 py-0.5 rounded-full inline-block mt-1"},de={class:"text-sm text-gray-600 dark:text-gray-300 mb-4 line-clamp-3"},ue={class:"mt-auto flex justify-end items-center space-x-3 border-t dark:border-gray-600 pt-3"},ce={__name:"PersonalityCard",props:{personality:{type:Object,required:!0},isUserPersonality:{type:Boolean,default:!1},isActive:{type:Boolean,default:!1},isSaving:{type:Boolean,default:!1},isStarred:{type:Boolean,default:!1}},emits:["edit","delete","clone","select","toggle-star","share"],setup(n,{emit:p}){const v=n,u=p;function c(d){d.stopPropagation(),u(v.isUserPersonality?"edit":"clone",v.personality)}function h(d){d.stopPropagation(),u("delete",v.personality)}function C(d){d.stopPropagation(),u("toggle-star",v.personality)}function g(d){d.stopPropagation(),u("share",v.personality)}function y(){u("select",v.personality)}return(d,r)=>(o(),i("div",{class:V(["relative flex flex-col h-full bg-white dark:bg-gray-800 border dark:border-gray-700 rounded-lg shadow p-4 transition-all hover:shadow-lg cursor-pointer",{"ring-2 ring-offset-2 ring-blue-500 dark:ring-offset-gray-900 !border-blue-500":n.isActive,"opacity-50 pointer-events-none":n.isSaving}]),onClick:y},[s("button",{onClick:C,class:"absolute top-2 right-2 p-1 rounded-full text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-yellow-500","aria-label":"Toggle favorite"},[n.isStarred?(o(),i("svg",X,r[0]||(r[0]=[s("path",{d:"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"},null,-1)]))):(o(),i("svg",Z,r[1]||(r[1]=[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"},null,-1)])))]),n.isSaving?(o(),i("div",ee,r[2]||(r[2]=[s("svg",{class:"animate-spin h-8 w-8 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[s("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),s("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)]))):b("",!0),s("div",te,[s("div",se,[n.personality.icon_base64?(o(),i("img",{key:0,src:n.personality.icon_base64,alt:"icon",class:"w-full h-full object-cover"},null,8,le)):(o(),i("svg",re,r[3]||(r[3]=[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"},null,-1)])))]),s("div",oe,[s("h6",ae,m(n.personality.name),1),n.isUserPersonality?b("",!0):(o(),i("p",ie,"by "+m(n.personality.author||"System"),1)),n.personality.category?(o(),i("p",ne,m(n.personality.category),1)):b("",!0)])]),s("p",de,m(n.personality.description||"No description provided."),1),s("div",ue,[s("button",{onClick:g,class:"p-1 text-gray-400 hover:text-gray-600 dark:hover:text-gray-200","aria-label":"Share"},r[4]||(r[4]=[s("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor"},[s("path",{d:"M15 8a3 3 0 10-2.977-2.63l-4.94 2.47a3 3 0 100 4.319l4.94 2.47a3 3 0 10.895-1.789l-4.94-2.47a3.027 3.027 0 000-.74l4.94-2.47C13.456 7.68 14.19 8 15 8z"})],-1)])),r[5]||(r[5]=s("div",{class:"flex-grow"},null,-1)),n.isUserPersonality?(o(),i(S,{key:0},[s("button",{onClick:c,class:"font-medium text-sm text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300"},"Edit"),s("button",{onClick:h,class:"font-medium text-sm text-red-600 hover:text-red-800 dark:text-red-400 dark:hover:text-red-300"},"Delete")],64)):(o(),i("button",{key:1,onClick:c,class:"font-medium text-sm text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300"},"Clone & Edit"))])],2))}},O=G(ce,[["__scopeId","data-v-6e7abc25"]]),ge={class:"flex justify-between items-center mb-4"},ve={class:"flex gap-2"},ye={class:"my-6 grid grid-cols-1 md:grid-cols-2 gap-4"},fe={class:"relative"},pe=["value"],me={class:"space-y-10"},xe={class:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4"},we={key:0,class:"italic text-sm text-gray-500 p-2 mt-4"},be={key:1,class:"italic text-sm text-gray-500 p-2 mt-4"},he={key:0,class:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4"},ke={key:1,class:"italic text-sm text-gray-500 p-2"},F="lollms-starred-personalities",Ce={__name:"PersonalitiesSettings",setup(n){const p=J(),v=Y(),u=H(),{user:c}=z(p),{userPersonalities:h,publicPersonalities:C}=z(v),g=x(""),y=x(null),d=x(""),r=x("All"),f=x(new Set),M=w(()=>[...h.value,...C.value]),R=w(()=>{const t=new Set(["All","Starred"]);return M.value.forEach(e=>{e.category&&t.add(e.category)}),Array.from(t).sort((e,l)=>e==="All"?-1:l==="All"?1:e==="Starred"?-1:l==="Starred"?1:e.localeCompare(l))}),D=w(()=>{let t=M.value;r.value==="Starred"?t=t.filter(l=>f.value.has(l.id)):r.value!=="All"&&(t=t.filter(l=>l.category===r.value));const e=d.value.toLowerCase().trim();return e&&(t=t.filter(l=>l.name.toLowerCase().includes(e)||l.description&&l.description.toLowerCase().includes(e))),t}),P=w(()=>D.value.filter(t=>!t.is_public&&t.owner_username!=="System")),E=w(()=>D.value.filter(t=>t.is_public||t.owner_username==="System"));K(()=>{v.fetchPersonalities();try{const t=localStorage.getItem(F);t&&(f.value=new Set(JSON.parse(t)))}catch(t){console.error("Failed to load starred personalities from localStorage:",t),f.value=new Set}c.value&&(g.value=c.value.active_personality_id||"",r.value=c.value.personalities_view_category||"All")}),$(()=>{var t;return(t=c.value)==null?void 0:t.active_personality_id},t=>{g.value=t||""}),$(()=>{var t;return(t=c.value)==null?void 0:t.personalities_view_category},t=>{r.value=t||"All"}),$(r,t=>{c.value&&t!==(c.value.personalities_view_category||"All")&&p.updateUserPreferences({personalities_view_category:t})});async function A(t){const e=new Set(f.value);e.has(t.id)?e.delete(t.id):e.add(t.id),f.value=e;try{const l=Array.from(e);localStorage.setItem(F,JSON.stringify(l))}catch(l){console.error("Failed to save starred personalities to localStorage:",l),u.showToast({message:"Could not save favorite status.",type:"error"})}}async function j(t){if(!y.value){if(!t||g.value===t.id){await _();return}y.value=t.id;try{await p.updateUserPreferences({active_personality_id:t.id})}catch{}finally{y.value=null}}}async function _(){if(!(!g.value||y.value)){y.value=g.value;try{await p.updateUserPreferences({active_personality_id:null})}catch{}finally{y.value=null}}}function k(t=null){let e;t?(e={...t},(t.is_public||t.owner_username==="System")&&!p.user.is_admin&&(e.id=null,e.is_public=!1,e.owner_type="user")):e={id:null,name:"",category:"",description:"",prompt_text:"",is_public:!1,icon_base_64:null},u.openModal("personalityEditor",{personality:e})}function q(){u.openModal("generatePersonality")}async function N(t){await u.showConfirmation({title:`Delete ${t.name}`,message:"Are you sure you want to delete this personality? This cannot be undone.",confirmText:"Delete"})&&(g.value===t.id&&await _(),f.value.has(t.id)&&A(t),await v.deletePersonality(t.id))}async function U(t){try{await navigator.clipboard.writeText(JSON.stringify(t,null,2)),u.showToast({message:`${t.name} copied to clipboard!`,type:"success"})}catch{u.showToast({message:"Failed to copy to clipboard.",type:"error"})}}return(t,e)=>(o(),i("section",null,[s("div",ge,[e[16]||(e[16]=s("h4",{class:"text-lg font-semibold"},"Personalities",-1)),s("div",ve,[s("button",{onClick:e[0]||(e[0]=l=>q()),class:"btn btn-primary"},"Generate from Prompt"),s("button",{onClick:e[1]||(e[1]=l=>k()),class:"btn btn-secondary"},"+ Create New")])]),s("div",ye,[s("div",fe,[L(s("input",{type:"text","onUpdate:modelValue":e[2]||(e[2]=l=>d.value=l),placeholder:"Search personalities...",class:"input-field w-full !pr-10"},null,512),[[Q,d.value]]),d.value?(o(),i("button",{key:0,onClick:e[3]||(e[3]=l=>d.value=""),class:"absolute inset-y-0 right-0 flex items-center pr-3 text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"},e[17]||(e[17]=[s("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))):b("",!0)]),s("div",null,[L(s("select",{"onUpdate:modelValue":e[4]||(e[4]=l=>r.value=l),class:"input-field w-full"},[(o(!0),i(S,null,T(R.value,l=>(o(),i("option",{key:l,value:l},m(l),9,pe))),128))],512),[[W,r.value]])])]),s("div",me,[s("div",null,[e[19]||(e[19]=s("h5",{class:"text-md font-semibold mb-4"},"Your Personalities",-1)),s("div",xe,[s("div",{onClick:_,class:V(["flex flex-col items-center justify-center h-full min-h-[160px] bg-white dark:bg-gray-800 border-2 border-dashed dark:border-gray-600 rounded-lg p-4 transition-all hover:border-gray-400 dark:hover:border-gray-500 cursor-pointer",{"!border-solid ring-2 ring-offset-2 ring-blue-500 dark:ring-offset-gray-900 !border-blue-500":!g.value}])},e[18]||(e[18]=[s("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 text-gray-400 mb-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"1.5"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636"})],-1),s("span",{class:"font-semibold text-sm text-gray-700 dark:text-gray-300"},"No Personality",-1),s("span",{class:"text-xs text-gray-500 dark:text-gray-400"},"(Default)",-1)]),2),(o(!0),i(S,null,T(P.value,l=>(o(),I(O,{key:l.id,personality:l,"is-user-personality":!0,"is-active":l.id===g.value,"is-saving":l.id===y.value,"is-starred":f.value.has(l.id),onSelect:e[5]||(e[5]=a=>j(a)),onToggleStar:e[6]||(e[6]=a=>A(a)),onEdit:e[7]||(e[7]=a=>k(a)),onDelete:e[8]||(e[8]=a=>N(a)),onShare:e[9]||(e[9]=a=>U(a))},null,8,["personality","is-active","is-saving","is-starred"]))),128))]),P.value.length===0&&B(h).length===0?(o(),i("p",we," You haven't created any personalities yet. ")):P.value.length===0?(o(),i("p",be," No matches found in your personalities. ")):b("",!0)]),s("div",null,[e[20]||(e[20]=s("h5",{class:"text-md font-semibold mb-4"},"Public & System Personalities",-1)),E.value.length>0?(o(),i("div",he,[(o(!0),i(S,null,T(E.value,l=>(o(),I(O,{key:l.id,personality:l,"is-user-personality":B(c)&&B(c).is_admin,"is-active":l.id===g.value,"is-saving":l.id===y.value,"is-starred":f.value.has(l.id),onSelect:e[10]||(e[10]=a=>j(a)),onToggleStar:e[11]||(e[11]=a=>A(a)),onClone:e[12]||(e[12]=a=>k(a)),onEdit:e[13]||(e[13]=a=>k(a)),onDelete:e[14]||(e[14]=a=>N(a)),onShare:e[15]||(e[15]=a=>U(a))},null,8,["personality","is-user-personality","is-active","is-saving","is-starred"]))),128))])):(o(),i("p",ke,m(d.value||r.value!=="All"?"No matches found in public personalities.":"No public personalities available."),1))])])]))}};export{Ce as default};
