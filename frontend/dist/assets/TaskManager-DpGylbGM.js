import{N as w,s as T,r as C,o as S,j as R,w as N,c as r,b as o,g as e,e as d,k as p,n as g,O as D,A as u,G as L,F as x,i as k,t as n,P as I,d as _}from"./index-Dgz_WaCM.js";const j={class:"space-y-6"},A={class:"flex items-center justify-between"},B=["disabled"],M={class:"grid grid-cols-1 md:grid-cols-3 gap-6"},V={class:"md:col-span-1 bg-white dark:bg-gray-800 rounded-lg shadow-sm overflow-hidden"},E={class:"max-h-[60vh] overflow-y-auto"},F={key:0,class:"p-4 text-center text-gray-500"},O={key:1,class:"p-4 text-center text-gray-500"},z={key:2,class:"divide-y dark:divide-gray-700"},P=["onClick"],G={class:"flex justify-between items-center mb-1"},J=["title"],$={class:"w-full bg-gray-200 rounded-full h-1.5 dark:bg-gray-600"},q={class:"md:col-span-2 bg-white dark:bg-gray-800 rounded-lg shadow-sm"},H={key:0,class:"h-full flex items-center justify-center"},K={key:1,class:"flex flex-col h-full"},Q={class:"p-4 border-b dark:border-gray-700"},U={class:"font-semibold truncate"},W={class:"text-xs text-gray-500 dark:text-gray-400"},X={class:"p-4 space-y-2 text-sm"},Y={key:0,class:"text-red-500 p-2 bg-red-50 dark:bg-red-900/20 rounded"},Z={key:1,class:"pt-2"},ee={class:"mt-1 p-2 bg-gray-100 dark:bg-gray-900 rounded-md"},te={class:"whitespace-pre-wrap break-words text-xs font-mono max-h-48 overflow-y-auto"},se={class:"flex-grow p-4 border-t dark:border-gray-700 overflow-hidden flex flex-col"},ae={class:"flex-grow bg-gray-100 dark:bg-gray-900 rounded p-2 overflow-y-auto font-mono text-xs"},le={class:"text-gray-400 mr-2"},ne={__name:"TaskManager",setup(re){const i=w(),{tasks:v,isLoadingTasks:b}=T(i),a=C(null);S(()=>{i.fetchTasks()});const c=R(()=>Array.isArray(v.value)?[...v.value].sort((l,t)=>new Date(t.created_at)-new Date(l.created_at)):[]);N(c,l=>{if(a.value&&!l.some(t=>t.id===a.value.id))a.value=null;else if(a.value){const t=l.find(s=>s.id===a.value.id);t&&(a.value=t)}});function f(l){return l?new Date(l).toLocaleString():"N/A"}function y(l){switch(l){case"running":return{color:"blue",text:"Running"};case"completed":return{color:"green",text:"Completed"};case"failed":return{color:"red",text:"Failed"};case"cancelled":return{color:"yellow",text:"Cancelled"};case"pending":default:return{color:"gray",text:"Pending"}}}function h(l){return typeof l=="object"&&l!==null?JSON.stringify(l,null,2):String(l)}return(l,t)=>(o(),r("div",j,[e("div",A,[t[3]||(t[3]=e("div",null,[e("h2",{class:"text-xl font-bold"},"Background Task Manager"),e("p",{class:"text-sm text-gray-500"},"Monitor and manage background processes like installations.")],-1)),e("div",null,[e("button",{onClick:t[0]||(t[0]=(...s)=>d(i).fetchTasks&&d(i).fetchTasks(...s)),class:"btn btn-secondary mr-2",disabled:d(b)},[p(D,{class:g(["w-4 h-4",{"animate-spin":d(b)}])},null,8,["class"])],8,B),e("button",{onClick:t[1]||(t[1]=(...s)=>d(i).clearCompletedTasks&&d(i).clearCompletedTasks(...s)),class:"btn btn-danger"},[p(L,{class:"w-4 h-4 mr-2"}),t[2]||(t[2]=u(" Clear Completed "))])])]),e("div",M,[e("div",V,[t[4]||(t[4]=e("div",{class:"p-4 border-b dark:border-gray-700"},[e("h3",{class:"font-semibold"},"Tasks")],-1)),e("div",E,[d(b)&&c.value.length===0?(o(),r("div",F,"Loading...")):c.value.length===0?(o(),r("div",O,"No tasks found.")):(o(),r("ul",z,[(o(!0),r(x,null,k(c.value,s=>(o(),r("li",{key:s.id},[e("button",{onClick:m=>a.value=s,class:g(["w-full text-left p-4 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors",{"bg-blue-50 dark:bg-blue-900/30":a.value&&a.value.id===s.id}])},[e("div",G,[e("p",{class:"font-medium truncate",title:s.name},n(s.name),9,J),e("span",{class:g(["text-xs px-2 py-0.5 rounded-full",{"bg-blue-100 text-blue-800 dark:bg-blue-900/50 dark:text-blue-300":s.status==="running","bg-green-100 text-green-800 dark:bg-green-900/50 dark:text-green-300":s.status==="completed","bg-red-100 text-red-800 dark:bg-red-900/50 dark:text-red-300":s.status==="failed","bg-yellow-100 text-yellow-800 dark:bg-yellow-900/50 dark:text-yellow-300":s.status==="cancelled","bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300":s.status==="pending"}])},n(y(s.status).text),3)]),e("div",$,[e("div",{class:g(["h-1.5 rounded-full",{"bg-blue-500":s.status==="running","bg-green-500":s.status==="completed","bg-red-500":s.status==="failed"}]),style:I({width:s.progress+"%"})},null,6)])],10,P)]))),128))]))])]),e("div",q,[a.value?(o(),r("div",K,[e("div",Q,[e("h3",U,n(a.value.name),1),e("p",W,"ID: "+n(a.value.id),1)]),e("div",X,[e("p",null,[t[6]||(t[6]=e("strong",null,"Status:",-1)),u(" "+n(y(a.value.status).text),1)]),e("p",null,[t[7]||(t[7]=e("strong",null,"Created:",-1)),u(" "+n(f(a.value.created_at)),1)]),e("p",null,[t[8]||(t[8]=e("strong",null,"Started:",-1)),u(" "+n(f(a.value.started_at)),1)]),e("p",null,[t[9]||(t[9]=e("strong",null,"Completed:",-1)),u(" "+n(f(a.value.completed_at)),1)]),a.value.error?(o(),r("div",Y,[t[10]||(t[10]=e("strong",null,"Error:",-1)),u(" "+n(a.value.error),1)])):_("",!0),a.value.result?(o(),r("div",Z,[t[11]||(t[11]=e("strong",{class:"text-gray-800 dark:text-gray-200"},"Result:",-1)),e("div",ee,[e("pre",te,n(h(a.value.result)),1)])])):_("",!0)]),e("div",se,[t[12]||(t[12]=e("h4",{class:"font-semibold mb-2 flex-shrink-0"},"Logs",-1)),e("div",ae,[(o(!0),r(x,null,k(a.value.logs,(s,m)=>(o(),r("p",{key:m,class:g({"text-red-500":s.level==="CRITICAL"||s.level==="ERROR"})},[e("span",le,n(new Date(s.timestamp).toLocaleTimeString()),1),e("span",null,n(s.message),1)],2))),128))])])])):(o(),r("div",H,t[5]||(t[5]=[e("p",{class:"text-gray-500"},"Select a task to view its details and logs.",-1)])))])])]))}};export{ne as default};
