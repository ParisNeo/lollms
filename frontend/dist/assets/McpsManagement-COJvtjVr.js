import{bG as Re,O as _e,L as Se,x as $e,s as K,r as M,j as c,w as C,o as Ae,c as i,b as l,g as a,d as m,n as Q,k as $,M as G,h as f,l as A,v as T,V as Te,F as h,i as w,t as y,B as L,e as J,A as N,bM as W,f as Ie,E as Ue}from"./index-D1qaGzi2.js";import{I as Pe,a as De}from"./IconArrowDown-D0FxhV-X.js";import{A as Ve}from"./AppCard-Cjxyd6aS.js";import{A as Ze}from"./AppCardSkeleton-NLcs6Uu2.js";const Fe={class:"space-y-6"},Le={class:"border-b border-gray-200 dark:border-gray-700"},Ne={class:"-mb-px flex space-x-6","aria-label":"Sub Tabs"},ze={key:0},Be={class:"flex justify-between items-center mb-4 flex-wrap gap-2"},Oe={class:"flex items-center gap-2"},je={class:"space-y-4"},qe={class:"grid grid-cols-1 lg:grid-cols-4 gap-4"},Ee={class:"relative lg:col-span-1"},He={class:"grid grid-cols-1 sm:grid-cols-3 lg:col-span-3 gap-4"},Ke=["value"],Qe=["value"],Ge={class:"flex items-center gap-2"},Je=["value"],We={key:0,class:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 2xl:grid-cols-4 gap-6"},Xe={key:1,class:"empty-state-card"},Ye={key:2},et={class:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 2xl:grid-cols-4 gap-6"},tt={key:0,class:"flex justify-between items-center mt-6"},st=["disabled"],at={class:"text-sm text-gray-600 dark:text-gray-400"},nt=["disabled"],lt={key:1},ot={class:"flex justify-between items-center mb-4 flex-wrap gap-2"},it={key:0,class:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm mb-6"},rt={class:"flex items-center gap-x-4"},dt={key:0},ut=["required"],ct={key:1},pt=["required"],vt={key:1,class:"text-center p-4"},ft={key:2,class:"empty-state-card"},gt={key:3,class:"space-y-4"},yt={class:"font-semibold"},mt={class:"text-sm text-gray-500"},bt={class:"text-xs text-gray-400"},ht={class:"flex items-center gap-2"},wt=["onClick"],kt=["onClick"],xt={__name:"McpsManagement",setup(Mt){const o=_e(),z=Se(),d=$e(),{mcpFilters:u}=o,{mcpZooRepositories:B,isLoadingMcpZooRepositories:X,zooMcps:R,isLoadingZooMcps:Y}=K(o),{tasks:ee}=K(z),g=M("zoo"),r=M({type:"git",name:"",url:"",path:""}),k=M(!1),v=M(null),x=M(JSON.parse(localStorage.getItem("starredMcps")||"[]"));let O=null;const I=c({get:()=>u.searchQuery,set:e=>{u.searchQuery=e}}),U=c({get:()=>u.selectedCategory,set:e=>{u.selectedCategory=e}}),P=c({get:()=>u.installationStatusFilter,set:e=>{u.installationStatusFilter=e}}),D=c({get:()=>u.selectedRepository,set:e=>{u.selectedRepository=e}}),V=c({get:()=>u.sortKey,set:e=>{u.sortKey=e}}),_=c({get:()=>u.sortOrder,set:e=>{u.sortOrder=e}}),p=c({get:()=>u.currentPage,set:e=>{u.currentPage=e}}),j=c({get:()=>u.pageSize,set:e=>{u.pageSize=e}}),te=[{value:"last_update_date",label:"Last Updated"},{value:"creation_date",label:"Creation Date"},{value:"name",label:"Name"},{value:"author",label:"Author"}],Z=c(()=>R.value.total||0),q=c(()=>R.value.pages||1),se=c(()=>{if(Z.value===0)return"Showing 0-0 of 0";const e=(p.value-1)*j.value+1,t=Math.min(p.value*j.value,Z.value);return`Showing ${e}-${t} of ${Z.value}`});function ae(){clearTimeout(O),O=setTimeout(()=>{p.value!==1?p.value=1:o.fetchZooMcps()},300)}C([V,_,U,P,D],()=>{p.value!==1?p.value=1:o.fetchZooMcps()}),C(I,ae),C(p,o.fetchZooMcps),C(x,e=>{localStorage.setItem("starredMcps",JSON.stringify(e))},{deep:!0}),C(g,e=>{e==="zoo"&&o.fetchZooMcps(),e==="source"&&o.fetchMcpZooRepositories()}),Ae(()=>{g.value==="zoo"&&o.fetchZooMcps(),g.value==="source"&&o.fetchMcpZooRepositories()});const F=c(()=>{const e=new Map,t="Installing MCP: ",s=/^(Updating app|Start app|Stop app|Fixing item|Purging item): .* \(([a-fA-F0-9-]+)\)$/;return(ee.value||[]).forEach(n=>{if(n!=null&&n.name&&(n.status==="running"||n.status==="pending")){let b;if(n.name.startsWith(t))b=`folder:${n.name.replace(t,"")}`;else{const H=n.name.match(s);H&&(b=`id:${H[2]}`)}b&&(!e.has(b)||new Date(n.created_at)>new Date(e.get(b).created_at))&&e.set(b,n)}}),(R.value.items||[]).map(n=>({...n,task:e.get(`folder:${n.folder_name}`)||(n.id?e.get(`id:${n.id}`):null)}))}),S=c(()=>Array.isArray(B.value)?[...B.value].sort((e,t)=>(e.name||"").localeCompare(t.name||"")):[]),ne=c(()=>["All","Starred",...R.value.categories||[]]);function le(e){const t=x.value.indexOf(e);t>-1?x.value.splice(t,1):x.value.push(e)}function oe(e){return e?new Date(e).toLocaleString():"Never"}async function ie(){if(!r.value.name){d.addNotification("Repository name is required.","warning");return}const e={name:r.value.name};r.value.type==="git"?e.url=r.value.url:e.path=r.value.path,v.value="add";try{await o.addMcpZooRepository(e),r.value={type:"git",name:"",url:"",path:""},k.value=!1}finally{v.value=null}}async function re(e){v.value=e.id;try{await o.pullMcpZooRepository(e.id)}finally{v.value=null}}async function de(e){if(await d.showConfirmation({title:`Delete Repository '${e.name}'?`})){v.value=e.id;try{await o.deleteMcpZooRepository(e.id)}finally{v.value=null}}}function ue(e){d.openModal("appInstall",{app:e,type:"mcps"})}async function ce(e){await d.showConfirmation({title:`Update '${e.name}'?`,confirmText:"Update"})&&await o.updateApp(e.id)}async function E(e,t){v.value=`${t}-${e}`;try{t==="start"&&await o.startApp(e),t==="stop"&&await o.stopApp(e)}finally{v.value=null}}async function pe(e){if(await d.showConfirmation({title:`Uninstall '${e.name}'?`,confirmText:"Uninstall"})){v.value=`uninstall-${e.id}`;try{await o.uninstallApp(e.id)}finally{v.value=null}}}function ve(e){e.is_installed?d.openModal("appConfig",{app:e}):e.repository==="Registered"&&d.openModal("serviceRegistration",{item:e,itemType:"mcp",ownerType:e.type||"system",onRegistered:o.fetchZooMcps})}async function fe(e){await d.showConfirmation({title:`Delete Registration for '${e.name}'?`,message:"This will remove the manually registered entry but will not affect the service itself.",confirmText:"Delete"})&&await o.deleteRegisteredMcp(e.id)}function ge(e){d.openModal("appLog",{app:e})}async function ye(e){const t=await o.fetchMcpReadme(e.repository,e.folder_name);d.openModal("sourceViewer",{title:`README: ${e.name}`,content:t,language:"markdown"})}async function me(e){await z.cancelTask(e)}function be(e){d.openModal("tasksManager",{initialTaskId:e})}async function he(){await o.syncInstallations()}async function we(e){await d.showConfirmation({title:`Purge '${e.name}'?`,message:"This will permanently delete the installation folder.",confirmText:"Purge"})&&await o.purgeBrokenInstallation({...e,item_type:"mcp"})}async function ke(e){await d.showConfirmation({title:`Fix '${e.name}'?`,message:"This will attempt to re-create the database entry for this item.",confirmText:"Fix"})&&await o.fixBrokenInstallation({...e,item_type:"mcp"})}function xe(e){d.openModal("appDetails",{app:e})}function Me(){d.openModal("serviceRegistration",{itemType:"mcp",ownerType:"system",onRegistered:o.fetchZooMcps})}async function Ce(){const e=await o.refreshZooCache();e&&d.openModal("tasksManager",{initialTaskId:e.id})}return(e,t)=>(l(),i("div",Fe,[a("div",Le,[a("nav",Ne,[a("button",{onClick:t[0]||(t[0]=s=>g.value="zoo"),class:Q(["tab-button",g.value==="zoo"?"active":"inactive"])},"Zoo",2),a("button",{onClick:t[1]||(t[1]=s=>g.value="source"),class:Q(["tab-button",g.value==="source"?"active":"inactive"])},"Repositories",2)])]),g.value==="zoo"?(l(),i("section",ze,[a("div",Be,[t[16]||(t[16]=a("h3",{class:"text-xl font-semibold"},"MCP Zoo",-1)),a("div",Oe,[a("button",{onClick:Ce,class:"btn btn-secondary",title:"Refresh Zoo Cache from all sources"},[$(G,{class:"w-4 h-4"})]),a("button",{onClick:Me,class:"btn btn-secondary"},"Register External MCP"),a("button",{onClick:he,class:"btn btn-secondary-outline",title:"Repair broken installations and remove orphaned DB entries."},"Sync Installations")])]),a("div",je,[a("div",qe,[a("div",Ee,[f(a("input",{type:"text","onUpdate:modelValue":t[2]||(t[2]=s=>I.value=s),placeholder:"Search MCPs...",class:"input-field w-full pl-10"},null,512),[[A,I.value]]),t[17]||(t[17]=a("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[a("svg",{class:"h-5 w-5 text-gray-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})])],-1))]),a("div",He,[f(a("select",{"onUpdate:modelValue":t[3]||(t[3]=s=>P.value=s),class:"input-field"},t[18]||(t[18]=[Te('<option value="All" data-v-7d1ef5cc>All Statuses</option><option value="Installed" data-v-7d1ef5cc>Installed</option><option value="Uninstalled" data-v-7d1ef5cc>Uninstalled</option><option value="Registered" data-v-7d1ef5cc>Registered</option><option value="Broken" data-v-7d1ef5cc>Broken</option>',5)]),512),[[T,P.value]]),f(a("select",{"onUpdate:modelValue":t[4]||(t[4]=s=>U.value=s),class:"input-field"},[(l(!0),i(h,null,w(ne.value,s=>(l(),i("option",{key:s,value:s},y(s),9,Ke))),128))],512),[[T,U.value]]),f(a("select",{"onUpdate:modelValue":t[5]||(t[5]=s=>D.value=s),class:"input-field"},[t[19]||(t[19]=a("option",{value:"All"},"All Sources",-1)),t[20]||(t[20]=a("option",{value:"Registered"},"Registered",-1)),(l(!0),i(h,null,w(S.value,s=>(l(),i("option",{key:s.id,value:s.name},y(s.name),9,Qe))),128))],512),[[T,D.value]])])]),a("div",Ge,[f(a("select",{"onUpdate:modelValue":t[6]||(t[6]=s=>V.value=s),class:"input-field w-48"},[(l(),i(h,null,w(te,s=>a("option",{key:s.value,value:s.value},"Sort by "+y(s.label),9,Je)),64))],512),[[T,V.value]]),a("button",{onClick:t[7]||(t[7]=s=>_.value=_.value==="asc"?"desc":"asc"),class:"btn btn-secondary p-2"},[_.value==="asc"?(l(),L(Pe,{key:0,class:"w-5 h-5"})):(l(),L(De,{key:1,class:"w-5 h-5"}))])]),J(Y)?(l(),i("div",We,[(l(),i(h,null,w(8,s=>$(Ze,{key:s})),64))])):!F.value||F.value.length===0?(l(),i("div",Xe,t[21]||(t[21]=[a("h4",{class:"font-semibold"},"No MCPs Found",-1)]))):(l(),i("div",Ye,[a("div",et,[(l(!0),i(h,null,w(F.value,s=>(l(),L(Ve,{key:s.id||`${s.repository}/${s.folder_name}`,app:s,task:s.task,"is-starred":x.value.includes(s.name),"item-type-name":"MCP",onStar:n=>le(s.name),onInstall:n=>ue(s),onUpdate:n=>ce(s),onUninstall:n=>pe(s),onDelete:n=>fe(s),onHelp:n=>ye(s),onViewTask:be,onCancelInstall:n=>me(s.task.id),onStart:n=>E(s.id,"start"),onStop:n=>E(s.id,"stop"),onConfigure:n=>ve(s),onFix:n=>ke(s),onPurge:n=>we(s),onDetails:xe,onLogs:n=>ge(s)},null,8,["app","task","is-starred","onStar","onInstall","onUpdate","onUninstall","onDelete","onHelp","onCancelInstall","onStart","onStop","onConfigure","onFix","onPurge","onLogs"]))),128))]),q.value>1?(l(),i("div",tt,[a("button",{onClick:t[8]||(t[8]=s=>p.value--),disabled:p.value===1,class:"btn btn-secondary"},"Previous",8,st),a("span",at,y(se.value),1),a("button",{onClick:t[9]||(t[9]=s=>p.value++),disabled:p.value>=q.value,class:"btn btn-secondary"},"Next",8,nt)])):m("",!0)]))])])):m("",!0),g.value==="source"?(l(),i("section",lt,[a("div",ot,[t[22]||(t[22]=a("h3",{class:"text-xl font-semibold"},"MCP Zoo Repositories",-1)),a("button",{onClick:t[10]||(t[10]=s=>k.value=!k.value),class:"btn btn-primary"},y(k.value?"Cancel":"Add Repository"),1)]),k.value?(l(),i("div",it,[a("form",{onSubmit:Ie(ie,["prevent"]),class:"space-y-4"},[a("div",rt,[a("label",null,[f(a("input",{type:"radio","onUpdate:modelValue":t[11]||(t[11]=s=>r.value.type=s),value:"git",class:"radio-input"},null,512),[[W,r.value.type]]),t[23]||(t[23]=N(" Git"))]),a("label",null,[f(a("input",{type:"radio","onUpdate:modelValue":t[12]||(t[12]=s=>r.value.type=s),value:"local",class:"radio-input"},null,512),[[W,r.value.type]]),t[24]||(t[24]=N(" Local"))])]),a("div",null,[t[25]||(t[25]=a("label",null,"Name",-1)),f(a("input",{"onUpdate:modelValue":t[13]||(t[13]=s=>r.value.name=s),type:"text",class:"input-field",required:""},null,512),[[A,r.value.name]])]),r.value.type==="git"?(l(),i("div",dt,[t[26]||(t[26]=a("label",null,"URL",-1)),f(a("input",{"onUpdate:modelValue":t[14]||(t[14]=s=>r.value.url=s),type:"url",class:"input-field",required:r.value.type==="git"},null,8,ut),[[A,r.value.url]])])):m("",!0),r.value.type==="local"?(l(),i("div",ct,[t[27]||(t[27]=a("label",null,"Path",-1)),f(a("input",{"onUpdate:modelValue":t[15]||(t[15]=s=>r.value.path=s),type:"text",class:"input-field",required:r.value.type==="local"},null,8,pt),[[A,r.value.path]])])):m("",!0),t[28]||(t[28]=a("div",{class:"flex justify-end"},[a("button",{type:"submit",class:"btn btn-primary"},"Add")],-1))],32)])):m("",!0),J(X)?(l(),i("div",vt,"Loading...")):!S.value||S.value.length===0?(l(),i("div",ft,t[29]||(t[29]=[a("p",null,"No repositories added.",-1)]))):(l(),i("div",gt,[(l(!0),i(h,null,w(S.value,s=>(l(),i("div",{key:s.id,class:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm flex items-center justify-between"},[a("div",null,[a("p",yt,y(s.name),1),a("p",mt,y(s.url),1),a("p",bt,"Pulled: "+y(oe(s.last_pulled_at)),1)]),a("div",ht,[a("button",{onClick:n=>re(s),class:"btn btn-secondary btn-sm"},[$(G,{class:"w-4 h-4 mr-1"}),N(y(s.type==="git"?"Pull":"Rescan"),1)],8,wt),s.is_deletable?(l(),i("button",{key:0,onClick:n=>de(s),class:"btn btn-danger btn-sm"},[$(Ue,{class:"w-4 h-4"})],8,kt)):m("",!0)])]))),128))]))])):m("",!0)]))}},$t=Re(xt,[["__scopeId","data-v-7d1ef5cc"]]);export{$t as default};
