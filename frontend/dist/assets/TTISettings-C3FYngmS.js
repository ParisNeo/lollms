import{$ as H,u as K,a as W,G as X,s as R,r as m,k as Z,l as ee,m as te,p as se,q as ae,w as k,bP as le,j as _,o as ne,c as n,b as l,g as a,d as g,x as O,y as E,bR as z,t as v,z as oe,h as w,A as ie,e as B,f as A,B as re,F as T,i as S,n as F,bQ as de,T as ue,C as ce,J as ve,v as fe,O as me,bS as ge}from"./index-WYAPiqhJ.js";const be={class:"space-y-8"},ye={class:"relative"},_e={class:"flex items-center space-x-3 truncate"},he=["src"],pe={key:1,class:"w-8 h-8 flex-shrink-0 text-gray-500 dark:text-gray-400 flex items-center justify-center bg-gray-200 dark:bg-gray-700 rounded-md"},xe={class:"min-w-0 text-left"},ke={class:"block font-semibold truncate"},we={class:"p-2 sticky top-0 bg-white dark:bg-gray-800 z-10 border-b dark:border-gray-700"},Te={class:"p-1 flex-grow overflow-y-auto"},Se={key:0,class:"text-center p-4 text-sm text-gray-500"},Ce={key:1,class:"text-center p-4 text-sm text-gray-500"},Me={class:"px-2 py-1.5 text-xs font-bold text-gray-600 dark:text-gray-300"},Ie=["onClick"],Oe={class:"flex items-center space-x-3 truncate"},Ee=["src"],Fe={class:"truncate text-left"},Ve={class:"font-medium truncate text-sm"},Le={key:0,class:"p-4 border rounded-lg dark:border-gray-700 space-y-4"},Ue={class:"font-medium"},$e={class:"font-mono text-blue-600 dark:text-blue-400"},je={key:0,class:"text-sm text-gray-500"},De={key:1,class:"grid grid-cols-1 md:grid-cols-2 gap-6"},Ne=["for"],Re={key:0,class:"text-xs text-gray-500 dark:text-gray-400 mb-1"},ze=["id","onUpdate:modelValue"],Be=["value"],Ae=["type","step","id","onUpdate:modelValue","placeholder"],Pe={key:3,class:"mt-1"},Ge=["onClick"],Je={key:2,class:"flex justify-end gap-3 pt-4 border-t dark:border-gray-600"},qe=["disabled"],Qe={key:1,class:"p-4 border border-yellow-300 dark:border-yellow-700 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg text-sm text-yellow-800 dark:text-yellow-200 flex items-center gap-3"},Ye={class:"flex justify-end pt-4 border-t dark:border-gray-600"},He=["disabled"],Ke={__name:"TTISettings",setup(We){const V=K(),p=W();X();const{user:f}=R(V),{availableTtiModels:L,availableTtiModelsGrouped:U}=R(p),o=m({}),h=m(!1),C=m(!1);let $="{}";const b=m(!1),M=m(null),I=m(null),x=m(""),{floatingStyles:P}=Z(M,I,{placement:"bottom-start",whileElementsMounted:ee,middleware:[te(5),se(),ae({padding:5})]}),G={mounted:(s,t)=>{s.clickOutsideEvent=i=>{const d=M.value;s===i.target||s.contains(i.target)||d!=null&&d.contains(i.target)||t.value()},document.addEventListener("mousedown",s.clickOutsideEvent)},unmounted:s=>{document.removeEventListener("mousedown",s.clickOutsideEvent)}};k(b,s=>{s&&le(()=>{const t=I.value;if(t){const i=t.querySelector(".menu-item-button.selected");i&&i.scrollIntoView({block:"nearest"})}})});const c=_({get:()=>o.value.tti_binding_model_name,set:s=>{o.value.tti_binding_model_name=s}}),u=_(()=>!c.value||L.value.length===0?null:L.value.find(s=>s.id===c.value)||null),y=_(()=>{var t,i;if(!((i=(t=u.value)==null?void 0:t.binding_params)!=null&&i.parameters))return[];const s=["model"];return u.value.binding_params.parameters.filter(d=>!s.includes(d.name))}),J=_(()=>!f.value||!c.value||!f.value.tti_models_config?{}:f.value.tti_models_config[c.value]||{}),j=_(()=>{var s;return(s=u.value)!=null&&s.alias?u.value.alias.allow_parameters_override!==!1:!0}),D=_(()=>{if(!x.value)return U.value;const s=x.value.toLowerCase(),t=[];for(const i of U.value)if(i.items){const d=i.items.filter(e=>e.name.toLowerCase().includes(s));d.length>0&&t.push({...i,items:d})}return t});function q(s){c.value=s,b.value=!1}const N=()=>{if(f.value){const s={};u.value&&y.value.forEach(t=>{s[t.name]=J.value[t.name]??t.default}),o.value={...s,tti_binding_model_name:f.value.tti_binding_model_name},$=JSON.stringify(o.value),C.value=!1}};k(u,N,{immediate:!0,deep:!0}),k(f,N,{deep:!0}),k(o,s=>{C.value=JSON.stringify(s)!==JSON.stringify($)},{deep:!0});async function Q(){h.value=!0;try{const s={tti_binding_model_name:o.value.tti_binding_model_name},t=f.value.tti_models_config||{},i={};y.value.forEach(e=>{o.value[e.name]!==e.default&&o.value[e.name]!==null&&o.value[e.name]!==""&&(i[e.name]=o.value[e.name])});const d={...t,[c.value]:i};Object.keys(d[c.value]||{}).length===0&&delete d[c.value],s.tti_models_config=d,await V.updateUserPreferences(s)}finally{h.value=!1}}function Y(){const s={};u.value&&(y.value.forEach(t=>{s[t.name]=t.default}),o.value={...o.value,...s})}return ne(()=>{p.availableTtiModels.length===0&&p.fetchAvailableTtiModels()}),(s,t)=>{var i,d;return l(),n("div",be,[t[7]||(t[7]=a("div",null,[a("h3",{class:"text-xl font-semibold leading-6 text-gray-900 dark:text-white"}," Image Generation (TTI) Parameters "),a("p",{class:"mt-1 text-sm text-gray-500 dark:text-gray-400"}," Configure default parameters for your selected Text-to-Image model. These settings can be overridden by model aliases set by an administrator if overrides are disabled. ")],-1)),a("form",{onSubmit:A(Q,["prevent"]),class:"space-y-6"},[a("div",null,[t[4]||(t[4]=a("label",{class:"block text-base font-medium mb-2"},"Active Image Generation Model",-1)),a("div",ye,[a("button",{ref_key:"ttiTriggerRef",ref:M,onClick:t[0]||(t[0]=e=>b.value=!b.value),type:"button",class:"toolbox-select truncate w-full flex items-center justify-between"},[a("div",_e,[(i=u.value)!=null&&i.icon_base64?(l(),n("img",{key:0,src:u.value.icon_base64,class:"h-8 w-8 rounded-md object-cover"},null,8,he)):(l(),n("span",pe,[E(z,{class:"w-5 h-5"})])),a("div",xe,[a("span",ke,v(((d=u.value)==null?void 0:d.name)||"Select an Image Model"),1)])]),t[3]||(t[3]=a("svg",{class:"w-4 h-4 text-gray-400 flex-shrink-0",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor"},[a("path",{"fill-rule":"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z","clip-rule":"evenodd"})],-1))],512),(l(),O(ce,{to:"body"},[E(ue,{"enter-active-class":"transition ease-out duration-100","enter-from-class":"transform opacity-0 scale-95","enter-to-class":"transform opacity-100 scale-100","leave-active-class":"transition ease-in duration-75","leave-from-class":"transform opacity-100 scale-100","leave-to-class":"transform opacity-0 scale-95"},{default:oe(()=>[b.value?w((l(),n("div",{key:0,ref_key:"ttiFloatingRef",ref:I,style:ie(B(P)),class:"z-50 w-80 origin-top-left rounded-md bg-white dark:bg-gray-800 shadow-lg ring-1 ring-black ring-opacity-5 dark:ring-gray-700 focus:outline-none py-1 flex flex-col max-h-[50vh]"},[a("div",we,[w(a("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=e=>x.value=e),onClick:t[2]||(t[2]=A(()=>{},["stop"])),placeholder:"Search TTI models...",class:"input-field-sm w-full"},null,512),[[re,x.value]])]),a("div",Te,[B(p).isLoadingTtiModels?(l(),n("div",Se,"Loading TTI models...")):D.value.length===0?(l(),n("div",Ce,"No TTI models found.")):g("",!0),(l(!0),n(T,null,S(D.value,e=>(l(),n("div",{key:e.label},[a("h4",Me,v(e.label),1),(l(!0),n(T,null,S(e.items,r=>(l(),n("button",{key:r.id,onClick:Xe=>q(r.id),class:F(["menu-item-button",{selected:c.value===r.id}])},[a("div",Oe,[r.icon_base64?(l(),n("img",{key:0,src:r.icon_base64,class:"h-6 w-6 rounded-md object-cover flex-shrink-0"},null,8,Ee)):(l(),O(z,{key:1,class:"w-6 h-6 text-gray-500 dark:text-gray-400 flex-shrink-0"})),a("div",Fe,[a("p",Ve,v(r.name),1)])]),c.value===r.id?(l(),O(de,{key:0,class:"w-5 h-5 text-blue-600 dark:text-blue-400 flex-shrink-0"})):g("",!0)],10,Ie))),128))]))),128))])],4)),[[G,()=>b.value=!1]]):g("",!0)]),_:1})]))])]),c.value&&u.value&&j.value?(l(),n("div",Le,[a("h4",Ue,[t[5]||(t[5]=ve("Configuration for: ")),a("span",$e,v(u.value.name),1)]),y.value.length===0?(l(),n("div",je," This model has no parameters exposed for user configuration. ")):(l(),n("div",De,[(l(!0),n(T,null,S(y.value,e=>(l(),n("div",{key:e.name},[a("label",{for:`tti-param-${e.name}`,class:"block text-sm font-medium capitalize"},v(e.name.replace(/_/g," ")),9,Ne),e.description?(l(),n("p",Re,v(e.description),1)):g("",!0),e.options?w((l(),n("select",{key:1,id:`tti-param-${e.name}`,"onUpdate:modelValue":r=>o.value[e.name]=r,class:"input-field mt-1"},[(l(!0),n(T,null,S(e.options,r=>(l(),n("option",{key:r,value:r},v(r),9,Be))),128))],8,ze)),[[fe,o.value[e.name]]]):["str","int","float"].includes(e.type)?w((l(),n("input",{key:2,type:e.type==="str"?"text":"number",step:e.type==="float"?"0.01":"1",id:`tti-param-${e.name}`,"onUpdate:modelValue":r=>o.value[e.name]=r,class:"input-field mt-1",placeholder:`Default: ${e.default}`},null,8,Ae)),[[me,o.value[e.name]]]):e.type==="bool"?(l(),n("div",Pe,[a("button",{onClick:r=>o.value[e.name]=!o.value[e.name],type:"button",class:F([o.value[e.name]?"bg-blue-600":"bg-gray-200 dark:bg-gray-600","relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out"])},[a("span",{class:F([o.value[e.name]?"translate-x-5":"translate-x-0","pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition-colors duration-200 ease-in-out"])},null,2)],10,Ge)])):g("",!0)]))),128))])),y.value.length>0?(l(),n("div",Je,[a("button",{type:"button",onClick:Y,class:"btn btn-secondary",disabled:h.value},"Reset to Defaults",8,qe)])):g("",!0)])):c.value&&u.value&&!j.value?(l(),n("div",Qe,[E(ge,{class:"w-5 h-5 flex-shrink-0"}),t[6]||(t[6]=a("span",null,"An administrator has locked the parameters for this model alias. Your personal settings will be ignored.",-1))])):g("",!0),a("div",Ye,[a("button",{type:"submit",class:"btn btn-primary",disabled:h.value||!C.value},v(h.value?"Saving...":"Save TTI Settings"),9,He)])],32)])}}},et=H(Ke,[["__scopeId","data-v-de850ba4"]]);export{et as default};
