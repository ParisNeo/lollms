import{u as T,s as P,a as N,c as p,r as v,o as G,a1 as U,b as n,d as r,h as t,g as w,e as f,k as A,l as R,v as Y,F as q,m as Q,n as D,q as C,R as H,U as J,t as _,Q as L,cn as K,j as O,P as W,co as X,a6 as Z,C as ee,c7 as M}from"./index-BRK86JSP.js";import{_ as te}from"./DmWindow-C55KuEmr.js";const se={class:"flex flex-col h-full bg-white dark:bg-gray-900"},ae={class:"p-4 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center shrink-0"},re={key:0,class:"p-4 border-b border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800/50"},ne={class:"flex justify-end gap-2"},oe={class:"flex-1 overflow-y-auto custom-scrollbar"},ie={key:0,class:"p-4 text-center text-gray-500 text-sm"},le={key:1,class:"p-8 text-center text-gray-500"},de={key:2,class:"divide-y divide-gray-100 dark:divide-gray-800"},ue=["onClick"],ce={class:"relative shrink-0"},ge={key:0,class:"w-10 h-10 rounded-full bg-blue-100 dark:bg-blue-900 flex items-center justify-center text-blue-600 dark:text-blue-300"},me={key:2,class:"absolute -top-1 -right-1 w-5 h-5 bg-red-500 text-white text-xs font-bold rounded-full flex items-center justify-center ring-2 ring-white dark:ring-gray-900"},_e={class:"flex-1 min-w-0"},pe={class:"flex justify-between items-baseline mb-0.5"},fe={class:"font-semibold text-sm text-gray-900 dark:text-gray-100 truncate pr-2"},ye={class:"text-[10px] text-gray-400 shrink-0"},he={class:"text-xs text-gray-500 dark:text-gray-400 truncate h-4"},ve={key:0,class:"opacity-90"},be={key:1,class:"italic opacity-50"},xe=["onClick"],ke={key:0,class:"menu-dropdown absolute right-0 mt-1 w-32 bg-white dark:bg-gray-800 rounded shadow-lg border dark:border-gray-700 z-10 py-1"},we=["onClick"],Ce={__name:"ConversationList",props:{modelValue:{type:Number,default:null}},emits:["update:modelValue"],setup(b,{emit:i}){const y=b,d=i,l=T(),x=P(),h=N(),o=p(()=>l.conversations),k=p(()=>l.isLoadingConversations);p(()=>x.user);const c=v(!1),g=v(""),S=v([]);function j(a){if(!a)return"";const s=new Date(a),e=new Date;return s.toDateString()===e.toDateString()?s.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):s.toLocaleDateString()}function F(a){const s=a.partner_user_id||a.id;d("update:modelValue",s)}async function I(){g.value.trim()&&(await l.createGroupConversation(g.value,S.value),c.value=!1,g.value="",S.value=[])}const u=v(null);function B(a){u.value=u.value===a?null:a}function $(a){!a.target.closest(".menu-trigger")&&!a.target.closest(".menu-dropdown")&&(u.value=null)}G(()=>{document.addEventListener("click",$)}),U(()=>{document.removeEventListener("click",$)});async function E(a){const s=!!a.is_group,e=s?`Leave "${a.name}"?`:`Delete conversation with ${a.partner_username}?`,m=s?"You will be removed from this group.":"This will delete the conversation history for you.",{confirmed:z}=await h.showConfirmation({title:e,message:m,confirmText:s?"Leave":"Delete"});if(z){const V=s?a.id:a.partner_user_id;await l.deleteConversation(V,s),u.value=null,y.modelValue===V&&d("update:modelValue",null)}}return(a,s)=>(r(),n("div",se,[t("div",ae,[s[3]||(s[3]=t("h2",{class:"font-bold text-lg text-gray-800 dark:text-gray-200"},"Messages",-1)),t("button",{onClick:s[0]||(s[0]=e=>c.value=!c.value),class:"p-1.5 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800 text-blue-600 dark:text-blue-400",title:"New Group"},[f(A,{class:"w-5 h-5"})])]),c.value?(r(),n("div",re,[R(t("input",{"onUpdate:modelValue":s[1]||(s[1]=e=>g.value=e),type:"text",placeholder:"Group Name",class:"input-field w-full mb-2 text-sm"},null,512),[[Y,g.value]]),t("div",ne,[t("button",{onClick:s[2]||(s[2]=e=>c.value=!1),class:"btn btn-secondary btn-sm"},"Cancel"),t("button",{onClick:I,class:"btn btn-primary btn-sm"},"Create")])])):w("",!0),t("div",oe,[k.value?(r(),n("div",ie,"Loading conversations...")):o.value.length===0?(r(),n("div",le,s[4]||(s[4]=[t("p",null,"No conversations yet.",-1),t("p",{class:"text-xs mt-1"},"Start a chat from your Friends list.",-1)]))):(r(),n("ul",de,[(r(!0),n(q,null,Q(o.value,e=>(r(),n("li",{key:e.id+(e.is_group?"_g":"_u"),class:"relative group"},[t("button",{onClick:m=>F(e),class:D(["w-full p-3 flex items-start gap-3 hover:bg-gray-50 dark:hover:bg-gray-800/50 transition-colors text-left",{"bg-blue-50 dark:bg-blue-900/20":b.modelValue===(e.partner_user_id||e.id)}])},[t("div",ce,[e.is_group?(r(),n("div",ge,[f(H,{class:"w-6 h-6"})])):(r(),C(J,{key:1,username:e.partner_username,icon:e.partner_icon,"size-class":"w-10 h-10"},null,8,["username","icon"])),e.unread_count>0?(r(),n("span",me,_(e.unread_count>9?"9+":e.unread_count),1)):w("",!0)]),t("div",_e,[t("div",pe,[t("h3",fe,_(e.name||e.partner_username),1),t("span",ye,_(j(e.last_message_at)),1)]),t("p",he,[e.last_message?(r(),n("span",ve,_(e.last_message),1)):(r(),n("span",be,"No messages"))])])],10,ue),t("div",{class:D(["absolute right-2 top-8 opacity-0 group-hover:opacity-100 transition-opacity",{"opacity-100":u.value===(e.partner_user_id||e.id)}])},[t("button",{onClick:L(m=>B(e.partner_user_id||e.id),["stop"]),class:"menu-trigger p-1 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-500"},[f(K,{class:"w-4 h-4"})],8,xe),u.value===(e.partner_user_id||e.id)?(r(),n("div",ke,[t("button",{onClick:L(m=>E(e),["stop"]),class:"w-full text-left px-3 py-2 text-xs hover:bg-red-50 dark:hover:bg-red-900/30 text-red-600 dark:text-red-400 flex items-center gap-2"},[(r(),C(W(e.is_group?X:Z),{class:"w-3 h-3"})),O(" "+_(e.is_group?"Leave Group":"Delete"),1)],8,we)])):w("",!0)],2)]))),128))]))])]))}},Se={class:"flex h-full bg-white dark:bg-gray-900 overflow-hidden"},$e={class:"w-80 flex-shrink-0 border-r border-gray-200 dark:border-gray-700 h-full overflow-hidden"},Ve={class:"flex-1 min-w-0 h-full flex flex-col relative"},De={key:1,class:"h-full flex flex-col items-center justify-center text-gray-500 dark:text-gray-400 bg-gray-50 dark:bg-gray-800/50"},Le={class:"p-6 rounded-full bg-gray-100 dark:bg-gray-700 mb-4"},Ne={__name:"MessagesView",setup(b){const i=T(),y=N(),d=p(()=>i.activeConversationUserId),l=p(()=>d.value?i.activeConversations[d.value]:null);function x(h){const o=i.conversations.find(k=>k.partner_user_id===h);o&&i.openConversation({id:o.partner_user_id,username:o.partner_username,icon:o.partner_icon})}return G(()=>{y.setPageTitle({title:"Messages",icon:ee(M)}),i.fetchConversations()}),U(()=>{y.setPageTitle({title:""})}),(h,o)=>(r(),n("div",Se,[t("div",$e,[f(Ce,{"model-value":d.value,"onUpdate:modelValue":x},null,8,["model-value"])]),t("div",Ve,[l.value?(r(),C(te,{key:0,conversation:l.value,class:"h-full"},null,8,["conversation"])):(r(),n("div",De,[t("div",Le,[f(M,{class:"w-12 h-12 text-gray-400 dark:text-gray-500"})]),o[0]||(o[0]=t("h3",{class:"text-lg font-medium text-gray-900 dark:text-gray-200"},"Your Messages",-1)),o[1]||(o[1]=t("p",{class:"mt-1 text-sm"},"Select a conversation from the list to start chatting.",-1))]))])]))}};export{Ne as default};
