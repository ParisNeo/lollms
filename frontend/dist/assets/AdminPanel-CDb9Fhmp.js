import{x as L,B as A,u as T,b as a,e as o,f as t,d as f,F as k,p as w,t as b,C,y as h,w as _,h as m,v as x,q as U,g as I,m as D,i as N,D as S,E as F,a as g,j as p}from"./index-BD_731L5.js";function V(i){if(!i)return"Never";const e=new Date,l=new Date(i),u=Math.floor((e-l)/1e3);if(u<2)return"Just now";if(u<60)return`${u}s ago`;const s=Math.floor(u/60);if(s<60)return`${s}m ago`;const n=Math.floor(s/60);if(n<24)return`${n}h ago`;const d=Math.floor(n/24);return d<7?`${d}d ago`:l.toLocaleDateString()}const M={name:"UserTable",props:{users:{type:Array,required:!0},isLoading:{type:Boolean,default:!1},activeSessions:{type:Array,default:()=>[]}},emits:["delete-user","reset-password","activate-user"],computed:{...A(T,{currentUser:i=>i.user})},methods:{formatTimeAgo:V}},P={class:"overflow-x-auto"},q={class:"min-w-full divide-y dark:divide-gray-600"},z={class:"bg-white dark:bg-gray-800 divide-y dark:divide-gray-700"},E={key:0},O={key:1},R={class:"px-4 py-2 text-xs font-mono text-gray-500 dark:text-gray-400"},j={class:"px-4 py-2 text-sm font-medium text-gray-900 dark:text-gray-100"},B={class:"px-4 py-2 text-sm"},W={key:0,class:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800 dark:bg-green-900/50 dark:text-green-300"},G={key:1,class:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-yellow-100 text-yellow-800 dark:bg-yellow-900/50 dark:text-yellow-300"},K={class:"px-4 py-2 text-sm text-gray-500 dark:text-gray-400"},J={class:"flex items-center space-x-2"},Y={key:0,class:"h-2 w-2 rounded-full bg-green-500 animate-pulse",title:"Online now"},H=["title"],Q={class:"px-4 py-2 text-sm"},X={key:0,class:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800 dark:bg-blue-900/50 dark:text-blue-300"},Z={key:1,class:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-gray-100 text-gray-800 dark:bg-gray-600 dark:text-gray-200"},$=["title"],ee={class:"px-4 py-2 text-sm space-x-2 whitespace-nowrap"},te=["onClick"],se=["onClick","disabled"],ie=["onClick","disabled"];function re(i,e,l,u,s,n){return o(),a("div",P,[t("table",q,[e[2]||(e[2]=t("thead",{class:"bg-gray-50 dark:bg-gray-700"},[t("tr",null,[t("th",{scope:"col",class:"px-4 py-3 text-left text-xs font-medium uppercase tracking-wider"},"ID"),t("th",{scope:"col",class:"px-4 py-3 text-left text-xs font-medium uppercase tracking-wider"},"Username"),t("th",{scope:"col",class:"px-4 py-3 text-left text-xs font-medium uppercase tracking-wider"},"Status"),t("th",{scope:"col",class:"px-4 py-3 text-left text-xs font-medium uppercase tracking-wider"},"Last Seen"),t("th",{scope:"col",class:"px-4 py-3 text-left text-xs font-medium uppercase tracking-wider"},"Admin"),t("th",{scope:"col",class:"px-4 py-3 text-left text-xs font-medium uppercase tracking-wider"},"LLM Model"),t("th",{scope:"col",class:"px-4 py-3 text-left text-xs font-medium uppercase tracking-wider"},"Actions")])],-1)),t("tbody",z,[l.isLoading?(o(),a("tr",E,e[0]||(e[0]=[t("td",{colspan:"7",class:"px-4 py-4 text-center text-sm italic text-gray-500"},"Loading users...",-1)]))):!l.users||l.users.length===0?(o(),a("tr",O,e[1]||(e[1]=[t("td",{colspan:"7",class:"px-4 py-4 text-center text-sm italic text-gray-500"},"No users found.",-1)]))):f("",!0),(o(!0),a(k,null,w(l.users,d=>(o(),a("tr",{key:d.id,class:"hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors duration-150"},[t("td",R,b(d.id),1),t("td",j,b(d.username),1),t("td",B,[d.is_active?(o(),a("span",W,"Active")):(o(),a("span",G,"Inactive"))]),t("td",K,[t("div",J,[l.activeSessions.includes(d.username)?(o(),a("span",Y)):f("",!0),t("span",{title:d.last_activity_at?new Date(d.last_activity_at).toLocaleString():"Never"},b(n.formatTimeAgo(d.last_activity_at)),9,H)])]),t("td",Q,[d.is_admin?(o(),a("span",X,"Yes")):(o(),a("span",Z,"No"))]),t("td",{class:"px-4 py-2 text-xs truncate text-gray-500 dark:text-gray-400",title:d.lollms_model_name},b(d.lollms_model_name||"-"),9,$),t("td",ee,[d.is_active?f("",!0):(o(),a("button",{key:0,onClick:r=>i.$emit("activate-user",d.id),class:"btn btn-success !py-1 !px-2 text-xs",title:"Activate User"},"Activate",8,te)),t("button",{onClick:r=>i.$emit("reset-password",d.id),disabled:d.id===i.currentUser.id,class:"btn btn-secondary !py-1 !px-2 text-xs",title:"Reset Password"},"Reset Pass",8,se),t("button",{onClick:r=>i.$emit("delete-user",d.id),disabled:d.id===i.currentUser.id,class:"btn btn-danger !py-1 !px-2 text-xs",title:"Delete User"},"Delete",8,ie)])]))),128))])])])}const ae=L(M,[["render",re]]),oe={name:"AdminPanel",components:{UserTable:ae},data(){return{users:[],activeSessions:[],isLoadingUsers:!1,newUser:{username:"",password:"",email:"",lollms_model_name:"",safe_store_vectorizer:"",is_admin:!1},settings:{},originalSettings:{},isLoadingSettings:!1,importFile:null,isImporting:!1,activeTab:"users"}},computed:{isSettingsChanged(){var i;for(const e in this.settings)if(this.settings[e]!==((i=this.originalSettings[e])==null?void 0:i.value))return!0;return!1},categorizedSettings(){const i={},e=Object.keys(this.originalSettings).sort();for(const l of e){const u=this.originalSettings[l];i[u.category]||(i[u.category]=[]),i[u.category].push(u)}return i}},created(){this.fetchDataForActiveTab()},methods:{async setActiveTab(i){this.activeTab!==i&&(this.activeTab=i,await this.fetchDataForActiveTab())},async fetchDataForActiveTab(){this.activeTab==="users"?await this.fetchUsers():this.activeTab==="settings"&&await this.fetchSettings()},async fetchUsers(){this.isLoadingUsers=!0;try{const[i,e]=await Promise.all([p.get("/api/admin/users"),p.get("/api/admin/active-sessions")]);this.users=i.data,this.activeSessions=e.data}catch{g().addNotification("Failed to load user data.","error")}finally{this.isLoadingUsers=!1}},async fetchSettings(){this.isLoadingSettings=!0;try{const e=(await p.get("/api/admin/settings")).data,l={},u={};e.forEach(s=>{l[s.key]=s.value,u[s.key]={...s}}),this.settings=l,this.originalSettings=u}catch{g().addNotification("Failed to load global settings.","error")}finally{this.isLoadingSettings=!1}},resetSettings(){const i={};for(const e in this.originalSettings)i[e]=this.originalSettings[e].value;this.settings=i,g().addNotification("Changes have been discarded.","info")},async saveSettings(){const i=g();if(!this.isSettingsChanged){i.addNotification("No changes to save.","info");return}this.isLoadingSettings=!0;try{await p.put("/api/admin/settings",{configs:this.settings}),i.addNotification("Global settings updated successfully.","success",6e3),await this.fetchSettings()}catch{}finally{this.isLoadingSettings=!1}},async addUser(){const i=g();if(!this.newUser.username||!this.newUser.password||!this.newUser.email){i.addNotification("Username, email, and password are required.","warning");return}this.isLoadingUsers=!0;try{await p.post("/api/admin/users",this.newUser),i.addNotification(`User '${this.newUser.username}' created successfully.`,"success"),this.resetNewUserForm(),await this.fetchUsers()}catch{}finally{this.isLoadingUsers=!1}},async deleteUser(i){const e=g();if(confirm("Are you sure you want to delete this user? This will also remove all their data and cannot be undone.")){this.isLoadingUsers=!0;try{await p.delete(`/api/admin/users/${i}`),e.addNotification("User deleted successfully.","success"),await this.fetchUsers()}catch{}finally{this.isLoadingUsers=!1}}},async resetPassword(i){const e=g(),l=prompt("Enter a new password for the user (min 8 characters):");if(!l||l.length<8){e.addNotification("Password reset cancelled or password too short.","warning");return}try{await p.post(`/api/admin/users/${i}/reset-password`,{new_password:l}),e.addNotification("User's password has been reset.","success")}catch{}},async activateUser(i){this.isLoadingUsers=!0;const e=g();try{await p.post(`/api/admin/users/${i}/activate`),e.addNotification("User has been activated successfully.","success"),await this.fetchUsers()}catch{}finally{this.isLoadingUsers=!1}},resetNewUserForm(){this.newUser={username:"",password:"",email:"",lollms_model_name:"",safe_store_vectorizer:"",is_admin:!1}},handleFileSelect(i){this.importFile=i.target.files[0]||null},async handleImport(){const i=g();if(!this.importFile){i.addNotification("Please select a file to import.","warning");return}if(this.importFile.name!=="webui.db"){i.addNotification("Invalid file name. Please select the 'webui.db' file.","error");return}this.isImporting=!0;const e=new FormData;e.append("file",this.importFile);try{const l=await p.post("/api/admin/import-openwebui",e,{headers:{"Content-Type":"multipart/form-data"}});i.addNotification(l.data.message,"success",8e3),this.importFile=null,this.$refs.fileInput&&(this.$refs.fileInput.value="")}catch{}finally{this.isImporting=!1}}}},ne={class:"border-b border-gray-200 dark:border-gray-700 mb-6"},le={class:"-mb-px flex space-x-6","aria-label":"Tabs"},de={key:0},ce={class:"bg-gray-100 dark:bg-gray-700/50 p-4 rounded-lg shadow-sm mb-6"},ue={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"},me={class:"flex items-center"},ge={class:"text-right"},pe=["disabled"],be={class:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm"},fe={class:"flex justify-between items-center mb-3 border-b dark:border-gray-600 pb-2"},ye=["disabled"],xe={key:0},he={key:1},ke={key:1},we={class:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm"},ve={class:"flex justify-between items-center mb-4 border-b dark:border-gray-600 pb-3"},_e={class:"space-x-2"},Ue=["disabled"],Se=["disabled"],Le={key:0},Ae={key:1},Te={key:0,class:"text-center p-8 text-gray-500"},Ce={class:"text-lg font-medium text-gray-900 dark:text-gray-100 mb-4"},Ie={class:"space-y-6 bg-gray-50 dark:bg-gray-700/50 p-4 rounded-md"},De=["for"],Ne={class:"mt-2"},Fe=["for"],Ve=["onUpdate:modelValue","id"],Me={class:"ml-3 text-sm font-medium text-gray-900 dark:text-gray-200"},Pe=["onUpdate:modelValue","id"],qe=["type","step","onUpdate:modelValue","id"],ze={class:"text-xs text-gray-500 dark:text-gray-400 mt-2"},Ee={class:"bg-gray-200 dark:bg-gray-600 px-1 rounded"},Oe={key:2},Re={class:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow-sm"},je={class:"mt-6 border-t border-gray-200 dark:border-gray-700 pt-6"},Be={class:"mt-6"},We={class:"mt-2 flex items-center"},Ge={key:0,class:"mt-2 text-sm text-gray-600 dark:text-gray-400"},Ke={class:"mt-6 flex justify-end"},Je=["disabled"],Ye={key:0},He={key:1};function Qe(i,e,l,u,s,n){const d=C("UserTable");return o(),a("div",null,[e[33]||(e[33]=t("h4",{class:"text-lg font-semibold mb-4"},"Administration",-1)),t("div",ne,[t("nav",le,[t("button",{onClick:e[0]||(e[0]=r=>n.setActiveTab("users")),class:h([[s.activeTab==="users"?"border-blue-500 text-blue-600 dark:border-blue-400 dark:text-blue-300":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-200 dark:hover:border-gray-500"],"whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm transition-colors duration-200"])}," User Management ",2),t("button",{onClick:e[1]||(e[1]=r=>n.setActiveTab("settings")),class:h([[s.activeTab==="settings"?"border-blue-500 text-blue-600 dark:border-blue-400 dark:text-blue-300":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-200 dark:hover:border-gray-500"],"whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm transition-colors duration-200"])}," Global Settings ",2),t("button",{onClick:e[2]||(e[2]=r=>n.setActiveTab("import")),class:h([[s.activeTab==="import"?"border-blue-500 text-blue-600 dark:border-blue-400 dark:text-blue-300":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-200 dark:hover:border-gray-500"],"whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm transition-colors duration-200"])}," Data Import ",2)])]),s.activeTab==="users"?(o(),a("div",de,[t("section",ce,[e[22]||(e[22]=t("h2",{class:"text-md font-semibold mb-3 border-b dark:border-gray-600 pb-2"},"Add New User",-1)),t("form",{onSubmit:e[9]||(e[9]=_((...r)=>n.addUser&&n.addUser(...r),["prevent"])),class:"space-y-4"},[t("div",ue,[t("div",null,[e[16]||(e[16]=t("label",{for:"newUsername",class:"block text-sm font-medium"},"Username",-1)),m(t("input",{type:"text","onUpdate:modelValue":e[3]||(e[3]=r=>s.newUser.username=r),id:"newUsername",required:"",minlength:"3",class:"input-field mt-1"},null,512),[[x,s.newUser.username]])]),t("div",null,[e[17]||(e[17]=t("label",{for:"newEmail",class:"block text-sm font-medium"},"Email",-1)),m(t("input",{type:"email","onUpdate:modelValue":e[4]||(e[4]=r=>s.newUser.email=r),id:"newEmail",required:"",class:"input-field mt-1"},null,512),[[x,s.newUser.email]])]),t("div",null,[e[18]||(e[18]=t("label",{for:"newPassword",class:"block text-sm font-medium"},"Password (min 8 chars)",-1)),m(t("input",{type:"password","onUpdate:modelValue":e[5]||(e[5]=r=>s.newUser.password=r),id:"newPassword",required:"",minlength:"8",class:"input-field mt-1"},null,512),[[x,s.newUser.password]])]),t("div",null,[e[19]||(e[19]=t("label",{for:"newLollmsModel",class:"block text-sm font-medium"},"Default LoLLMs Model (Optional)",-1)),m(t("input",{type:"text","onUpdate:modelValue":e[6]||(e[6]=r=>s.newUser.lollms_model_name=r),id:"newLollmsModel",class:"input-field mt-1",placeholder:"Uses global default if empty"},null,512),[[x,s.newUser.lollms_model_name]])]),t("div",null,[e[20]||(e[20]=t("label",{for:"newSafeStoreVectorizer",class:"block text-sm font-medium"},"Default Vectorizer (Optional)",-1)),m(t("input",{type:"text","onUpdate:modelValue":e[7]||(e[7]=r=>s.newUser.safe_store_vectorizer=r),id:"newSafeStoreVectorizer",class:"input-field mt-1",placeholder:"Uses global default if empty"},null,512),[[x,s.newUser.safe_store_vectorizer]])])]),t("div",me,[m(t("input",{type:"checkbox","onUpdate:modelValue":e[8]||(e[8]=r=>s.newUser.is_admin=r),id:"newUserIsAdmin",class:"h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500"},null,512),[[U,s.newUser.is_admin]]),e[21]||(e[21]=t("label",{for:"newUserIsAdmin",class:"ml-2 block text-sm"},"Grant Administrator Privileges",-1))]),t("div",ge,[t("button",{type:"submit",class:"btn btn-primary",disabled:s.isLoadingUsers},"Add User",8,pe)])],32)]),t("section",be,[t("div",fe,[e[23]||(e[23]=t("h2",{class:"text-md font-semibold"},"Manage Existing Users",-1)),t("button",{onClick:e[10]||(e[10]=(...r)=>n.fetchUsers&&n.fetchUsers(...r)),class:"btn btn-secondary !py-1 !px-2 text-xs",disabled:s.isLoadingUsers},[s.isLoadingUsers?(o(),a("span",xe,"Refreshing...")):(o(),a("span",he,"Refresh List"))],8,ye)]),I(d,{users:s.users,"active-sessions":s.activeSessions,isLoading:s.isLoadingUsers,onDeleteUser:n.deleteUser,onResetPassword:n.resetPassword,onActivateUser:n.activateUser},null,8,["users","active-sessions","isLoading","onDeleteUser","onResetPassword","onActivateUser"])])])):f("",!0),s.activeTab==="settings"?(o(),a("div",ke,[t("section",we,[t("div",ve,[e[24]||(e[24]=t("h2",{class:"text-md font-semibold"},"Application Settings",-1)),t("div",_e,[t("button",{onClick:e[11]||(e[11]=(...r)=>n.resetSettings&&n.resetSettings(...r)),class:"btn btn-secondary",disabled:!n.isSettingsChanged||s.isLoadingSettings},"Reset",8,Ue),t("button",{onClick:e[12]||(e[12]=(...r)=>n.saveSettings&&n.saveSettings(...r)),class:"btn btn-primary",disabled:!n.isSettingsChanged||s.isLoadingSettings},[s.isLoadingSettings?(o(),a("span",Le,"Saving...")):(o(),a("span",Ae,"Save Changes"))],8,Se)])]),s.isLoadingSettings?(o(),a("div",Te," Loading settings... ")):(o(),a("form",{key:1,onSubmit:e[13]||(e[13]=_((...r)=>n.saveSettings&&n.saveSettings(...r),["prevent"])),class:"space-y-8"},[(o(!0),a(k,null,w(n.categorizedSettings,(r,v)=>(o(),a("div",{key:v},[t("h3",Ce,b(v),1),t("div",Ie,[(o(!0),a(k,null,w(r,c=>(o(),a("div",{key:c.key},[t("label",{for:`setting-${c.key}`,class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},b(c.description),9,De),t("div",Ne,[c.type==="boolean"?(o(),a("label",{key:0,for:`setting-${c.key}`,class:"relative inline-flex items-center cursor-pointer"},[m(t("input",{type:"checkbox","onUpdate:modelValue":y=>s.settings[c.key]=y,class:"sr-only peer",id:`setting-${c.key}`},null,8,Ve),[[U,s.settings[c.key]]]),e[25]||(e[25]=t("div",{class:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-600 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-500 peer-checked:bg-blue-600"},null,-1)),t("span",Me,b(s.settings[c.key]?"Enabled":"Disabled"),1)],8,Fe)):c.key==="registration_mode"?m((o(),a("select",{key:1,"onUpdate:modelValue":y=>s.settings[c.key]=y,id:`setting-${c.key}`,class:"input-field max-w-sm"},e[26]||(e[26]=[t("option",{value:"direct"},"Direct (instantly active)",-1),t("option",{value:"admin_approval"},"Admin Approval",-1)]),8,Pe)),[[D,s.settings[c.key]]]):m((o(),a("input",{key:2,type:c.type==="string"?"text":"number",step:c.type==="float"?"0.1":"1","onUpdate:modelValue":y=>s.settings[c.key]=y,id:`setting-${c.key}`,class:"input-field max-w-sm"},null,8,qe)),[[N,s.settings[c.key],void 0,{number:!0}]])]),t("p",ze,[e[27]||(e[27]=S("Key: ")),t("code",Ee,b(c.key),1)])]))),128))])]))),128))],32))])])):f("",!0),s.activeTab==="import"?(o(),a("div",Oe,[t("section",Re,[e[31]||(e[31]=t("h2",{class:"text-xl font-bold leading-6 text-gray-900 dark:text-white"},"Import from OpenWebUI",-1)),e[32]||(e[32]=t("p",{class:"mt-2 max-w-2xl text-sm text-gray-500 dark:text-gray-400"}," Migrate users and their discussion histories from an OpenWebUI instance. ",-1)),t("div",je,[e[30]||(e[30]=F('<div class="prose dark:prose-invert text-sm max-w-none"><p><strong>Instructions:</strong></p><ol><li>Locate your OpenWebUI data directory (e.g., inside the Docker container at <code>/app/backend/data</code>).</li><li>Find the main database file named <strong><code>webui.db</code></strong>.</li><li>Click &quot;Select File&quot; and upload that single <code>webui.db</code> file.</li><li>Click &quot;Start Import&quot;. The process runs in the background and may take several minutes. Check the server logs for detailed progress.</li></ol><p class="font-semibold text-yellow-600 dark:text-yellow-400"> Important: This tool migrates users based on their email. If a user with the same email already exists, their core data will be skipped, but their discussions will still be imported. Passwords will be migrated seamlessly. </p></div>',1)),t("div",Be,[e[29]||(e[29]=t("label",{for:"file-upload",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"}," OpenWebUI Database File ",-1)),t("div",We,[t("input",{ref:"fileInput",onChange:e[14]||(e[14]=(...r)=>n.handleFileSelect&&n.handleFileSelect(...r)),type:"file",accept:".db",class:"block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100 dark:file:bg-blue-900/50 dark:file:text-blue-300 dark:hover:file:bg-blue-900"},null,544)]),s.importFile?(o(),a("div",Ge,[e[28]||(e[28]=S(" Selected: ")),t("strong",null,b(s.importFile.name),1)])):f("",!0)]),t("div",Ke,[t("button",{onClick:e[15]||(e[15]=(...r)=>n.handleImport&&n.handleImport(...r)),disabled:s.isImporting||!s.importFile,class:"btn btn-primary"},[s.isImporting?(o(),a("span",Ye,"Importing...")):(o(),a("span",He,"Start Import"))],8,Je)])])])])):f("",!0)])}const Ze=L(oe,[["render",Qe]]);export{Ze as default};
