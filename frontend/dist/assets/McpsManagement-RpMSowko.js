import{B as ke,ak as xe,ao as Ce,a as Ae,s as ee,r as c,c as w,w as D,o as Me,b as o,e as a,f as s,d as g,A as _,h as u,ap as N,t as v,C as $e,g as Ie,i as x,v as O,T as Se,x as f,F as k,z as C,H as te,y as B,l as L,aq as Re,ar as Te}from"./index-qLYxsC-P.js";import Ue from"./IconArrowUpCircle-xgRNIiRf.js";import Pe from"./IconCode-CXkAmnOL.js";import De from"./IconArrowUp-CJu0NXqx.js";import Ne from"./IconArrowDown-Cqv-z4vk.js";import Le from"./IconGlobeAlt-BSRMCg0S.js";import{A as Ve,a as Ze,_ as ze}from"./AppCardSkeleton-Dd31rUJl.js";const je={class:"space-y-6"},Ee={class:"border-b border-gray-200 dark:border-gray-700"},Oe={class:"-mb-px flex space-x-6","aria-label":"Sub Tabs"},Be={key:0},Fe={class:"flex justify-between items-center mb-4 flex-wrap gap-2"},We={class:"flex items-center gap-2"},qe=["disabled"],He={key:0,class:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm mb-6 overflow-hidden"},Ge={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},Je={class:"md:col-span-2"},Ke={class:"flex justify-end"},Qe=["disabled"],Xe={key:0,class:"text-center p-4"},Ye={key:1,class:"empty-state-card"},et={key:2,class:"space-y-4"},tt={class:"flex-grow truncate"},st={class:"font-semibold"},lt={class:"text-sm text-gray-500 font-mono truncate"},nt={class:"text-xs text-gray-400 mt-1"},at={class:"flex items-center gap-x-2 flex-shrink-0"},ot=["onClick","disabled"],it=["onClick","disabled"],rt={key:1},dt={class:"flex justify-between items-center mb-4 flex-wrap gap-2"},ct=["disabled"],ut={class:"space-y-4"},mt={class:"grid grid-cols-1 lg:grid-cols-3 gap-4"},pt={class:"relative lg:col-span-1"},vt={class:"grid grid-cols-2 lg:col-span-2 gap-4"},ft=["value"],bt={class:"flex items-center gap-2"},gt=["value"],yt={key:0,class:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 2xl:grid-cols-4 gap-6"},_t={key:1,class:"empty-state-card"},ht={key:2},wt={class:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 2xl:grid-cols-4 gap-6"},kt={class:"mt-6 flex justify-between items-center"},xt={class:"text-sm text-gray-500"},Ct={class:"flex gap-2"},At=["disabled"],Mt=["disabled"],$t={key:2},It={class:"flex justify-between items-center mb-4"},St=["disabled"],Rt={key:0,class:"text-center p-10"},Tt={key:1,class:"empty-state-card"},Ut={key:2,class:"space-y-4"},Pt={class:"flex items-center gap-4 flex-grow truncate"},Dt=["src"],Nt={class:"flex-grow truncate"},Lt={class:"font-semibold truncate"},Vt={class:"text-xs text-gray-500 font-mono truncate"},Zt={class:"flex items-center gap-x-2 flex-shrink-0 flex-wrap justify-end"},zt=["onClick"],jt=["href"],Et=["onClick"],Ot=["onClick"],Bt=["onClick"],Ft=["onClick","disabled"],Wt=["onClick","disabled"],qt=["onClick"],Ht={__name:"McpsManagement",setup(Gt){const i=xe(),F=Ce(),m=Ae(),{mcpZooRepositories:W,isLoadingMcpZooRepositories:se,zooMcps:h,isLoadingZooMcps:V,installedApps:le,isLoadingInstalledApps:Z}=ee(i),{tasks:q}=ee(F),p=c("available_items"),y=c({name:"",url:""}),A=c(!1),r=c(null),T=c(""),M=c("All"),$=c("All"),U=c(!1),P=c("last_update_date"),I=c("desc"),S=c(JSON.parse(localStorage.getItem("starredItems")||"[]")),b=c(1),z=c(24);let H=null;const ne=[{value:"last_update_date",label:"Last Updated"},{value:"creation_date",label:"Creation Date"},{value:"name",label:"Name"},{value:"author",label:"Author"}],G=w(()=>h.value.total||0),ae=w(()=>h.value.pages||1),oe=w(()=>{const l=(b.value-1)*z.value+1,t=Math.min(b.value*z.value,G.value);return`Showing ${l}-${t} of ${G.value}`});async function R(){const l={page:b.value,page_size:z.value,sort_by:P.value,sort_order:I.value,category:M.value!=="All"?M.value:void 0,search_query:T.value||void 0,installation_status:$.value!=="All"?$.value:void 0};await i.fetchZooMcps(l)}function ie(){clearTimeout(H),H=setTimeout(()=>{b.value=1,R()},300)}D([p,P,I,M,$],()=>{b.value=1,p.value==="available_items"&&R()}),D(T,ie),D(b,R),D(S,l=>{localStorage.setItem("starredItems",JSON.stringify(l))},{deep:!0}),Me(()=>{i.fetchMcpZooRepositories(),i.fetchInstalledApps(),R()});const re=w(()=>{if(!Array.isArray(h.value.items))return[];const l=new Map,t="Installing MCP: ";return q.value.forEach(e=>{var n;if((n=e==null?void 0:e.name)!=null&&n.startsWith(t)){const d=e.name.replace(t,"");(!l.has(d)||new Date(e.created_at)>new Date(l.get(d).created_at))&&l.set(d,e)}}),h.value.items.map(e=>({...e,task:l.get(e.folder_name)||null}))}),j=w(()=>Array.isArray(W.value)?[...W.value].sort((l,t)=>(l.name||"").localeCompare(t.name||"")):[]),de=w(()=>{if(!Array.isArray(i.zooMcps.items))return["All"];const l=new Set(i.zooMcps.items.map(t=>t.category||"Uncategorized"));return["All",...Array.from(l).sort()]}),E=w(()=>{const t=[...le.value.filter(n=>n.item_type==="mcp")].sort((n,d)=>(n.name||"").localeCompare(d.name||"")),e=new Map;return q.value.forEach(n=>{if(!(n!=null&&n.name))return;let d="";n.name.startsWith("Start app: ")?d=n.name.replace("Start app: ",""):n.name.startsWith("Stop app: ")?d=n.name.replace("Stop app: ",""):n.name.startsWith("Installing ")&&(d=n.name.split(": ")[1]),d&&(n.status==="running"||n.status==="pending")&&(!e.has(d)||new Date(n.created_at)>new Date(e.get(d).created_at))&&e.set(d,n)}),t.map(n=>({...n,task:e.get(n.folder_name)||null}))});function ce(l){const t=S.value.indexOf(l);t>-1?S.value.splice(t,1):S.value.push(l)}function ue(l){return l?new Date(l).toLocaleString():"Never"}async function me(){if(!y.value.name||!y.value.url){m.addNotification("Repository name and URL are required.","warning");return}r.value="add";try{await i.addMcpZooRepository(y.value.name,y.value.url),y.value={name:"",url:""},A.value=!1}finally{r.value=null}}async function pe(l){r.value=l.id;try{await i.pullMcpZooRepository(l.id)}finally{r.value=null}}async function ve(){U.value=!0;try{await i.pullAllMcpZooRepositories()}finally{U.value=!1}}async function fe(l){if(await m.showConfirmation({title:`Delete Repository '${l.name}'?`,message:"This will remove the repository and its cached files. This action cannot be undone.",confirmText:"Delete"})){r.value=l.id;try{await i.deleteMcpZooRepository(l.id)}finally{r.value=null}}}function J(l){m.openModal("appInstall",{app:l,type:"mcps"})}function K(l){const t=h.value.items.find(e=>e.name===l.name);if(!t){m.addNotification(`Could not find details for '${l.name}' in the zoo. Try refreshing repositories.`,"error");return}m.showConfirmation({title:`Update '${l.name}'?`,message:"This will reinstall it with the latest version. It will be stopped. Are you sure?",confirmText:"Update"}).then(e=>{e&&J(t)})}async function Q(l,t){r.value=`${t}-${l}`;try{t==="start"&&await i.startApp(l),t==="stop"&&await i.stopApp(l)}finally{r.value=null}}async function be(l){if(await m.showConfirmation({title:`Uninstall '${l.name}'?`,message:"This will permanently delete all files. This cannot be undone.",confirmText:"Uninstall"})){r.value=`uninstall-${l.id}`;try{await i.uninstallApp(l.id)}finally{r.value=null}}}function ge(l){m.openModal("appDetails",{app:l})}function ye(l){m.openModal("appConfig",{app:l})}function _e(l){m.openModal("serviceRegistration",{item:l,itemType:"mcp",isInstalled:!0})}async function he(l){const t=await i.fetchAppLog(l.id);m.openModal("sourceViewer",{title:`Logs: ${l.name}`,content:t||"No log content found.",language:"log"})}async function we(l){const t=await i.fetchMcpReadme(l.repository,l.folder_name);m.openModal("sourceViewer",{title:`README: ${l.name}`,content:t,language:"markdown"})}async function X(l){await F.cancelTask(l)}function Y(l){m.openModal("tasksManager",{initialTaskId:l})}return(l,t)=>(a(),o("div",je,[s("div",Ee,[s("nav",Oe,[s("button",{onClick:t[0]||(t[0]=e=>p.value="repositories"),class:_(["tab-button",p.value==="repositories"?"active":"inactive"])},"Repositories",2),s("button",{onClick:t[1]||(t[1]=e=>p.value="available_items"),class:_(["tab-button",p.value==="available_items"?"active":"inactive"])},"Available",2),s("button",{onClick:t[2]||(t[2]=e=>p.value="installed_apps"),class:_(["tab-button",p.value==="installed_apps"?"active":"inactive"])},"Installed",2)])]),p.value==="repositories"?(a(),o("section",Be,[s("div",Fe,[t[15]||(t[15]=s("h3",{class:"text-xl font-semibold"},"MCP Zoo Repositories",-1)),s("div",We,[s("button",{onClick:ve,class:"btn btn-secondary",disabled:U.value},[u(N,{class:_(["w-4 h-4",{"animate-spin":U.value}])},null,8,["class"]),t[14]||(t[14]=s("span",{class:"ml-2"},"Pull All",-1))],8,qe),s("button",{onClick:t[3]||(t[3]=e=>A.value=!A.value),class:"btn btn-primary"},v(A.value?"Cancel":"Add Repository"),1)])]),u(Se,{name:"form-fade"},{default:$e(()=>[A.value?(a(),o("div",He,[s("form",{onSubmit:Ie(me,["prevent"]),class:"space-y-4"},[s("div",Ge,[s("div",null,[t[16]||(t[16]=s("label",{for:"repo-name-mcp",class:"block text-sm font-medium"},"Name",-1)),x(s("input",{id:"repo-name-mcp","onUpdate:modelValue":t[4]||(t[4]=e=>y.value.name=e),type:"text",class:"input-field mt-1",placeholder:"e.g., Official MCP Zoo",required:""},null,512),[[O,y.value.name]])]),s("div",Je,[t[17]||(t[17]=s("label",{for:"repo-url-mcp",class:"block text-sm font-medium"},"Git URL",-1)),x(s("input",{id:"repo-url-mcp","onUpdate:modelValue":t[5]||(t[5]=e=>y.value.url=e),type:"url",class:"input-field mt-1",placeholder:"https://github.com/ParisNeo/lollms_mcps_zoo.git",required:""},null,512),[[O,y.value.url]])])]),s("div",Ke,[s("button",{type:"submit",class:"btn btn-primary",disabled:r.value==="add"},v(r.value==="add"?"Adding...":"Add Repository"),9,Qe)])],32)])):g("",!0)]),_:1}),f(se)?(a(),o("div",Xe,"Loading repositories...")):!j.value||j.value.length===0?(a(),o("div",Ye,t[18]||(t[18]=[s("p",null,"No MCP Zoo repositories added.",-1)]))):(a(),o("div",et,[(a(!0),o(k,null,C(j.value,e=>(a(),o("div",{key:e.id,class:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm flex flex-col md:flex-row md:items-center justify-between gap-4"},[s("div",tt,[s("p",st,v(e.name),1),s("p",lt,v(e.url),1),s("p",nt,"Last updated: "+v(ue(e.last_pulled_at)),1)]),s("div",at,[s("button",{onClick:n=>pe(e),class:"btn btn-secondary btn-sm",disabled:r.value===e.id},[u(N,{class:_(["w-4 h-4",{"animate-spin":r.value===e.id}])},null,8,["class"]),t[19]||(t[19]=s("span",{class:"ml-1"},"Pull",-1))],8,ot),e.is_deletable?(a(),o("button",{key:0,onClick:n=>fe(e),class:"btn btn-danger btn-sm",disabled:r.value===e.id},[u(te,{class:"w-4 h-4"})],8,it)):g("",!0)])]))),128))]))])):g("",!0),p.value==="available_items"?(a(),o("section",rt,[s("div",dt,[t[21]||(t[21]=s("h3",{class:"text-xl font-semibold"},"Available MCPs",-1)),s("button",{onClick:R,class:"btn btn-secondary",disabled:f(V)},[u(N,{class:_(["w-4 h-4",{"animate-spin":f(V)}])},null,8,["class"]),t[20]||(t[20]=s("span",{class:"ml-2"},"Rescan",-1))],8,ct)]),s("div",ut,[s("div",mt,[s("div",pt,[x(s("input",{type:"text","onUpdate:modelValue":t[6]||(t[6]=e=>T.value=e),placeholder:"Search MCPs...",class:"input-field w-full pl-10"},null,512),[[O,T.value]]),t[22]||(t[22]=s("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[s("svg",{class:"h-5 w-5 text-gray-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})])],-1))]),s("div",vt,[x(s("select",{"onUpdate:modelValue":t[7]||(t[7]=e=>$.value=e),class:"input-field"},t[23]||(t[23]=[s("option",{value:"All"},"All Statuses",-1),s("option",{value:"Installed"},"Installed",-1),s("option",{value:"Uninstalled"},"Uninstalled",-1)]),512),[[B,$.value]]),x(s("select",{"onUpdate:modelValue":t[8]||(t[8]=e=>M.value=e),class:"input-field"},[(a(!0),o(k,null,C(de.value,e=>(a(),o("option",{key:e,value:e},v(e),9,ft))),128))],512),[[B,M.value]])])]),s("div",bt,[x(s("select",{"onUpdate:modelValue":t[9]||(t[9]=e=>P.value=e),class:"input-field w-48"},[(a(),o(k,null,C(ne,e=>s("option",{key:e.value,value:e.value},"Sort by "+v(e.label),9,gt)),64))],512),[[B,P.value]]),s("button",{onClick:t[10]||(t[10]=e=>I.value=I.value==="asc"?"desc":"asc"),class:"btn btn-secondary p-2"},[I.value==="asc"?(a(),L(De,{key:0,class:"w-5 h-5"})):(a(),L(Ne,{key:1,class:"w-5 h-5"}))])]),f(V)?(a(),o("div",yt,[(a(),o(k,null,C(8,e=>u(Ve,{key:e})),64))])):!f(h).items||f(h).items.length===0?(a(),o("div",_t,t[24]||(t[24]=[s("h4",{class:"font-semibold"},"No MCPs Found",-1),s("p",{class:"text-sm"},"No MCPs match your criteria. Please add and pull a repository or adjust your filters.",-1)]))):(a(),o("div",ht,[s("div",wt,[(a(!0),o(k,null,C(re.value,e=>(a(),L(Ze,{key:`${e.repository}/${e.folder_name}`,app:e,task:e.task,"is-starred":S.value.includes(e.name),onStar:n=>ce(e.name),onInstall:n=>J(e),onUpdate:n=>K(e),onDetails:n=>ge(e),onHelp:n=>we(e),onViewTask:Y,onCancelInstall:n=>X(e.task.id)},null,8,["app","task","is-starred","onStar","onInstall","onUpdate","onDetails","onHelp","onCancelInstall"]))),128))]),s("div",kt,[s("p",xt,v(oe.value),1),s("div",Ct,[s("button",{onClick:t[11]||(t[11]=e=>b.value--),disabled:b.value<=1,class:"btn btn-secondary"},"Previous",8,At),s("button",{onClick:t[12]||(t[12]=e=>b.value++),disabled:b.value>=ae.value,class:"btn btn-secondary"},"Next",8,Mt)])])]))])])):g("",!0),p.value==="installed_apps"?(a(),o("section",$t,[s("div",It,[t[26]||(t[26]=s("h3",{class:"text-xl font-semibold"},"Installed MCPs",-1)),s("button",{onClick:t[13]||(t[13]=(...e)=>f(i).fetchInstalledApps&&f(i).fetchInstalledApps(...e)),class:"btn btn-secondary",disabled:f(Z)},[u(N,{class:_(["w-4 h-4",{"animate-spin":f(Z)}])},null,8,["class"]),t[25]||(t[25]=s("span",{class:"ml-2"},"Refresh",-1))],8,St)]),f(Z)?(a(),o("div",Rt,"Loading...")):!E.value||E.value.length===0?(a(),o("div",Tt,t[27]||(t[27]=[s("h4",{class:"font-semibold"},"No MCPs Installed",-1),s("p",{class:"text-sm"},'Go to "Available" to install an MCP.',-1)]))):(a(),o("div",Ut,[(a(!0),o(k,null,C(E.value,e=>(a(),o("div",{key:e.id,class:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm flex flex-col md:flex-row md:items-center justify-between gap-4"},[s("div",Pt,[e.icon?(a(),o("img",{key:0,src:e.icon,class:"h-10 w-10 rounded-md flex-shrink-0 object-cover",alt:"Icon"},null,8,Dt)):g("",!0),s("div",Nt,[s("p",Lt,v(e.name),1),s("p",Vt,"Port: "+v(e.port),1)])]),s("div",Zt,[e.task?(a(),L(ze,{key:0,task:e.task,onView:n=>Y(e.task.id),onCancel:n=>X(e.task.id)},null,8,["task","onView","onCancel"])):(a(),o(k,{key:1},[e.update_available?(a(),o("button",{key:0,onClick:n=>K(e),class:"btn btn-warning btn-sm p-2",title:"Update"},[u(Ue,{class:"w-5 h-5"})],8,zt)):g("",!0),s("span",{class:_(["px-2 py-1 text-xs font-semibold rounded-full",{"bg-green-100 text-green-800":e.status==="running","bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300":e.status==="stopped","bg-red-100 text-red-800":e.status==="error"}])},v(e.status),3),e.status==="running"&&e.url?(a(),o("a",{key:1,href:e.url,target:"_blank",class:"btn btn-secondary btn-sm p-2",title:"Open"},[u(Le,{class:"w-5 h-5"})],8,jt)):g("",!0),s("button",{onClick:n=>_e(e),class:"btn btn-secondary btn-sm p-2",title:"Edit Registration"},[u(Re,{class:"w-5 h-5"})],8,Et),s("button",{onClick:n=>ye(e),class:"btn btn-secondary btn-sm p-2",title:"Configure"},[u(Te,{class:"w-5 h-5"})],8,Ot),s("button",{onClick:n=>he(e),class:"btn btn-secondary btn-sm p-2",title:"Logs"},[u(Pe,{class:"w-5 h-5"})],8,Bt),e.status!=="running"?(a(),o("button",{key:2,onClick:n=>Q(e.id,"start"),class:"btn btn-success btn-sm p-2",disabled:r.value===`start-${e.id}`,title:"Start"},"Start",8,Ft)):g("",!0),e.status==="running"||e.status==="error"&&e.pid?(a(),o("button",{key:3,onClick:n=>Q(e.id,"stop"),class:"btn btn-warning btn-sm p-2",disabled:r.value===`stop-${e.id}`,title:"Stop"},"Stop",8,Wt)):g("",!0),s("button",{onClick:n=>be(e),class:"btn btn-danger btn-sm p-2",title:"Uninstall"},[u(te,{class:"w-5 h-5"})],8,qt)],64))])]))),128))]))])):g("",!0)]))}},ss=ke(Ht,[["__scopeId","data-v-d4188e51"]]);export{ss as default};
