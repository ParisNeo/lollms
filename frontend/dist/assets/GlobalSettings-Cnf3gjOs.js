import{W as E,G,r as p,k as U,o as M,w as x,c as l,b as n,g as t,f as D,F as S,i as w,t as c,d as F,h as v,v as O,O as L,n as j,j as A,z as B,a1 as R,e as $}from"./index-BLQ4K_Yi.js";const I={class:"bg-white dark:bg-gray-800 shadow-md rounded-lg"},P={class:"space-y-10"},T={class:"text-lg font-medium text-gray-800 dark:text-gray-200 border-b border-gray-200 dark:border-gray-600 pb-2 mb-6"},z={class:"space-y-8"},q={key:0},W=["for"],H=["id","onUpdate:modelValue"],K={key:1},Q=["for"],X=["id","onUpdate:modelValue"],Y={key:2},Z=["for"],ee=["type","step","id","onUpdate:modelValue"],te={key:3},oe={class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},ae={class:"mt-2"},se=["onClick"],re={key:4},le={class:"flex justify-between items-center mb-1"},ne=["for"],de=["onClick"],ie={key:0},ce=["id","onUpdate:modelValue"],ue={key:1,class:"mt-2 p-4 rounded-md bg-gray-50 dark:bg-gray-900/50 border border-gray-200 dark:border-gray-700"},ye={class:"mt-8 pt-5 border-t border-gray-200 dark:border-gray-700"},fe={class:"flex justify-end"},pe=["disabled"],ve={key:1,class:"p-6 text-center"},be={key:2,class:"p-6 text-center"},_e={__name:"GlobalSettings",setup(ke){const i=E(),N=G(),s=p({}),f=p(!1),b=p(!1);let _="{}";const u=p({}),k=U(()=>{const o=i.globalSettings.filter(a=>a.category!=="Email Settings"&&a.category!=="Server"&&a.key!=="password_recovery_mode"),y=["Registration","Authentication","Services","Defaults","Global LLM Overrides"],d=o.reduce((a,h)=>{const m=h.category||"General";return a[m]||(a[m]=[]),a[m].push(h),a},{}),e={};return y.forEach(a=>{d[a]&&(e[a]=d[a])}),Object.keys(d).forEach(a=>{y.includes(a)||(e[a]=d[a])}),e});M(()=>{i.globalSettings.length===0?i.fetchGlobalSettings():g()}),x(()=>i.globalSettings,g,{deep:!0}),x(s,r=>{b.value=JSON.stringify(r)!==_},{deep:!0});function g(){const r={};i.globalSettings.length>0&&(i.globalSettings.forEach(o=>{if(o.type==="json"){try{r[o.key]=JSON.stringify(o.value,null,2)}catch{r[o.key]=o.value}u.value[o.key]=!1}else r[o.key]=o.value}),s.value=r,_=JSON.parse(JSON.stringify(r)),b.value=!1)}function J(r){try{return JSON.parse(s.value[r])}catch(o){return{error:"Invalid JSON format in text editor",details:o.message}}}function V(r){u.value[r]=!u.value[r]}async function C(){f.value=!0;const r=Object.values(k.value).flat(),o={};let y=!1;for(const d of r){const e=d.key;if(s.value.hasOwnProperty(e))if(d.type==="json")try{o[e]=JSON.parse(s.value[e])}catch{N.addNotification(`Invalid JSON format for '${d.description}'. Please fix it before saving.`,"error"),y=!0}else o[e]=s.value[e]}if(y){f.value=!1;return}try{await i.updateGlobalSettings(o),Object.keys(u.value).forEach(d=>u.value[d]=!1)}catch{}finally{f.value=!1}}return(r,o)=>(n(),l("div",I,[o[4]||(o[4]=t("div",{class:"p-6 border-b border-gray-200 dark:border-gray-700"},[t("h3",{class:"text-xl font-semibold leading-6 text-gray-900 dark:text-white"}," Global System Settings "),t("p",{class:"mt-1 text-sm text-gray-500 dark:text-gray-400"}," Manage application-wide settings. Changes may require users to log out and back in. ")],-1)),Object.keys(k.value).length?(n(),l("form",{key:0,onSubmit:D(C,["prevent"]),class:"p-6"},[t("div",P,[(n(!0),l(S,null,w(k.value,(y,d)=>(n(),l("div",{key:d},[t("h4",T,c(d),1),t("div",z,[(n(!0),l(S,null,w(y,e=>(n(),l("div",{key:e.key},[e.key==="registration_mode"?(n(),l("div",q,[t("label",{for:e.key,class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},c(e.description),9,W),v(t("select",{id:e.key,"onUpdate:modelValue":a=>s.value[e.key]=a,class:"input-field mt-1"},o[0]||(o[0]=[t("option",{value:"direct"},"Direct (instantly active)",-1),t("option",{value:"admin_approval"},"Admin Approval",-1)]),8,H),[[O,s.value[e.key]]])])):e.key==="force_model_mode"?(n(),l("div",K,[t("label",{for:e.key,class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},c(e.description),9,Q),v(t("select",{id:e.key,"onUpdate:modelValue":a=>s.value[e.key]=a,class:"input-field mt-1"},o[1]||(o[1]=[t("option",{value:"disabled"},"Disabled",-1),t("option",{value:"force_once"},"Force Once (set user preference)",-1),t("option",{value:"force_always"},"Force Always (override session)",-1)]),8,X),[[O,s.value[e.key]]])])):["string","integer","float"].includes(e.type)?(n(),l("div",Y,[t("label",{for:e.key,class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},c(e.description),9,Z),v(t("input",{type:e.type==="string"?"text":"number",step:e.type==="float"?"0.1":"1",id:e.key,"onUpdate:modelValue":a=>s.value[e.key]=a,class:"input-field mt-1"},null,8,ee),[[L,s.value[e.key]]])])):e.type==="boolean"?(n(),l("div",te,[t("label",oe,c(e.description),1),t("div",ae,[t("button",{onClick:a=>s.value[e.key]=!s.value[e.key],type:"button",class:j([s.value[e.key]?"bg-blue-600":"bg-gray-200 dark:bg-gray-600","relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800"])},[t("span",{class:j([s.value[e.key]?"translate-x-5":"translate-x-0","pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out"])},null,2)],10,se)])])):e.type==="json"?(n(),l("div",re,[t("div",le,[t("label",{for:e.key,class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},c(e.description),9,ne),t("button",{onClick:a=>V(e.key),type:"button",class:"btn btn-secondary btn-xs"},c(u.value[e.key]?"View Rendered":"Edit Raw"),9,de)]),u.value[e.key]?(n(),l("div",ie,[v(t("textarea",{id:e.key,"onUpdate:modelValue":a=>s.value[e.key]=a,rows:"8",class:"input-field w-full font-mono text-xs !leading-relaxed",placeholder:"Enter valid JSON here..."},null,8,ce),[[A,s.value[e.key]]])])):(n(),l("div",ue,[B(R,{json:J(e.key)},null,8,["json"])]))])):F("",!0)]))),128))])]))),128))]),t("div",ye,[t("div",fe,[t("button",{type:"submit",class:"btn btn-primary",disabled:f.value||!b.value},c(f.value?"Saving...":"Save Global Settings"),9,pe)])])],32)):$(i).isLoadingSettings?(n(),l("div",ve,o[2]||(o[2]=[t("p",{class:"text-gray-500"},"Loading settings...",-1)]))):(n(),l("div",be,o[3]||(o[3]=[t("p",{class:"text-gray-500"},"Could not load global settings.",-1)])))]))}};export{_e as default};
