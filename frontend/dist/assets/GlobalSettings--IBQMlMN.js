import{W as U,a as G,r as p,c as L,o as M,w as O,b as l,e as r,f as a,g as A,F as _,y as h,t as i,d as D,i as f,x as g,k as F,z as N,v as B,h as I,a1 as R,q as $}from"./index-BWST0Tav.js";const P={class:"bg-white dark:bg-gray-800 shadow-md rounded-lg"},T={class:"space-y-10"},q={class:"text-lg font-medium text-gray-800 dark:text-gray-200 border-b border-gray-200 dark:border-gray-600 pb-2 mb-6"},z={class:"space-y-8"},W={key:0},H=["for"],K=["id","onUpdate:modelValue"],Q={key:1},X=["for"],Y=["id","onUpdate:modelValue"],Z=["value"],ee={key:2},te=["for"],ae=["id","onUpdate:modelValue"],oe={key:3},se=["for"],le=["type","step","id","onUpdate:modelValue"],re={key:4},ne={class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},de={class:"mt-2"},ie=["onClick"],ue={key:5},ce={class:"flex justify-between items-center mb-1"},ye=["for"],ve=["onClick"],fe={key:0},pe=["id","onUpdate:modelValue"],be={key:1,class:"mt-2 p-4 rounded-md bg-gray-50 dark:bg-gray-900/50 border border-gray-200 dark:border-gray-700"},ke={class:"mt-8 pt-5 border-t border-gray-200 dark:border-gray-700"},me={class:"flex justify-end"},_e=["disabled"],he={key:1,class:"p-6 text-center"},ge={key:2,class:"p-6 text-center"},we={__name:"GlobalSettings",setup(xe){const u=U(),V=G(),s=p({}),v=p(!1),b=p(!1);let x="{}";const c=p({}),j=[{value:0,label:"Beginner"},{value:1,label:"Novice"},{value:2,label:"Intermediate"},{value:3,label:"Advanced"},{value:4,label:"Expert"}],k=L(()=>{const o=u.globalSettings.filter(t=>t.category!=="Email Settings"&&t.category!=="Server"&&t.key!=="password_recovery_mode"),y=["Registration","Defaults","Authentication","Services","Global LLM Overrides"],d=o.reduce((t,w)=>{const m=w.category||"General";return t[m]||(t[m]=[]),t[m].push(w),t},{}),e={};return y.forEach(t=>{d[t]&&(e[t]=d[t])}),Object.keys(d).forEach(t=>{y.includes(t)||(e[t]=d[t])}),e});M(()=>{u.globalSettings.length===0?u.fetchGlobalSettings():S()}),O(()=>u.globalSettings,S,{deep:!0}),O(s,n=>{b.value=JSON.stringify(n)!==x},{deep:!0});function S(){const n={};u.globalSettings.length>0&&(u.globalSettings.forEach(o=>{if(o.type==="json"){try{n[o.key]=JSON.stringify(o.value,null,2)}catch{n[o.key]=o.value}c.value[o.key]=!1}else n[o.key]=o.value}),s.value=n,x=JSON.parse(JSON.stringify(n)),b.value=!1)}function E(n){try{return JSON.parse(s.value[n])}catch(o){return{error:"Invalid JSON format in text editor",details:o.message}}}function J(n){c.value[n]=!c.value[n]}async function C(){v.value=!0;const n=Object.values(k.value).flat(),o={};let y=!1;for(const d of n){const e=d.key;if(s.value.hasOwnProperty(e))if(d.type==="json")try{o[e]=JSON.parse(s.value[e])}catch{V.addNotification(`Invalid JSON format for '${d.description}'. Please fix it before saving.`,"error"),y=!0}else o[e]=s.value[e]}if(y){v.value=!1;return}try{await u.updateGlobalSettings(o),Object.keys(c.value).forEach(d=>c.value[d]=!1)}catch{}finally{v.value=!1}}return(n,o)=>(r(),l("div",P,[o[4]||(o[4]=a("div",{class:"p-6 border-b border-gray-200 dark:border-gray-700"},[a("h3",{class:"text-xl font-semibold leading-6 text-gray-900 dark:text-white"}," Global System Settings "),a("p",{class:"mt-1 text-sm text-gray-500 dark:text-gray-400"}," Manage application-wide settings. Changes may require users to log out and back in. ")],-1)),Object.keys(k.value).length?(r(),l("form",{key:0,onSubmit:A(C,["prevent"]),class:"p-6"},[a("div",T,[(r(!0),l(_,null,h(k.value,(y,d)=>(r(),l("div",{key:d},[a("h4",q,i(d),1),a("div",z,[(r(!0),l(_,null,h(y,e=>(r(),l("div",{key:e.key},[e.key==="registration_mode"?(r(),l("div",W,[a("label",{for:e.key,class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},i(e.description),9,H),f(a("select",{id:e.key,"onUpdate:modelValue":t=>s.value[e.key]=t,class:"input-field mt-1"},o[0]||(o[0]=[a("option",{value:"direct"},"Direct (instantly active)",-1),a("option",{value:"admin_approval"},"Admin Approval",-1)]),8,K),[[g,s.value[e.key]]])])):e.key==="default_user_ui_level"?(r(),l("div",Q,[a("label",{for:e.key,class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},i(e.description),9,X),f(a("select",{id:e.key,"onUpdate:modelValue":t=>s.value[e.key]=t,class:"input-field mt-1"},[(r(),l(_,null,h(j,t=>a("option",{key:t.value,value:t.value},i(t.label),9,Z)),64))],8,Y),[[g,s.value[e.key],void 0,{number:!0}]])])):e.key==="force_model_mode"?(r(),l("div",ee,[a("label",{for:e.key,class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},i(e.description),9,te),f(a("select",{id:e.key,"onUpdate:modelValue":t=>s.value[e.key]=t,class:"input-field mt-1"},o[1]||(o[1]=[a("option",{value:"disabled"},"Disabled",-1),a("option",{value:"force_once"},"Force Once (set user preference)",-1),a("option",{value:"force_always"},"Force Always (override session)",-1)]),8,ae),[[g,s.value[e.key]]])])):["string","integer","float"].includes(e.type)?(r(),l("div",oe,[a("label",{for:e.key,class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},i(e.description),9,se),f(a("input",{type:e.type==="string"?"text":"number",step:e.type==="float"?"0.1":"1",id:e.key,"onUpdate:modelValue":t=>s.value[e.key]=t,class:"input-field mt-1"},null,8,le),[[F,s.value[e.key]]])])):e.type==="boolean"?(r(),l("div",re,[a("label",ne,i(e.description),1),a("div",de,[a("button",{onClick:t=>s.value[e.key]=!s.value[e.key],type:"button",class:N([s.value[e.key]?"bg-blue-600":"bg-gray-200 dark:bg-gray-600","relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800"])},[a("span",{class:N([s.value[e.key]?"translate-x-5":"translate-x-0","pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out"])},null,2)],10,ie)])])):e.type==="json"?(r(),l("div",ue,[a("div",ce,[a("label",{for:e.key,class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},i(e.description),9,ye),a("button",{onClick:t=>J(e.key),type:"button",class:"btn btn-secondary btn-xs"},i(c.value[e.key]?"View Rendered":"Edit Raw"),9,ve)]),c.value[e.key]?(r(),l("div",fe,[f(a("textarea",{id:e.key,"onUpdate:modelValue":t=>s.value[e.key]=t,rows:"8",class:"input-field w-full font-mono text-xs !leading-relaxed",placeholder:"Enter valid JSON here..."},null,8,pe),[[B,s.value[e.key]]])])):(r(),l("div",be,[I(R,{json:E(e.key)},null,8,["json"])]))])):D("",!0)]))),128))])]))),128))]),a("div",ke,[a("div",me,[a("button",{type:"submit",class:"btn btn-primary",disabled:v.value||!b.value},i(v.value?"Saving...":"Save Global Settings"),9,_e)])])],32)):$(u).isLoadingSettings?(r(),l("div",he,o[2]||(o[2]=[a("p",{class:"text-gray-500"},"Loading settings...",-1)]))):(r(),l("div",ge,o[3]||(o[3]=[a("p",{class:"text-gray-500"},"Could not load global settings.",-1)])))]))}};export{we as default};
