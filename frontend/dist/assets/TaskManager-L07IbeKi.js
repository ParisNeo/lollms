import{ai as h,s as w,r as T,o as C,as as I,c as S,b as l,e as r,f as e,p as i,h as x,y as g,aq as D,D as u,E as L,F as y,x as k,t as n,aj as R,d as N}from"./index-CtxbXx-c.js";const j={class:"space-y-6"},B={class:"flex items-center justify-between"},E=["disabled"],M={class:"grid grid-cols-1 md:grid-cols-3 gap-6"},V={class:"md:col-span-1 bg-white dark:bg-gray-800 rounded-lg shadow-sm overflow-hidden"},A={class:"max-h-[60vh] overflow-y-auto"},F={key:0,class:"p-4 text-center text-gray-500"},z={key:1,class:"p-4 text-center text-gray-500"},q={key:2,class:"divide-y dark:divide-gray-700"},O=["onClick"],P={class:"flex justify-between items-center mb-1"},U=["title"],$={class:"w-full bg-gray-200 rounded-full h-1.5 dark:bg-gray-600"},G={class:"md:col-span-2 bg-white dark:bg-gray-800 rounded-lg shadow-sm"},H={key:0,class:"h-full flex items-center justify-center"},J={key:1,class:"flex flex-col h-full"},K={class:"p-4 border-b dark:border-gray-700"},Q={class:"font-semibold truncate"},W={class:"text-xs text-gray-500 dark:text-gray-400"},X={class:"p-4 space-y-2 text-sm"},Y={key:0,class:"text-red-500 p-2 bg-red-50 dark:bg-red-900/20 rounded"},Z={class:"flex-grow p-4 border-t dark:border-gray-700 overflow-hidden flex flex-col"},ee={class:"flex-grow bg-gray-100 dark:bg-gray-900 rounded p-2 overflow-y-auto font-mono text-xs"},te={class:"text-gray-400 mr-2"},le={__name:"TaskManager",setup(se){const o=h(),{tasks:_,isLoadingTasks:c}=w(o),a=T(null);let v;C(()=>{o.fetchTasks(),v=setInterval(o.fetchTasks,5e3)}),I(()=>{clearInterval(v)});const b=S(()=>[..._.value].sort((d,t)=>new Date(t.created_at)-new Date(d.created_at)));function m(d){return d?new Date(d).toLocaleString():"N/A"}function f(d){switch(d){case"running":return{color:"blue",text:"Running"};case"completed":return{color:"green",text:"Completed"};case"failed":return{color:"red",text:"Failed"};case"pending":default:return{color:"gray",text:"Pending"}}}return(d,t)=>(r(),l("div",j,[e("div",B,[t[3]||(t[3]=e("div",null,[e("h2",{class:"text-xl font-bold"},"Background Task Manager"),e("p",{class:"text-sm text-gray-500"},"Monitor and manage background processes like installations.")],-1)),e("div",null,[e("button",{onClick:t[0]||(t[0]=(...s)=>i(o).fetchTasks&&i(o).fetchTasks(...s)),class:"btn btn-secondary mr-2",disabled:i(c)},[x(D,{class:g(["w-4 h-4",{"animate-spin":i(c)}])},null,8,["class"])],8,E),e("button",{onClick:t[1]||(t[1]=(...s)=>i(o).clearCompletedTasks&&i(o).clearCompletedTasks(...s)),class:"btn btn-danger"},[x(L,{class:"w-4 h-4 mr-2"}),t[2]||(t[2]=u(" Clear Completed "))])])]),e("div",M,[e("div",V,[t[4]||(t[4]=e("div",{class:"p-4 border-b dark:border-gray-700"},[e("h3",{class:"font-semibold"},"Tasks")],-1)),e("div",A,[i(c)&&b.value.length===0?(r(),l("div",F,"Loading...")):b.value.length===0?(r(),l("div",z,"No tasks found.")):(r(),l("ul",q,[(r(!0),l(y,null,k(b.value,s=>(r(),l("li",{key:s.id},[e("button",{onClick:p=>a.value=s,class:g(["w-full text-left p-4 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors",{"bg-blue-50 dark:bg-blue-900/30":a.value&&a.value.id===s.id}])},[e("div",P,[e("p",{class:"font-medium truncate",title:s.name},n(s.name),9,U),e("span",{class:g(["text-xs px-2 py-0.5 rounded-full",{"bg-blue-100 text-blue-800 dark:bg-blue-900/50 dark:text-blue-300":s.status==="running","bg-green-100 text-green-800 dark:bg-green-900/50 dark:text-green-300":s.status==="completed","bg-red-100 text-red-800 dark:bg-red-900/50 dark:text-red-300":s.status==="failed","bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300":s.status==="pending"}])},n(f(s.status).text),3)]),e("div",$,[e("div",{class:g(["h-1.5 rounded-full",{"bg-blue-500":s.status==="running","bg-green-500":s.status==="completed","bg-red-500":s.status==="failed"}]),style:R({width:s.progress+"%"})},null,6)])],10,O)]))),128))]))])]),e("div",G,[a.value?(r(),l("div",J,[e("div",K,[e("h3",Q,n(a.value.name),1),e("p",W,"ID: "+n(a.value.id),1)]),e("div",X,[e("p",null,[t[6]||(t[6]=e("strong",null,"Status:",-1)),u(" "+n(f(a.value.status).text),1)]),e("p",null,[t[7]||(t[7]=e("strong",null,"Created:",-1)),u(" "+n(m(a.value.created_at)),1)]),e("p",null,[t[8]||(t[8]=e("strong",null,"Started:",-1)),u(" "+n(m(a.value.started_at)),1)]),e("p",null,[t[9]||(t[9]=e("strong",null,"Completed:",-1)),u(" "+n(m(a.value.completed_at)),1)]),a.value.error?(r(),l("div",Y,[t[10]||(t[10]=e("strong",null,"Error:",-1)),u(" "+n(a.value.error),1)])):N("",!0)]),e("div",Z,[t[11]||(t[11]=e("h4",{class:"font-semibold mb-2 flex-shrink-0"},"Logs",-1)),e("div",ee,[(r(!0),l(y,null,k(a.value.logs,(s,p)=>(r(),l("p",{key:p,class:g({"text-red-500":s.level==="CRITICAL"||s.level==="ERROR"})},[e("span",te,n(new Date(s.timestamp).toLocaleTimeString()),1),e("span",null,n(s.message),1)],2))),128))])])])):(r(),l("div",H,t[5]||(t[5]=[e("p",{class:"text-gray-500"},"Select a task to view its details and logs.",-1)])))])])]))}};export{le as default};
