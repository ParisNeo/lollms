import{bZ as L,ch as S,s as z,c as H,r as d,o as D,W as $,x as O,w as F,q as J,f as V,z as Y,aa as Z,d as n,b as i,h as l,j as G,g as T,t as b,i as K,l as P,v as Q,e as B,ci as X,_ as R,F as A,m as E,n as ee,cj as te}from"./index-DnjdbnqE.js";import{_ as re}from"./PageViewLayout-3HT6v2az.js";const ae={class:"px-3 py-2.5 text-sm font-medium text-gray-500 dark:text-gray-400"},se={class:"text-gray-800 dark:text-gray-200"},le={key:0,class:"text-red-500 dark:text-red-400 ml-1"},ne={class:"relative px-3 mb-4"},oe={class:"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-6"},ie={key:0,class:"px-3 py-5 text-center"},ce={key:1,class:"px-3 py-5 text-center"},ue={key:2,class:"space-y-1"},de={class:"px-3 py-2 text-xs font-semibold uppercase text-gray-500 dark:text-gray-400"},pe={class:"ml-2 border-l border-gray-300 dark:border-gray-600"},ye=["onClick"],ve={key:0,class:"text-xs text-gray-500 dark:text-gray-400 mt-0.5"},he={key:0,class:"text-center py-10"},ge=["innerHTML"],ke={__name:"HelpView",setup(xe){L.setOptions({gfm:!0,breaks:!0,highlight:function(e,t){const a=S.getLanguage(t)?t:"plaintext";return S.highlight(e,{language:a}).value}});const N={heading(e,t,a){const r=e.toLowerCase().replace(/[^\w]+/g,"-");return`
            <h${t} id="${r}">
                ${e}
            </h${t}>`}};L.use({renderer:N});const p=O(),h=Y(),I=z(),f=H(()=>{var e;return((e=I.user)==null?void 0:e.user_ui_level)||0}),U=d(""),m=d([]),q=d(""),C=d(!0),w=d(!0),s=d(""),y=d(null),g=d(null),x=d(null);function k(e){return e.replace(/\*\*(.*?)\*\*/g,"$1")}const M=H(()=>{if(!m.value)return[];const e=s.value.toLowerCase();return m.value.map(a=>{const r=a.items.filter(o=>{const u=k(o.title).toLowerCase().includes(e),_=o.description&&o.description.toLowerCase().includes(e);return u||_}),c=k(a.title).toLowerCase().includes(e);return r.length>0||c?{...a,items:r}:null}).filter(a=>a!==null)});function W(e){const t=e.split(`
`),a=[];let r=null;return t.forEach(c=>{if(c.startsWith("### "))r={title:k(c.substring(4).trim()),items:[]},a.push(r);else if(c.startsWith("*   [")){const o=c.match(/\*   \[\*\*(.*?)\*\*\]\(help\/([^\)#]+)(?:#([^\)]+))?\)\s*-\s*(.*)/);o&&r&&r.items.push({title:k(o[1]),filename:o[2],sectionId:o[3]||null,description:(o[4]||"").trim()})}}),a}async function v(e,t=null){var c,o;C.value=!0;const a=p.query.topic,r=p.query.section;s.value?h.replace({query:{search:s.value}}):e&&(e!==a||t!==r)?h.replace({query:{topic:e,section:t}}):!e&&!s.value&&a&&h.replace({query:{}});try{let u;s.value?(u=await $.get("/api/help/search",{params:{query:s.value}}),y.value=null,g.value=null):(u=await $.get("/api/help/topic",{params:{topic_filename:e}}),y.value=e,g.value=t),q.value=L.parse(u.data),Z(()=>{if(t&&x.value){const _=x.value.querySelector(`#${t.toLowerCase().replace(/[^\w]+/g,"-")}`);_&&_.scrollIntoView({behavior:"smooth",block:"start"})}else x.value&&x.value.scrollTo({top:0,behavior:"smooth"})})}catch(u){q.value=`<p class="text-red-500 dark:text-red-400">Failed to load help content: ${((o=(c=u.response)==null?void 0:c.data)==null?void 0:o.detail)||u.message||"Unknown error"}</p>`,console.error("Error fetching help topic:",u)}finally{C.value=!1}}D(async()=>{w.value=!0;try{const e=await $.get("/api/help/index");U.value=e.data,m.value=W(e.data)}catch(e){console.error("Error fetching help index:",e),m.value=[]}finally{if(w.value=!1,p.query.search)s.value=p.query.search,v(null,null);else if(p.query.topic)v(p.query.topic,p.query.section);else{const e=`level_${f.value}_beginner.md`;v(e)}}}),F(p,e=>{if(e.query.topic!==y.value||e.query.section!==g.value||e.query.search!==s.value){if(e.query.search?s.value=e.query.search:s.value="",e.query.topic)v(e.query.topic,e.query.section);else if(!e.query.search){const t=`level_${f.value}_beginner.md`;v(t)}}},{deep:!0}),F(s,e=>{if(e)h.replace({query:{search:e}}).catch(()=>{}),v(null,null);else if(y.value)h.replace({query:{topic:y.value,section:g.value}}).catch(()=>{}),v(y.value,g.value);else{h.replace({query:{}}).catch(()=>{});const t=`level_${f.value}_beginner.md`;v(t)}});function j(e){s.value="",h.push({query:{topic:e.filename,section:e.sectionId}})}return(e,t)=>(n(),J(re,{title:"Contextual Help","title-icon":te},{sidebar:V(()=>[l("div",ae,[t[2]||(t[2]=G(" Your Current UI Level: ")),l("strong",se,b(f.value),1),K(I).isAdmin?(n(),i("span",le,"(Admin)")):T("",!0)]),t[5]||(t[5]=l("p",{class:"px-3 py-2.5 text-xs text-gray-400 dark:text-gray-500"}," The content displayed here is tailored to your current UI experience level and admin status. ",-1)),l("div",ne,[P(l("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=a=>s.value=a),placeholder:"Search help...",class:"w-full rounded-md border-gray-300 bg-gray-100 dark:border-gray-600 dark:bg-gray-700/50 py-2 pl-10 pr-10 text-sm focus:border-blue-500 focus:ring-blue-500"},null,512),[[Q,s.value]]),l("div",oe,[B(X,{class:"h-4 w-4 text-gray-400"})]),s.value?(n(),i("button",{key:0,onClick:t[1]||(t[1]=a=>s.value=""),class:"absolute inset-y-0 right-0 flex items-center pr-3",title:"Clear search"},[B(R,{class:"h-4 w-4 text-gray-400 hover:text-gray-600"})])):T("",!0)]),w.value?(n(),i("div",ie,t[3]||(t[3]=[l("p",{class:"text-gray-500 dark:text-gray-400"},"Loading help index...",-1)]))):M.value.length===0?(n(),i("div",ce,t[4]||(t[4]=[l("p",{class:"text-gray-500 dark:text-gray-400"},"No topics found matching your search.",-1)]))):(n(),i("ul",ue,[(n(!0),i(A,null,E(M.value,a=>(n(),i("li",{key:a.title},[l("h3",de,b(a.title),1),l("ul",pe,[(n(!0),i(A,null,E(a.items,r=>(n(),i("li",{key:r.filename+(r.sectionId||"")},[l("button",{onClick:c=>j(r),class:ee(["w-full text-left flex flex-col px-3 py-2.5 rounded-lg text-sm font-medium transition-colors",{"bg-blue-100 dark:bg-blue-900/50 text-blue-700 dark:text-blue-300":y.value===r.filename&&(!r.sectionId||g.value===r.sectionId)&&!s.value,"text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700":!(y.value===r.filename&&(!r.sectionId||g.value===r.sectionId)&&!s.value)}])},[l("span",null,b(r.title),1),r.description?(n(),i("span",ve,b(r.description),1)):T("",!0)],10,ye)]))),128))])]))),128))]))]),main:V(()=>[C.value?(n(),i("div",he,t[6]||(t[6]=[l("p",{class:"text-gray-500 dark:text-gray-400"},"Loading help content...",-1)]))):(n(),i("div",{key:1,ref_key:"mainContentAreaRef",ref:x,class:"prose dark:prose-invert max-w-none text-gray-800 dark:text-gray-100"},[l("div",{innerHTML:q.value},null,8,ge)],512))]),_:1}))}};export{ke as default};
