import{B as re,q as de,al as ue,a as ce,s as pe,r as c,c as x,o as ve,w as Z,b as n,e as o,f as t,h as me,i as p,A as h,C as ge,d as k,t as _,g as fe,v as A,y as ye,k as be,E as xe,F as C,z as M,j as he,T as _e,G as J,l as R}from"./index-CoHyQCct.js";import{_ as F}from"./McpCard-QUptZqr5.js";const ke={class:"space-y-10"},we={class:"bg-white dark:bg-gray-800 shadow-md rounded-lg"},Se={class:"px-4 py-5 sm:p-6"},Ae={class:"mt-4 flex items-center justify-between bg-gray-50 dark:bg-gray-700/50 p-4 rounded-md"},Ce={class:"border-b border-gray-200 dark:border-gray-700"},Me={class:"-mb-px flex space-x-6","aria-label":"Tabs"},Ie={key:0,class:"bg-white dark:bg-gray-800 shadow-md rounded-lg"},Te={class:"px-4 py-5 sm:p-6"},Ue={class:"text-xl font-bold leading-6 text-gray-900 dark:text-white capitalize"},Le={class:"border-t border-gray-200 dark:border-gray-700"},De={class:"grid grid-cols-1 sm:grid-cols-2 gap-6"},Ee=["placeholder"],Ne=["placeholder"],$e={class:"mt-2 flex items-center gap-x-4"},Re={class:"h-16 w-16 rounded-md bg-gray-200 dark:bg-gray-700 flex items-center justify-center overflow-hidden"},Fe=["src"],He={key:1,class:"w-8 h-8 text-gray-500 dark:text-gray-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},Pe={class:"flex-grow space-y-2"},je={class:"flex items-center gap-x-3"},Ve={class:"flex items-center justify-between bg-gray-50 dark:bg-gray-700/50 p-3 rounded-md"},Be={class:"space-y-4"},Ge={key:0,class:"mt-1 text-xs text-gray-500 dark:text-gray-400"},Oe={key:1,class:"relative"},Xe=["type"],qe={key:0,xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"w-5 h-5"},ze={key:1,xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"w-5 h-5"},We={key:0,class:"p-4 space-y-4 border rounded-md dark:border-gray-600"},Ke=["readonly"],Ze={class:"mt-2 space-y-2"},Je=["id","value"],Qe=["for"],Ye={key:0},et={class:"mt-1 flex items-center gap-x-3"},tt={class:"text-sm text-gray-500 dark:text-gray-400 flex-grow"},st={class:"flex justify-end items-center gap-x-3 pt-2"},at=["disabled"],lt={class:"flex justify-between items-center mb-4 flex-wrap gap-4"},ot={class:"flex items-center gap-x-3"},nt=["disabled"],it={key:0,class:"empty-state-card"},rt={key:1,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5"},dt={key:2,class:"empty-state-card"},ut={key:3,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5"},ct={class:"flex justify-between items-center mb-4 flex-wrap gap-4"},pt={class:"flex items-center gap-x-3"},vt={key:0,class:"empty-state-card"},mt={key:1,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5"},gt={key:2,class:"empty-state-card"},ft={key:3,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5"},yt={__name:"ServicesSettings",setup(bt){const Q=de(),d=ue(),v=ce(),{mcps:V,apps:B,isLoadingServices:xt,globalSettings:H}=pe(d),i=c("mcps"),w=c({openai_api_service_enabled:!1}),Y=[{id:"email",label:"Email Address"},{id:"first_name",label:"First Name"},{id:"family_name",label:"Family Name"},{id:"birth_date",label:"Birth Date"}],P=(s="mcps")=>({name:"",client_id:"",url:"",icon:"",active:!0,type:"system",authentication_type:"none",authentication_key:"",sso_redirect_uri:"",sso_user_infos_to_share:[]}),l=c(P()),u=c(null),I=c(!1),T=c(!1),S=c(!1),G=c(null),j=c(!1),U=c(!1),L=x({get:()=>w.value.openai_api_service_enabled,set:s=>{w.value.openai_api_service_enabled!==s&&(w.value.openai_api_service_enabled=s,ee())}});function O(){const s=H.value.find(e=>e.key==="openai_api_service_enabled");s&&(w.value.openai_api_service_enabled=s.value)}async function ee(){await d.updateGlobalSettings({openai_api_service_enabled:w.value.openai_api_service_enabled})}ve(()=>{d.fetchMcps(),d.fetchApps(),H.value.length>0&&O()}),Z(H,O,{deep:!0}),Z(()=>l.value.icon,()=>{j.value=!1});const m=x(()=>u.value!==null),X=x(()=>V.value.filter(s=>s.type==="system").sort((s,e)=>s.name.localeCompare(e.name))),q=x(()=>V.value.filter(s=>s.type==="user").sort((s,e)=>s.name.localeCompare(e.name))),z=x(()=>B.value.filter(s=>s.type==="system").sort((s,e)=>s.name.localeCompare(e.name))),W=x(()=>B.value.filter(s=>s.type==="user").sort((s,e)=>s.name.localeCompare(e.name))),te=x(()=>l.value.authentication_type==="lollms_sso");function K(s){m.value&&E(),i.value=s,l.value=P(s),U.value=!0,window.scrollTo({top:0,behavior:"smooth"})}function D(s,e){i.value=e,u.value={...s,_type:e},l.value.name=s.name,l.value.url=s.url,l.value.icon=s.icon||"",l.value.active=typeof s.active=="boolean"?s.active:!0,l.value.type=s.type,l.value.authentication_type=s.authentication_type||"none",l.value.authentication_key="",l.value.sso_redirect_uri=s.sso_redirect_uri||"",l.value.sso_user_infos_to_share=s.sso_user_infos_to_share||[],U.value=!0,window.scrollTo({top:0,behavior:"smooth"})}function E(){u.value=null,l.value=P(i.value),S.value=!1,U.value=!1}function se(){j.value=!0}async function ae(){if(!l.value.name||!l.value.url){v.addNotification("Name and URL are required.","warning");return}I.value=!0;try{const s={...l.value},e=i.value==="apps";m.value?await(e?d.updateApp(u.value.id,s):d.updateMcp(u.value.id,s)):await(e?d.addApp(s):d.addMcp(s)),E()}finally{I.value=!1}}async function N(s,e){await v.showConfirmation({title:`Delete '${s.name}'?`,message:`This will permanently remove this ${e==="mcps"?"MCP server":"Application"} for all users. This cannot be undone.`,confirmText:"Delete"})&&(u.value&&u.value.id===s.id&&E(),await(e==="apps"?d.deleteApp(s.id):d.deleteMcp(s.id)))}async function le(s,e){if(await v.showConfirmation({title:"Generate New Secret?",message:`This will generate a new SSO secret for '${s.name}'. Any existing application using the old secret will no longer be able to authenticate. This action is irreversible.`,confirmText:"Generate Secret"})){const g=await(e==="apps"?d.generateAppSsoSecret(s.id):d.generateMcpSsoSecret(s.id));g&&v.openModal("passwordResetLink",{title:"New SSO Secret Generated",message:`This is the new SSO secret for '${s.name}'. Copy it now, as you will not be able to see it again.`,link:g,copyButtonText:"Copy Secret"})}}async function oe(){T.value=!0;try{await Q.triggerMcpReload()}finally{T.value=!1}}function ne(){G.value.click()}function ie(s){const e=s.target.files[0];if(!e)return;if(!["image/jpeg","image/png","image/gif","image/webp","image/svg+xml"].includes(e.type)){v.addNotification("Invalid file type. Please select an image.","error");return}if(e.type==="image/svg+xml"){const g=new FileReader;g.onload=f=>{l.value.icon=f.target.result},g.onerror=()=>{v.addNotification("Failed to read the SVG file.","error")},g.readAsDataURL(e),s.target.value="";return}const r=new FileReader;r.onload=g=>{const f=new Image;f.onload=()=>{let y=f.width,b=f.height;y>b?y>128&&(b=Math.round(b*(128/y)),y=128):b>128&&(y=Math.round(y*(128/b)),b=128);const $=document.createElement("canvas");$.width=y,$.height=b,$.getContext("2d").drawImage(f,0,0,y,b),l.value.icon=$.toDataURL("image/png")},f.onerror=()=>{v.addNotification("Failed to load image for processing.","error")},f.src=g.target.result},r.onerror=()=>{v.addNotification("Failed to read the file.","error")},r.readAsDataURL(e),s.target.value=""}return(s,e)=>(o(),n("div",ke,[t("div",we,[t("div",Se,[e[18]||(e[18]=t("h3",{class:"text-xl font-bold leading-6 text-gray-900 dark:text-white"},"OpenAI-Compatible API",-1)),t("div",Ae,[e[17]||(e[17]=t("span",{class:"flex-grow flex flex-col pr-4"},[t("span",{class:"text-sm font-medium text-gray-900 dark:text-gray-100"},"Enable API Service"),t("span",{class:"text-xs text-gray-500 dark:text-gray-400"}," Allows users to generate and use API keys to connect with this backend as if it were an OpenAI server. ")],-1)),t("button",{onClick:e[0]||(e[0]=a=>L.value=!L.value),type:"button",class:h([L.value?"bg-blue-600":"bg-gray-200 dark:bg-gray-600","relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800"])},[t("span",{class:h([L.value?"translate-x-5":"translate-x-0","pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out"])},null,2)],2)])])]),t("div",Ce,[t("nav",Me,[t("button",{onClick:e[1]||(e[1]=a=>i.value="mcps"),class:h(["tab-button",i.value==="mcps"?"active":"inactive"])}," MCP Servers ",2),t("button",{onClick:e[2]||(e[2]=a=>i.value="apps"),class:h(["tab-button",i.value==="apps"?"active":"inactive"])}," Applications ",2)])]),me(_e,{name:"form-fade"},{default:ge(()=>[U.value?(o(),n("div",Ie,[t("div",Te,[t("h2",Ue,_(m.value?"Edit":"Add New")+" "+_(i.value==="mcps"?"MCP Server":"Application"),1)]),t("div",Le,[t("form",{onSubmit:fe(ae,["prevent"]),class:"p-4 sm:p-6 space-y-6"},[t("div",De,[t("div",null,[e[19]||(e[19]=t("label",{for:"formName",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Name",-1)),p(t("input",{type:"text",id:"formName","onUpdate:modelValue":e[3]||(e[3]=a=>l.value.name=a),class:"input-field mt-1",placeholder:i.value==="mcps"?"My Local Server":"My Web App",required:""},null,8,Ee),[[A,l.value.name]])]),t("div",null,[e[20]||(e[20]=t("label",{for:"formUrl",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"URL",-1)),p(t("input",{type:"url",id:"formUrl","onUpdate:modelValue":e[4]||(e[4]=a=>l.value.url=a),class:"input-field mt-1",placeholder:i.value==="mcps"?"http://127.0.0.1:9602":"https://example.com",required:""},null,8,Ne),[[A,l.value.url]])])]),t("div",null,[e[22]||(e[22]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Icon (Optional)",-1)),t("div",$e,[t("div",Re,[l.value.icon&&!j.value?(o(),n("img",{key:0,src:l.value.icon,onError:se,alt:"Icon Preview",class:"h-full w-full object-cover"},null,40,Fe)):(o(),n("svg",He,e[21]||(e[21]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M21.75 17.25v-.228a4.5 4.5 0 0 0-.12-1.03l-2.268-9.64a3.375 3.375 0 0 0-3.285-2.602H7.923a3.375 3.375 0 0 0-3.285 2.602l-2.268 9.64a4.5 4.5 0 0 0-.12 1.03v.228m19.5 0a3 3 0 0 1-3 3H5.25a3 3 0 0 1-3-3m19.5 0a3 3 0 0 0-3-3H5.25a3 3 0 0 0-3 3m16.5 0h.008v.008h-.008v-.008Z"},null,-1)])))]),t("div",Pe,[p(t("input",{type:"text","onUpdate:modelValue":e[5]||(e[5]=a=>l.value.icon=a),class:"input-field",placeholder:"Paste image URL or upload a file"},null,512),[[A,l.value.icon]]),t("div",je,[t("button",{onClick:ne,type:"button",class:"btn btn-secondary text-sm"},"Upload File"),l.value.icon?(o(),n("button",{key:0,onClick:e[6]||(e[6]=a=>l.value.icon=""),type:"button",class:"text-sm font-medium text-red-600 hover:text-red-500"},"Remove")):k("",!0)])])]),t("input",{type:"file",ref_key:"fileInput",ref:G,onChange:ie,class:"hidden",accept:"image/png, image/jpeg, image/gif, image/webp, image/svg+xml"},null,544)]),t("div",Ve,[e[23]||(e[23]=t("span",{class:"flex-grow flex flex-col"},[t("span",{class:"text-sm font-medium text-gray-900 dark:text-gray-100"},"Active"),t("span",{class:"text-sm text-gray-500 dark:text-gray-400"},"Inactive items cannot be used.")],-1)),t("button",{onClick:e[7]||(e[7]=a=>l.value.active=!l.value.active),type:"button",class:h([l.value.active?"bg-blue-600":"bg-gray-200 dark:bg-gray-600","relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800"])},[t("span",{class:h([l.value.active?"translate-x-5":"translate-x-0","pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out"])},null,2)],2)]),t("fieldset",Be,[e[28]||(e[28]=t("legend",{class:"text-sm font-medium text-gray-700 dark:text-gray-300"},"Authentication",-1)),p(t("select",{id:"formAuthType","onUpdate:modelValue":e[8]||(e[8]=a=>l.value.authentication_type=a),class:"input-field"},e[24]||(e[24]=[t("option",{value:"none"},"None",-1),t("option",{value:"lollms_sso"},"LoLLMs SSO",-1),t("option",{value:"lollms_chat_auth"},"LoLLMs Chat Auth",-1),t("option",{value:"bearer"},"Bearer Token",-1)]),512),[[ye,l.value.authentication_type]]),l.value.authentication_type==="lollms_chat_auth"?(o(),n("p",Ge," A temporary token will be generated by LoLLMs for each session. ")):k("",!0),l.value.authentication_type==="bearer"?(o(),n("div",Oe,[e[27]||(e[27]=t("label",{for:"formKey",class:"sr-only"},"Authentication Key",-1)),p(t("input",{type:S.value?"text":"password",id:"formKey","onUpdate:modelValue":e[9]||(e[9]=a=>l.value.authentication_key=a),class:"input-field pr-10",placeholder:"Paste your Bearer token here"},null,8,Xe),[[be,l.value.authentication_key]]),t("button",{type:"button",onClick:e[10]||(e[10]=a=>S.value=!S.value),class:"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600 dark:hover:text-gray-200"},[S.value?(o(),n("svg",ze,e[26]||(e[26]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M3.98 8.223A10.477 10.477 0 001.934 12C3.226 16.338 7.244 19.5 12 19.5c.993 0 1.953-.138 2.863-.395M6.228 6.228A10.45 10.45 0 0112 4.5c4.756 0 8.773 3.162 10.065 7.498a10.523 10.523 0 01-4.293 5.774M6.228 6.228L3 3m3.228 3.228l3.65 3.65m7.894 7.894L21 21m-3.228-3.228l-3.65-3.65m0 0a3 3 0 10-4.243-4.243m4.243 4.243L6.228 6.228"},null,-1)]))):(o(),n("svg",qe,e[25]||(e[25]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M2.036 12.322a1.012 1.012 0 010-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178z"},null,-1),t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"},null,-1)])))])])):k("",!0)]),te.value?(o(),n("div",We,[e[35]||(e[35]=t("h4",{class:"font-medium text-gray-800 dark:text-gray-200"},"SSO Configuration",-1)),t("div",null,[e[29]||(e[29]=t("label",{for:"ssoClientId",class:"block text-sm font-medium"},"Client ID",-1)),p(t("input",{type:"text",id:"ssoClientId","onUpdate:modelValue":e[11]||(e[11]=a=>l.value.client_id=a),class:h(["input-field mt-1",{"bg-gray-100 dark:bg-gray-700":m.value&&u.value.client_id}]),readonly:m.value&&u.value.client_id,placeholder:"e.g., my_cool_app_v1 (optional)"},null,10,Ke),[[A,l.value.client_id]]),e[30]||(e[30]=t("p",{class:"mt-1 text-xs text-gray-500 dark:text-gray-400"},[xe(" A unique identifier for this application. URL-safe characters only. If left blank, one will be generated from the name. "),t("strong",{class:"font-semibold"},"Cannot be changed after creation.")],-1))]),t("div",null,[e[31]||(e[31]=t("label",{for:"ssoRedirectUri",class:"block text-sm font-medium"},"Redirect URI",-1)),p(t("input",{type:"url",id:"ssoRedirectUri","onUpdate:modelValue":e[12]||(e[12]=a=>l.value.sso_redirect_uri=a),class:"input-field mt-1",placeholder:"https://yourapp.com/lollms_auth",required:""},null,512),[[A,l.value.sso_redirect_uri]]),e[32]||(e[32]=t("p",{class:"mt-1 text-xs text-gray-500 dark:text-gray-400"},"The URL where users are sent after successful authentication.",-1))]),t("div",null,[e[33]||(e[33]=t("label",{class:"block text-sm font-medium"},"User Info to Share",-1)),t("div",Ze,[(o(),n(C,null,M(Y,a=>t("div",{key:a.id,class:"flex items-center"},[p(t("input",{id:`sso-info-${a.id}`,type:"checkbox",value:a.id,"onUpdate:modelValue":e[13]||(e[13]=r=>l.value.sso_user_infos_to_share=r),class:"h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500"},null,8,Je),[[he,l.value.sso_user_infos_to_share]]),t("label",{for:`sso-info-${a.id}`,class:"ml-2 text-sm text-gray-700 dark:text-gray-300"},_(a.label),9,Qe)])),64))])]),m.value?(o(),n("div",Ye,[e[34]||(e[34]=t("label",{class:"block text-sm font-medium"},"SSO Secret",-1)),t("div",et,[t("p",tt,_(u.value.sso_secret_exists?"A secret is configured.":"No secret has been generated."),1),t("button",{type:"button",onClick:e[14]||(e[14]=a=>le(u.value,i.value)),class:"btn btn-secondary text-sm"},_(u.value.sso_secret_exists?"Regenerate Secret":"Generate Secret"),1)])])):k("",!0)])):k("",!0),t("div",st,[t("button",{onClick:E,type:"button",class:"btn btn-secondary"},"Cancel"),t("button",{type:"submit",class:"btn btn-primary",disabled:I.value},_(I.value?m.value?"Saving...":"Adding...":m.value?"Save Changes":"Add"),9,at)])],32)])])):k("",!0)]),_:1}),p(t("section",null,[t("div",lt,[e[36]||(e[36]=t("h3",{class:"text-xl font-bold leading-6 text-gray-900 dark:text-white"},"System MCPs",-1)),t("div",ot,[t("button",{onClick:oe,disabled:T.value,class:"btn btn-secondary text-sm"},_(T.value?"Reloading...":"Reload MCPs"),9,nt),t("button",{onClick:e[15]||(e[15]=a=>K("mcps")),class:"btn btn-primary text-sm"},"+ Add System Server")])]),X.value.length===0?(o(),n("div",it,e[37]||(e[37]=[t("p",null,"No system-wide MCP servers are defined.",-1)]))):(o(),n("div",rt,[(o(!0),n(C,null,M(X.value,a=>(o(),R(F,{key:a.id,mcp:a,"is-editable":"",onEdit:r=>D(a,"mcps"),onDelete:r=>N(a,"mcps")},null,8,["mcp","onEdit","onDelete"]))),128))])),e[39]||(e[39]=t("h3",{class:"text-xl font-bold leading-6 text-gray-900 dark:text-white mt-8 mb-4"},"User-defined MCPs",-1)),q.value.length===0?(o(),n("div",dt,e[38]||(e[38]=[t("p",null,"No users have added personal MCP servers yet.",-1)]))):(o(),n("div",ut,[(o(!0),n(C,null,M(q.value,a=>(o(),R(F,{key:a.id,mcp:a,"is-editable":"",onEdit:r=>D(a,"mcps"),onDelete:r=>N(a,"mcps")},null,8,["mcp","onEdit","onDelete"]))),128))]))],512),[[J,i.value==="mcps"]]),p(t("section",null,[t("div",ct,[e[40]||(e[40]=t("h3",{class:"text-xl font-bold leading-6 text-gray-900 dark:text-white"},"System Apps",-1)),t("div",pt,[t("button",{onClick:e[16]||(e[16]=a=>K("apps")),class:"btn btn-primary text-sm"},"+ Add System App")])]),z.value.length===0?(o(),n("div",vt,e[41]||(e[41]=[t("p",null,"No system-wide Apps are available.",-1)]))):(o(),n("div",mt,[(o(!0),n(C,null,M(z.value,a=>(o(),R(F,{key:a.id,mcp:a,"is-editable":"",onEdit:r=>D(a,"apps"),onDelete:r=>N(a,"apps")},null,8,["mcp","onEdit","onDelete"]))),128))])),e[43]||(e[43]=t("h3",{class:"text-xl font-bold leading-6 text-gray-900 dark:text-white mt-8 mb-4"},"User-defined Apps",-1)),W.value.length===0?(o(),n("div",gt,e[42]||(e[42]=[t("p",null,"No users have added personal Apps yet.",-1)]))):(o(),n("div",ft,[(o(!0),n(C,null,M(W.value,a=>(o(),R(F,{key:a.id,mcp:a,"is-editable":"",onEdit:r=>D(a,"apps"),onDelete:r=>N(a,"apps")},null,8,["mcp","onEdit","onDelete"]))),128))]))],512),[[J,i.value==="apps"]])]))}},At=re(yt,[["__scopeId","data-v-430b765e"]]);export{At as default};
