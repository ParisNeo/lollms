import{a2 as xe,a5 as Ce,aj as Ae,m as Me,a6 as se,f as d,c as w,ae as D,a7 as Se,a as o,o as n,e as s,h as v,a4 as h,j as c,ak as N,t as f,w as $e,ad as Ie,g as C,v as W,ai as Re,a8 as y,F as k,i as A,s as ae,af as B,b as L,al as Te,am as Ue,an as Pe}from"./index-VJ8TL8ZV.js";import De from"./IconArrowUpCircle-B6Pyjus8.js";import Ne from"./IconArrowUp-YolPxyQS.js";import Le from"./IconArrowDown-C9bwTeg-.js";import Ve from"./IconGlobeAlt-QtUnsUj8.js";import{A as je,a as Ze,_ as ze}from"./AppCardSkeleton-DXcDsO_Y.js";const Ee={class:"space-y-6"},Oe={class:"border-b border-gray-200 dark:border-gray-700"},Fe={class:"-mb-px flex space-x-6","aria-label":"Sub Tabs"},We={key:0},Be={class:"flex justify-between items-center mb-4 flex-wrap gap-2"},qe={class:"flex items-center gap-2"},Ge=["disabled"],He={key:0,class:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm mb-6 overflow-hidden"},Je={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},Ke={class:"md:col-span-2"},Qe={class:"flex justify-end"},Xe=["disabled"],Ye={key:0,class:"text-center p-4"},et={key:1,class:"empty-state-card"},tt={key:2,class:"space-y-4"},st={class:"flex-grow truncate"},at={class:"font-semibold"},lt={class:"text-sm text-gray-500 font-mono truncate"},nt={class:"text-xs text-gray-400 mt-1"},ot={class:"flex items-center gap-x-2 flex-shrink-0"},it=["onClick","disabled"],rt=["onClick","disabled"],dt={key:1},ct={class:"flex justify-between items-center mb-4 flex-wrap gap-2"},ut=["disabled"],mt={class:"space-y-4"},pt={class:"grid grid-cols-1 lg:grid-cols-3 gap-4"},vt={class:"relative lg:col-span-1"},ft={class:"grid grid-cols-2 lg:col-span-2 gap-4"},bt=["value"],gt={class:"flex items-center gap-2"},yt=["value"],_t={key:0,class:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 2xl:grid-cols-4 gap-6"},ht={key:1,class:"empty-state-card"},wt={key:2},kt={class:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 2xl:grid-cols-4 gap-6"},xt={key:0,class:"mt-6 flex justify-between items-center"},Ct={class:"text-sm text-gray-500"},At={class:"flex gap-2"},Mt=["disabled"],St=["disabled"],$t={key:2},It={class:"flex justify-between items-center mb-4"},Rt=["disabled"],Tt={key:0,class:"text-center p-10"},Ut={key:1,class:"empty-state-card"},Pt={key:2,class:"space-y-4"},Dt={class:"flex items-center gap-4 flex-grow truncate"},Nt=["src"],Lt={class:"flex-grow truncate"},Vt={class:"font-semibold truncate"},jt={class:"text-xs text-gray-500 font-mono truncate"},Zt={class:"flex items-center gap-x-2 flex-shrink-0 flex-wrap justify-end"},zt=["onClick"],Et=["href"],Ot=["onClick"],Ft=["onClick"],Wt=["onClick"],Bt=["onClick","disabled"],qt=["onClick","disabled"],Gt=["onClick"],Ht={__name:"McpsManagement",setup(Jt){const i=Ce(),q=Ae(),u=Me(),{mcpZooRepositories:G,isLoadingMcpZooRepositories:le,zooMcps:M,isLoadingZooMcps:V,installedApps:ne,isLoadingInstalledApps:j}=se(i),{tasks:H}=se(q),p=d("available_items"),g=d({name:"",url:""}),S=d(!1),r=d(null),T=d(""),_=d("All"),$=d("All"),U=d(!1),P=d("last_update_date"),I=d("desc"),x=d(JSON.parse(localStorage.getItem("starredItems")||"[]")),b=d(1),Z=d(24);let J=null;const oe=[{value:"last_update_date",label:"Last Updated"},{value:"creation_date",label:"Creation Date"},{value:"name",label:"Name"},{value:"author",label:"Author"}],K=w(()=>M.value.total||0),ie=w(()=>M.value.pages||1),re=w(()=>{const a=(b.value-1)*Z.value+1,t=Math.min(b.value*Z.value,K.value);return`Showing ${a}-${t} of ${K.value}`});async function R(){if(_.value==="Starred")return;const a={page:b.value,page_size:Z.value,sort_by:P.value,sort_order:I.value,category:_.value!=="All"?_.value:void 0,search_query:T.value||void 0,installation_status:$.value!=="All"?$.value:void 0};await i.fetchZooMcps(a)}function de(){clearTimeout(J),J=setTimeout(()=>{b.value=1,R()},300)}D([p,P,I,_,$],()=>{b.value=1,p.value==="available_items"&&R()}),D(T,de),D(b,R),D(x,a=>{localStorage.setItem("starredItems",JSON.stringify(a))},{deep:!0}),Se(()=>{i.fetchMcpZooRepositories(),i.fetchInstalledApps(),R()});const z=w(()=>{if(!Array.isArray(M.value.items))return[];let a=M.value.items;_.value==="Starred"&&(a=a.filter(l=>x.value.includes(l.name)));const t=new Map,e="Installing MCP: ";return H.value.forEach(l=>{var m;if((m=l==null?void 0:l.name)!=null&&m.startsWith(e)){const F=l.name.replace(e,"");(!t.has(F)||new Date(l.created_at)>new Date(t.get(F).created_at))&&t.set(F,l)}}),a.map(l=>({...l,task:t.get(l.folder_name)||null}))}),E=w(()=>Array.isArray(G.value)?[...G.value].sort((a,t)=>(a.name||"").localeCompare(t.name||"")):[]),ce=w(()=>{if(!Array.isArray(i.zooMcps.items))return["All","Starred"];const a=new Set(i.zooMcps.items.map(t=>t.category||"Uncategorized"));return["All","Starred",...Array.from(a).sort()]}),O=w(()=>{const t=[...ne.value.filter(l=>l.item_type==="mcp")].sort((l,m)=>(l.name||"").localeCompare(m.name||"")),e=new Map;return H.value.forEach(l=>{if(!(l!=null&&l.name))return;let m="";l.name.startsWith("Start app: ")?m=l.name.replace("Start app: ",""):l.name.startsWith("Stop app: ")?m=l.name.replace("Stop app: ",""):l.name.startsWith("Installing ")&&(m=l.name.split(": ")[1]),m&&(l.status==="running"||l.status==="pending")&&(!e.has(m)||new Date(l.created_at)>new Date(e.get(m).created_at))&&e.set(m,l)}),t.map(l=>({...l,task:e.get(l.folder_name)||null}))});function ue(a){const t=x.value.indexOf(a);t>-1?x.value.splice(t,1):x.value.push(a)}function me(a){return a?new Date(a).toLocaleString():"Never"}async function pe(){if(!g.value.name||!g.value.url){u.addNotification("Repository name and URL are required.","warning");return}r.value="add";try{await i.addMcpZooRepository(g.value.name,g.value.url),g.value={name:"",url:""},S.value=!1}finally{r.value=null}}async function ve(a){r.value=a.id;try{await i.pullMcpZooRepository(a.id)}finally{r.value=null}}async function fe(){U.value=!0;try{await i.pullAllMcpZooRepositories()}finally{U.value=!1}}async function be(a){if(await u.showConfirmation({title:`Delete Repository '${a.name}'?`,message:"This will remove the repository and its cached files. This action cannot be undone.",confirmText:"Delete"})){r.value=a.id;try{await i.deleteMcpZooRepository(a.id)}finally{r.value=null}}}function Q(a){u.openModal("appInstall",{app:a,type:"mcps"})}function X(a){const t=M.value.items.find(e=>e.name===a.name);if(!t){u.addNotification(`Could not find details for '${a.name}' in the zoo. Try refreshing repositories.`,"error");return}u.showConfirmation({title:`Update '${a.name}'?`,message:"This will reinstall it with the latest version. It will be stopped. Are you sure?",confirmText:"Update"}).then(e=>{e&&Q(t)})}async function Y(a,t){r.value=`${t}-${a}`;try{t==="start"&&await i.startApp(a),t==="stop"&&await i.stopApp(a)}finally{r.value=null}}async function ge(a){if(await u.showConfirmation({title:`Uninstall '${a.name}'?`,message:"This will permanently delete all files. This cannot be undone.",confirmText:"Uninstall"})){r.value=`uninstall-${a.id}`;try{await i.uninstallApp(a.id)}finally{r.value=null}}}function ye(a){u.openModal("appDetails",{app:a})}function _e(a){u.openModal("appConfig",{app:a})}function he(a){u.openModal("serviceRegistration",{item:a,itemType:"mcp",isInstalled:!0})}async function we(a){const t=await i.fetchAppLog(a.id);u.openModal("sourceViewer",{title:`Logs: ${a.name}`,content:t||"No log content found.",language:"log"})}async function ke(a){const t=await i.fetchMcpReadme(a.repository,a.folder_name);u.openModal("sourceViewer",{title:`README: ${a.name}`,content:t,language:"markdown"})}async function ee(a){await q.cancelTask(a)}function te(a){u.openModal("tasksManager",{initialTaskId:a})}return(a,t)=>(n(),o("div",Ee,[s("div",Oe,[s("nav",Fe,[s("button",{onClick:t[0]||(t[0]=e=>p.value="repositories"),class:h(["tab-button",p.value==="repositories"?"active":"inactive"])},"Repositories",2),s("button",{onClick:t[1]||(t[1]=e=>p.value="available_items"),class:h(["tab-button",p.value==="available_items"?"active":"inactive"])},"Available",2),s("button",{onClick:t[2]||(t[2]=e=>p.value="installed_apps"),class:h(["tab-button",p.value==="installed_apps"?"active":"inactive"])},"Installed",2)])]),p.value==="repositories"?(n(),o("section",We,[s("div",Be,[t[15]||(t[15]=s("h3",{class:"text-xl font-semibold"},"MCP Zoo Repositories",-1)),s("div",qe,[s("button",{onClick:fe,class:"btn btn-secondary",disabled:U.value},[c(N,{class:h(["w-4 h-4",{"animate-spin":U.value}])},null,8,["class"]),t[14]||(t[14]=s("span",{class:"ml-2"},"Pull All",-1))],8,Ge),s("button",{onClick:t[3]||(t[3]=e=>S.value=!S.value),class:"btn btn-primary"},f(S.value?"Cancel":"Add Repository"),1)])]),c(Re,{name:"form-fade"},{default:$e(()=>[S.value?(n(),o("div",He,[s("form",{onSubmit:Ie(pe,["prevent"]),class:"space-y-4"},[s("div",Je,[s("div",null,[t[16]||(t[16]=s("label",{for:"repo-name-mcp",class:"block text-sm font-medium"},"Name",-1)),C(s("input",{id:"repo-name-mcp","onUpdate:modelValue":t[4]||(t[4]=e=>g.value.name=e),type:"text",class:"input-field mt-1",placeholder:"e.g., Official MCP Zoo",required:""},null,512),[[W,g.value.name]])]),s("div",Ke,[t[17]||(t[17]=s("label",{for:"repo-url-mcp",class:"block text-sm font-medium"},"Git URL",-1)),C(s("input",{id:"repo-url-mcp","onUpdate:modelValue":t[5]||(t[5]=e=>g.value.url=e),type:"url",class:"input-field mt-1",placeholder:"https://github.com/ParisNeo/lollms_mcps_zoo.git",required:""},null,512),[[W,g.value.url]])])]),s("div",Qe,[s("button",{type:"submit",class:"btn btn-primary",disabled:r.value==="add"},f(r.value==="add"?"Adding...":"Add Repository"),9,Xe)])],32)])):v("",!0)]),_:1}),y(le)?(n(),o("div",Ye,"Loading repositories...")):!E.value||E.value.length===0?(n(),o("div",et,t[18]||(t[18]=[s("p",null,"No MCP Zoo repositories added.",-1)]))):(n(),o("div",tt,[(n(!0),o(k,null,A(E.value,e=>(n(),o("div",{key:e.id,class:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm flex flex-col md:flex-row md:items-center justify-between gap-4"},[s("div",st,[s("p",at,f(e.name),1),s("p",lt,f(e.url),1),s("p",nt,"Last updated: "+f(me(e.last_pulled_at)),1)]),s("div",ot,[s("button",{onClick:l=>ve(e),class:"btn btn-secondary btn-sm",disabled:r.value===e.id},[c(N,{class:h(["w-4 h-4",{"animate-spin":r.value===e.id}])},null,8,["class"]),t[19]||(t[19]=s("span",{class:"ml-1"},"Pull",-1))],8,it),e.is_deletable?(n(),o("button",{key:0,onClick:l=>be(e),class:"btn btn-danger btn-sm",disabled:r.value===e.id},[c(ae,{class:"w-4 h-4"})],8,rt)):v("",!0)])]))),128))]))])):v("",!0),p.value==="available_items"?(n(),o("section",dt,[s("div",ct,[t[21]||(t[21]=s("h3",{class:"text-xl font-semibold"},"Available MCPs",-1)),s("button",{onClick:R,class:"btn btn-secondary",disabled:y(V)},[c(N,{class:h(["w-4 h-4",{"animate-spin":y(V)}])},null,8,["class"]),t[20]||(t[20]=s("span",{class:"ml-2"},"Rescan",-1))],8,ut)]),s("div",mt,[s("div",pt,[s("div",vt,[C(s("input",{type:"text","onUpdate:modelValue":t[6]||(t[6]=e=>T.value=e),placeholder:"Search MCPs...",class:"input-field w-full pl-10"},null,512),[[W,T.value]]),t[22]||(t[22]=s("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[s("svg",{class:"h-5 w-5 text-gray-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})])],-1))]),s("div",ft,[C(s("select",{"onUpdate:modelValue":t[7]||(t[7]=e=>$.value=e),class:"input-field"},t[23]||(t[23]=[s("option",{value:"All"},"All Statuses",-1),s("option",{value:"Installed"},"Installed",-1),s("option",{value:"Uninstalled"},"Uninstalled",-1)]),512),[[B,$.value]]),C(s("select",{"onUpdate:modelValue":t[8]||(t[8]=e=>_.value=e),class:"input-field"},[(n(!0),o(k,null,A(ce.value,e=>(n(),o("option",{key:e,value:e},f(e),9,bt))),128))],512),[[B,_.value]])])]),s("div",gt,[C(s("select",{"onUpdate:modelValue":t[9]||(t[9]=e=>P.value=e),class:"input-field w-48"},[(n(),o(k,null,A(oe,e=>s("option",{key:e.value,value:e.value},"Sort by "+f(e.label),9,yt)),64))],512),[[B,P.value]]),s("button",{onClick:t[10]||(t[10]=e=>I.value=I.value==="asc"?"desc":"asc"),class:"btn btn-secondary p-2"},[I.value==="asc"?(n(),L(Ne,{key:0,class:"w-5 h-5"})):(n(),L(Le,{key:1,class:"w-5 h-5"}))])]),y(V)?(n(),o("div",_t,[(n(),o(k,null,A(8,e=>c(je,{key:e})),64))])):!z.value||z.value.length===0?(n(),o("div",ht,t[24]||(t[24]=[s("h4",{class:"font-semibold"},"No MCPs Found",-1),s("p",{class:"text-sm"},"No MCPs match your criteria. Please add and pull a repository or adjust your filters.",-1)]))):(n(),o("div",wt,[s("div",kt,[(n(!0),o(k,null,A(z.value,e=>(n(),L(Ze,{key:`${e.repository}/${e.folder_name}`,app:e,task:e.task,"is-starred":x.value.includes(e.name),onStar:l=>ue(e.name),onInstall:l=>Q(e),onUpdate:l=>X(e),onDetails:l=>ye(e),onHelp:l=>ke(e),onViewTask:te,onCancelInstall:l=>ee(e.task.id)},null,8,["app","task","is-starred","onStar","onInstall","onUpdate","onDetails","onHelp","onCancelInstall"]))),128))]),_.value!=="Starred"?(n(),o("div",xt,[s("p",Ct,f(re.value),1),s("div",At,[s("button",{onClick:t[11]||(t[11]=e=>b.value--),disabled:b.value<=1,class:"btn btn-secondary"},"Previous",8,Mt),s("button",{onClick:t[12]||(t[12]=e=>b.value++),disabled:b.value>=ie.value,class:"btn btn-secondary"},"Next",8,St)])])):v("",!0)]))])])):v("",!0),p.value==="installed_apps"?(n(),o("section",$t,[s("div",It,[t[26]||(t[26]=s("h3",{class:"text-xl font-semibold"},"Installed MCPs",-1)),s("button",{onClick:t[13]||(t[13]=(...e)=>y(i).fetchInstalledApps&&y(i).fetchInstalledApps(...e)),class:"btn btn-secondary",disabled:y(j)},[c(N,{class:h(["w-4 h-4",{"animate-spin":y(j)}])},null,8,["class"]),t[25]||(t[25]=s("span",{class:"ml-2"},"Refresh",-1))],8,Rt)]),y(j)?(n(),o("div",Tt,"Loading...")):!O.value||O.value.length===0?(n(),o("div",Ut,t[27]||(t[27]=[s("h4",{class:"font-semibold"},"No MCPs Installed",-1),s("p",{class:"text-sm"},'Go to "Available" to install an MCP.',-1)]))):(n(),o("div",Pt,[(n(!0),o(k,null,A(O.value,e=>(n(),o("div",{key:e.id,class:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm flex flex-col md:flex-row md:items-center justify-between gap-4"},[s("div",Dt,[e.icon?(n(),o("img",{key:0,src:e.icon,class:"h-10 w-10 rounded-md flex-shrink-0 object-cover",alt:"Icon"},null,8,Nt)):v("",!0),s("div",Lt,[s("p",Vt,f(e.name),1),s("p",jt,"Port: "+f(e.port),1)])]),s("div",Zt,[e.task?(n(),L(ze,{key:0,task:e.task,onView:l=>te(e.task.id),onCancel:l=>ee(e.task.id)},null,8,["task","onView","onCancel"])):(n(),o(k,{key:1},[e.update_available?(n(),o("button",{key:0,onClick:l=>X(e),class:"btn btn-warning btn-sm p-2",title:"Update"},[c(De,{class:"w-5 h-5"})],8,zt)):v("",!0),s("span",{class:h(["px-2 py-1 text-xs font-semibold rounded-full",{"bg-green-100 text-green-800":e.status==="running","bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300":e.status==="stopped","bg-red-100 text-red-800":e.status==="error"}])},f(e.status),3),e.status==="running"&&e.url?(n(),o("a",{key:1,href:e.url,target:"_blank",class:"btn btn-secondary btn-sm p-2",title:"Open"},[c(Ve,{class:"w-5 h-5"})],8,Et)):v("",!0),s("button",{onClick:l=>he(e),class:"btn btn-secondary btn-sm p-2",title:"Edit Registration"},[c(Te,{class:"w-5 h-5"})],8,Ot),s("button",{onClick:l=>_e(e),class:"btn btn-secondary btn-sm p-2",title:"Configure"},[c(Ue,{class:"w-5 h-5"})],8,Ft),s("button",{onClick:l=>we(e),class:"btn btn-secondary btn-sm p-2",title:"Logs"},[c(Pe,{class:"w-5 h-5"})],8,Wt),e.status!=="running"?(n(),o("button",{key:2,onClick:l=>Y(e.id,"start"),class:"btn btn-success btn-sm p-2",disabled:r.value===`start-${e.id}`,title:"Start"},"Start",8,Bt)):v("",!0),e.status==="running"||e.status==="error"&&e.pid?(n(),o("button",{key:3,onClick:l=>Y(e.id,"stop"),class:"btn btn-warning btn-sm p-2",disabled:r.value===`stop-${e.id}`,title:"Stop"},"Stop",8,qt)):v("",!0),s("button",{onClick:l=>ge(e),class:"btn btn-danger btn-sm p-2",title:"Uninstall"},[c(ae,{class:"w-5 h-5"})],8,Gt)],64))])]))),128))]))])):v("",!0)]))}},ss=xe(Ht,[["__scopeId","data-v-1c317534"]]);export{ss as default};
