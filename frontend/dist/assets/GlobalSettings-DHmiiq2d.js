import{D as C,a as U,r as m,c as G,o as J,m as _,b as l,e as r,f as o,w as j,F as S,q as x,t as b,h as y,d as D,p as w,i as E,x as O,v as M,n as F}from"./index-BqCh0aMd.js";const L={class:"bg-white dark:bg-gray-800 shadow-md rounded-lg"},A={class:"space-y-10"},B={class:"text-lg font-medium text-gray-800 dark:text-gray-200 border-b border-gray-200 dark:border-gray-600 pb-2 mb-6"},T={class:"space-y-8"},q=["for"],I=["id","onUpdate:modelValue"],R=["id","onUpdate:modelValue"],$=["type","step","id","onUpdate:modelValue"],z={key:3,class:"mt-2"},P=["onClick"],H=["id","onUpdate:modelValue"],K={class:"mt-8 pt-5 border-t border-gray-200 dark:border-gray-700"},Q={class:"flex justify-end"},W=["disabled"],X={key:1,class:"p-6 text-center"},Y={key:2,class:"p-6 text-center"},te={__name:"GlobalSettings",setup(Z){const d=C(),N=U(),s=m({}),c=m(!1),p=m(!1);let k="{}";const f=G(()=>{const a=d.globalSettings.filter(t=>t.category!=="Email Settings"&&t.key!=="password_recovery_mode"),u=["Registration","Services","Defaults","Global LLM Overrides"],n=a.reduce((t,h)=>{const v=h.category||"General";return t[v]||(t[v]=[]),t[v].push(h),t},{}),e={};return u.forEach(t=>{n[t]&&(e[t]=n[t])}),Object.keys(n).forEach(t=>{u.includes(t)||(e[t]=n[t])}),e});J(()=>{d.globalSettings.length===0?d.fetchGlobalSettings():g()}),_(()=>d.globalSettings,g,{deep:!0}),_(s,i=>{p.value=JSON.stringify(i)!==k},{deep:!0});function g(){const i={};d.globalSettings.length>0&&(d.globalSettings.forEach(a=>{if(a.type==="json")try{i[a.key]=JSON.stringify(a.value,null,2)}catch{i[a.key]=a.value}else i[a.key]=a.value}),s.value=i,k=JSON.parse(JSON.stringify(i)),p.value=!1)}async function V(){c.value=!0;const i=Object.values(f.value).flat(),a={};let u=!1;for(const n of i){const e=n.key;if(s.value.hasOwnProperty(e))if(n.type==="json")try{a[e]=JSON.parse(s.value[e])}catch{N.addNotification(`Invalid JSON format for '${n.description}'.`,"error"),u=!0}else a[e]=s.value[e]}if(u){c.value=!1;return}try{await d.updateGlobalSettings(a)}catch{}finally{c.value=!1}}return(i,a)=>(r(),l("div",L,[a[4]||(a[4]=o("div",{class:"p-6 border-b border-gray-200 dark:border-gray-700"},[o("h3",{class:"text-xl font-semibold leading-6 text-gray-900 dark:text-white"}," Global System Settings "),o("p",{class:"mt-1 text-sm text-gray-500 dark:text-gray-400"}," Manage application-wide settings. Changes may require users to log out and back in. ")],-1)),Object.keys(f.value).length?(r(),l("form",{key:0,onSubmit:j(V,["prevent"]),class:"p-6"},[o("div",A,[(r(!0),l(S,null,x(f.value,(u,n)=>(r(),l("div",{key:n},[o("h4",B,b(n),1),o("div",T,[(r(!0),l(S,null,x(u,e=>(r(),l("div",{key:e.key},[o("label",{for:e.key,class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},b(e.description),9,q),e.key==="registration_mode"?y((r(),l("select",{key:0,id:e.key,"onUpdate:modelValue":t=>s.value[e.key]=t,class:"input-field mt-1"},a[0]||(a[0]=[o("option",{value:"direct"},"Direct (instantly active)",-1),o("option",{value:"admin_approval"},"Admin Approval",-1)]),8,I)),[[w,s.value[e.key]]]):e.key==="force_model_mode"?y((r(),l("select",{key:1,id:e.key,"onUpdate:modelValue":t=>s.value[e.key]=t,class:"input-field mt-1"},a[1]||(a[1]=[o("option",{value:"disabled"},"Disabled",-1),o("option",{value:"force_once"},"Force Once (set user preference)",-1),o("option",{value:"force_always"},"Force Always (override session)",-1)]),8,R)),[[w,s.value[e.key]]]):["string","integer","float"].includes(e.type)?y((r(),l("input",{key:2,type:e.type==="string"?"text":"number",step:e.type==="float"?"0.1":"1",id:e.key,"onUpdate:modelValue":t=>s.value[e.key]=t,class:"input-field mt-1"},null,8,$)),[[E,s.value[e.key]]]):e.type==="boolean"?(r(),l("div",z,[o("button",{onClick:t=>s.value[e.key]=!s.value[e.key],type:"button",class:O([s.value[e.key]?"bg-blue-600":"bg-gray-200 dark:bg-gray-600","relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800"])},[o("span",{class:O([s.value[e.key]?"translate-x-5":"translate-x-0","pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out"])},null,2)],10,P)])):e.type==="json"?y((r(),l("textarea",{key:4,id:e.key,"onUpdate:modelValue":t=>s.value[e.key]=t,rows:"5",class:"input-field mt-1 font-mono text-xs !leading-relaxed",placeholder:"Enter valid JSON here..."},null,8,H)),[[M,s.value[e.key]]]):D("",!0)]))),128))])]))),128))]),o("div",K,[o("div",Q,[o("button",{type:"submit",class:"btn btn-primary",disabled:c.value||!p.value},b(c.value?"Saving...":"Save Global Settings"),9,W)])])],32)):F(d).isLoadingSettings?(r(),l("div",X,a[2]||(a[2]=[o("p",{class:"text-gray-500"},"Loading settings...",-1)]))):(r(),l("div",Y,a[3]||(a[3]=[o("p",{class:"text-gray-500"},"Could not load global settings.",-1)])))]))}};export{te as default};
