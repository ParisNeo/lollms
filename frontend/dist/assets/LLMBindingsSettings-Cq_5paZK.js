import{c7 as re,a as de,c1 as ue,r as c,c as E,w as ce,o as me,b as o,d as l,g as m,h as t,e as U,t as r,l as w,j as M,v as L,c2 as O,F as y,m as p,i as V,$ as ve,q as K,b$ as fe,c0 as ge,n as v,P as R,c9 as be,H as ye,f as Q,ca as _e}from"./index-DnjdbnqE.js";const pe={class:"space-y-8"},xe={key:0,class:"bg-white dark:bg-gray-800 shadow-md rounded-lg p-6"},he={class:"text-xl font-semibold mb-4"},ke={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},we=["disabled"],Ce=["value"],Be={key:0,class:"space-y-6 border-t dark:border-gray-700 pt-6"},$e={class:"text-sm text-gray-600 dark:text-gray-400"},Se=["for"],Me={key:0,class:"text-red-500"},Te=["id","onUpdate:modelValue"],Ae=["value"],Ve={key:1},Ne={class:"relative"},De=["type","id","onUpdate:modelValue","required","placeholder"],Ee=["onClick","title"],Fe={key:2,class:"flex items-center justify-between bg-gray-50 dark:bg-gray-700/50 p-3 rounded-md"},je={class:"flex-grow flex flex-col pr-4"},Ue={class:"text-sm text-gray-500 dark:text-gray-400"},Le=["onClick"],Oe={class:"text-xs text-gray-500 mt-1"},qe={key:1,class:"mt-6 border-t dark:border-gray-700 pt-6"},Pe={class:"grid grid-cols-1 gap-4"},Ie={class:"flex justify-between items-start mb-3"},ze={class:"font-bold text-md"},Ge={class:"text-sm text-gray-600 dark:text-gray-400"},He={key:0,class:"space-y-3 mb-4"},Je={class:"block text-xs font-medium uppercase text-gray-500 dark:text-gray-400 mb-1"},Ke=["onUpdate:modelValue","placeholder"],Re={key:1,class:"flex items-center gap-2"},Qe=["onClick"],We={class:"text-sm"},Xe={class:"flex justify-end"},Ye=["onClick"],Ze={class:"flex items-center justify-between bg-gray-50 dark:bg-gray-700/50 p-3 rounded-md"},et={class:"flex justify-end gap-3"},tt=["disabled"],nt={class:"flex justify-between items-center mb-4 flex-wrap gap-4"},at={class:"flex items-center gap-4"},st={key:0,class:"text-center p-6"},lt={key:1,class:"text-center p-6 bg-gray-50 dark:bg-gray-800/50 rounded-lg"},ot={key:2,class:"space-y-4"},it={class:"flex-grow"},rt={class:"flex justify-between items-center"},dt={class:"flex items-center gap-3"},ut={class:"font-bold text-lg text-gray-900 dark:text-white"},ct=["onClick","title"],mt={class:"flex gap-3"},vt=["onClick"],ft=["onClick"],gt={class:"text-sm text-gray-500 dark:text-gray-400"},bt={class:"mt-2 text-xs space-y-1 text-gray-600 dark:text-gray-300"},yt={key:0},_t={class:"font-semibold capitalize"},pt={key:0},xt={key:1},ht={key:0},kt={class:"border-t dark:border-gray-700 pt-3 flex justify-end gap-2"},wt=["onClick"],Ct=["onClick"],Bt={class:"space-y-4"},$t={key:0,class:"text-center text-gray-500"},St={key:1,class:"flex gap-4"},Mt={class:"w-1/3 border-r dark:border-gray-700 pr-4 space-y-2"},Tt=["onClick"],At={class:"w-2/3 pl-2"},Vt={key:0},Nt={class:"font-bold text-lg mb-2"},Dt={class:"text-sm text-gray-600 dark:text-gray-400 mb-4"},Et={key:0,class:"space-y-3 mb-4 bg-gray-50 dark:bg-gray-800 p-3 rounded-md border dark:border-gray-700"},Ft={class:"block text-xs font-medium uppercase text-gray-500 dark:text-gray-400 mb-1"},jt=["onUpdate:modelValue","placeholder"],Ut={key:1,class:"flex items-center gap-2"},Lt=["onClick"],Ot={class:"text-sm"},qt={class:"flex justify-end"},Pt=["disabled"],It={key:1,class:"h-full flex items-center justify-center text-gray-400 text-sm"},Ht={__name:"LLMBindingsSettings",setup(zt){const f=re(),C=de(),{bindings:q,availableBindingTypes:h,isLoadingBindings:W,globalSettings:P}=ue(f),B=c(!1),$=c(null),N=c(!1),k=c({}),g=c({}),T=c(!1),F=c(null),j=c([]),u=c(null),b=c({}),D=c(!1),I=()=>({id:null,alias:"",name:"",config:{},default_model_name:"",is_active:!0}),i=c(I()),S=E(()=>$.value!==null),x=E(()=>i.value.name?h.value.find(s=>s.binding_name===i.value.name):null),X=E(()=>{if(!x.value)return[];const s=x.value.input_parameters||[],n=new Set(s.map(a=>a.name)),e=Object.keys(i.value.config||{}).filter(a=>!n.has(a)&&a!=="model_name").map(a=>({name:a,type:typeof i.value.config[a]=="boolean"?"bool":typeof i.value.config[a]=="number"?"float":"str",description:"(Parameter not in binding description)",mandatory:!1}));return[...s.filter(a=>a.name!=="model_name"),...e]});ce(()=>i.value.name,(s,n)=>{if(s!==n&&!S.value){const e=h.value.find(d=>d.binding_name===s),a={};e&&e.input_parameters&&e.input_parameters.forEach(d=>{a[d.name]=d.default}),i.value.config=a}});const z=E({get(){if(!Array.isArray(P.value))return"mixed";const s=P.value.find(n=>n.key==="model_display_mode");return s?s.value:"mixed"},set(s){f.updateGlobalSettings({model_display_mode:s})}});me(()=>{f.fetchBindings(),f.fetchAvailableBindingTypes(),f.fetchGlobalSettings()});function G(){$.value=null,i.value=I(),k.value={},g.value={},B.value=!0,window.scrollTo({top:0,behavior:"smooth"})}function Y(s){$.value=s,i.value=JSON.parse(JSON.stringify(s)),i.value.config||(i.value.config={}),k.value={};const n=h.value.find(e=>e.binding_name===s.name);if(n&&n.commands){const e={};n.commands.forEach(a=>{e[a.name]={},a.parameters&&a.parameters.forEach(d=>{e[a.name][d.name]=d.default!==void 0?d.default:""})}),g.value=e}else g.value={};B.value=!0,window.scrollTo({top:0,behavior:"smooth"})}function H(){B.value=!1,$.value=null}function Z(s){return typeof s=="string"?s.split(",").map(n=>n.trim()).filter(n=>n):Array.isArray(s)?s.filter(n=>n):[]}async function ee(){if(!i.value.alias.trim()||!i.value.name){C.addNotification("Alias and Binding Type are required fields.","warning");return}N.value=!0;try{const s={alias:i.value.alias,name:i.value.name,config:i.value.config||{},is_active:i.value.is_active,default_model_name:i.value.default_model_name||null};S.value?await f.updateBinding($.value.id,s):await f.addBinding(s),H()}catch(s){console.error("Submit failed:",s.message)}finally{N.value=!1}}async function te(s){await C.showConfirmation({title:`Delete Binding '${s.alias}'?`,message:"Are you sure? This action cannot be undone.",confirmText:"Delete"})&&await f.deleteBinding(s.id)}async function ne(s){await f.updateBinding(s.id,{is_active:!s.is_active})}function ae(s){C.openModal("manageModels",{binding:s,bindingType:"llm"})}function se(s){const n=h.value.find(e=>e.binding_name===s);return n?n.title:s}async function J(s,n,e){try{C.addNotification(`Submitting command '${s.title||s.name}'...`,"info");const a=await f.executeBindingCommand(n,s.name,e);if(a)return C.addNotification(`Task started: ${s.title||s.name}. Check Task Manager for progress.`,"success",5e3),a}catch(a){console.error(a),C.addNotification(`Command submission failed: ${a.message}`,"error")}}function le(s){F.value=s;const n=h.value.find(e=>e.binding_name===s.name);j.value=n?n.commands||[]:[],u.value=null,b.value={},T.value=!0}function oe(s){u.value=s,b.value={},s.parameters&&s.parameters.forEach(n=>{b.value[n.name]=n.default!==void 0?n.default:""})}async function ie(){if(!(!u.value||!F.value)){D.value=!0;try{await J(u.value,F.value.id,b.value),T.value=!1}finally{D.value=!1}}}return(s,n)=>(l(),o("div",pe,[B.value?(l(),o("div",xe,[t("h3",he,r(S.value?"Edit Binding":"Add New Binding"),1),t("form",{onSubmit:R(ee,["prevent"]),class:"space-y-6"},[t("div",ke,[t("div",null,[n[6]||(n[6]=t("label",{for:"alias",class:"block text-sm font-medium"},[M("Alias "),t("span",{class:"text-red-500"},"*")],-1)),w(t("input",{type:"text",id:"alias","onUpdate:modelValue":n[0]||(n[0]=e=>i.value.alias=e),class:"input-field mt-1",required:"",placeholder:"e.g., local_ollama",autocomplete:"off"},null,512),[[L,i.value.alias]]),n[7]||(n[7]=t("p",{class:"text-xs text-gray-500 mt-1"},"A unique, short name for this configuration.",-1))]),t("div",null,[n[9]||(n[9]=t("label",{for:"name",class:"block text-sm font-medium"},[M("Binding Type "),t("span",{class:"text-red-500"},"*")],-1)),w(t("select",{id:"name","onUpdate:modelValue":n[1]||(n[1]=e=>i.value.name=e),class:"input-field mt-1",required:"",disabled:S.value},[n[8]||(n[8]=t("option",{disabled:"",value:""},"Select a type",-1)),(l(!0),o(y,null,p(V(h),e=>(l(),o("option",{key:e.binding_name,value:e.binding_name},r(e.title),9,Ce))),128))],8,we),[[O,i.value.name]])])]),x.value?(l(),o("div",Be,[t("p",$e,r(x.value.description),1),(l(!0),o(y,null,p(X.value,e=>(l(),o("div",{key:e.name,class:"space-y-1"},[t("label",{for:`param-${e.name}`,class:"block text-sm font-medium capitalize"},[M(r(e.name.replace(/_/g," "))+" ",1),e.mandatory?(l(),o("span",Me,"*")):m("",!0)],8,Se),e.options&&e.options.length>0?w((l(),o("select",{key:0,id:`param-${e.name}`,"onUpdate:modelValue":a=>i.value.config[e.name]=a,class:"input-field"},[(l(!0),o(y,null,p(Z(e.options),a=>(l(),o("option",{key:a,value:a},r(a),9,Ae))),128))],8,Te)),[[O,i.value.config[e.name]]]):["str","int","float"].includes(e.type)?(l(),o("div",Ve,[t("div",Ne,[w(t("input",{type:(e.name.includes("key")||e.name.includes("token"))&&!k.value[e.name]?"password":"text",id:`param-${e.name}`,"onUpdate:modelValue":a=>i.value.config[e.name]=a,class:"input-field",required:e.mandatory,placeholder:e.description,autocomplete:"off"},null,8,De),[[ve,i.value.config[e.name]]]),e.name.includes("key")||e.name.includes("token")?(l(),o("button",{key:0,type:"button",onClick:a=>k.value[e.name]=!k.value[e.name],class:"absolute inset-y-0 right-0 px-3 flex items-center text-gray-500 hover:text-gray-700 dark:hover:text-gray-300",title:k.value[e.name]?"Hide":"Show"},[k.value[e.name]?(l(),K(fe,{key:0,class:"w-5 h-5"})):(l(),K(ge,{key:1,class:"w-5 h-5"}))],8,Ee)):m("",!0)])])):e.type==="bool"?(l(),o("div",Fe,[t("span",je,[t("span",Ue,r(e.description),1)]),t("button",{onClick:a=>i.value.config[e.name]=!i.value.config[e.name],type:"button",class:v([i.value.config[e.name]?"bg-blue-600":"bg-gray-200 dark:bg-gray-600","relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out"])},[t("span",{class:v([i.value.config[e.name]?"translate-x-5":"translate-x-0","pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition-colors duration-200 ease-in-out"])},null,2)],10,Le)])):m("",!0),t("p",Oe,r(e.description),1)]))),128))])):m("",!0),S.value&&x.value&&x.value.commands&&x.value.commands.length>0?(l(),o("div",qe,[n[10]||(n[10]=t("h4",{class:"text-lg font-semibold mb-4"},"Binding Commands",-1)),t("div",Pe,[(l(!0),o(y,null,p(x.value.commands,e=>(l(),o("div",{key:e.name,class:"p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg border dark:border-gray-600"},[t("div",Ie,[t("div",null,[t("h5",ze,r(e.title||e.name),1),t("p",Ge,r(e.description),1)])]),e.parameters&&e.parameters.length>0?(l(),o("div",He,[(l(!0),o(y,null,p(e.parameters,a=>(l(),o("div",{key:a.name},[t("label",Je,r(a.name),1),a.type!=="bool"?w((l(),o("input",{key:0,type:"text","onUpdate:modelValue":d=>g.value[e.name][a.name]=d,class:"input-field text-sm",placeholder:a.default},null,8,Ke)),[[L,g.value[e.name][a.name]]]):(l(),o("div",Re,[t("button",{onClick:d=>g.value[e.name][a.name]=!g.value[e.name][a.name],type:"button",class:v([g.value[e.name][a.name]?"bg-blue-600":"bg-gray-200 dark:bg-gray-600","relative inline-flex h-5 w-9 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out"])},[t("span",{class:v([g.value[e.name][a.name]?"translate-x-4":"translate-x-0","pointer-events-none inline-block h-4 w-4 transform rounded-full bg-white shadow ring-0 transition-colors duration-200 ease-in-out"])},null,2)],10,Qe),t("span",We,r(a.description),1)]))]))),128))])):m("",!0),t("div",Xe,[t("button",{type:"button",onClick:a=>J(e,$.value.id,g.value[e.name]),class:"btn btn-primary btn-sm"},"Execute",8,Ye)])]))),128))])])):m("",!0),t("div",Ze,[n[11]||(n[11]=t("span",{class:"flex-grow flex flex-col"},[t("span",{class:"text-sm font-medium text-gray-900 dark:text-gray-100"},"Active"),t("span",{class:"text-sm text-gray-500 dark:text-gray-400"},"If disabled, users cannot see or use models from this binding.")],-1)),t("button",{onClick:n[2]||(n[2]=e=>i.value.is_active=!i.value.is_active),type:"button",class:v([i.value.is_active?"bg-blue-600":"bg-gray-200 dark:bg-gray-600","relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out"])},[t("span",{class:v([i.value.is_active?"translate-x-5":"translate-x-0","pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition-colors duration-200 ease-in-out"])},null,2)],2)]),t("div",et,[t("button",{type:"button",onClick:H,class:"btn btn-secondary"},"Cancel"),t("button",{type:"submit",class:"btn btn-primary",disabled:N.value},r(N.value?"Saving...":S.value?"Save Changes":"Add Binding"),9,tt)])],32)])):m("",!0),t("div",null,[t("div",nt,[n[14]||(n[14]=t("h2",{class:"text-2xl font-bold"},"LLM Bindings",-1)),t("div",at,[t("div",null,[n[13]||(n[13]=t("label",{for:"model-display-mode",class:"block text-xs font-medium text-gray-500 dark:text-gray-400"},"Model Display Mode",-1)),w(t("select",{id:"model-display-mode","onUpdate:modelValue":n[3]||(n[3]=e=>z.value=e),class:"input-field mt-1"},n[12]||(n[12]=[t("option",{value:"mixed"},"Mixed (Alias or Original)",-1),t("option",{value:"aliased"},"Aliased Only",-1),t("option",{value:"original"},"Original Names Only",-1)]),512),[[O,z.value]])]),B.value?m("",!0):(l(),o("button",{key:0,onClick:G,class:"btn btn-primary self-end"},"+ Add New Binding"))])]),V(W)?(l(),o("div",st,"Loading bindings...")):V(q).length===0&&!B.value?(l(),o("div",lt,[n[15]||(n[15]=t("p",null,"No LLM bindings configured yet.",-1)),t("button",{onClick:G,class:"mt-2 text-blue-600 hover:underline"},"Add your first one")])):(l(),o("div",ot,[(l(!0),o(y,null,p(V(q),e=>{var a,d;return l(),o("div",{key:e.id,class:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow-md flex flex-col gap-4"},[t("div",it,[t("div",rt,[t("div",dt,[t("h4",ut,r(e.alias),1),t("button",{onClick:R(_=>ne(e),["stop"]),type:"button",class:v([e.is_active?"bg-blue-600":"bg-gray-200 dark:bg-gray-600","relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out"]),title:e.is_active?"Deactivate":"Activate"},[t("span",{class:v([e.is_active?"translate-x-5":"translate-x-0","pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out"])},null,2)],10,ct)]),t("div",mt,[t("button",{onClick:_=>Y(e),class:"text-sm font-medium text-blue-600 hover:underline"},"Edit",8,vt),t("button",{onClick:_=>te(e),class:"text-sm font-medium text-red-600 hover:underline"},"Delete",8,ft)])]),t("p",gt,r(se(e.name)),1),t("div",bt,[(l(!0),o(y,null,p(e.config,(_,A)=>(l(),o(y,{key:A},[_&&A!=="model_name"?(l(),o("p",yt,[t("span",_t,r(A.replace(/_/g," "))+":",1),A.includes("key")||A.includes("token")?(l(),o("span",pt,"********")):(l(),o("span",xt,r(_),1))])):m("",!0)],64))),128)),e.default_model_name?(l(),o("p",ht,[n[16]||(n[16]=t("span",{class:"font-semibold"},"Default Model:",-1)),M(" "+r(e.default_model_name),1)])):m("",!0)])]),t("div",kt,[(d=(a=V(h).find(_=>_.binding_name===e.name))==null?void 0:a.commands)!=null&&d.length?(l(),o("button",{key:0,onClick:_=>le(e),class:"btn btn-secondary btn-sm flex items-center gap-2",title:"Execute Commands"},[U(be,{class:"w-4 h-4"}),n[17]||(n[17]=M(" Commands "))],8,wt)):m("",!0),t("button",{onClick:_=>ae(e),class:"btn btn-secondary btn-sm flex items-center gap-2"},[U(ye,{class:"w-4 h-4"}),n[18]||(n[18]=M(" Manage Models "))],8,Ct)])])}),128))]))]),U(_e,{visible:T.value,title:"Binding Commands",onClose:n[5]||(n[5]=e=>T.value=!1)},{footer:Q(()=>[t("button",{onClick:n[4]||(n[4]=e=>T.value=!1),class:"btn btn-secondary"},"Close")]),default:Q(()=>[t("div",Bt,[j.value.length?(l(),o("div",St,[t("div",Mt,[(l(!0),o(y,null,p(j.value,e=>(l(),o("button",{key:e.name,onClick:a=>oe(e),class:v(["w-full text-left px-3 py-2 rounded-md text-sm transition-colors",u.value&&u.value.name===e.name?"bg-blue-100 dark:bg-blue-900 text-blue-700 dark:text-blue-200 font-medium":"hover:bg-gray-100 dark:hover:bg-gray-700"])},r(e.title||e.name),11,Tt))),128))]),t("div",At,[u.value?(l(),o("div",Vt,[t("h4",Nt,r(u.value.title||u.value.name),1),t("p",Dt,r(u.value.description),1),u.value.parameters&&u.value.parameters.length?(l(),o("div",Et,[(l(!0),o(y,null,p(u.value.parameters,e=>(l(),o("div",{key:e.name},[t("label",Ft,r(e.name),1),e.type!=="bool"?w((l(),o("input",{key:0,type:"text","onUpdate:modelValue":a=>b.value[e.name]=a,class:"input-field text-sm",placeholder:e.default},null,8,jt)),[[L,b.value[e.name]]]):(l(),o("div",Ut,[t("button",{onClick:a=>b.value[e.name]=!b.value[e.name],type:"button",class:v([b.value[e.name]?"bg-blue-600":"bg-gray-200 dark:bg-gray-600","relative inline-flex h-5 w-9 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out"])},[t("span",{class:v([b.value[e.name]?"translate-x-4":"translate-x-0","pointer-events-none inline-block h-4 w-4 transform rounded-full bg-white shadow ring-0 transition-colors duration-200 ease-in-out"])},null,2)],10,Lt),t("span",Ot,r(e.description),1)]))]))),128))])):m("",!0),t("div",qt,[t("button",{onClick:ie,class:"btn btn-primary",disabled:D.value},r(D.value?"Starting Task...":"Execute Command"),9,Pt)])])):(l(),o("div",It," Select a command to view details. "))])])):(l(),o("div",$t," No commands available for this binding. "))])]),_:1},8,["visible"])]))}};export{Ht as default};
