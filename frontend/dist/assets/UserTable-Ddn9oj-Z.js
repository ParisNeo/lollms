import{z as V,ai as j,a as z,s as R,r as f,c as w,b as r,e as d,f as t,i as F,v as H,p as q,D as b,d as p,t as l,F as I,x as P,y as k,m as U}from"./index-BmRbZGN5.js";const Q={class:"bg-white dark:bg-gray-800 shadow-sm rounded-lg overflow-hidden"},Y={class:"px-4 py-5 sm:p-6 space-y-4"},K={class:"border-t border-gray-200 dark:border-gray-700"},O={key:0,class:"p-6 text-center text-gray-500"},Z={key:1,class:"p-6 text-center text-gray-500"},G={key:2,class:"overflow-x-auto"},J={class:"min-w-full divide-y divide-gray-200 dark:divide-gray-700"},W={class:"bg-gray-50 dark:bg-gray-700/50"},X={scope:"col",class:"table-header"},ee={key:0},te={scope:"col",class:"table-header"},se={key:0},ae={class:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700"},oe={class:"table-cell"},ie={class:"flex items-center"},ne={class:"ml-4"},le={class:"text-sm font-medium text-gray-900 dark:text-white"},re={class:"text-sm text-gray-500 dark:text-gray-400"},de={class:"table-cell text-sm text-gray-500 dark:text-gray-400"},ce={class:"table-cell text-sm text-gray-500 dark:text-gray-400"},me={class:"table-cell text-sm text-gray-500 dark:text-gray-400"},ue={class:"table-cell text-sm text-gray-500 dark:text-gray-400"},ve={class:"table-cell"},ge={class:"flex flex-col gap-1 items-start"},fe={key:0,class:"status-badge status-badge-yellow",title:"This user has requested a password reset."},pe={class:"table-cell text-sm text-gray-500 dark:text-gray-400"},he={class:"table-cell text-right text-sm font-medium"},_e={class:"flex items-center justify-end space-x-3"},ye=["onClick"],xe=["onClick"],we=["onClick","title"],be=["onClick"],ke={__name:"UserTable",setup(Ue){const u=j(),n=z(),{allUsers:h,isLoadingUsers:C,globalSettings:S}=R(u),v=f(""),c=f("username"),m=f("asc"),A=w(()=>{const s=S.value.find(e=>e.key==="password_recovery_mode");return s?s.value:"manual"}),_=w(()=>{let s=[...h.value];if(v.value){const e=v.value.toLowerCase();s=s.filter(a=>a.username.toLowerCase().includes(e)||a.email&&a.email.toLowerCase().includes(e))}return c.value&&s.sort((e,a)=>{let o=e[c.value],i=a[c.value];return c.value==="last_activity_at"?(o=o?new Date(o).getTime():0,i=i?new Date(i).getTime():0):typeof o=="string"&&(o=o.toLowerCase(),i=i?i.toLowerCase():""),o<i?m.value==="asc"?-1:1:o>i?m.value==="asc"?1:-1:0}),s});function y(s){c.value===s?m.value=m.value==="asc"?"desc":"asc":(c.value=s,m.value="asc")}function M(s){if(!s)return"Never";const e=new Date(s),o=Math.round((new Date-e)/1e3);if(o<60)return`${o}s ago`;const i=Math.round(o/60);if(i<60)return`${i}m ago`;const g=Math.round(i/60);if(g<24)return`${g}h ago`;const x=Math.round(g/24);return x<7?`${x}d ago`:e.toLocaleDateString()}function $(s){return s.password_reset_token&&new Date(s.reset_token_expiry)>new Date}function L(s){n.openModal("adminUserEdit",{user:s,onUserUpdated:()=>u.fetchAllUsers()})}function D(){n.openModal("forceSettings",{onSettingsApplied:()=>u.fetchAllUsers()})}function T(s){n.initEmailModalState(),n.openModal("adminUserEmail",{user:s,onSend:async({subject:e,body:a,backgroundColor:o,sendAsText:i})=>{await u.sendEmailToUsers(e,a,[s.id],o,i)}})}function E(){const s=h.value.filter(e=>e.is_active&&e.receive_notification_emails&&e.email);A.value==="manual"?n.openModal("emailList",{users:s}):n.openModal("emailAllUsers")}async function N(s){const e=s.is_active?"deactivate":"activate";if(await n.showConfirmation({title:`${e.charAt(0).toUpperCase()+e.slice(1)} User?`,message:`Are you sure you want to ${e} the user "${s.username}"?`,confirmText:`Yes, ${e}`}))try{await U.post(`/api/admin/users/${s.id}/${e}`),n.addNotification(`User ${s.username} has been ${e}d.`,"success"),u.fetchAllUsers()}catch{}}async function B(s){if(await n.showConfirmation({title:"Delete User?",message:`This will permanently delete the user "${s.username}" and all associated data. This action cannot be undone.`,confirmText:"Yes, Delete User"}))try{await U.delete(`/api/admin/users/${s.id}`),n.addNotification(`User ${s.username} has been deleted.`,"success"),u.fetchAllUsers()}catch{}}return(s,e)=>(d(),r("div",Q,[t("div",Y,[t("div",{class:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4"},[e[3]||(e[3]=t("div",null,[t("h3",{class:"text-base font-semibold leading-6 text-gray-900 dark:text-white"},"All Users"),t("p",{class:"mt-1 max-w-2xl text-sm text-gray-500 dark:text-gray-400"},"A sortable and searchable list of all registered users.")],-1)),t("div",{class:"flex items-center gap-x-3"},[t("button",{onClick:E,class:"btn btn-primary"}," Email Users "),t("button",{onClick:D,class:"btn btn-secondary"}," Force Settings ")])]),F(t("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=a=>v.value=a),placeholder:"Search by username or email...",class:"input-field max-w-sm"},null,512),[[H,v.value]])]),t("div",K,[q(C)?(d(),r("div",O," Loading users... ")):_.value.length===0?(d(),r("div",Z," No users found. ")):(d(),r("div",G,[t("table",J,[t("thead",W,[t("tr",null,[t("th",X,[t("button",{onClick:e[1]||(e[1]=a=>y("username")),class:"flex items-center gap-1"},[e[4]||(e[4]=b(" User ")),c.value==="username"?(d(),r("span",ee,l(m.value==="asc"?"▲":"▼"),1)):p("",!0)])]),e[6]||(e[6]=t("th",{scope:"col",class:"table-header"}," Model/Binding ",-1)),e[7]||(e[7]=t("th",{scope:"col",class:"table-header"}," Vectorizer ",-1)),e[8]||(e[8]=t("th",{scope:"col",class:"table-header"}," Context Size ",-1)),t("th",te,[t("button",{onClick:e[2]||(e[2]=a=>y("last_activity_at")),class:"flex items-center gap-1"},[e[5]||(e[5]=b(" Last Seen ")),c.value==="last_activity_at"?(d(),r("span",se,l(m.value==="asc"?"▲":"▼"),1)):p("",!0)])]),e[9]||(e[9]=t("th",{scope:"col",class:"table-header"}," Status ",-1)),e[10]||(e[10]=t("th",{scope:"col",class:"table-header"}," Role ",-1)),e[11]||(e[11]=t("th",{scope:"col",class:"relative px-6 py-3"},[t("span",{class:"sr-only"},"Actions")],-1))])]),t("tbody",ae,[(d(!0),r(I,null,P(_.value,a=>(d(),r("tr",{key:a.id,class:"hover:bg-gray-50 dark:hover:bg-gray-700/50"},[t("td",oe,[t("div",ie,[t("div",ne,[t("div",le,l(a.username),1),t("div",re,l(a.email||"No email"),1)])])]),t("td",de,l(a.lollms_model_name||"Not Set"),1),t("td",ce,l(a.safe_store_vectorizer||"Not Set"),1),t("td",me,l(a.llm_ctx_size||"Default"),1),t("td",ue,l(M(a.last_activity_at)),1),t("td",ve,[t("div",ge,[t("span",{class:k([a.is_active?"status-badge-green":"status-badge-red","status-badge"])},l(a.is_active?"Active":"Inactive"),3),$(a)?(d(),r("span",fe," Reset Pending ")):p("",!0)])]),t("td",pe,l(a.is_admin?"Admin":"User"),1),t("td",he,[t("div",_e,[t("button",{onClick:o=>L(a),title:"Edit User",class:"action-icon"},e[12]||(e[12]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"w-5 h-5"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10"})],-1)]),8,ye),t("button",{onClick:o=>T(a),title:"Email User",class:"action-icon"},e[13]||(e[13]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"w-5 h-5"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M21.75 6.75v10.5a2.25 2.25 0 0 1-2.25 2.25h-15a2.25 2.25 0 0 1-2.25-2.25V6.75m19.5 0A2.25 2.25 0 0 0 19.5 4.5h-15a2.25 2.25 0 0 0-2.25 2.25m19.5 0v.243a2.25 2.25 0 0 1-1.07 1.916l-7.5 4.615a2.25 2.25 0 0 1-2.36 0L3.32 8.91a2.25 2.25 0 0 1-1.07-1.916V6.75"})],-1)]),8,xe),t("button",{onClick:o=>N(a),title:a.is_active?"Deactivate User":"Activate User",class:k(a.is_active?"action-icon-toggle-active":"action-icon-toggle-inactive")},e[14]||(e[14]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"w-5 h-5"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M5.636 5.636a9 9 0 1 0 12.728 0M12 3v9"})],-1)]),10,we),t("button",{onClick:o=>B(a),title:"Delete User",class:"action-icon-delete"},e[15]||(e[15]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"w-5 h-5"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"})],-1)]),8,be)])])]))),128))])])]))])]))}},Se=V(ke,[["__scopeId","data-v-a41a806f"]]);export{Se as default};
