import{z as ne,n as ie,a as re,u as de,s as z,r as p,o as ue,w as ce,c as h,b as n,e as o,f as t,h as pe,i as u,y as A,A as me,d as x,t as m,g as ve,v as M,l as k,B as ye,q as ge,k as fe,F as C,x as T,j as be,T as xe,C as F,p as V}from"./index-BBvexQ5i.js";import{_ as H}from"./McpCard-CpIaFJVZ.js";import _e from"./IconEye-DOi1EMd3.js";import he from"./IconEyeOff-BhIfnq0T.js";const ke={class:"space-y-10"},we={class:"border-b border-gray-200 dark:border-gray-700"},Se={class:"-mb-px flex space-x-6","aria-label":"Tabs"},Ae={key:0,class:"bg-white dark:bg-gray-800 shadow-md rounded-lg"},Me={class:"px-4 py-5 sm:p-6"},Ce={class:"text-xl font-bold leading-6 text-gray-900 dark:text-white capitalize"},Te={class:"mt-1 max-w-2xl text-sm text-gray-500 dark:text-gray-400"},$e={class:"border-t border-gray-200 dark:border-gray-700"},Ie={class:"grid grid-cols-1 sm:grid-cols-2 gap-6"},Ue=["placeholder"],De={key:0},Ee=["placeholder"],Re={key:1},Le={class:"mt-2 flex items-center gap-x-4"},Ne={class:"h-16 w-16 rounded-md bg-gray-200 dark:bg-gray-700 flex items-center justify-center overflow-hidden"},Pe=["src"],Fe={class:"flex-grow space-y-2"},Ve={class:"flex items-center gap-x-3"},He=["title"],je={class:"flex-grow flex flex-col"},Ge=["disabled"],Be={class:"space-y-4"},Oe={key:0,class:"mt-1 text-xs text-gray-500 dark:text-gray-400"},Xe={key:1,class:"relative"},qe=["type"],We={key:0,class:"p-4 space-y-4 border rounded-md dark:border-gray-600"},Ye={class:"mt-2 space-y-2"},Ke=["id","value"],ze=["for"],Je={key:0},Qe={class:"mt-1 flex items-center gap-x-3"},Ze={class:"text-sm text-gray-500 dark:text-gray-400 flex-grow"},et={class:"flex justify-end items-center gap-x-3 pt-2"},tt=["disabled"],st={class:"flex justify-between items-center mb-4 flex-wrap gap-4"},at={class:"flex items-center gap-x-3"},lt={key:0,class:"empty-state-card"},ot={key:1,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5"},nt={class:"flex justify-between items-center my-4 flex-wrap gap-4"},it=["disabled"],rt={key:0,class:"empty-state-card"},dt={key:1,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5"},ut={class:"flex justify-between items-center mb-4 flex-wrap gap-4"},ct={class:"flex items-center gap-x-3"},pt={key:0,class:"empty-state-card"},mt={key:1,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5"},vt={key:0,class:"empty-state-card"},yt={key:1,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5"},gt={__name:"ServicesSettings",setup(ft){const d=ie(),v=re(),J=de(),{userMcps:B,userApps:O}=z(d),{user:$}=z(J),i=p("mcps"),Q=[{id:"email",label:"Email Address"},{id:"first_name",label:"First Name"},{id:"family_name",label:"Family Name"},{id:"birth_date",label:"Birth Date"}],j=(s="mcps",e="user")=>({name:"",url:"",icon:"",active:!0,type:e,authentication_type:"none",authentication_key:"",sso_redirect_uri:"",sso_user_infos_to_share:[],port:null}),l=p(j()),c=p(null),I=p(!1),U=p(!1),S=p(!1),X=p(null),G=p(!1),D=p(!1);ue(()=>{d.fetchMcps(),d.fetchApps()}),ce(()=>l.value.icon,()=>{G.value=!1});const _=h(()=>c.value!==null),Z=h(()=>l.value.authentication_type==="lollms_sso"),w=h(()=>_.value&&c.value.is_installed),q=h(()=>B.value.filter(s=>s.type==="user").sort((s,e)=>s.name.localeCompare(e.name))),W=h(()=>B.value.filter(s=>s.type==="system").sort((s,e)=>s.name.localeCompare(e.name))),Y=h(()=>O.value.filter(s=>s.type==="user").sort((s,e)=>s.name.localeCompare(e.name))),K=h(()=>O.value.filter(s=>s.type==="system").sort((s,e)=>s.name.localeCompare(e.name)));function E(s,e="user"){_.value&&L(),i.value=s,l.value=j(s,e),D.value=!0,window.scrollTo({top:0,behavior:"smooth"})}function R(s,e){i.value=e,c.value={...s,_type:e},l.value.name=s.name,l.value.url=s.url||"",l.value.icon=s.icon||"",l.value.active=typeof s.active=="boolean"?s.active:!0,l.value.type=s.type||"user",l.value.authentication_type=s.authentication_type||"none",l.value.authentication_key="",l.value.sso_redirect_uri=s.sso_redirect_uri||"",l.value.sso_user_infos_to_share=s.sso_user_infos_to_share||[],l.value.port=s.port||null,D.value=!0,window.scrollTo({top:0,behavior:"smooth"})}function L(){c.value=null,l.value=j(i.value),S.value=!1,D.value=!1}function ee(){G.value=!0}async function te(){U.value=!0;try{await d.triggerMcpReload()}finally{U.value=!1}}async function se(){if(!l.value.name||!l.value.url&&!w.value){v.addNotification("Name and URL are required.","warning");return}I.value=!0;try{const s={...l.value};s.port&&(s.port=Number(s.port));const e=i.value==="apps";_.value?await(e?d.updateApp(c.value.id,s):d.updateMcp(c.value.id,s)):await(e?d.addApp(s):d.addMcp(s)),L()}finally{I.value=!1}}async function ae(s,e){if(await v.showConfirmation({title:"Generate New Secret?",message:`This will generate a new SSO secret for '${s.name}'. Your existing application using the old secret will no longer be able to authenticate. This action is irreversible.`,confirmText:"Generate Secret"})){const y=await(e==="apps"?d.generateAppSsoSecret(s.id):d.generateMcpSsoSecret(s.id));y&&v.openModal("passwordResetLink",{title:"New SSO Secret Generated",message:`This is the new SSO secret for '${s.name}'. Copy it now, as you will not be able to see it again.`,link:y,copyButtonText:"Copy Secret"})}}async function N(s,e){await v.showConfirmation({title:`Delete '${s.name}'?`,message:`Are you sure you want to remove this ${e==="mcps"?"MCP server":"Application"}? This cannot be undone.`,confirmText:"Delete"})&&(c.value&&c.value.id===s.id&&L(),await(e==="apps"?d.deleteApp(s.id):d.deleteMcp(s.id)))}function le(){X.value.click()}function oe(s){const e=s.target.files[0];if(!e)return;if(!["image/jpeg","image/png","image/gif","image/webp","image/svg+xml"].includes(e.type)){v.addNotification("Invalid file type. Please select an image.","error");return}if(e.type==="image/svg+xml"){const y=new FileReader;y.onload=g=>{l.value.icon=g.target.result},y.onerror=()=>{v.addNotification("Failed to read the SVG file.","error")},y.readAsDataURL(e),s.target.value="";return}const r=new FileReader;r.onload=y=>{const g=new Image;g.onload=()=>{let f=g.width,b=g.height;f>b?f>128&&(b=Math.round(b*(128/f)),f=128):b>128&&(f=Math.round(f*(128/b)),b=128);const P=document.createElement("canvas");P.width=f,P.height=b,P.getContext("2d").drawImage(g,0,0,f,b),l.value.icon=P.toDataURL("image/png")},g.onerror=()=>{v.addNotification("Failed to load image for processing.","error")},g.src=y.target.result},r.onerror=()=>{v.addNotification("Failed to read the file.","error")},r.readAsDataURL(e),s.target.value=""}return(s,e)=>(o(),n("div",ke,[t("div",we,[t("nav",Se,[t("button",{onClick:e[0]||(e[0]=a=>i.value="mcps"),class:A(["tab-button",i.value==="mcps"?"active":"inactive"])}," MCP Servers ",2),t("button",{onClick:e[1]||(e[1]=a=>i.value="apps"),class:A(["tab-button",i.value==="apps"?"active":"inactive"])}," Applications ",2)])]),pe(xe,{name:"form-fade"},{default:me(()=>[D.value?(o(),n("div",Ae,[t("div",Me,[t("h2",Ce,m(_.value?"Edit":"Add")+" "+m(l.value.type)+" "+m(i.value==="mcps"?"MCP Server":"Application"),1),t("p",Te,m(l.value.type==="user"?"This is only available to you.":"This is available to all users."),1)]),t("div",$e,[t("form",{onSubmit:ve(se,["prevent"]),class:"p-4 sm:p-6 space-y-6"},[t("div",Ie,[t("div",null,[e[19]||(e[19]=t("label",{for:"formName",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Name",-1)),u(t("input",{type:"text",id:"formName","onUpdate:modelValue":e[2]||(e[2]=a=>l.value.name=a),class:"input-field mt-1",placeholder:i.value==="mcps"?"My Local Server":"My Web App",required:""},null,8,Ue),[[M,l.value.name]])]),w.value?(o(),n("div",Re,[e[21]||(e[21]=t("label",{for:"formPort",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Port",-1)),u(t("input",{type:"number",id:"formPort","onUpdate:modelValue":e[4]||(e[4]=a=>l.value.port=a),class:"input-field mt-1",placeholder:"e.g., 9601",required:""},null,512),[[M,l.value.port]])])):(o(),n("div",De,[e[20]||(e[20]=t("label",{for:"formUrl",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"URL",-1)),u(t("input",{type:"url",id:"formUrl","onUpdate:modelValue":e[3]||(e[3]=a=>l.value.url=a),class:"input-field mt-1",placeholder:i.value==="mcps"?"http://127.0.0.1:9602":"https://example.com",required:""},null,8,Ee),[[M,l.value.url]])]))]),t("div",null,[e[22]||(e[22]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Icon (Optional)",-1)),t("div",Le,[t("div",Ne,[l.value.icon&&!G.value?(o(),n("img",{key:0,src:l.value.icon,onError:ee,alt:"Icon Preview",class:"h-full w-full object-cover"},null,40,Pe)):(o(),k(ye,{key:1,class:"w-8 h-8 text-gray-500 dark:text-gray-400"}))]),t("div",Fe,[u(t("input",{type:"text","onUpdate:modelValue":e[5]||(e[5]=a=>l.value.icon=a),class:"input-field",placeholder:"Paste image URL or upload a file"},null,512),[[M,l.value.icon]]),t("div",Ve,[t("button",{onClick:le,type:"button",class:"btn btn-secondary text-sm"},"Upload File"),l.value.icon?(o(),n("button",{key:0,onClick:e[6]||(e[6]=a=>l.value.icon=""),type:"button",class:"text-sm font-medium text-red-600 hover:text-red-500"},"Remove")):x("",!0)])])]),t("input",{type:"file",ref_key:"fileInput",ref:X,onChange:oe,class:"hidden",accept:"image/png, image/jpeg, image/gif, image/webp, image/svg+xml"},null,544)]),t("div",{class:"flex items-center justify-between bg-gray-50 dark:bg-gray-700/50 p-3 rounded-md",title:w.value?"Status is controlled from the Apps Management panel":""},[t("span",je,[t("span",{class:A(["text-sm font-medium",w.value?"text-gray-500 dark:text-gray-400":"text-gray-900 dark:text-gray-100"])},"Active",2),e[23]||(e[23]=t("span",{class:"text-sm text-gray-500 dark:text-gray-400"},"Inactive items cannot be used.",-1))]),t("button",{onClick:e[7]||(e[7]=a=>l.value.active=!l.value.active),type:"button",disabled:w.value,class:A([l.value.active?"bg-blue-600":"bg-gray-200 dark:bg-gray-600","relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800",{"opacity-50 cursor-not-allowed":w.value}])},[t("span",{class:A([l.value.active?"translate-x-5":"translate-x-0","pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out"])},null,2)],10,Ge)],8,He),t("fieldset",Be,[e[26]||(e[26]=t("legend",{class:"text-sm font-medium text-gray-700 dark:text-gray-300"},"Authentication",-1)),u(t("select",{id:"formAuthType","onUpdate:modelValue":e[8]||(e[8]=a=>l.value.authentication_type=a),class:"input-field"},e[24]||(e[24]=[t("option",{value:"none"},"None",-1),t("option",{value:"lollms_sso"},"LoLLMs SSO",-1),t("option",{value:"lollms_chat_auth"},"LoLLMs Chat Auth",-1),t("option",{value:"bearer"},"Bearer Token",-1)]),512),[[ge,l.value.authentication_type]]),l.value.authentication_type==="lollms_chat_auth"?(o(),n("p",Oe," A temporary token will be generated by LoLLMs for each session. ")):x("",!0),l.value.authentication_type==="bearer"?(o(),n("div",Xe,[e[25]||(e[25]=t("label",{for:"formKey",class:"sr-only"},"Authentication Key",-1)),u(t("input",{type:S.value?"text":"password",id:"formKey","onUpdate:modelValue":e[9]||(e[9]=a=>l.value.authentication_key=a),class:"input-field pr-10",placeholder:"Paste your Bearer token here"},null,8,qe),[[fe,l.value.authentication_key]]),t("button",{type:"button",onClick:e[10]||(e[10]=a=>S.value=!S.value),class:"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600 dark:hover:text-gray-200"},[S.value?(o(),k(he,{key:0,class:"w-5 h-5"})):(o(),k(_e,{key:1,class:"w-5 h-5"}))])])):x("",!0)]),Z.value?(o(),n("div",We,[e[31]||(e[31]=t("h4",{class:"font-medium text-gray-800 dark:text-gray-200"},"SSO Configuration",-1)),t("div",null,[e[27]||(e[27]=t("label",{for:"ssoRedirectUri",class:"block text-sm font-medium"},"Redirect URI",-1)),u(t("input",{type:"url",id:"ssoRedirectUri","onUpdate:modelValue":e[11]||(e[11]=a=>l.value.sso_redirect_uri=a),class:"input-field mt-1",placeholder:"https://yourapp.com/lollms_auth",required:""},null,512),[[M,l.value.sso_redirect_uri]]),e[28]||(e[28]=t("p",{class:"mt-1 text-xs text-gray-500 dark:text-gray-400"},"The URL where users are sent after successful authentication.",-1))]),t("div",null,[e[29]||(e[29]=t("label",{class:"block text-sm font-medium"},"User Info to Share",-1)),t("div",Ye,[(o(),n(C,null,T(Q,a=>t("div",{key:a.id,class:"flex items-center"},[u(t("input",{id:`sso-info-${a.id}`,type:"checkbox",value:a.id,"onUpdate:modelValue":e[12]||(e[12]=r=>l.value.sso_user_infos_to_share=r),class:"h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500"},null,8,Ke),[[be,l.value.sso_user_infos_to_share]]),t("label",{for:`sso-info-${a.id}`,class:"ml-2 text-sm text-gray-700 dark:text-gray-300"},m(a.label),9,ze)])),64))])]),_.value?(o(),n("div",Je,[e[30]||(e[30]=t("label",{class:"block text-sm font-medium"},"SSO Secret",-1)),t("div",Qe,[t("p",Ze,m(c.value.sso_secret_exists?"A secret is configured.":"No secret has been generated."),1),t("button",{type:"button",onClick:e[13]||(e[13]=a=>ae(c.value,i.value)),class:"btn btn-secondary text-sm"},m(c.value.sso_secret_exists?"Regenerate Secret":"Generate Secret"),1)])])):x("",!0)])):x("",!0),t("div",et,[t("button",{onClick:L,type:"button",class:"btn btn-secondary"},"Cancel"),t("button",{type:"submit",class:"btn btn-primary",disabled:I.value},m(I.value?_.value?"Saving...":"Adding...":_.value?"Save Changes":`Add ${i.value==="mcps"?"MCP":"App"}`),9,tt)])],32)])])):x("",!0)]),_:1}),u(t("section",null,[t("div",st,[e[32]||(e[32]=t("h3",{class:"text-xl font-bold leading-6 text-gray-900 dark:text-white"},"Your Personal MCPs",-1)),t("div",at,[t("button",{onClick:e[14]||(e[14]=a=>E("mcps","user")),class:"btn btn-primary text-sm"},"+ Add Personal Server"),V($).is_admin?(o(),n("button",{key:0,onClick:e[15]||(e[15]=a=>E("mcps","system")),class:"btn btn-secondary text-sm"},"+ Add System Server")):x("",!0)])]),q.value.length===0?(o(),n("div",lt,e[33]||(e[33]=[t("p",null,"You haven't added any personal MCP servers yet.",-1)]))):(o(),n("div",ot,[(o(!0),n(C,null,T(q.value,a=>(o(),k(H,{key:a.id,mcp:a,"is-editable":"",onEdit:r=>R(a,"mcps"),onDelete:r=>N(a,"mcps")},null,8,["mcp","onEdit","onDelete"]))),128))]))],512),[[F,i.value==="mcps"]]),u(t("section",null,[t("div",nt,[e[34]||(e[34]=t("h3",{class:"text-xl font-bold leading-6 text-gray-900 dark:text-white"},"System MCPs",-1)),t("button",{onClick:e[16]||(e[16]=a=>te()),class:"btn btn-secondary text-sm",disabled:U.value},m(U.value?"Reloading...":"Reload All Servers"),9,it)]),W.value.length===0?(o(),n("div",rt,e[35]||(e[35]=[t("p",null,"No system-wide MCP servers are available.",-1)]))):(o(),n("div",dt,[(o(!0),n(C,null,T(W.value,a=>(o(),k(H,{key:a.id,mcp:a,"is-editable":V($).is_admin,onEdit:r=>R(a,"mcps"),onDelete:r=>N(a,"mcps")},null,8,["mcp","is-editable","onEdit","onDelete"]))),128))]))],512),[[F,i.value==="mcps"]]),u(t("section",null,[t("div",ut,[e[36]||(e[36]=t("h3",{class:"text-xl font-bold leading-6 text-gray-900 dark:text-white"},"Your Personal Apps",-1)),t("div",ct,[t("button",{onClick:e[17]||(e[17]=a=>E("apps","user")),class:"btn btn-primary text-sm"},"+ Add Personal App"),V($).is_admin?(o(),n("button",{key:0,onClick:e[18]||(e[18]=a=>E("apps","system")),class:"btn btn-secondary text-sm"},"+ Add System App")):x("",!0)])]),Y.value.length===0?(o(),n("div",pt,e[37]||(e[37]=[t("p",null,"You haven't added any personal Apps yet.",-1)]))):(o(),n("div",mt,[(o(!0),n(C,null,T(Y.value,a=>(o(),k(H,{key:a.id,mcp:a,"is-editable":"",onEdit:r=>R(a,"apps"),onDelete:r=>N(a,"apps")},null,8,["mcp","onEdit","onDelete"]))),128))]))],512),[[F,i.value==="apps"]]),u(t("section",null,[e[39]||(e[39]=t("h3",{class:"text-xl font-bold leading-6 text-gray-900 dark:text-white my-4"},"System Apps",-1)),K.value.length===0?(o(),n("div",vt,e[38]||(e[38]=[t("p",null,"No system-wide Apps are available.",-1)]))):(o(),n("div",yt,[(o(!0),n(C,null,T(K.value,a=>(o(),k(H,{key:a.id,mcp:a,"is-editable":V($).is_admin,onEdit:r=>R(a,"apps"),onDelete:r=>N(a,"apps")},null,8,["mcp","is-editable","onEdit","onDelete"]))),128))]))],512),[[F,i.value==="apps"]])]))}},At=ne(gt,[["__scopeId","data-v-97758c52"]]);export{At as default};
