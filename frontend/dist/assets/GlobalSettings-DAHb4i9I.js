import{c7 as V,a as C,r as p,c as M,o as U,w as x,b as n,d,h as a,P as F,F as S,m as w,t as y,g as G,l as m,c2 as L,$ as D,n as O,v as $,e as A,c8 as B,i as P}from"./index-DnjdbnqE.js";const R={class:"bg-white dark:bg-gray-800 shadow-md rounded-lg"},I={class:"space-y-10"},T={class:"text-lg font-medium text-gray-800 dark:text-gray-200 border-b border-gray-200 dark:border-gray-600 pb-2 mb-6"},z={class:"space-y-8"},q={key:0},H=["for"],K=["id","onUpdate:modelValue"],Q={key:1},W=["for"],X=["type","step","id","onUpdate:modelValue"],Y={key:2},Z={class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},ee={class:"mt-2"},te=["onClick"],ae={key:3},oe={class:"flex justify-between items-center mb-1"},se=["for"],re=["onClick"],le={key:0},ne=["id","onUpdate:modelValue"],de={key:1,class:"mt-2 p-4 rounded-md bg-gray-50 dark:bg-gray-900/50 border border-gray-200 dark:border-gray-700"},ie={class:"mt-8 pt-5 border-t border-gray-200 dark:border-gray-700"},ce={class:"flex justify-end"},ue=["disabled"],ye={key:1,class:"p-6 text-center"},fe={key:2,class:"p-6 text-center"},be={__name:"GlobalSettings",setup(pe){const i=V(),N=C(),s=p({}),f=p(!1),v=p(!1);let g="{}";const c=p({}),b=M(()=>{const o=i.globalSettings.filter(t=>t.category!=="Email Settings"&&t.category!=="Server"&&t.category!=="Registration"&&t.category!=="Defaults"&&t.key!=="password_recovery_mode"),u=["Authentication","Global LLM Overrides"],l=o.reduce((t,h)=>{const k=h.category||"General";return t[k]||(t[k]=[]),t[k].push(h),t},{}),e={};return u.forEach(t=>{l[t]&&(e[t]=l[t])}),Object.keys(l).forEach(t=>{u.includes(t)||(e[t]=l[t])}),e});U(()=>{i.globalSettings.length===0?i.fetchGlobalSettings():_()}),x(()=>i.globalSettings,_,{deep:!0}),x(s,r=>{v.value=JSON.stringify(r)!==g},{deep:!0});function _(){const r={};i.globalSettings.length>0&&(i.globalSettings.forEach(o=>{if(o.type==="json"){try{r[o.key]=JSON.stringify(o.value,null,2)}catch{r[o.key]=o.value}c.value[o.key]=!1}else r[o.key]=o.value}),s.value=r,g=JSON.parse(JSON.stringify(r)),v.value=!1)}function j(r){try{return JSON.parse(s.value[r])}catch(o){return{error:"Invalid JSON format in text editor",details:o.message}}}function J(r){c.value[r]=!c.value[r]}async function E(){f.value=!0;const r=Object.values(b.value).flat(),o={};let u=!1;for(const l of r){const e=l.key;if(s.value.hasOwnProperty(e))if(l.type==="json")try{o[e]=JSON.parse(s.value[e])}catch{N.addNotification(`Invalid JSON format for '${l.description}'. Please fix it before saving.`,"error"),u=!0}else o[e]=s.value[e]}if(u){f.value=!1;return}try{await i.updateGlobalSettings(o),Object.keys(c.value).forEach(l=>c.value[l]=!1)}catch{}finally{f.value=!1}}return(r,o)=>(d(),n("div",R,[o[3]||(o[3]=a("div",{class:"p-6 border-b border-gray-200 dark:border-gray-700"},[a("h3",{class:"text-xl font-semibold leading-6 text-gray-900 dark:text-white"}," Application Settings "),a("p",{class:"mt-1 text-sm text-gray-500 dark:text-gray-400"}," Manage miscellaneous application-wide settings. ")],-1)),Object.keys(b.value).length?(d(),n("form",{key:0,onSubmit:F(E,["prevent"]),class:"p-6"},[a("div",I,[(d(!0),n(S,null,w(b.value,(u,l)=>(d(),n("div",{key:l},[a("h4",T,y(l),1),a("div",z,[(d(!0),n(S,null,w(u,e=>(d(),n("div",{key:e.key},[e.key.includes("force_")&&e.key.includes("_mode")?(d(),n("div",q,[a("label",{for:e.key,class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},y(e.description),9,H),m(a("select",{id:e.key,"onUpdate:modelValue":t=>s.value[e.key]=t,class:"input-field mt-1"},o[0]||(o[0]=[a("option",{value:"disabled"},"Disabled",-1),a("option",{value:"force_once"},"Force Once (set user preference)",-1),a("option",{value:"force_always"},"Force Always (override session)",-1)]),8,K),[[L,s.value[e.key]]])])):["string","integer","float"].includes(e.type)?(d(),n("div",Q,[a("label",{for:e.key,class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},y(e.description),9,W),m(a("input",{type:e.type==="string"?"text":"number",step:e.type==="float"?"0.1":"1",id:e.key,"onUpdate:modelValue":t=>s.value[e.key]=t,class:"input-field mt-1"},null,8,X),[[D,s.value[e.key]]])])):e.type==="boolean"?(d(),n("div",Y,[a("label",Z,y(e.description),1),a("div",ee,[a("button",{onClick:t=>s.value[e.key]=!s.value[e.key],type:"button",class:O([s.value[e.key]?"bg-blue-600":"bg-gray-200 dark:bg-gray-600","relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800"])},[a("span",{class:O([s.value[e.key]?"translate-x-5":"translate-x-0","pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out"])},null,2)],10,te)])])):e.type==="json"?(d(),n("div",ae,[a("div",oe,[a("label",{for:e.key,class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},y(e.description),9,se),a("button",{onClick:t=>J(e.key),type:"button",class:"btn btn-secondary btn-xs"},y(c.value[e.key]?"View Rendered":"Edit Raw"),9,re)]),c.value[e.key]?(d(),n("div",le,[m(a("textarea",{id:e.key,"onUpdate:modelValue":t=>s.value[e.key]=t,rows:"8",class:"input-field w-full font-mono text-xs !leading-relaxed",placeholder:"Enter valid JSON here..."},null,8,ne),[[$,s.value[e.key]]])])):(d(),n("div",de,[A(B,{json:j(e.key)},null,8,["json"])]))])):G("",!0)]))),128))])]))),128))]),a("div",ie,[a("div",ce,[a("button",{type:"submit",class:"btn btn-primary",disabled:f.value||!v.value},y(f.value?"Saving...":"Save Settings"),9,ue)])])],32)):P(i).isLoadingSettings?(d(),n("div",ye,o[1]||(o[1]=[a("p",{class:"text-gray-500"},"Loading settings...",-1)]))):(d(),n("div",fe,o[2]||(o[2]=[a("p",{class:"text-gray-500"},"No application settings available.",-1)])))]))}};export{be as default};
