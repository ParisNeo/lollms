import{C as S,a as L,s as T,r as g,c as M,b as i,e as n,f as t,h as N,v as R,l as B,K as f,d as x,t as d,F as E,m as V,y as q,j as w}from"./index-BWVNZf8Q.js";const F={class:"bg-white dark:bg-gray-800 shadow-sm rounded-lg overflow-hidden"},K={class:"px-4 py-5 sm:p-6 space-y-4"},P={class:"border-t border-gray-200 dark:border-gray-700"},Q={key:0,class:"p-6 text-center text-gray-500"},Y={key:1,class:"p-6 text-center text-gray-500"},j={key:2,class:"overflow-x-auto"},z={class:"min-w-full divide-y divide-gray-200 dark:divide-gray-700"},H={class:"bg-gray-50 dark:bg-gray-700/50"},I={scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider"},O={key:0},G={scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider"},J={key:0},W={scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider"},X={key:0},Z={scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider"},ee={key:0},te={class:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700"},se={class:"px-6 py-4 whitespace-nowrap"},ae={class:"flex items-center"},oe={class:"ml-4"},re={class:"text-sm font-medium text-gray-900 dark:text-white"},ie={class:"text-sm text-gray-500 dark:text-gray-400"},ne={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400"},le={class:"px-6 py-4 whitespace-nowrap"},de={class:"flex flex-col gap-1 items-start"},ce={key:0,class:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-yellow-100 text-yellow-800 dark:bg-yellow-900/50 dark:text-yellow-300",title:"This user has requested a password reset."},ue={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400"},xe={class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium space-x-2"},pe=["onClick"],me=["onClick"],ye=["onClick"],ge={__name:"UserTable",setup(fe){const p=S(),u=L(),{allUsers:k,isLoadingUsers:b}=T(p),m=g(""),l=g("username"),c=g("asc"),_=M(()=>{let a=[...k.value];if(m.value){const e=m.value.toLowerCase();a=a.filter(s=>s.username.toLowerCase().includes(e)||s.email&&s.email.toLowerCase().includes(e))}return l.value&&a.sort((e,s)=>{let o=e[l.value],r=s[l.value];return l.value==="last_activity_at"?(o=o?new Date(o).getTime():0,r=r?new Date(r).getTime():0):typeof o=="string"&&(o=o.toLowerCase(),r=r?r.toLowerCase():""),o<r?c.value==="asc"?-1:1:o>r?c.value==="asc"?1:-1:0}),a});function y(a){l.value===a?c.value=c.value==="asc"?"desc":"asc":(l.value=a,c.value="asc")}function C(a){if(!a)return"Never";const e=new Date(a),o=Math.round((new Date-e)/1e3);if(o<60)return`${o}s ago`;const r=Math.round(o/60);if(r<60)return`${r}m ago`;const v=Math.round(r/60);if(v<24)return`${v}h ago`;const h=Math.round(v/24);return h<7?`${h}d ago`:e.toLocaleDateString()}function U(a){return a.password_reset_token&&new Date(a.reset_token_expiry)>new Date}function $(a){u.openModal("adminUserEdit",{user:a,onUserUpdated:()=>p.fetchAllUsers()})}async function A(a){const e=a.is_active?"deactivate":"activate";if(await u.showConfirmation({title:`${e.charAt(0).toUpperCase()+e.slice(1)} User?`,message:`Are you sure you want to ${e} the user "${a.username}"?`,confirmText:`Yes, ${e}`}))try{await w.post(`/api/admin/users/${a.id}/${e}`),u.addNotification(`User ${a.username} has been ${e}d.`,"success"),p.fetchAllUsers()}catch{}}async function D(a){if(await u.showConfirmation({title:"Delete User?",message:`This will permanently delete the user "${a.username}" and all associated data. This action cannot be undone.`,confirmText:"Yes, Delete User"}))try{await w.delete(`/api/admin/users/${a.id}`),u.addNotification(`User ${a.username} has been deleted.`,"success"),p.fetchAllUsers()}catch{}}return(a,e)=>(n(),i("div",F,[t("div",K,[e[5]||(e[5]=t("div",null,[t("h3",{class:"text-base font-semibold leading-6 text-gray-900 dark:text-white"},"All Users"),t("p",{class:"mt-1 max-w-2xl text-sm text-gray-500 dark:text-gray-400"},"A sortable and searchable list of all registered users.")],-1)),N(t("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=s=>m.value=s),placeholder:"Search by username or email...",class:"input-field max-w-sm"},null,512),[[R,m.value]])]),t("div",P,[B(b)?(n(),i("div",Q," Loading users... ")):_.value.length===0?(n(),i("div",Y," No users found. ")):(n(),i("div",j,[t("table",z,[t("thead",H,[t("tr",null,[t("th",I,[t("button",{onClick:e[1]||(e[1]=s=>y("username")),class:"flex items-center gap-1"},[e[6]||(e[6]=f(" User ")),l.value==="username"?(n(),i("span",O,d(c.value==="asc"?"▲":"▼"),1)):x("",!0)])]),t("th",G,[t("button",{onClick:e[2]||(e[2]=s=>y("last_activity_at")),class:"flex items-center gap-1"},[e[7]||(e[7]=f(" Last Seen ")),l.value==="last_activity_at"?(n(),i("span",J,d(c.value==="asc"?"▲":"▼"),1)):x("",!0)])]),t("th",W,[t("button",{onClick:e[3]||(e[3]=s=>y("is_active")),class:"flex items-center gap-1"},[e[8]||(e[8]=f(" Status ")),l.value==="is_active"?(n(),i("span",X,d(c.value==="asc"?"▲":"▼"),1)):x("",!0)])]),t("th",Z,[t("button",{onClick:e[4]||(e[4]=s=>y("is_admin")),class:"flex items-center gap-1"},[e[9]||(e[9]=f(" Role ")),l.value==="is_admin"?(n(),i("span",ee,d(c.value==="asc"?"▲":"▼"),1)):x("",!0)])]),e[10]||(e[10]=t("th",{scope:"col",class:"relative px-6 py-3"},[t("span",{class:"sr-only"},"Actions")],-1))])]),t("tbody",te,[(n(!0),i(E,null,V(_.value,s=>(n(),i("tr",{key:s.id},[t("td",se,[t("div",ae,[t("div",oe,[t("div",re,d(s.username),1),t("div",ie,d(s.email||"No email"),1)])])]),t("td",ne,d(C(s.last_activity_at)),1),t("td",le,[t("div",de,[t("span",{class:q([s.is_active?"bg-green-100 text-green-800 dark:bg-green-900/50 dark:text-green-300":"bg-red-100 text-red-800 dark:bg-red-900/50 dark:text-red-300","px-2 inline-flex text-xs leading-5 font-semibold rounded-full"])},d(s.is_active?"Active":"Inactive"),3),U(s)?(n(),i("span",ce," Reset Pending ")):x("",!0)])]),t("td",ue,d(s.is_admin?"Admin":"User"),1),t("td",xe,[t("button",{onClick:o=>$(s),class:"text-blue-600 hover:text-blue-900 dark:text-blue-400 dark:hover:text-blue-300"},"Edit",8,pe),t("button",{onClick:o=>A(s),class:"text-yellow-600 hover:text-yellow-900 dark:text-yellow-400 dark:hover:text-yellow-300"},d(s.is_active?"Deactivate":"Activate"),9,me),t("button",{onClick:o=>D(s),class:"text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-300"},"Delete",8,ye)])]))),128))])])]))])]))}};export{ge as default};
