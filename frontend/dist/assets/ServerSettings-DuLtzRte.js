import{M as S,c as V,b as s,d as o,h as t,F as f,k as b,e as I,cS as R,bZ as j,Q as _,ad as N,cU as O,L as $,n as q,P as G,a3 as J,c1 as P,a as Z,a6 as z,o as Q,w as L,g as A,p as T,t as k,K as h,Z as B,bY as M,l as Y}from"./index-BX8JWUVq.js";import{I as H}from"./IconArrowUp-DrkgZZYc.js";const W={class:"space-y-2"},X=["value","onInput"],ee=["onClick","disabled"],te=["onClick","disabled"],le=["onClick"],ae={class:"flex items-center gap-2"},oe=["onKeyup"],se={__name:"StringListEditor",props:{modelValue:{type:[String,Array],default:""}},emits:["update:modelValue"],setup(D,{emit:v}){const U=D,w=v,l=S(""),u=V({get:()=>{const r=U.modelValue;return Array.isArray(r)?r.map(i=>String(i).trim()).filter(i=>i):typeof r=="string"?(r||"").split(",").map(i=>i.trim()).filter(i=>i):[]},set:r=>{w("update:modelValue",r.join(", "))}});function g(){l.value.trim()&&!u.value.includes(l.value.trim())&&(u.value=[...u.value,l.value.trim()],l.value="")}function x(r){const i=[...u.value];i.splice(r,1),u.value=i}function m(r,i){const y=[...u.value],d=r+i;d>=0&&d<y.length&&([y[r],y[d]]=[y[d],y[r]],u.value=y)}return(r,i)=>(o(),s("div",W,[(o(!0),s(f,null,b(u.value,(y,d)=>(o(),s("div",{key:d,class:"flex items-center gap-2"},[t("input",{type:"text",value:y,onInput:p=>{const C=[...u.value];C[d]=p.target.value,u.value=C},class:"input-field flex-grow"},null,40,X),t("button",{onClick:p=>m(d,-1),disabled:d===0,class:"btn-icon",type:"button",title:"Move Up"},[I(H,{class:"w-4 h-4"})],8,ee),t("button",{onClick:p=>m(d,1),disabled:d===u.value.length-1,class:"btn-icon",type:"button",title:"Move Down"},[I(R,{class:"w-4 h-4"})],8,te),t("button",{onClick:p=>x(d),class:"btn-icon-danger",type:"button",title:"Remove"},[I(j,{class:"w-4 h-4"})],8,le)]))),128)),t("div",ae,[_(t("input",{type:"text","onUpdate:modelValue":i[0]||(i[0]=y=>l.value=y),onKeyup:O($(g,["prevent"]),["enter"]),class:"input-field flex-grow",placeholder:"Add new origin"},null,40,oe),[[N,l.value]]),t("button",{onClick:g,class:"btn btn-secondary",type:"button"},[I(G,{class:"w-4 h-4 mr-1"}),i[1]||(i[1]=q(" Add"))])])]))}},ne={class:"bg-white dark:bg-gray-800 shadow-md rounded-lg"},re={class:"space-y-10"},ie={key:0},ue={class:"space-y-6"},de=["for"],ce={key:1,class:"flex items-center gap-2"},ye=["id","onUpdate:modelValue"],ve={key:2,class:"flex items-center gap-2"},pe=["id","onUpdate:modelValue"],ke={key:3,class:"toggle-container-flat"},fe=["onClick"],be=["type","id","onUpdate:modelValue","readonly"],me={key:1},_e={class:"space-y-6"},ge={class:"toggle-label"},he=["onClick"],Se=["for"],we=["id","onUpdate:modelValue"],xe={key:2},Ve={class:"space-y-6"},Ue={class:"toggle-label"},Ce=["onClick"],Ie=["for"],$e=["type","id","onUpdate:modelValue"],Ae=["id","onUpdate:modelValue"],Me=["value"],Ne=["for"],De=["id","onUpdate:modelValue"],Fe=["value"],Le={class:"mt-8 pt-5 border-t border-gray-200 dark:border-gray-700"},Be={class:"flex justify-end"},Ee=["disabled"],Ke={key:1,class:"p-6 text-center text-gray-500"},Re={key:0},je={key:1},Oe={__name:"ServerSettings",setup(D){const v=P(),U=Z(),w=z(),l=S({}),u=S(!1),g=S(!1);let x="{}";const m=S(null),r=S(null),i=[{value:0,label:"Beginner"},{value:1,label:"Novice"},{value:2,label:"Intermediate"},{value:3,label:"Advanced"},{value:4,label:"Expert"}],y=V(()=>v.globalSettings.filter(c=>c.category==="Server")),d=V(()=>v.globalSettings.filter(c=>c.category==="Registration")),p=V(()=>v.globalSettings.filter(c=>c.category==="Defaults")),C=V(()=>w.availableLollmsModels);Q(async()=>{v.globalSettings.length===0&&await v.fetchGlobalSettings(),w.availableLollmsModels.length===0&&await w.fetchAdminAvailableLollmsModels()}),L(()=>v.globalSettings,E,{deep:!0,immediate:!0}),L(l,c=>{g.value=JSON.stringify(c)!==x},{deep:!0});function E(){const c=v.globalSettings;if(!c||c.length===0){l.value={},x="{}",g.value=!1;return}const n={};c.filter(a=>["Server","Registration","Defaults"].includes(a.category)).forEach(a=>{n[a.key]=a.value}),l.value=n,x=JSON.stringify(n),g.value=!1}async function F(c,n){const e=c.target.files[0];if(e){u.value=!0;try{const a=await v.uploadSslFile(e,n);n==="cert"?l.value.ssl_certfile=a:n==="key"&&(l.value.ssl_keyfile=a),U.addNotification(`${e.name} uploaded successfully.`,"success")}finally{u.value=!1,m.value&&m.value.length>0&&(m.value[0].value=""),r.value&&r.value.length>0&&(r.value[0].value="")}}}async function K(){u.value=!0;try{await v.updateGlobalSettings({...l.value}),U.addNotification("Settings saved. A server restart may be required for some changes to take effect.","info",8e3)}finally{u.value=!1}}return(c,n)=>(o(),s("div",ne,[n[10]||(n[10]=t("div",{class:"p-6 border-b border-gray-200 dark:border-gray-700"},[t("h3",{class:"text-xl font-semibold leading-6 text-gray-900 dark:text-white"},"Server Settings"),t("p",{class:"mt-1 text-sm text-gray-500 dark:text-gray-400"},"Manage core server behavior, user registration, and defaults for new users.")],-1)),Object.keys(l.value).length?(o(),s("form",{key:0,onSubmit:$(K,["prevent"]),class:"p-6"},[t("div",re,[y.value.length>0?(o(),s("div",ie,[n[5]||(n[5]=t("h4",{class:"settings-category-title"},"Server Configuration",-1)),t("div",ue,[n[4]||(n[4]=t("div",{class:"p-4 bg-yellow-50 dark:bg-yellow-900/20 border-l-4 border-yellow-400 text-yellow-800 dark:text-yellow-200 rounded-r-lg"},[t("p",{class:"text-sm font-medium"},"A server restart is required for any changes in this section to take effect.")],-1)),(o(!0),s(f,null,b(y.value,e=>(o(),s("div",{key:e.key,class:"space-y-1"},[t("label",{for:e.key,class:"label"},k(e.description),9,de),e.key==="cors_origins_exceptions"?(o(),T(se,{key:0,modelValue:l.value[e.key],"onUpdate:modelValue":a=>l.value[e.key]=a},null,8,["modelValue","onUpdate:modelValue"])):e.key==="ssl_certfile"?(o(),s("div",ce,[_(t("input",{type:"text",id:e.key,"onUpdate:modelValue":a=>l.value[e.key]=a,class:"input-field flex-grow",placeholder:"/path/to/cert.pem"},null,8,ye),[[N,l.value[e.key]]]),t("input",{type:"file",ref_for:!0,ref_key:"certFileInput",ref:m,onChange:n[0]||(n[0]=a=>F(a,"cert")),class:"hidden"},null,544),t("button",{onClick:n[1]||(n[1]=$(a=>m.value[0].click(),["prevent"])),type:"button",class:"btn btn-secondary"},"Upload")])):e.key==="ssl_keyfile"?(o(),s("div",ve,[_(t("input",{type:"text",id:e.key,"onUpdate:modelValue":a=>l.value[e.key]=a,class:"input-field flex-grow",placeholder:"/path/to/key.pem"},null,8,pe),[[N,l.value[e.key]]]),t("input",{type:"file",ref_for:!0,ref_key:"keyFileInput",ref:r,onChange:n[2]||(n[2]=a=>F(a,"key")),class:"hidden"},null,544),t("button",{onClick:n[3]||(n[3]=$(a=>r.value[0].click(),["prevent"])),type:"button",class:"btn btn-secondary"},"Upload")])):e.type==="boolean"?(o(),s("div",ke,[t("button",{onClick:a=>l.value[e.key]=!l.value[e.key],type:"button",class:h([l.value[e.key]?"bg-blue-600":"bg-gray-200 dark:bg-gray-600","toggle-switch"])},[t("span",{class:h([l.value[e.key]?"translate-x-5":"translate-x-0","toggle-knob"])},null,2)],10,fe)])):_((o(),s("input",{key:4,type:e.type==="string"?"text":e.type==="integer"||e.type==="float"?"number":"text",id:e.key,"onUpdate:modelValue":a=>l.value[e.key]=a,class:h(["input-field",{"bg-gray-100 dark:bg-gray-700 cursor-not-allowed":e.key==="data_path"||e.key==="huggingface_cache_path"}]),readonly:e.key==="data_path"||e.key==="huggingface_cache_path"},null,10,be)),[[B,l.value[e.key]]])]))),128))])])):A("",!0),d.value.length>0?(o(),s("div",me,[n[7]||(n[7]=t("h4",{class:"settings-category-title"},"New User Registration",-1)),t("div",_e,[(o(!0),s(f,null,b(d.value.filter(e=>e.type==="boolean"),e=>(o(),s("div",{key:e.key,class:"toggle-container"},[t("span",ge,k(e.description),1),t("button",{onClick:a=>l.value[e.key]=!l.value[e.key],type:"button",class:h([l.value[e.key]?"bg-blue-600":"bg-gray-200 dark:bg-gray-600","toggle-switch"])},[t("span",{class:h([l.value[e.key]?"translate-x-5":"translate-x-0","toggle-knob"])},null,2)],10,he)]))),128)),(o(!0),s(f,null,b(d.value.filter(e=>e.key==="registration_mode"),e=>(o(),s("div",{key:e.key},[t("label",{for:e.key,class:"label"},k(e.description),9,Se),_(t("select",{id:e.key,"onUpdate:modelValue":a=>l.value[e.key]=a,class:"input-field mt-1"},n[6]||(n[6]=[t("option",{value:"direct"},"Direct (instantly active)",-1),t("option",{value:"admin_approval"},"Admin Approval",-1)]),8,we),[[M,l.value[e.key]]])]))),128))])])):A("",!0),p.value.length>0?(o(),s("div",xe,[n[9]||(n[9]=t("h4",{class:"settings-category-title"},"Defaults for New Users",-1)),t("div",Ve,[(o(!0),s(f,null,b(p.value.filter(e=>e.type==="boolean"),e=>(o(),s("div",{key:e.key,class:"toggle-container"},[t("span",Ue,k(e.description),1),t("button",{onClick:a=>l.value[e.key]=!l.value[e.key],type:"button",class:h([l.value[e.key]?"bg-blue-600":"bg-gray-200 dark:bg-gray-600","toggle-switch"])},[t("span",{class:h([l.value[e.key]?"translate-x-5":"translate-x-0","toggle-knob"])},null,2)],10,Ce)]))),128)),(o(!0),s(f,null,b(p.value.filter(e=>e.type!=="boolean"&&e.key!=="default_user_ui_level"),e=>(o(),s("div",{key:e.key},[t("label",{for:e.key,class:"label"},k(e.description),9,Ie),e.key!=="default_lollms_model_name"?_((o(),s("input",{key:0,type:e.type==="string"?"text":"number",id:e.key,"onUpdate:modelValue":a=>l.value[e.key]=a,class:"input-field mt-1"},null,8,$e)),[[B,l.value[e.key]]]):_((o(),s("select",{key:1,id:e.key,"onUpdate:modelValue":a=>l.value[e.key]=a,class:"input-field mt-1"},[n[8]||(n[8]=t("option",{value:""},"(None)",-1)),(o(!0),s(f,null,b(C.value,a=>(o(),s("option",{key:a.id,value:a.id},k(a.name),9,Me))),128))],8,Ae)),[[M,l.value[e.key]]])]))),128)),(o(!0),s(f,null,b(p.value.filter(e=>e.key==="default_user_ui_level"),e=>(o(),s("div",{key:e.key},[t("label",{for:e.key,class:"label"},k(e.description),9,Ne),_(t("select",{id:e.key,"onUpdate:modelValue":a=>l.value[e.key]=a,class:"input-field mt-1"},[(o(),s(f,null,b(i,a=>t("option",{key:a.value,value:a.value},k(a.label),9,Fe)),64))],8,De),[[M,l.value[e.key],void 0,{number:!0}]])]))),128))])])):A("",!0)]),t("div",Le,[t("div",Be,[t("button",{type:"submit",class:"btn btn-primary",disabled:u.value||!g.value},k(u.value?"Saving...":"Save Settings"),9,Ee)])])],32)):(o(),s("div",Ke,[Y(v).isLoadingSettings?(o(),s("p",Re,"Loading settings...")):(o(),s("p",je,"Could not load server settings."))]))]))}},Je=J(Oe,[["__scopeId","data-v-f7632aab"]]);export{Je as default};
