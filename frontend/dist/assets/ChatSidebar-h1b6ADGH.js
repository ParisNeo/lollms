import{u as U,a as j,r as p,c,o as M,w as I,b as n,d as a,e as i,f as $,g as v,h as s,i as A,_ as D,n as x,j as L,k as q,l as F,v as E,F as g,m as h,p as H,t as f,q as J,U as G,T as N}from"./index-DnjdbnqE.js";import{_ as K}from"./DmWindow-CN0Y9hct.js";const P={key:0,class:"fixed inset-y-0 right-0 z-50 w-80 sm:w-96 bg-white dark:bg-gray-900 shadow-2xl flex flex-col border-l dark:border-gray-700"},Q={class:"flex items-center justify-between p-3 border-b dark:border-gray-700"},R={key:0,class:"flex-grow flex flex-col overflow-hidden"},W={key:1,class:"flex-grow flex flex-col overflow-hidden"},X={class:"flex border-b dark:border-gray-700"},Y={key:0,class:"flex-1 overflow-y-auto p-2 space-y-1"},Z={key:0,class:"p-3 bg-gray-100 dark:bg-gray-800 rounded mb-2"},ee={class:"max-h-32 overflow-y-auto mb-2 border rounded p-1"},te=["value"],se=["onClick"],ae={key:0,class:"w-10 h-10 bg-gray-300 rounded-full flex items-center justify-center text-gray-600 font-bold"},ne={class:"flex-1 min-w-0"},oe={class:"font-medium truncate"},re={class:"text-xs text-gray-500 truncate"},le={key:1,class:"flex-1 overflow-y-auto p-2 space-y-1"},ie=["onClick"],ue={class:"relative"},de=["title"],ce={class:"font-medium"},me={__name:"ChatSidebar",setup(ve){const r=U(),_=j(),l=p("chats"),b=c(()=>_.isChatSidebarOpen),k=c(()=>r.activeConversationId),w=c(()=>k.value?r.activeConversations[k.value]:null),C=c(()=>r.friends),T=c(()=>r.conversations),m=p(!1),u=p(""),d=p([]);function S(o){r.openConversation(o)}function V(){r.activeConversationId=null}async function z(){!u.value||d.value.length===0||(await r.createGroupConversation(u.value,d.value),m.value=!1,u.value="",d.value=[])}function B(o){return o==="connected"?"bg-green-500":o==="absent"?"bg-yellow-500":"bg-gray-400"}function O(o){return o==="connected"?"Online":o==="absent"?"Absent":"Offline"}return M(()=>{b.value&&(r.fetchFriends(),r.fetchConversations())}),I(b,o=>{o&&(r.fetchFriends(),r.fetchConversations())}),(o,t)=>(a(),n(g,null,[i(N,{"enter-active-class":"transform transition ease-in-out duration-300 sm:duration-500","enter-from-class":"translate-x-full","enter-to-class":"translate-x-0","leave-active-class":"transform transition ease-in-out duration-300 sm:duration-500","leave-from-class":"translate-x-0","leave-to-class":"translate-x-full"},{default:$(()=>[b.value?(a(),n("div",P,[s("div",Q,[t[7]||(t[7]=s("h2",{class:"font-semibold text-lg"},"Messaging",-1)),s("button",{onClick:t[0]||(t[0]=e=>A(_).isChatSidebarOpen=!1)},[i(D,{class:"w-5 h-5"})])]),w.value?(a(),n("div",R,[i(K,{conversation:w.value,compact:!0,onBack:V},null,8,["conversation"])])):(a(),n("div",W,[s("div",X,[s("button",{onClick:t[1]||(t[1]=e=>l.value="chats"),class:x(["flex-1 py-2 text-sm font-medium",l.value==="chats"?"border-b-2 border-blue-500 text-blue-600":"text-gray-500"])},"Chats",2),s("button",{onClick:t[2]||(t[2]=e=>l.value="friends"),class:x(["flex-1 py-2 text-sm font-medium",l.value==="friends"?"border-b-2 border-blue-500 text-blue-600":"text-gray-500"])},"Friends",2)]),l.value==="chats"?(a(),n("div",Y,[s("button",{onClick:t[3]||(t[3]=e=>m.value=!m.value),class:"w-full py-2 px-3 mb-2 bg-blue-50 dark:bg-blue-900/20 text-blue-600 rounded flex items-center justify-center gap-2 text-sm"},[i(q,{class:"w-4 h-4"}),t[8]||(t[8]=L(" New Group "))]),m.value?(a(),n("div",Z,[F(s("input",{"onUpdate:modelValue":t[4]||(t[4]=e=>u.value=e),placeholder:"Group Name",class:"input-field mb-2 w-full text-sm"},null,512),[[E,u.value]]),s("div",ee,[(a(!0),n(g,null,h(C.value,e=>(a(),n("label",{key:e.id,class:"flex items-center gap-2 p-1"},[F(s("input",{type:"checkbox",value:e.id,"onUpdate:modelValue":t[5]||(t[5]=y=>d.value=y)},null,8,te),[[H,d.value]]),s("span",null,f(e.username),1)]))),128))]),s("button",{onClick:z,class:"btn btn-primary btn-sm w-full"},"Create")])):v("",!0),(a(!0),n(g,null,h(T.value,e=>(a(),n("div",{key:e.id||e.partner_user_id,onClick:y=>S(e),class:"flex items-center gap-3 p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded cursor-pointer"},[e.is_group?(a(),n("div",ae,f(e.name?e.name[0]:"G"),1)):(a(),J(G,{key:1,username:e.partner_username,icon:e.partner_icon,"size-class":"w-10 h-10"},null,8,["username","icon"])),s("div",ne,[s("div",oe,f(e.is_group?e.name:e.partner_username),1),s("div",re,f(e.last_message),1)])],8,se))),128))])):v("",!0),l.value==="friends"?(a(),n("div",le,[(a(!0),n(g,null,h(C.value,e=>(a(),n("div",{key:e.id,onClick:y=>S(e),class:"flex items-center gap-3 p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded cursor-pointer relative"},[s("div",ue,[i(G,{username:e.username,icon:e.icon,"size-class":"w-10 h-10"},null,8,["username","icon"]),s("div",{class:x(["absolute -bottom-0.5 -right-0.5 w-3.5 h-3.5 border-2 border-white dark:border-gray-800 rounded-full",B(e.status)]),title:O(e.status)},null,10,de)]),s("span",ce,f(e.username),1)],8,ie))),128))])):v("",!0)]))])):v("",!0)]),_:1}),i(N,{"enter-active-class":"opacity-0 transition-opacity duration-300","enter-to-class":"opacity-100","leave-active-class":"opacity-100 transition-opacity duration-300","leave-to-class":"opacity-0"},{default:$(()=>[b.value?(a(),n("div",{key:0,onClick:t[6]||(t[6]=(...e)=>o.closeSidebar&&o.closeSidebar(...e)),class:"fixed inset-0 bg-black/20 z-40 sm:hidden"})):v("",!0)]),_:1})],64))}};export{me as default};
