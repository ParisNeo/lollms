import{s as q,a as j,b_ as O,c as S,r as n,o as L,w as U,b as A,g as V,d as m,h as e,P as I,e as W,U as z,t as k,l as u,v as w,p as D,$ as P,q as h,b$ as F,c0 as M,W as R}from"./index-DnjdbnqE.js";const H={key:0,class:"space-y-10"},K={class:"bg-white dark:bg-gray-800 shadow-md rounded-lg"},Q={class:"border-t border-gray-200 dark:border-gray-700 p-4 sm:p-6"},X={class:"flex-shrink-0 flex flex-col items-center space-y-2 w-full md:w-40"},Y=["disabled"],Z={class:"flex-grow space-y-6"},ee={class:"grid grid-cols-1 sm:grid-cols-2 gap-6"},te={class:"space-y-4 pt-4 border-t dark:border-gray-600"},ae={class:"relative flex items-start"},se={class:"flex h-6 items-center"},le={class:"relative flex items-start"},re={class:"flex h-6 items-center"},ie={class:"flex justify-end"},oe=["disabled"],ne={class:"bg-white dark:bg-gray-800 shadow-md rounded-lg"},de={class:"border-t border-gray-200 dark:border-gray-700"},ue={class:"mt-1 relative"},ce=["type"],me={class:"mt-1 relative"},fe=["type"],pe={class:"mt-1 relative"},ve=["type"],ye={class:"flex justify-end"},ge=["disabled"],we={__name:"AccountSettings",setup(be){const c=q(),o=j();O();const i=S(()=>c.user),s=n({first_name:"",family_name:"",email:"",birth_date:"",receive_notification_emails:!0,is_searchable:!0}),p=n(!1),N=n(!1);let _="{}";const d=n({current_password:"",new_password:""}),v=n(""),y=n(!1),g=n(!1),f=n(!1),b=n(!1),x=n(null),B=S(()=>{var l;return!!((l=i.value)!=null&&l.tti_binding_model_name)});function C(){i.value&&(s.value.first_name=i.value.first_name||"",s.value.family_name=i.value.family_name||"",s.value.email=i.value.email||"",s.value.birth_date=i.value.birth_date||"",s.value.receive_notification_emails=i.value.receive_notification_emails,s.value.is_searchable=i.value.is_searchable,_=JSON.stringify(s.value))}L(C),U(i,C,{deep:!0}),U(s,l=>{N.value=JSON.stringify(l)!==_},{deep:!0});async function E(){p.value=!0;try{const l=JSON.parse(_),t={};let a=!1;for(const r in s.value)s.value[r]!==l[r]&&(t[r]=s.value[r],a=!0);if(a){const r={...t};r.email===""&&(r.email=null),r.birth_date===""&&(r.birth_date=null),await c.updateUserProfile(r)}else o.addNotification("No changes to save.","info")}catch{}finally{p.value=!1}}async function G(){if(d.value.new_password!==v.value){o.addNotification("New passwords do not match.","error");return}if(d.value.new_password.length<8){o.addNotification("New password must be at least 8 characters long.","error");return}y.value=!0;try{await c.changePassword(d.value),d.value.current_password="",d.value.new_password="",v.value=""}catch{}finally{y.value=!1}}const T=()=>{var l;(l=x.value)==null||l.click()},$=async l=>{const t=l.target.files[0];if(!t)return;b.value=!0,o.addNotification("Uploading icon...","info");const a=new FormData;a.append("file",t);try{const r=await R.put("/api/auth/me/icon",a,{headers:{"Content-Type":"multipart/form-data"}});c.user&&(c.user.icon=r.data.icon_url),o.addNotification("Icon updated successfully!","success")}catch{o.addNotification("Icon upload failed.","error")}finally{b.value=!1,x.value&&(x.value.value="")}};async function J(){const{confirmed:l,value:t}=await o.showConfirmation({title:"Generate New Avatar",message:"Enter an optional prompt to guide the AI. If left blank, a prompt will be generated from your profile information.",confirmText:"Generate",inputType:"textarea",inputPlaceholder:"e.g., a professional photo, pixel art style..."});if(l)try{const a=await c.generateAvatar(t||null);a?o.openModal("tasksManager",{initialTaskId:a.id}):o.addNotification("Failed to start avatar generation task. Check server logs for details.","error")}catch(a){console.error("Error during handleGenerateAvatar:",a),o.addNotification("An unexpected error occurred while trying to generate the avatar.","error")}}return(l,t)=>i.value?(m(),A("div",H,[e("div",K,[t[18]||(t[18]=e("div",{class:"p-4 sm:p-6"},[e("h2",{class:"text-xl font-bold leading-6 text-gray-900 dark:text-white"},"Profile"),e("p",{class:"mt-1 max-w-2xl text-sm text-gray-500 dark:text-gray-400"},"Manage your public profile and personal information.")],-1)),e("div",Q,[e("form",{onSubmit:I(E,["prevent"]),class:"flex flex-col md:flex-row gap-8"},[e("div",X,[W(z,{icon:i.value.icon,username:i.value.username,"size-class":"h-28 w-28"},null,8,["icon","username"]),e("input",{type:"file",ref_key:"fileInput",ref:x,onChange:$,accept:"image/png, image/jpeg, image/webp",class:"hidden"},null,544),e("button",{type:"button",onClick:T,disabled:b.value,class:"btn btn-secondary w-full"},k(b.value?"Uploading...":"Change Icon"),9,Y),B.value?(m(),A("button",{key:0,type:"button",onClick:J,class:"btn btn-secondary-outline w-full"}," Generate Avatar ")):V("",!0),t[11]||(t[11]=e("p",{class:"text-xs text-center text-gray-500 dark:text-gray-400"},"Max 5MB (JPG, PNG, WEBP)",-1))]),e("div",Z,[e("div",ee,[e("div",null,[t[12]||(t[12]=e("label",{for:"firstName",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"First Name",-1)),u(e("input",{type:"text",id:"firstName","onUpdate:modelValue":t[0]||(t[0]=a=>s.value.first_name=a),class:"input-field mt-1",placeholder:"Jane"},null,512),[[w,s.value.first_name]])]),e("div",null,[t[13]||(t[13]=e("label",{for:"familyName",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Family Name",-1)),u(e("input",{type:"text",id:"familyName","onUpdate:modelValue":t[1]||(t[1]=a=>s.value.family_name=a),class:"input-field mt-1",placeholder:"Doe"},null,512),[[w,s.value.family_name]])])]),e("div",null,[t[14]||(t[14]=e("label",{for:"email",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Email Address",-1)),u(e("input",{type:"email",id:"email","onUpdate:modelValue":t[2]||(t[2]=a=>s.value.email=a),class:"input-field mt-1",placeholder:"you@example.com"},null,512),[[w,s.value.email]])]),e("div",null,[t[15]||(t[15]=e("label",{for:"birthDate",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Birth Date",-1)),u(e("input",{type:"date",id:"birthDate","onUpdate:modelValue":t[3]||(t[3]=a=>s.value.birth_date=a),class:"input-field mt-1"},null,512),[[w,s.value.birth_date]])]),e("div",te,[e("div",ae,[e("div",se,[u(e("input",{id:"is_searchable","onUpdate:modelValue":t[4]||(t[4]=a=>s.value.is_searchable=a),type:"checkbox",class:"h-4 w-4 rounded border-gray-300 dark:border-gray-600 text-blue-600 focus:ring-blue-600"},null,512),[[D,s.value.is_searchable]])]),t[16]||(t[16]=e("div",{class:"ml-3 text-sm leading-6"},[e("label",{for:"is_searchable",class:"font-medium text-gray-900 dark:text-gray-100"},"Profile Searchability"),e("p",{class:"text-gray-500 dark:text-gray-400"},"Allow other users to find your profile in searches.")],-1))]),e("div",le,[e("div",re,[u(e("input",{id:"receive_notification_emails","onUpdate:modelValue":t[5]||(t[5]=a=>s.value.receive_notification_emails=a),type:"checkbox",class:"h-4 w-4 rounded border-gray-300 dark:border-gray-600 text-blue-600 focus:ring-blue-600"},null,512),[[D,s.value.receive_notification_emails]])]),t[17]||(t[17]=e("div",{class:"ml-3 text-sm leading-6"},[e("label",{for:"receive_notification_emails",class:"font-medium text-gray-900 dark:text-gray-100"},"Notification Emails"),e("p",{class:"text-gray-500 dark:text-gray-400"},"Receive emails for important events like password resets.")],-1))])]),e("div",ie,[e("button",{type:"submit",class:"btn btn-primary",disabled:p.value||!N.value},k(p.value?"Saving...":"Save Profile"),9,oe)])])],32)])]),e("div",ne,[t[22]||(t[22]=e("div",{class:"px-4 py-5 sm:p-6"},[e("h2",{class:"text-xl font-bold leading-6 text-gray-900 dark:text-white"},"Change Password"),e("p",{class:"mt-1 max-w-2xl text-sm text-gray-500 dark:text-gray-400"},"Ensure your account is using a long, random password to stay secure.")],-1)),e("div",de,[e("form",{onSubmit:I(G,["prevent"]),class:"p-4 sm:p-6 space-y-6"},[e("div",null,[t[19]||(t[19]=e("label",{for:"currentPassword",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Current Password",-1)),e("div",ue,[u(e("input",{type:g.value?"text":"password",id:"currentPassword","onUpdate:modelValue":t[6]||(t[6]=a=>d.value.current_password=a),required:"",class:"input-field pr-10",autocomplete:"current-password"},null,8,ce),[[P,d.value.current_password]]),e("button",{type:"button",onClick:t[7]||(t[7]=a=>g.value=!g.value),class:"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600 dark:hover:text-gray-200"},[g.value?(m(),h(F,{key:0,class:"w-5 h-5"})):(m(),h(M,{key:1,class:"w-5 h-5"}))])])]),e("div",null,[t[20]||(t[20]=e("label",{for:"newPassword",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"New Password",-1)),e("div",me,[u(e("input",{type:f.value?"text":"password",id:"newPassword","onUpdate:modelValue":t[8]||(t[8]=a=>d.value.new_password=a),required:"",minlength:"8",class:"input-field pr-10",autocomplete:"new-password"},null,8,fe),[[P,d.value.new_password]]),e("button",{type:"button",onClick:t[9]||(t[9]=a=>f.value=!f.value),class:"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600 dark:hover:text-gray-200"},[f.value?(m(),h(F,{key:0,class:"w-5 h-5"})):(m(),h(M,{key:1,class:"w-5 h-5"}))])])]),e("div",null,[t[21]||(t[21]=e("label",{for:"confirmPassword",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Confirm New Password",-1)),e("div",pe,[u(e("input",{type:f.value?"text":"password",id:"confirmPassword","onUpdate:modelValue":t[10]||(t[10]=a=>v.value=a),required:"",class:"input-field pr-10",autocomplete:"new-password"},null,8,ve),[[P,v.value]])])]),e("div",ye,[e("button",{type:"submit",class:"btn btn-primary",disabled:y.value},k(y.value?"Changing...":"Change Password"),9,ge)])],32)])])])):V("",!0)}};export{we as default};
