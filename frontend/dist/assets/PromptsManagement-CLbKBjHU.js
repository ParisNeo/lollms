import{a1 as xe,l as Se,u as he,m as _e,bw as Ae,s as q,r as i,c as y,w as C,o as Ce,bx as Re,by as Ue,a as n,b as o,d as l,k as c,f as R,n as W,g as V,bz as Ie,p as d,v as w,q as E,F as U,i as I,t as v,e as T,y as Me,bu as K,A as Q,I as $e,h as Ve,D as X,bA as Te}from"./index-DnyZSjWo.js";import{A as Ne,a as Ze}from"./AppCardSkeleton-CEZ418Ox.js";import"./IconArrowUpCircle-CD49qfiF.js";import"./IconGlobeAlt-CXVR0hCA.js";import"./IconPlayCircle-CQyDZQps.js";const ze={class:"space-y-6"},Le={class:"border-b border-gray-200 dark:border-gray-700"},qe={class:"-mb-px flex space-x-6"},Ee={key:0},De={class:"flex justify-between items-center mb-4"},Fe={class:"space-y-4"},je={class:"grid grid-cols-1 lg:grid-cols-4 gap-4"},Be={class:"relative lg:col-span-1"},Oe={class:"grid grid-cols-1 sm:grid-cols-3 lg:col-span-3 gap-4"},Ge=["value"],He=["value"],Je={key:0,class:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6"},We={key:1,class:"empty-state-card"},Ke={key:2},Qe={class:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6"},Xe={key:0,class:"flex justify-between items-center mt-6"},Ye=["disabled"],et={class:"text-sm text-gray-600 dark:text-gray-400"},tt=["disabled"],st={key:1},lt={class:"flex justify-between items-center mb-4"},ot={key:0,class:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm mb-6"},at={class:"flex items-center gap-x-4"},nt={key:0},it=["required"],rt={key:1},ut=["required"],dt={key:1,class:"text-center p-4"},pt={key:2,class:"empty-state-card"},mt={key:3,class:"space-y-4"},vt={class:"font-semibold"},ct={class:"text-sm text-gray-500"},yt={class:"text-xs text-gray-400"},ft={class:"flex items-center gap-2"},gt=["onClick"],bt=["onClick"],wt={__name:"PromptsManagement",setup(kt){const r=Se(),Y=he(),u=_e(),D=Ae(),{on:ee,off:te}=Re(),{promptZooRepositories:N,isLoadingPromptZooRepositories:se,zooPrompts:k,isLoadingZooPrompts:le}=q(r),{systemPrompts:oe,isLoading:ae}=q(D),{tasks:ne}=q(Y),f=i("zoo"),a=i({type:"git",name:"",url:"",path:""}),P=i(!1),g=i(null),M=i(""),x=i("All"),S=i("All"),h=i("All"),F=i("name"),j=i("asc"),_=i(JSON.parse(localStorage.getItem("starredPrompts")||"[]")),p=i(1),Z=i(24);let B=null;const z=i(null),m=i(null),L=y(()=>k.value.total||0),O=y(()=>k.value.pages||1),ie=y(()=>{if(L.value===0)return"Showing 0-0 of 0";const s=(p.value-1)*Z.value+1,e=Math.min(p.value*Z.value,L.value);return`Showing ${s}-${e} of ${L.value}`}),re=y(()=>{const s={};return(N.value||[]).forEach(e=>s[e.name]=0),(k.value.items||[]).forEach(e=>{s.hasOwnProperty(e.repository)&&s[e.repository]++}),s});async function A(){const s={page:p.value,page_size:Z.value,sort_by:F.value,sort_order:j.value,category:x.value!=="All"?x.value:void 0,repository:h.value!=="All"?h.value:void 0,search_query:M.value||void 0,installation_status:S.value!=="All"?S.value:void 0};await r.fetchZooPrompts(s)}function ue(){clearTimeout(B),B=setTimeout(()=>{p.value=1,A()},300)}C([F,j,x,S,h],()=>{p.value=1,A()}),C(M,ue),C(p,A),C(_,s=>{localStorage.setItem("starredPrompts",JSON.stringify(s))},{deep:!0}),C(()=>a.value.type,s=>{s==="git"?a.value.path="":a.value.url=""}),Ce(()=>{D.fetchPrompts(),r.fetchPromptZooRepositories(),A(),ee("task:completed",H)}),Ue(()=>{te("task:completed",H)});const G=y(()=>{const s=new Map;return(ne.value||[]).forEach(e=>{var t;if((t=e==null?void 0:e.name)!=null&&t.startsWith("Installing prompt: ")&&(e.status==="running"||e.status==="pending")){const b=e.name.replace("Installing prompt: ","");s.set(b,e)}}),(k.value.items||[]).map(e=>({...e,task:s.get(e.folder_name)||null}))}),$=y(()=>Array.isArray(N.value)?[...N.value].sort((s,e)=>(s.name||"").localeCompare(e.name||"")):[]),de=y(()=>["All","Starred",...k.value.categories||[]]);function pe(s){return s?new Date(s).toLocaleString():"Never"}async function me(){if(!a.value.name){u.addNotification("Repository name is required.","warning");return}const s={name:a.value.name};a.value.type==="git"?s.url=a.value.url:s.path=a.value.path,g.value="add";try{await r.addPromptZooRepository(s),a.value={type:"git",name:"",url:"",path:""},P.value=!1}finally{g.value=null}}async function ve(s){g.value=s.id;try{await r.pullPromptZooRepository(s.id)}finally{g.value=null}}async function ce(s){if(await u.showConfirmation({title:`Delete Repository '${s.name}'?`})){g.value=s.id;try{await r.deletePromptZooRepository(s.id)}finally{g.value=null}}}async function ye(s){await r.installZooPrompt({repository:s.repository,folder_name:s.folder_name})}async function fe(s){const e=oe.value.find(t=>t.name===s.name);e&&await u.showConfirmation({title:`Uninstall '${s.name}'?`,message:"This will remove the prompt from the system."})&&(await r.deleteSystemPrompt(e.id),await A())}async function ge(s){const e=await r.fetchPromptReadme(s.repository,s.folder_name);u.openModal("sourceViewer",{title:`README: ${s.name}`,content:e,language:"markdown"})}function be(s){const e=_.value.indexOf(s);e>-1?_.value.splice(e,1):_.value.push(s)}function we(){u.openModal("generatePrompt",{isSystemPrompt:!0,onTaskSubmitted:s=>{z.value=s}})}function H(s){s&&s.id===z.value&&(z.value=null,u.isModalOpen("tasksManager")&&u.closeModal("tasksManager"),s.status==="completed"&&s.result?Pe(s.result):u.addNotification("Prompt generation did not complete successfully.","warning"))}async function ke(s){await r.updateSystemPromptFromZoo(s.id)}function Pe(s){m.value={...s},u.openModal("editSystemPrompt")}async function J(){if(!m.value)return;const{id:s,...e}=m.value;try{s?await r.updateSystemPrompt(s,e):await r.createSystemPrompt(e),u.closeModal("editSystemPrompt")}catch{}}return(s,e)=>(o(),n("div",ze,[l("div",Le,[l("nav",qe,[l("button",{onClick:e[0]||(e[0]=t=>f.value="zoo"),class:W(["tab-button",f.value==="zoo"?"active":"inactive"])},"Zoo",2),l("button",{onClick:e[1]||(e[1]=t=>f.value="source"),class:W(["tab-button",f.value==="source"?"active":"inactive"])},"Source",2)])]),f.value==="zoo"?(o(),n("section",Ee,[l("div",De,[e[18]||(e[18]=l("h3",{class:"text-xl font-semibold"},"Prompts Zoo",-1)),l("button",{onClick:we,class:"btn btn-secondary"},[R(Ie,{class:"w-4 h-4 mr-2"}),e[17]||(e[17]=V(" Generate with AI"))])]),l("div",Fe,[l("div",je,[l("div",Be,[d(l("input",{"onUpdate:modelValue":e[2]||(e[2]=t=>M.value=t),type:"text",placeholder:"Search Prompts...",class:"input-field w-full pl-10"},null,512),[[w,M.value]]),e[19]||(e[19]=l("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[l("svg",{class:"h-5 w-5 text-gray-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[l("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})])],-1))]),l("div",Oe,[d(l("select",{"onUpdate:modelValue":e[3]||(e[3]=t=>S.value=t),class:"input-field"},e[20]||(e[20]=[l("option",{value:"All"},"All Statuses",-1),l("option",{value:"Installed"},"Installed",-1),l("option",{value:"Uninstalled"},"Uninstalled",-1)]),512),[[E,S.value]]),d(l("select",{"onUpdate:modelValue":e[4]||(e[4]=t=>x.value=t),class:"input-field"},[(o(!0),n(U,null,I(de.value,t=>(o(),n("option",{key:t,value:t},v(t),9,Ge))),128))],512),[[E,x.value]]),d(l("select",{"onUpdate:modelValue":e[5]||(e[5]=t=>h.value=t),class:"input-field"},[e[21]||(e[21]=l("option",{value:"All"},"All Sources",-1)),(o(!0),n(U,null,I($.value,t=>(o(),n("option",{key:t.id,value:t.name},v(t.name),9,He))),128))],512),[[E,h.value]])])]),T(le)||T(ae)?(o(),n("div",Je,[(o(),n(U,null,I(6,t=>R(Ne,{key:t})),64))])):G.value.length===0?(o(),n("div",We,e[22]||(e[22]=[l("h4",{class:"font-semibold"},"No Prompts Found",-1)]))):(o(),n("div",Ke,[l("div",Qe,[(o(!0),n(U,null,I(G.value,t=>(o(),Me(Ze,{key:t.id||`${t.repository}/${t.folder_name}`,app:t,task:t.task,"is-starred":_.value.includes(t.name),"item-type-name":"Prompt",onStar:b=>be(t.name),onInstall:ye,onUninstall:b=>fe(t),onHelp:ge,onUpdate:b=>ke(t)},null,8,["app","task","is-starred","onStar","onUninstall","onUpdate"]))),128))]),O.value>1?(o(),n("div",Xe,[l("button",{onClick:e[6]||(e[6]=t=>p.value--),disabled:p.value===1,class:"btn btn-secondary"},"Previous",8,Ye),l("span",et,v(ie.value),1),l("button",{onClick:e[7]||(e[7]=t=>p.value++),disabled:p.value>=O.value,class:"btn btn-secondary"},"Next",8,tt)])):c("",!0)]))])])):c("",!0),f.value==="source"?(o(),n("section",st,[l("div",lt,[e[23]||(e[23]=l("h3",{class:"text-xl font-semibold"},"Prompt Zoo Repositories",-1)),l("button",{onClick:e[8]||(e[8]=t=>P.value=!P.value),class:"btn btn-primary"},v(P.value?"Cancel":"Add"),1)]),P.value?(o(),n("div",ot,[l("form",{onSubmit:Q(me,["prevent"]),class:"space-y-4"},[l("div",at,[l("label",null,[d(l("input",{type:"radio","onUpdate:modelValue":e[9]||(e[9]=t=>a.value.type=t),value:"git",class:"radio-input"},null,512),[[K,a.value.type]]),e[24]||(e[24]=V(" Git"))]),l("label",null,[d(l("input",{type:"radio","onUpdate:modelValue":e[10]||(e[10]=t=>a.value.type=t),value:"local",class:"radio-input"},null,512),[[K,a.value.type]]),e[25]||(e[25]=V(" Local"))])]),l("div",null,[e[26]||(e[26]=l("label",null,"Name",-1)),d(l("input",{"onUpdate:modelValue":e[11]||(e[11]=t=>a.value.name=t),type:"text",class:"input-field",required:""},null,512),[[w,a.value.name]])]),a.value.type==="git"?(o(),n("div",nt,[e[27]||(e[27]=l("label",null,"URL",-1)),d(l("input",{"onUpdate:modelValue":e[12]||(e[12]=t=>a.value.url=t),type:"url",class:"input-field",required:a.value.type==="git"},null,8,it),[[w,a.value.url]])])):c("",!0),a.value.type==="local"?(o(),n("div",rt,[e[28]||(e[28]=l("label",null,"Path",-1)),d(l("input",{"onUpdate:modelValue":e[13]||(e[13]=t=>a.value.path=t),type:"text",class:"input-field",required:a.value.type==="local"},null,8,ut),[[w,a.value.path]])])):c("",!0),e[29]||(e[29]=l("div",{class:"flex justify-end"},[l("button",{type:"submit",class:"btn btn-primary"},"Add")],-1))],32)])):c("",!0),T(se)?(o(),n("div",dt,"Loading...")):!$.value||$.value.length===0?(o(),n("div",pt,e[30]||(e[30]=[l("p",null,"No repositories added.",-1)]))):(o(),n("div",mt,[(o(!0),n(U,null,I($.value,t=>(o(),n("div",{key:t.id,class:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm flex items-center justify-between"},[l("div",null,[l("p",vt,v(t.name)+" ("+v(re.value[t.name]||0)+")",1),l("p",ct,v(t.url),1),l("p",yt,"Pulled: "+v(pe(t.last_pulled_at)),1)]),l("div",ft,[l("button",{onClick:b=>ve(t),class:"btn btn-secondary btn-sm"},[R($e,{class:"w-4 h-4 mr-1"}),V(v(t.type==="git"?"Pull":"Rescan"),1)],8,gt),t.is_deletable?(o(),n("button",{key:0,onClick:b=>ce(t),class:"btn btn-danger btn-sm"},[R(Ve,{class:"w-4 h-4"})],8,bt)):c("",!0)])]))),128))]))])):c("",!0),R(Te,{modalName:"editSystemPrompt",title:m.value&&m.value.id?"Edit System Prompt":"Add System Prompt"},{body:X(()=>[m.value?(o(),n("form",{key:0,onSubmit:Q(J,["prevent"]),class:"space-y-4"},[l("div",null,[e[31]||(e[31]=l("label",{for:"prompt-name",class:"block text-sm font-medium"},"Name",-1)),d(l("input",{id:"prompt-name","onUpdate:modelValue":e[14]||(e[14]=t=>m.value.name=t),type:"text",class:"input-field mt-1",required:""},null,512),[[w,m.value.name]])]),l("div",null,[e[32]||(e[32]=l("label",{for:"prompt-content",class:"block text-sm font-medium"},"Content",-1)),d(l("textarea",{id:"prompt-content","onUpdate:modelValue":e[15]||(e[15]=t=>m.value.content=t),rows:"10",class:"input-field mt-1"},null,512),[[w,m.value.content]])])],32)):c("",!0)]),footer:X(()=>[l("button",{onClick:e[16]||(e[16]=t=>T(u).closeModal("editSystemPrompt")),class:"btn btn-secondary"},"Cancel"),l("button",{onClick:J,class:"btn btn-primary"},"Save")]),_:1},8,["title"])]))}},At=xe(wt,[["__scopeId","data-v-47a2e2ad"]]);export{At as default};
