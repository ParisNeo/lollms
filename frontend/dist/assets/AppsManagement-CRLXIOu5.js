import{a2 as Ce,a5 as $e,aj as Se,m as Ie,a6 as se,f,c as A,ae as M,a7 as Ue,a as o,o as n,e as s,h as c,a4 as g,j as v,ak as L,t as p,w as Re,ad as Te,g as _,q as P,al as ae,v as j,ai as Me,a8 as h,F as k,i as $,s as le,af as G,b as W,am as Ne,an as De,ao as Ve,ap as Le,aq as Pe}from"./index-qE9kvn4y.js";import je from"./IconArrowUpCircle-DR-F5cpZ.js";import Ze from"./IconArrowUp-BWp0NGgj.js";import qe from"./IconArrowDown-m5unNp_I.js";import Fe from"./IconGlobeAlt-CeFg7eYF.js";import{A as ze,a as Ee}from"./AppCardSkeleton-B5qs-c-o.js";const Oe={class:"space-y-6"},Ge={class:"border-b border-gray-200 dark:border-gray-700"},We={class:"-mb-px flex space-x-6","aria-label":"Sub Tabs"},Be={key:0},He={class:"flex justify-between items-center mb-4 flex-wrap gap-2"},Je={class:"flex items-center gap-2"},Ke=["disabled"],Qe={key:0,class:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm mb-6 overflow-hidden"},Ye={class:"flex items-center gap-x-4 border-b pb-4 dark:border-gray-700"},Xe={class:"flex items-center gap-x-2 cursor-pointer text-sm font-medium"},et={class:"flex items-center gap-x-2 cursor-pointer text-sm font-medium"},tt={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},st={key:0,class:"md:col-span-2"},at=["required"],lt={key:1,class:"md:col-span-2"},nt=["required"],ot={class:"flex justify-end"},it=["disabled"],rt={key:0,class:"text-center p-4"},dt={key:1,class:"empty-state-card"},ut={key:2,class:"space-y-4"},ct={class:"flex-grow truncate"},pt={class:"flex items-center gap-2"},vt={class:"font-semibold"},mt=["title"],ft={class:"text-xs text-gray-400 mt-1"},bt={class:"flex items-center gap-x-2 flex-shrink-0"},gt=["onClick","disabled"],yt={class:"ml-1"},_t=["onClick","disabled"],ht={key:1},xt={class:"flex justify-between items-center mb-4 flex-wrap gap-2"},wt=["disabled"],kt={class:"space-y-4"},At={class:"grid grid-cols-1 lg:grid-cols-3 gap-4"},Ct={class:"relative lg:col-span-1"},$t={class:"grid grid-cols-2 lg:col-span-2 gap-4"},St=["value"],It={class:"flex items-center gap-2"},Ut=["value"],Rt={key:0,class:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 2xl:grid-cols-4 gap-6"},Tt={key:1,class:"empty-state-card"},Mt={key:2},Nt={class:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 2xl:grid-cols-4 gap-6"},Dt={key:0,class:"mt-6 flex justify-between items-center"},Vt={class:"text-sm text-gray-500"},Lt={class:"flex gap-2"},Pt=["disabled"],jt=["disabled"],Zt={key:2},qt={class:"flex justify-between items-center mb-4"},Ft=["disabled"],zt={key:0,class:"text-center p-10"},Et={key:1,class:"empty-state-card"},Ot={key:2,class:"space-y-4"},Gt={class:"flex items-center gap-4 flex-grow truncate"},Wt=["src"],Bt={class:"flex-grow truncate"},Ht={class:"font-semibold truncate"},Jt={class:"text-xs text-gray-500 font-mono truncate"},Kt={key:0},Qt={key:0,class:"text-yellow-500 font-semibold"},Yt={class:"flex items-center gap-x-2 flex-shrink-0 flex-wrap justify-end"},Xt={class:"capitalize"},es=["onClick"],ts=["onClick"],ss=["href"],as=["onClick"],ls=["onClick"],ns=["onClick"],os=["onClick","disabled"],is=["onClick","disabled"],rs=["onClick"],ds={__name:"AppsManagement",setup(us){const u=$e(),B=Se(),m=Ie(),{zooRepositories:H,isLoadingZooRepositories:ne,zooApps:S,isLoadingZooApps:Z,installedApps:oe,isLoadingInstalledApps:q}=se(u),{tasks:J}=se(B),b=f("repositories"),i=f({type:"git",name:"",url:"",path:""}),I=f(!1),r=f(null),N=f(""),x=f("All"),U=f("All"),D=f(!1),V=f("last_update_date"),R=f("desc"),C=f(JSON.parse(localStorage.getItem("starredItems")||"[]")),y=f(1),F=f(24);let K=null;const ie=[{value:"last_update_date",label:"Last Updated"},{value:"creation_date",label:"Creation Date"},{value:"name",label:"Name"},{value:"author",label:"Author"}],Q=A(()=>S.value.total||0),re=A(()=>S.value.pages||1),de=A(()=>{const a=(y.value-1)*F.value+1,t=Math.min(y.value*F.value,Q.value);return`Showing ${a}-${t} of ${Q.value}`});async function T(){if(x.value==="Starred")return;const a={page:y.value,page_size:F.value,sort_by:V.value,sort_order:R.value,category:x.value!=="All"?x.value:void 0,search_query:N.value||void 0,installation_status:U.value!=="All"?U.value:void 0};await u.fetchZooApps(a)}function ue(){clearTimeout(K),K=setTimeout(()=>{y.value=1,T()},300)}M(()=>i.value.type,a=>{a==="git"?i.value.path="":i.value.url=""}),M([b,V,R,x,U],()=>{y.value=1,b.value==="available_items"&&T()}),M(N,ue),M(y,T),M(C,a=>{localStorage.setItem("starredItems",JSON.stringify(a))},{deep:!0}),Ue(()=>{u.fetchZooRepositories(),u.fetchInstalledApps(),T()});const z=A(()=>{if(!Array.isArray(S.value.items))return[];let a=S.value.items;x.value==="Starred"&&(a=a.filter(l=>C.value.includes(l.name)));const t=new Map,e=["Installing app: ","Updating app: "];return J.value.forEach(l=>{if(l!=null&&l.name){for(const d of e)if(l.name.startsWith(d)&&(l.status==="running"||l.status==="pending")){const w=l.name.replace(d,"");(!t.has(w)||new Date(l.created_at)>new Date(t.get(w).created_at))&&t.set(w,l);break}}}),a.map(l=>({...l,task:t.get(l.name)||t.get(l.folder_name)||null}))}),E=A(()=>Array.isArray(H.value)?[...H.value].sort((a,t)=>(a.name||"").localeCompare(t.name||"")):[]),ce=A(()=>S.value.categories||["All","Starred"]),O=A(()=>{const t=[...oe.value.filter(l=>(l.item_type||"app")==="app")].sort((l,d)=>(l.name||"").localeCompare(d.name||"")),e=new Map;return J.value.forEach(l=>{if(!(l!=null&&l.name))return;let d="",w=null;l.name.startsWith("Start app: ")?(d=l.name.replace("Start app: ",""),w="starting"):l.name.startsWith("Stop app: ")?(d=l.name.replace("Stop app: ",""),w="stopping"):l.name.startsWith("Updating app: ")&&(d=l.name.replace("Updating app: ",""),w="updating"),d&&(l.status==="running"||l.status==="pending")&&(!e.has(d)||new Date(l.created_at)>new Date(e.get(d).created_at))&&e.set(d,{task:l,activityType:w})}),t.map(l=>{const d=e.get(l.name);return{...l,task:d?d.task:null,activity_status:d?d.activityType:null}})});function pe(a){const t=C.value.indexOf(a);t>-1?C.value.splice(t,1):C.value.push(a)}function ve(a){return a?new Date(a).toLocaleString():"Never"}async function me(){if(!i.value.name){m.addNotification("Repository name is required.","warning");return}const a={name:i.value.name};if(i.value.type==="git"){if(!i.value.url){m.addNotification("Git URL is required.","warning");return}a.url=i.value.url}else{if(!i.value.path){m.addNotification("Local Folder Path is required.","warning");return}a.path=i.value.path}r.value="add";try{await u.addZooRepository(a),i.value={type:"git",name:"",url:"",path:""},I.value=!1}finally{r.value=null}}async function fe(a){r.value=a.id;try{await u.pullZooRepository(a.id)}finally{r.value=null}}async function be(){D.value=!0;try{await u.pullAllZooRepositories()}finally{D.value=!1}}async function ge(a){if(await m.showConfirmation({title:`Delete Repository '${a.name}'?`,message:"This will remove the repository record. For Git repos, it also deletes cached files. This action cannot be undone.",confirmText:"Delete"})){r.value=a.id;try{await u.deleteZooRepository(a.id)}finally{r.value=null}}}function ye(a){m.openModal("appInstall",{app:a,type:"apps"})}async function Y(a){await m.showConfirmation({title:`Update '${a.name}'?`,message:"This will update the app to the latest version while preserving your configuration. The app will be stopped during the update.",confirmText:"Update"})&&await u.updateApp(a.id)}async function X(a,t){r.value=`${t}-${a}`;try{t==="start"&&await u.startApp(a),t==="stop"&&await u.stopApp(a)}finally{r.value=null}}async function ee(a){if(await m.showConfirmation({title:`Uninstall '${a.name}'?`,message:"This will permanently delete all files. This cannot be undone.",confirmText:"Uninstall"})){r.value=`uninstall-${a.id}`;try{await u.uninstallApp(a.id)}finally{r.value=null}}}function _e(a){m.openModal("sourceViewer",{title:`Details: ${a.name}`,content:a.description||"No description available.",language:"text"})}function he(a){m.openModal("appConfig",{app:a})}function xe(a){m.openModal("serviceRegistration",{item:a,itemType:"app",isInstalled:!0})}async function we(a){const t=await u.fetchAppLog(a.id);m.openModal("sourceViewer",{title:`Logs: ${a.name}`,content:t||"No log content found.",language:"log"})}async function ke(a){const t=await u.fetchAppReadme(a.repository,a.folder_name);m.openModal("sourceViewer",{title:`README: ${a.name}`,content:t,language:"markdown"})}async function Ae(a){await B.cancelTask(a)}function te(a){m.openModal("tasksManager",{initialTaskId:a})}return(a,t)=>(n(),o("div",Oe,[s("div",Ge,[s("nav",We,[s("button",{onClick:t[0]||(t[0]=e=>b.value="repositories"),class:g(["tab-button",b.value==="repositories"?"active":"inactive"])},"Repositories",2),s("button",{onClick:t[1]||(t[1]=e=>b.value="available_items"),class:g(["tab-button",b.value==="available_items"?"active":"inactive"])},"Available",2),s("button",{onClick:t[2]||(t[2]=e=>b.value="installed_apps"),class:g(["tab-button",b.value==="installed_apps"?"active":"inactive"])},"Installed",2)])]),b.value==="repositories"?(n(),o("section",Be,[s("div",He,[t[18]||(t[18]=s("h3",{class:"text-xl font-semibold"},"App Zoo Repositories",-1)),s("div",Je,[s("button",{onClick:be,class:"btn btn-secondary",disabled:D.value},[v(L,{class:g(["w-4 h-4",{"animate-spin":D.value}])},null,8,["class"]),t[17]||(t[17]=s("span",{class:"ml-2"},"Pull All",-1))],8,Ke),s("button",{onClick:t[3]||(t[3]=e=>I.value=!I.value),class:"btn btn-primary"},p(I.value?"Cancel":"Add Repository"),1)])]),v(Me,{name:"form-fade"},{default:Re(()=>[I.value?(n(),o("div",Qe,[s("form",{onSubmit:Te(me,["prevent"]),class:"space-y-4"},[s("div",Ye,[s("label",Xe,[_(s("input",{type:"radio","onUpdate:modelValue":t[4]||(t[4]=e=>i.value.type=e),value:"git",class:"radio-input"},null,512),[[ae,i.value.type]]),t[19]||(t[19]=P(" Git Repository"))]),s("label",et,[_(s("input",{type:"radio","onUpdate:modelValue":t[5]||(t[5]=e=>i.value.type=e),value:"local",class:"radio-input"},null,512),[[ae,i.value.type]]),t[20]||(t[20]=P(" Local Folder"))])]),s("div",tt,[s("div",null,[t[21]||(t[21]=s("label",{for:"repo-name-app",class:"block text-sm font-medium mb-1"},"Name",-1)),_(s("input",{id:"repo-name-app","onUpdate:modelValue":t[6]||(t[6]=e=>i.value.name=e),type:"text",class:"input-field",placeholder:"e.g., Official Zoo",required:""},null,512),[[j,i.value.name]])]),i.value.type==="git"?(n(),o("div",st,[t[22]||(t[22]=s("label",{for:"repo-url-app",class:"block text-sm font-medium mb-1"},"Git URL",-1)),_(s("input",{id:"repo-url-app","onUpdate:modelValue":t[7]||(t[7]=e=>i.value.url=e),type:"url",class:"input-field",placeholder:"https://github.com/ParisNeo/lollms_apps_zoo.git",required:i.value.type==="git"},null,8,at),[[j,i.value.url]])])):c("",!0),i.value.type==="local"?(n(),o("div",lt,[t[23]||(t[23]=s("label",{for:"repo-path-app",class:"block text-sm font-medium mb-1"},"Full Folder Path",-1)),_(s("input",{id:"repo-path-app","onUpdate:modelValue":t[8]||(t[8]=e=>i.value.path=e),type:"text",class:"input-field",placeholder:"e.g., C:\\Users\\YourUser\\Documents\\my-lollms-apps",required:i.value.type==="local"},null,8,nt),[[j,i.value.path]])])):c("",!0)]),s("div",ot,[s("button",{type:"submit",class:"btn btn-primary",disabled:r.value==="add"},p(r.value==="add"?"Adding...":"Add Repository"),9,it)])],32)])):c("",!0)]),_:1}),h(ne)?(n(),o("div",rt,"Loading repositories...")):!E.value||E.value.length===0?(n(),o("div",dt,t[24]||(t[24]=[s("p",null,"No App Zoo repositories added.",-1)]))):(n(),o("div",ut,[(n(!0),o(k,null,$(E.value,e=>(n(),o("div",{key:e.id,class:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm flex flex-col md:flex-row md:items-center justify-between gap-4"},[s("div",ct,[s("div",pt,[s("span",{class:g(["px-2 py-0.5 text-xs font-semibold rounded-full",e.type==="git"?"bg-blue-100 text-blue-800 dark:bg-blue-900/50 dark:text-blue-300":"bg-green-100 text-green-800 dark:bg-green-900/50 dark:text-green-300"])},p(e.type),3),s("p",vt,p(e.name),1)]),s("p",{class:"text-sm text-gray-500 font-mono truncate mt-1",title:e.url},p(e.url),9,mt),s("p",ft,"Last updated: "+p(ve(e.last_pulled_at)),1)]),s("div",bt,[s("button",{onClick:l=>fe(e),class:"btn btn-secondary btn-sm",disabled:r.value===e.id},[v(L,{class:g(["w-4 h-4",{"animate-spin":r.value===e.id}])},null,8,["class"]),s("span",yt,p(e.type==="git"?"Pull":"Rescan"),1)],8,gt),e.is_deletable?(n(),o("button",{key:0,onClick:l=>ge(e),class:"btn btn-danger btn-sm",disabled:r.value===e.id},[v(le,{class:"w-4 h-4"})],8,_t)):c("",!0)])]))),128))]))])):c("",!0),b.value==="available_items"?(n(),o("section",ht,[s("div",xt,[t[26]||(t[26]=s("h3",{class:"text-xl font-semibold"},"Available Apps",-1)),s("button",{onClick:T,class:"btn btn-secondary",disabled:h(Z)},[v(L,{class:g(["w-4 h-4",{"animate-spin":h(Z)}])},null,8,["class"]),t[25]||(t[25]=s("span",{class:"ml-2"},"Rescan",-1))],8,wt)]),s("div",kt,[s("div",At,[s("div",Ct,[_(s("input",{type:"text","onUpdate:modelValue":t[9]||(t[9]=e=>N.value=e),placeholder:"Search apps...",class:"input-field w-full pl-10"},null,512),[[j,N.value]]),t[27]||(t[27]=s("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[s("svg",{class:"h-5 w-5 text-gray-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})])],-1))]),s("div",$t,[_(s("select",{"onUpdate:modelValue":t[10]||(t[10]=e=>U.value=e),class:"input-field"},t[28]||(t[28]=[s("option",{value:"All"},"All Statuses",-1),s("option",{value:"Installed"},"Installed",-1),s("option",{value:"Uninstalled"},"Uninstalled",-1)]),512),[[G,U.value]]),_(s("select",{"onUpdate:modelValue":t[11]||(t[11]=e=>x.value=e),class:"input-field"},[(n(!0),o(k,null,$(ce.value,e=>(n(),o("option",{key:e,value:e},p(e),9,St))),128))],512),[[G,x.value]])])]),s("div",It,[_(s("select",{"onUpdate:modelValue":t[12]||(t[12]=e=>V.value=e),class:"input-field w-48"},[(n(),o(k,null,$(ie,e=>s("option",{key:e.value,value:e.value},"Sort by "+p(e.label),9,Ut)),64))],512),[[G,V.value]]),s("button",{onClick:t[13]||(t[13]=e=>R.value=R.value==="asc"?"desc":"asc"),class:"btn btn-secondary p-2"},[R.value==="asc"?(n(),W(Ze,{key:0,class:"w-5 h-5"})):(n(),W(qe,{key:1,class:"w-5 h-5"}))])]),h(Z)?(n(),o("div",Rt,[(n(),o(k,null,$(8,e=>v(ze,{key:e})),64))])):!z.value||z.value.length===0?(n(),o("div",Tt,t[29]||(t[29]=[s("h4",{class:"font-semibold"},"No Apps Found",-1),s("p",{class:"text-sm"},"No apps match your criteria. Please add and pull a repository or adjust your filters.",-1)]))):(n(),o("div",Mt,[s("div",Nt,[(n(!0),o(k,null,$(z.value,e=>(n(),W(Ee,{key:`${e.repository}/${e.folder_name}`,app:e,task:e.task,"is-starred":C.value.includes(e.name),onStar:l=>pe(e.name),onInstall:l=>ye(e),onUpdate:l=>Y(e),onUninstall:l=>ee(e),onDetails:l=>_e(e),onHelp:l=>ke(e),onViewTask:te,onCancelInstall:l=>Ae(e.task.id)},null,8,["app","task","is-starred","onStar","onInstall","onUpdate","onUninstall","onDetails","onHelp","onCancelInstall"]))),128))]),x.value!=="Starred"?(n(),o("div",Dt,[s("p",Vt,p(de.value),1),s("div",Lt,[s("button",{onClick:t[14]||(t[14]=e=>y.value--),disabled:y.value<=1,class:"btn btn-secondary"},"Previous",8,Pt),s("button",{onClick:t[15]||(t[15]=e=>y.value++),disabled:y.value>=re.value,class:"btn btn-secondary"},"Next",8,jt)])])):c("",!0)]))])])):c("",!0),b.value==="installed_apps"?(n(),o("section",Zt,[s("div",qt,[t[31]||(t[31]=s("h3",{class:"text-xl font-semibold"},"Installed Apps",-1)),s("button",{onClick:t[16]||(t[16]=(...e)=>h(u).fetchInstalledApps&&h(u).fetchInstalledApps(...e)),class:"btn btn-secondary",disabled:h(q)},[v(L,{class:g(["w-4 h-4",{"animate-spin":h(q)}])},null,8,["class"]),t[30]||(t[30]=s("span",{class:"ml-2"},"Refresh",-1))],8,Ft)]),h(q)?(n(),o("div",zt,"Loading...")):!O.value||O.value.length===0?(n(),o("div",Et,t[32]||(t[32]=[s("h4",{class:"font-semibold"},"No Apps Installed",-1),s("p",{class:"text-sm"},'Go to "Available" to install an app.',-1)]))):(n(),o("div",Ot,[(n(!0),o(k,null,$(O.value,e=>(n(),o("div",{key:e.id,class:g(["bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm flex flex-col md:flex-row md:items-center justify-between gap-4 transition-colors duration-300",{"bg-blue-50 dark:bg-blue-900/30 animate-pulse":e.activity_status==="starting","bg-yellow-50 dark:bg-yellow-900/30 animate-pulse":e.activity_status==="stopping","bg-purple-50 dark:bg-purple-900/30 animate-pulse":e.activity_status==="updating"}])},[s("div",Gt,[e.icon?(n(),o("img",{key:0,src:e.icon,class:"h-10 w-10 rounded-md flex-shrink-0 object-cover",alt:"Icon"},null,8,Wt)):c("",!0),s("div",Bt,[s("p",Ht,p(e.name),1),s("p",Jt,[P("Port: "+p(e.port)+" ",1),e.version?(n(),o("span",Kt,[P(" | v"+p(e.version)+" ",1),e.update_available?(n(),o("span",Qt,"(repo: v"+p(e.repo_version)+")",1)):c("",!0)])):c("",!0)])])]),s("div",Yt,[e.activity_status?(n(),o(k,{key:0},[s("div",{class:g(["flex items-center gap-2 text-sm font-semibold",{"text-blue-700 dark:text-blue-300":e.activity_status==="starting","text-yellow-700 dark:text-yellow-300":e.activity_status==="stopping","text-purple-700 dark:text-purple-300":e.activity_status==="updating"}])},[v(Ne,{class:"w-5 h-5"}),s("span",Xt,p(e.activity_status)+"...",1)],2),s("button",{onClick:l=>te(e.task.id),class:"btn btn-secondary btn-sm !p-1.5",title:"View Task Details"},[v(De,{class:"w-4 h-4"})],8,es)],64)):(n(),o(k,{key:1},[e.update_available?(n(),o("button",{key:0,onClick:l=>Y(e),class:"btn btn-warning btn-sm p-2",title:"Update"},[v(je,{class:"w-5 h-5"})],8,ts)):c("",!0),s("span",{class:g(["px-2 py-1 text-xs font-semibold rounded-full",{"bg-green-100 text-green-800 dark:bg-green-900/50 dark:text-green-300":e.status==="running","bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300":e.status==="stopped","bg-red-100 text-red-800 dark:bg-red-900/50 dark:text-red-300":e.status==="error"}])},p(e.status),3),e.status==="running"&&e.url?(n(),o("a",{key:1,href:e.url,target:"_blank",class:"btn btn-secondary btn-sm p-2",title:"Open"},[v(Fe,{class:"w-5 h-5"})],8,ss)):c("",!0),s("button",{onClick:l=>xe(e),class:"btn btn-secondary btn-sm p-2",title:"Edit Registration"},[v(Ve,{class:"w-5 h-5"})],8,as),e.has_config_schema?(n(),o("button",{key:2,onClick:l=>he(e),class:"btn btn-secondary btn-sm p-2",title:"Configure"},[v(Le,{class:"w-5 h-5"})],8,ls)):c("",!0),s("button",{onClick:l=>we(e),class:"btn btn-secondary btn-sm p-2",title:"Logs"},[v(Pe,{class:"w-5 h-5"})],8,ns),e.status!=="running"?(n(),o("button",{key:3,onClick:l=>X(e.id,"start"),class:"btn btn-success btn-sm p-2",disabled:r.value===`start-${e.id}`,title:"Start"},"Start",8,os)):c("",!0),e.status==="running"||e.status==="error"&&e.pid?(n(),o("button",{key:4,onClick:l=>X(e.id,"stop"),class:"btn btn-warning btn-sm p-2",disabled:r.value===`stop-${e.id}`,title:"Stop"},"Stop",8,is)):c("",!0),s("button",{onClick:l=>ee(e),class:"btn btn-danger btn-sm p-2",title:"Uninstall"},[v(le,{class:"w-5 h-5"})],8,rs)],64))])],2))),128))]))])):c("",!0)]))}},gs=Ce(ds,[["__scopeId","data-v-a82757e9"]]);export{gs as default};
