import{a1 as de,l as ve,u as pe,m as ce,bv as ye,s as Z,r as i,c,w as h,o as me,a as n,b as o,d as s,k as y,n as F,p as u,v as I,q as N,F as S,i as P,t as d,e as O,f as T,y as fe,g as z,bu as H,A as ge,I as be,h as we}from"./index-DnyZSjWo.js";import{A as _e,a as ke}from"./AppCardSkeleton-CEZ418Ox.js";import"./IconArrowUpCircle-CD49qfiF.js";import"./IconGlobeAlt-CXVR0hCA.js";import"./IconPlayCircle-CQyDZQps.js";const xe={class:"space-y-6"},he={class:"border-b border-gray-200 dark:border-gray-700"},Se={class:"-mb-px flex space-x-6"},Pe={key:0},Re={class:"space-y-4"},Ae={class:"grid grid-cols-1 lg:grid-cols-4 gap-4"},Ce={class:"relative lg:col-span-1"},Ie={class:"grid grid-cols-1 sm:grid-cols-3 lg:col-span-3 gap-4"},Ue=["value"],$e=["value"],Ve={key:0,class:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 2xl:grid-cols-4 gap-6"},Me={key:1,class:"empty-state-card"},Ze={key:2},Ne={class:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 2xl:grid-cols-4 gap-6"},Te={key:0,class:"flex justify-between items-center mt-6"},ze=["disabled"],qe={class:"text-sm text-gray-600 dark:text-gray-400"},De=["disabled"],Le={key:1},Ee={class:"flex justify-between items-center mb-4"},je={key:0,class:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm mb-6"},Be={class:"flex items-center gap-x-4"},Fe={key:0},Oe=["required"],He={key:1},Je=["required"],We={key:1,class:"text-center p-4"},Ge={key:2,class:"empty-state-card"},Ke={key:3,class:"space-y-4"},Qe={class:"font-semibold"},Xe={class:"text-sm text-gray-500"},Ye={class:"text-xs text-gray-400"},et={class:"flex items-center gap-2"},tt=["onClick"],st=["onClick"],lt={__name:"PersonalitiesManagement",setup(at){const v=ve(),J=pe(),R=ce(),U=ye(),{personalityZooRepositories:q,isLoadingPersonalityZooRepositories:W,zooPersonalities:w,isLoadingZooPersonalities:G}=Z(v),{publicPersonalities:K}=Z(U),{tasks:Q}=Z(J),m=i("zoo"),a=i({type:"git",name:"",url:"",path:""}),_=i(!1),f=i(null),A=i(""),p=i("All"),k=i("All"),x=i("All"),D=i("name"),L=i("asc"),g=i(JSON.parse(localStorage.getItem("starredPersonalities")||"[]")),r=i(1),$=i(24);let E=null;const V=c(()=>w.value.total||0),j=c(()=>w.value.pages||1),X=c(()=>{if(V.value===0)return"Showing 0-0 of 0";const l=(r.value-1)*$.value+1,e=Math.min(r.value*$.value,V.value);return`Showing ${l}-${e} of ${V.value}`}),Y=c(()=>{const l={};return(q.value||[]).forEach(e=>l[e.name]=0),(w.value.items||[]).forEach(e=>{l.hasOwnProperty(e.repository)&&l[e.repository]++}),l});async function b(){const l={page:r.value,page_size:$.value,sort_by:D.value,sort_order:L.value,category:p.value!=="All"&&p.value!=="Starred"?p.value:void 0,repository:x.value!=="All"?x.value:void 0,search_query:A.value||void 0,installation_status:k.value!=="All"?k.value:void 0};p.value==="Starred"&&(l.starred_names=g.value),await v.fetchZooPersonalities(l)}const B=c(()=>{const l=new Map;return(Q.value||[]).forEach(e=>{var t;if((t=e==null?void 0:e.name)!=null&&t.startsWith("Installing personality: ")&&(e.status==="running"||e.status==="pending")){const C=e.name.replace("Installing personality: ","");l.set(C,e)}}),(w.value.items||[]).map(e=>({...e,task:l.get(e.folder_name)||null}))});function ee(){clearTimeout(E),E=setTimeout(()=>{r.value=1,b()},300)}h([D,L,p,k,x],()=>{r.value=1,b()}),h(A,ee),h(r,b),h(g,l=>{localStorage.setItem("starredPersonalities",JSON.stringify(l)),p.value==="Starred"&&(r.value=1,b())},{deep:!0}),h(()=>a.value.type,l=>{l==="git"?a.value.path="":a.value.url=""}),me(()=>{U.fetchPersonalities(),v.fetchPersonalityZooRepositories(),b()});const M=c(()=>[...q.value||[]].sort((l,e)=>(l.name||"").localeCompare(e.name||""))),te=c(()=>["All","Starred",...w.value.categories||[]]);function se(l){return l?new Date(l).toLocaleString():"Never"}async function le(){if(!a.value.name){R.addNotification("Repository name is required.","warning");return}const l={name:a.value.name};a.value.type==="git"?l.url=a.value.url:l.path=a.value.path,f.value="add";try{await v.addPersonalityZooRepository(l),a.value={type:"git",name:"",url:"",path:""},_.value=!1}finally{f.value=null}}async function ae(l){f.value=l.id;try{await v.pullPersonalityZooRepository(l.id)}finally{f.value=null}}async function oe(l){if(await R.showConfirmation({title:`Delete Repository '${l.name}'?`})){f.value=l.id;try{await v.deletePersonalityZooRepository(l.id)}finally{f.value=null}}}async function ne(l){await v.installZooPersonality({repository:l.repository,folder_name:l.folder_name})}async function ie(l){const e=K.value.find(t=>t.name===l.name&&t.owner_username==="System");e&&await R.showConfirmation({title:`Uninstall '${l.name}'?`})&&(await U.deletePersonality(e.id),await b())}async function re(l){const e=await v.fetchPersonalityReadme(l.repository,l.folder_name);R.openModal("sourceViewer",{title:`README: ${l.name}`,content:e,language:"markdown"})}function ue(l){const e=g.value.indexOf(l);e>-1?g.value.splice(e,1):g.value.push(l)}return(l,e)=>(o(),n("div",xe,[s("div",he,[s("nav",Se,[s("button",{onClick:e[0]||(e[0]=t=>m.value="zoo"),class:F(["tab-button",m.value==="zoo"?"active":"inactive"])},"Zoo",2),s("button",{onClick:e[1]||(e[1]=t=>m.value="source"),class:F(["tab-button",m.value==="source"?"active":"inactive"])},"Source",2)])]),m.value==="zoo"?(o(),n("section",Pe,[e[18]||(e[18]=s("h3",{class:"text-xl font-semibold mb-4"},"Personality Zoo",-1)),s("div",Re,[s("div",Ae,[s("div",Ce,[u(s("input",{"onUpdate:modelValue":e[2]||(e[2]=t=>A.value=t),type:"text",placeholder:"Search Personalities...",class:"input-field w-full pl-10"},null,512),[[I,A.value]]),e[14]||(e[14]=s("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[s("svg",{class:"h-5 w-5 text-gray-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})])],-1))]),s("div",Ie,[u(s("select",{"onUpdate:modelValue":e[3]||(e[3]=t=>k.value=t),class:"input-field"},e[15]||(e[15]=[s("option",{value:"All"},"All Statuses",-1),s("option",{value:"Installed"},"Installed",-1),s("option",{value:"Uninstalled"},"Uninstalled",-1)]),512),[[N,k.value]]),u(s("select",{"onUpdate:modelValue":e[4]||(e[4]=t=>p.value=t),class:"input-field"},[(o(!0),n(S,null,P(te.value,t=>(o(),n("option",{key:t,value:t},d(t),9,Ue))),128))],512),[[N,p.value]]),u(s("select",{"onUpdate:modelValue":e[5]||(e[5]=t=>x.value=t),class:"input-field"},[e[16]||(e[16]=s("option",{value:"All"},"All Sources",-1)),(o(!0),n(S,null,P(M.value,t=>(o(),n("option",{key:t.id,value:t.name},d(t.name),9,$e))),128))],512),[[N,x.value]])])]),O(G)?(o(),n("div",Ve,[(o(),n(S,null,P(8,t=>T(_e,{key:t})),64))])):B.value.length===0?(o(),n("div",Me,e[17]||(e[17]=[s("p",null,"No personalities found.",-1)]))):(o(),n("div",Ze,[s("div",Ne,[(o(!0),n(S,null,P(B.value,t=>(o(),fe(ke,{key:`${t.repository}/${t.folder_name}`,app:t,task:t.task,"is-starred":g.value.includes(t.name),"item-type-name":"Personality",onStar:C=>ue(t.name),onInstall:ne,onUninstall:ie,onHelp:re},null,8,["app","task","is-starred","onStar"]))),128))]),j.value>1?(o(),n("div",Te,[s("button",{onClick:e[6]||(e[6]=t=>r.value--),disabled:r.value===1,class:"btn btn-secondary"},"Previous",8,ze),s("span",qe,d(X.value),1),s("button",{onClick:e[7]||(e[7]=t=>r.value++),disabled:r.value>=j.value,class:"btn btn-secondary"},"Next",8,De)])):y("",!0)]))])])):y("",!0),m.value==="source"?(o(),n("section",Le,[s("div",Ee,[e[19]||(e[19]=s("h3",{class:"text-xl font-semibold"},"Personality Zoo Repositories",-1)),s("button",{onClick:e[8]||(e[8]=t=>_.value=!_.value),class:"btn btn-primary"},d(_.value?"Cancel":"Add Repository"),1)]),_.value?(o(),n("div",je,[s("form",{onSubmit:ge(le,["prevent"]),class:"space-y-4"},[s("div",Be,[s("label",null,[u(s("input",{type:"radio","onUpdate:modelValue":e[9]||(e[9]=t=>a.value.type=t),value:"git",class:"radio-input"},null,512),[[H,a.value.type]]),e[20]||(e[20]=z(" Git"))]),s("label",null,[u(s("input",{type:"radio","onUpdate:modelValue":e[10]||(e[10]=t=>a.value.type=t),value:"local",class:"radio-input"},null,512),[[H,a.value.type]]),e[21]||(e[21]=z(" Local"))])]),s("div",null,[e[22]||(e[22]=s("label",null,"Name",-1)),u(s("input",{"onUpdate:modelValue":e[11]||(e[11]=t=>a.value.name=t),type:"text",class:"input-field",required:""},null,512),[[I,a.value.name]])]),a.value.type==="git"?(o(),n("div",Fe,[e[23]||(e[23]=s("label",null,"URL",-1)),u(s("input",{"onUpdate:modelValue":e[12]||(e[12]=t=>a.value.url=t),type:"url",class:"input-field",required:a.value.type==="git"},null,8,Oe),[[I,a.value.url]])])):y("",!0),a.value.type==="local"?(o(),n("div",He,[e[24]||(e[24]=s("label",null,"Path",-1)),u(s("input",{"onUpdate:modelValue":e[13]||(e[13]=t=>a.value.path=t),type:"text",class:"input-field",required:a.value.type==="local"},null,8,Je),[[I,a.value.path]])])):y("",!0),e[25]||(e[25]=s("div",{class:"flex justify-end"},[s("button",{type:"submit",class:"btn btn-primary"},"Add")],-1))],32)])):y("",!0),O(W)?(o(),n("div",We,"Loading...")):M.value.length===0?(o(),n("div",Ge,e[26]||(e[26]=[s("p",null,"No repositories added.",-1)]))):(o(),n("div",Ke,[(o(!0),n(S,null,P(M.value,t=>(o(),n("div",{key:t.id,class:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm flex items-center justify-between"},[s("div",null,[s("p",Qe,d(t.name)+" ("+d(Y.value[t.name]||0)+")",1),s("p",Xe,d(t.url),1),s("p",Ye,"Pulled: "+d(se(t.last_pulled_at)),1)]),s("div",et,[s("button",{onClick:C=>ae(t),class:"btn btn-secondary btn-sm"},[T(be,{class:"w-4 h-4 mr-1"}),z(d(t.type==="git"?"Pull":"Rescan"),1)],8,tt),t.is_deletable?(o(),n("button",{key:0,onClick:C=>oe(t),class:"btn btn-danger btn-sm"},[T(we,{class:"w-4 h-4"})],8,st)):y("",!0)])]))),128))]))])):y("",!0)]))}},dt=de(lt,[["__scopeId","data-v-b2ae7a46"]]);export{dt as default};
