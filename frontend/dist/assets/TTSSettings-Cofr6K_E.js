import{$ as le,u as oe,a as ne,G as ie,s as q,r as p,l as re,m as de,p as ue,q as ce,x as ve,w as V,bQ as fe,k as m,o as ge,a9 as me,c as n,b as l,g as t,f as Q,d as k,y as A,z as w,bU as Y,t as f,A as H,h as S,B as _e,e as E,j as pe,F as T,i as C,n as F,bR as be,T as ye,C as xe,v as K,J as L,O as he,bT as ke}from"./index-CYEhB9Xc.js";import{_ as we}from"./LanguageSelector-B0bfv4ia.js";const Se={class:"bg-white dark:bg-gray-800 shadow-md rounded-lg"},Te={class:"border-t border-gray-200 dark:border-gray-700"},Ce={class:"relative"},Me={class:"flex items-center space-x-3 truncate"},Ve=["src"],Le={key:1,class:"w-8 h-8 flex-shrink-0 text-gray-500 dark:text-gray-400 flex items-center justify-center bg-gray-200 dark:bg-gray-700 rounded-md"},Oe={class:"min-w-0 text-left"},Ue={class:"block font-semibold truncate"},Re={class:"p-2 sticky top-0 bg-white dark:bg-gray-800 z-10 border-b dark:border-gray-700"},Ae={class:"p-1 flex-grow overflow-y-auto"},Ee={key:0,class:"text-center p-4 text-sm text-gray-500"},Fe={key:1,class:"text-center p-4 text-sm text-gray-500"},$e={class:"px-2 py-1.5 text-xs font-bold text-gray-600 dark:text-gray-300"},De=["onClick"],je={class:"flex items-center space-x-3 truncate"},Ne=["src"],ze={class:"truncate text-left"},Be={class:"font-medium truncate text-sm"},Ie={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},Pe=["value"],Ge={class:"mt-1 text-xs text-gray-500 dark:text-gray-400"},Je={key:0,class:"p-4 border rounded-lg dark:border-gray-700 space-y-4"},qe={class:"font-medium"},Qe={class:"font-mono text-blue-600 dark:text-blue-400"},Ye={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},He=["for"],Ke={class:"text-xs text-gray-500 dark:text-gray-400 mb-1"},We=["id","onUpdate:modelValue"],Xe=["value"],Ze=["type","step","id","onUpdate:modelValue","placeholder"],et={key:2,class:"mt-1"},tt=["onClick"],st={class:"flex justify-end gap-3 pt-4 border-t dark:border-gray-600"},at=["disabled"],lt={key:1,class:"p-4 border border-yellow-300 dark:border-yellow-700 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg text-sm text-yellow-800 dark:text-yellow-200 flex items-center gap-3"},ot={class:"flex justify-end pt-4 border-t dark:border-gray-600"},nt=["disabled"],it={__name:"TTSSettings",setup(rt){const $=oe(),b=ne();ie();const{user:g}=q($),{availableTtsModels:D,availableTtsModelsGrouped:j,userVoices:W}=q(b),o=p({}),x=p(!1),O=p(!1);let N="{}";const y=p(!1),U=p(null),R=p(null),M=p(""),{floatingStyles:X}=re(U,R,{placement:"bottom-start",whileElementsMounted:de,middleware:[ue(5),ce(),ve({padding:5})]}),Z={mounted:(a,e)=>{a.clickOutsideEvent=i=>{const r=U.value;a===i.target||a.contains(i.target)||r!=null&&r.contains(i.target)||e.value()},document.addEventListener("mousedown",a.clickOutsideEvent)},unmounted:a=>{document.removeEventListener("mousedown",a.clickOutsideEvent)}};V(y,a=>{a&&fe(()=>{const e=R.value;if(e){const i=e.querySelector(".menu-item-button.selected");i&&i.scrollIntoView({block:"nearest"})}})});const v=m({get:()=>o.value.tts_binding_model_name,set:a=>{o.value.tts_binding_model_name=a}}),z=m({get:()=>o.value.active_voice_id,set:a=>{o.value.active_voice_id=a}}),B=m({get:()=>o.value.ai_response_language||"auto",set:a=>{o.value.ai_response_language=a}}),u=m(()=>!v.value||D.value.length===0?null:D.value.find(a=>a.id===v.value)||null),h=m(()=>{var r;if(!((r=u.value)!=null&&r.binding_params))return[];const a=[...u.value.binding_params.class_parameters||[],...u.value.binding_params.generation_parameters||[]],e=["voice","language","model"],i=a.reduce((c,_)=>(!c.has(_.name)&&!e.includes(_.name)&&c.set(_.name,_),c),new Map);return Array.from(i.values())}),ee=m(()=>!g.value||!v.value||!g.value.tts_models_config?{}:g.value.tts_models_config[v.value]||{}),I=m(()=>{var a;return(a=u.value)!=null&&a.alias?u.value.alias.allow_parameters_override!==!1:!0}),P=m(()=>{if(!M.value)return j.value;const a=M.value.toLowerCase(),e=[];for(const i of j.value)if(i.items){const r=i.items.filter(c=>c.name.toLowerCase().includes(a));r.length>0&&e.push({...i,items:r})}return e});function te(a){v.value=a,y.value=!1}const G=()=>{if(g.value){const a={};u.value&&h.value.forEach(e=>{a[e.name]=ee.value[e.name]??e.default}),o.value={...a,tts_binding_model_name:g.value.tts_binding_model_name,active_voice_id:g.value.active_voice_id,ai_response_language:g.value.ai_response_language||"auto"},N=JSON.stringify(o.value),O.value=!1}};V(u,G,{immediate:!0,deep:!0}),V(g,G,{deep:!0}),V(o,a=>{O.value=JSON.stringify(a)!==JSON.stringify(N)},{deep:!0});async function se(){x.value=!0;try{const a={tts_binding_model_name:o.value.tts_binding_model_name,active_voice_id:o.value.active_voice_id,ai_response_language:o.value.ai_response_language},e=g.value.tts_models_config||{},i={};h.value.forEach(c=>{o.value[c.name]!==c.default&&(i[c.name]=o.value[c.name])});const r={...e,[v.value]:i};Object.keys(r[v.value]||{}).length===0&&delete r[v.value],a.tts_models_config=r,await $.updateUserPreferences(a)}finally{x.value=!1}}function ae(){const a={};u.value&&(h.value.forEach(e=>{a[e.name]=e.default}),o.value={...o.value,...a})}return ge(()=>{b.availableTtsModels.length===0&&b.fetchAvailableTtsModels(),b.userVoices.length===0&&b.fetchUserVoices()}),(a,e)=>{var r,c,_;const i=me("router-link");return l(),n("div",Se,[e[16]||(e[16]=t("div",{class:"px-4 py-5 sm:p-6"},[t("h2",{class:"text-xl font-bold leading-6 text-gray-900 dark:text-white"},"Speech Generation (TTS) Parameters"),t("p",{class:"mt-1 max-w-2xl text-sm text-gray-500 dark:text-gray-400"}," Configure default parameters for your selected Text-to-Speech model. ")],-1)),t("div",Te,[t("form",{onSubmit:Q(se,["prevent"]),class:"p-4 sm:p-6 space-y-6"},[t("div",null,[e[6]||(e[6]=t("label",{class:"block text-base font-medium mb-2"},"Active Speech Generation Model",-1)),t("div",Ce,[t("button",{ref_key:"ttsTriggerRef",ref:U,onClick:e[0]||(e[0]=s=>y.value=!y.value),type:"button",class:"toolbox-select truncate w-full flex items-center justify-between"},[t("div",Me,[(c=(r=u.value)==null?void 0:r.alias)!=null&&c.icon?(l(),n("img",{key:0,src:u.value.alias.icon,class:"h-8 w-8 rounded-md object-cover"},null,8,Ve)):(l(),n("span",Le,[w(Y,{class:"w-5 h-5"})])),t("div",Oe,[t("span",Ue,f(((_=u.value)==null?void 0:_.name)||"Select a Speech Model"),1)])]),e[5]||(e[5]=t("svg",{class:"w-4 h-4 text-gray-400 flex-shrink-0",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor"},[t("path",{"fill-rule":"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z","clip-rule":"evenodd"})],-1))],512),(l(),A(xe,{to:"body"},[w(ye,{"enter-active-class":"transition ease-out duration-100","enter-from-class":"transform opacity-0 scale-95","enter-to-class":"transform opacity-100 scale-100","leave-active-class":"transition ease-in duration-75","leave-from-class":"transform opacity-100 scale-100","leave-to-class":"transform opacity-0 scale-95"},{default:H(()=>[y.value?S((l(),n("div",{key:0,ref_key:"ttsFloatingRef",ref:R,style:_e(E(X)),class:"z-50 w-80 origin-top-left rounded-md bg-white dark:bg-gray-800 shadow-lg ring-1 ring-black ring-opacity-5 dark:ring-gray-700 focus:outline-none py-1 flex flex-col max-h-[50vh]"},[t("div",Re,[S(t("input",{type:"text","onUpdate:modelValue":e[1]||(e[1]=s=>M.value=s),onClick:e[2]||(e[2]=Q(()=>{},["stop"])),placeholder:"Search TTS models...",class:"input-field-sm w-full"},null,512),[[pe,M.value]])]),t("div",Ae,[E(b).isLoadingTtsModels?(l(),n("div",Ee,"Loading TTS models...")):P.value.length===0?(l(),n("div",Fe,"No TTS models found.")):k("",!0),(l(!0),n(T,null,C(P.value,s=>(l(),n("div",{key:s.label},[t("h4",$e,f(s.label),1),(l(!0),n(T,null,C(s.items,d=>{var J;return l(),n("button",{key:d.id,onClick:dt=>te(d.id),class:F(["menu-item-button",{selected:v.value===d.id}])},[t("div",je,[(J=d.alias)!=null&&J.icon?(l(),n("img",{key:0,src:d.alias.icon,class:"h-6 w-6 rounded-md object-cover flex-shrink-0"},null,8,Ne)):(l(),A(Y,{key:1,class:"w-6 h-6 text-gray-500 dark:text-gray-400 flex-shrink-0"})),t("div",ze,[t("p",Be,f(d.name),1)])]),v.value===d.id?(l(),A(be,{key:0,class:"w-5 h-5 text-blue-600 dark:text-blue-400 flex-shrink-0"})):k("",!0)],10,De)}),128))]))),128))])],4)),[[Z,()=>y.value=!1]]):k("",!0)]),_:1})]))])]),t("div",Ie,[t("div",null,[e[7]||(e[7]=t("label",{for:"aiResponseLanguage",class:"block text-base font-medium mb-2"},"AI Response Language",-1)),w(we,{modelValue:B.value,"onUpdate:modelValue":e[3]||(e[3]=s=>B.value=s),id:"aiResponseLanguage","include-auto":!0},null,8,["modelValue"]),e[8]||(e[8]=t("p",{class:"mt-1 text-xs text-gray-500 dark:text-gray-400"},"The language for AI text responses and speech generation. 'Auto' uses the interface language.",-1))]),t("div",null,[e[13]||(e[13]=t("label",{for:"active-voice",class:"block text-base font-medium mb-2"},"Active Voice",-1)),S(t("select",{id:"active-voice","onUpdate:modelValue":e[4]||(e[4]=s=>z.value=s),class:"input-field w-full"},[e[9]||(e[9]=t("option",{value:null},"Default Voice",-1)),(l(!0),n(T,null,C(E(W),s=>(l(),n("option",{key:s.id,value:s.id},f(s.alias)+" ("+f(s.language)+") ",9,Pe))),128))],512),[[K,z.value]]),t("p",Ge,[e[11]||(e[11]=L("Select a custom voice from your ")),w(i,{to:"/voices-studio",class:"text-blue-600 hover:underline"},{default:H(()=>e[10]||(e[10]=[L("Voices Studio")])),_:1}),e[12]||(e[12]=L("."))])])]),v.value&&u.value&&I.value&&h.value.length>0?(l(),n("div",Je,[t("h4",qe,[e[14]||(e[14]=L("Configuration for: ")),t("span",Qe,f(u.value.name),1)]),t("div",Ye,[(l(!0),n(T,null,C(h.value,s=>(l(),n("div",{key:s.name},[t("label",{for:`tts-param-${s.name}`,class:"block text-sm font-medium capitalize"},f(s.name.replace(/_/g," ")),9,He),t("p",Ke,f(s.description),1),s.options&&s.options.length>0?S((l(),n("select",{key:0,id:`tts-param-${s.name}`,"onUpdate:modelValue":d=>o.value[s.name]=d,class:"input-field mt-1"},[(l(!0),n(T,null,C(s.options,d=>(l(),n("option",{key:d,value:d},f(d),9,Xe))),128))],8,We)),[[K,o.value[s.name]]]):["str","int","float"].includes(s.type)?S((l(),n("input",{key:1,type:s.type==="str"?"text":"number",step:s.type==="float"?"0.01":"1",id:`tts-param-${s.name}`,"onUpdate:modelValue":d=>o.value[s.name]=d,class:"input-field mt-1",placeholder:`Default: ${s.default}`},null,8,Ze)),[[he,o.value[s.name]]]):s.type==="bool"?(l(),n("div",et,[t("button",{onClick:d=>o.value[s.name]=!o.value[s.name],type:"button",class:F([o.value[s.name]?"bg-blue-600":"bg-gray-200 dark:bg-gray-600","relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out"])},[t("span",{class:F([o.value[s.name]?"translate-x-5":"translate-x-0","pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition-colors duration-200 ease-in-out"])},null,2)],10,tt)])):k("",!0)]))),128))]),t("div",st,[t("button",{type:"button",onClick:ae,class:"btn btn-secondary",disabled:x.value},"Reset to Defaults",8,at)])])):v.value&&u.value&&!I.value?(l(),n("div",lt,[w(ke,{class:"w-5 h-5 flex-shrink-0"}),e[15]||(e[15]=t("span",null,"An administrator has locked the parameters for this model alias. Your personal settings will be ignored.",-1))])):k("",!0),t("div",ot,[t("button",{type:"submit",class:"btn btn-primary",disabled:x.value||!O.value},f(x.value?"Saving...":"Save TTS Settings"),9,nt)])],32)])])}}},vt=le(it,[["__scopeId","data-v-c253eba2"]]);export{vt as default};
