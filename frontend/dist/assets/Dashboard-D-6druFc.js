import{ad as B,b as l,d as n,co as de,h as e,c7 as V,b_ as K,a as N,c as S,r as U,w as ce,g as z,e as g,j as A,H as ue,t as c,ak as L,F as P,m as I,n as D,a5 as Q,i as w,Y as ge,q as T,cb as pe,X as be,cP as Y,cQ as X,cR as Z,cS as J,da as ee,cT as ve,cU as te,cV as se,cW as me,cX as ye,db as he,a3 as O,O as _e,c1 as G,o as ae,f as W,U as ne,cg as oe,ca as fe,u as xe,cY as ke,ce as we,Q as q,l as Ce,v as $e,a8 as Se,a9 as Me}from"./index-DnjdbnqE.js";import{I as Ae}from"./IconPlayCircle-CuCtO7Ea.js";import{L as ze,B as re}from"./chartjs-adapter-date-fns.esm-DQXwVeFA.js";const Ue={},De={fill:"currentColor",height:"800px",width:"800px",version:"1.1",id:"Capa_1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512","xml:space":"preserve"};function Te($,o){return n(),l("svg",De,o[0]||(o[0]=[de(`<g><path d="M480.003,128H48c0-22.056-17.944-40-40-40c-4.418,0-8,3.582-8,8s3.582,8,8,8c13.234,0,24,10.766,24,24v288\r
		c0,4.418,3.582,8,8,8s8-3.582,8-8v-8h16.01C77.238,408,88,397.238,88,384.01V384h392.003C497.646,384,512,369.646,512,352.003\r
		V159.997C512,142.354,497.646,128,480.003,128z M496,352.003c0,8.821-7.176,15.997-15.997,15.997H80c-4.418,0-8,3.582-8,8v8.01\r
		c0,4.406-3.584,7.99-7.99,7.99H48V144h432.003c8.821,0,15.997,7.176,15.997,15.997V352.003z"></path><path d="M240,192c-22.922,0-43.057,12.12-54.363,30.28c-0.784,0.849-1.379,1.856-1.737,2.954c-5.03,9.136-7.9,19.621-7.9,30.766\r
		c0,11.406,3.013,22.115,8.264,31.399c0.187,0.398,0.407,0.778,0.656,1.14C196.078,307.354,216.586,320,240,320\r
		c35.29,0,64-28.71,64-64c0-11.406-3.013-22.115-8.264-31.399c-0.187-0.398-0.407-0.778-0.656-1.14\r
		C283.922,204.646,263.414,192,240,192z M192,256c0-4.395,0.605-8.648,1.717-12.695c3.596,3.178,8.453,6.73,15.035,10.53\r
		c6.376,3.681,11.742,6.078,16.208,7.612c-2.622,2.061-5.987,4.385-10.208,6.821c-8.449,4.878-14.816,7.039-18.36,7.752\r
		C193.58,269.922,192,263.144,192,256z M288,256c0,4.103-0.52,8.087-1.493,11.891c-3.617-3.227-8.542-6.848-15.259-10.726\r
		c-5.96-3.441-11.036-5.758-15.321-7.298c2.483-1.885,5.564-3.966,9.321-6.135c8.447-4.876,14.816-7.039,18.36-7.752\r
		C286.42,242.078,288,248.856,288,256z M273.948,222.099c-4.562,1.524-10.087,3.96-16.699,7.777\r
		c-6.252,3.61-10.952,6.997-14.49,10.051C242.31,236.682,242,232.717,242,228c0-9.763,1.314-16.361,2.469-19.785\r
		C255.934,209.279,266.244,214.384,273.948,222.099z M227.619,209.627C226.655,214.344,226,220.354,226,228\r
		c0,7.056,0.557,12.721,1.401,17.26c-3.022-1.232-6.59-2.938-10.65-5.282c-8.302-4.793-13.33-9.159-15.769-11.883\r
		C207.376,219.18,216.739,212.535,227.619,209.627z M206.049,289.898c4.564-1.524,10.086-3.954,16.702-7.774\r
		c6.252-3.61,10.952-6.997,14.49-10.051C237.69,275.318,238,279.283,238,284c0,9.763-1.314,16.361-2.469,19.785\r
		C224.065,302.721,213.753,297.615,206.049,289.898z M252.381,302.373C253.345,297.656,254,291.646,254,284\r
		c0-7.633-0.653-13.635-1.614-18.347c3.066,1.237,6.708,2.97,10.863,5.368c8.764,5.06,13.892,9.652,16.163,12.33\r
		C273.012,292.546,263.486,299.405,252.381,302.373z"></path><path d="M440,168c-4.418,0-8,3.582-8,8s3.582,8,8,8c8.822,0,16,7.178,16,16v112c0,8.822-7.178,16-16,16H240\r
		c-39.701,0-72-32.299-72-72s32.299-72,72-72h168c4.418,0,8-3.582,8-8s-3.582-8-8-8H240c-48.523,0-88,39.477-88,88s39.477,88,88,88\r
		h200c17.645,0,32-14.355,32-32V200C472,182.355,457.645,168,440,168z"></path><path d="M112,232H88c-8.822,0-16,7.178-16,16v16c0,8.822,7.178,16,16,16h24c8.822,0,16-7.178,16-16v-16\r
		C128,239.178,120.822,232,112,232z M88,264v-16h24l0.001,16H88z"></path><path d="M112,176H88c-8.822,0-16,7.178-16,16v16c0,8.822,7.178,16,16,16h24c8.822,0,16-7.178,16-16v-16\r
		C128,183.178,120.822,176,112,176z M88,208v-16h24l0.001,16H88z"></path><path d="M112,288H88c-8.822,0-16,7.178-16,16v16c0,8.822,7.178,16,16,16h24c8.822,0,16-7.178,16-16v-16\r
		C128,295.178,120.822,288,112,288z M88,320v-16h24l0.001,16H88z"></path><path d="M432,200h-24c-4.418,0-8,3.582-8,8s3.582,8,8,8h24c4.418,0,8-3.582,8-8S436.418,200,432,200z"></path><path d="M432,296h-24c-4.418,0-8,3.582-8,8s3.582,8,8,8h24c4.418,0,8-3.582,8-8S436.418,296,432,296z"></path><path d="M432,224h-24c-4.418,0-8,3.582-8,8s3.582,8,8,8h24c4.418,0,8-3.582,8-8S436.418,224,432,224z"></path><path d="M432,248h-24c-4.418,0-8,3.582-8,8s3.582,8,8,8h24c4.418,0,8-3.582,8-8S436.418,248,432,248z"></path><path d="M432,272h-24c-4.418,0-8,3.582-8,8s3.582,8,8,8h24c4.418,0,8-3.582,8-8S436.418,272,432,272z"></path></g>`,1)]))}const Be=B(Ue,[["render",Te]]),Le={},Pe={width:"20px",height:"20px",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function Ie($,o){return n(),l("svg",Pe,o[0]||(o[0]=[e("path",{d:"M20.5 11L18.7396 7.60473C18.253 6.65855 18.0097 6.18545 17.6514 5.84012C17.3346 5.5347 16.9544 5.30272 16.5379 5.16065C16.067 5 15.535 5 14.471 5H9.52901C8.46503 5 7.93304 5 7.46209 5.16065C7.04558 5.30272 6.66542 5.5347 6.34859 5.84012C5.99034 6.18545 5.74703 6.65855 5.26042 7.60473L3.5 11M20.5 11C20.6981 11.3853 20.7658 11.5446 20.8357 11.747C20.8977 11.9267 20.9426 12.1119 20.9696 12.3002C21 12.5121 21 12.7287 21 13.162V14.2C21 15.8802 21 16.7202 20.673 17.362C20.3854 17.9265 19.9265 18.3854 19.362 18.673C18.7202 19 17.8802 19 16.2 19H7.8C6.11984 19 5.27976 19 4.63803 18.673C4.07354 18.3854 3.6146 17.9265 3.32698 17.362C3 16.7202 3 15.8802 3 14.2V13.162C3 12.7287 3 12.5121 3.03041 12.3002C3.05741 12.1119 3.10225 11.9267 3.16432 11.747C3.23421 11.5446 3.30186 11.3853 3.5 11M20.5 11H3.5M15 15H17",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)]))}const je=B(Le,[["render",Ie]]),He={key:0,class:"space-y-6"},Ve={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"},Ne={class:"bg-white dark:bg-gray-800 p-5 rounded-xl shadow-sm border dark:border-gray-700"},Re={class:"flex items-center mb-4 text-blue-600"},Ge={class:"space-y-2"},Fe={class:"flex justify-between text-sm"},Ee={class:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2"},Oe={class:"text-xs text-gray-500 text-right"},We={class:"flex items-center justify-between mb-4"},qe={class:"flex items-center text-gray-700 dark:text-gray-200"},Ke=["title"],Qe={class:"flex gap-1"},Ye={key:0,class:"px-2 py-0.5 rounded bg-green-100 text-green-800 text-xs font-bold"},Xe={key:1,class:"px-2 py-0.5 rounded bg-purple-100 text-purple-800 text-xs font-bold"},Ze={class:"space-y-2"},Je={class:"flex justify-between text-sm"},et={class:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2"},tt={class:"text-xs text-gray-500 text-right"},st={key:0,class:"bg-white dark:bg-gray-800 rounded-xl shadow-sm overflow-hidden border dark:border-gray-700"},at={class:"flex flex-col md:flex-row md:items-center justify-between mb-6 gap-6"},nt={class:"flex items-center gap-3 min-w-[200px]"},ot={class:"font-bold text-lg"},rt={class:"text-sm font-normal text-gray-500"},lt={class:"flex-grow space-y-3"},it={class:"flex justify-between text-xs mb-1"},dt={class:"font-bold"},ct={class:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2"},ut={class:"flex justify-between text-xs mb-1"},gt={class:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2"},pt={key:0,class:"mt-4 border dark:border-gray-600 rounded-lg overflow-hidden"},bt={class:"w-full text-sm text-left"},vt={class:"px-4 py-2 font-mono"},mt={class:"px-4 py-2"},yt={class:"px-4 py-2"},ht={class:"px-4 py-2 text-right"},_t=["onClick"],ft={key:1,class:"mt-2 text-xs text-gray-500 italic"},xt={class:"bg-white dark:bg-gray-800 rounded-xl shadow-sm border dark:border-gray-700 p-6"},kt={class:"flex items-center justify-between mb-4"},wt={class:"flex gap-2"},Ct=["disabled"],$t={key:0,class:"bg-gray-50 dark:bg-gray-900/50 rounded-lg p-4 text-sm border dark:border-gray-700"},St={class:"flex justify-between items-center mb-3 text-xs text-gray-500"},Mt={key:1,class:"text-center py-8 text-gray-500 dark:text-gray-400 border-2 border-dashed border-gray-200 dark:border-gray-700 rounded-lg"},At={__name:"SystemStatus",setup($){const o=V(),u=K(),r=N(),d=S(()=>o.systemStatus),m=U(null),h=U(!1),f=S(()=>u.tasks.filter(t=>t.name==="Analyze System Logs").sort((t,s)=>new Date(s.created_at)-new Date(t.created_at)));ce(f,t=>{var a;const s=t[0];s?s.status==="running"||s.status==="pending"?h.value=!0:(h.value=!1,s.status==="completed"&&((a=s.result)!=null&&a.report)&&(m.value=s.result)):(h.value=!1,m.value=null)},{immediate:!0});async function _(){try{await o.analyzeSystemLogs(),h.value=!0}catch{}}async function k(t,s){(await r.showConfirmation({title:"Kill Process?",message:`Are you sure you want to kill process ${t} on ${s}? This might crash running generations.`,confirmText:"Kill",isDanger:!0})).confirmed&&await o.killProcess(t)}const b=t=>t?`${t.toFixed(1)} GB`:"0 GB",p=t=>t?`${t.toFixed(1)}%`:"0%";return(t,s)=>d.value?(n(),l("div",He,[s[13]||(s[13]=e("h3",{class:"text-xl font-bold text-gray-900 dark:text-white"},"Hardware Status",-1)),e("div",Ve,[e("div",Ne,[e("div",Re,[g(ue,{class:"w-6 h-6 mr-2"}),s[1]||(s[1]=A()),s[2]||(s[2]=e("span",{class:"font-semibold"},"System RAM",-1))]),e("div",Ge,[e("div",Fe,[s[3]||(s[3]=e("span",null,"Usage",-1)),e("span",null,c(p(d.value.cpu_ram_usage_percent)),1)]),e("div",Ee,[e("div",{class:"bg-blue-600 h-2 rounded-full",style:L({width:d.value.cpu_ram_usage_percent+"%"})},null,4)]),e("div",Oe,c(b(d.value.cpu_ram_used_gb))+" / "+c(b(d.value.cpu_ram_total_gb)),1)])]),(n(!0),l(P,null,I(d.value.disks,a=>(n(),l("div",{key:a.mount_point,class:D(["bg-white dark:bg-gray-800 p-5 rounded-xl shadow-sm border-l-4",{"border-green-500":a.is_app_disk,"border-purple-500":a.is_data_disk,"border-gray-300 dark:border-gray-600":!a.is_app_disk&&!a.is_data_disk}])},[e("div",We,[e("div",qe,[g(je,{class:"w-6 h-6 mr-2"}),e("span",{class:"font-semibold truncate max-w-[120px]",title:a.mount_point},c(a.mount_point),9,Ke)]),e("div",Qe,[a.is_app_disk?(n(),l("span",Ye,"CODE")):z("",!0),a.is_data_disk?(n(),l("span",Xe,"DATA")):z("",!0)])]),e("div",Ze,[e("div",Je,[s[4]||(s[4]=e("span",null,"Used",-1)),e("span",null,c(p(a.usage_percent)),1)]),e("div",et,[e("div",{class:"bg-gray-600 dark:bg-gray-400 h-2 rounded-full",style:L({width:a.usage_percent+"%"})},null,4)]),e("div",tt,c(b(a.used_gb))+" / "+c(b(a.total_gb)),1)])],2))),128))]),d.value.gpus&&d.value.gpus.length?(n(),l("div",st,[s[8]||(s[8]=e("div",{class:"p-4 bg-gray-50 dark:bg-gray-700/30 border-b dark:border-gray-700 font-semibold"},"GPU Details",-1)),(n(!0),l(P,null,I(d.value.gpus,a=>(n(),l("div",{key:a.id,class:"p-6 border-b last:border-0 dark:border-gray-700"},[e("div",at,[e("div",nt,[g(Be,{class:"w-8 h-8 text-green-500"}),e("div",null,[e("h4",ot,[A(c(a.name)+" ",1),e("span",rt,"[ID: "+c(a.id)+"]",1)])])]),e("div",lt,[e("div",null,[e("div",it,[s[5]||(s[5]=e("span",null,"Compute Load",-1)),e("span",dt,c(a.gpu_utilization)+"%",1)]),e("div",ct,[e("div",{class:"bg-orange-500 h-2 rounded-full transition-all duration-500",style:L({width:a.gpu_utilization+"%"})},null,4)])]),e("div",null,[e("div",ut,[s[6]||(s[6]=e("span",null,"VRAM",-1)),e("span",null,c(b(a.vram_used_gb))+" / "+c(b(a.vram_total_gb))+" ("+c(p(a.vram_usage_percent))+")",1)]),e("div",gt,[e("div",{class:"bg-indigo-500 h-2 rounded-full transition-all duration-500",style:L({width:a.vram_usage_percent+"%"})},null,4)])])])]),a.processes&&a.processes.length?(n(),l("div",pt,[e("table",bt,[s[7]||(s[7]=e("thead",{class:"text-xs text-gray-500 uppercase bg-gray-50 dark:bg-gray-900/50"},[e("tr",null,[e("th",{class:"px-4 py-2"},"PID"),e("th",{class:"px-4 py-2"},"Process Name"),e("th",{class:"px-4 py-2"},"VRAM Usage"),e("th",{class:"px-4 py-2 text-right"},"Action")])],-1)),e("tbody",null,[(n(!0),l(P,null,I(a.processes,v=>(n(),l("tr",{key:v.pid,class:"border-t dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-800/50"},[e("td",vt,c(v.pid),1),e("td",mt,c(v.name),1),e("td",yt,c(v.memory_used.toFixed(0))+" MB",1),e("td",ht,[e("button",{onClick:y=>k(v.pid,a.name),class:"text-red-500 hover:text-red-700 px-2 py-1 rounded hover:bg-red-50 dark:hover:bg-red-900/20",title:"Kill Process"},[g(Q,{class:"w-4 h-4"})],8,_t)])]))),128))])])])):(n(),l("div",ft,"No active processes detected on this GPU."))]))),128))])):z("",!0),e("div",xt,[e("div",kt,[s[10]||(s[10]=e("h3",{class:"text-lg font-bold text-gray-900 dark:text-white"},"AI Log Analysis",-1)),e("div",wt,[e("button",{onClick:s[0]||(s[0]=a=>w(r).openModal("systemLog")),class:"btn btn-secondary btn-sm flex items-center gap-2"},[g(ge,{class:"w-4 h-4"}),s[9]||(s[9]=A(" View Logs "))]),e("button",{onClick:_,disabled:h.value,class:"btn btn-secondary btn-sm flex items-center gap-2"},[h.value?(n(),T(pe,{key:0,class:"w-4 h-4 animate-spin"})):(n(),T(Ae,{key:1,class:"w-4 h-4"})),A(" "+c(h.value?"Analyzing...":m.value?"Regenerate Analysis":"Analyze Logs"),1)],8,Ct)])]),m.value?(n(),l("div",$t,[e("div",St,[s[11]||(s[11]=e("span",{class:"font-semibold"},"Analysis Report",-1)),e("span",null,"Generated: "+c(new Date(m.value.generated_at).toLocaleString()),1)]),g(be,{content:m.value.report,class:"prose dark:prose-invert prose-sm max-w-none"},null,8,["content"])])):(n(),l("div",Mt,s[12]||(s[12]=[e("p",null,'Click "Analyze Logs" to have the AI scan recent system tasks and identify potential issues.',-1)])))])])):z("",!0)}},zt={class:"space-y-6"},Ut={class:"bg-white dark:bg-gray-800 rounded-lg shadow p-5"},Dt={class:"flex justify-between items-center mb-4 flex-wrap gap-2"},Tt={class:"inline-flex rounded-md shadow-sm",role:"group"},Bt={class:"flex items-center gap-2"},Lt={class:"h-96"},Pt={key:0,class:"flex items-center justify-center h-full"},It={key:1,class:"flex items-center justify-center h-full"},jt={key:2,class:"h-full"},Ht={__name:"GlobalStatsChart",props:{stats:{type:Object,default:null},isLoading:{type:Boolean,default:!1}},setup($){Y.register(X,Z,J,ee,ve,te,se,me,ye,he);const o=$,u=N(),r=U("daily"),d=U(null),m=S(()=>r.value==="daily"||r.value==="weekly_stats"?ze:re),h=S(()=>({responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:r.value==="daily"||r.value==="weekly_stats"},title:{display:!0,text:f.value,color:u.currentTheme==="dark"?"#e5e7eb":"#1f2937"}},scales:{x:{type:r.value==="daily"?"time":"category",time:{unit:"day",tooltipFormat:"MMM d, yyyy"},grid:{color:u.currentTheme==="dark"?"rgba(255, 255, 255, 0.1)":"rgba(0, 0, 0, 0.1)"},ticks:{color:u.currentTheme==="dark"?"#cbd5e1":"#4b5563"}},y:{beginAtZero:!0,grid:{color:u.currentTheme==="dark"?"rgba(255, 255, 255, 0.1)":"rgba(0, 0, 0, 0.1)"},ticks:{color:u.currentTheme==="dark"?"#cbd5e1":"#4b5563"}}}})),f=S(()=>{switch(r.value){case"mean":return"Average Daily Generations by Weekday";case"variance":return"Generation Variance by Weekday";case"weekly_stats":return"Weekly Generation Statistics (Mean Â± Std Dev)";case"daily":default:return"Total AI Generations (Last 30 Days)"}}),_=S(()=>{if(!o.stats)return{labels:[],datasets:[]};const p=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"];if(r.value==="daily")return{labels:o.stats.generations_per_day.map(t=>t.date),datasets:[{label:"Generations",data:o.stats.generations_per_day.map(t=>t.count),borderColor:"#3b82f6",backgroundColor:"rgba(59, 130, 246, 0.2)",tension:.1,fill:!0}]};if(r.value==="mean")return{labels:p,datasets:[{label:"Mean Generations",data:p.map(t=>o.stats.mean_per_weekday[t]),backgroundColor:"#10b981"}]};if(r.value==="variance")return{labels:p,datasets:[{label:"Variance",data:p.map(t=>o.stats.variance_per_weekday[t]),backgroundColor:"#f59e0b"}]};if(r.value==="weekly_stats"){const t=p.map(y=>o.stats.mean_per_weekday[y]),s=p.map(y=>Math.sqrt(o.stats.variance_per_weekday[y])),a=t.map((y,M)=>y+s[M]),v=t.map((y,M)=>Math.max(0,y-s[M]));return{labels:p,datasets:[{label:"Mean",data:t,borderColor:"#3b82f6",backgroundColor:"rgba(59, 130, 246, 0.5)",tension:.1,pointRadius:4,pointBackgroundColor:"#3b82f6"},{label:"Std. Deviation Range",data:a,borderColor:"transparent",backgroundColor:"rgba(59, 130, 246, 0.15)",pointRadius:0,fill:"+1"},{label:"Lower Bound",data:v,borderColor:"transparent",backgroundColor:"transparent",pointRadius:0,showInLegend:!1}]}}return{labels:[],datasets:[]}});function k(){if(d.value&&d.value.chart){const p=document.createElement("a");p.href=d.value.chart.toBase64Image("image/png",1),p.download=`lollms_global_stats_${r.value}.png`,p.click()}else u.addNotification("Could not export chart image.","error")}function b(){if(!o.stats){u.addNotification("No data to export.","warning");return}let p="data:text/csv;charset=utf-8,",t=[];if(r.value==="daily")t.push(["date","generation_count"]),o.stats.generations_per_day.forEach(v=>{t.push([v.date,v.count])});else if(r.value==="weekly_stats")t.push(["weekday","mean","variance","std_deviation"]),["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"].forEach(y=>{const M=o.stats.mean_per_weekday[y],j=o.stats.variance_per_weekday[y],R=Math.sqrt(j);t.push([y,M,j,R])});else{t.push(["weekday",r.value]);const v=r.value==="mean"?o.stats.mean_per_weekday:o.stats.variance_per_weekday;Object.entries(v).forEach(([y,M])=>{t.push([y,M])})}p+=t.map(v=>v.join(",")).join(`
`);const s=encodeURI(p),a=document.createElement("a");a.setAttribute("href",s),a.setAttribute("download",`lollms_global_stats_${r.value}.csv`),document.body.appendChild(a),a.click(),document.body.removeChild(a)}return(p,t)=>(n(),l("div",zt,[t[8]||(t[8]=e("h3",{class:"text-xl font-semibold leading-6 text-gray-900 dark:text-white"}," Global Usage Statistics ",-1)),e("div",Ut,[e("div",Dt,[e("div",Tt,[e("button",{onClick:t[0]||(t[0]=s=>r.value="daily"),type:"button",class:D(["btn-group",{active:r.value==="daily"}])},"Daily",2),e("button",{onClick:t[1]||(t[1]=s=>r.value="weekly_stats"),type:"button",class:D(["btn-group",{active:r.value==="weekly_stats"}])},"Weekly Stats",2),e("button",{onClick:t[2]||(t[2]=s=>r.value="mean"),type:"button",class:D(["btn-group",{active:r.value==="mean"}])},"Mean",2),e("button",{onClick:t[3]||(t[3]=s=>r.value="variance"),type:"button",class:D(["btn-group",{active:r.value==="variance"}])},"Variance",2)]),e("div",Bt,[e("button",{onClick:k,class:"btn btn-secondary btn-sm",title:"Export as PNG"},[g(O,{class:"w-4 h-4 mr-1"}),t[4]||(t[4]=A(" PNG "))]),e("button",{onClick:b,class:"btn btn-secondary btn-sm",title:"Export as CSV"},[g(O,{class:"w-4 h-4 mr-1"}),t[5]||(t[5]=A(" CSV "))])])]),e("div",Lt,[$.isLoading?(n(),l("div",Pt,t[6]||(t[6]=[e("p",{class:"text-gray-500"},"Loading chart data...",-1)]))):$.stats?(n(),l("div",jt,[(n(),T(_e(m.value),{data:_.value,options:h.value,ref_key:"chartRef",ref:d},null,8,["data","options"]))])):(n(),l("div",It,t[7]||(t[7]=[e("p",{class:"text-gray-500"},"Could not load statistics.",-1)])))])])]))}},Vt=B(Ht,[["__scopeId","data-v-a10fe633"]]),Nt={class:"bg-white dark:bg-gray-800 p-6 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700 h-96 flex flex-col"},Rt={class:"flex-grow relative"},Gt={key:0,class:"absolute inset-0 flex items-center justify-center"},Ft={key:1,class:"absolute inset-0 flex items-center justify-center"},Et={__name:"ModelUsageChart",setup($){Y.register(X,Z,J,ee,te,se);const o=V(),{modelUsageStats:u,isLoadingModelUsageStats:r}=G(o);ae(()=>{o.fetchModelUsageStats()});const d=S(()=>{const h=Array.isArray(u.value)?u.value:[],f=h.map(k=>k.model_name),_=h.map(k=>k.count);return{labels:f,datasets:[{label:"Users Assigned",backgroundColor:"#3B82F6",borderRadius:6,data:_}]}}),m={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{mode:"index",intersect:!1}},scales:{y:{beginAtZero:!0,grid:{color:"#374151"},ticks:{stepSize:1,color:"#9CA3AF"}},x:{grid:{display:!1},ticks:{color:"#9CA3AF"}}}};return(h,f)=>(n(),l("div",Nt,[f[2]||(f[2]=e("h3",{class:"text-lg font-semibold text-gray-900 dark:text-white mb-4"},"Default Model Distribution",-1)),e("div",Rt,[w(r)?(n(),l("div",Gt,f[0]||(f[0]=[e("p",{class:"text-gray-500"},"Loading stats...",-1)]))):!w(u)||w(u).length===0?(n(),l("div",Ft,f[1]||(f[1]=[e("p",{class:"text-gray-500"},"No data available.",-1)]))):(n(),T(w(re),{key:2,data:d.value,options:m},null,8,["data"]))])]))}},Ot={key:0,class:"text-center p-6 text-gray-500"},Wt={key:1,class:"space-y-4"},qt={class:"flex justify-between items-center bg-blue-50 dark:bg-blue-900/20 p-3 rounded-lg"},Kt={class:"text-sm font-medium text-blue-800 dark:text-blue-200"},Qt=["disabled"],Yt={class:"divide-y divide-gray-200 dark:divide-gray-700 max-h-96 overflow-y-auto"},Xt={class:"flex items-center"},Zt={class:"ml-3"},Jt={class:"text-sm font-medium text-gray-900 dark:text-white"},es={class:"text-xs text-gray-500"},ts={class:"text-xs text-gray-400"},ss=["onClick"],as={__name:"PendingUsersModal",setup($){const o=N(),u=V(),r=S(()=>u.allUsers),d=S(()=>r.value.filter(_=>!_.is_active)),m=U(!1);async function h(_){try{await u.activateUser(_.id)}catch{o.addNotification("Failed to activate user","error")}}async function f(){m.value=!0;try{for(const _ of d.value)await u.activateUser(_.id);o.closeModal("pendingUsers")}finally{m.value=!1}}return(_,k)=>(n(),T(fe,{"modal-name":"pendingUsers",title:"Pending User Approvals"},{body:W(()=>[d.value.length===0?(n(),l("div",Ot," No pending users found. ")):(n(),l("div",Wt,[e("div",qt,[e("span",Kt,c(d.value.length)+" users waiting.",1),e("button",{onClick:f,class:"btn btn-primary btn-sm",disabled:m.value},c(m.value?"Activating...":"Activate All"),9,Qt)]),e("ul",Yt,[(n(!0),l(P,null,I(d.value,b=>(n(),l("li",{key:b.id,class:"py-3 flex items-center justify-between"},[e("div",Xt,[g(ne,{icon:b.icon,username:b.username,"size-class":"h-10 w-10"},null,8,["icon","username"]),e("div",Zt,[e("p",Jt,c(b.username),1),e("p",es,c(b.email||"No email"),1),e("p",ts,"Registered: "+c(new Date(b.created_at).toLocaleDateString()),1)])]),e("button",{onClick:p=>h(b),class:"btn-icon text-green-600 hover:bg-green-50 dark:hover:bg-green-900/20",title:"Approve"},[g(oe,{class:"w-6 h-6"})],8,ss)]))),128))])]))]),footer:W(()=>[e("button",{onClick:k[0]||(k[0]=b=>w(o).closeModal("pendingUsers")),class:"btn btn-secondary"},"Close")]),_:1}))}},ns={},os={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor"};function rs($,o){return n(),l("svg",os,o[0]||(o[0]=[e("path",{d:"M3.375 3C2.339 3 1.5 3.84 1.5 4.875v.75c0 1.036.84 1.875 1.875 1.875h17.25c1.035 0 1.875-.84 1.875-1.875v-.75C22.5 3.839 21.66 3 20.625 3H3.375z"},null,-1),e("path",{"fill-rule":"evenodd",d:"M3.087 9l.54 9.176A3 3 0 006.62 21h10.757a3 3 0 002.995-2.824L20.913 9H3.087zm6.163 3.75A.75.75 0 0110 12h4a.75.75 0 010 1.5h-4a.75.75 0 01-.75-.75z","clip-rule":"evenodd"},null,-1)]))}const ls=B(ns,[["render",rs]]),is={},ds={class:"w-5 h-5 fill-current"};function cs($,o){return n(),l("div",ds,o[0]||(o[0]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},[e("path",{d:"M12 17a2 2 0 1 0 0-4 2 2 0 0 0 0 4zm6-7h-1V7a5 5 0 0 0-10 0v3H6a2 2 0 0 0-2 2v7a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-7a2 2 0 0 0-2-2zm-7-3a3 3 0 0 1 6 0v3H11V7zm7 12H6v-7h12v7z"})],-1)]))}const us=B(is,[["render",cs]]),gs={class:"space-y-8 animate-fade-in p-2"},ps={class:"flex flex-col md:flex-row md:items-center justify-between gap-4"},bs={key:0,class:"flex items-center gap-4 mt-1 text-sm text-gray-500 dark:text-gray-400"},vs={class:"flex items-center gap-1"},ms={key:0,class:"flex items-center gap-1 text-green-600 dark:text-green-400"},ys={key:1,class:"flex items-center gap-1 text-yellow-600 dark:text-yellow-400"},hs=["disabled"],_s={key:0,class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6"},fs={class:"metric-card"},xs={class:"metric-value"},ks={class:"metric-icon bg-blue-100 dark:bg-blue-900/30 text-blue-600"},ws={class:"metric-value"},Cs={class:"metric-icon bg-orange-100 dark:bg-orange-900/30 text-orange-600"},$s={key:0,class:"absolute top-0 right-0 -mt-1 -mr-1 flex h-3 w-3"},Ss={class:"metric-card"},Ms={class:"metric-value"},As={class:"metric-icon bg-green-100 dark:bg-green-900/30 text-green-600"},zs={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},Us={class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},Ds={class:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6 border border-gray-100 dark:border-gray-700"},Ts={class:"grid grid-cols-2 gap-4 mb-6"},Bs={class:"flex gap-2"},Ls=["disabled"],Ps={class:"lg:col-span-2 bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6 border border-gray-100 dark:border-gray-700 flex flex-col"},Is={class:"font-semibold mb-4 text-gray-900 dark:text-white flex justify-between"},js={class:"flex-grow overflow-y-auto max-h-64 space-y-3"},Hs={key:0,class:"text-center text-gray-500 py-4"},Vs={class:"flex items-center gap-3 w-1/3"},Ns={class:"font-medium text-sm truncate"},Rs={class:"w-1/3 px-4"},Gs={class:"flex justify-between text-xs text-gray-500 mb-1"},Fs={class:"w-full bg-gray-200 dark:bg-gray-600 rounded-full h-1.5"},Es=["onClick"],Os={__name:"Dashboard",setup($){const o=U(null),u=U(!0),r=N(),d=V(),m=K(),h=xe(),{connectedUsers:f,serverInfo:_,allUsers:k,globalGenerationStats:b,isLoadingGlobalGenerationStats:p}=G(d),{tasks:t}=G(m),s=U(""),a=U(!1),v=S(()=>k.value.length?f.value.map(x=>{const i=k.value.find(H=>H.id===x.id)||x,C=t.value.filter(H=>H.owner_username===i.username&&H.status==="running").length,E=Math.min(C*20,100);return{...i,current_load:E}}):[]),y=S(()=>{var x;return((x=o.value)==null?void 0:x.pending_approval)||0});async function M(){u.value=!0;try{await Promise.all([d.fetchAllUsers(),d.fetchDashboardStats(),d.fetchSystemStatus(),d.fetchServerInfo(),d.fetchGlobalGenerationStats(),d.fetchConnectedUsers(),m.fetchTasks()]),o.value=d.dashboardStats}finally{u.value=!1}}async function j(){const x=await r.showConfirmation({title:"Purge Temporary Files?",message:"Delete temporary files older than 24 hours?",confirmText:"Purge",cancelText:"Cancel"});x&&x.confirmed&&(d.purgeUnusedUploads(),r.addNotification("Purge started.","info"))}async function R(){const{confirmed:x,value:i}=await r.showConfirmation({title:"Secure System Backup",message:"Enter a MANDATORY password to encrypt the backup.",confirmText:"Backup",inputType:"password",inputPlaceholder:"Encryption Password"});if(x){if(!i){r.addNotification("Password is required for backup.","error");return}try{await d.createBackup(i),r.addNotification("Secure backup task started.","info")}catch{r.addNotification("Failed to start backup.","error")}}}async function F(){if(s.value.trim()){a.value=!0;try{await d.broadcastMessage(s.value),r.addNotification("Broadcast sent.","success"),s.value=""}finally{a.value=!1}}}function le(){y.value>0&&r.openModal("pendingUsers")}function ie(x){h.openConversation({id:x.id,username:x.username,icon:x.icon})}return ae(M),(x,i)=>(n(),l("div",gs,[e("div",ps,[e("div",null,[i[3]||(i[3]=e("h2",{class:"text-2xl font-bold text-gray-900 dark:text-white"},"System Dashboard",-1)),w(_)?(n(),l("div",bs,[e("span",vs,[e("span",{class:D(["w-2 h-2 rounded-full",w(_).https_enabled?"bg-green-500":"bg-yellow-500"])},null,2),A(" "+c(w(_).url),1)]),w(_).https_enabled?(n(),l("span",ms,[g(ke,{class:"w-3 h-3"}),i[1]||(i[1]=A(" HTTPS Active"))])):(n(),l("span",ys,[g(us,{class:"w-3 h-3"}),i[2]||(i[2]=A(" HTTP Only"))]))])):z("",!0)]),e("button",{onClick:M,class:"btn btn-secondary btn-sm",disabled:u.value},[g(we,{class:D(["w-4 h-4 mr-2",{"animate-spin":u.value}])},null,8,["class"]),i[4]||(i[4]=A(" Refresh "))],8,hs)]),o.value?(n(),l("div",_s,[e("div",fs,[e("div",null,[i[5]||(i[5]=e("p",{class:"metric-label"},"Total Users",-1)),e("p",xs,c(o.value.total_users),1)]),e("div",ks,[g(q,{class:"w-6 h-6"})])]),e("div",{class:"metric-card cursor-pointer hover:ring-2 ring-orange-400 transition-all",onClick:le,title:"Click to manage pending users"},[e("div",null,[i[6]||(i[6]=e("p",{class:"metric-label"},"Pending Approval",-1)),e("p",ws,c(y.value),1)]),e("div",Cs,[g(q,{class:"w-6 h-6"}),y.value>0?(n(),l("span",$s,i[7]||(i[7]=[e("span",{class:"animate-ping absolute inline-flex h-full w-full rounded-full bg-orange-400 opacity-75"},null,-1),e("span",{class:"relative inline-flex rounded-full h-3 w-3 bg-orange-500"},null,-1)]))):z("",!0)])]),e("div",Ss,[e("div",null,[i[8]||(i[8]=e("p",{class:"metric-label"},"Active (24h)",-1)),e("p",Ms,c(o.value.active_users_24h),1)]),e("div",As,[g(oe,{class:"w-6 h-6"})])])])):z("",!0),e("div",zs,[g(Vt,{stats:w(b),"is-loading":w(p)},null,8,["stats","is-loading"]),g(Et)]),e("div",Us,[e("div",Ds,[i[12]||(i[12]=e("h3",{class:"font-semibold mb-4 text-gray-900 dark:text-white"},"System Actions",-1)),e("div",Ts,[e("button",{onClick:R,class:"action-btn border-blue-200 hover:bg-blue-50 dark:border-blue-800 dark:hover:bg-blue-900/20"},[g(ls,{class:"w-6 h-6 text-blue-500 mb-2"}),i[9]||(i[9]=e("span",{class:"text-sm font-medium"},"Secure Backup",-1))]),e("button",{onClick:j,class:"action-btn border-red-200 hover:bg-red-50 dark:border-red-800 dark:hover:bg-red-900/20"},[g(Q,{class:"w-6 h-6 text-red-500 mb-2"}),i[10]||(i[10]=e("span",{class:"text-sm font-medium"},"Purge Temp",-1))])]),e("div",null,[i[11]||(i[11]=e("label",{class:"text-xs font-medium text-gray-500 uppercase mb-2 block"},"Quick Broadcast",-1)),e("div",Bs,[Ce(e("input",{"onUpdate:modelValue":i[0]||(i[0]=C=>s.value=C),type:"text",class:"input-field text-sm",placeholder:"Message to all...",onKeyup:Se(F,["enter"])},null,544),[[$e,s.value]]),e("button",{onClick:F,disabled:!s.value||a.value,class:"btn btn-primary btn-sm"},[g(Me,{class:"w-4 h-4"})],8,Ls)])])]),e("div",Ps,[e("h3",Is,[e("span",null,"Live Users ("+c(v.value.length)+")",1)]),e("div",js,[v.value.length===0?(n(),l("div",Hs,"No active users.")):z("",!0),(n(!0),l(P,null,I(v.value,C=>(n(),l("div",{key:C.id,class:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700/30 rounded-lg"},[e("div",Vs,[g(ne,{icon:C.icon,username:C.username,"size-class":"h-8 w-8"},null,8,["icon","username"]),e("span",Ns,c(C.username),1)]),e("div",Rs,[e("div",Gs,[i[13]||(i[13]=e("span",null,"Load",-1)),e("span",null,c(C.current_load)+"%",1)]),e("div",Fs,[e("div",{class:"bg-blue-500 h-1.5 rounded-full transition-all duration-500",style:L({width:C.current_load+"%"})},null,4)])]),e("button",{onClick:E=>ie(C),class:"btn btn-secondary btn-xs"},"DM",8,Es)]))),128))])])]),g(At),w(r).activeModal==="pendingUsers"?(n(),T(as,{key:1})):z("",!0)]))}},Qs=B(Os,[["__scopeId","data-v-a20fbe4b"]]);export{Qs as default};
