import{W as ge,Q as ye,N as me,x as be,s as z,r as A,j as b,w as R,o as we,c as r,b as l,g as a,d as y,n as B,h as v,l as C,e as p,v as _,V as he,F as w,i as h,t as g,C as U,k as P,A as M,bJ as O,f as ke,O as xe,G as Ae}from"./index-BAMWhU2j.js";import Re from"./IconArrowUp-BR3bTyP5.js";import Se from"./IconArrowDown-DRY9AXHu.js";import{A as $e}from"./AppCard-BAGMYse8.js";import{A as Ce}from"./AppCardSkeleton-ClmkPPNl.js";import"./IconArrowUpCircle-B_-zkyk3.js";import"./IconGlobeAlt-C38ZYXQc.js";import"./IconPlayCircle-CY5KmMYI.js";import"./IconWrenchScrewdriver-BRyF2mjX.js";const _e={class:"space-y-6"},Te={class:"border-b border-gray-200 dark:border-gray-700"},Ie={class:"-mb-px flex space-x-6","aria-label":"Sub Tabs"},Ue={key:0},Pe={class:"space-y-4"},Me={class:"grid grid-cols-1 lg:grid-cols-4 gap-4"},De={class:"relative lg:col-span-1"},Ve={class:"grid grid-cols-1 sm:grid-cols-3 lg:col-span-3 gap-4"},Ze=["value"],Fe=["value"],Ne={class:"flex items-center gap-2"},Le=["value"],ze={key:0,class:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 2xl:grid-cols-4 gap-6"},Be={key:1,class:"empty-state-card"},Oe={key:2},je={class:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 2xl:grid-cols-4 gap-6"},qe={key:0,class:"flex justify-between items-center mt-6"},Ee=["disabled"],Qe={class:"text-sm text-gray-600 dark:text-gray-400"},He=["disabled"],Je={key:1},Ke={class:"flex justify-between items-center mb-4 flex-wrap gap-2"},We={key:0,class:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm mb-6"},Ge={class:"flex items-center gap-x-4"},Xe={key:0},Ye=["required"],et={key:1},tt=["required"],st={key:1,class:"text-center p-4"},at={key:2,class:"empty-state-card"},nt={key:3,class:"space-y-4"},ot={class:"font-semibold"},lt={class:"text-sm text-gray-500"},it={class:"text-xs text-gray-400"},rt={class:"flex items-center gap-2"},dt=["onClick"],ut=["onClick"],pt={__name:"AppsManagement",setup(ct){const i=ye(),D=me(),u=be(),{appFilters:o}=i,{zooRepositories:V,isLoadingZooRepositories:j,zooApps:S,isLoadingZooApps:q}=z(i),{tasks:E}=z(D),f=A("zoo"),d=A({type:"git",name:"",url:"",path:""}),k=A(!1),c=A(null),x=A(JSON.parse(localStorage.getItem("starredApps")||"[]"));let Z=null;const Q=[{value:"last_update_date",label:"Last Updated"},{value:"creation_date",label:"Creation Date"},{value:"name",label:"Name"},{value:"author",label:"Author"}],T=b(()=>S.value.total||0),F=b(()=>S.value.pages||1),H=b(()=>{if(T.value===0)return"Showing 0-0 of 0";const e=(o.currentPage-1)*o.pageSize+1,t=Math.min(o.currentPage*o.pageSize,T.value);return`Showing ${e}-${t} of ${T.value}`});function J(){clearTimeout(Z),Z=setTimeout(()=>{o.currentPage!==1?o.currentPage=1:i.fetchZooApps()},300)}R(()=>[o.sortKey,o.sortOrder,o.selectedCategory,o.installationStatusFilter,o.selectedRepository],()=>{o.currentPage!==1?o.currentPage=1:i.fetchZooApps()}),R(()=>o.searchQuery,J),R(()=>o.currentPage,i.fetchZooApps),R(x,e=>{localStorage.setItem("starredApps",JSON.stringify(e))},{deep:!0}),R(f,e=>{e==="zoo"&&i.fetchZooApps(),e==="source"&&i.fetchZooRepositories()}),we(()=>{f.value==="zoo"&&i.fetchZooApps(),f.value==="source"&&i.fetchZooRepositories()});const I=b(()=>{const e=new Map,t="Installing app: ",s=/^(Updating app|Start app|Stop app|Fixing item|Purging item): .* \(([a-fA-F0-9-]+)\)$/;return(E.value||[]).forEach(n=>{if(n!=null&&n.name&&(n.status==="running"||n.status==="pending")){let m;if(n.name.startsWith(t))m=`folder:${n.name.replace(t,"")}`;else{const L=n.name.match(s);L&&(m=`id:${L[2]}`)}m&&(!e.has(m)||new Date(n.created_at)>new Date(e.get(m).created_at))&&e.set(m,n)}}),(S.value.items||[]).map(n=>({...n,task:e.get(`folder:${n.folder_name}`)||(n.id?e.get(`id:${n.id}`):null)}))}),$=b(()=>Array.isArray(V.value)?[...V.value].sort((e,t)=>(e.name||"").localeCompare(t.name||"")):[]),K=b(()=>["All","Starred",...S.value.categories||[]]);function W(e){const t=x.value.indexOf(e);t>-1?x.value.splice(t,1):x.value.push(e)}function G(e){return e?new Date(e).toLocaleString():"Never"}async function X(){if(!d.value.name){u.addNotification("Repository name is required.","warning");return}const e={name:d.value.name};d.value.type==="git"?e.url=d.value.url:e.path=d.value.path,c.value="add";try{await i.addZooRepository(e),d.value={type:"git",name:"",url:"",path:""},k.value=!1}finally{c.value=null}}async function Y(e){c.value=e.id;try{await i.pullZooRepository(e.id)}finally{c.value=null}}async function ee(e){if(await u.showConfirmation({title:`Delete Repository '${e.name}'?`})){c.value=e.id;try{await i.deleteZooRepository(e.id)}finally{c.value=null}}}function te(e){u.openModal("appInstall",{app:e,type:"apps"})}async function se(e){await u.showConfirmation({title:`Update '${e.name}'?`,confirmText:"Update"})&&await i.updateApp(e.id)}async function N(e,t){c.value=`${t}-${e}`;try{t==="start"&&await i.startApp(e),t==="stop"&&await i.stopApp(e)}finally{c.value=null}}async function ae(e){if(await u.showConfirmation({title:`Uninstall '${e.name}'?`,confirmText:"Uninstall"})){c.value=`uninstall-${e.id}`;try{await i.uninstallApp(e.id)}finally{c.value=null}}}function ne(e){e.is_installed?u.openModal("appConfig",{app:e}):e.repository==="Registered"&&u.openModal("serviceRegistration",{item:e,itemType:"app",ownerType:e.type||"system",onRegistered:i.fetchZooApps})}async function oe(e){await u.showConfirmation({title:`Delete Registration for '${e.name}'?`,message:"This will remove the manually registered entry but will not affect the service itself.",confirmText:"Delete"})&&await i.deleteRegisteredApp(e.id)}function le(e){u.openModal("appLog",{app:e})}async function ie(e){const t=await i.fetchAppReadme(e.repository,e.folder_name);u.openModal("sourceViewer",{title:`README: ${e.name}`,content:t,language:"markdown"})}async function re(e){await D.cancelTask(e)}function de(e){u.openModal("tasksManager",{initialTaskId:e})}async function ue(){await i.syncInstallations()}async function pe(e){await u.showConfirmation({title:`Purge '${e.name}'?`,message:"This will permanently delete the installation folder.",confirmText:"Purge"})&&await i.purgeBrokenInstallation(e)}async function ce(e){await u.showConfirmation({title:`Fix '${e.name}'?`,message:"This will attempt to re-create the database entry for this item.",confirmText:"Fix"})&&await i.fixBrokenInstallation(e)}function ve(e){u.openModal("appDetails",{app:e})}function fe(){u.openModal("serviceRegistration",{itemType:"app",ownerType:"system",onRegistered:i.fetchZooApps})}return(e,t)=>(l(),r("div",_e,[a("div",Te,[a("nav",Ie,[a("button",{onClick:t[0]||(t[0]=s=>f.value="zoo"),class:B(["tab-button",f.value==="zoo"?"active":"inactive"])},"Zoo",2),a("button",{onClick:t[1]||(t[1]=s=>f.value="source"),class:B(["tab-button",f.value==="source"?"active":"inactive"])},"Repositories",2)])]),f.value==="zoo"?(l(),r("section",Ue,[a("div",{class:"flex justify-between items-center mb-4 flex-wrap gap-2"},[t[16]||(t[16]=a("h3",{class:"text-xl font-semibold"},"App Zoo",-1)),a("div",{class:"flex items-center gap-2"},[a("button",{onClick:fe,class:"btn btn-secondary"},"Register External App"),a("button",{onClick:ue,class:"btn btn-secondary-outline",title:"Repair broken installations and remove orphaned DB entries."},"Sync Installations")])]),a("div",Pe,[a("div",Me,[a("div",De,[v(a("input",{type:"text","onUpdate:modelValue":t[2]||(t[2]=s=>p(o).searchQuery=s),placeholder:"Search apps...",class:"input-field w-full pl-10"},null,512),[[C,p(o).searchQuery]]),t[17]||(t[17]=a("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[a("svg",{class:"h-5 w-5 text-gray-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})])],-1))]),a("div",Ve,[v(a("select",{"onUpdate:modelValue":t[3]||(t[3]=s=>p(o).installationStatusFilter=s),class:"input-field"},[...t[18]||(t[18]=[he('<option value="All" data-v-143fc286>All Statuses</option><option value="Installed" data-v-143fc286>Installed</option><option value="Uninstalled" data-v-143fc286>Uninstalled</option><option value="Registered" data-v-143fc286>Registered</option><option value="Broken" data-v-143fc286>Broken</option>',5)])],512),[[_,p(o).installationStatusFilter]]),v(a("select",{"onUpdate:modelValue":t[4]||(t[4]=s=>p(o).selectedCategory=s),class:"input-field"},[(l(!0),r(w,null,h(K.value,s=>(l(),r("option",{key:s,value:s},g(s),9,Ze))),128))],512),[[_,p(o).selectedCategory]]),v(a("select",{"onUpdate:modelValue":t[5]||(t[5]=s=>p(o).selectedRepository=s),class:"input-field"},[t[19]||(t[19]=a("option",{value:"All"},"All Sources",-1)),t[20]||(t[20]=a("option",{value:"Registered"},"Registered",-1)),(l(!0),r(w,null,h($.value,s=>(l(),r("option",{key:s.id,value:s.name},g(s.name),9,Fe))),128))],512),[[_,p(o).selectedRepository]])])]),a("div",Ne,[v(a("select",{"onUpdate:modelValue":t[6]||(t[6]=s=>p(o).sortKey=s),class:"input-field w-48"},[(l(),r(w,null,h(Q,s=>a("option",{key:s.value,value:s.value},"Sort by "+g(s.label),9,Le)),64))],512),[[_,p(o).sortKey]]),a("button",{onClick:t[7]||(t[7]=s=>p(o).sortOrder=p(o).sortOrder==="asc"?"desc":"asc"),class:"btn btn-secondary p-2"},[p(o).sortOrder==="asc"?(l(),U(Re,{key:0,class:"w-5 h-5"})):(l(),U(Se,{key:1,class:"w-5 h-5"}))])]),p(q)?(l(),r("div",ze,[(l(),r(w,null,h(8,s=>P(Ce,{key:s})),64))])):!I.value||I.value.length===0?(l(),r("div",Be,[...t[21]||(t[21]=[a("h4",{class:"font-semibold"},"No Apps Found",-1)])])):(l(),r("div",Oe,[a("div",je,[(l(!0),r(w,null,h(I.value,s=>(l(),U($e,{key:s.id||`${s.repository}/${s.folder_name}`,app:s,task:s.task,"is-starred":x.value.includes(s.name),onStar:n=>W(s.name),onInstall:n=>te(s),onUpdate:n=>se(s),onUninstall:n=>ae(s),onDelete:n=>oe(s),onHelp:n=>ie(s),onViewTask:de,onCancelInstall:n=>re(s.task.id),onStart:n=>N(s.id,"start"),onStop:n=>N(s.id,"stop"),onConfigure:n=>ne(s),onFix:n=>ce(s),onPurge:n=>pe(s),onDetails:ve,onLogs:n=>le(s)},null,8,["app","task","is-starred","onStar","onInstall","onUpdate","onUninstall","onDelete","onHelp","onCancelInstall","onStart","onStop","onConfigure","onFix","onPurge","onLogs"]))),128))]),F.value>1?(l(),r("div",qe,[a("button",{onClick:t[8]||(t[8]=s=>e.currentPage--),disabled:e.currentPage===1,class:"btn btn-secondary"},"Previous",8,Ee),a("span",Qe,g(H.value),1),a("button",{onClick:t[9]||(t[9]=s=>e.currentPage++),disabled:e.currentPage>=F.value,class:"btn btn-secondary"},"Next",8,He)])):y("",!0)]))])])):y("",!0),f.value==="source"?(l(),r("section",Je,[a("div",Ke,[t[22]||(t[22]=a("h3",{class:"text-xl font-semibold"},"App Zoo Repositories",-1)),a("button",{onClick:t[10]||(t[10]=s=>k.value=!k.value),class:"btn btn-primary"},g(k.value?"Cancel":"Add Repository"),1)]),k.value?(l(),r("div",We,[a("form",{onSubmit:ke(X,["prevent"]),class:"space-y-4"},[a("div",Ge,[a("label",null,[v(a("input",{type:"radio","onUpdate:modelValue":t[11]||(t[11]=s=>d.value.type=s),value:"git",class:"radio-input"},null,512),[[O,d.value.type]]),t[23]||(t[23]=M(" Git",-1))]),a("label",null,[v(a("input",{type:"radio","onUpdate:modelValue":t[12]||(t[12]=s=>d.value.type=s),value:"local",class:"radio-input"},null,512),[[O,d.value.type]]),t[24]||(t[24]=M(" Local",-1))])]),a("div",null,[t[25]||(t[25]=a("label",null,"Name",-1)),v(a("input",{"onUpdate:modelValue":t[13]||(t[13]=s=>d.value.name=s),type:"text",class:"input-field",required:""},null,512),[[C,d.value.name]])]),d.value.type==="git"?(l(),r("div",Xe,[t[26]||(t[26]=a("label",null,"URL",-1)),v(a("input",{"onUpdate:modelValue":t[14]||(t[14]=s=>d.value.url=s),type:"url",class:"input-field",required:d.value.type==="git"},null,8,Ye),[[C,d.value.url]])])):y("",!0),d.value.type==="local"?(l(),r("div",et,[t[27]||(t[27]=a("label",null,"Path",-1)),v(a("input",{"onUpdate:modelValue":t[15]||(t[15]=s=>d.value.path=s),type:"text",class:"input-field",required:d.value.type==="local"},null,8,tt),[[C,d.value.path]])])):y("",!0),t[28]||(t[28]=a("div",{class:"flex justify-end"},[a("button",{type:"submit",class:"btn btn-primary"},"Add")],-1))],32)])):y("",!0),p(j)?(l(),r("div",st,"Loading...")):!$.value||$.value.length===0?(l(),r("div",at,[...t[29]||(t[29]=[a("p",null,"No repositories added.",-1)])])):(l(),r("div",nt,[(l(!0),r(w,null,h($.value,s=>(l(),r("div",{key:s.id,class:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm flex items-center justify-between"},[a("div",null,[a("p",ot,g(s.name),1),a("p",lt,g(s.url),1),a("p",it,"Pulled: "+g(G(s.last_pulled_at)),1)]),a("div",rt,[a("button",{onClick:n=>Y(s),class:"btn btn-secondary btn-sm"},[P(xe,{class:"w-4 h-4 mr-1"}),M(g(s.type==="git"?"Pull":"Rescan"),1)],8,dt),s.is_deletable?(l(),r("button",{key:0,onClick:n=>ee(s),class:"btn btn-danger btn-sm"},[P(Ae,{class:"w-4 h-4"})],8,ut)):y("",!0)])]))),128))]))])):y("",!0)]))}},xt=ge(pt,[["__scopeId","data-v-143fc286"]]);export{xt as default};
