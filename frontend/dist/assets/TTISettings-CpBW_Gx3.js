import{U as V,u as A,a as F,x as P,s as S,r as h,j as m,w as T,o as $,c as r,b as d,g as s,d as C,k as x,p as B,bG as E,t as p,e as M,A as G,f as L,F as z,i as J,h as R,H,n as j,bH as I}from"./index-Ci4N0VBw.js";import{I as K}from"./IconSelectMenu-CDPe15mj.js";const Y={class:"space-y-8"},q={class:"space-y-6"},Q=["onClick"],W={class:"flex items-center space-x-3 truncate"},X=["src"],Z={key:1,class:"w-8 h-8 flex-shrink-0 text-gray-500 dark:text-gray-400 flex items-center justify-center bg-gray-200 dark:bg-gray-700 rounded-md"},ee={class:"min-w-0 text-left"},te={class:"block font-semibold truncate"},ae={key:0,class:"p-4 border rounded-lg dark:border-gray-700 space-y-4"},se={class:"font-medium"},le={class:"font-mono text-blue-600 dark:text-blue-400"},oe={key:0,class:"text-sm text-gray-500"},ne=["for"],ie=["type","step","id","onUpdate:modelValue","placeholder"],re={key:1,class:"mt-1"},de=["onClick"],ue={class:"flex justify-end gap-3 pt-4 border-t dark:border-gray-600"},ce=["disabled"],fe=["disabled"],ve={key:1,class:"p-4 border border-yellow-300 dark:border-yellow-700 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg text-sm text-yellow-800 dark:text-yellow-200 flex items-center gap-3"},me={__name:"TTISettings",setup(be){const y=A(),b=F();P();const{user:u}=S(y),{availableTtiModels:w,availableTtiModelsGrouped:D}=S(b),i=h({}),c=h(!1),f=h(!1);let g="{}";const o=m({get:()=>{var a;return(a=u.value)==null?void 0:a.tti_binding_model_name},set:a=>{y.updateUserPreferences({tti_binding_model_name:a})}}),n=m(()=>!o.value||w.value.length===0?null:w.value.find(a=>a.id===o.value)||null),_=m(()=>{var t;if(!((t=n.value)!=null&&t.alias))return[];const a=["icon","title","description","allow_parameters_override"];return Object.entries(n.value.alias).filter(([e])=>!a.includes(e)).map(([e,l])=>({name:e,type:typeof l=="boolean"?"bool":typeof l=="number"?"float":"str",default:l}))}),O=m(()=>!u.value||!o.value||!u.value.tti_models_config?{}:u.value.tti_models_config[o.value]||{}),k=m(()=>{var a;return(a=n.value)!=null&&a.alias?n.value.alias.allow_parameters_override!==!1:!0});T(n,a=>{if(a){const t={};_.value.forEach(e=>{t[e.name]=O.value[e.name]??a.alias[e.name]??e.default}),i.value=t,g=JSON.stringify(t),f.value=!1}else i.value={},g="{}",f.value=!1},{immediate:!0,deep:!0}),T(i,a=>{f.value=JSON.stringify(a)!==g},{deep:!0});async function U(){var a;if(o.value){c.value=!0;try{const t=u.value.tti_models_config||{},e={...t[o.value]||{},...i.value};(a=n.value)!=null&&a.alias&&Object.keys(e).forEach(v=>{(e[v]===n.value.alias[v]||e[v]===""||e[v]===null)&&delete e[v]});const l={...t,[o.value]:e};Object.keys(l[o.value]).length===0&&delete l[o.value],await y.updateUserPreferences({tti_models_config:l}),g=JSON.stringify(i.value),f.value=!1}finally{c.value=!1}}}function N(){var t;const a={};(t=n.value)!=null&&t.alias&&_.value.forEach(e=>{a[e.name]=n.value.alias[e.name]??e.default}),i.value=a}return $(()=>{b.availableTtiModels.length===0&&b.fetchAvailableTtiModels()}),(a,t)=>(d(),r("div",Y,[t[5]||(t[5]=s("div",null,[s("h3",{class:"text-xl font-semibold leading-6 text-gray-900 dark:text-white"}," Image Generation (TTI) Parameters "),s("p",{class:"mt-1 text-sm text-gray-500 dark:text-gray-400"}," Configure default parameters for your selected Text-to-Image model. These settings can be overridden by model aliases set by an administrator if overrides are disabled. ")],-1)),s("div",q,[s("div",null,[t[2]||(t[2]=s("label",{class:"block text-base font-medium mb-2"},"Active Image Generation Model",-1)),x(K,{modelValue:o.value,"onUpdate:modelValue":t[0]||(t[0]=e=>o.value=e),items:M(D),"is-loading":M(b).isLoadingTtiModels,placeholder:"Select an Image Model"},{button:B(({toggle:e,selectedItem:l})=>[s("button",{onClick:e,class:"toolbox-select truncate w-full flex items-center justify-between"},[s("div",W,[l!=null&&l.icon_base64?(d(),r("img",{key:0,src:l.icon_base64,class:"h-8 w-8 rounded-md object-cover"},null,8,X)):(d(),r("span",Z,[x(E,{class:"w-5 h-5"})])),s("div",ee,[s("span",te,p((l==null?void 0:l.name)||"Select an Image Model"),1)])]),t[1]||(t[1]=s("svg",{class:"w-4 h-4 text-gray-400 flex-shrink-0",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor"},[s("path",{"fill-rule":"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z","clip-rule":"evenodd"})],-1))],8,Q)]),_:1},8,["modelValue","items","is-loading"])]),o.value&&n.value&&k.value?(d(),r("div",ae,[s("h4",se,[t[3]||(t[3]=G("Configuration for: ",-1)),s("span",le,p(n.value.name),1)]),_.value.length===0?(d(),r("div",oe," This model has no parameters exposed for user configuration. ")):(d(),r("form",{key:1,onSubmit:L(U,["prevent"]),class:"space-y-4"},[(d(!0),r(z,null,J(_.value,e=>(d(),r("div",{key:e.name},[s("label",{for:`tti-param-${e.name}`,class:"block text-sm font-medium capitalize"},p(e.name.replace(/_/g," ")),9,ne),["str","int","float"].includes(e.type)?R((d(),r("input",{key:0,type:e.type==="str"?"text":"number",step:e.type==="float"?"0.01":"1",id:`tti-param-${e.name}`,"onUpdate:modelValue":l=>i.value[e.name]=l,class:"input-field mt-1",placeholder:`Default: ${n.value.alias[e.name]}`},null,8,ie)),[[H,i.value[e.name]]]):e.type==="bool"?(d(),r("div",re,[s("button",{onClick:l=>i.value[e.name]=!i.value[e.name],type:"button",class:j([i.value[e.name]?"bg-blue-600":"bg-gray-200 dark:bg-gray-600","relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out"])},[s("span",{class:j([i.value[e.name]?"translate-x-5":"translate-x-0","pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition-colors duration-200 ease-in-out"])},null,2)],10,de)])):C("",!0)]))),128)),s("div",ue,[s("button",{type:"button",onClick:N,class:"btn btn-secondary",disabled:c.value},"Reset to Defaults",8,ce),s("button",{type:"submit",class:"btn btn-primary",disabled:c.value||!f.value},p(c.value?"Saving...":"Save Changes"),9,fe)])],32))])):o.value&&n.value&&!k.value?(d(),r("div",ve,[x(I,{class:"w-5 h-5 flex-shrink-0"}),t[4]||(t[4]=s("span",null,"An administrator has locked the parameters for this model alias. Your personal settings will be ignored.",-1))])):C("",!0)])]))}},pe=V(me,[["__scopeId","data-v-50553ffb"]]);export{pe as default};
