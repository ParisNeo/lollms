import{O as R,a as H,s as K,r as g,c as C,w as F,o as Q,d as o,f as i,e as c,g as t,t as d,j as S,C as b,v as W,y as N,F as y,z as x,x as T,l as X,m as O,_ as Y,n as Z,A as h,h as ee,i as te,R as se}from"./index-C6DyaIeI.js";const ne={class:"space-y-8"},ae={key:0,class:"bg-white dark:bg-gray-800 shadow-md rounded-lg p-6"},le={class:"text-xl font-semibold mb-4"},ie={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},oe=["disabled"],de=["value"],re={key:0,class:"space-y-6 border-t dark:border-gray-700 pt-6"},ue={class:"text-sm text-gray-600 dark:text-gray-400"},ce=["for"],fe={key:0,class:"text-red-500"},me=["id","onUpdate:modelValue"],ve=["value"],ge={key:1},ye={class:"relative"},_e=["type","id","onUpdate:modelValue","required","placeholder"],pe=["onClick","title"],be={key:2,class:"flex items-center justify-between bg-gray-50 dark:bg-gray-700/50 p-3 rounded-md"},xe={class:"flex-grow flex flex-col pr-4"},he={class:"text-sm text-gray-500 dark:text-gray-400"},ke=["onClick"],we={class:"text-xs text-gray-500 mt-1"},Se={class:"flex items-center justify-between bg-gray-50 dark:bg-gray-700/50 p-3 rounded-md"},Te={class:"flex justify-end gap-3"},Ae=["disabled"],Be={class:"flex justify-between items-center mb-4 flex-wrap gap-4"},Ce={class:"flex items-center gap-4"},Me=["value"],De={key:0,class:"text-center p-6"},Ve={key:1,class:"text-center p-6 bg-gray-50 dark:bg-gray-800/50 rounded-lg"},$e={key:2,class:"space-y-4"},Fe={class:"flex items-start gap-4"},Ne=["title"],Oe={class:"flex-grow"},je={class:"flex justify-between items-center"},Ue={class:"font-bold text-lg text-gray-900 dark:text-white"},qe={class:"flex gap-3"},Ee=["onClick"],ze=["onClick"],Le={class:"text-sm text-gray-500 dark:text-gray-400"},Ie={class:"mt-2 text-xs space-y-1 text-gray-600 dark:text-gray-300"},Ge={key:0},Je={class:"font-semibold capitalize"},Pe={key:0},Re={key:1},He={key:0},Ke={class:"border-t dark:border-gray-700 pt-3 flex justify-end"},Qe=["onClick"],Ye={__name:"STTBindingsSettings",setup(We){const u=R(),A=H(),{sttBindings:M,availableSttBindingTypes:f,isLoadingSttBindings:j,globalSettings:U}=K(u),v=g(!1),_=g(null),k=g(!1),m=g({}),B=g("mixed"),D=()=>({id:null,alias:"",name:"",config:{},default_model_name:"",is_active:!0}),a=g(D()),p=C(()=>_.value!==null),w=C(()=>!a.value.name||!Array.isArray(f.value)?null:f.value.find(n=>n.binding_name===a.value.name)),q=C(()=>{if(!w.value)return[];const n=w.value.input_parameters||[],s=new Set(n.map(l=>l.name)),e=Object.keys(a.value.config||{}).filter(l=>!s.has(l)&&l!=="model_name").map(l=>({name:l,type:typeof a.value.config[l]=="boolean"?"bool":typeof a.value.config[l]=="number"?"float":"str",description:"(Parameter not in binding description)",mandatory:!1}));return[...n.filter(l=>l.name!=="model_name"),...e]});F(U,n=>{if(Array.isArray(n)){const s=n.find(e=>e.key==="stt_model_display_mode");s&&(B.value=s.value)}},{deep:!0,immediate:!0});function E(n){const s=n.target.value;B.value=s,u.updateGlobalSettings({stt_model_display_mode:s})}F(()=>a.value.name,(n,s)=>{if(n!==s&&!p.value){if(!Array.isArray(f.value))return;const e=f.value.find(r=>r.binding_name===n),l={};e&&e.input_parameters&&e.input_parameters.forEach(r=>{l[r.name]=r.default}),a.value.config=l}}),Q(()=>{u.fetchSttBindings(),u.fetchAvailableSttBindingTypes(),u.fetchGlobalSettings()});function V(){_.value=null,a.value=D(),m.value={},v.value=!0,window.scrollTo({top:0,behavior:"smooth"})}function z(n){_.value=n,a.value=JSON.parse(JSON.stringify(n)),a.value.config||(a.value.config={}),m.value={},v.value=!0,window.scrollTo({top:0,behavior:"smooth"})}function $(){v.value=!1,_.value=null}function L(n){return typeof n=="string"?n.split(",").map(s=>s.trim()).filter(s=>s):Array.isArray(n)?n.filter(s=>s):[]}async function I(){if(!a.value.alias.trim()||!a.value.name){A.addNotification("Alias and Binding Type are required fields.","warning");return}k.value=!0;try{const n={alias:a.value.alias,name:a.value.name,config:a.value.config||{},is_active:a.value.is_active,default_model_name:a.value.default_model_name||null};p.value?await u.updateSttBinding(_.value.id,n):await u.addSttBinding(n),$()}catch(n){console.error("Submit failed:",n.message)}finally{k.value=!1}}async function G(n){await A.showConfirmation({title:`Delete STT Binding '${n.alias}'?`,message:"Are you sure? This action cannot be undone.",confirmText:"Delete"})&&await u.deleteSttBinding(n.id)}function J(n){A.openModal("manageModels",{binding:n,bindingType:"stt"})}function P(n){if(!Array.isArray(f.value))return n;const s=f.value.find(e=>e.binding_name===n);return s?s.title:n}return(n,s)=>(i(),o("div",ne,[v.value?(i(),o("div",ae,[t("h3",le,d(p.value?"Edit STT Binding":"Add New STT Binding"),1),t("form",{onSubmit:ee(I,["prevent"]),class:"space-y-6"},[t("div",ie,[t("div",null,[s[3]||(s[3]=t("label",{for:"alias",class:"block text-sm font-medium"},[b("Alias "),t("span",{class:"text-red-500"},"*")],-1)),S(t("input",{type:"text",id:"alias","onUpdate:modelValue":s[0]||(s[0]=e=>a.value.alias=e),class:"input-field mt-1",required:"",placeholder:"e.g., local_whisper",autocomplete:"off"},null,512),[[W,a.value.alias]]),s[4]||(s[4]=t("p",{class:"text-xs text-gray-500 mt-1"},"A unique, short name for this configuration.",-1))]),t("div",null,[s[6]||(s[6]=t("label",{for:"name",class:"block text-sm font-medium"},[b("Binding Type "),t("span",{class:"text-red-500"},"*")],-1)),S(t("select",{id:"name","onUpdate:modelValue":s[1]||(s[1]=e=>a.value.name=e),class:"input-field mt-1",required:"",disabled:p.value},[s[5]||(s[5]=t("option",{disabled:"",value:""},"Select a type",-1)),(i(!0),o(y,null,x(T(f),e=>(i(),o("option",{key:e.binding_name,value:e.binding_name},d(e.title),9,de))),128))],8,oe),[[N,a.value.name]])])]),w.value?(i(),o("div",re,[t("p",ue,d(w.value.description),1),(i(!0),o(y,null,x(q.value,e=>(i(),o("div",{key:e.name,class:"space-y-1"},[t("label",{for:`param-${e.name}`,class:"block text-sm font-medium capitalize"},[b(d(e.name.replace(/_/g," "))+" ",1),e.mandatory?(i(),o("span",fe,"*")):c("",!0)],8,ce),e.options&&e.options.length>0?S((i(),o("select",{key:0,id:`param-${e.name}`,"onUpdate:modelValue":l=>a.value.config[e.name]=l,class:"input-field"},[(i(!0),o(y,null,x(L(e.options),l=>(i(),o("option",{key:l,value:l},d(l),9,ve))),128))],8,me)),[[N,a.value.config[e.name]]]):["str","int","float"].includes(e.type)?(i(),o("div",ge,[t("div",ye,[S(t("input",{type:(e.name.includes("key")||e.name.includes("token"))&&!m.value[e.name]?"password":"text",id:`param-${e.name}`,"onUpdate:modelValue":l=>a.value.config[e.name]=l,class:"input-field",required:e.mandatory,placeholder:e.description,autocomplete:"off"},null,8,_e),[[X,a.value.config[e.name]]]),e.name.includes("key")||e.name.includes("token")?(i(),o("button",{key:0,type:"button",onClick:l=>m.value[e.name]=!m.value[e.name],class:"absolute inset-y-0 right-0 px-3 flex items-center text-gray-500 hover:text-gray-700 dark:hover:text-gray-300",title:m.value[e.name]?"Hide":"Show"},[m.value[e.name]?(i(),O(Y,{key:0,class:"w-5 h-5"})):(i(),O(Z,{key:1,class:"w-5 h-5"}))],8,pe)):c("",!0)])])):e.type==="bool"?(i(),o("div",be,[t("span",xe,[t("span",he,d(e.description),1)]),t("button",{onClick:l=>a.value.config[e.name]=!a.value.config[e.name],type:"button",class:h([a.value.config[e.name]?"bg-blue-600":"bg-gray-200 dark:bg-gray-600","relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out"])},[t("span",{class:h([a.value.config[e.name]?"translate-x-5":"translate-x-0","pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition-colors duration-200 ease-in-out"])},null,2)],10,ke)])):c("",!0),t("p",we,d(e.description),1)]))),128))])):c("",!0),t("div",Se,[s[7]||(s[7]=t("span",{class:"flex-grow flex flex-col"},[t("span",{class:"text-sm font-medium text-gray-900 dark:text-gray-100"},"Active"),t("span",{class:"text-sm text-gray-500 dark:text-gray-400"},"If disabled, this STT service will not be available.")],-1)),t("button",{onClick:s[2]||(s[2]=e=>a.value.is_active=!a.value.is_active),type:"button",class:h([a.value.is_active?"bg-blue-600":"bg-gray-200 dark:bg-gray-600","relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out"])},[t("span",{class:h([a.value.is_active?"translate-x-5":"translate-x-0","pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition-colors duration-200 ease-in-out"])},null,2)],2)]),t("div",Te,[t("button",{type:"button",onClick:$,class:"btn btn-secondary"},"Cancel"),t("button",{type:"submit",class:"btn btn-primary",disabled:k.value},d(k.value?"Saving...":p.value?"Save Changes":"Add Binding"),9,Ae)])],32)])):c("",!0),t("div",null,[t("div",Be,[s[10]||(s[10]=t("h2",{class:"text-2xl font-bold"},"STT Bindings",-1)),t("div",Ce,[t("div",null,[s[9]||(s[9]=t("label",{for:"stt-model-display-mode",class:"block text-xs font-medium text-gray-500 dark:text-gray-400"},"Model Display Mode",-1)),t("select",{id:"stt-model-display-mode",value:B.value,onChange:E,class:"input-field mt-1"},s[8]||(s[8]=[t("option",{value:"mixed"},"Mixed (Alias or Original)",-1),t("option",{value:"aliased"},"Aliased Only",-1),t("option",{value:"original"},"Original Names Only",-1)]),40,Me)]),v.value?c("",!0):(i(),o("button",{key:0,onClick:V,class:"btn btn-primary self-end"},"+ Add New STT Binding"))])]),T(j)?(i(),o("div",De,"Loading STT bindings...")):T(M).length===0&&!v.value?(i(),o("div",Ve,[s[11]||(s[11]=t("p",null,"No STT bindings configured yet.",-1)),t("button",{onClick:V,class:"mt-2 text-blue-600 hover:underline"},"Add your first one")])):(i(),o("div",$e,[(i(!0),o(y,null,x(T(M),e=>(i(),o("div",{key:e.id,class:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow-md flex flex-col gap-4"},[t("div",Fe,[t("span",{class:h(["mt-1 h-3 w-3 rounded-full flex-shrink-0",e.is_active?"bg-green-500":"bg-gray-400"]),title:e.is_active?"Active":"Inactive"},null,10,Ne),t("div",Oe,[t("div",je,[t("h4",Ue,d(e.alias),1),t("div",qe,[t("button",{onClick:l=>z(e),class:"text-sm font-medium text-blue-600 hover:underline"},"Edit",8,Ee),t("button",{onClick:l=>G(e),class:"text-sm font-medium text-red-600 hover:underline"},"Delete",8,ze)])]),t("p",Le,d(P(e.name)),1),t("div",Ie,[(i(!0),o(y,null,x(e.config,(l,r)=>(i(),o(y,{key:r},[l&&r!=="model_name"?(i(),o("p",Ge,[t("span",Je,d(r.replace(/_/g," "))+":",1),r.includes("key")||r.includes("token")?(i(),o("span",Pe,"********")):(i(),o("span",Re,d(l),1))])):c("",!0)],64))),128)),e.default_model_name?(i(),o("p",He,[s[12]||(s[12]=t("span",{class:"font-semibold"},"Default Model:",-1)),b(" "+d(e.default_model_name),1)])):c("",!0)])])]),t("div",Ke,[t("button",{onClick:l=>J(e),class:"btn btn-secondary btn-sm flex items-center gap-2"},[te(se,{class:"w-4 h-4"}),s[13]||(s[13]=b(" Manage Models "))],8,Qe)])]))),128))]))])]))}};export{Ye as default};
