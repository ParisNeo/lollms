import{O as K,a as Q,s as X,r as u,c as $,o as Y,w as L,d as i,f as r,g as e,h as w,j as I,v as N,e as Z,x as g,a3 as ee,t as h,i as d,C as T,a4 as j,F as M,z as D,A as te,N as se,a5 as le,L as W,I as A}from"./index-C1c0uFKA.js";const oe={class:"space-y-12"},ne={class:"bg-white dark:bg-gray-800 shadow-md rounded-lg"},ae={class:"mt-2 flex items-center gap-x-4"},ie=["src"],re={class:"flex justify-end pt-4 border-t dark:border-gray-700"},de=["disabled"],ce={class:"bg-white dark:bg-gray-800 shadow-md rounded-lg"},ue={class:"p-6 border-b dark:border-gray-700 flex justify-between items-center"},ge={class:"flex gap-2"},ve={class:"p-6 grid grid-cols-1 lg:grid-cols-2 gap-8"},me={class:"flex justify-between items-center mb-2"},fe={class:"border rounded-lg overflow-hidden dark:border-gray-700 max-h-96 overflow-y-auto"},be={key:0},ye={key:1,class:"divide-y dark:divide-gray-700"},pe=["onClick"],we={class:"font-medium text-sm"},he={class:"flex items-center gap-1"},_e=["onClick"],ke=["onClick"],Ce=["onClick"],xe={class:"flex justify-between items-center mb-2"},Fe={class:"font-semibold"},Se=["disabled"],$e={class:"border rounded-lg overflow-hidden dark:border-gray-700 max-h-96 overflow-y-auto"},Le={key:0},Ie={key:1,class:"p-4 text-center text-sm text-gray-500"},Ne={key:2,class:"divide-y dark:divide-gray-700"},Te=["title"],je={class:"flex items-center gap-1 flex-shrink-0"},Me=["onClick"],De=["onClick"],Pe={__name:"WelcomeSettings",setup(We){const o=K(),v=Q(),{globalSettings:_,funFacts:P,funFactCategories:k,isLoadingFunFacts:V,isLoadingFunFactCategories:R}=X(o),a=u({}),c=u(!1),y=u(!1),m=u(null),p=u(null);let C="{}";const n=u(null),x=$(()=>_.value.filter(s=>s.category==="Welcome Page")),U=$(()=>n.value?P.value.filter(s=>s.category.id===n.value):[]);Y(()=>{o.fetchGlobalSettings(),o.fetchFunFacts(),o.fetchFunFactCategories()}),L(()=>_.value,E,{deep:!0}),L(a,s=>{y.value=JSON.stringify(s)!==C},{deep:!0});function E(){const s={};x.value.length>0&&(x.value.forEach(t=>{s[t.key]=t.value}),a.value=s,C=JSON.stringify(a.value),y.value=!1)}function z(s){const t=s.target.files[0];if(t&&t.type.startsWith("image/")){m.value=t;const f=new FileReader;f.onload=l=>{p.value=l.target.result},f.readAsDataURL(t),y.value=!0}}async function B(){c.value=!0;try{await o.removeWelcomeLogo(),m.value=null,p.value=null}finally{c.value=!1}}async function O(){c.value=!0;try{const s={welcome_text:a.value.welcome_text,welcome_slogan:a.value.welcome_slogan};await o.updateGlobalSettings(s),m.value&&(await o.uploadWelcomeLogo(m.value),m.value=null,p.value=null)}finally{c.value=!1}}function F(s=null){v.openModal("funFactCategory",{category:s,onSave:o.fetchFunFactCategories})}function S(s=null){if(!n.value&&!s){v.addNotification("Please select a category first.","warning");return}v.openModal("funFact",{fact:s,preselectedCategoryId:n.value,onSave:o.fetchFunFacts})}async function G(s){await v.showConfirmation({title:"Delete Category and its Facts?",message:`This will permanently delete "${s.name}" and all facts inside it. This action cannot be undone.`,confirmText:"Delete All"})&&(await o.deleteFunFactCategory(s.id),n.value===s.id&&(n.value=null))}async function J(s){await v.showConfirmation({title:"Delete Fun Fact?",message:"Are you sure you want to delete this fact?",confirmText:"Delete"})&&await o.deleteFunFact(s.id)}async function q(s){await o.exportCategory(s.id,s.name)}async function H(s){const t=s.target.files[0];t&&await o.importCategoryFromFile(t),s.target.value=""}return(s,t)=>{var f;return r(),i("div",oe,[e("div",ne,[t[10]||(t[10]=e("div",{class:"p-6 border-b dark:border-gray-700"},[e("h3",{class:"text-xl font-semibold"},"Welcome Page Settings")],-1)),e("form",{onSubmit:w(O,["prevent"]),class:"p-6 space-y-6"},[e("div",null,[t[7]||(t[7]=e("label",{for:"welcome_text",class:"label"},"Main Welcome Text",-1)),I(e("input",{id:"welcome_text","onUpdate:modelValue":t[0]||(t[0]=l=>a.value.welcome_text=l),type:"text",class:"input-field mt-1"},null,512),[[N,a.value.welcome_text]])]),e("div",null,[t[8]||(t[8]=e("label",{for:"welcome_slogan",class:"label"},"Slogan",-1)),I(e("input",{id:"welcome_slogan","onUpdate:modelValue":t[1]||(t[1]=l=>a.value.welcome_slogan=l),type:"text",class:"input-field mt-1"},null,512),[[N,a.value.welcome_slogan]])]),e("div",null,[t[9]||(t[9]=e("label",{class:"label"},"Custom Logo",-1)),e("div",ae,[e("img",{src:p.value||a.value.welcome_logo_url||g(ee),alt:"Logo Preview",class:"h-16 w-16 object-contain rounded-md bg-gray-100 dark:bg-gray-700"},null,8,ie),e("input",{type:"file",onChange:z,accept:"image/*",class:"hidden",ref:"logoInput"},null,544),e("button",{type:"button",onClick:t[2]||(t[2]=l=>s.$refs.logoInput.click()),class:"btn btn-secondary"},"Change"),a.value.welcome_logo_url?(r(),i("button",{key:0,type:"button",onClick:B,class:"btn btn-danger-outline"},"Remove")):Z("",!0)])]),e("div",re,[e("button",{type:"submit",class:"btn btn-primary",disabled:c.value||!y.value},h(c.value?"Saving...":"Save Settings"),9,de)])],32)]),e("div",ce,[e("div",ue,[t[11]||(t[11]=e("h3",{class:"text-xl font-semibold"},"Fun Facts Management",-1)),e("div",ge,[e("button",{onClick:t[3]||(t[3]=l=>s.$refs.importInput.click()),class:"btn btn-secondary btn-sm"},"Import Category"),e("input",{type:"file",ref:"importInput",onChange:H,accept:".json",class:"hidden"},null,544),e("button",{onClick:t[4]||(t[4]=l=>g(o).exportFunFacts()),class:"btn btn-secondary btn-sm"},"Export All")])]),e("div",ve,[e("div",null,[e("div",me,[t[13]||(t[13]=e("h4",{class:"font-semibold"},"Categories",-1)),e("button",{onClick:t[5]||(t[5]=l=>F()),class:"btn btn-secondary btn-sm"},[d(j,{class:"w-4 h-4 mr-1"}),t[12]||(t[12]=T("New"))])]),e("div",fe,[g(R)?(r(),i("div",be,"Loading...")):(r(),i("ul",ye,[(r(!0),i(M,null,D(g(k),l=>(r(),i("li",{key:l.id,onClick:b=>n.value=l.id,class:te(["p-2 flex items-center justify-between cursor-pointer",n.value===l.id?"bg-blue-100 dark:bg-blue-900/50":"hover:bg-gray-50 dark:hover:bg-gray-700/50"])},[e("div",null,[e("span",we,h(l.name),1),e("div",{class:"w-4 h-4 rounded-full inline-block ml-2",style:se({backgroundColor:l.color})},null,4)]),e("div",he,[e("button",{onClick:w(b=>q(l),["stop"]),class:"btn-icon"},[d(le,{class:"w-4 h-4"})],8,_e),e("button",{onClick:w(b=>F(l),["stop"]),class:"btn-icon"},[d(W,{class:"w-4 h-4"})],8,ke),e("button",{onClick:w(b=>G(l),["stop"]),class:"btn-icon-danger"},[d(A,{class:"w-4 h-4"})],8,Ce)])],10,pe))),128))]))])]),e("div",null,[e("div",xe,[e("h4",Fe,h(n.value?`Facts in "${(f=g(k).find(l=>l.id===n.value))==null?void 0:f.name}"`:"Select a Category"),1),e("button",{onClick:t[6]||(t[6]=l=>S()),disabled:!n.value,class:"btn btn-secondary btn-sm"},[d(j,{class:"w-4 h-4 mr-1"}),t[14]||(t[14]=T("New"))],8,Se)]),e("div",$e,[g(V)?(r(),i("div",Le,"Loading...")):n.value?(r(),i("ul",Ne,[(r(!0),i(M,null,D(U.value,l=>(r(),i("li",{key:l.id,class:"p-2 flex items-center justify-between hover:bg-gray-50 dark:hover:bg-gray-700/50"},[e("p",{class:"text-sm flex-grow pr-2 truncate",title:l.content},h(l.content),9,Te),e("div",je,[e("button",{onClick:b=>S(l),class:"btn-icon"},[d(W,{class:"w-4 h-4"})],8,Me),e("button",{onClick:b=>J(l),class:"btn-icon-danger"},[d(A,{class:"w-4 h-4"})],8,De)])]))),128))])):(r(),i("div",Ie,"Select a category to view its facts."))])])])])])}}};export{Pe as default};
