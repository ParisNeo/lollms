import{z as ne,n as oe,ai as ie,a as re,s as de,r as u,c as y,o as ue,w as Z,b as o,e as n,f as t,h as ce,i as g,y as b,A as pe,d as E,t as L,g as ve,v as j,q as me,k as ge,T as fe,C as J,F as U,x as $,l as F}from"./index-BZDc2BnE.js";import{_ as N}from"./McpCard-DNumtVOh.js";const ye={class:"space-y-10"},be={class:"bg-white dark:bg-gray-800 shadow-md rounded-lg"},xe={class:"px-4 py-5 sm:p-6"},he={class:"mt-4 flex items-center justify-between bg-gray-50 dark:bg-gray-700/50 p-4 rounded-md"},ke={class:"border-b border-gray-200 dark:border-gray-700"},we={class:"-mb-px flex space-x-6","aria-label":"Tabs"},_e={key:0,class:"bg-white dark:bg-gray-800 shadow-md rounded-lg"},Ae={class:"px-4 py-5 sm:p-6"},Me={class:"text-xl font-bold leading-6 text-gray-900 dark:text-white capitalize"},Ce={class:"border-t border-gray-200 dark:border-gray-700"},Se={class:"grid grid-cols-1 sm:grid-cols-2 gap-6"},Ie=["placeholder"],Te=["placeholder"],De={class:"mt-2 flex items-center gap-x-4"},Ee={class:"h-16 w-16 rounded-md bg-gray-200 dark:bg-gray-700 flex items-center justify-center overflow-hidden"},Le=["src"],Ue={key:1,class:"w-8 h-8 text-gray-500 dark:text-gray-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},$e={class:"flex-grow space-y-2"},Fe={class:"flex items-center gap-x-3"},Ne={class:"flex items-center justify-between bg-gray-50 dark:bg-gray-700/50 p-3 rounded-md"},He={class:"space-y-4"},Pe={key:0,class:"mt-1 text-xs text-gray-500 dark:text-gray-400"},Re={key:1,class:"relative"},je=["type"],Ve={key:0,xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"w-5 h-5"},Be={key:1,xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"w-5 h-5"},Xe={class:"flex justify-end items-center gap-x-3 pt-2"},Ge=["disabled"],ze={class:"flex justify-between items-center mb-4 flex-wrap gap-4"},We={class:"flex items-center gap-x-3"},qe=["disabled"],Ke={key:0,class:"empty-state-card"},Oe={key:1,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5"},Ze={key:2,class:"empty-state-card"},Je={key:3,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5"},Qe={class:"flex justify-between items-center mb-4 flex-wrap gap-4"},Ye={class:"flex items-center gap-x-3"},et={key:0,class:"empty-state-card"},tt={key:1,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5"},at={key:2,class:"empty-state-card"},st={key:3,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5"},lt={__name:"ServicesSettings",setup(nt){const Q=oe(),d=ie(),f=re(),{mcps:V,apps:B,isLoadingServices:ot,globalSettings:H}=de(d),i=u("mcps"),x=u({openai_api_service_enabled:!1}),P=(a="mcps")=>({name:"",url:"",icon:"",active:!0,type:"system",authentication_type:"none",authentication_key:""}),l=u(P()),m=u(null),_=u(!1),A=u(!1),h=u(!1),X=u(null),R=u(!1),M=u(!1),C=y({get:()=>x.value.openai_api_service_enabled,set:a=>{x.value.openai_api_service_enabled!==a&&(x.value.openai_api_service_enabled=a,Y())}});function G(){const a=H.value.find(e=>e.key==="openai_api_service_enabled");a&&(x.value.openai_api_service_enabled=a.value)}async function Y(){await d.updateGlobalSettings({openai_api_service_enabled:x.value.openai_api_service_enabled})}ue(()=>{d.fetchMcps(),d.fetchApps(),H.value.length>0&&G()}),Z(H,G,{deep:!0}),Z(()=>l.value.icon,()=>{R.value=!1});const k=y(()=>m.value!==null),z=y(()=>V.value.filter(a=>a.type==="system").sort((a,e)=>a.name.localeCompare(e.name))),W=y(()=>V.value.filter(a=>a.type==="user").sort((a,e)=>a.name.localeCompare(e.name))),q=y(()=>B.value.filter(a=>a.type==="system").sort((a,e)=>a.name.localeCompare(e.name))),K=y(()=>B.value.filter(a=>a.type==="user").sort((a,e)=>a.name.localeCompare(e.name)));function O(a){k.value&&I(),i.value=a,l.value=P(a),M.value=!0,window.scrollTo({top:0,behavior:"smooth"})}function S(a,e){i.value=e,m.value={...a,_type:e},l.value.name=a.name,l.value.url=a.url,l.value.icon=a.icon||"",l.value.active=typeof a.active=="boolean"?a.active:!0,l.value.type=a.type,l.value.authentication_type=a.authentication_type||"none",l.value.authentication_key="",M.value=!0,window.scrollTo({top:0,behavior:"smooth"})}function I(){m.value=null,l.value=P(i.value),h.value=!1,M.value=!1}function ee(){R.value=!0}async function te(){if(!l.value.name||!l.value.url){f.addNotification("Name and URL are required.","warning");return}_.value=!0;try{const a={...l.value},e=i.value==="apps";k.value?await(e?d.updateApp(m.value.id,a):d.updateMcp(m.value.id,a)):await(e?d.addApp(a):d.addMcp(a)),I()}finally{_.value=!1}}async function T(a,e){await f.showConfirmation({title:`Delete '${a.name}'?`,message:`This will permanently remove this ${e==="mcps"?"MCP server":"Application"} for all users. This cannot be undone.`,confirmText:"Delete"})&&(m.value&&m.value.id===a.id&&I(),await(e==="apps"?d.deleteApp(a.id):d.deleteMcp(a.id)))}async function ae(){A.value=!0;try{await Q.triggerMcpReload()}finally{A.value=!1}}function se(){X.value.click()}function le(a){const e=a.target.files[0];if(!e)return;if(!["image/jpeg","image/png","image/gif","image/webp","image/svg+xml"].includes(e.type)){f.addNotification("Invalid file type. Please select an image.","error");return}if(e.type==="image/svg+xml"){const w=new FileReader;w.onload=c=>{l.value.icon=c.target.result},w.onerror=()=>{f.addNotification("Failed to read the SVG file.","error")},w.readAsDataURL(e),a.target.value="";return}const r=new FileReader;r.onload=w=>{const c=new Image;c.onload=()=>{let p=c.width,v=c.height;p>v?p>128&&(v=Math.round(v*(128/p)),p=128):v>128&&(p=Math.round(p*(128/v)),v=128);const D=document.createElement("canvas");D.width=p,D.height=v,D.getContext("2d").drawImage(c,0,0,p,v),l.value.icon=D.toDataURL("image/png")},c.onerror=()=>{f.addNotification("Failed to load image for processing.","error")},c.src=w.target.result},r.onerror=()=>{f.addNotification("Failed to read the file.","error")},r.readAsDataURL(e),a.target.value=""}return(a,e)=>(n(),o("div",ye,[t("div",be,[t("div",xe,[e[14]||(e[14]=t("h3",{class:"text-xl font-bold leading-6 text-gray-900 dark:text-white"},"OpenAI-Compatible API",-1)),t("div",he,[e[13]||(e[13]=t("span",{class:"flex-grow flex flex-col pr-4"},[t("span",{class:"text-sm font-medium text-gray-900 dark:text-gray-100"},"Enable API Service"),t("span",{class:"text-xs text-gray-500 dark:text-gray-400"}," Allows users to generate and use API keys to connect with this backend as if it were an OpenAI server. ")],-1)),t("button",{onClick:e[0]||(e[0]=s=>C.value=!C.value),type:"button",class:b([C.value?"bg-blue-600":"bg-gray-200 dark:bg-gray-600","relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800"])},[t("span",{class:b([C.value?"translate-x-5":"translate-x-0","pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out"])},null,2)],2)])])]),t("div",ke,[t("nav",we,[t("button",{onClick:e[1]||(e[1]=s=>i.value="mcps"),class:b(["tab-button",i.value==="mcps"?"active":"inactive"])}," MCP Servers ",2),t("button",{onClick:e[2]||(e[2]=s=>i.value="apps"),class:b(["tab-button",i.value==="apps"?"active":"inactive"])}," Applications ",2)])]),ce(fe,{name:"form-fade"},{default:pe(()=>[M.value?(n(),o("div",_e,[t("div",Ae,[t("h2",Me,L(k.value?"Edit":"Add New")+" "+L(i.value==="mcps"?"MCP Server":"Application"),1)]),t("div",Ce,[t("form",{onSubmit:ve(te,["prevent"]),class:"p-4 sm:p-6 space-y-6"},[t("div",Se,[t("div",null,[e[15]||(e[15]=t("label",{for:"formName",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Name",-1)),g(t("input",{type:"text",id:"formName","onUpdate:modelValue":e[3]||(e[3]=s=>l.value.name=s),class:"input-field mt-1",placeholder:i.value==="mcps"?"My Local Server":"My Web App",required:""},null,8,Ie),[[j,l.value.name]])]),t("div",null,[e[16]||(e[16]=t("label",{for:"formUrl",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"URL",-1)),g(t("input",{type:"url",id:"formUrl","onUpdate:modelValue":e[4]||(e[4]=s=>l.value.url=s),class:"input-field mt-1",placeholder:i.value==="mcps"?"http://127.0.0.1:9602":"https://example.com",required:""},null,8,Te),[[j,l.value.url]])])]),t("div",null,[e[18]||(e[18]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Icon (Optional)",-1)),t("div",De,[t("div",Ee,[l.value.icon&&!R.value?(n(),o("img",{key:0,src:l.value.icon,onError:ee,alt:"Icon Preview",class:"h-full w-full object-cover"},null,40,Le)):(n(),o("svg",Ue,e[17]||(e[17]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M21.75 17.25v-.228a4.5 4.5 0 0 0-.12-1.03l-2.268-9.64a3.375 3.375 0 0 0-3.285-2.602H7.923a3.375 3.375 0 0 0-3.285 2.602l-2.268 9.64a4.5 4.5 0 0 0-.12 1.03v.228m19.5 0a3 3 0 0 1-3 3H5.25a3 3 0 0 1-3-3m19.5 0a3 3 0 0 0-3-3H5.25a3 3 0 0 0-3 3m16.5 0h.008v.008h-.008v-.008Z"},null,-1)])))]),t("div",$e,[g(t("input",{type:"text","onUpdate:modelValue":e[5]||(e[5]=s=>l.value.icon=s),class:"input-field",placeholder:"Paste image URL or upload a file"},null,512),[[j,l.value.icon]]),t("div",Fe,[t("button",{onClick:se,type:"button",class:"btn btn-secondary text-sm"},"Upload File"),l.value.icon?(n(),o("button",{key:0,onClick:e[6]||(e[6]=s=>l.value.icon=""),type:"button",class:"text-sm font-medium text-red-600 hover:text-red-500"},"Remove")):E("",!0)])])]),t("input",{type:"file",ref_key:"fileInput",ref:X,onChange:le,class:"hidden",accept:"image/png, image/jpeg, image/gif, image/webp, image/svg+xml"},null,544)]),t("div",Ne,[e[19]||(e[19]=t("span",{class:"flex-grow flex flex-col"},[t("span",{class:"text-sm font-medium text-gray-900 dark:text-gray-100"},"Active"),t("span",{class:"text-sm text-gray-500 dark:text-gray-400"},"Inactive items cannot be used.")],-1)),t("button",{onClick:e[7]||(e[7]=s=>l.value.active=!l.value.active),type:"button",class:b([l.value.active?"bg-blue-600":"bg-gray-200 dark:bg-gray-600","relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800"])},[t("span",{class:b([l.value.active?"translate-x-5":"translate-x-0","pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out"])},null,2)],2)]),t("fieldset",He,[e[24]||(e[24]=t("legend",{class:"text-sm font-medium text-gray-700 dark:text-gray-300"},"Authentication",-1)),g(t("select",{id:"formAuthType","onUpdate:modelValue":e[8]||(e[8]=s=>l.value.authentication_type=s),class:"input-field"},e[20]||(e[20]=[t("option",{value:"none"},"None",-1),t("option",{value:"lollms_chat_auth"},"LoLLMs Chat Auth",-1),t("option",{value:"bearer"},"Bearer Token",-1)]),512),[[me,l.value.authentication_type]]),l.value.authentication_type==="lollms_chat_auth"?(n(),o("p",Pe," A temporary token will be generated by LoLLMs for each session. ")):E("",!0),l.value.authentication_type==="bearer"?(n(),o("div",Re,[e[23]||(e[23]=t("label",{for:"formKey",class:"sr-only"},"Authentication Key",-1)),g(t("input",{type:h.value?"text":"password",id:"formKey","onUpdate:modelValue":e[9]||(e[9]=s=>l.value.authentication_key=s),class:"input-field pr-10",placeholder:"Paste your Bearer token here"},null,8,je),[[ge,l.value.authentication_key]]),t("button",{type:"button",onClick:e[10]||(e[10]=s=>h.value=!h.value),class:"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600 dark:hover:text-gray-200"},[h.value?(n(),o("svg",Be,e[22]||(e[22]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M3.98 8.223A10.477 10.477 0 001.934 12C3.226 16.338 7.244 19.5 12 19.5c.993 0 1.953-.138 2.863-.395M6.228 6.228A10.45 10.45 0 0112 4.5c4.756 0 8.773 3.162 10.065 7.498a10.523 10.523 0 01-4.293 5.774M6.228 6.228L3 3m3.228 3.228l3.65 3.65m7.894 7.894L21 21m-3.228-3.228l-3.65-3.65m0 0a3 3 0 10-4.243-4.243m4.243 4.243L6.228 6.228"},null,-1)]))):(n(),o("svg",Ve,e[21]||(e[21]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M2.036 12.322a1.012 1.012 0 010-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178z"},null,-1),t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"},null,-1)])))])])):E("",!0)]),t("div",Xe,[t("button",{onClick:I,type:"button",class:"btn btn-secondary"},"Cancel"),t("button",{type:"submit",class:"btn btn-primary",disabled:_.value},L(_.value?k.value?"Saving...":"Adding...":k.value?"Save Changes":"Add"),9,Ge)])],32)])])):E("",!0)]),_:1}),g(t("section",null,[t("div",ze,[e[25]||(e[25]=t("h3",{class:"text-xl font-bold leading-6 text-gray-900 dark:text-white"},"System MCPs",-1)),t("div",We,[t("button",{onClick:ae,disabled:A.value,class:"btn btn-secondary text-sm"},L(A.value?"Reloading...":"Reload MCPs"),9,qe),t("button",{onClick:e[11]||(e[11]=s=>O("mcps")),class:"btn btn-primary text-sm"},"+ Add System Server")])]),z.value.length===0?(n(),o("div",Ke,e[26]||(e[26]=[t("p",null,"No system-wide MCP servers are defined.",-1)]))):(n(),o("div",Oe,[(n(!0),o(U,null,$(z.value,s=>(n(),F(N,{key:s.id,mcp:s,"is-editable":"",onEdit:r=>S(s,"mcps"),onDelete:r=>T(s,"mcps")},null,8,["mcp","onEdit","onDelete"]))),128))])),e[28]||(e[28]=t("h3",{class:"text-xl font-bold leading-6 text-gray-900 dark:text-white mt-8 mb-4"},"User-defined MCPs",-1)),W.value.length===0?(n(),o("div",Ze,e[27]||(e[27]=[t("p",null,"No users have added personal MCP servers yet.",-1)]))):(n(),o("div",Je,[(n(!0),o(U,null,$(W.value,s=>(n(),F(N,{key:s.id,mcp:s,"is-editable":"",onEdit:r=>S(s,"mcps"),onDelete:r=>T(s,"mcps")},null,8,["mcp","onEdit","onDelete"]))),128))]))],512),[[J,i.value==="mcps"]]),g(t("section",null,[t("div",Qe,[e[29]||(e[29]=t("h3",{class:"text-xl font-bold leading-6 text-gray-900 dark:text-white"},"System Apps",-1)),t("div",Ye,[t("button",{onClick:e[12]||(e[12]=s=>O("apps")),class:"btn btn-primary text-sm"},"+ Add System App")])]),q.value.length===0?(n(),o("div",et,e[30]||(e[30]=[t("p",null,"No system-wide Apps are available.",-1)]))):(n(),o("div",tt,[(n(!0),o(U,null,$(q.value,s=>(n(),F(N,{key:s.id,mcp:s,"is-editable":"",onEdit:r=>S(s,"apps"),onDelete:r=>T(s,"apps")},null,8,["mcp","onEdit","onDelete"]))),128))])),e[32]||(e[32]=t("h3",{class:"text-xl font-bold leading-6 text-gray-900 dark:text-white mt-8 mb-4"},"User-defined Apps",-1)),K.value.length===0?(n(),o("div",at,e[31]||(e[31]=[t("p",null,"No users have added personal Apps yet.",-1)]))):(n(),o("div",st,[(n(!0),o(U,null,$(K.value,s=>(n(),F(N,{key:s.id,mcp:s,"is-editable":"",onEdit:r=>S(s,"apps"),onDelete:r=>T(s,"apps")},null,8,["mcp","onEdit","onDelete"]))),128))]))],512),[[J,i.value==="apps"]])]))}},pt=ne(lt,[["__scopeId","data-v-fb10a8d9"]]);export{pt as default};
