import{S as pe,O as ve,L as ce,x as me,a as ye,s as T,r as i,j as w,w as C,o as fe,c as o,b as a,g as s,d as c,n as B,k as I,A as M,X as ge,h as u,l as $,v as z,F as h,i as S,t as v,e as F,B as be,bM as O,f as we,M as _e,E as ke}from"./index-CiyriZlD.js";import{A as xe}from"./AppCard-BeZ_seKK.js";import{A as he}from"./AppCardSkeleton-DgReinIr.js";import"./IconArrowUpCircle-Bi1nTlj2.js";import"./IconGlobeAlt-CU_IQyVG.js";import"./IconPlayCircle-DGwnwLdu.js";import"./IconWrenchScrewdriver-BXH4AMRP.js";const Se={class:"space-y-6"},Pe={class:"border-b border-gray-200 dark:border-gray-700"},Re={class:"-mb-px flex space-x-6"},Ae={key:0},Ce={class:"flex justify-between items-center mb-4"},Ie={class:"flex gap-2"},Me={class:"space-y-4"},$e={class:"grid grid-cols-1 lg:grid-cols-4 gap-4"},Ue={class:"relative lg:col-span-1"},Ve={class:"grid grid-cols-1 sm:grid-cols-3 lg:col-span-3 gap-4"},Ne=["value"],Ze=["value"],Te={key:0,class:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 2xl:grid-cols-4 gap-6"},ze={key:1,class:"empty-state-card"},Le={key:2},De={class:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 2xl:grid-cols-4 gap-6"},je={key:0,class:"flex justify-between items-center mt-6"},qe=["disabled"],Ee={class:"text-sm text-gray-600 dark:text-gray-400"},Be=["disabled"],Fe={key:1},Oe={class:"flex justify-between items-center mb-4"},Ge={key:0,class:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm mb-6"},He={class:"flex items-center gap-x-4"},Je={key:0},We=["required"],Ke={key:1},Qe=["required"],Xe={key:1,class:"text-center p-4"},Ye={key:2,class:"empty-state-card"},et={key:3,class:"space-y-4"},tt={class:"font-semibold"},st={class:"text-sm text-gray-500"},lt={class:"text-xs text-gray-400"},at={class:"flex items-center gap-2"},ot=["onClick"],nt=["onClick"],it={__name:"PersonalitiesManagement",setup(rt){const d=ve(),G=ce(),m=me(),U=ye(),{personalityZooRepositories:H,isLoadingPersonalityZooRepositories:J,zooPersonalities:P,isLoadingZooPersonalities:W}=T(d),{publicPersonalities:K}=T(U),{tasks:Q}=T(G),y=i("zoo"),n=i({type:"git",name:"",url:"",path:""}),_=i(!1),f=i(null),R=i(""),p=i("All"),k=i("All"),x=i("All"),L=i("name"),D=i("asc"),g=i(JSON.parse(localStorage.getItem("starredPersonalities")||"[]")),r=i(1),V=i(24);let j=null;const N=w(()=>P.value.total||0),q=w(()=>P.value.pages||1),X=w(()=>{if(N.value===0)return"Showing 0-0 of 0";const l=(r.value-1)*V.value+1,e=Math.min(r.value*V.value,N.value);return`Showing ${l}-${e} of ${N.value}`});async function b(){const l={page:r.value,page_size:V.value,sort_by:L.value,sort_order:D.value,category:p.value!=="All"&&p.value!=="Starred"?p.value:void 0,repository:x.value!=="All"?x.value:void 0,search_query:R.value||void 0,installation_status:k.value!=="All"?k.value:void 0};p.value==="Starred"&&(l.starred_names=g.value),await d.fetchZooPersonalities(l)}const E=w(()=>{const l=new Map;return(Q.value||[]).forEach(e=>{var t;if((t=e==null?void 0:e.name)!=null&&t.startsWith("Installing personality: ")&&(e.status==="running"||e.status==="pending")){const A=e.name.replace("Installing personality: ","");l.set(A,e)}}),(P.value.items||[]).map(e=>({...e,task:l.get(e.folder_name)||null}))});function Y(){clearTimeout(j),j=setTimeout(()=>{r.value=1,b()},300)}C([L,D,p,k,x],()=>{r.value=1,b()}),C(R,Y),C(r,b),C(g,l=>{localStorage.setItem("starredPersonalities",JSON.stringify(l)),p.value==="Starred"&&(r.value=1,b())},{deep:!0}),fe(()=>{U.fetchPersonalities(),d.fetchPersonalityZooRepositories(),b()});const Z=w(()=>[...H.value||[]].sort((l,e)=>(l.name||"").localeCompare(e.name||""))),ee=w(()=>["All","Starred",...P.value.categories||[]]);function te(l){return l?new Date(l).toLocaleString():"Never"}async function se(){if(!n.value.name){m.addNotification("Repository name is required.","warning");return}const l={name:n.value.name};n.value.type==="git"?l.url=n.value.url:l.path=n.value.path,f.value="add";try{await d.addPersonalityZooRepository(l),n.value={type:"git",name:"",url:"",path:""},_.value=!1}finally{f.value=null}}async function le(l){f.value=l.id;try{await d.pullPersonalityZooRepository(l.id)}finally{f.value=null}}async function ae(l){if(await m.showConfirmation({title:`Delete Repository '${l.name}'?`})){f.value=l.id;try{await d.deletePersonalityZooRepository(l.id)}finally{f.value=null}}}async function oe(l){await d.installZooPersonality({repository:l.repository,folder_name:l.folder_name})}async function ne(l){const e=K.value.find(t=>t.name===l.name&&t.owner_username==="System");e&&await m.showConfirmation({title:`Uninstall '${l.name}'?`})&&(await U.deletePersonality(e.id),await b())}async function ie(l){const e=await d.fetchPersonalityReadme(l.repository,l.folder_name);m.openModal("sourceViewer",{title:`README: ${l.name}`,content:e,language:"markdown"})}function re(l){const e=g.value.indexOf(l);e>-1?g.value.splice(e,1):g.value.push(l)}function ue(l=null){m.openModal("personalityEditor",{personality:l})}function de(){m.openModal("generatePersonality")}return(l,e)=>(a(),o("div",Se,[s("div",Pe,[s("nav",Re,[s("button",{onClick:e[0]||(e[0]=t=>y.value="zoo"),class:B(["tab-button",y.value==="zoo"?"active":"inactive"])},"Zoo",2),s("button",{onClick:e[1]||(e[1]=t=>y.value="source"),class:B(["tab-button",y.value==="source"?"active":"inactive"])},"Repositories",2)])]),y.value==="zoo"?(a(),o("section",Ae,[s("div",Ce,[e[16]||(e[16]=s("h3",{class:"text-xl font-semibold"},"Personality Zoo",-1)),s("div",Ie,[s("button",{onClick:de,class:"btn btn-secondary"},"Generate from Prompt"),s("button",{onClick:e[2]||(e[2]=t=>ue()),class:"btn btn-primary"},[I(ge,{class:"w-4 h-4 mr-1"}),e[15]||(e[15]=M(" Create New"))])])]),s("div",Me,[s("div",$e,[s("div",Ue,[u(s("input",{"onUpdate:modelValue":e[3]||(e[3]=t=>R.value=t),type:"text",placeholder:"Search Personalities...",class:"input-field w-full pl-10"},null,512),[[$,R.value]]),e[17]||(e[17]=s("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[s("svg",{class:"h-5 w-5 text-gray-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})])],-1))]),s("div",Ve,[u(s("select",{"onUpdate:modelValue":e[4]||(e[4]=t=>k.value=t),class:"input-field"},e[18]||(e[18]=[s("option",{value:"All"},"All Statuses",-1),s("option",{value:"Installed"},"Installed",-1),s("option",{value:"Uninstalled"},"Uninstalled",-1)]),512),[[z,k.value]]),u(s("select",{"onUpdate:modelValue":e[5]||(e[5]=t=>p.value=t),class:"input-field"},[(a(!0),o(h,null,S(ee.value,t=>(a(),o("option",{key:t,value:t},v(t),9,Ne))),128))],512),[[z,p.value]]),u(s("select",{"onUpdate:modelValue":e[6]||(e[6]=t=>x.value=t),class:"input-field"},[e[19]||(e[19]=s("option",{value:"All"},"All Sources",-1)),(a(!0),o(h,null,S(Z.value,t=>(a(),o("option",{key:t.id,value:t.name},v(t.name),9,Ze))),128))],512),[[z,x.value]])])]),F(W)?(a(),o("div",Te,[(a(),o(h,null,S(8,t=>I(he,{key:t})),64))])):E.value.length===0?(a(),o("div",ze,e[20]||(e[20]=[s("p",null,"No personalities found.",-1)]))):(a(),o("div",Le,[s("div",De,[(a(!0),o(h,null,S(E.value,t=>(a(),be(xe,{key:`${t.repository}/${t.folder_name}`,app:t,task:t.task,"is-starred":g.value.includes(t.name),"item-type-name":"Personality",onStar:A=>re(t.name),onInstall:oe,onUninstall:ne,onHelp:ie},null,8,["app","task","is-starred","onStar"]))),128))]),q.value>1?(a(),o("div",je,[s("button",{onClick:e[7]||(e[7]=t=>r.value--),disabled:r.value===1,class:"btn btn-secondary"},"Previous",8,qe),s("span",Ee,v(X.value),1),s("button",{onClick:e[8]||(e[8]=t=>r.value++),disabled:r.value>=q.value,class:"btn btn-secondary"},"Next",8,Be)])):c("",!0)]))])])):c("",!0),y.value==="source"?(a(),o("section",Fe,[s("div",Oe,[e[21]||(e[21]=s("h3",{class:"text-xl font-semibold"},"Personality Zoo Repositories",-1)),s("button",{onClick:e[9]||(e[9]=t=>_.value=!_.value),class:"btn btn-primary"},v(_.value?"Cancel":"Add Repository"),1)]),_.value?(a(),o("div",Ge,[s("form",{onSubmit:we(se,["prevent"]),class:"space-y-4"},[s("div",He,[s("label",null,[u(s("input",{type:"radio","onUpdate:modelValue":e[10]||(e[10]=t=>n.value.type=t),value:"git",class:"radio-input"},null,512),[[O,n.value.type]]),e[22]||(e[22]=M(" Git"))]),s("label",null,[u(s("input",{type:"radio","onUpdate:modelValue":e[11]||(e[11]=t=>n.value.type=t),value:"local",class:"radio-input"},null,512),[[O,n.value.type]]),e[23]||(e[23]=M(" Local"))])]),s("div",null,[e[24]||(e[24]=s("label",null,"Name",-1)),u(s("input",{"onUpdate:modelValue":e[12]||(e[12]=t=>n.value.name=t),type:"text",class:"input-field",required:""},null,512),[[$,n.value.name]])]),n.value.type==="git"?(a(),o("div",Je,[e[25]||(e[25]=s("label",null,"URL",-1)),u(s("input",{"onUpdate:modelValue":e[13]||(e[13]=t=>n.value.url=t),type:"url",class:"input-field",required:n.value.type==="git"},null,8,We),[[$,n.value.url]])])):c("",!0),n.value.type==="local"?(a(),o("div",Ke,[e[26]||(e[26]=s("label",null,"Path",-1)),u(s("input",{"onUpdate:modelValue":e[14]||(e[14]=t=>n.value.path=t),type:"text",class:"input-field",required:n.value.type==="local"},null,8,Qe),[[$,n.value.path]])])):c("",!0),e[27]||(e[27]=s("div",{class:"flex justify-end"},[s("button",{type:"submit",class:"btn btn-primary"},"Add")],-1))],32)])):c("",!0),F(J)?(a(),o("div",Xe,"Loading...")):Z.value.length===0?(a(),o("div",Ye,e[28]||(e[28]=[s("p",null,"No repositories added.",-1)]))):(a(),o("div",et,[(a(!0),o(h,null,S(Z.value,t=>(a(),o("div",{key:t.id,class:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm flex items-center justify-between"},[s("div",null,[s("p",tt,v(t.name),1),s("p",st,v(t.url),1),s("p",lt,"Pulled: "+v(te(t.last_pulled_at)),1)]),s("div",at,[s("button",{onClick:A=>le(t),class:"btn btn-secondary btn-sm"},[I(_e,{class:"w-4 h-4 mr-1"}),M(v(t.type==="git"?"Pull":"Rescan"),1)],8,ot),t.is_deletable?(a(),o("button",{key:0,onClick:A=>ae(t),class:"btn btn-danger btn-sm"},[I(ke,{class:"w-4 h-4"})],8,nt)):c("",!0)])]))),128))]))])):c("",!0)]))}},ft=pe(it,[["__scopeId","data-v-f32307c6"]]);export{ft as default};
