import{bd as Ie,bg as $e,bt as Te,m as Ue,bh as ee,f as c,c as w,bq as M,bi as Re,a as o,o as n,e as s,h as b,bf as k,j as v,bu as P,t as f,w as Me,bo as Ne,g as y,q as te,bS as se,v as Z,bs as De,bk as h,F as C,i as I,s as Ve,bj as B,b as G,bT as Le,bU as Pe,bV as Ze}from"./index-BvdqLQzi.js";import je from"./IconArrowUp-jNBlPbGQ.js";import qe from"./IconArrowDown-CCIZzBTV.js";import Fe from"./IconGlobeAlt-CanR6fmK.js";import{A as ze,a as ae}from"./AppCardSkeleton-CNpbn3WR.js";import"./IconArrowUpCircle-BWED6opE.js";import"./IconPlayCircle-DqXVzl6X.js";const Ee={class:"space-y-6"},Oe={class:"border-b border-gray-200 dark:border-gray-700"},Be={class:"-mb-px flex space-x-6","aria-label":"Sub Tabs"},Ge={key:0},We={class:"flex justify-between items-center mb-4 flex-wrap gap-2"},He={class:"flex items-center gap-2"},Je=["disabled"],Ke={key:0,class:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm mb-6 overflow-hidden"},Qe={class:"flex items-center gap-x-4 border-b pb-4 dark:border-gray-700"},Ye={class:"flex items-center gap-x-2 cursor-pointer text-sm font-medium"},Xe={class:"flex items-center gap-x-2 cursor-pointer text-sm font-medium"},et={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},tt={key:0,class:"md:col-span-2"},st=["required"],at={key:1,class:"md:col-span-2"},lt=["required"],nt={class:"flex justify-end"},ot=["disabled"],it={key:0,class:"text-center p-4"},rt={key:1,class:"empty-state-card"},dt={key:2,class:"space-y-4"},ut={class:"flex-grow truncate"},pt={class:"flex items-center gap-2"},ct={class:"font-semibold"},vt={class:"text-sm text-gray-500"},mt=["title"],ft={class:"text-xs text-gray-400 mt-1"},gt={class:"flex items-center gap-x-2 flex-shrink-0"},bt=["onClick","disabled"],yt={class:"ml-1"},ht=["onClick","disabled"],_t={key:1},xt={class:"flex justify-between items-center mb-4 flex-wrap gap-2"},wt=["disabled"],kt={class:"space-y-4"},At={class:"grid grid-cols-1 lg:grid-cols-3 gap-4"},St={class:"relative lg:col-span-1"},Ct={class:"grid grid-cols-2 lg:col-span-2 gap-4"},It=["value"],$t={class:"flex items-center gap-2"},Tt=["value"],Ut={key:0,class:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 2xl:grid-cols-4 gap-6"},Rt={key:1,class:"empty-state-card"},Mt={key:2},Nt={class:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 2xl:grid-cols-4 gap-6"},Dt={key:0,class:"mt-6 flex justify-between items-center"},Vt={class:"text-sm text-gray-500"},Lt={class:"flex gap-2"},Pt=["disabled"],Zt=["disabled"],jt={key:2},qt={class:"flex justify-between items-center mb-4"},Ft={class:"flex items-center gap-2"},zt=["disabled"],Et={key:0,class:"text-center p-10"},Ot={key:1,class:"empty-state-card"},Bt={key:2,class:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 2xl:grid-cols-4 gap-6"},Gt={class:"bg-white dark:bg-gray-800 rounded-b-lg p-2 flex justify-around items-center text-sm border-t border-gray-200 dark:border-gray-700"},Wt=["href"],Ht=["onClick"],Jt=["onClick"],Kt=["onClick"],Qt={__name:"AppsManagement",setup(Yt){const r=$e(),W=Te(),p=Ue(),{zooRepositories:H,isLoadingZooRepositories:le,zooApps:A,isLoadingZooApps:j,installedApps:ne,isLoadingInstalledApps:q}=ee(r),{tasks:J}=ee(W),m=c("repositories"),i=c({type:"git",name:"",url:"",path:""}),$=c(!1),u=c(null),N=c(""),_=c("All"),T=c("All"),D=c(!1),V=c("last_update_date"),U=c("desc"),S=c(JSON.parse(localStorage.getItem("starredItems")||"[]")),g=c(1),F=c(24);let K=null;const oe=[{value:"last_update_date",label:"Last Updated"},{value:"creation_date",label:"Creation Date"},{value:"name",label:"Name"},{value:"author",label:"Author"}],Q=w(()=>A.value.total||0),ie=w(()=>A.value.pages||1),re=w(()=>{const a=(g.value-1)*F.value+1,e=Math.min(g.value*F.value,Q.value);return`Showing ${a}-${e} of ${Q.value}`}),de=w(()=>A.value.items?A.value.items.reduce((a,e)=>(a[e.repository]=(a[e.repository]||0)+1,a),{}):{});async function R(){if(_.value==="Starred")return;const a={page:g.value,page_size:F.value,sort_by:V.value,sort_order:U.value,category:_.value!=="All"?_.value:void 0,search_query:N.value||void 0,installation_status:T.value!=="All"?T.value:void 0};await r.fetchZooApps(a)}function ue(){clearTimeout(K),K=setTimeout(()=>{g.value=1,R()},300)}M(()=>i.value.type,a=>{a==="git"?i.value.path="":i.value.url=""}),M([m,V,U,_,T],()=>{g.value=1,m.value==="available_items"&&R()}),M(N,ue),M(g,R),M(S,a=>{localStorage.setItem("starredItems",JSON.stringify(a))},{deep:!0}),Re(()=>{r.fetchZooRepositories(),r.fetchInstalledApps(),R()});const z=w(()=>{if(!Array.isArray(A.value.items))return[];let a=A.value.items;_.value==="Starred"&&(a=a.filter(l=>S.value.includes(l.name)));const e=new Map,t=["Installing app: ","Updating app: "];return J.value.forEach(l=>{if(l!=null&&l.name){for(const d of t)if(l.name.startsWith(d)&&(l.status==="running"||l.status==="pending")){const x=l.name.replace(d,"");(!e.has(x)||new Date(l.created_at)>new Date(e.get(x).created_at))&&e.set(x,l);break}}}),a.map(l=>({...l,task:e.get(l.name)||e.get(l.folder_name)||null}))}),E=w(()=>Array.isArray(H.value)?[...H.value].sort((a,e)=>(a.name||"").localeCompare(e.name||"")):[]),pe=w(()=>A.value.categories||["All","Starred"]),O=w(()=>{const e=[...ne.value.filter(l=>(l.item_type||"app")==="app")].sort((l,d)=>(l.name||"").localeCompare(d.name||"")),t=new Map;return J.value.forEach(l=>{if(!(l!=null&&l.name))return;let d="",x=null;l.name.startsWith("Start app: ")?(d=l.name.replace("Start app: ",""),x="starting"):l.name.startsWith("Stop app: ")?(d=l.name.replace("Stop app: ",""),x="stopping"):l.name.startsWith("Updating app: ")&&(d=l.name.replace("Updating app: ",""),x="updating"),d&&(l.status==="running"||l.status==="pending")&&(!t.has(d)||new Date(l.created_at)>new Date(t.get(d).created_at))&&t.set(d,{task:l,activityType:x})}),e.map(l=>{const d=t.get(l.name);return{...l,task:d?d.task:null,activity_status:d?d.activityType:null}})});function ce(a){const e=S.value.indexOf(a);e>-1?S.value.splice(e,1):S.value.push(a)}function ve(a){return a?new Date(a).toLocaleString():"Never"}async function me(){if(!i.value.name){p.addNotification("Repository name is required.","warning");return}const a={name:i.value.name};if(i.value.type==="git"){if(!i.value.url){p.addNotification("Git URL is required.","warning");return}a.url=i.value.url}else{if(!i.value.path){p.addNotification("Local Folder Path is required.","warning");return}a.path=i.value.path}u.value="add";try{await r.addZooRepository(a),i.value={type:"git",name:"",url:"",path:""},$.value=!1}finally{u.value=null}}async function fe(a){u.value=a.id;try{await r.pullZooRepository(a.id)}finally{u.value=null}}async function ge(){D.value=!0;try{await r.pullAllZooRepositories()}finally{D.value=!1}}async function be(a){if(await p.showConfirmation({title:`Delete Repository '${a.name}'?`,message:"This will remove the repository record. For Git repos, it also deletes cached files. This action cannot be undone.",confirmText:"Delete"})){u.value=a.id;try{await r.deleteZooRepository(a.id)}finally{u.value=null}}}function ye(a){p.openModal("appInstall",{app:a,type:"apps"})}async function Y(a){await p.showConfirmation({title:`Update '${a.name}'?`,message:"This will update the app to the latest version while preserving your configuration. The app will be stopped during the update.",confirmText:"Update"})&&await r.updateApp(a.id)}async function L(a,e){u.value=`${e}-${a}`;try{e==="start"&&await r.startApp(a),e==="stop"&&await r.stopApp(a)}finally{u.value=null}}async function X(a){if(await p.showConfirmation({title:`Uninstall '${a.name}'?`,message:"This will permanently delete all files. This cannot be undone.",confirmText:"Uninstall"})){u.value=`uninstall-${a.id}`;try{await r.uninstallApp(a.id)}finally{u.value=null}}}function he(a){p.openModal("sourceViewer",{title:`Details: ${a.name}`,content:a.description||"No description available.",language:"text"})}function _e(a){p.openModal("appConfig",{app:a})}function xe(a){p.openModal("serviceRegistration",{item:a,itemType:"app",isInstalled:!0})}async function we(a){const e=await r.fetchAppLog(a.id);p.openModal("sourceViewer",{title:`Logs: ${a.name}`,content:e||"No log content found.",language:"log"})}async function ke(a){const e=await r.fetchAppReadme(a.repository,a.folder_name);p.openModal("sourceViewer",{title:`README: ${a.name}`,content:e,language:"markdown"})}async function Ae(a){await W.cancelTask(a)}function Se(a){p.openModal("tasksManager",{initialTaskId:a})}async function Ce(){await p.showConfirmation({title:"Sync Installations?",message:'This will scan for installed items on disk that are missing from the database and try to repair them. It will also remove database entries for items that no longer exist on disk. This can fix "ghost" installations.',confirmText:"Sync Now"})&&await r.syncInstallations()}return(a,e)=>(n(),o("div",Ee,[s("div",Oe,[s("nav",Be,[s("button",{onClick:e[0]||(e[0]=t=>m.value="repositories"),class:k(["tab-button",m.value==="repositories"?"active":"inactive"])},"Repositories",2),s("button",{onClick:e[1]||(e[1]=t=>m.value="available_items"),class:k(["tab-button",m.value==="available_items"?"active":"inactive"])},"Available",2),s("button",{onClick:e[2]||(e[2]=t=>m.value="installed_apps"),class:k(["tab-button",m.value==="installed_apps"?"active":"inactive"])},"Installed",2)])]),m.value==="repositories"?(n(),o("section",Ge,[s("div",We,[e[18]||(e[18]=s("h3",{class:"text-xl font-semibold"},"App Zoo Repositories",-1)),s("div",He,[s("button",{onClick:ge,class:"btn btn-secondary",disabled:D.value},[v(P,{class:k(["w-4 h-4",{"animate-spin":D.value}])},null,8,["class"]),e[17]||(e[17]=s("span",{class:"ml-2"},"Pull All",-1))],8,Je),s("button",{onClick:e[3]||(e[3]=t=>$.value=!$.value),class:"btn btn-primary"},f($.value?"Cancel":"Add Repository"),1)])]),v(De,{name:"form-fade"},{default:Me(()=>[$.value?(n(),o("div",Ke,[s("form",{onSubmit:Ne(me,["prevent"]),class:"space-y-4"},[s("div",Qe,[s("label",Ye,[y(s("input",{type:"radio","onUpdate:modelValue":e[4]||(e[4]=t=>i.value.type=t),value:"git",class:"radio-input"},null,512),[[se,i.value.type]]),e[19]||(e[19]=te(" Git Repository"))]),s("label",Xe,[y(s("input",{type:"radio","onUpdate:modelValue":e[5]||(e[5]=t=>i.value.type=t),value:"local",class:"radio-input"},null,512),[[se,i.value.type]]),e[20]||(e[20]=te(" Local Folder"))])]),s("div",et,[s("div",null,[e[21]||(e[21]=s("label",{for:"repo-name-app",class:"block text-sm font-medium mb-1"},"Name",-1)),y(s("input",{id:"repo-name-app","onUpdate:modelValue":e[6]||(e[6]=t=>i.value.name=t),type:"text",class:"input-field",placeholder:"e.g., Official Zoo",required:""},null,512),[[Z,i.value.name]])]),i.value.type==="git"?(n(),o("div",tt,[e[22]||(e[22]=s("label",{for:"repo-url-app",class:"block text-sm font-medium mb-1"},"Git URL",-1)),y(s("input",{id:"repo-url-app","onUpdate:modelValue":e[7]||(e[7]=t=>i.value.url=t),type:"url",class:"input-field",placeholder:"https://github.com/ParisNeo/lollms_apps_zoo.git",required:i.value.type==="git"},null,8,st),[[Z,i.value.url]])])):b("",!0),i.value.type==="local"?(n(),o("div",at,[e[23]||(e[23]=s("label",{for:"repo-path-app",class:"block text-sm font-medium mb-1"},"Full Folder Path",-1)),y(s("input",{id:"repo-path-app","onUpdate:modelValue":e[8]||(e[8]=t=>i.value.path=t),type:"text",class:"input-field",placeholder:"e.g., C:\\Users\\YourUser\\Documents\\my-lollms-apps",required:i.value.type==="local"},null,8,lt),[[Z,i.value.path]])])):b("",!0)]),s("div",nt,[s("button",{type:"submit",class:"btn btn-primary",disabled:u.value==="add"},f(u.value==="add"?"Adding...":"Add Repository"),9,ot)])],32)])):b("",!0)]),_:1}),h(le)?(n(),o("div",it,"Loading repositories...")):!E.value||E.value.length===0?(n(),o("div",rt,e[24]||(e[24]=[s("p",null,"No App Zoo repositories added.",-1)]))):(n(),o("div",dt,[(n(!0),o(C,null,I(E.value,t=>(n(),o("div",{key:t.id,class:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm flex flex-col md:flex-row md:items-center justify-between gap-4"},[s("div",ut,[s("div",pt,[s("span",{class:k(["px-2 py-0.5 text-xs font-semibold rounded-full",t.type==="git"?"bg-blue-100 text-blue-800 dark:bg-blue-900/50 dark:text-blue-300":"bg-green-100 text-green-800 dark:bg-green-900/50 dark:text-green-300"])},f(t.type),3),s("p",ct,f(t.name),1),s("span",vt,"("+f(de.value[t.name]||0)+" items)",1)]),s("p",{class:"text-sm text-gray-500 font-mono truncate mt-1",title:t.url},f(t.url),9,mt),s("p",ft,"Last updated: "+f(ve(t.last_pulled_at)),1)]),s("div",gt,[s("button",{onClick:l=>fe(t),class:"btn btn-secondary btn-sm",disabled:u.value===t.id},[v(P,{class:k(["w-4 h-4",{"animate-spin":u.value===t.id}])},null,8,["class"]),s("span",yt,f(t.type==="git"?"Pull":"Rescan"),1)],8,bt),t.is_deletable?(n(),o("button",{key:0,onClick:l=>be(t),class:"btn btn-danger btn-sm",disabled:u.value===t.id},[v(Ve,{class:"w-4 h-4"})],8,ht)):b("",!0)])]))),128))]))])):b("",!0),m.value==="available_items"?(n(),o("section",_t,[s("div",xt,[e[26]||(e[26]=s("h3",{class:"text-xl font-semibold"},"Available Apps",-1)),s("button",{onClick:R,class:"btn btn-secondary",disabled:h(j)},[v(P,{class:k(["w-4 h-4",{"animate-spin":h(j)}])},null,8,["class"]),e[25]||(e[25]=s("span",{class:"ml-2"},"Rescan",-1))],8,wt)]),s("div",kt,[s("div",At,[s("div",St,[y(s("input",{type:"text","onUpdate:modelValue":e[9]||(e[9]=t=>N.value=t),placeholder:"Search apps...",class:"input-field w-full pl-10"},null,512),[[Z,N.value]]),e[27]||(e[27]=s("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[s("svg",{class:"h-5 w-5 text-gray-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})])],-1))]),s("div",Ct,[y(s("select",{"onUpdate:modelValue":e[10]||(e[10]=t=>T.value=t),class:"input-field"},e[28]||(e[28]=[s("option",{value:"All"},"All Statuses",-1),s("option",{value:"Installed"},"Installed",-1),s("option",{value:"Uninstalled"},"Uninstalled",-1)]),512),[[B,T.value]]),y(s("select",{"onUpdate:modelValue":e[11]||(e[11]=t=>_.value=t),class:"input-field"},[(n(!0),o(C,null,I(pe.value,t=>(n(),o("option",{key:t,value:t},f(t),9,It))),128))],512),[[B,_.value]])])]),s("div",$t,[y(s("select",{"onUpdate:modelValue":e[12]||(e[12]=t=>V.value=t),class:"input-field w-48"},[(n(),o(C,null,I(oe,t=>s("option",{key:t.value,value:t.value},"Sort by "+f(t.label),9,Tt)),64))],512),[[B,V.value]]),s("button",{onClick:e[13]||(e[13]=t=>U.value=U.value==="asc"?"desc":"asc"),class:"btn btn-secondary p-2"},[U.value==="asc"?(n(),G(je,{key:0,class:"w-5 h-5"})):(n(),G(qe,{key:1,class:"w-5 h-5"}))])]),h(j)?(n(),o("div",Ut,[(n(),o(C,null,I(8,t=>v(ze,{key:t})),64))])):!z.value||z.value.length===0?(n(),o("div",Rt,e[29]||(e[29]=[s("h4",{class:"font-semibold"},"No Apps Found",-1),s("p",{class:"text-sm"},"No apps match your criteria. Please add and pull a repository or adjust your filters.",-1)]))):(n(),o("div",Mt,[s("div",Nt,[(n(!0),o(C,null,I(z.value,t=>(n(),G(ae,{key:`${t.repository}/${t.folder_name}`,app:t,task:t.task,"is-starred":S.value.includes(t.name),onStar:l=>ce(t.name),onInstall:l=>ye(t),onUpdate:l=>Y(t),onUninstall:l=>X(t),onDetails:l=>he(t),onHelp:l=>ke(t),onViewTask:Se,onCancelInstall:l=>Ae(t.task.id),onStart:l=>L(t.id,"start"),onStop:l=>L(t.id,"stop")},null,8,["app","task","is-starred","onStar","onInstall","onUpdate","onUninstall","onDetails","onHelp","onCancelInstall","onStart","onStop"]))),128))]),_.value!=="Starred"?(n(),o("div",Dt,[s("p",Vt,f(re.value),1),s("div",Lt,[s("button",{onClick:e[14]||(e[14]=t=>g.value--),disabled:g.value<=1,class:"btn btn-secondary"},"Previous",8,Pt),s("button",{onClick:e[15]||(e[15]=t=>g.value++),disabled:g.value>=ie.value,class:"btn btn-secondary"},"Next",8,Zt)])])):b("",!0)]))])])):b("",!0),m.value==="installed_apps"?(n(),o("section",jt,[s("div",qt,[e[31]||(e[31]=s("h3",{class:"text-xl font-semibold"},"Installed Apps",-1)),s("div",Ft,[s("button",{onClick:Ce,class:"btn btn-secondary-outline",title:"Repair broken installations and remove orphaned DB entries."},"Sync Installations"),s("button",{onClick:e[16]||(e[16]=(...t)=>h(r).fetchInstalledApps&&h(r).fetchInstalledApps(...t)),class:"btn btn-secondary",disabled:h(q)},[v(P,{class:k(["w-4 h-4",{"animate-spin":h(q)}])},null,8,["class"]),e[30]||(e[30]=s("span",{class:"ml-2"},"Refresh",-1))],8,zt)])]),h(q)?(n(),o("div",Et,"Loading...")):!O.value||O.value.length===0?(n(),o("div",Ot,e[32]||(e[32]=[s("h4",{class:"font-semibold"},"No Apps Installed",-1),s("p",{class:"text-sm"},'Go to "Available" to install an app.',-1)]))):(n(),o("div",Bt,[(n(!0),o(C,null,I(O.value,t=>(n(),o("div",{key:t.id,class:"flex flex-col"},[v(ae,{app:t,task:t.task,onUpdate:l=>Y(t),onUninstall:l=>X(t),onStart:l=>L(t.id,"start"),onStop:l=>L(t.id,"stop")},null,8,["app","task","onUpdate","onUninstall","onStart","onStop"]),s("div",Gt,[t.status==="running"&&t.url?(n(),o("a",{key:0,href:t.url,target:"_blank",class:"btn-footer",title:"Open"},[v(Fe,{class:"w-5 h-5"})],8,Wt)):b("",!0),s("button",{onClick:l=>xe(t),class:"btn-footer",title:"Edit Registration"},[v(Le,{class:"w-5 h-5"})],8,Ht),t.has_config_schema?(n(),o("button",{key:1,onClick:l=>_e(t),class:"btn-footer",title:"Configure"},[v(Pe,{class:"w-5 h-5"})],8,Jt)):b("",!0),s("button",{onClick:l=>we(t),class:"btn-footer",title:"Logs"},[v(Ze,{class:"w-5 h-5"})],8,Kt)])]))),128))]))])):b("",!0)]))}},os=Ie(Qt,[["__scopeId","data-v-57636b14"]]);export{os as default};
