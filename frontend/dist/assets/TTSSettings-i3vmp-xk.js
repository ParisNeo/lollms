import{$ as se,u as ae,a as le,G as oe,s as G,r as _,k as ne,l as ie,m as re,p as ue,q as de,w as M,bP as ce,j as m,o as ve,a8 as fe,c as o,b as l,g as t,d as x,x as R,y as h,bT as J,t as v,z as q,h as w,A as ge,e as A,f as Q,B as me,F as S,i as T,n as E,bQ as _e,T as pe,C as be,v as Y,J as V,O as ye,bS as xe}from"./index-avF7PL5F.js";import{_ as ke}from"./LanguageSelector-BkImoWs9.js";const he={class:"space-y-8"},we={class:"relative"},Se={class:"flex items-center space-x-3 truncate"},Te=["src"],Ce={key:1,class:"w-8 h-8 flex-shrink-0 text-gray-500 dark:text-gray-400 flex items-center justify-center bg-gray-200 dark:bg-gray-700 rounded-md"},Me={class:"min-w-0 text-left"},Ve={class:"block font-semibold truncate"},Le={class:"p-2 sticky top-0 bg-white dark:bg-gray-800 z-10 border-b dark:border-gray-700"},Oe={class:"p-1 flex-grow overflow-y-auto"},Ue={key:0,class:"text-center p-4 text-sm text-gray-500"},Re={key:1,class:"text-center p-4 text-sm text-gray-500"},Ae={class:"px-2 py-1.5 text-xs font-bold text-gray-600 dark:text-gray-300"},Ee=["onClick"],Fe={class:"flex items-center space-x-3 truncate"},$e=["src"],De={class:"truncate text-left"},je={class:"font-medium truncate text-sm"},Ne={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},ze=["value"],Be={class:"mt-1 text-xs text-gray-500 dark:text-gray-400"},Ie={key:0,class:"p-4 border rounded-lg dark:border-gray-700 space-y-4"},Pe={class:"font-medium"},Ge={class:"font-mono text-blue-600 dark:text-blue-400"},Je={key:0,class:"text-sm text-gray-500"},qe={key:1,class:"grid grid-cols-1 md:grid-cols-2 gap-6"},Qe=["for"],Ye={class:"text-xs text-gray-500 dark:text-gray-400 mb-1"},He=["id","onUpdate:modelValue"],Ke=["value"],We=["type","step","id","onUpdate:modelValue","placeholder"],Xe={key:2,class:"mt-1"},Ze=["onClick"],et={key:2,class:"flex justify-end gap-3 pt-4 border-t dark:border-gray-600"},tt=["disabled"],st={key:1,class:"p-4 border border-yellow-300 dark:border-yellow-700 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg text-sm text-yellow-800 dark:text-yellow-200 flex items-center gap-3"},at={class:"flex justify-end pt-4 border-t dark:border-gray-600"},lt=["disabled"],ot={__name:"TTSSettings",setup(nt){const F=ae(),p=le();oe();const{user:f}=G(F),{availableTtsModels:$,availableTtsModelsGrouped:D,userVoices:H}=G(p),n=_({}),k=_(!1),L=_(!1);let j="{}";const b=_(!1),O=_(null),U=_(null),C=_(""),{floatingStyles:K}=ne(O,U,{placement:"bottom-start",whileElementsMounted:ie,middleware:[re(5),ue(),de({padding:5})]}),W={mounted:(s,e)=>{s.clickOutsideEvent=i=>{const u=O.value;s===i.target||s.contains(i.target)||u!=null&&u.contains(i.target)||e.value()},document.addEventListener("mousedown",s.clickOutsideEvent)},unmounted:s=>{document.removeEventListener("mousedown",s.clickOutsideEvent)}};M(b,s=>{s&&ce(()=>{const e=U.value;if(e){const i=e.querySelector(".menu-item-button.selected");i&&i.scrollIntoView({block:"nearest"})}})});const c=m({get:()=>n.value.tts_binding_model_name,set:s=>{n.value.tts_binding_model_name=s}}),N=m({get:()=>n.value.active_voice_id,set:s=>{n.value.active_voice_id=s}}),z=m({get:()=>n.value.ai_response_language||"auto",set:s=>{n.value.ai_response_language=s}}),d=m(()=>!c.value||$.value.length===0?null:$.value.find(s=>s.id===c.value)||null),y=m(()=>{var e,i;if(!((i=(e=d.value)==null?void 0:e.binding_params)!=null&&i.parameters))return[];const s=["voice","language","model"];return d.value.binding_params.parameters.filter(u=>!s.includes(u.name))}),X=m(()=>!f.value||!c.value||!f.value.tts_models_config?{}:f.value.tts_models_config[c.value]||{}),B=m(()=>{var s;return(s=d.value)!=null&&s.alias?d.value.alias.allow_parameters_override!==!1:!0}),I=m(()=>{if(!C.value)return D.value;const s=C.value.toLowerCase(),e=[];for(const i of D.value)if(i.items){const u=i.items.filter(g=>g.name.toLowerCase().includes(s));u.length>0&&e.push({...i,items:u})}return e});function Z(s){c.value=s,b.value=!1}const P=()=>{if(f.value){const s={};d.value&&y.value.forEach(e=>{s[e.name]=X.value[e.name]??e.default}),n.value={...s,tts_binding_model_name:f.value.tts_binding_model_name,active_voice_id:f.value.active_voice_id,ai_response_language:f.value.ai_response_language||"auto"},j=JSON.stringify(n.value),L.value=!1}};M(d,P,{immediate:!0,deep:!0}),M(f,P,{deep:!0}),M(n,s=>{L.value=JSON.stringify(s)!==JSON.stringify(j)},{deep:!0});async function ee(){k.value=!0;try{const s={tts_binding_model_name:n.value.tts_binding_model_name,active_voice_id:n.value.active_voice_id,ai_response_language:n.value.ai_response_language},e=f.value.tts_models_config||{},i={};y.value.forEach(g=>{n.value[g.name]!==g.default&&(i[g.name]=n.value[g.name])});const u={...e,[c.value]:i};Object.keys(u[c.value]||{}).length===0&&delete u[c.value],s.tts_models_config=u,await F.updateUserPreferences(s)}finally{k.value=!1}}function te(){const s={};d.value&&(y.value.forEach(e=>{s[e.name]=e.default}),n.value={...n.value,...s})}return ve(()=>{p.availableTtsModels.length===0&&p.fetchAvailableTtsModels(),p.userVoices.length===0&&p.fetchUserVoices()}),(s,e)=>{var u,g;const i=fe("router-link");return l(),o("div",he,[e[16]||(e[16]=t("div",null,[t("h3",{class:"text-xl font-semibold leading-6 text-gray-900 dark:text-white"}," Speech Generation (TTS) Parameters "),t("p",{class:"mt-1 text-sm text-gray-500 dark:text-gray-400"}," Configure default parameters for your selected Text-to-Speech model. ")],-1)),t("form",{onSubmit:Q(ee,["prevent"]),class:"space-y-6"},[t("div",null,[e[6]||(e[6]=t("label",{class:"block text-base font-medium mb-2"},"Active Speech Generation Model",-1)),t("div",we,[t("button",{ref_key:"ttsTriggerRef",ref:O,onClick:e[0]||(e[0]=a=>b.value=!b.value),type:"button",class:"toolbox-select truncate w-full flex items-center justify-between"},[t("div",Se,[(u=d.value)!=null&&u.icon_base64?(l(),o("img",{key:0,src:d.value.icon_base64,class:"h-8 w-8 rounded-md object-cover"},null,8,Te)):(l(),o("span",Ce,[h(J,{class:"w-5 h-5"})])),t("div",Me,[t("span",Ve,v(((g=d.value)==null?void 0:g.name)||"Select a Speech Model"),1)])]),e[5]||(e[5]=t("svg",{class:"w-4 h-4 text-gray-400 flex-shrink-0",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor"},[t("path",{"fill-rule":"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z","clip-rule":"evenodd"})],-1))],512),(l(),R(be,{to:"body"},[h(pe,{"enter-active-class":"transition ease-out duration-100","enter-from-class":"transform opacity-0 scale-95","enter-to-class":"transform opacity-100 scale-100","leave-active-class":"transition ease-in duration-75","leave-from-class":"transform opacity-100 scale-100","leave-to-class":"transform opacity-0 scale-95"},{default:q(()=>[b.value?w((l(),o("div",{key:0,ref_key:"ttsFloatingRef",ref:U,style:ge(A(K)),class:"z-50 w-80 origin-top-left rounded-md bg-white dark:bg-gray-800 shadow-lg ring-1 ring-black ring-opacity-5 dark:ring-gray-700 focus:outline-none py-1 flex flex-col max-h-[50vh]"},[t("div",Le,[w(t("input",{type:"text","onUpdate:modelValue":e[1]||(e[1]=a=>C.value=a),onClick:e[2]||(e[2]=Q(()=>{},["stop"])),placeholder:"Search TTS models...",class:"input-field-sm w-full"},null,512),[[me,C.value]])]),t("div",Oe,[A(p).isLoadingTtsModels?(l(),o("div",Ue,"Loading TTS models...")):I.value.length===0?(l(),o("div",Re,"No TTS models found.")):x("",!0),(l(!0),o(S,null,T(I.value,a=>(l(),o("div",{key:a.label},[t("h4",Ae,v(a.label),1),(l(!0),o(S,null,T(a.items,r=>(l(),o("button",{key:r.id,onClick:it=>Z(r.id),class:E(["menu-item-button",{selected:c.value===r.id}])},[t("div",Fe,[r.icon_base64?(l(),o("img",{key:0,src:r.icon_base64,class:"h-6 w-6 rounded-md object-cover flex-shrink-0"},null,8,$e)):(l(),R(J,{key:1,class:"w-6 h-6 text-gray-500 dark:text-gray-400 flex-shrink-0"})),t("div",De,[t("p",je,v(r.name),1)])]),c.value===r.id?(l(),R(_e,{key:0,class:"w-5 h-5 text-blue-600 dark:text-blue-400 flex-shrink-0"})):x("",!0)],10,Ee))),128))]))),128))])],4)),[[W,()=>b.value=!1]]):x("",!0)]),_:1})]))])]),t("div",Ne,[t("div",null,[e[7]||(e[7]=t("label",{for:"aiResponseLanguage",class:"block text-base font-medium mb-2"},"AI Response Language",-1)),h(ke,{modelValue:z.value,"onUpdate:modelValue":e[3]||(e[3]=a=>z.value=a),id:"aiResponseLanguage","include-auto":!0},null,8,["modelValue"]),e[8]||(e[8]=t("p",{class:"mt-1 text-xs text-gray-500 dark:text-gray-400"},"The language for AI text responses and speech generation. 'Auto' uses the interface language.",-1))]),t("div",null,[e[13]||(e[13]=t("label",{for:"active-voice",class:"block text-base font-medium mb-2"},"Active Voice",-1)),w(t("select",{id:"active-voice","onUpdate:modelValue":e[4]||(e[4]=a=>N.value=a),class:"input-field w-full"},[e[9]||(e[9]=t("option",{value:null},"Default Voice",-1)),(l(!0),o(S,null,T(A(H),a=>(l(),o("option",{key:a.id,value:a.id},v(a.alias)+" ("+v(a.language)+") ",9,ze))),128))],512),[[Y,N.value]]),t("p",Be,[e[11]||(e[11]=V("Select a custom voice from your ")),h(i,{to:"/voices-studio",class:"text-blue-600 hover:underline"},{default:q(()=>e[10]||(e[10]=[V("Voices Studio")])),_:1}),e[12]||(e[12]=V("."))])])]),c.value&&d.value&&B.value?(l(),o("div",Ie,[t("h4",Pe,[e[14]||(e[14]=V("Configuration for: ")),t("span",Ge,v(d.value.name),1)]),y.value.length===0?(l(),o("div",Je," This model has no parameters exposed for user configuration. ")):(l(),o("div",qe,[(l(!0),o(S,null,T(y.value,a=>(l(),o("div",{key:a.name},[t("label",{for:`tts-param-${a.name}`,class:"block text-sm font-medium capitalize"},v(a.name.replace(/_/g," ")),9,Qe),t("p",Ye,v(a.description),1),a.options?w((l(),o("select",{key:0,id:`tts-param-${a.name}`,"onUpdate:modelValue":r=>n.value[a.name]=r,class:"input-field mt-1"},[(l(!0),o(S,null,T(a.options,r=>(l(),o("option",{key:r,value:r},v(r),9,Ke))),128))],8,He)),[[Y,n.value[a.name]]]):["str","int","float"].includes(a.type)?w((l(),o("input",{key:1,type:a.type==="str"?"text":"number",step:a.type==="float"?"0.01":"1",id:`tts-param-${a.name}`,"onUpdate:modelValue":r=>n.value[a.name]=r,class:"input-field mt-1",placeholder:`Default: ${a.default}`},null,8,We)),[[ye,n.value[a.name]]]):a.type==="bool"?(l(),o("div",Xe,[t("button",{onClick:r=>n.value[a.name]=!n.value[a.name],type:"button",class:E([n.value[a.name]?"bg-blue-600":"bg-gray-200 dark:bg-gray-600","relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out"])},[t("span",{class:E([n.value[a.name]?"translate-x-5":"translate-x-0","pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition-colors duration-200 ease-in-out"])},null,2)],10,Ze)])):x("",!0)]))),128))])),y.value.length>0?(l(),o("div",et,[t("button",{type:"button",onClick:te,class:"btn btn-secondary",disabled:k.value},"Reset to Defaults",8,tt)])):x("",!0)])):c.value&&d.value&&!B.value?(l(),o("div",st,[h(xe,{class:"w-5 h-5 flex-shrink-0"}),e[15]||(e[15]=t("span",null,"An administrator has locked the parameters for this model alias. Your personal settings will be ignored.",-1))])):x("",!0),t("div",at,[t("button",{type:"submit",class:"btn btn-primary",disabled:k.value||!L.value},v(k.value?"Saving...":"Save TTS Settings"),9,lt)])],32)])}}},dt=se(ot,[["__scopeId","data-v-a7db96a9"]]);export{dt as default};
