import{ej as Ze,d6 as yn,r as mt,a0 as hn,b as ft,d as lt,h as Q,l as ke,q as Nt,ek as vn,el as bn,V as Sn,e as Et,G as ti,ak as Fe,ad as Dt,a as Cn,ck as wn,ae as xn,s as Pn,c1 as kn,c as Le,em as Rn,C as Ft,cp as Tn,c5 as ei,o as An,z as En,ac as Fn,aa as Mn,W as Gn,w as Nn,j as Oe,de as Ln,g as Rt,cb as ii,al as On,F as Te,m as De,E as Dn,t as Ae,v as Ee,a5 as In,f as Un,y as Bn,x as Vn,n as ni,O as Hn,P as ri,c0 as zn,b$ as qn,a2 as Wn}from"./index-DnjdbnqE.js";var Me={exports:{}},Ut={},Ie={},Ue={},si;function nt(){return si||(si=1,(function(m){Object.defineProperty(m,"__esModule",{value:!0}),m._registerNode=m.Konva=m.glob=void 0;const w=Math.PI/180;function L(){return typeof window<"u"&&({}.toString.call(window)==="[object Window]"||{}.toString.call(window)==="[object global]")}m.glob=typeof Ze<"u"?Ze:typeof window<"u"?window:typeof WorkerGlobalScope<"u"?self:{},m.Konva={_global:m.glob,version:"9.3.22",isBrowser:L(),isUnminified:/param/.test((function(C){}).toString()),dblClickWindow:400,getAngle(C){return m.Konva.angleDeg?C*w:C},enableTrace:!1,pointerEventsEnabled:!0,autoDrawEnabled:!0,hitOnDragEnabled:!1,capturePointerEventsEnabled:!1,_mouseListenClick:!1,_touchListenClick:!1,_pointerListenClick:!1,_mouseInDblClickWindow:!1,_touchInDblClickWindow:!1,_pointerInDblClickWindow:!1,_mouseDblClickPointerId:null,_touchDblClickPointerId:null,_pointerDblClickPointerId:null,_fixTextRendering:!1,pixelRatio:typeof window<"u"&&window.devicePixelRatio||1,dragDistance:3,angleDeg:!0,showWarnings:!0,dragButtons:[0,1],isDragging(){return m.Konva.DD.isDragging},isTransforming(){var C;return(C=m.Konva.Transformer)===null||C===void 0?void 0:C.isTransforming()},isDragReady(){return!!m.Konva.DD.node},releaseCanvasOnDestroy:!0,document:m.glob.document,_injectGlobal(C){m.glob.Konva=C}};const R=C=>{m.Konva[C.prototype.getClassName()]=C};m._registerNode=R,m.Konva._injectGlobal(m.Konva)})(Ue)),Ue}var Be={},ai;function dt(){return ai||(ai=1,(function(m){Object.defineProperty(m,"__esModule",{value:!0}),m.Util=m.Transform=void 0;const w=nt();class L{constructor(s=[1,0,0,1,0,0]){this.dirty=!1,this.m=s&&s.slice()||[1,0,0,1,0,0]}reset(){this.m[0]=1,this.m[1]=0,this.m[2]=0,this.m[3]=1,this.m[4]=0,this.m[5]=0}copy(){return new L(this.m)}copyInto(s){s.m[0]=this.m[0],s.m[1]=this.m[1],s.m[2]=this.m[2],s.m[3]=this.m[3],s.m[4]=this.m[4],s.m[5]=this.m[5]}point(s){const p=this.m;return{x:p[0]*s.x+p[2]*s.y+p[4],y:p[1]*s.x+p[3]*s.y+p[5]}}translate(s,p){return this.m[4]+=this.m[0]*s+this.m[2]*p,this.m[5]+=this.m[1]*s+this.m[3]*p,this}scale(s,p){return this.m[0]*=s,this.m[1]*=s,this.m[2]*=p,this.m[3]*=p,this}rotate(s){const p=Math.cos(s),P=Math.sin(s),G=this.m[0]*p+this.m[2]*P,_=this.m[1]*p+this.m[3]*P,v=this.m[0]*-P+this.m[2]*p,S=this.m[1]*-P+this.m[3]*p;return this.m[0]=G,this.m[1]=_,this.m[2]=v,this.m[3]=S,this}getTranslation(){return{x:this.m[4],y:this.m[5]}}skew(s,p){const P=this.m[0]+this.m[2]*p,G=this.m[1]+this.m[3]*p,_=this.m[2]+this.m[0]*s,v=this.m[3]+this.m[1]*s;return this.m[0]=P,this.m[1]=G,this.m[2]=_,this.m[3]=v,this}multiply(s){const p=this.m[0]*s.m[0]+this.m[2]*s.m[1],P=this.m[1]*s.m[0]+this.m[3]*s.m[1],G=this.m[0]*s.m[2]+this.m[2]*s.m[3],_=this.m[1]*s.m[2]+this.m[3]*s.m[3],v=this.m[0]*s.m[4]+this.m[2]*s.m[5]+this.m[4],S=this.m[1]*s.m[4]+this.m[3]*s.m[5]+this.m[5];return this.m[0]=p,this.m[1]=P,this.m[2]=G,this.m[3]=_,this.m[4]=v,this.m[5]=S,this}invert(){const s=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),p=this.m[3]*s,P=-this.m[1]*s,G=-this.m[2]*s,_=this.m[0]*s,v=s*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),S=s*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);return this.m[0]=p,this.m[1]=P,this.m[2]=G,this.m[3]=_,this.m[4]=v,this.m[5]=S,this}getMatrix(){return this.m}decompose(){const s=this.m[0],p=this.m[1],P=this.m[2],G=this.m[3],_=this.m[4],v=this.m[5],S=s*G-p*P,k={x:_,y:v,rotation:0,scaleX:0,scaleY:0,skewX:0,skewY:0};if(s!=0||p!=0){const F=Math.sqrt(s*s+p*p);k.rotation=p>0?Math.acos(s/F):-Math.acos(s/F),k.scaleX=F,k.scaleY=S/F,k.skewX=(s*P+p*G)/S,k.skewY=0}else if(P!=0||G!=0){const F=Math.sqrt(P*P+G*G);k.rotation=Math.PI/2-(G>0?Math.acos(-P/F):-Math.acos(P/F)),k.scaleX=S/F,k.scaleY=F,k.skewX=0,k.skewY=(s*P+p*G)/S}return k.rotation=m.Util._getRotation(k.rotation),k}}m.Transform=L;const R="[object Array]",C="[object Number]",f="[object String]",h="[object Boolean]",r=Math.PI/180,l=180/Math.PI,o="#",a="",g="0",c="Konva warning: ",i="Konva error: ",n="rgb(",d={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,132,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,255,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,203],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[119,128,144],slategrey:[119,128,144],snow:[255,255,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],transparent:[255,255,255,0],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,5]},y=/rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)/;let b=[];const e=typeof requestAnimationFrame<"u"&&requestAnimationFrame||function(t){setTimeout(t,60)};m.Util={_isElement(t){return!!(t&&t.nodeType==1)},_isFunction(t){return!!(t&&t.constructor&&t.call&&t.apply)},_isPlainObject(t){return!!t&&t.constructor===Object},_isArray(t){return Object.prototype.toString.call(t)===R},_isNumber(t){return Object.prototype.toString.call(t)===C&&!isNaN(t)&&isFinite(t)},_isString(t){return Object.prototype.toString.call(t)===f},_isBoolean(t){return Object.prototype.toString.call(t)===h},isObject(t){return t instanceof Object},isValidSelector(t){if(typeof t!="string")return!1;const s=t[0];return s==="#"||s==="."||s===s.toUpperCase()},_sign(t){return t===0||t>0?1:-1},requestAnimFrame(t){b.push(t),b.length===1&&e(function(){const s=b;b=[],s.forEach(function(p){p()})})},createCanvasElement(){const t=document.createElement("canvas");try{t.style=t.style||{}}catch{}return t},createImageElement(){return document.createElement("img")},_isInDocument(t){for(;t=t.parentNode;)if(t==document)return!0;return!1},_urlToImage(t,s){const p=m.Util.createImageElement();p.onload=function(){s(p)},p.src=t},_rgbToHex(t,s,p){return((1<<24)+(t<<16)+(s<<8)+p).toString(16).slice(1)},_hexToRgb(t){t=t.replace(o,a);const s=parseInt(t,16);return{r:s>>16&255,g:s>>8&255,b:s&255}},getRandomColor(){let t=(Math.random()*16777215<<0).toString(16);for(;t.length<6;)t=g+t;return o+t},getRGB(t){let s;return t in d?(s=d[t],{r:s[0],g:s[1],b:s[2]}):t[0]===o?this._hexToRgb(t.substring(1)):t.substr(0,4)===n?(s=y.exec(t.replace(/ /g,"")),{r:parseInt(s[1],10),g:parseInt(s[2],10),b:parseInt(s[3],10)}):{r:0,g:0,b:0}},colorToRGBA(t){return t=t||"black",m.Util._namedColorToRBA(t)||m.Util._hex3ColorToRGBA(t)||m.Util._hex4ColorToRGBA(t)||m.Util._hex6ColorToRGBA(t)||m.Util._hex8ColorToRGBA(t)||m.Util._rgbColorToRGBA(t)||m.Util._rgbaColorToRGBA(t)||m.Util._hslColorToRGBA(t)},_namedColorToRBA(t){const s=d[t.toLowerCase()];return s?{r:s[0],g:s[1],b:s[2],a:1}:null},_rgbColorToRGBA(t){if(t.indexOf("rgb(")===0){t=t.match(/rgb\(([^)]+)\)/)[1];const s=t.split(/ *, */).map(Number);return{r:s[0],g:s[1],b:s[2],a:1}}},_rgbaColorToRGBA(t){if(t.indexOf("rgba(")===0){t=t.match(/rgba\(([^)]+)\)/)[1];const s=t.split(/ *, */).map((p,P)=>p.slice(-1)==="%"?P===3?parseInt(p)/100:parseInt(p)/100*255:Number(p));return{r:s[0],g:s[1],b:s[2],a:s[3]}}},_hex8ColorToRGBA(t){if(t[0]==="#"&&t.length===9)return{r:parseInt(t.slice(1,3),16),g:parseInt(t.slice(3,5),16),b:parseInt(t.slice(5,7),16),a:parseInt(t.slice(7,9),16)/255}},_hex6ColorToRGBA(t){if(t[0]==="#"&&t.length===7)return{r:parseInt(t.slice(1,3),16),g:parseInt(t.slice(3,5),16),b:parseInt(t.slice(5,7),16),a:1}},_hex4ColorToRGBA(t){if(t[0]==="#"&&t.length===5)return{r:parseInt(t[1]+t[1],16),g:parseInt(t[2]+t[2],16),b:parseInt(t[3]+t[3],16),a:parseInt(t[4]+t[4],16)/255}},_hex3ColorToRGBA(t){if(t[0]==="#"&&t.length===4)return{r:parseInt(t[1]+t[1],16),g:parseInt(t[2]+t[2],16),b:parseInt(t[3]+t[3],16),a:1}},_hslColorToRGBA(t){if(/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.test(t)){const[s,...p]=/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.exec(t),P=Number(p[0])/360,G=Number(p[1])/100,_=Number(p[2])/100;let v,S,k;if(G===0)return k=_*255,{r:Math.round(k),g:Math.round(k),b:Math.round(k),a:1};_<.5?v=_*(1+G):v=_+G-_*G;const F=2*_-v,D=[0,0,0];for(let I=0;I<3;I++)S=P+1/3*-(I-1),S<0&&S++,S>1&&S--,6*S<1?k=F+(v-F)*6*S:2*S<1?k=v:3*S<2?k=F+(v-F)*(2/3-S)*6:k=F,D[I]=k*255;return{r:Math.round(D[0]),g:Math.round(D[1]),b:Math.round(D[2]),a:1}}},haveIntersection(t,s){return!(s.x>t.x+t.width||s.x+s.width<t.x||s.y>t.y+t.height||s.y+s.height<t.y)},cloneObject(t){const s={};for(const p in t)this._isPlainObject(t[p])?s[p]=this.cloneObject(t[p]):this._isArray(t[p])?s[p]=this.cloneArray(t[p]):s[p]=t[p];return s},cloneArray(t){return t.slice(0)},degToRad(t){return t*r},radToDeg(t){return t*l},_degToRad(t){return m.Util.warn("Util._degToRad is removed. Please use public Util.degToRad instead."),m.Util.degToRad(t)},_radToDeg(t){return m.Util.warn("Util._radToDeg is removed. Please use public Util.radToDeg instead."),m.Util.radToDeg(t)},_getRotation(t){return w.Konva.angleDeg?m.Util.radToDeg(t):t},_capitalize(t){return t.charAt(0).toUpperCase()+t.slice(1)},throw(t){throw new Error(i+t)},error(t){console.error(i+t)},warn(t){w.Konva.showWarnings&&console.warn(c+t)},each(t,s){for(const p in t)s(p,t[p])},_inRange(t,s,p){return s<=t&&t<p},_getProjectionToSegment(t,s,p,P,G,_){let v,S,k;const F=(t-p)*(t-p)+(s-P)*(s-P);if(F==0)v=t,S=s,k=(G-p)*(G-p)+(_-P)*(_-P);else{const D=((G-t)*(p-t)+(_-s)*(P-s))/F;D<0?(v=t,S=s,k=(t-G)*(t-G)+(s-_)*(s-_)):D>1?(v=p,S=P,k=(p-G)*(p-G)+(P-_)*(P-_)):(v=t+D*(p-t),S=s+D*(P-s),k=(v-G)*(v-G)+(S-_)*(S-_))}return[v,S,k]},_getProjectionToLine(t,s,p){const P=m.Util.cloneObject(t);let G=Number.MAX_VALUE;return s.forEach(function(_,v){if(!p&&v===s.length-1)return;const S=s[(v+1)%s.length],k=m.Util._getProjectionToSegment(_.x,_.y,S.x,S.y,t.x,t.y),F=k[0],D=k[1],I=k[2];I<G&&(P.x=F,P.y=D,G=I)}),P},_prepareArrayForTween(t,s,p){const P=[],G=[];if(t.length>s.length){const v=s;s=t,t=v}for(let v=0;v<t.length;v+=2)P.push({x:t[v],y:t[v+1]});for(let v=0;v<s.length;v+=2)G.push({x:s[v],y:s[v+1]});const _=[];return G.forEach(function(v){const S=m.Util._getProjectionToLine(v,P,p);_.push(S.x),_.push(S.y)}),_},_prepareToStringify(t){let s;t.visitedByCircularReferenceRemoval=!0;for(const p in t)if(t.hasOwnProperty(p)&&t[p]&&typeof t[p]=="object"){if(s=Object.getOwnPropertyDescriptor(t,p),t[p].visitedByCircularReferenceRemoval||m.Util._isElement(t[p]))if(s.configurable)delete t[p];else return null;else if(m.Util._prepareToStringify(t[p])===null)if(s.configurable)delete t[p];else return null}return delete t.visitedByCircularReferenceRemoval,t},_assign(t,s){for(const p in s)t[p]=s[p];return t},_getFirstPointerId(t){return t.touches?t.changedTouches[0].identifier:t.pointerId||999},releaseCanvas(...t){w.Konva.releaseCanvasOnDestroy&&t.forEach(s=>{s.width=0,s.height=0})},drawRoundedRectPath(t,s,p,P){let G=0,_=0,v=0,S=0;typeof P=="number"?G=_=v=S=Math.min(P,s/2,p/2):(G=Math.min(P[0]||0,s/2,p/2),_=Math.min(P[1]||0,s/2,p/2),S=Math.min(P[2]||0,s/2,p/2),v=Math.min(P[3]||0,s/2,p/2)),t.moveTo(G,0),t.lineTo(s-_,0),t.arc(s-_,_,_,Math.PI*3/2,0,!1),t.lineTo(s,p-S),t.arc(s-S,p-S,S,0,Math.PI/2,!1),t.lineTo(v,p),t.arc(v,p-v,v,Math.PI/2,Math.PI,!1),t.lineTo(0,G),t.arc(G,G,G,Math.PI,Math.PI*3/2,!1)}}})(Be)),Be}var Bt={},Tt={},At={},oi;function cn(){if(oi)return At;oi=1,Object.defineProperty(At,"__esModule",{value:!0}),At.HitContext=At.SceneContext=At.Context=void 0;const m=dt(),w=nt();function L(b){const e=[],t=b.length,s=m.Util;for(let p=0;p<t;p++){let P=b[p];s._isNumber(P)?P=Math.round(P*1e3)/1e3:s._isString(P)||(P=P+""),e.push(P)}return e}const R=",",C="(",f=")",h="([",r="])",l=";",o="()",a="=",g=["arc","arcTo","beginPath","bezierCurveTo","clearRect","clip","closePath","createLinearGradient","createPattern","createRadialGradient","drawImage","ellipse","fill","fillText","getImageData","createImageData","lineTo","moveTo","putImageData","quadraticCurveTo","rect","roundRect","restore","rotate","save","scale","setLineDash","setTransform","stroke","strokeText","transform","translate"],c=["fillStyle","strokeStyle","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY","letterSpacing","lineCap","lineDashOffset","lineJoin","lineWidth","miterLimit","direction","font","textAlign","textBaseline","globalAlpha","globalCompositeOperation","imageSmoothingEnabled"],i=100;let n=class{constructor(e){this.canvas=e,w.Konva.enableTrace&&(this.traceArr=[],this._enableTrace())}fillShape(e){e.fillEnabled()&&this._fill(e)}_fill(e){}strokeShape(e){e.hasStroke()&&this._stroke(e)}_stroke(e){}fillStrokeShape(e){e.attrs.fillAfterStrokeEnabled?(this.strokeShape(e),this.fillShape(e)):(this.fillShape(e),this.strokeShape(e))}getTrace(e,t){let s=this.traceArr,p=s.length,P="",G,_,v,S;for(G=0;G<p;G++)_=s[G],v=_.method,v?(S=_.args,P+=v,e?P+=o:m.Util._isArray(S[0])?P+=h+S.join(R)+r:(t&&(S=S.map(k=>typeof k=="number"?Math.floor(k):k)),P+=C+S.join(R)+f)):(P+=_.property,e||(P+=a+_.val)),P+=l;return P}clearTrace(){this.traceArr=[]}_trace(e){let t=this.traceArr,s;t.push(e),s=t.length,s>=i&&t.shift()}reset(){const e=this.getCanvas().getPixelRatio();this.setTransform(1*e,0,0,1*e,0,0)}getCanvas(){return this.canvas}clear(e){const t=this.getCanvas();e?this.clearRect(e.x||0,e.y||0,e.width||0,e.height||0):this.clearRect(0,0,t.getWidth()/t.pixelRatio,t.getHeight()/t.pixelRatio)}_applyLineCap(e){const t=e.attrs.lineCap;t&&this.setAttr("lineCap",t)}_applyOpacity(e){const t=e.getAbsoluteOpacity();t!==1&&this.setAttr("globalAlpha",t)}_applyLineJoin(e){const t=e.attrs.lineJoin;t&&this.setAttr("lineJoin",t)}setAttr(e,t){this._context[e]=t}arc(e,t,s,p,P,G){this._context.arc(e,t,s,p,P,G)}arcTo(e,t,s,p,P){this._context.arcTo(e,t,s,p,P)}beginPath(){this._context.beginPath()}bezierCurveTo(e,t,s,p,P,G){this._context.bezierCurveTo(e,t,s,p,P,G)}clearRect(e,t,s,p){this._context.clearRect(e,t,s,p)}clip(...e){this._context.clip.apply(this._context,e)}closePath(){this._context.closePath()}createImageData(e,t){const s=arguments;if(s.length===2)return this._context.createImageData(e,t);if(s.length===1)return this._context.createImageData(e)}createLinearGradient(e,t,s,p){return this._context.createLinearGradient(e,t,s,p)}createPattern(e,t){return this._context.createPattern(e,t)}createRadialGradient(e,t,s,p,P,G){return this._context.createRadialGradient(e,t,s,p,P,G)}drawImage(e,t,s,p,P,G,_,v,S){const k=arguments,F=this._context;k.length===3?F.drawImage(e,t,s):k.length===5?F.drawImage(e,t,s,p,P):k.length===9&&F.drawImage(e,t,s,p,P,G,_,v,S)}ellipse(e,t,s,p,P,G,_,v){this._context.ellipse(e,t,s,p,P,G,_,v)}isPointInPath(e,t,s,p){return s?this._context.isPointInPath(s,e,t,p):this._context.isPointInPath(e,t,p)}fill(...e){this._context.fill.apply(this._context,e)}fillRect(e,t,s,p){this._context.fillRect(e,t,s,p)}strokeRect(e,t,s,p){this._context.strokeRect(e,t,s,p)}fillText(e,t,s,p){p?this._context.fillText(e,t,s,p):this._context.fillText(e,t,s)}measureText(e){return this._context.measureText(e)}getImageData(e,t,s,p){return this._context.getImageData(e,t,s,p)}lineTo(e,t){this._context.lineTo(e,t)}moveTo(e,t){this._context.moveTo(e,t)}rect(e,t,s,p){this._context.rect(e,t,s,p)}roundRect(e,t,s,p,P){this._context.roundRect(e,t,s,p,P)}putImageData(e,t,s){this._context.putImageData(e,t,s)}quadraticCurveTo(e,t,s,p){this._context.quadraticCurveTo(e,t,s,p)}restore(){this._context.restore()}rotate(e){this._context.rotate(e)}save(){this._context.save()}scale(e,t){this._context.scale(e,t)}setLineDash(e){this._context.setLineDash?this._context.setLineDash(e):"mozDash"in this._context?this._context.mozDash=e:"webkitLineDash"in this._context&&(this._context.webkitLineDash=e)}getLineDash(){return this._context.getLineDash()}setTransform(e,t,s,p,P,G){this._context.setTransform(e,t,s,p,P,G)}stroke(e){e?this._context.stroke(e):this._context.stroke()}strokeText(e,t,s,p){this._context.strokeText(e,t,s,p)}transform(e,t,s,p,P,G){this._context.transform(e,t,s,p,P,G)}translate(e,t){this._context.translate(e,t)}_enableTrace(){let e=this,t=g.length,s=this.setAttr,p,P;const G=function(_){let v=e[_],S;e[_]=function(){return P=L(Array.prototype.slice.call(arguments,0)),S=v.apply(e,arguments),e._trace({method:_,args:P}),S}};for(p=0;p<t;p++)G(g[p]);e.setAttr=function(){s.apply(e,arguments);const _=arguments[0];let v=arguments[1];(_==="shadowOffsetX"||_==="shadowOffsetY"||_==="shadowBlur")&&(v=v/this.canvas.getPixelRatio()),e._trace({property:_,val:v})}}_applyGlobalCompositeOperation(e){const t=e.attrs.globalCompositeOperation;!t||t==="source-over"||this.setAttr("globalCompositeOperation",t)}};At.Context=n,c.forEach(function(b){Object.defineProperty(n.prototype,b,{get(){return this._context[b]},set(e){this._context[b]=e}})});class d extends n{constructor(e,{willReadFrequently:t=!1}={}){super(e),this._context=e._canvas.getContext("2d",{willReadFrequently:t})}_fillColor(e){const t=e.fill();this.setAttr("fillStyle",t),e._fillFunc(this)}_fillPattern(e){this.setAttr("fillStyle",e._getFillPattern()),e._fillFunc(this)}_fillLinearGradient(e){const t=e._getLinearGradient();t&&(this.setAttr("fillStyle",t),e._fillFunc(this))}_fillRadialGradient(e){const t=e._getRadialGradient();t&&(this.setAttr("fillStyle",t),e._fillFunc(this))}_fill(e){const t=e.fill(),s=e.getFillPriority();if(t&&s==="color"){this._fillColor(e);return}const p=e.getFillPatternImage();if(p&&s==="pattern"){this._fillPattern(e);return}const P=e.getFillLinearGradientColorStops();if(P&&s==="linear-gradient"){this._fillLinearGradient(e);return}const G=e.getFillRadialGradientColorStops();if(G&&s==="radial-gradient"){this._fillRadialGradient(e);return}t?this._fillColor(e):p?this._fillPattern(e):P?this._fillLinearGradient(e):G&&this._fillRadialGradient(e)}_strokeLinearGradient(e){const t=e.getStrokeLinearGradientStartPoint(),s=e.getStrokeLinearGradientEndPoint(),p=e.getStrokeLinearGradientColorStops(),P=this.createLinearGradient(t.x,t.y,s.x,s.y);if(p){for(let G=0;G<p.length;G+=2)P.addColorStop(p[G],p[G+1]);this.setAttr("strokeStyle",P)}}_stroke(e){const t=e.dash(),s=e.getStrokeScaleEnabled();if(e.hasStroke()){if(!s){this.save();const P=this.getCanvas().getPixelRatio();this.setTransform(P,0,0,P,0,0)}this._applyLineCap(e),t&&e.dashEnabled()&&(this.setLineDash(t),this.setAttr("lineDashOffset",e.dashOffset())),this.setAttr("lineWidth",e.strokeWidth()),e.getShadowForStrokeEnabled()||this.setAttr("shadowColor","rgba(0,0,0,0)"),e.getStrokeLinearGradientColorStops()?this._strokeLinearGradient(e):this.setAttr("strokeStyle",e.stroke()),e._strokeFunc(this),s||this.restore()}}_applyShadow(e){var t,s,p;const P=(t=e.getShadowRGBA())!==null&&t!==void 0?t:"black",G=(s=e.getShadowBlur())!==null&&s!==void 0?s:5,_=(p=e.getShadowOffset())!==null&&p!==void 0?p:{x:0,y:0},v=e.getAbsoluteScale(),S=this.canvas.getPixelRatio(),k=v.x*S,F=v.y*S;this.setAttr("shadowColor",P),this.setAttr("shadowBlur",G*Math.min(Math.abs(k),Math.abs(F))),this.setAttr("shadowOffsetX",_.x*k),this.setAttr("shadowOffsetY",_.y*F)}}At.SceneContext=d;class y extends n{constructor(e){super(e),this._context=e._canvas.getContext("2d",{willReadFrequently:!0})}_fill(e){this.save(),this.setAttr("fillStyle",e.colorKey),e._fillFuncHit(this),this.restore()}strokeShape(e){e.hasHitStroke()&&this._stroke(e)}_stroke(e){if(e.hasHitStroke()){const t=e.getStrokeScaleEnabled();if(!t){this.save();const P=this.getCanvas().getPixelRatio();this.setTransform(P,0,0,P,0,0)}this._applyLineCap(e);const s=e.hitStrokeWidth(),p=s==="auto"?e.strokeWidth():s;this.setAttr("lineWidth",p),this.setAttr("strokeStyle",e.colorKey),e._strokeFuncHit(this),t||this.restore()}}}return At.HitContext=y,At}var li;function Ge(){if(li)return Tt;li=1,Object.defineProperty(Tt,"__esModule",{value:!0}),Tt.HitCanvas=Tt.SceneCanvas=Tt.Canvas=void 0;const m=dt(),w=cn(),L=nt();let R;function C(){if(R)return R;const l=m.Util.createCanvasElement(),o=l.getContext("2d");return R=(function(){const a=L.Konva._global.devicePixelRatio||1,g=o.webkitBackingStorePixelRatio||o.mozBackingStorePixelRatio||o.msBackingStorePixelRatio||o.oBackingStorePixelRatio||o.backingStorePixelRatio||1;return a/g})(),m.Util.releaseCanvas(l),R}let f=class{constructor(o){this.pixelRatio=1,this.width=0,this.height=0,this.isCache=!1;const g=(o||{}).pixelRatio||L.Konva.pixelRatio||C();this.pixelRatio=g,this._canvas=m.Util.createCanvasElement(),this._canvas.style.padding="0",this._canvas.style.margin="0",this._canvas.style.border="0",this._canvas.style.background="transparent",this._canvas.style.position="absolute",this._canvas.style.top="0",this._canvas.style.left="0"}getContext(){return this.context}getPixelRatio(){return this.pixelRatio}setPixelRatio(o){const a=this.pixelRatio;this.pixelRatio=o,this.setSize(this.getWidth()/a,this.getHeight()/a)}setWidth(o){this.width=this._canvas.width=o*this.pixelRatio,this._canvas.style.width=o+"px";const a=this.pixelRatio;this.getContext()._context.scale(a,a)}setHeight(o){this.height=this._canvas.height=o*this.pixelRatio,this._canvas.style.height=o+"px";const a=this.pixelRatio;this.getContext()._context.scale(a,a)}getWidth(){return this.width}getHeight(){return this.height}setSize(o,a){this.setWidth(o||0),this.setHeight(a||0)}toDataURL(o,a){try{return this._canvas.toDataURL(o,a)}catch{try{return this._canvas.toDataURL()}catch(c){return m.Util.error("Unable to get data URL. "+c.message+" For more info read https://konvajs.org/docs/posts/Tainted_Canvas.html."),""}}}};Tt.Canvas=f;class h extends f{constructor(o={width:0,height:0,willReadFrequently:!1}){super(o),this.context=new w.SceneContext(this,{willReadFrequently:o.willReadFrequently}),this.setSize(o.width,o.height)}}Tt.SceneCanvas=h;class r extends f{constructor(o={width:0,height:0}){super(o),this.hitCanvas=!0,this.context=new w.HitContext(this),this.setSize(o.width,o.height)}}return Tt.HitCanvas=r,Tt}var Ve={},hi;function Ke(){return hi||(hi=1,(function(m){Object.defineProperty(m,"__esModule",{value:!0}),m.DD=void 0;const w=nt(),L=dt();m.DD={get isDragging(){let R=!1;return m.DD._dragElements.forEach(C=>{C.dragStatus==="dragging"&&(R=!0)}),R},justDragged:!1,get node(){let R;return m.DD._dragElements.forEach(C=>{R=C.node}),R},_dragElements:new Map,_drag(R){const C=[];m.DD._dragElements.forEach((f,h)=>{const{node:r}=f,l=r.getStage();l.setPointersPositions(R),f.pointerId===void 0&&(f.pointerId=L.Util._getFirstPointerId(R));const o=l._changedPointerPositions.find(a=>a.id===f.pointerId);if(o){if(f.dragStatus!=="dragging"){const a=r.dragDistance();if(Math.max(Math.abs(o.x-f.startPointerPos.x),Math.abs(o.y-f.startPointerPos.y))<a||(r.startDrag({evt:R}),!r.isDragging()))return}r._setDragPosition(R,f),C.push(r)}}),C.forEach(f=>{f.fire("dragmove",{type:"dragmove",target:f,evt:R},!0)})},_endDragBefore(R){const C=[];m.DD._dragElements.forEach(f=>{const{node:h}=f,r=h.getStage();if(R&&r.setPointersPositions(R),!r._changedPointerPositions.find(a=>a.id===f.pointerId))return;(f.dragStatus==="dragging"||f.dragStatus==="stopped")&&(m.DD.justDragged=!0,w.Konva._mouseListenClick=!1,w.Konva._touchListenClick=!1,w.Konva._pointerListenClick=!1,f.dragStatus="stopped");const o=f.node.getLayer()||f.node instanceof w.Konva.Stage&&f.node;o&&C.indexOf(o)===-1&&C.push(o)}),C.forEach(f=>{f.draw()})},_endDragAfter(R){m.DD._dragElements.forEach((C,f)=>{C.dragStatus==="stopped"&&C.node.fire("dragend",{type:"dragend",target:C.node,evt:R},!0),C.dragStatus!=="dragging"&&m.DD._dragElements.delete(f)})}},w.Konva.isBrowser&&(window.addEventListener("mouseup",m.DD._endDragBefore,!0),window.addEventListener("touchend",m.DD._endDragBefore,!0),window.addEventListener("touchcancel",m.DD._endDragBefore,!0),window.addEventListener("mousemove",m.DD._drag),window.addEventListener("touchmove",m.DD._drag),window.addEventListener("mouseup",m.DD._endDragAfter,!1),window.addEventListener("touchend",m.DD._endDragAfter,!1),window.addEventListener("touchcancel",m.DD._endDragAfter,!1))})(Ve)),Ve}var He={},wt={},ci;function st(){if(ci)return wt;ci=1,Object.defineProperty(wt,"__esModule",{value:!0}),wt.RGBComponent=R,wt.alphaComponent=C,wt.getNumberValidator=f,wt.getNumberOrArrayOfNumbersValidator=h,wt.getNumberOrAutoValidator=r,wt.getStringValidator=l,wt.getStringOrGradientValidator=o,wt.getFunctionValidator=a,wt.getNumberArrayValidator=g,wt.getBooleanValidator=c,wt.getComponentValidator=i;const m=nt(),w=dt();function L(n){return w.Util._isString(n)?'"'+n+'"':Object.prototype.toString.call(n)==="[object Number]"||w.Util._isBoolean(n)?n:Object.prototype.toString.call(n)}function R(n){return n>255?255:n<0?0:Math.round(n)}function C(n){return n>1?1:n<1e-4?1e-4:n}function f(){if(m.Konva.isUnminified)return function(n,d){return w.Util._isNumber(n)||w.Util.warn(L(n)+' is a not valid value for "'+d+'" attribute. The value should be a number.'),n}}function h(n){if(m.Konva.isUnminified)return function(d,y){let b=w.Util._isNumber(d),e=w.Util._isArray(d)&&d.length==n;return!b&&!e&&w.Util.warn(L(d)+' is a not valid value for "'+y+'" attribute. The value should be a number or Array<number>('+n+")"),d}}function r(){if(m.Konva.isUnminified)return function(n,d){return w.Util._isNumber(n)||n==="auto"||w.Util.warn(L(n)+' is a not valid value for "'+d+'" attribute. The value should be a number or "auto".'),n}}function l(){if(m.Konva.isUnminified)return function(n,d){return w.Util._isString(n)||w.Util.warn(L(n)+' is a not valid value for "'+d+'" attribute. The value should be a string.'),n}}function o(){if(m.Konva.isUnminified)return function(n,d){const y=w.Util._isString(n),b=Object.prototype.toString.call(n)==="[object CanvasGradient]"||n&&n.addColorStop;return y||b||w.Util.warn(L(n)+' is a not valid value for "'+d+'" attribute. The value should be a string or a native gradient.'),n}}function a(){if(m.Konva.isUnminified)return function(n,d){return w.Util._isFunction(n)||w.Util.warn(L(n)+' is a not valid value for "'+d+'" attribute. The value should be a function.'),n}}function g(){if(m.Konva.isUnminified)return function(n,d){const y=Int8Array?Object.getPrototypeOf(Int8Array):null;return y&&n instanceof y||(w.Util._isArray(n)?n.forEach(function(b){w.Util._isNumber(b)||w.Util.warn('"'+d+'" attribute has non numeric element '+b+". Make sure that all elements are numbers.")}):w.Util.warn(L(n)+' is a not valid value for "'+d+'" attribute. The value should be a array of numbers.')),n}}function c(){if(m.Konva.isUnminified)return function(n,d){return n===!0||n===!1||w.Util.warn(L(n)+' is a not valid value for "'+d+'" attribute. The value should be a boolean.'),n}}function i(n){if(m.Konva.isUnminified)return function(d,y){return d==null||w.Util.isObject(d)||w.Util.warn(L(d)+' is a not valid value for "'+y+'" attribute. The value should be an object with properties '+n),d}}return wt}var di;function rt(){return di||(di=1,(function(m){Object.defineProperty(m,"__esModule",{value:!0}),m.Factory=void 0;const w=dt(),L=st(),R="get",C="set";m.Factory={addGetterSetter(f,h,r,l,o){m.Factory.addGetter(f,h,r),m.Factory.addSetter(f,h,l,o),m.Factory.addOverloadedGetterSetter(f,h)},addGetter(f,h,r){const l=R+w.Util._capitalize(h);f.prototype[l]=f.prototype[l]||function(){const o=this.attrs[h];return o===void 0?r:o}},addSetter(f,h,r,l){const o=C+w.Util._capitalize(h);f.prototype[o]||m.Factory.overWriteSetter(f,h,r,l)},overWriteSetter(f,h,r,l){const o=C+w.Util._capitalize(h);f.prototype[o]=function(a){return r&&a!==void 0&&a!==null&&(a=r.call(this,a,h)),this._setAttr(h,a),l&&l.call(this),this}},addComponentsGetterSetter(f,h,r,l,o){const a=r.length,g=w.Util._capitalize,c=R+g(h),i=C+g(h);f.prototype[c]=function(){const d={};for(let y=0;y<a;y++){const b=r[y];d[b]=this.getAttr(h+g(b))}return d};const n=(0,L.getComponentValidator)(r);f.prototype[i]=function(d){const y=this.attrs[h];l&&(d=l.call(this,d,h)),n&&n.call(this,d,h);for(const b in d)d.hasOwnProperty(b)&&this._setAttr(h+g(b),d[b]);return d||r.forEach(b=>{this._setAttr(h+g(b),void 0)}),this._fireChangeEvent(h,y,d),o&&o.call(this),this},m.Factory.addOverloadedGetterSetter(f,h)},addOverloadedGetterSetter(f,h){const r=w.Util._capitalize(h),l=C+r,o=R+r;f.prototype[h]=function(){return arguments.length?(this[l](arguments[0]),this):this[o]()}},addDeprecatedGetterSetter(f,h,r,l){w.Util.error("Adding deprecated "+h);const o=R+w.Util._capitalize(h),a=h+" property is deprecated and will be removed soon. Look at Konva change log for more information.";f.prototype[o]=function(){w.Util.error(a);const g=this.attrs[h];return g===void 0?r:g},m.Factory.addSetter(f,h,l,function(){w.Util.error(a)}),m.Factory.addOverloadedGetterSetter(f,h)},backCompat(f,h){w.Util.each(h,function(r,l){const o=f.prototype[l],a=R+w.Util._capitalize(r),g=C+w.Util._capitalize(r);function c(){o.apply(this,arguments),w.Util.error('"'+r+'" method is deprecated and will be removed soon. Use ""'+l+'" instead.')}f.prototype[r]=c,f.prototype[a]=c,f.prototype[g]=c})},afterSetFilter(){this._filterUpToDate=!1}}})(He)),He}var ui;function gt(){if(ui)return Bt;ui=1,Object.defineProperty(Bt,"__esModule",{value:!0}),Bt.Node=void 0;const m=Ge(),w=Ke(),L=rt(),R=nt(),C=dt(),f=st(),h="absoluteOpacity",r="allEventListeners",l="absoluteTransform",o="absoluteScale",a="canvas",g="Change",c="children",i="konva",n="listening",d="mouseenter",y="mouseleave",b="pointerenter",e="pointerleave",t="touchenter",s="touchleave",p="set",P="Shape",G=" ",_="stage",v="transform",S="Stage",k="visible",F=["xChange.konva","yChange.konva","scaleXChange.konva","scaleYChange.konva","skewXChange.konva","skewYChange.konva","rotationChange.konva","offsetXChange.konva","offsetYChange.konva","transformsEnabledChange.konva"].join(G);let D=1,I=class je{constructor(u){this._id=D++,this.eventListeners={},this.attrs={},this.index=0,this._allEventListeners=null,this.parent=null,this._cache=new Map,this._attachedDepsListeners=new Map,this._lastPos=null,this._batchingTransformChange=!1,this._needClearTransformCache=!1,this._filterUpToDate=!1,this._isUnderCache=!1,this._dragEventId=null,this._shouldFireChangeEvents=!1,this.setAttrs(u),this._shouldFireChangeEvents=!0}hasChildren(){return!1}_clearCache(u){(u===v||u===l)&&this._cache.get(u)?this._cache.get(u).dirty=!0:u?this._cache.delete(u):this._cache.clear()}_getCache(u,x){let E=this._cache.get(u);return(E===void 0||(u===v||u===l)&&E.dirty===!0)&&(E=x.call(this),this._cache.set(u,E)),E}_calculate(u,x,E){if(!this._attachedDepsListeners.get(u)){const T=x.map(M=>M+"Change.konva").join(G);this.on(T,()=>{this._clearCache(u)}),this._attachedDepsListeners.set(u,!0)}return this._getCache(u,E)}_getCanvasCache(){return this._cache.get(a)}_clearSelfAndDescendantCache(u){this._clearCache(u),u===l&&this.fire("absoluteTransformChange")}clearCache(){if(this._cache.has(a)){const{scene:u,filter:x,hit:E,buffer:T}=this._cache.get(a);C.Util.releaseCanvas(u,x,E,T),this._cache.delete(a)}return this._clearSelfAndDescendantCache(),this._requestDraw(),this}cache(u){const x=u||{};let E={};(x.x===void 0||x.y===void 0||x.width===void 0||x.height===void 0)&&(E=this.getClientRect({skipTransform:!0,relativeTo:this.getParent()||void 0}));let T=Math.ceil(x.width||E.width),M=Math.ceil(x.height||E.height),V=x.pixelRatio,O=x.x===void 0?Math.floor(E.x):x.x,H=x.y===void 0?Math.floor(E.y):x.y,j=x.offset||0,B=x.drawBorder||!1,A=x.hitCanvasPixelRatio||1;if(!T||!M){C.Util.error("Can not cache the node. Width or height of the node equals 0. Caching is skipped.");return}const U=Math.abs(Math.round(E.x)-O)>.5?1:0,Y=Math.abs(Math.round(E.y)-H)>.5?1:0;T+=j*2+U,M+=j*2+Y,O-=j,H-=j;const X=new m.SceneCanvas({pixelRatio:V,width:T,height:M}),$=new m.SceneCanvas({pixelRatio:V,width:0,height:0,willReadFrequently:!0}),tt=new m.HitCanvas({pixelRatio:A,width:T,height:M}),it=X.getContext(),at=tt.getContext(),et=new m.SceneCanvas({width:X.width/X.pixelRatio+Math.abs(O),height:X.height/X.pixelRatio+Math.abs(H),pixelRatio:X.pixelRatio}),pt=et.getContext();return tt.isCache=!0,X.isCache=!0,this._cache.delete(a),this._filterUpToDate=!1,x.imageSmoothingEnabled===!1&&(X.getContext()._context.imageSmoothingEnabled=!1,$.getContext()._context.imageSmoothingEnabled=!1),it.save(),at.save(),pt.save(),it.translate(-O,-H),at.translate(-O,-H),pt.translate(-O,-H),et.x=O,et.y=H,this._isUnderCache=!0,this._clearSelfAndDescendantCache(h),this._clearSelfAndDescendantCache(o),this.drawScene(X,this,et),this.drawHit(tt,this),this._isUnderCache=!1,it.restore(),at.restore(),B&&(it.save(),it.beginPath(),it.rect(0,0,T,M),it.closePath(),it.setAttr("strokeStyle","red"),it.setAttr("lineWidth",5),it.stroke(),it.restore()),this._cache.set(a,{scene:X,filter:$,hit:tt,buffer:et,x:O,y:H}),this._requestDraw(),this}isCached(){return this._cache.has(a)}getClientRect(u){throw new Error('abstract "getClientRect" method call')}_transformedRect(u,x){const E=[{x:u.x,y:u.y},{x:u.x+u.width,y:u.y},{x:u.x+u.width,y:u.y+u.height},{x:u.x,y:u.y+u.height}];let T=1/0,M=1/0,V=-1/0,O=-1/0;const H=this.getAbsoluteTransform(x);return E.forEach(function(j){const B=H.point(j);T===void 0&&(T=V=B.x,M=O=B.y),T=Math.min(T,B.x),M=Math.min(M,B.y),V=Math.max(V,B.x),O=Math.max(O,B.y)}),{x:T,y:M,width:V-T,height:O-M}}_drawCachedSceneCanvas(u){u.save(),u._applyOpacity(this),u._applyGlobalCompositeOperation(this);const x=this._getCanvasCache();u.translate(x.x,x.y);const E=this._getCachedSceneCanvas(),T=E.pixelRatio;u.drawImage(E._canvas,0,0,E.width/T,E.height/T),u.restore()}_drawCachedHitCanvas(u){const x=this._getCanvasCache(),E=x.hit;u.save(),u.translate(x.x,x.y),u.drawImage(E._canvas,0,0,E.width/E.pixelRatio,E.height/E.pixelRatio),u.restore()}_getCachedSceneCanvas(){let u=this.filters(),x=this._getCanvasCache(),E=x.scene,T=x.filter,M=T.getContext(),V,O,H,j;if(u){if(!this._filterUpToDate){const B=E.pixelRatio;T.setSize(E.width/E.pixelRatio,E.height/E.pixelRatio);try{for(V=u.length,M.clear(),M.drawImage(E._canvas,0,0,E.getWidth()/B,E.getHeight()/B),O=M.getImageData(0,0,T.getWidth(),T.getHeight()),H=0;H<V;H++){if(j=u[H],typeof j!="function"){C.Util.error("Filter should be type of function, but got "+typeof j+" instead. Please check correct filters");continue}j.call(this,O),M.putImageData(O,0,0)}}catch(A){C.Util.error("Unable to apply filter. "+A.message+" This post my help you https://konvajs.org/docs/posts/Tainted_Canvas.html.")}this._filterUpToDate=!0}return T}return E}on(u,x){if(this._cache&&this._cache.delete(r),arguments.length===3)return this._delegate.apply(this,arguments);const E=u.split(G);for(let T=0;T<E.length;T++){const V=E[T].split("."),O=V[0],H=V[1]||"";this.eventListeners[O]||(this.eventListeners[O]=[]),this.eventListeners[O].push({name:H,handler:x})}return this}off(u,x){let E=(u||"").split(G),T=E.length,M,V,O,H,j,B;if(this._cache&&this._cache.delete(r),!u)for(V in this.eventListeners)this._off(V);for(M=0;M<T;M++)if(O=E[M],H=O.split("."),j=H[0],B=H[1],j)this.eventListeners[j]&&this._off(j,B,x);else for(V in this.eventListeners)this._off(V,B,x);return this}dispatchEvent(u){const x={target:this,type:u.type,evt:u};return this.fire(u.type,x),this}addEventListener(u,x){return this.on(u,function(E){x.call(this,E.evt)}),this}removeEventListener(u){return this.off(u),this}_delegate(u,x,E){const T=this;this.on(u,function(M){const V=M.target.findAncestors(x,!0,T);for(let O=0;O<V.length;O++)M=C.Util.cloneObject(M),M.currentTarget=V[O],E.call(V[O],M)})}remove(){return this.isDragging()&&this.stopDrag(),w.DD._dragElements.delete(this._id),this._remove(),this}_clearCaches(){this._clearSelfAndDescendantCache(l),this._clearSelfAndDescendantCache(h),this._clearSelfAndDescendantCache(o),this._clearSelfAndDescendantCache(_),this._clearSelfAndDescendantCache(k),this._clearSelfAndDescendantCache(n)}_remove(){this._clearCaches();const u=this.getParent();u&&u.children&&(u.children.splice(this.index,1),u._setChildrenIndices(),this.parent=null)}destroy(){return this.remove(),this.clearCache(),this}getAttr(u){const x="get"+C.Util._capitalize(u);return C.Util._isFunction(this[x])?this[x]():this.attrs[u]}getAncestors(){let u=this.getParent(),x=[];for(;u;)x.push(u),u=u.getParent();return x}getAttrs(){return this.attrs||{}}setAttrs(u){return this._batchTransformChanges(()=>{let x,E;if(!u)return this;for(x in u)x!==c&&(E=p+C.Util._capitalize(x),C.Util._isFunction(this[E])?this[E](u[x]):this._setAttr(x,u[x]))}),this}isListening(){return this._getCache(n,this._isListening)}_isListening(u){if(!this.listening())return!1;const E=this.getParent();return E&&E!==u&&this!==u?E._isListening(u):!0}isVisible(){return this._getCache(k,this._isVisible)}_isVisible(u){if(!this.visible())return!1;const E=this.getParent();return E&&E!==u&&this!==u?E._isVisible(u):!0}shouldDrawHit(u,x=!1){if(u)return this._isVisible(u)&&this._isListening(u);const E=this.getLayer();let T=!1;w.DD._dragElements.forEach(V=>{V.dragStatus==="dragging"&&(V.node.nodeType==="Stage"||V.node.getLayer()===E)&&(T=!0)});const M=!x&&!R.Konva.hitOnDragEnabled&&(T||R.Konva.isTransforming());return this.isListening()&&this.isVisible()&&!M}show(){return this.visible(!0),this}hide(){return this.visible(!1),this}getZIndex(){return this.index||0}getAbsoluteZIndex(){let u=this.getDepth(),x=this,E=0,T,M,V,O;function H(B){for(T=[],M=B.length,V=0;V<M;V++)O=B[V],E++,O.nodeType!==P&&(T=T.concat(O.getChildren().slice())),O._id===x._id&&(V=M);T.length>0&&T[0].getDepth()<=u&&H(T)}const j=this.getStage();return x.nodeType!==S&&j&&H(j.getChildren()),E}getDepth(){let u=0,x=this.parent;for(;x;)u++,x=x.parent;return u}_batchTransformChanges(u){this._batchingTransformChange=!0,u(),this._batchingTransformChange=!1,this._needClearTransformCache&&(this._clearCache(v),this._clearSelfAndDescendantCache(l)),this._needClearTransformCache=!1}setPosition(u){return this._batchTransformChanges(()=>{this.x(u.x),this.y(u.y)}),this}getPosition(){return{x:this.x(),y:this.y()}}getRelativePointerPosition(){const u=this.getStage();if(!u)return null;const x=u.getPointerPosition();if(!x)return null;const E=this.getAbsoluteTransform().copy();return E.invert(),E.point(x)}getAbsolutePosition(u){let x=!1,E=this.parent;for(;E;){if(E.isCached()){x=!0;break}E=E.parent}x&&!u&&(u=!0);const T=this.getAbsoluteTransform(u).getMatrix(),M=new C.Transform,V=this.offset();return M.m=T.slice(),M.translate(V.x,V.y),M.getTranslation()}setAbsolutePosition(u){const{x,y:E,...T}=this._clearTransform();this.attrs.x=x,this.attrs.y=E,this._clearCache(v);const M=this._getAbsoluteTransform().copy();return M.invert(),M.translate(u.x,u.y),u={x:this.attrs.x+M.getTranslation().x,y:this.attrs.y+M.getTranslation().y},this._setTransform(T),this.setPosition({x:u.x,y:u.y}),this._clearCache(v),this._clearSelfAndDescendantCache(l),this}_setTransform(u){let x;for(x in u)this.attrs[x]=u[x]}_clearTransform(){const u={x:this.x(),y:this.y(),rotation:this.rotation(),scaleX:this.scaleX(),scaleY:this.scaleY(),offsetX:this.offsetX(),offsetY:this.offsetY(),skewX:this.skewX(),skewY:this.skewY()};return this.attrs.x=0,this.attrs.y=0,this.attrs.rotation=0,this.attrs.scaleX=1,this.attrs.scaleY=1,this.attrs.offsetX=0,this.attrs.offsetY=0,this.attrs.skewX=0,this.attrs.skewY=0,u}move(u){let x=u.x,E=u.y,T=this.x(),M=this.y();return x!==void 0&&(T+=x),E!==void 0&&(M+=E),this.setPosition({x:T,y:M}),this}_eachAncestorReverse(u,x){let E=[],T=this.getParent(),M,V;if(!(x&&x._id===this._id)){for(E.unshift(this);T&&(!x||T._id!==x._id);)E.unshift(T),T=T.parent;for(M=E.length,V=0;V<M;V++)u(E[V])}}rotate(u){return this.rotation(this.rotation()+u),this}moveToTop(){if(!this.parent)return C.Util.warn("Node has no parent. moveToTop function is ignored."),!1;const u=this.index,x=this.parent.getChildren().length;return u<x-1?(this.parent.children.splice(u,1),this.parent.children.push(this),this.parent._setChildrenIndices(),!0):!1}moveUp(){if(!this.parent)return C.Util.warn("Node has no parent. moveUp function is ignored."),!1;const u=this.index,x=this.parent.getChildren().length;return u<x-1?(this.parent.children.splice(u,1),this.parent.children.splice(u+1,0,this),this.parent._setChildrenIndices(),!0):!1}moveDown(){if(!this.parent)return C.Util.warn("Node has no parent. moveDown function is ignored."),!1;const u=this.index;return u>0?(this.parent.children.splice(u,1),this.parent.children.splice(u-1,0,this),this.parent._setChildrenIndices(),!0):!1}moveToBottom(){if(!this.parent)return C.Util.warn("Node has no parent. moveToBottom function is ignored."),!1;const u=this.index;return u>0?(this.parent.children.splice(u,1),this.parent.children.unshift(this),this.parent._setChildrenIndices(),!0):!1}setZIndex(u){if(!this.parent)return C.Util.warn("Node has no parent. zIndex parameter is ignored."),this;(u<0||u>=this.parent.children.length)&&C.Util.warn("Unexpected value "+u+" for zIndex property. zIndex is just index of a node in children of its parent. Expected value is from 0 to "+(this.parent.children.length-1)+".");const x=this.index;return this.parent.children.splice(x,1),this.parent.children.splice(u,0,this),this.parent._setChildrenIndices(),this}getAbsoluteOpacity(){return this._getCache(h,this._getAbsoluteOpacity)}_getAbsoluteOpacity(){let u=this.opacity();const x=this.getParent();return x&&!x._isUnderCache&&(u*=x.getAbsoluteOpacity()),u}moveTo(u){return this.getParent()!==u&&(this._remove(),u.add(this)),this}toObject(){let u=this.getAttrs(),x,E,T,M,V;const O={attrs:{},className:this.getClassName()};for(x in u)E=u[x],V=C.Util.isObject(E)&&!C.Util._isPlainObject(E)&&!C.Util._isArray(E),!V&&(T=typeof this[x]=="function"&&this[x],delete u[x],M=T?T.call(this):null,u[x]=E,M!==E&&(O.attrs[x]=E));return C.Util._prepareToStringify(O)}toJSON(){return JSON.stringify(this.toObject())}getParent(){return this.parent}findAncestors(u,x,E){const T=[];x&&this._isMatch(u)&&T.push(this);let M=this.parent;for(;M;){if(M===E)return T;M._isMatch(u)&&T.push(M),M=M.parent}return T}isAncestorOf(u){return!1}findAncestor(u,x,E){return this.findAncestors(u,x,E)[0]}_isMatch(u){if(!u)return!1;if(typeof u=="function")return u(this);let x=u.replace(/ /g,"").split(","),E=x.length,T,M;for(T=0;T<E;T++)if(M=x[T],C.Util.isValidSelector(M)||(C.Util.warn('Selector "'+M+'" is invalid. Allowed selectors examples are "#foo", ".bar" or "Group".'),C.Util.warn('If you have a custom shape with such className, please change it to start with upper letter like "Triangle".'),C.Util.warn("Konva is awesome, right?")),M.charAt(0)==="#"){if(this.id()===M.slice(1))return!0}else if(M.charAt(0)==="."){if(this.hasName(M.slice(1)))return!0}else if(this.className===M||this.nodeType===M)return!0;return!1}getLayer(){const u=this.getParent();return u?u.getLayer():null}getStage(){return this._getCache(_,this._getStage)}_getStage(){const u=this.getParent();return u?u.getStage():null}fire(u,x={},E){return x.target=x.target||this,E?this._fireAndBubble(u,x):this._fire(u,x),this}getAbsoluteTransform(u){return u?this._getAbsoluteTransform(u):this._getCache(l,this._getAbsoluteTransform)}_getAbsoluteTransform(u){let x;if(u)return x=new C.Transform,this._eachAncestorReverse(function(E){const T=E.transformsEnabled();T==="all"?x.multiply(E.getTransform()):T==="position"&&x.translate(E.x()-E.offsetX(),E.y()-E.offsetY())},u),x;{x=this._cache.get(l)||new C.Transform,this.parent?this.parent.getAbsoluteTransform().copyInto(x):x.reset();const E=this.transformsEnabled();if(E==="all")x.multiply(this.getTransform());else if(E==="position"){const T=this.attrs.x||0,M=this.attrs.y||0,V=this.attrs.offsetX||0,O=this.attrs.offsetY||0;x.translate(T-V,M-O)}return x.dirty=!1,x}}getAbsoluteScale(u){let x=this;for(;x;)x._isUnderCache&&(u=x),x=x.getParent();const T=this.getAbsoluteTransform(u).decompose();return{x:T.scaleX,y:T.scaleY}}getAbsoluteRotation(){return this.getAbsoluteTransform().decompose().rotation}getTransform(){return this._getCache(v,this._getTransform)}_getTransform(){var u,x;const E=this._cache.get(v)||new C.Transform;E.reset();const T=this.x(),M=this.y(),V=R.Konva.getAngle(this.rotation()),O=(u=this.attrs.scaleX)!==null&&u!==void 0?u:1,H=(x=this.attrs.scaleY)!==null&&x!==void 0?x:1,j=this.attrs.skewX||0,B=this.attrs.skewY||0,A=this.attrs.offsetX||0,U=this.attrs.offsetY||0;return(T!==0||M!==0)&&E.translate(T,M),V!==0&&E.rotate(V),(j!==0||B!==0)&&E.skew(j,B),(O!==1||H!==1)&&E.scale(O,H),(A!==0||U!==0)&&E.translate(-1*A,-1*U),E.dirty=!1,E}clone(u){let x=C.Util.cloneObject(this.attrs),E,T,M,V,O;for(E in u)x[E]=u[E];const H=new this.constructor(x);for(E in this.eventListeners)for(T=this.eventListeners[E],M=T.length,V=0;V<M;V++)O=T[V],O.name.indexOf(i)<0&&(H.eventListeners[E]||(H.eventListeners[E]=[]),H.eventListeners[E].push(O));return H}_toKonvaCanvas(u){u=u||{};const x=this.getClientRect(),E=this.getStage(),T=u.x!==void 0?u.x:Math.floor(x.x),M=u.y!==void 0?u.y:Math.floor(x.y),V=u.pixelRatio||1,O=new m.SceneCanvas({width:u.width||Math.ceil(x.width)||(E?E.width():0),height:u.height||Math.ceil(x.height)||(E?E.height():0),pixelRatio:V}),H=O.getContext(),j=new m.SceneCanvas({width:O.width/O.pixelRatio+Math.abs(T),height:O.height/O.pixelRatio+Math.abs(M),pixelRatio:O.pixelRatio});return u.imageSmoothingEnabled===!1&&(H._context.imageSmoothingEnabled=!1),H.save(),(T||M)&&H.translate(-1*T,-1*M),this.drawScene(O,void 0,j),H.restore(),O}toCanvas(u){return this._toKonvaCanvas(u)._canvas}toDataURL(u){u=u||{};const x=u.mimeType||null,E=u.quality||null,T=this._toKonvaCanvas(u).toDataURL(x,E);return u.callback&&u.callback(T),T}toImage(u){return new Promise((x,E)=>{try{const T=u==null?void 0:u.callback;T&&delete u.callback,C.Util._urlToImage(this.toDataURL(u),function(M){x(M),T==null||T(M)})}catch(T){E(T)}})}toBlob(u){return new Promise((x,E)=>{try{const T=u==null?void 0:u.callback;T&&delete u.callback,this.toCanvas(u).toBlob(M=>{x(M),T==null||T(M)},u==null?void 0:u.mimeType,u==null?void 0:u.quality)}catch(T){E(T)}})}setSize(u){return this.width(u.width),this.height(u.height),this}getSize(){return{width:this.width(),height:this.height()}}getClassName(){return this.className||this.nodeType}getType(){return this.nodeType}getDragDistance(){return this.attrs.dragDistance!==void 0?this.attrs.dragDistance:this.parent?this.parent.getDragDistance():R.Konva.dragDistance}_off(u,x,E){let T=this.eventListeners[u],M,V,O;for(M=0;M<T.length;M++)if(V=T[M].name,O=T[M].handler,(V!=="konva"||x==="konva")&&(!x||V===x)&&(!E||E===O)){if(T.splice(M,1),T.length===0){delete this.eventListeners[u];break}M--}}_fireChangeEvent(u,x,E){this._fire(u+g,{oldVal:x,newVal:E})}addName(u){if(!this.hasName(u)){const x=this.name(),E=x?x+" "+u:u;this.name(E)}return this}hasName(u){if(!u)return!1;const x=this.name();return x?(x||"").split(/\s/g).indexOf(u)!==-1:!1}removeName(u){const x=(this.name()||"").split(/\s/g),E=x.indexOf(u);return E!==-1&&(x.splice(E,1),this.name(x.join(" "))),this}setAttr(u,x){const E=this[p+C.Util._capitalize(u)];return C.Util._isFunction(E)?E.call(this,x):this._setAttr(u,x),this}_requestDraw(){if(R.Konva.autoDrawEnabled){const u=this.getLayer()||this.getStage();u==null||u.batchDraw()}}_setAttr(u,x){const E=this.attrs[u];E===x&&!C.Util.isObject(x)||(x==null?delete this.attrs[u]:this.attrs[u]=x,this._shouldFireChangeEvents&&this._fireChangeEvent(u,E,x),this._requestDraw())}_setComponentAttr(u,x,E){let T;E!==void 0&&(T=this.attrs[u],T||(this.attrs[u]=this.getAttr(u)),this.attrs[u][x]=E,this._fireChangeEvent(u,T,E))}_fireAndBubble(u,x,E){x&&this.nodeType===P&&(x.target=this);const T=[d,y,b,e,t,s];if(!(T.indexOf(u)!==-1&&(E&&(this===E||this.isAncestorOf&&this.isAncestorOf(E))||this.nodeType==="Stage"&&!E))){this._fire(u,x);const V=T.indexOf(u)!==-1&&E&&E.isAncestorOf&&E.isAncestorOf(this)&&!E.isAncestorOf(this.parent);(x&&!x.cancelBubble||!x)&&this.parent&&this.parent.isListening()&&!V&&(E&&E.parent?this._fireAndBubble.call(this.parent,u,x,E):this._fireAndBubble.call(this.parent,u,x))}}_getProtoListeners(u){var x,E,T;const M=(x=this._cache.get(r))!==null&&x!==void 0?x:{};let V=M==null?void 0:M[u];if(V===void 0){V=[];let O=Object.getPrototypeOf(this);for(;O;){const H=(T=(E=O.eventListeners)===null||E===void 0?void 0:E[u])!==null&&T!==void 0?T:[];V.push(...H),O=Object.getPrototypeOf(O)}M[u]=V,this._cache.set(r,M)}return V}_fire(u,x){x=x||{},x.currentTarget=this,x.type=u;const E=this._getProtoListeners(u);if(E)for(let M=0;M<E.length;M++)E[M].handler.call(this,x);const T=this.eventListeners[u];if(T)for(let M=0;M<T.length;M++)T[M].handler.call(this,x)}draw(){return this.drawScene(),this.drawHit(),this}_createDragElement(u){const x=u?u.pointerId:void 0,E=this.getStage(),T=this.getAbsolutePosition();if(!E)return;const M=E._getPointerById(x)||E._changedPointerPositions[0]||T;w.DD._dragElements.set(this._id,{node:this,startPointerPos:M,offset:{x:M.x-T.x,y:M.y-T.y},dragStatus:"ready",pointerId:x})}startDrag(u,x=!0){w.DD._dragElements.has(this._id)||this._createDragElement(u);const E=w.DD._dragElements.get(this._id);E.dragStatus="dragging",this.fire("dragstart",{type:"dragstart",target:this,evt:u&&u.evt},x)}_setDragPosition(u,x){const E=this.getStage()._getPointerById(x.pointerId);if(!E)return;let T={x:E.x-x.offset.x,y:E.y-x.offset.y};const M=this.dragBoundFunc();if(M!==void 0){const V=M.call(this,T,u);V?T=V:C.Util.warn("dragBoundFunc did not return any value. That is unexpected behavior. You must return new absolute position from dragBoundFunc.")}(!this._lastPos||this._lastPos.x!==T.x||this._lastPos.y!==T.y)&&(this.setAbsolutePosition(T),this._requestDraw()),this._lastPos=T}stopDrag(u){const x=w.DD._dragElements.get(this._id);x&&(x.dragStatus="stopped"),w.DD._endDragBefore(u),w.DD._endDragAfter(u)}setDraggable(u){this._setAttr("draggable",u),this._dragChange()}isDragging(){const u=w.DD._dragElements.get(this._id);return u?u.dragStatus==="dragging":!1}_listenDrag(){this._dragCleanup(),this.on("mousedown.konva touchstart.konva",function(u){if(!(!(u.evt.button!==void 0)||R.Konva.dragButtons.indexOf(u.evt.button)>=0)||this.isDragging())return;let T=!1;w.DD._dragElements.forEach(M=>{this.isAncestorOf(M.node)&&(T=!0)}),T||this._createDragElement(u)})}_dragChange(){if(this.attrs.draggable)this._listenDrag();else{if(this._dragCleanup(),!this.getStage())return;const x=w.DD._dragElements.get(this._id),E=x&&x.dragStatus==="dragging",T=x&&x.dragStatus==="ready";E?this.stopDrag():T&&w.DD._dragElements.delete(this._id)}}_dragCleanup(){this.off("mousedown.konva"),this.off("touchstart.konva")}isClientRectOnScreen(u={x:0,y:0}){const x=this.getStage();if(!x)return!1;const E={x:-u.x,y:-u.y,width:x.width()+2*u.x,height:x.height()+2*u.y};return C.Util.haveIntersection(E,this.getClientRect())}static create(u,x){return C.Util._isString(u)&&(u=JSON.parse(u)),this._createNode(u,x)}static _createNode(u,x){let E=je.prototype.getClassName.call(u),T=u.children,M,V,O;x&&(u.attrs.container=x),R.Konva[E]||(C.Util.warn('Can not find a node with class name "'+E+'". Fallback to "Shape".'),E="Shape");const H=R.Konva[E];if(M=new H(u.attrs),T)for(V=T.length,O=0;O<V;O++)M.add(je._createNode(T[O]));return M}};Bt.Node=I,I.prototype.nodeType="Node",I.prototype._attrsAffectingSize=[],I.prototype.eventListeners={},I.prototype.on.call(I.prototype,F,function(){if(this._batchingTransformChange){this._needClearTransformCache=!0;return}this._clearCache(v),this._clearSelfAndDescendantCache(l)}),I.prototype.on.call(I.prototype,"visibleChange.konva",function(){this._clearSelfAndDescendantCache(k)}),I.prototype.on.call(I.prototype,"listeningChange.konva",function(){this._clearSelfAndDescendantCache(n)}),I.prototype.on.call(I.prototype,"opacityChange.konva",function(){this._clearSelfAndDescendantCache(h)});const N=L.Factory.addGetterSetter;return N(I,"zIndex"),N(I,"absolutePosition"),N(I,"position"),N(I,"x",0,(0,f.getNumberValidator)()),N(I,"y",0,(0,f.getNumberValidator)()),N(I,"globalCompositeOperation","source-over",(0,f.getStringValidator)()),N(I,"opacity",1,(0,f.getNumberValidator)()),N(I,"name","",(0,f.getStringValidator)()),N(I,"id","",(0,f.getStringValidator)()),N(I,"rotation",0,(0,f.getNumberValidator)()),L.Factory.addComponentsGetterSetter(I,"scale",["x","y"]),N(I,"scaleX",1,(0,f.getNumberValidator)()),N(I,"scaleY",1,(0,f.getNumberValidator)()),L.Factory.addComponentsGetterSetter(I,"skew",["x","y"]),N(I,"skewX",0,(0,f.getNumberValidator)()),N(I,"skewY",0,(0,f.getNumberValidator)()),L.Factory.addComponentsGetterSetter(I,"offset",["x","y"]),N(I,"offsetX",0,(0,f.getNumberValidator)()),N(I,"offsetY",0,(0,f.getNumberValidator)()),N(I,"dragDistance",void 0,(0,f.getNumberValidator)()),N(I,"width",0,(0,f.getNumberValidator)()),N(I,"height",0,(0,f.getNumberValidator)()),N(I,"listening",!0,(0,f.getBooleanValidator)()),N(I,"preventDefault",!0,(0,f.getBooleanValidator)()),N(I,"filters",void 0,function(W){return this._filterUpToDate=!1,W}),N(I,"visible",!0,(0,f.getBooleanValidator)()),N(I,"transformsEnabled","all",(0,f.getStringValidator)()),N(I,"size"),N(I,"dragBoundFunc"),N(I,"draggable",!1,(0,f.getBooleanValidator)()),L.Factory.backCompat(I,{rotateDeg:"rotate",setRotationDeg:"setRotation",getRotationDeg:"getRotation"}),Bt}var Vt={},fi;function Ne(){if(fi)return Vt;fi=1,Object.defineProperty(Vt,"__esModule",{value:!0}),Vt.Container=void 0;const m=rt(),w=gt(),L=st();let R=class extends w.Node{constructor(){super(...arguments),this.children=[]}getChildren(f){const h=this.children||[];return f?h.filter(f):h}hasChildren(){return this.getChildren().length>0}removeChildren(){return this.getChildren().forEach(f=>{f.parent=null,f.index=0,f.remove()}),this.children=[],this._requestDraw(),this}destroyChildren(){return this.getChildren().forEach(f=>{f.parent=null,f.index=0,f.destroy()}),this.children=[],this._requestDraw(),this}add(...f){if(f.length===0)return this;if(f.length>1){for(let r=0;r<f.length;r++)this.add(f[r]);return this}const h=f[0];return h.getParent()?(h.moveTo(this),this):(this._validateAdd(h),h.index=this.getChildren().length,h.parent=this,h._clearCaches(),this.getChildren().push(h),this._fire("add",{child:h}),this._requestDraw(),this)}destroy(){return this.hasChildren()&&this.destroyChildren(),super.destroy(),this}find(f){return this._generalFind(f,!1)}findOne(f){const h=this._generalFind(f,!0);return h.length>0?h[0]:void 0}_generalFind(f,h){const r=[];return this._descendants(l=>{const o=l._isMatch(f);return o&&r.push(l),!!(o&&h)}),r}_descendants(f){let h=!1;const r=this.getChildren();for(const l of r){if(h=f(l),h)return!0;if(l.hasChildren()&&(h=l._descendants(f),h))return!0}return!1}toObject(){const f=w.Node.prototype.toObject.call(this);return f.children=[],this.getChildren().forEach(h=>{f.children.push(h.toObject())}),f}isAncestorOf(f){let h=f.getParent();for(;h;){if(h._id===this._id)return!0;h=h.getParent()}return!1}clone(f){const h=w.Node.prototype.clone.call(this,f);return this.getChildren().forEach(function(r){h.add(r.clone())}),h}getAllIntersections(f){const h=[];return this.find("Shape").forEach(r=>{r.isVisible()&&r.intersects(f)&&h.push(r)}),h}_clearSelfAndDescendantCache(f){var h;super._clearSelfAndDescendantCache(f),!this.isCached()&&((h=this.children)===null||h===void 0||h.forEach(function(r){r._clearSelfAndDescendantCache(f)}))}_setChildrenIndices(){var f;(f=this.children)===null||f===void 0||f.forEach(function(h,r){h.index=r}),this._requestDraw()}drawScene(f,h,r){const l=this.getLayer(),o=f||l&&l.getCanvas(),a=o&&o.getContext(),g=this._getCanvasCache(),c=g&&g.scene,i=o&&o.isCache;if(!this.isVisible()&&!i)return this;if(c){a.save();const n=this.getAbsoluteTransform(h).getMatrix();a.transform(n[0],n[1],n[2],n[3],n[4],n[5]),this._drawCachedSceneCanvas(a),a.restore()}else this._drawChildren("drawScene",o,h,r);return this}drawHit(f,h){if(!this.shouldDrawHit(h))return this;const r=this.getLayer(),l=f||r&&r.hitCanvas,o=l&&l.getContext(),a=this._getCanvasCache();if(a&&a.hit){o.save();const c=this.getAbsoluteTransform(h).getMatrix();o.transform(c[0],c[1],c[2],c[3],c[4],c[5]),this._drawCachedHitCanvas(o),o.restore()}else this._drawChildren("drawHit",l,h);return this}_drawChildren(f,h,r,l){var o;const a=h&&h.getContext(),g=this.clipWidth(),c=this.clipHeight(),i=this.clipFunc(),n=typeof g=="number"&&typeof c=="number"||i,d=r===this;if(n){a.save();const b=this.getAbsoluteTransform(r);let e=b.getMatrix();a.transform(e[0],e[1],e[2],e[3],e[4],e[5]),a.beginPath();let t;if(i)t=i.call(this,a,this);else{const s=this.clipX(),p=this.clipY();a.rect(s||0,p||0,g,c)}a.clip.apply(a,t),e=b.copy().invert().getMatrix(),a.transform(e[0],e[1],e[2],e[3],e[4],e[5])}const y=!d&&this.globalCompositeOperation()!=="source-over"&&f==="drawScene";y&&(a.save(),a._applyGlobalCompositeOperation(this)),(o=this.children)===null||o===void 0||o.forEach(function(b){b[f](h,r,l)}),y&&a.restore(),n&&a.restore()}getClientRect(f={}){var h;const r=f.skipTransform,l=f.relativeTo;let o,a,g,c,i={x:1/0,y:1/0,width:0,height:0};const n=this;(h=this.children)===null||h===void 0||h.forEach(function(b){if(!b.visible())return;const e=b.getClientRect({relativeTo:n,skipShadow:f.skipShadow,skipStroke:f.skipStroke});e.width===0&&e.height===0||(o===void 0?(o=e.x,a=e.y,g=e.x+e.width,c=e.y+e.height):(o=Math.min(o,e.x),a=Math.min(a,e.y),g=Math.max(g,e.x+e.width),c=Math.max(c,e.y+e.height)))});const d=this.find("Shape");let y=!1;for(let b=0;b<d.length;b++)if(d[b]._isVisible(this)){y=!0;break}return y&&o!==void 0?i={x:o,y:a,width:g-o,height:c-a}:i={x:0,y:0,width:0,height:0},r?i:this._transformedRect(i,l)}};return Vt.Container=R,m.Factory.addComponentsGetterSetter(R,"clip",["x","y","width","height"]),m.Factory.addGetterSetter(R,"clipX",void 0,(0,L.getNumberValidator)()),m.Factory.addGetterSetter(R,"clipY",void 0,(0,L.getNumberValidator)()),m.Factory.addGetterSetter(R,"clipWidth",void 0,(0,L.getNumberValidator)()),m.Factory.addGetterSetter(R,"clipHeight",void 0,(0,L.getNumberValidator)()),m.Factory.addGetterSetter(R,"clipFunc"),Vt}var ze={},Mt={},gi;function dn(){if(gi)return Mt;gi=1,Object.defineProperty(Mt,"__esModule",{value:!0}),Mt.getCapturedShape=R,Mt.createEvent=C,Mt.hasPointerCapture=f,Mt.setPointerCapture=h,Mt.releaseCapture=r;const m=nt(),w=new Map,L=m.Konva._global.PointerEvent!==void 0;function R(l){return w.get(l)}function C(l){return{evt:l,pointerId:l.pointerId}}function f(l,o){return w.get(l)===o}function h(l,o){r(l),o.getStage()&&(w.set(l,o),L&&o._fire("gotpointercapture",C(new PointerEvent("gotpointercapture"))))}function r(l,o){const a=w.get(l);if(!a)return;const g=a.getStage();g&&g.content,w.delete(l),L&&a._fire("lostpointercapture",C(new PointerEvent("lostpointercapture")))}return Mt}var pi;function Yn(){return pi||(pi=1,(function(m){Object.defineProperty(m,"__esModule",{value:!0}),m.Stage=m.stages=void 0;const w=dt(),L=rt(),R=Ne(),C=nt(),f=Ge(),h=Ke(),r=nt(),l=dn(),o="Stage",a="string",g="px",c="mouseout",i="mouseleave",n="mouseover",d="mouseenter",y="mousemove",b="mousedown",e="mouseup",t="pointermove",s="pointerdown",p="pointerup",P="pointercancel",G="lostpointercapture",_="pointerout",v="pointerleave",S="pointerover",k="pointerenter",F="contextmenu",D="touchstart",I="touchend",N="touchmove",W="touchcancel",u="wheel",x=5,E=[[d,"_pointerenter"],[b,"_pointerdown"],[y,"_pointermove"],[e,"_pointerup"],[i,"_pointerleave"],[D,"_pointerdown"],[N,"_pointermove"],[I,"_pointerup"],[W,"_pointercancel"],[n,"_pointerover"],[u,"_wheel"],[F,"_contextmenu"],[s,"_pointerdown"],[t,"_pointermove"],[p,"_pointerup"],[P,"_pointercancel"],[v,"_pointerleave"],[G,"_lostpointercapture"]],T={mouse:{[_]:c,[v]:i,[S]:n,[k]:d,[t]:y,[s]:b,[p]:e,[P]:"mousecancel",pointerclick:"click",pointerdblclick:"dblclick"},touch:{[_]:"touchout",[v]:"touchleave",[S]:"touchover",[k]:"touchenter",[t]:N,[s]:D,[p]:I,[P]:W,pointerclick:"tap",pointerdblclick:"dbltap"},pointer:{[_]:_,[v]:v,[S]:S,[k]:k,[t]:t,[s]:s,[p]:p,[P]:P,pointerclick:"pointerclick",pointerdblclick:"pointerdblclick"}},M=B=>B.indexOf("pointer")>=0?"pointer":B.indexOf("touch")>=0?"touch":"mouse",V=B=>{const A=M(B);if(A==="pointer")return C.Konva.pointerEventsEnabled&&T.pointer;if(A==="touch")return T.touch;if(A==="mouse")return T.mouse};function O(B={}){return(B.clipFunc||B.clipWidth||B.clipHeight)&&w.Util.warn("Stage does not support clipping. Please use clip for Layers or Groups."),B}const H="Pointer position is missing and not registered by the stage. Looks like it is outside of the stage container. You can set it manually from event: stage.setPointersPositions(event);";m.stages=[];class j extends R.Container{constructor(A){super(O(A)),this._pointerPositions=[],this._changedPointerPositions=[],this._buildDOM(),this._bindContentEvents(),m.stages.push(this),this.on("widthChange.konva heightChange.konva",this._resizeDOM),this.on("visibleChange.konva",this._checkVisibility),this.on("clipWidthChange.konva clipHeightChange.konva clipFuncChange.konva",()=>{O(this.attrs)}),this._checkVisibility()}_validateAdd(A){const U=A.getType()==="Layer",Y=A.getType()==="FastLayer";U||Y||w.Util.throw("You may only add layers to the stage.")}_checkVisibility(){if(!this.content)return;const A=this.visible()?"":"none";this.content.style.display=A}setContainer(A){if(typeof A===a){let U;if(A.charAt(0)==="."){const Y=A.slice(1);A=document.getElementsByClassName(Y)[0]}else A.charAt(0)!=="#"?U=A:U=A.slice(1),A=document.getElementById(U);if(!A)throw"Can not find container in document with id "+U}return this._setAttr("container",A),this.content&&(this.content.parentElement&&this.content.parentElement.removeChild(this.content),A.appendChild(this.content)),this}shouldDrawHit(){return!0}clear(){const A=this.children,U=A.length;for(let Y=0;Y<U;Y++)A[Y].clear();return this}clone(A){return A||(A={}),A.container=typeof document<"u"&&document.createElement("div"),R.Container.prototype.clone.call(this,A)}destroy(){super.destroy();const A=this.content;A&&w.Util._isInDocument(A)&&this.container().removeChild(A);const U=m.stages.indexOf(this);return U>-1&&m.stages.splice(U,1),w.Util.releaseCanvas(this.bufferCanvas._canvas,this.bufferHitCanvas._canvas),this}getPointerPosition(){const A=this._pointerPositions[0]||this._changedPointerPositions[0];return A?{x:A.x,y:A.y}:(w.Util.warn(H),null)}_getPointerById(A){return this._pointerPositions.find(U=>U.id===A)}getPointersPositions(){return this._pointerPositions}getStage(){return this}getContent(){return this.content}_toKonvaCanvas(A){A=A||{},A.x=A.x||0,A.y=A.y||0,A.width=A.width||this.width(),A.height=A.height||this.height();const U=new f.SceneCanvas({width:A.width,height:A.height,pixelRatio:A.pixelRatio||1}),Y=U.getContext()._context,X=this.children;return(A.x||A.y)&&Y.translate(-1*A.x,-1*A.y),X.forEach(function($){if(!$.isVisible())return;const tt=$._toKonvaCanvas(A);Y.drawImage(tt._canvas,A.x,A.y,tt.getWidth()/tt.getPixelRatio(),tt.getHeight()/tt.getPixelRatio())}),U}getIntersection(A){if(!A)return null;const U=this.children,Y=U.length,X=Y-1;for(let $=X;$>=0;$--){const tt=U[$].getIntersection(A);if(tt)return tt}return null}_resizeDOM(){const A=this.width(),U=this.height();this.content&&(this.content.style.width=A+g,this.content.style.height=U+g),this.bufferCanvas.setSize(A,U),this.bufferHitCanvas.setSize(A,U),this.children.forEach(Y=>{Y.setSize({width:A,height:U}),Y.draw()})}add(A,...U){if(arguments.length>1){for(let X=0;X<arguments.length;X++)this.add(arguments[X]);return this}super.add(A);const Y=this.children.length;return Y>x&&w.Util.warn("The stage has "+Y+" layers. Recommended maximum number of layers is 3-5. Adding more layers into the stage may drop the performance. Rethink your tree structure, you can use Konva.Group."),A.setSize({width:this.width(),height:this.height()}),A.draw(),C.Konva.isBrowser&&this.content.appendChild(A.canvas._canvas),this}getParent(){return null}getLayer(){return null}hasPointerCapture(A){return l.hasPointerCapture(A,this)}setPointerCapture(A){l.setPointerCapture(A,this)}releaseCapture(A){l.releaseCapture(A,this)}getLayers(){return this.children}_bindContentEvents(){C.Konva.isBrowser&&E.forEach(([A,U])=>{this.content.addEventListener(A,Y=>{this[U](Y)},{passive:!1})})}_pointerenter(A){this.setPointersPositions(A);const U=V(A.type);U&&this._fire(U.pointerenter,{evt:A,target:this,currentTarget:this})}_pointerover(A){this.setPointersPositions(A);const U=V(A.type);U&&this._fire(U.pointerover,{evt:A,target:this,currentTarget:this})}_getTargetShape(A){let U=this[A+"targetShape"];return U&&!U.getStage()&&(U=null),U}_pointerleave(A){const U=V(A.type),Y=M(A.type);if(!U)return;this.setPointersPositions(A);const X=this._getTargetShape(Y),$=!(C.Konva.isDragging()||C.Konva.isTransforming())||C.Konva.hitOnDragEnabled;X&&$?(X._fireAndBubble(U.pointerout,{evt:A}),X._fireAndBubble(U.pointerleave,{evt:A}),this._fire(U.pointerleave,{evt:A,target:this,currentTarget:this}),this[Y+"targetShape"]=null):$&&(this._fire(U.pointerleave,{evt:A,target:this,currentTarget:this}),this._fire(U.pointerout,{evt:A,target:this,currentTarget:this})),this.pointerPos=null,this._pointerPositions=[]}_pointerdown(A){const U=V(A.type),Y=M(A.type);if(!U)return;this.setPointersPositions(A);let X=!1;this._changedPointerPositions.forEach($=>{const tt=this.getIntersection($);if(h.DD.justDragged=!1,C.Konva["_"+Y+"ListenClick"]=!0,!tt||!tt.isListening()){this[Y+"ClickStartShape"]=void 0;return}C.Konva.capturePointerEventsEnabled&&tt.setPointerCapture($.id),this[Y+"ClickStartShape"]=tt,tt._fireAndBubble(U.pointerdown,{evt:A,pointerId:$.id}),X=!0;const it=A.type.indexOf("touch")>=0;tt.preventDefault()&&A.cancelable&&it&&A.preventDefault()}),X||this._fire(U.pointerdown,{evt:A,target:this,currentTarget:this,pointerId:this._pointerPositions[0].id})}_pointermove(A){const U=V(A.type),Y=M(A.type);if(!U||(C.Konva.isDragging()&&h.DD.node.preventDefault()&&A.cancelable&&A.preventDefault(),this.setPointersPositions(A),!(!(C.Konva.isDragging()||C.Konva.isTransforming())||C.Konva.hitOnDragEnabled)))return;const $={};let tt=!1;const it=this._getTargetShape(Y);this._changedPointerPositions.forEach(at=>{const et=l.getCapturedShape(at.id)||this.getIntersection(at),pt=at.id,ot={evt:A,pointerId:pt},ct=it!==et;if(ct&&it&&(it._fireAndBubble(U.pointerout,{...ot},et),it._fireAndBubble(U.pointerleave,{...ot},et)),et){if($[et._id])return;$[et._id]=!0}et&&et.isListening()?(tt=!0,ct&&(et._fireAndBubble(U.pointerover,{...ot},it),et._fireAndBubble(U.pointerenter,{...ot},it),this[Y+"targetShape"]=et),et._fireAndBubble(U.pointermove,{...ot})):it&&(this._fire(U.pointerover,{evt:A,target:this,currentTarget:this,pointerId:pt}),this[Y+"targetShape"]=null)}),tt||this._fire(U.pointermove,{evt:A,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id})}_pointerup(A){const U=V(A.type),Y=M(A.type);if(!U)return;this.setPointersPositions(A);const X=this[Y+"ClickStartShape"],$=this[Y+"ClickEndShape"],tt={};let it=!1;this._changedPointerPositions.forEach(at=>{const et=l.getCapturedShape(at.id)||this.getIntersection(at);if(et){if(et.releaseCapture(at.id),tt[et._id])return;tt[et._id]=!0}const pt=at.id,ot={evt:A,pointerId:pt};let ct=!1;C.Konva["_"+Y+"InDblClickWindow"]?(ct=!0,clearTimeout(this[Y+"DblTimeout"])):h.DD.justDragged||(C.Konva["_"+Y+"InDblClickWindow"]=!0,clearTimeout(this[Y+"DblTimeout"])),this[Y+"DblTimeout"]=setTimeout(function(){C.Konva["_"+Y+"InDblClickWindow"]=!1},C.Konva.dblClickWindow),et&&et.isListening()?(it=!0,this[Y+"ClickEndShape"]=et,et._fireAndBubble(U.pointerup,{...ot}),C.Konva["_"+Y+"ListenClick"]&&X&&X===et&&(et._fireAndBubble(U.pointerclick,{...ot}),ct&&$&&$===et&&et._fireAndBubble(U.pointerdblclick,{...ot}))):(this[Y+"ClickEndShape"]=null,C.Konva["_"+Y+"ListenClick"]&&this._fire(U.pointerclick,{evt:A,target:this,currentTarget:this,pointerId:pt}),ct&&this._fire(U.pointerdblclick,{evt:A,target:this,currentTarget:this,pointerId:pt}))}),it||this._fire(U.pointerup,{evt:A,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id}),C.Konva["_"+Y+"ListenClick"]=!1,A.cancelable&&Y!=="touch"&&Y!=="pointer"&&A.preventDefault()}_contextmenu(A){this.setPointersPositions(A);const U=this.getIntersection(this.getPointerPosition());U&&U.isListening()?U._fireAndBubble(F,{evt:A}):this._fire(F,{evt:A,target:this,currentTarget:this})}_wheel(A){this.setPointersPositions(A);const U=this.getIntersection(this.getPointerPosition());U&&U.isListening()?U._fireAndBubble(u,{evt:A}):this._fire(u,{evt:A,target:this,currentTarget:this})}_pointercancel(A){this.setPointersPositions(A);const U=l.getCapturedShape(A.pointerId)||this.getIntersection(this.getPointerPosition());U&&U._fireAndBubble(p,l.createEvent(A)),l.releaseCapture(A.pointerId)}_lostpointercapture(A){l.releaseCapture(A.pointerId)}setPointersPositions(A){const U=this._getContentPosition();let Y=null,X=null;A=A||window.event,A.touches!==void 0?(this._pointerPositions=[],this._changedPointerPositions=[],Array.prototype.forEach.call(A.touches,$=>{this._pointerPositions.push({id:$.identifier,x:($.clientX-U.left)/U.scaleX,y:($.clientY-U.top)/U.scaleY})}),Array.prototype.forEach.call(A.changedTouches||A.touches,$=>{this._changedPointerPositions.push({id:$.identifier,x:($.clientX-U.left)/U.scaleX,y:($.clientY-U.top)/U.scaleY})})):(Y=(A.clientX-U.left)/U.scaleX,X=(A.clientY-U.top)/U.scaleY,this.pointerPos={x:Y,y:X},this._pointerPositions=[{x:Y,y:X,id:w.Util._getFirstPointerId(A)}],this._changedPointerPositions=[{x:Y,y:X,id:w.Util._getFirstPointerId(A)}])}_setPointerPosition(A){w.Util.warn('Method _setPointerPosition is deprecated. Use "stage.setPointersPositions(event)" instead.'),this.setPointersPositions(A)}_getContentPosition(){if(!this.content||!this.content.getBoundingClientRect)return{top:0,left:0,scaleX:1,scaleY:1};const A=this.content.getBoundingClientRect();return{top:A.top,left:A.left,scaleX:A.width/this.content.clientWidth||1,scaleY:A.height/this.content.clientHeight||1}}_buildDOM(){if(this.bufferCanvas=new f.SceneCanvas({width:this.width(),height:this.height()}),this.bufferHitCanvas=new f.HitCanvas({pixelRatio:1,width:this.width(),height:this.height()}),!C.Konva.isBrowser)return;const A=this.container();if(!A)throw"Stage has no container. A container is required.";A.innerHTML="",this.content=document.createElement("div"),this.content.style.position="relative",this.content.style.userSelect="none",this.content.className="konvajs-content",this.content.setAttribute("role","presentation"),A.appendChild(this.content),this._resizeDOM()}cache(){return w.Util.warn("Cache function is not allowed for stage. You may use cache only for layers, groups and shapes."),this}clearCache(){return this}batchDraw(){return this.getChildren().forEach(function(A){A.batchDraw()}),this}}m.Stage=j,j.prototype.nodeType=o,(0,r._registerNode)(j),L.Factory.addGetterSetter(j,"container"),C.Konva.isBrowser&&document.addEventListener("visibilitychange",()=>{m.stages.forEach(B=>{B.batchDraw()})})})(ze)),ze}var Ht={},qe={},mi;function _t(){return mi||(mi=1,(function(m){Object.defineProperty(m,"__esModule",{value:!0}),m.Shape=m.shapes=void 0;const w=nt(),L=dt(),R=rt(),C=gt(),f=st(),h=nt(),r=dn(),l="hasShadow",o="shadowRGBA",a="patternImage",g="linearGradient",c="radialGradient";let i;function n(){return i||(i=L.Util.createCanvasElement().getContext("2d"),i)}m.shapes={};function d(v){const S=this.attrs.fillRule;S?v.fill(S):v.fill()}function y(v){v.stroke()}function b(v){const S=this.attrs.fillRule;S?v.fill(S):v.fill()}function e(v){v.stroke()}function t(){this._clearCache(l)}function s(){this._clearCache(o)}function p(){this._clearCache(a)}function P(){this._clearCache(g)}function G(){this._clearCache(c)}class _ extends C.Node{constructor(S){super(S);let k;for(;k=L.Util.getRandomColor(),!(k&&!(k in m.shapes)););this.colorKey=k,m.shapes[k]=this}getContext(){return L.Util.warn("shape.getContext() method is deprecated. Please do not use it."),this.getLayer().getContext()}getCanvas(){return L.Util.warn("shape.getCanvas() method is deprecated. Please do not use it."),this.getLayer().getCanvas()}getSceneFunc(){return this.attrs.sceneFunc||this._sceneFunc}getHitFunc(){return this.attrs.hitFunc||this._hitFunc}hasShadow(){return this._getCache(l,this._hasShadow)}_hasShadow(){return this.shadowEnabled()&&this.shadowOpacity()!==0&&!!(this.shadowColor()||this.shadowBlur()||this.shadowOffsetX()||this.shadowOffsetY())}_getFillPattern(){return this._getCache(a,this.__getFillPattern)}__getFillPattern(){if(this.fillPatternImage()){const k=n().createPattern(this.fillPatternImage(),this.fillPatternRepeat()||"repeat");if(k&&k.setTransform){const F=new L.Transform;F.translate(this.fillPatternX(),this.fillPatternY()),F.rotate(w.Konva.getAngle(this.fillPatternRotation())),F.scale(this.fillPatternScaleX(),this.fillPatternScaleY()),F.translate(-1*this.fillPatternOffsetX(),-1*this.fillPatternOffsetY());const D=F.getMatrix(),I=typeof DOMMatrix>"u"?{a:D[0],b:D[1],c:D[2],d:D[3],e:D[4],f:D[5]}:new DOMMatrix(D);k.setTransform(I)}return k}}_getLinearGradient(){return this._getCache(g,this.__getLinearGradient)}__getLinearGradient(){const S=this.fillLinearGradientColorStops();if(S){const k=n(),F=this.fillLinearGradientStartPoint(),D=this.fillLinearGradientEndPoint(),I=k.createLinearGradient(F.x,F.y,D.x,D.y);for(let N=0;N<S.length;N+=2)I.addColorStop(S[N],S[N+1]);return I}}_getRadialGradient(){return this._getCache(c,this.__getRadialGradient)}__getRadialGradient(){const S=this.fillRadialGradientColorStops();if(S){const k=n(),F=this.fillRadialGradientStartPoint(),D=this.fillRadialGradientEndPoint(),I=k.createRadialGradient(F.x,F.y,this.fillRadialGradientStartRadius(),D.x,D.y,this.fillRadialGradientEndRadius());for(let N=0;N<S.length;N+=2)I.addColorStop(S[N],S[N+1]);return I}}getShadowRGBA(){return this._getCache(o,this._getShadowRGBA)}_getShadowRGBA(){if(!this.hasShadow())return;const S=L.Util.colorToRGBA(this.shadowColor());if(S)return"rgba("+S.r+","+S.g+","+S.b+","+S.a*(this.shadowOpacity()||1)+")"}hasFill(){return this._calculate("hasFill",["fillEnabled","fill","fillPatternImage","fillLinearGradientColorStops","fillRadialGradientColorStops"],()=>this.fillEnabled()&&!!(this.fill()||this.fillPatternImage()||this.fillLinearGradientColorStops()||this.fillRadialGradientColorStops()))}hasStroke(){return this._calculate("hasStroke",["strokeEnabled","strokeWidth","stroke","strokeLinearGradientColorStops"],()=>this.strokeEnabled()&&this.strokeWidth()&&!!(this.stroke()||this.strokeLinearGradientColorStops()))}hasHitStroke(){const S=this.hitStrokeWidth();return S==="auto"?this.hasStroke():this.strokeEnabled()&&!!S}intersects(S){const k=this.getStage();if(!k)return!1;const F=k.bufferHitCanvas;return F.getContext().clear(),this.drawHit(F,void 0,!0),F.context.getImageData(Math.round(S.x),Math.round(S.y),1,1).data[3]>0}destroy(){return C.Node.prototype.destroy.call(this),delete m.shapes[this.colorKey],delete this.colorKey,this}_useBufferCanvas(S){var k;if(!((k=this.attrs.perfectDrawEnabled)!==null&&k!==void 0?k:!0))return!1;const D=S||this.hasFill(),I=this.hasStroke(),N=this.getAbsoluteOpacity()!==1;if(D&&I&&N)return!0;const W=this.hasShadow(),u=this.shadowForStrokeEnabled();return!!(D&&I&&W&&u)}setStrokeHitEnabled(S){L.Util.warn("strokeHitEnabled property is deprecated. Please use hitStrokeWidth instead."),S?this.hitStrokeWidth("auto"):this.hitStrokeWidth(0)}getStrokeHitEnabled(){return this.hitStrokeWidth()!==0}getSelfRect(){const S=this.size();return{x:this._centroid?-S.width/2:0,y:this._centroid?-S.height/2:0,width:S.width,height:S.height}}getClientRect(S={}){let k=!1,F=this.getParent();for(;F;){if(F.isCached()){k=!0;break}F=F.getParent()}const D=S.skipTransform,I=S.relativeTo||k&&this.getStage()||void 0,N=this.getSelfRect(),u=!S.skipStroke&&this.hasStroke()&&this.strokeWidth()||0,x=N.width+u,E=N.height+u,T=!S.skipShadow&&this.hasShadow(),M=T?this.shadowOffsetX():0,V=T?this.shadowOffsetY():0,O=x+Math.abs(M),H=E+Math.abs(V),j=T&&this.shadowBlur()||0,B=O+j*2,A=H+j*2,U={width:B,height:A,x:-(u/2+j)+Math.min(M,0)+N.x,y:-(u/2+j)+Math.min(V,0)+N.y};return D?U:this._transformedRect(U,I)}drawScene(S,k,F){const D=this.getLayer(),I=S||D.getCanvas(),N=I.getContext(),W=this._getCanvasCache(),u=this.getSceneFunc(),x=this.hasShadow();let E;const T=k===this;if(!this.isVisible()&&!T)return this;if(W){N.save();const M=this.getAbsoluteTransform(k).getMatrix();return N.transform(M[0],M[1],M[2],M[3],M[4],M[5]),this._drawCachedSceneCanvas(N),N.restore(),this}if(!u)return this;if(N.save(),this._useBufferCanvas()){E=this.getStage();const M=F||E.bufferCanvas,V=M.getContext();V.clear(),V.save(),V._applyLineJoin(this);const O=this.getAbsoluteTransform(k).getMatrix();V.transform(O[0],O[1],O[2],O[3],O[4],O[5]),u.call(this,V,this),V.restore();const H=M.pixelRatio;x&&N._applyShadow(this),N._applyOpacity(this),N._applyGlobalCompositeOperation(this),N.drawImage(M._canvas,M.x||0,M.y||0,M.width/H,M.height/H)}else{if(N._applyLineJoin(this),!T){const M=this.getAbsoluteTransform(k).getMatrix();N.transform(M[0],M[1],M[2],M[3],M[4],M[5]),N._applyOpacity(this),N._applyGlobalCompositeOperation(this)}x&&N._applyShadow(this),u.call(this,N,this)}return N.restore(),this}drawHit(S,k,F=!1){if(!this.shouldDrawHit(k,F))return this;const D=this.getLayer(),I=S||D.hitCanvas,N=I&&I.getContext(),W=this.hitFunc()||this.sceneFunc(),u=this._getCanvasCache(),x=u&&u.hit;if(this.colorKey||L.Util.warn("Looks like your canvas has a destroyed shape in it. Do not reuse shape after you destroyed it. If you want to reuse shape you should call remove() instead of destroy()"),x){N.save();const T=this.getAbsoluteTransform(k).getMatrix();return N.transform(T[0],T[1],T[2],T[3],T[4],T[5]),this._drawCachedHitCanvas(N),N.restore(),this}if(!W)return this;if(N.save(),N._applyLineJoin(this),!(this===k)){const T=this.getAbsoluteTransform(k).getMatrix();N.transform(T[0],T[1],T[2],T[3],T[4],T[5])}return W.call(this,N,this),N.restore(),this}drawHitFromCache(S=0){const k=this._getCanvasCache(),F=this._getCachedSceneCanvas(),D=k.hit,I=D.getContext(),N=D.getWidth(),W=D.getHeight();I.clear(),I.drawImage(F._canvas,0,0,N,W);try{const u=I.getImageData(0,0,N,W),x=u.data,E=x.length,T=L.Util._hexToRgb(this.colorKey);for(let M=0;M<E;M+=4)x[M+3]>S?(x[M]=T.r,x[M+1]=T.g,x[M+2]=T.b,x[M+3]=255):x[M+3]=0;I.putImageData(u,0,0)}catch(u){L.Util.error("Unable to draw hit graph from cached scene canvas. "+u.message)}return this}hasPointerCapture(S){return r.hasPointerCapture(S,this)}setPointerCapture(S){r.setPointerCapture(S,this)}releaseCapture(S){r.releaseCapture(S,this)}}m.Shape=_,_.prototype._fillFunc=d,_.prototype._strokeFunc=y,_.prototype._fillFuncHit=b,_.prototype._strokeFuncHit=e,_.prototype._centroid=!1,_.prototype.nodeType="Shape",(0,h._registerNode)(_),_.prototype.eventListeners={},_.prototype.on.call(_.prototype,"shadowColorChange.konva shadowBlurChange.konva shadowOffsetChange.konva shadowOpacityChange.konva shadowEnabledChange.konva",t),_.prototype.on.call(_.prototype,"shadowColorChange.konva shadowOpacityChange.konva shadowEnabledChange.konva",s),_.prototype.on.call(_.prototype,"fillPriorityChange.konva fillPatternImageChange.konva fillPatternRepeatChange.konva fillPatternScaleXChange.konva fillPatternScaleYChange.konva fillPatternOffsetXChange.konva fillPatternOffsetYChange.konva fillPatternXChange.konva fillPatternYChange.konva fillPatternRotationChange.konva",p),_.prototype.on.call(_.prototype,"fillPriorityChange.konva fillLinearGradientColorStopsChange.konva fillLinearGradientStartPointXChange.konva fillLinearGradientStartPointYChange.konva fillLinearGradientEndPointXChange.konva fillLinearGradientEndPointYChange.konva",P),_.prototype.on.call(_.prototype,"fillPriorityChange.konva fillRadialGradientColorStopsChange.konva fillRadialGradientStartPointXChange.konva fillRadialGradientStartPointYChange.konva fillRadialGradientEndPointXChange.konva fillRadialGradientEndPointYChange.konva fillRadialGradientStartRadiusChange.konva fillRadialGradientEndRadiusChange.konva",G),R.Factory.addGetterSetter(_,"stroke",void 0,(0,f.getStringOrGradientValidator)()),R.Factory.addGetterSetter(_,"strokeWidth",2,(0,f.getNumberValidator)()),R.Factory.addGetterSetter(_,"fillAfterStrokeEnabled",!1),R.Factory.addGetterSetter(_,"hitStrokeWidth","auto",(0,f.getNumberOrAutoValidator)()),R.Factory.addGetterSetter(_,"strokeHitEnabled",!0,(0,f.getBooleanValidator)()),R.Factory.addGetterSetter(_,"perfectDrawEnabled",!0,(0,f.getBooleanValidator)()),R.Factory.addGetterSetter(_,"shadowForStrokeEnabled",!0,(0,f.getBooleanValidator)()),R.Factory.addGetterSetter(_,"lineJoin"),R.Factory.addGetterSetter(_,"lineCap"),R.Factory.addGetterSetter(_,"sceneFunc"),R.Factory.addGetterSetter(_,"hitFunc"),R.Factory.addGetterSetter(_,"dash"),R.Factory.addGetterSetter(_,"dashOffset",0,(0,f.getNumberValidator)()),R.Factory.addGetterSetter(_,"shadowColor",void 0,(0,f.getStringValidator)()),R.Factory.addGetterSetter(_,"shadowBlur",0,(0,f.getNumberValidator)()),R.Factory.addGetterSetter(_,"shadowOpacity",1,(0,f.getNumberValidator)()),R.Factory.addComponentsGetterSetter(_,"shadowOffset",["x","y"]),R.Factory.addGetterSetter(_,"shadowOffsetX",0,(0,f.getNumberValidator)()),R.Factory.addGetterSetter(_,"shadowOffsetY",0,(0,f.getNumberValidator)()),R.Factory.addGetterSetter(_,"fillPatternImage"),R.Factory.addGetterSetter(_,"fill",void 0,(0,f.getStringOrGradientValidator)()),R.Factory.addGetterSetter(_,"fillPatternX",0,(0,f.getNumberValidator)()),R.Factory.addGetterSetter(_,"fillPatternY",0,(0,f.getNumberValidator)()),R.Factory.addGetterSetter(_,"fillLinearGradientColorStops"),R.Factory.addGetterSetter(_,"strokeLinearGradientColorStops"),R.Factory.addGetterSetter(_,"fillRadialGradientStartRadius",0),R.Factory.addGetterSetter(_,"fillRadialGradientEndRadius",0),R.Factory.addGetterSetter(_,"fillRadialGradientColorStops"),R.Factory.addGetterSetter(_,"fillPatternRepeat","repeat"),R.Factory.addGetterSetter(_,"fillEnabled",!0),R.Factory.addGetterSetter(_,"strokeEnabled",!0),R.Factory.addGetterSetter(_,"shadowEnabled",!0),R.Factory.addGetterSetter(_,"dashEnabled",!0),R.Factory.addGetterSetter(_,"strokeScaleEnabled",!0),R.Factory.addGetterSetter(_,"fillPriority","color"),R.Factory.addComponentsGetterSetter(_,"fillPatternOffset",["x","y"]),R.Factory.addGetterSetter(_,"fillPatternOffsetX",0,(0,f.getNumberValidator)()),R.Factory.addGetterSetter(_,"fillPatternOffsetY",0,(0,f.getNumberValidator)()),R.Factory.addComponentsGetterSetter(_,"fillPatternScale",["x","y"]),R.Factory.addGetterSetter(_,"fillPatternScaleX",1,(0,f.getNumberValidator)()),R.Factory.addGetterSetter(_,"fillPatternScaleY",1,(0,f.getNumberValidator)()),R.Factory.addComponentsGetterSetter(_,"fillLinearGradientStartPoint",["x","y"]),R.Factory.addComponentsGetterSetter(_,"strokeLinearGradientStartPoint",["x","y"]),R.Factory.addGetterSetter(_,"fillLinearGradientStartPointX",0),R.Factory.addGetterSetter(_,"strokeLinearGradientStartPointX",0),R.Factory.addGetterSetter(_,"fillLinearGradientStartPointY",0),R.Factory.addGetterSetter(_,"strokeLinearGradientStartPointY",0),R.Factory.addComponentsGetterSetter(_,"fillLinearGradientEndPoint",["x","y"]),R.Factory.addComponentsGetterSetter(_,"strokeLinearGradientEndPoint",["x","y"]),R.Factory.addGetterSetter(_,"fillLinearGradientEndPointX",0),R.Factory.addGetterSetter(_,"strokeLinearGradientEndPointX",0),R.Factory.addGetterSetter(_,"fillLinearGradientEndPointY",0),R.Factory.addGetterSetter(_,"strokeLinearGradientEndPointY",0),R.Factory.addComponentsGetterSetter(_,"fillRadialGradientStartPoint",["x","y"]),R.Factory.addGetterSetter(_,"fillRadialGradientStartPointX",0),R.Factory.addGetterSetter(_,"fillRadialGradientStartPointY",0),R.Factory.addComponentsGetterSetter(_,"fillRadialGradientEndPoint",["x","y"]),R.Factory.addGetterSetter(_,"fillRadialGradientEndPointX",0),R.Factory.addGetterSetter(_,"fillRadialGradientEndPointY",0),R.Factory.addGetterSetter(_,"fillPatternRotation",0),R.Factory.addGetterSetter(_,"fillRule",void 0,(0,f.getStringValidator)()),R.Factory.backCompat(_,{dashArray:"dash",getDashArray:"getDash",setDashArray:"getDash",drawFunc:"sceneFunc",getDrawFunc:"getSceneFunc",setDrawFunc:"setSceneFunc",drawHitFunc:"hitFunc",getDrawHitFunc:"getHitFunc",setDrawHitFunc:"setHitFunc"})})(qe)),qe}var _i;function un(){if(_i)return Ht;_i=1,Object.defineProperty(Ht,"__esModule",{value:!0}),Ht.Layer=void 0;const m=dt(),w=Ne(),L=gt(),R=rt(),C=Ge(),f=st(),h=_t(),r=nt(),l="#",o="beforeDraw",a="draw",g=[{x:0,y:0},{x:-1,y:-1},{x:1,y:-1},{x:1,y:1},{x:-1,y:1}],c=g.length;let i=class extends w.Container{constructor(d){super(d),this.canvas=new C.SceneCanvas,this.hitCanvas=new C.HitCanvas({pixelRatio:1}),this._waitingForDraw=!1,this.on("visibleChange.konva",this._checkVisibility),this._checkVisibility(),this.on("imageSmoothingEnabledChange.konva",this._setSmoothEnabled),this._setSmoothEnabled()}createPNGStream(){return this.canvas._canvas.createPNGStream()}getCanvas(){return this.canvas}getNativeCanvasElement(){return this.canvas._canvas}getHitCanvas(){return this.hitCanvas}getContext(){return this.getCanvas().getContext()}clear(d){return this.getContext().clear(d),this.getHitCanvas().getContext().clear(d),this}setZIndex(d){super.setZIndex(d);const y=this.getStage();return y&&y.content&&(y.content.removeChild(this.getNativeCanvasElement()),d<y.children.length-1?y.content.insertBefore(this.getNativeCanvasElement(),y.children[d+1].getCanvas()._canvas):y.content.appendChild(this.getNativeCanvasElement())),this}moveToTop(){L.Node.prototype.moveToTop.call(this);const d=this.getStage();return d&&d.content&&(d.content.removeChild(this.getNativeCanvasElement()),d.content.appendChild(this.getNativeCanvasElement())),!0}moveUp(){if(!L.Node.prototype.moveUp.call(this))return!1;const y=this.getStage();return!y||!y.content?!1:(y.content.removeChild(this.getNativeCanvasElement()),this.index<y.children.length-1?y.content.insertBefore(this.getNativeCanvasElement(),y.children[this.index+1].getCanvas()._canvas):y.content.appendChild(this.getNativeCanvasElement()),!0)}moveDown(){if(L.Node.prototype.moveDown.call(this)){const d=this.getStage();if(d){const y=d.children;d.content&&(d.content.removeChild(this.getNativeCanvasElement()),d.content.insertBefore(this.getNativeCanvasElement(),y[this.index+1].getCanvas()._canvas))}return!0}return!1}moveToBottom(){if(L.Node.prototype.moveToBottom.call(this)){const d=this.getStage();if(d){const y=d.children;d.content&&(d.content.removeChild(this.getNativeCanvasElement()),d.content.insertBefore(this.getNativeCanvasElement(),y[1].getCanvas()._canvas))}return!0}return!1}getLayer(){return this}remove(){const d=this.getNativeCanvasElement();return L.Node.prototype.remove.call(this),d&&d.parentNode&&m.Util._isInDocument(d)&&d.parentNode.removeChild(d),this}getStage(){return this.parent}setSize({width:d,height:y}){return this.canvas.setSize(d,y),this.hitCanvas.setSize(d,y),this._setSmoothEnabled(),this}_validateAdd(d){const y=d.getType();y!=="Group"&&y!=="Shape"&&m.Util.throw("You may only add groups and shapes to a layer.")}_toKonvaCanvas(d){return d=d||{},d.width=d.width||this.getWidth(),d.height=d.height||this.getHeight(),d.x=d.x!==void 0?d.x:this.x(),d.y=d.y!==void 0?d.y:this.y(),L.Node.prototype._toKonvaCanvas.call(this,d)}_checkVisibility(){this.visible()?this.canvas._canvas.style.display="block":this.canvas._canvas.style.display="none"}_setSmoothEnabled(){this.getContext()._context.imageSmoothingEnabled=this.imageSmoothingEnabled()}getWidth(){if(this.parent)return this.parent.width()}setWidth(){m.Util.warn('Can not change width of layer. Use "stage.width(value)" function instead.')}getHeight(){if(this.parent)return this.parent.height()}setHeight(){m.Util.warn('Can not change height of layer. Use "stage.height(value)" function instead.')}batchDraw(){return this._waitingForDraw||(this._waitingForDraw=!0,m.Util.requestAnimFrame(()=>{this.draw(),this._waitingForDraw=!1})),this}getIntersection(d){if(!this.isListening()||!this.isVisible())return null;let y=1,b=!1;for(;;){for(let e=0;e<c;e++){const t=g[e],s=this._getIntersection({x:d.x+t.x*y,y:d.y+t.y*y}),p=s.shape;if(p)return p;if(b=!!s.antialiased,!s.antialiased)break}if(b)y+=1;else return null}}_getIntersection(d){const y=this.hitCanvas.pixelRatio,b=this.hitCanvas.context.getImageData(Math.round(d.x*y),Math.round(d.y*y),1,1).data,e=b[3];if(e===255){const t=m.Util._rgbToHex(b[0],b[1],b[2]),s=h.shapes[l+t];return s?{shape:s}:{antialiased:!0}}else if(e>0)return{antialiased:!0};return{}}drawScene(d,y,b){const e=this.getLayer(),t=d||e&&e.getCanvas();return this._fire(o,{node:this}),this.clearBeforeDraw()&&t.getContext().clear(),w.Container.prototype.drawScene.call(this,t,y,b),this._fire(a,{node:this}),this}drawHit(d,y){const b=this.getLayer(),e=d||b&&b.hitCanvas;return b&&b.clearBeforeDraw()&&b.getHitCanvas().getContext().clear(),w.Container.prototype.drawHit.call(this,e,y),this}enableHitGraph(){return this.hitGraphEnabled(!0),this}disableHitGraph(){return this.hitGraphEnabled(!1),this}setHitGraphEnabled(d){m.Util.warn("hitGraphEnabled method is deprecated. Please use layer.listening() instead."),this.listening(d)}getHitGraphEnabled(d){return m.Util.warn("hitGraphEnabled method is deprecated. Please use layer.listening() instead."),this.listening()}toggleHitCanvas(){if(!this.parent||!this.parent.content)return;const d=this.parent;!!this.hitCanvas._canvas.parentNode?d.content.removeChild(this.hitCanvas._canvas):d.content.appendChild(this.hitCanvas._canvas)}destroy(){return m.Util.releaseCanvas(this.getNativeCanvasElement(),this.getHitCanvas()._canvas),super.destroy()}};return Ht.Layer=i,i.prototype.nodeType="Layer",(0,r._registerNode)(i),R.Factory.addGetterSetter(i,"imageSmoothingEnabled",!0),R.Factory.addGetterSetter(i,"clearBeforeDraw",!0),R.Factory.addGetterSetter(i,"hitGraphEnabled",!0,(0,f.getBooleanValidator)()),Ht}var zt={},yi;function jn(){if(yi)return zt;yi=1,Object.defineProperty(zt,"__esModule",{value:!0}),zt.FastLayer=void 0;const m=dt(),w=un(),L=nt();let R=class extends w.Layer{constructor(f){super(f),this.listening(!1),m.Util.warn('Konva.Fast layer is deprecated. Please use "new Konva.Layer({ listening: false })" instead.')}};return zt.FastLayer=R,R.prototype.nodeType="FastLayer",(0,L._registerNode)(R),zt}var qt={},vi;function Xe(){if(vi)return qt;vi=1,Object.defineProperty(qt,"__esModule",{value:!0}),qt.Group=void 0;const m=dt(),w=Ne(),L=nt();let R=class extends w.Container{_validateAdd(f){const h=f.getType();h!=="Group"&&h!=="Shape"&&m.Util.throw("You may only add groups and shapes to groups.")}};return qt.Group=R,R.prototype.nodeType="Group",(0,L._registerNode)(R),qt}var Wt={},bi;function $e(){if(bi)return Wt;bi=1,Object.defineProperty(Wt,"__esModule",{value:!0}),Wt.Animation=void 0;const m=nt(),w=dt(),L=(function(){return m.glob.performance&&m.glob.performance.now?function(){return m.glob.performance.now()}:function(){return new Date().getTime()}})();let R=class Ot{constructor(f,h){this.id=Ot.animIdCounter++,this.frame={time:0,timeDiff:0,lastTime:L(),frameRate:0},this.func=f,this.setLayers(h)}setLayers(f){let h=[];return f&&(h=Array.isArray(f)?f:[f]),this.layers=h,this}getLayers(){return this.layers}addLayer(f){const h=this.layers,r=h.length;for(let l=0;l<r;l++)if(h[l]._id===f._id)return!1;return this.layers.push(f),!0}isRunning(){const h=Ot.animations,r=h.length;for(let l=0;l<r;l++)if(h[l].id===this.id)return!0;return!1}start(){return this.stop(),this.frame.timeDiff=0,this.frame.lastTime=L(),Ot._addAnimation(this),this}stop(){return Ot._removeAnimation(this),this}_updateFrameObject(f){this.frame.timeDiff=f-this.frame.lastTime,this.frame.lastTime=f,this.frame.time+=this.frame.timeDiff,this.frame.frameRate=1e3/this.frame.timeDiff}static _addAnimation(f){this.animations.push(f),this._handleAnimation()}static _removeAnimation(f){const h=f.id,r=this.animations,l=r.length;for(let o=0;o<l;o++)if(r[o].id===h){this.animations.splice(o,1);break}}static _runFrames(){const f={},h=this.animations;for(let r=0;r<h.length;r++){const l=h[r],o=l.layers,a=l.func;l._updateFrameObject(L());const g=o.length;let c;if(a?c=a.call(l,l.frame)!==!1:c=!0,!!c)for(let i=0;i<g;i++){const n=o[i];n._id!==void 0&&(f[n._id]=n)}}for(const r in f)f.hasOwnProperty(r)&&f[r].batchDraw()}static _animationLoop(){const f=Ot;f.animations.length?(f._runFrames(),w.Util.requestAnimFrame(f._animationLoop)):f.animRunning=!1}static _handleAnimation(){this.animRunning||(this.animRunning=!0,w.Util.requestAnimFrame(this._animationLoop))}};return Wt.Animation=R,R.animations=[],R.animIdCounter=0,R.animRunning=!1,Wt}var We={},Si;function Kn(){return Si||(Si=1,(function(m){Object.defineProperty(m,"__esModule",{value:!0}),m.Easings=m.Tween=void 0;const w=dt(),L=$e(),R=gt(),C=nt(),f={node:1,duration:1,easing:1,onFinish:1,yoyo:1},h=1,r=2,l=3,o=["fill","stroke","shadowColor"];let a=0;class g{constructor(n,d,y,b,e,t,s){this.prop=n,this.propFunc=d,this.begin=b,this._pos=b,this.duration=t,this._change=0,this.prevPos=0,this.yoyo=s,this._time=0,this._position=0,this._startTime=0,this._finish=0,this.func=y,this._change=e-this.begin,this.pause()}fire(n){const d=this[n];d&&d()}setTime(n){n>this.duration?this.yoyo?(this._time=this.duration,this.reverse()):this.finish():n<0?this.yoyo?(this._time=0,this.play()):this.reset():(this._time=n,this.update())}getTime(){return this._time}setPosition(n){this.prevPos=this._pos,this.propFunc(n),this._pos=n}getPosition(n){return n===void 0&&(n=this._time),this.func(n,this.begin,this._change,this.duration)}play(){this.state=r,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onPlay")}reverse(){this.state=l,this._time=this.duration-this._time,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onReverse")}seek(n){this.pause(),this._time=n,this.update(),this.fire("onSeek")}reset(){this.pause(),this._time=0,this.update(),this.fire("onReset")}finish(){this.pause(),this._time=this.duration,this.update(),this.fire("onFinish")}update(){this.setPosition(this.getPosition(this._time)),this.fire("onUpdate")}onEnterFrame(){const n=this.getTimer()-this._startTime;this.state===r?this.setTime(n):this.state===l&&this.setTime(this.duration-n)}pause(){this.state=h,this.fire("onPause")}getTimer(){return new Date().getTime()}}class c{constructor(n){const d=this,y=n.node,b=y._id,e=n.easing||m.Easings.Linear,t=!!n.yoyo;let s,p;typeof n.duration>"u"?s=.3:n.duration===0?s=.001:s=n.duration,this.node=y,this._id=a++;const P=y.getLayer()||(y instanceof C.Konva.Stage?y.getLayers():null);P||w.Util.error("Tween constructor have `node` that is not in a layer. Please add node into layer first."),this.anim=new L.Animation(function(){d.tween.onEnterFrame()},P),this.tween=new g(p,function(G){d._tweenFunc(G)},e,0,1,s*1e3,t),this._addListeners(),c.attrs[b]||(c.attrs[b]={}),c.attrs[b][this._id]||(c.attrs[b][this._id]={}),c.tweens[b]||(c.tweens[b]={});for(p in n)f[p]===void 0&&this._addAttr(p,n[p]);this.reset(),this.onFinish=n.onFinish,this.onReset=n.onReset,this.onUpdate=n.onUpdate}_addAttr(n,d){const y=this.node,b=y._id;let e,t,s,p,P;const G=c.tweens[b][n];G&&delete c.attrs[b][G][n];let _=y.getAttr(n);if(w.Util._isArray(d))if(e=[],t=Math.max(d.length,_.length),n==="points"&&d.length!==_.length&&(d.length>_.length?(p=_,_=w.Util._prepareArrayForTween(_,d,y.closed())):(s=d,d=w.Util._prepareArrayForTween(d,_,y.closed()))),n.indexOf("fill")===0)for(let v=0;v<t;v++)if(v%2===0)e.push(d[v]-_[v]);else{const S=w.Util.colorToRGBA(_[v]);P=w.Util.colorToRGBA(d[v]),_[v]=S,e.push({r:P.r-S.r,g:P.g-S.g,b:P.b-S.b,a:P.a-S.a})}else for(let v=0;v<t;v++)e.push(d[v]-_[v]);else o.indexOf(n)!==-1?(_=w.Util.colorToRGBA(_),P=w.Util.colorToRGBA(d),e={r:P.r-_.r,g:P.g-_.g,b:P.b-_.b,a:P.a-_.a}):e=d-_;c.attrs[b][this._id][n]={start:_,diff:e,end:d,trueEnd:s,trueStart:p},c.tweens[b][n]=this._id}_tweenFunc(n){const d=this.node,y=c.attrs[d._id][this._id];let b,e,t,s,p,P,G,_;for(b in y){if(e=y[b],t=e.start,s=e.diff,_=e.end,w.Util._isArray(t))if(p=[],G=Math.max(t.length,_.length),b.indexOf("fill")===0)for(P=0;P<G;P++)P%2===0?p.push((t[P]||0)+s[P]*n):p.push("rgba("+Math.round(t[P].r+s[P].r*n)+","+Math.round(t[P].g+s[P].g*n)+","+Math.round(t[P].b+s[P].b*n)+","+(t[P].a+s[P].a*n)+")");else for(P=0;P<G;P++)p.push((t[P]||0)+s[P]*n);else o.indexOf(b)!==-1?p="rgba("+Math.round(t.r+s.r*n)+","+Math.round(t.g+s.g*n)+","+Math.round(t.b+s.b*n)+","+(t.a+s.a*n)+")":p=t+s*n;d.setAttr(b,p)}}_addListeners(){this.tween.onPlay=()=>{this.anim.start()},this.tween.onReverse=()=>{this.anim.start()},this.tween.onPause=()=>{this.anim.stop()},this.tween.onFinish=()=>{const n=this.node,d=c.attrs[n._id][this._id];d.points&&d.points.trueEnd&&n.setAttr("points",d.points.trueEnd),this.onFinish&&this.onFinish.call(this)},this.tween.onReset=()=>{const n=this.node,d=c.attrs[n._id][this._id];d.points&&d.points.trueStart&&n.points(d.points.trueStart),this.onReset&&this.onReset()},this.tween.onUpdate=()=>{this.onUpdate&&this.onUpdate.call(this)}}play(){return this.tween.play(),this}reverse(){return this.tween.reverse(),this}reset(){return this.tween.reset(),this}seek(n){return this.tween.seek(n*1e3),this}pause(){return this.tween.pause(),this}finish(){return this.tween.finish(),this}destroy(){const n=this.node._id,d=this._id,y=c.tweens[n];this.pause(),this.anim&&this.anim.stop();for(const b in y)delete c.tweens[n][b];delete c.attrs[n][d],c.tweens[n]&&(Object.keys(c.tweens[n]).length===0&&delete c.tweens[n],Object.keys(c.attrs[n]).length===0&&delete c.attrs[n])}}m.Tween=c,c.attrs={},c.tweens={},R.Node.prototype.to=function(i){const n=i.onFinish;i.node=this,i.onFinish=function(){this.destroy(),n&&n()},new c(i).play()},m.Easings={BackEaseIn(i,n,d,y){return d*(i/=y)*i*((1.70158+1)*i-1.70158)+n},BackEaseOut(i,n,d,y){return d*((i=i/y-1)*i*((1.70158+1)*i+1.70158)+1)+n},BackEaseInOut(i,n,d,y){let b=1.70158;return(i/=y/2)<1?d/2*(i*i*(((b*=1.525)+1)*i-b))+n:d/2*((i-=2)*i*(((b*=1.525)+1)*i+b)+2)+n},ElasticEaseIn(i,n,d,y,b,e){let t=0;return i===0?n:(i/=y)===1?n+d:(e||(e=y*.3),!b||b<Math.abs(d)?(b=d,t=e/4):t=e/(2*Math.PI)*Math.asin(d/b),-(b*Math.pow(2,10*(i-=1))*Math.sin((i*y-t)*(2*Math.PI)/e))+n)},ElasticEaseOut(i,n,d,y,b,e){let t=0;return i===0?n:(i/=y)===1?n+d:(e||(e=y*.3),!b||b<Math.abs(d)?(b=d,t=e/4):t=e/(2*Math.PI)*Math.asin(d/b),b*Math.pow(2,-10*i)*Math.sin((i*y-t)*(2*Math.PI)/e)+d+n)},ElasticEaseInOut(i,n,d,y,b,e){let t=0;return i===0?n:(i/=y/2)===2?n+d:(e||(e=y*(.3*1.5)),!b||b<Math.abs(d)?(b=d,t=e/4):t=e/(2*Math.PI)*Math.asin(d/b),i<1?-.5*(b*Math.pow(2,10*(i-=1))*Math.sin((i*y-t)*(2*Math.PI)/e))+n:b*Math.pow(2,-10*(i-=1))*Math.sin((i*y-t)*(2*Math.PI)/e)*.5+d+n)},BounceEaseOut(i,n,d,y){return(i/=y)<1/2.75?d*(7.5625*i*i)+n:i<2/2.75?d*(7.5625*(i-=1.5/2.75)*i+.75)+n:i<2.5/2.75?d*(7.5625*(i-=2.25/2.75)*i+.9375)+n:d*(7.5625*(i-=2.625/2.75)*i+.984375)+n},BounceEaseIn(i,n,d,y){return d-m.Easings.BounceEaseOut(y-i,0,d,y)+n},BounceEaseInOut(i,n,d,y){return i<y/2?m.Easings.BounceEaseIn(i*2,0,d,y)*.5+n:m.Easings.BounceEaseOut(i*2-y,0,d,y)*.5+d*.5+n},EaseIn(i,n,d,y){return d*(i/=y)*i+n},EaseOut(i,n,d,y){return-d*(i/=y)*(i-2)+n},EaseInOut(i,n,d,y){return(i/=y/2)<1?d/2*i*i+n:-d/2*(--i*(i-2)-1)+n},StrongEaseIn(i,n,d,y){return d*(i/=y)*i*i*i*i+n},StrongEaseOut(i,n,d,y){return d*((i=i/y-1)*i*i*i*i+1)+n},StrongEaseInOut(i,n,d,y){return(i/=y/2)<1?d/2*i*i*i*i*i+n:d/2*((i-=2)*i*i*i*i+2)+n},Linear(i,n,d,y){return d*i/y+n}}})(We)),We}var Ci;function Xn(){return Ci||(Ci=1,(function(m){Object.defineProperty(m,"__esModule",{value:!0}),m.Konva=void 0;const w=nt(),L=dt(),R=gt(),C=Ne(),f=Yn(),h=un(),r=jn(),l=Xe(),o=Ke(),a=_t(),g=$e(),c=Kn(),i=cn(),n=Ge();m.Konva=L.Util._assign(w.Konva,{Util:L.Util,Transform:L.Transform,Node:R.Node,Container:C.Container,Stage:f.Stage,stages:f.stages,Layer:h.Layer,FastLayer:r.FastLayer,Group:l.Group,DD:o.DD,Shape:a.Shape,shapes:a.shapes,Animation:g.Animation,Tween:c.Tween,Easings:c.Easings,Context:i.Context,Canvas:n.Canvas}),m.default=m.Konva})(Ie)),Ie}var Yt={},wi;function $n(){if(wi)return Yt;wi=1,Object.defineProperty(Yt,"__esModule",{value:!0}),Yt.Arc=void 0;const m=rt(),w=_t(),L=nt(),R=st(),C=nt();let f=class extends w.Shape{_sceneFunc(r){const l=L.Konva.getAngle(this.angle()),o=this.clockwise();r.beginPath(),r.arc(0,0,this.outerRadius(),0,l,o),r.arc(0,0,this.innerRadius(),l,0,!o),r.closePath(),r.fillStrokeShape(this)}getWidth(){return this.outerRadius()*2}getHeight(){return this.outerRadius()*2}setWidth(r){this.outerRadius(r/2)}setHeight(r){this.outerRadius(r/2)}getSelfRect(){const r=this.innerRadius(),l=this.outerRadius(),o=this.clockwise(),a=L.Konva.getAngle(o?360-this.angle():this.angle()),g=Math.cos(Math.min(a,Math.PI)),c=1,i=Math.sin(Math.min(Math.max(Math.PI,a),3*Math.PI/2)),n=Math.sin(Math.min(a,Math.PI/2)),d=g*(g>0?r:l),y=c*l,b=i*(i>0?r:l),e=n*(n>0?l:r);return{x:d,y:o?-1*e:b,width:y-d,height:e-b}}};return Yt.Arc=f,f.prototype._centroid=!0,f.prototype.className="Arc",f.prototype._attrsAffectingSize=["innerRadius","outerRadius","angle","clockwise"],(0,C._registerNode)(f),m.Factory.addGetterSetter(f,"innerRadius",0,(0,R.getNumberValidator)()),m.Factory.addGetterSetter(f,"outerRadius",0,(0,R.getNumberValidator)()),m.Factory.addGetterSetter(f,"angle",0,(0,R.getNumberValidator)()),m.Factory.addGetterSetter(f,"clockwise",!1,(0,R.getBooleanValidator)()),Yt}var jt={},Kt={},xi;function fn(){if(xi)return Kt;xi=1,Object.defineProperty(Kt,"__esModule",{value:!0}),Kt.Line=void 0;const m=rt(),w=nt(),L=_t(),R=st();function C(r,l,o,a,g,c,i){const n=Math.sqrt(Math.pow(o-r,2)+Math.pow(a-l,2)),d=Math.sqrt(Math.pow(g-o,2)+Math.pow(c-a,2)),y=i*n/(n+d),b=i*d/(n+d),e=o-y*(g-r),t=a-y*(c-l),s=o+b*(g-r),p=a+b*(c-l);return[e,t,s,p]}function f(r,l){const o=r.length,a=[];for(let g=2;g<o-2;g+=2){const c=C(r[g-2],r[g-1],r[g],r[g+1],r[g+2],r[g+3],l);isNaN(c[0])||(a.push(c[0]),a.push(c[1]),a.push(r[g]),a.push(r[g+1]),a.push(c[2]),a.push(c[3]))}return a}let h=class extends L.Shape{constructor(l){super(l),this.on("pointsChange.konva tensionChange.konva closedChange.konva bezierChange.konva",function(){this._clearCache("tensionPoints")})}_sceneFunc(l){const o=this.points(),a=o.length,g=this.tension(),c=this.closed(),i=this.bezier();if(!a)return;let n=0;if(l.beginPath(),l.moveTo(o[0],o[1]),g!==0&&a>4){const d=this.getTensionPoints(),y=d.length;for(n=c?0:4,c||l.quadraticCurveTo(d[0],d[1],d[2],d[3]);n<y-2;)l.bezierCurveTo(d[n++],d[n++],d[n++],d[n++],d[n++],d[n++]);c||l.quadraticCurveTo(d[y-2],d[y-1],o[a-2],o[a-1])}else if(i)for(n=2;n<a;)l.bezierCurveTo(o[n++],o[n++],o[n++],o[n++],o[n++],o[n++]);else for(n=2;n<a;n+=2)l.lineTo(o[n],o[n+1]);c?(l.closePath(),l.fillStrokeShape(this)):l.strokeShape(this)}getTensionPoints(){return this._getCache("tensionPoints",this._getTensionPoints)}_getTensionPoints(){return this.closed()?this._getTensionPointsClosed():f(this.points(),this.tension())}_getTensionPointsClosed(){const l=this.points(),o=l.length,a=this.tension(),g=C(l[o-2],l[o-1],l[0],l[1],l[2],l[3],a),c=C(l[o-4],l[o-3],l[o-2],l[o-1],l[0],l[1],a),i=f(l,a);return[g[2],g[3]].concat(i).concat([c[0],c[1],l[o-2],l[o-1],c[2],c[3],g[0],g[1],l[0],l[1]])}getWidth(){return this.getSelfRect().width}getHeight(){return this.getSelfRect().height}getSelfRect(){let l=this.points();if(l.length<4)return{x:l[0]||0,y:l[1]||0,width:0,height:0};this.tension()!==0?l=[l[0],l[1],...this._getTensionPoints(),l[l.length-2],l[l.length-1]]:l=this.points();let o=l[0],a=l[0],g=l[1],c=l[1],i,n;for(let d=0;d<l.length/2;d++)i=l[d*2],n=l[d*2+1],o=Math.min(o,i),a=Math.max(a,i),g=Math.min(g,n),c=Math.max(c,n);return{x:o,y:g,width:a-o,height:c-g}}};return Kt.Line=h,h.prototype.className="Line",h.prototype._attrsAffectingSize=["points","bezier","tension"],(0,w._registerNode)(h),m.Factory.addGetterSetter(h,"closed",!1),m.Factory.addGetterSetter(h,"bezier",!1),m.Factory.addGetterSetter(h,"tension",0,(0,R.getNumberValidator)()),m.Factory.addGetterSetter(h,"points",[],(0,R.getNumberArrayValidator)()),Kt}var Xt={},Ye={},Pi;function Qn(){return Pi||(Pi=1,(function(m){Object.defineProperty(m,"__esModule",{value:!0}),m.t2length=m.getQuadraticArcLength=m.getCubicArcLength=m.binomialCoefficients=m.cValues=m.tValues=void 0,m.tValues=[[],[],[-.5773502691896257,.5773502691896257],[0,-.7745966692414834,.7745966692414834],[-.33998104358485626,.33998104358485626,-.8611363115940526,.8611363115940526],[0,-.5384693101056831,.5384693101056831,-.906179845938664,.906179845938664],[.6612093864662645,-.6612093864662645,-.2386191860831969,.2386191860831969,-.932469514203152,.932469514203152],[0,.4058451513773972,-.4058451513773972,-.7415311855993945,.7415311855993945,-.9491079123427585,.9491079123427585],[-.1834346424956498,.1834346424956498,-.525532409916329,.525532409916329,-.7966664774136267,.7966664774136267,-.9602898564975363,.9602898564975363],[0,-.8360311073266358,.8360311073266358,-.9681602395076261,.9681602395076261,-.3242534234038089,.3242534234038089,-.6133714327005904,.6133714327005904],[-.14887433898163122,.14887433898163122,-.4333953941292472,.4333953941292472,-.6794095682990244,.6794095682990244,-.8650633666889845,.8650633666889845,-.9739065285171717,.9739065285171717],[0,-.26954315595234496,.26954315595234496,-.5190961292068118,.5190961292068118,-.7301520055740494,.7301520055740494,-.8870625997680953,.8870625997680953,-.978228658146057,.978228658146057],[-.1252334085114689,.1252334085114689,-.3678314989981802,.3678314989981802,-.5873179542866175,.5873179542866175,-.7699026741943047,.7699026741943047,-.9041172563704749,.9041172563704749,-.9815606342467192,.9815606342467192],[0,-.2304583159551348,.2304583159551348,-.44849275103644687,.44849275103644687,-.6423493394403402,.6423493394403402,-.8015780907333099,.8015780907333099,-.9175983992229779,.9175983992229779,-.9841830547185881,.9841830547185881],[-.10805494870734367,.10805494870734367,-.31911236892788974,.31911236892788974,-.5152486363581541,.5152486363581541,-.6872929048116855,.6872929048116855,-.827201315069765,.827201315069765,-.9284348836635735,.9284348836635735,-.9862838086968123,.9862838086968123],[0,-.20119409399743451,.20119409399743451,-.3941513470775634,.3941513470775634,-.5709721726085388,.5709721726085388,-.7244177313601701,.7244177313601701,-.8482065834104272,.8482065834104272,-.937273392400706,.937273392400706,-.9879925180204854,.9879925180204854],[-.09501250983763744,.09501250983763744,-.2816035507792589,.2816035507792589,-.45801677765722737,.45801677765722737,-.6178762444026438,.6178762444026438,-.755404408355003,.755404408355003,-.8656312023878318,.8656312023878318,-.9445750230732326,.9445750230732326,-.9894009349916499,.9894009349916499],[0,-.17848418149584785,.17848418149584785,-.3512317634538763,.3512317634538763,-.5126905370864769,.5126905370864769,-.6576711592166907,.6576711592166907,-.7815140038968014,.7815140038968014,-.8802391537269859,.8802391537269859,-.9506755217687678,.9506755217687678,-.9905754753144174,.9905754753144174],[-.0847750130417353,.0847750130417353,-.2518862256915055,.2518862256915055,-.41175116146284263,.41175116146284263,-.5597708310739475,.5597708310739475,-.6916870430603532,.6916870430603532,-.8037049589725231,.8037049589725231,-.8926024664975557,.8926024664975557,-.9558239495713977,.9558239495713977,-.9915651684209309,.9915651684209309],[0,-.16035864564022537,.16035864564022537,-.31656409996362983,.31656409996362983,-.46457074137596094,.46457074137596094,-.600545304661681,.600545304661681,-.7209661773352294,.7209661773352294,-.8227146565371428,.8227146565371428,-.9031559036148179,.9031559036148179,-.96020815213483,.96020815213483,-.9924068438435844,.9924068438435844],[-.07652652113349734,.07652652113349734,-.22778585114164507,.22778585114164507,-.37370608871541955,.37370608871541955,-.5108670019508271,.5108670019508271,-.636053680726515,.636053680726515,-.7463319064601508,.7463319064601508,-.8391169718222188,.8391169718222188,-.912234428251326,.912234428251326,-.9639719272779138,.9639719272779138,-.9931285991850949,.9931285991850949],[0,-.1455618541608951,.1455618541608951,-.2880213168024011,.2880213168024011,-.4243421202074388,.4243421202074388,-.5516188358872198,.5516188358872198,-.6671388041974123,.6671388041974123,-.7684399634756779,.7684399634756779,-.8533633645833173,.8533633645833173,-.9200993341504008,.9200993341504008,-.9672268385663063,.9672268385663063,-.9937521706203895,.9937521706203895],[-.06973927331972223,.06973927331972223,-.20786042668822127,.20786042668822127,-.34193582089208424,.34193582089208424,-.469355837986757,.469355837986757,-.5876404035069116,.5876404035069116,-.6944872631866827,.6944872631866827,-.7878168059792081,.7878168059792081,-.8658125777203002,.8658125777203002,-.926956772187174,.926956772187174,-.9700604978354287,.9700604978354287,-.9942945854823992,.9942945854823992],[0,-.1332568242984661,.1332568242984661,-.26413568097034495,.26413568097034495,-.3903010380302908,.3903010380302908,-.5095014778460075,.5095014778460075,-.6196098757636461,.6196098757636461,-.7186613631319502,.7186613631319502,-.8048884016188399,.8048884016188399,-.8767523582704416,.8767523582704416,-.9329710868260161,.9329710868260161,-.9725424712181152,.9725424712181152,-.9947693349975522,.9947693349975522],[-.06405689286260563,.06405689286260563,-.1911188674736163,.1911188674736163,-.3150426796961634,.3150426796961634,-.4337935076260451,.4337935076260451,-.5454214713888396,.5454214713888396,-.6480936519369755,.6480936519369755,-.7401241915785544,.7401241915785544,-.820001985973903,.820001985973903,-.8864155270044011,.8864155270044011,-.9382745520027328,.9382745520027328,-.9747285559713095,.9747285559713095,-.9951872199970213,.9951872199970213]],m.cValues=[[],[],[1,1],[.8888888888888888,.5555555555555556,.5555555555555556],[.6521451548625461,.6521451548625461,.34785484513745385,.34785484513745385],[.5688888888888889,.47862867049936647,.47862867049936647,.23692688505618908,.23692688505618908],[.3607615730481386,.3607615730481386,.46791393457269104,.46791393457269104,.17132449237917036,.17132449237917036],[.4179591836734694,.3818300505051189,.3818300505051189,.27970539148927664,.27970539148927664,.1294849661688697,.1294849661688697],[.362683783378362,.362683783378362,.31370664587788727,.31370664587788727,.22238103445337448,.22238103445337448,.10122853629037626,.10122853629037626],[.3302393550012598,.1806481606948574,.1806481606948574,.08127438836157441,.08127438836157441,.31234707704000286,.31234707704000286,.26061069640293544,.26061069640293544],[.29552422471475287,.29552422471475287,.26926671930999635,.26926671930999635,.21908636251598204,.21908636251598204,.1494513491505806,.1494513491505806,.06667134430868814,.06667134430868814],[.2729250867779006,.26280454451024665,.26280454451024665,.23319376459199048,.23319376459199048,.18629021092773426,.18629021092773426,.1255803694649046,.1255803694649046,.05566856711617366,.05566856711617366],[.24914704581340277,.24914704581340277,.2334925365383548,.2334925365383548,.20316742672306592,.20316742672306592,.16007832854334622,.16007832854334622,.10693932599531843,.10693932599531843,.04717533638651183,.04717533638651183],[.2325515532308739,.22628318026289723,.22628318026289723,.2078160475368885,.2078160475368885,.17814598076194574,.17814598076194574,.13887351021978725,.13887351021978725,.09212149983772845,.09212149983772845,.04048400476531588,.04048400476531588],[.2152638534631578,.2152638534631578,.2051984637212956,.2051984637212956,.18553839747793782,.18553839747793782,.15720316715819355,.15720316715819355,.12151857068790319,.12151857068790319,.08015808715976021,.08015808715976021,.03511946033175186,.03511946033175186],[.2025782419255613,.19843148532711158,.19843148532711158,.1861610000155622,.1861610000155622,.16626920581699392,.16626920581699392,.13957067792615432,.13957067792615432,.10715922046717194,.10715922046717194,.07036604748810812,.07036604748810812,.03075324199611727,.03075324199611727],[.1894506104550685,.1894506104550685,.18260341504492358,.18260341504492358,.16915651939500254,.16915651939500254,.14959598881657674,.14959598881657674,.12462897125553388,.12462897125553388,.09515851168249279,.09515851168249279,.062253523938647894,.062253523938647894,.027152459411754096,.027152459411754096],[.17944647035620653,.17656270536699264,.17656270536699264,.16800410215645004,.16800410215645004,.15404576107681028,.15404576107681028,.13513636846852548,.13513636846852548,.11188384719340397,.11188384719340397,.08503614831717918,.08503614831717918,.0554595293739872,.0554595293739872,.02414830286854793,.02414830286854793],[.1691423829631436,.1691423829631436,.16427648374583273,.16427648374583273,.15468467512626524,.15468467512626524,.14064291467065065,.14064291467065065,.12255520671147846,.12255520671147846,.10094204410628717,.10094204410628717,.07642573025488905,.07642573025488905,.0497145488949698,.0497145488949698,.02161601352648331,.02161601352648331],[.1610544498487837,.15896884339395434,.15896884339395434,.15276604206585967,.15276604206585967,.1426067021736066,.1426067021736066,.12875396253933621,.12875396253933621,.11156664554733399,.11156664554733399,.09149002162245,.09149002162245,.06904454273764123,.06904454273764123,.0448142267656996,.0448142267656996,.019461788229726478,.019461788229726478],[.15275338713072584,.15275338713072584,.14917298647260374,.14917298647260374,.14209610931838204,.14209610931838204,.13168863844917664,.13168863844917664,.11819453196151841,.11819453196151841,.10193011981724044,.10193011981724044,.08327674157670475,.08327674157670475,.06267204833410907,.06267204833410907,.04060142980038694,.04060142980038694,.017614007139152118,.017614007139152118],[.14608113364969041,.14452440398997005,.14452440398997005,.13988739479107315,.13988739479107315,.13226893863333747,.13226893863333747,.12183141605372853,.12183141605372853,.10879729916714838,.10879729916714838,.09344442345603386,.09344442345603386,.0761001136283793,.0761001136283793,.057134425426857205,.057134425426857205,.036953789770852494,.036953789770852494,.016017228257774335,.016017228257774335],[.13925187285563198,.13925187285563198,.13654149834601517,.13654149834601517,.13117350478706238,.13117350478706238,.12325237681051242,.12325237681051242,.11293229608053922,.11293229608053922,.10041414444288096,.10041414444288096,.08594160621706773,.08594160621706773,.06979646842452049,.06979646842452049,.052293335152683286,.052293335152683286,.03377490158481415,.03377490158481415,.0146279952982722,.0146279952982722],[.13365457218610619,.1324620394046966,.1324620394046966,.12890572218808216,.12890572218808216,.12304908430672953,.12304908430672953,.11499664022241136,.11499664022241136,.10489209146454141,.10489209146454141,.09291576606003515,.09291576606003515,.07928141177671895,.07928141177671895,.06423242140852585,.06423242140852585,.04803767173108467,.04803767173108467,.030988005856979445,.030988005856979445,.013411859487141771,.013411859487141771],[.12793819534675216,.12793819534675216,.1258374563468283,.1258374563468283,.12167047292780339,.12167047292780339,.1155056680537256,.1155056680537256,.10744427011596563,.10744427011596563,.09761865210411388,.09761865210411388,.08619016153195327,.08619016153195327,.0733464814110803,.0733464814110803,.05929858491543678,.05929858491543678,.04427743881741981,.04427743881741981,.028531388628933663,.028531388628933663,.0123412297999872,.0123412297999872]],m.binomialCoefficients=[[1],[1,1],[1,2,1],[1,3,3,1]];const w=(h,r,l)=>{let o,a;const c=l/2;o=0;for(let i=0;i<20;i++)a=c*m.tValues[20][i]+c,o+=m.cValues[20][i]*R(h,r,a);return c*o};m.getCubicArcLength=w;const L=(h,r,l)=>{l===void 0&&(l=1);const o=h[0]-2*h[1]+h[2],a=r[0]-2*r[1]+r[2],g=2*h[1]-2*h[0],c=2*r[1]-2*r[0],i=4*(o*o+a*a),n=4*(o*g+a*c),d=g*g+c*c;if(i===0)return l*Math.sqrt(Math.pow(h[2]-h[0],2)+Math.pow(r[2]-r[0],2));const y=n/(2*i),b=d/i,e=l+y,t=b-y*y,s=e*e+t>0?Math.sqrt(e*e+t):0,p=y*y+t>0?Math.sqrt(y*y+t):0,P=y+Math.sqrt(y*y+t)!==0?t*Math.log(Math.abs((e+s)/(y+p))):0;return Math.sqrt(i)/2*(e*s-y*p+P)};m.getQuadraticArcLength=L;function R(h,r,l){const o=C(1,l,h),a=C(1,l,r),g=o*o+a*a;return Math.sqrt(g)}const C=(h,r,l)=>{const o=l.length-1;let a,g;if(o===0)return 0;if(h===0){g=0;for(let c=0;c<=o;c++)g+=m.binomialCoefficients[o][c]*Math.pow(1-r,o-c)*Math.pow(r,c)*l[c];return g}else{a=new Array(o);for(let c=0;c<o;c++)a[c]=o*(l[c+1]-l[c]);return C(h-1,r,a)}},f=(h,r,l)=>{let o=1,a=h/r,g=(h-l(a))/r,c=0;for(;o>.001;){const i=l(a+g),n=Math.abs(h-i)/r;if(n<o)o=n,a+=g;else{const d=l(a-g),y=Math.abs(h-d)/r;y<o?(o=y,a-=g):g/=2}if(c++,c>500)break}return a};m.t2length=f})(Ye)),Ye}var ki;function Qe(){if(ki)return Xt;ki=1,Object.defineProperty(Xt,"__esModule",{value:!0}),Xt.Path=void 0;const m=rt(),w=nt(),L=_t(),R=Qn();let C=class xt extends L.Shape{constructor(h){super(h),this.dataArray=[],this.pathLength=0,this._readDataAttribute(),this.on("dataChange.konva",function(){this._readDataAttribute()})}_readDataAttribute(){this.dataArray=xt.parsePathData(this.data()),this.pathLength=xt.getPathLength(this.dataArray)}_sceneFunc(h){const r=this.dataArray;h.beginPath();let l=!1;for(let o=0;o<r.length;o++){const a=r[o].command,g=r[o].points;switch(a){case"L":h.lineTo(g[0],g[1]);break;case"M":h.moveTo(g[0],g[1]);break;case"C":h.bezierCurveTo(g[0],g[1],g[2],g[3],g[4],g[5]);break;case"Q":h.quadraticCurveTo(g[0],g[1],g[2],g[3]);break;case"A":const c=g[0],i=g[1],n=g[2],d=g[3],y=g[4],b=g[5],e=g[6],t=g[7],s=n>d?n:d,p=n>d?1:n/d,P=n>d?d/n:1;h.translate(c,i),h.rotate(e),h.scale(p,P),h.arc(0,0,s,y,y+b,1-t),h.scale(1/p,1/P),h.rotate(-e),h.translate(-c,-i);break;case"z":l=!0,h.closePath();break}}!l&&!this.hasFill()?h.strokeShape(this):h.fillStrokeShape(this)}getSelfRect(){let h=[];this.dataArray.forEach(function(i){if(i.command==="A"){const n=i.points[4],d=i.points[5],y=i.points[4]+d;let b=Math.PI/180;if(Math.abs(n-y)<b&&(b=Math.abs(n-y)),d<0)for(let e=n-b;e>y;e-=b){const t=xt.getPointOnEllipticalArc(i.points[0],i.points[1],i.points[2],i.points[3],e,0);h.push(t.x,t.y)}else for(let e=n+b;e<y;e+=b){const t=xt.getPointOnEllipticalArc(i.points[0],i.points[1],i.points[2],i.points[3],e,0);h.push(t.x,t.y)}}else if(i.command==="C")for(let n=0;n<=1;n+=.01){const d=xt.getPointOnCubicBezier(n,i.start.x,i.start.y,i.points[0],i.points[1],i.points[2],i.points[3],i.points[4],i.points[5]);h.push(d.x,d.y)}else h=h.concat(i.points)});let r=h[0],l=h[0],o=h[1],a=h[1],g,c;for(let i=0;i<h.length/2;i++)g=h[i*2],c=h[i*2+1],isNaN(g)||(r=Math.min(r,g),l=Math.max(l,g)),isNaN(c)||(o=Math.min(o,c),a=Math.max(a,c));return{x:r,y:o,width:l-r,height:a-o}}getLength(){return this.pathLength}getPointAtLength(h){return xt.getPointAtLengthOfDataArray(h,this.dataArray)}static getLineLength(h,r,l,o){return Math.sqrt((l-h)*(l-h)+(o-r)*(o-r))}static getPathLength(h){let r=0;for(let l=0;l<h.length;++l)r+=h[l].pathLength;return r}static getPointAtLengthOfDataArray(h,r){let l,o=0,a=r.length;if(!a)return null;for(;o<a&&h>r[o].pathLength;)h-=r[o].pathLength,++o;if(o===a)return l=r[o-1].points.slice(-2),{x:l[0],y:l[1]};if(h<.01)return r[o].command==="M"?(l=r[o].points.slice(0,2),{x:l[0],y:l[1]}):{x:r[o].start.x,y:r[o].start.y};const g=r[o],c=g.points;switch(g.command){case"L":return xt.getPointOnLine(h,g.start.x,g.start.y,c[0],c[1]);case"C":return xt.getPointOnCubicBezier((0,R.t2length)(h,xt.getPathLength(r),s=>(0,R.getCubicArcLength)([g.start.x,c[0],c[2],c[4]],[g.start.y,c[1],c[3],c[5]],s)),g.start.x,g.start.y,c[0],c[1],c[2],c[3],c[4],c[5]);case"Q":return xt.getPointOnQuadraticBezier((0,R.t2length)(h,xt.getPathLength(r),s=>(0,R.getQuadraticArcLength)([g.start.x,c[0],c[2]],[g.start.y,c[1],c[3]],s)),g.start.x,g.start.y,c[0],c[1],c[2],c[3]);case"A":const i=c[0],n=c[1],d=c[2],y=c[3],b=c[5],e=c[6];let t=c[4];return t+=b*h/g.pathLength,xt.getPointOnEllipticalArc(i,n,d,y,t,e)}return null}static getPointOnLine(h,r,l,o,a,g,c){g=g??r,c=c??l;const i=this.getLineLength(r,l,o,a);if(i<1e-10)return{x:r,y:l};if(o===r)return{x:g,y:c+(a>l?h:-h)};const n=(a-l)/(o-r),d=Math.sqrt(h*h/(1+n*n))*(o<r?-1:1),y=n*d;if(Math.abs(c-l-n*(g-r))<1e-10)return{x:g+d,y:c+y};const b=((g-r)*(o-r)+(c-l)*(a-l))/(i*i),e=r+b*(o-r),t=l+b*(a-l),s=this.getLineLength(g,c,e,t),p=Math.sqrt(h*h-s*s),P=Math.sqrt(p*p/(1+n*n))*(o<r?-1:1),G=n*P;return{x:e+P,y:t+G}}static getPointOnCubicBezier(h,r,l,o,a,g,c,i,n){function d(p){return p*p*p}function y(p){return 3*p*p*(1-p)}function b(p){return 3*p*(1-p)*(1-p)}function e(p){return(1-p)*(1-p)*(1-p)}const t=i*d(h)+g*y(h)+o*b(h)+r*e(h),s=n*d(h)+c*y(h)+a*b(h)+l*e(h);return{x:t,y:s}}static getPointOnQuadraticBezier(h,r,l,o,a,g,c){function i(e){return e*e}function n(e){return 2*e*(1-e)}function d(e){return(1-e)*(1-e)}const y=g*i(h)+o*n(h)+r*d(h),b=c*i(h)+a*n(h)+l*d(h);return{x:y,y:b}}static getPointOnEllipticalArc(h,r,l,o,a,g){const c=Math.cos(g),i=Math.sin(g),n={x:l*Math.cos(a),y:o*Math.sin(a)};return{x:h+(n.x*c-n.y*i),y:r+(n.x*i+n.y*c)}}static parsePathData(h){if(!h)return[];let r=h;const l=["m","M","l","L","v","V","h","H","z","Z","c","C","q","Q","t","T","s","S","a","A"];r=r.replace(new RegExp(" ","g"),",");for(let y=0;y<l.length;y++)r=r.replace(new RegExp(l[y],"g"),"|"+l[y]);const o=r.split("|"),a=[],g=[];let c=0,i=0;const n=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:e[-+]?\d+)?)/gi;let d;for(let y=1;y<o.length;y++){let b=o[y],e=b.charAt(0);for(b=b.slice(1),g.length=0;d=n.exec(b);)g.push(d[0]);const t=[];for(let s=0,p=g.length;s<p;s++){if(g[s]==="00"){t.push(0,0);continue}const P=parseFloat(g[s]);isNaN(P)?t.push(0):t.push(P)}for(;t.length>0&&!isNaN(t[0]);){let s="",p=[];const P=c,G=i;let _,v,S,k,F,D,I,N,W,u;switch(e){case"l":c+=t.shift(),i+=t.shift(),s="L",p.push(c,i);break;case"L":c=t.shift(),i=t.shift(),p.push(c,i);break;case"m":const x=t.shift(),E=t.shift();if(c+=x,i+=E,s="M",a.length>2&&a[a.length-1].command==="z"){for(let T=a.length-2;T>=0;T--)if(a[T].command==="M"){c=a[T].points[0]+x,i=a[T].points[1]+E;break}}p.push(c,i),e="l";break;case"M":c=t.shift(),i=t.shift(),s="M",p.push(c,i),e="L";break;case"h":c+=t.shift(),s="L",p.push(c,i);break;case"H":c=t.shift(),s="L",p.push(c,i);break;case"v":i+=t.shift(),s="L",p.push(c,i);break;case"V":i=t.shift(),s="L",p.push(c,i);break;case"C":p.push(t.shift(),t.shift(),t.shift(),t.shift()),c=t.shift(),i=t.shift(),p.push(c,i);break;case"c":p.push(c+t.shift(),i+t.shift(),c+t.shift(),i+t.shift()),c+=t.shift(),i+=t.shift(),s="C",p.push(c,i);break;case"S":v=c,S=i,_=a[a.length-1],_.command==="C"&&(v=c+(c-_.points[2]),S=i+(i-_.points[3])),p.push(v,S,t.shift(),t.shift()),c=t.shift(),i=t.shift(),s="C",p.push(c,i);break;case"s":v=c,S=i,_=a[a.length-1],_.command==="C"&&(v=c+(c-_.points[2]),S=i+(i-_.points[3])),p.push(v,S,c+t.shift(),i+t.shift()),c+=t.shift(),i+=t.shift(),s="C",p.push(c,i);break;case"Q":p.push(t.shift(),t.shift()),c=t.shift(),i=t.shift(),p.push(c,i);break;case"q":p.push(c+t.shift(),i+t.shift()),c+=t.shift(),i+=t.shift(),s="Q",p.push(c,i);break;case"T":v=c,S=i,_=a[a.length-1],_.command==="Q"&&(v=c+(c-_.points[0]),S=i+(i-_.points[1])),c=t.shift(),i=t.shift(),s="Q",p.push(v,S,c,i);break;case"t":v=c,S=i,_=a[a.length-1],_.command==="Q"&&(v=c+(c-_.points[0]),S=i+(i-_.points[1])),c+=t.shift(),i+=t.shift(),s="Q",p.push(v,S,c,i);break;case"A":k=t.shift(),F=t.shift(),D=t.shift(),I=t.shift(),N=t.shift(),W=c,u=i,c=t.shift(),i=t.shift(),s="A",p=this.convertEndpointToCenterParameterization(W,u,c,i,I,N,k,F,D);break;case"a":k=t.shift(),F=t.shift(),D=t.shift(),I=t.shift(),N=t.shift(),W=c,u=i,c+=t.shift(),i+=t.shift(),s="A",p=this.convertEndpointToCenterParameterization(W,u,c,i,I,N,k,F,D);break}a.push({command:s||e,points:p,start:{x:P,y:G},pathLength:this.calcLength(P,G,s||e,p)})}(e==="z"||e==="Z")&&a.push({command:"z",points:[],start:void 0,pathLength:0})}return a}static calcLength(h,r,l,o){let a,g,c,i;const n=xt;switch(l){case"L":return n.getLineLength(h,r,o[0],o[1]);case"C":return(0,R.getCubicArcLength)([h,o[0],o[2],o[4]],[r,o[1],o[3],o[5]],1);case"Q":return(0,R.getQuadraticArcLength)([h,o[0],o[2]],[r,o[1],o[3]],1);case"A":a=0;const d=o[4],y=o[5],b=o[4]+y;let e=Math.PI/180;if(Math.abs(d-b)<e&&(e=Math.abs(d-b)),g=n.getPointOnEllipticalArc(o[0],o[1],o[2],o[3],d,0),y<0)for(i=d-e;i>b;i-=e)c=n.getPointOnEllipticalArc(o[0],o[1],o[2],o[3],i,0),a+=n.getLineLength(g.x,g.y,c.x,c.y),g=c;else for(i=d+e;i<b;i+=e)c=n.getPointOnEllipticalArc(o[0],o[1],o[2],o[3],i,0),a+=n.getLineLength(g.x,g.y,c.x,c.y),g=c;return c=n.getPointOnEllipticalArc(o[0],o[1],o[2],o[3],b,0),a+=n.getLineLength(g.x,g.y,c.x,c.y),a}return 0}static convertEndpointToCenterParameterization(h,r,l,o,a,g,c,i,n){const d=n*(Math.PI/180),y=Math.cos(d)*(h-l)/2+Math.sin(d)*(r-o)/2,b=-1*Math.sin(d)*(h-l)/2+Math.cos(d)*(r-o)/2,e=y*y/(c*c)+b*b/(i*i);e>1&&(c*=Math.sqrt(e),i*=Math.sqrt(e));let t=Math.sqrt((c*c*(i*i)-c*c*(b*b)-i*i*(y*y))/(c*c*(b*b)+i*i*(y*y)));a===g&&(t*=-1),isNaN(t)&&(t=0);const s=t*c*b/i,p=t*-i*y/c,P=(h+l)/2+Math.cos(d)*s-Math.sin(d)*p,G=(r+o)/2+Math.sin(d)*s+Math.cos(d)*p,_=function(N){return Math.sqrt(N[0]*N[0]+N[1]*N[1])},v=function(N,W){return(N[0]*W[0]+N[1]*W[1])/(_(N)*_(W))},S=function(N,W){return(N[0]*W[1]<N[1]*W[0]?-1:1)*Math.acos(v(N,W))},k=S([1,0],[(y-s)/c,(b-p)/i]),F=[(y-s)/c,(b-p)/i],D=[(-1*y-s)/c,(-1*b-p)/i];let I=S(F,D);return v(F,D)<=-1&&(I=Math.PI),v(F,D)>=1&&(I=0),g===0&&I>0&&(I=I-2*Math.PI),g===1&&I<0&&(I=I+2*Math.PI),[P,G,c,i,k,I,d,g]}};return Xt.Path=C,C.prototype.className="Path",C.prototype._attrsAffectingSize=["data"],(0,w._registerNode)(C),m.Factory.addGetterSetter(C,"data"),Xt}var Ri;function Jn(){if(Ri)return jt;Ri=1,Object.defineProperty(jt,"__esModule",{value:!0}),jt.Arrow=void 0;const m=rt(),w=fn(),L=st(),R=nt(),C=Qe();let f=class extends w.Line{_sceneFunc(r){super._sceneFunc(r);const l=Math.PI*2,o=this.points();let a=o;const g=this.tension()!==0&&o.length>4;g&&(a=this.getTensionPoints());const c=this.pointerLength(),i=o.length;let n,d;if(g){const e=[a[a.length-4],a[a.length-3],a[a.length-2],a[a.length-1],o[i-2],o[i-1]],t=C.Path.calcLength(a[a.length-4],a[a.length-3],"C",e),s=C.Path.getPointOnQuadraticBezier(Math.min(1,1-c/t),e[0],e[1],e[2],e[3],e[4],e[5]);n=o[i-2]-s.x,d=o[i-1]-s.y}else n=o[i-2]-o[i-4],d=o[i-1]-o[i-3];const y=(Math.atan2(d,n)+l)%l,b=this.pointerWidth();this.pointerAtEnding()&&(r.save(),r.beginPath(),r.translate(o[i-2],o[i-1]),r.rotate(y),r.moveTo(0,0),r.lineTo(-c,b/2),r.lineTo(-c,-b/2),r.closePath(),r.restore(),this.__fillStroke(r)),this.pointerAtBeginning()&&(r.save(),r.beginPath(),r.translate(o[0],o[1]),g?(n=(a[0]+a[2])/2-o[0],d=(a[1]+a[3])/2-o[1]):(n=o[2]-o[0],d=o[3]-o[1]),r.rotate((Math.atan2(-d,-n)+l)%l),r.moveTo(0,0),r.lineTo(-c,b/2),r.lineTo(-c,-b/2),r.closePath(),r.restore(),this.__fillStroke(r))}__fillStroke(r){const l=this.dashEnabled();l&&(this.attrs.dashEnabled=!1,r.setLineDash([])),r.fillStrokeShape(this),l&&(this.attrs.dashEnabled=!0)}getSelfRect(){const r=super.getSelfRect(),l=this.pointerWidth()/2;return{x:r.x,y:r.y-l,width:r.width,height:r.height+l*2}}};return jt.Arrow=f,f.prototype.className="Arrow",(0,R._registerNode)(f),m.Factory.addGetterSetter(f,"pointerLength",10,(0,L.getNumberValidator)()),m.Factory.addGetterSetter(f,"pointerWidth",10,(0,L.getNumberValidator)()),m.Factory.addGetterSetter(f,"pointerAtBeginning",!1),m.Factory.addGetterSetter(f,"pointerAtEnding",!0),jt}var $t={},Ti;function Zn(){if(Ti)return $t;Ti=1,Object.defineProperty($t,"__esModule",{value:!0}),$t.Circle=void 0;const m=rt(),w=_t(),L=st(),R=nt();let C=class extends w.Shape{_sceneFunc(h){h.beginPath(),h.arc(0,0,this.attrs.radius||0,0,Math.PI*2,!1),h.closePath(),h.fillStrokeShape(this)}getWidth(){return this.radius()*2}getHeight(){return this.radius()*2}setWidth(h){this.radius()!==h/2&&this.radius(h/2)}setHeight(h){this.radius()!==h/2&&this.radius(h/2)}};return $t.Circle=C,C.prototype._centroid=!0,C.prototype.className="Circle",C.prototype._attrsAffectingSize=["radius"],(0,R._registerNode)(C),m.Factory.addGetterSetter(C,"radius",0,(0,L.getNumberValidator)()),$t}var Qt={},Ai;function tr(){if(Ai)return Qt;Ai=1,Object.defineProperty(Qt,"__esModule",{value:!0}),Qt.Ellipse=void 0;const m=rt(),w=_t(),L=st(),R=nt();let C=class extends w.Shape{_sceneFunc(h){const r=this.radiusX(),l=this.radiusY();h.beginPath(),h.save(),r!==l&&h.scale(1,l/r),h.arc(0,0,r,0,Math.PI*2,!1),h.restore(),h.closePath(),h.fillStrokeShape(this)}getWidth(){return this.radiusX()*2}getHeight(){return this.radiusY()*2}setWidth(h){this.radiusX(h/2)}setHeight(h){this.radiusY(h/2)}};return Qt.Ellipse=C,C.prototype.className="Ellipse",C.prototype._centroid=!0,C.prototype._attrsAffectingSize=["radiusX","radiusY"],(0,R._registerNode)(C),m.Factory.addComponentsGetterSetter(C,"radius",["x","y"]),m.Factory.addGetterSetter(C,"radiusX",0,(0,L.getNumberValidator)()),m.Factory.addGetterSetter(C,"radiusY",0,(0,L.getNumberValidator)()),Qt}var Jt={},Ei;function er(){if(Ei)return Jt;Ei=1,Object.defineProperty(Jt,"__esModule",{value:!0}),Jt.Image=void 0;const m=dt(),w=rt(),L=_t(),R=nt(),C=st();class f extends L.Shape{constructor(r){super(r),this._loadListener=()=>{this._requestDraw()},this.on("imageChange.konva",l=>{this._removeImageLoad(l.oldVal),this._setImageLoad()}),this._setImageLoad()}_setImageLoad(){const r=this.image();r&&r.complete||r&&r.readyState===4||r&&r.addEventListener&&r.addEventListener("load",this._loadListener)}_removeImageLoad(r){r&&r.removeEventListener&&r.removeEventListener("load",this._loadListener)}destroy(){return this._removeImageLoad(this.image()),super.destroy(),this}_useBufferCanvas(){const r=!!this.cornerRadius(),l=this.hasShadow();return r&&l?!0:super._useBufferCanvas(!0)}_sceneFunc(r){const l=this.getWidth(),o=this.getHeight(),a=this.cornerRadius(),g=this.attrs.image;let c;if(g){const i=this.attrs.cropWidth,n=this.attrs.cropHeight;i&&n?c=[g,this.cropX(),this.cropY(),i,n,0,0,l,o]:c=[g,0,0,l,o]}(this.hasFill()||this.hasStroke()||a)&&(r.beginPath(),a?m.Util.drawRoundedRectPath(r,l,o,a):r.rect(0,0,l,o),r.closePath(),r.fillStrokeShape(this)),g&&(a&&r.clip(),r.drawImage.apply(r,c))}_hitFunc(r){const l=this.width(),o=this.height(),a=this.cornerRadius();r.beginPath(),a?m.Util.drawRoundedRectPath(r,l,o,a):r.rect(0,0,l,o),r.closePath(),r.fillStrokeShape(this)}getWidth(){var r,l;return(r=this.attrs.width)!==null&&r!==void 0?r:(l=this.image())===null||l===void 0?void 0:l.width}getHeight(){var r,l;return(r=this.attrs.height)!==null&&r!==void 0?r:(l=this.image())===null||l===void 0?void 0:l.height}static fromURL(r,l,o=null){const a=m.Util.createImageElement();a.onload=function(){const g=new f({image:a});l(g)},a.onerror=o,a.crossOrigin="Anonymous",a.src=r}}return Jt.Image=f,f.prototype.className="Image",(0,R._registerNode)(f),w.Factory.addGetterSetter(f,"cornerRadius",0,(0,C.getNumberOrArrayOfNumbersValidator)(4)),w.Factory.addGetterSetter(f,"image"),w.Factory.addComponentsGetterSetter(f,"crop",["x","y","width","height"]),w.Factory.addGetterSetter(f,"cropX",0,(0,C.getNumberValidator)()),w.Factory.addGetterSetter(f,"cropY",0,(0,C.getNumberValidator)()),w.Factory.addGetterSetter(f,"cropWidth",0,(0,C.getNumberValidator)()),w.Factory.addGetterSetter(f,"cropHeight",0,(0,C.getNumberValidator)()),Jt}var Gt={},Fi;function ir(){if(Fi)return Gt;Fi=1,Object.defineProperty(Gt,"__esModule",{value:!0}),Gt.Tag=Gt.Label=void 0;const m=rt(),w=_t(),L=Xe(),R=st(),C=nt(),f=["fontFamily","fontSize","fontStyle","padding","lineHeight","text","width","height","pointerDirection","pointerWidth","pointerHeight"],h="Change.konva",r="none",l="up",o="right",a="down",g="left",c=f.length;let i=class extends L.Group{constructor(y){super(y),this.on("add.konva",function(b){this._addListeners(b.child),this._sync()})}getText(){return this.find("Text")[0]}getTag(){return this.find("Tag")[0]}_addListeners(y){let b=this,e;const t=function(){b._sync()};for(e=0;e<c;e++)y.on(f[e]+h,t)}getWidth(){return this.getText().width()}getHeight(){return this.getText().height()}_sync(){let y=this.getText(),b=this.getTag(),e,t,s,p,P,G,_;if(y&&b){switch(e=y.width(),t=y.height(),s=b.pointerDirection(),p=b.pointerWidth(),_=b.pointerHeight(),P=0,G=0,s){case l:P=e/2,G=-1*_;break;case o:P=e+p,G=t/2;break;case a:P=e/2,G=t+_;break;case g:P=-1*p,G=t/2;break}b.setAttrs({x:-1*P,y:-1*G,width:e,height:t}),y.setAttrs({x:-1*P,y:-1*G})}}};Gt.Label=i,i.prototype.className="Label",(0,C._registerNode)(i);class n extends w.Shape{_sceneFunc(y){const b=this.width(),e=this.height(),t=this.pointerDirection(),s=this.pointerWidth(),p=this.pointerHeight(),P=this.cornerRadius();let G=0,_=0,v=0,S=0;typeof P=="number"?G=_=v=S=Math.min(P,b/2,e/2):(G=Math.min(P[0]||0,b/2,e/2),_=Math.min(P[1]||0,b/2,e/2),S=Math.min(P[2]||0,b/2,e/2),v=Math.min(P[3]||0,b/2,e/2)),y.beginPath(),y.moveTo(G,0),t===l&&(y.lineTo((b-s)/2,0),y.lineTo(b/2,-1*p),y.lineTo((b+s)/2,0)),y.lineTo(b-_,0),y.arc(b-_,_,_,Math.PI*3/2,0,!1),t===o&&(y.lineTo(b,(e-p)/2),y.lineTo(b+s,e/2),y.lineTo(b,(e+p)/2)),y.lineTo(b,e-S),y.arc(b-S,e-S,S,0,Math.PI/2,!1),t===a&&(y.lineTo((b+s)/2,e),y.lineTo(b/2,e+p),y.lineTo((b-s)/2,e)),y.lineTo(v,e),y.arc(v,e-v,v,Math.PI/2,Math.PI,!1),t===g&&(y.lineTo(0,(e+p)/2),y.lineTo(-1*s,e/2),y.lineTo(0,(e-p)/2)),y.lineTo(0,G),y.arc(G,G,G,Math.PI,Math.PI*3/2,!1),y.closePath(),y.fillStrokeShape(this)}getSelfRect(){let y=0,b=0,e=this.pointerWidth(),t=this.pointerHeight(),s=this.pointerDirection(),p=this.width(),P=this.height();return s===l?(b-=t,P+=t):s===a?P+=t:s===g?(y-=e*1.5,p+=e):s===o&&(p+=e*1.5),{x:y,y:b,width:p,height:P}}}return Gt.Tag=n,n.prototype.className="Tag",(0,C._registerNode)(n),m.Factory.addGetterSetter(n,"pointerDirection",r),m.Factory.addGetterSetter(n,"pointerWidth",0,(0,R.getNumberValidator)()),m.Factory.addGetterSetter(n,"pointerHeight",0,(0,R.getNumberValidator)()),m.Factory.addGetterSetter(n,"cornerRadius",0,(0,R.getNumberOrArrayOfNumbersValidator)(4)),Gt}var Zt={},Mi;function gn(){if(Mi)return Zt;Mi=1,Object.defineProperty(Zt,"__esModule",{value:!0}),Zt.Rect=void 0;const m=rt(),w=_t(),L=nt(),R=dt(),C=st();let f=class extends w.Shape{_sceneFunc(r){const l=this.cornerRadius(),o=this.width(),a=this.height();r.beginPath(),l?R.Util.drawRoundedRectPath(r,o,a,l):r.rect(0,0,o,a),r.closePath(),r.fillStrokeShape(this)}};return Zt.Rect=f,f.prototype.className="Rect",(0,L._registerNode)(f),m.Factory.addGetterSetter(f,"cornerRadius",0,(0,C.getNumberOrArrayOfNumbersValidator)(4)),Zt}var te={},Gi;function nr(){if(Gi)return te;Gi=1,Object.defineProperty(te,"__esModule",{value:!0}),te.RegularPolygon=void 0;const m=rt(),w=_t(),L=st(),R=nt();let C=class extends w.Shape{_sceneFunc(h){const r=this._getPoints();h.beginPath(),h.moveTo(r[0].x,r[0].y);for(let l=1;l<r.length;l++)h.lineTo(r[l].x,r[l].y);h.closePath(),h.fillStrokeShape(this)}_getPoints(){const h=this.attrs.sides,r=this.attrs.radius||0,l=[];for(let o=0;o<h;o++)l.push({x:r*Math.sin(o*2*Math.PI/h),y:-1*r*Math.cos(o*2*Math.PI/h)});return l}getSelfRect(){const h=this._getPoints();let r=h[0].x,l=h[0].y,o=h[0].x,a=h[0].y;return h.forEach(g=>{r=Math.min(r,g.x),l=Math.max(l,g.x),o=Math.min(o,g.y),a=Math.max(a,g.y)}),{x:r,y:o,width:l-r,height:a-o}}getWidth(){return this.radius()*2}getHeight(){return this.radius()*2}setWidth(h){this.radius(h/2)}setHeight(h){this.radius(h/2)}};return te.RegularPolygon=C,C.prototype.className="RegularPolygon",C.prototype._centroid=!0,C.prototype._attrsAffectingSize=["radius"],(0,R._registerNode)(C),m.Factory.addGetterSetter(C,"radius",0,(0,L.getNumberValidator)()),m.Factory.addGetterSetter(C,"sides",0,(0,L.getNumberValidator)()),te}var ee={},Ni;function rr(){if(Ni)return ee;Ni=1,Object.defineProperty(ee,"__esModule",{value:!0}),ee.Ring=void 0;const m=rt(),w=_t(),L=st(),R=nt(),C=Math.PI*2;let f=class extends w.Shape{_sceneFunc(r){r.beginPath(),r.arc(0,0,this.innerRadius(),0,C,!1),r.moveTo(this.outerRadius(),0),r.arc(0,0,this.outerRadius(),C,0,!0),r.closePath(),r.fillStrokeShape(this)}getWidth(){return this.outerRadius()*2}getHeight(){return this.outerRadius()*2}setWidth(r){this.outerRadius(r/2)}setHeight(r){this.outerRadius(r/2)}};return ee.Ring=f,f.prototype.className="Ring",f.prototype._centroid=!0,f.prototype._attrsAffectingSize=["innerRadius","outerRadius"],(0,R._registerNode)(f),m.Factory.addGetterSetter(f,"innerRadius",0,(0,L.getNumberValidator)()),m.Factory.addGetterSetter(f,"outerRadius",0,(0,L.getNumberValidator)()),ee}var ie={},Li;function sr(){if(Li)return ie;Li=1,Object.defineProperty(ie,"__esModule",{value:!0}),ie.Sprite=void 0;const m=rt(),w=_t(),L=$e(),R=st(),C=nt();let f=class extends w.Shape{constructor(r){super(r),this._updated=!0,this.anim=new L.Animation(()=>{const l=this._updated;return this._updated=!1,l}),this.on("animationChange.konva",function(){this.frameIndex(0)}),this.on("frameIndexChange.konva",function(){this._updated=!0}),this.on("frameRateChange.konva",function(){this.anim.isRunning()&&(clearInterval(this.interval),this._setInterval())})}_sceneFunc(r){const l=this.animation(),o=this.frameIndex(),a=o*4,g=this.animations()[l],c=this.frameOffsets(),i=g[a+0],n=g[a+1],d=g[a+2],y=g[a+3],b=this.image();if((this.hasFill()||this.hasStroke())&&(r.beginPath(),r.rect(0,0,d,y),r.closePath(),r.fillStrokeShape(this)),b)if(c){const e=c[l],t=o*2;r.drawImage(b,i,n,d,y,e[t+0],e[t+1],d,y)}else r.drawImage(b,i,n,d,y,0,0,d,y)}_hitFunc(r){const l=this.animation(),o=this.frameIndex(),a=o*4,g=this.animations()[l],c=this.frameOffsets(),i=g[a+2],n=g[a+3];if(r.beginPath(),c){const d=c[l],y=o*2;r.rect(d[y+0],d[y+1],i,n)}else r.rect(0,0,i,n);r.closePath(),r.fillShape(this)}_useBufferCanvas(){return super._useBufferCanvas(!0)}_setInterval(){const r=this;this.interval=setInterval(function(){r._updateIndex()},1e3/this.frameRate())}start(){if(this.isRunning())return;const r=this.getLayer();this.anim.setLayers(r),this._setInterval(),this.anim.start()}stop(){this.anim.stop(),clearInterval(this.interval)}isRunning(){return this.anim.isRunning()}_updateIndex(){const r=this.frameIndex(),l=this.animation(),o=this.animations(),a=o[l],g=a.length/4;r<g-1?this.frameIndex(r+1):this.frameIndex(0)}};return ie.Sprite=f,f.prototype.className="Sprite",(0,C._registerNode)(f),m.Factory.addGetterSetter(f,"animation"),m.Factory.addGetterSetter(f,"animations"),m.Factory.addGetterSetter(f,"frameOffsets"),m.Factory.addGetterSetter(f,"image"),m.Factory.addGetterSetter(f,"frameIndex",0,(0,R.getNumberValidator)()),m.Factory.addGetterSetter(f,"frameRate",17,(0,R.getNumberValidator)()),m.Factory.backCompat(f,{index:"frameIndex",getIndex:"getFrameIndex",setIndex:"setFrameIndex"}),ie}var ne={},Oi;function ar(){if(Oi)return ne;Oi=1,Object.defineProperty(ne,"__esModule",{value:!0}),ne.Star=void 0;const m=rt(),w=_t(),L=st(),R=nt();let C=class extends w.Shape{_sceneFunc(h){const r=this.innerRadius(),l=this.outerRadius(),o=this.numPoints();h.beginPath(),h.moveTo(0,0-l);for(let a=1;a<o*2;a++){const g=a%2===0?l:r,c=g*Math.sin(a*Math.PI/o),i=-1*g*Math.cos(a*Math.PI/o);h.lineTo(c,i)}h.closePath(),h.fillStrokeShape(this)}getWidth(){return this.outerRadius()*2}getHeight(){return this.outerRadius()*2}setWidth(h){this.outerRadius(h/2)}setHeight(h){this.outerRadius(h/2)}};return ne.Star=C,C.prototype.className="Star",C.prototype._centroid=!0,C.prototype._attrsAffectingSize=["innerRadius","outerRadius"],(0,R._registerNode)(C),m.Factory.addGetterSetter(C,"numPoints",5,(0,L.getNumberValidator)()),m.Factory.addGetterSetter(C,"innerRadius",0,(0,L.getNumberValidator)()),m.Factory.addGetterSetter(C,"outerRadius",0,(0,L.getNumberValidator)()),ne}var Lt={},Di;function pn(){if(Di)return Lt;Di=1,Object.defineProperty(Lt,"__esModule",{value:!0}),Lt.Text=void 0,Lt.stringToArray=h;const m=dt(),w=rt(),L=_t(),R=nt(),C=st(),f=nt();function h(V){return[...V].reduce((O,H,j,B)=>{if(new RegExp("\\p{Emoji}","u").test(H)){const A=B[j+1];A&&new RegExp("\\p{Emoji_Modifier}|\\u200D","u").test(A)?(O.push(H+A),B[j+1]=""):O.push(H)}else new RegExp("\\p{Regional_Indicator}{2}","u").test(H+(B[j+1]||""))?O.push(H+B[j+1]):j>0&&new RegExp("\\p{Mn}|\\p{Me}|\\p{Mc}","u").test(H)?O[O.length-1]+=H:H&&O.push(H);return O},[])}const r="auto",l="center",o="inherit",a="justify",g="Change.konva",c="2d",i="-",n="left",d="text",y="Text",b="top",e="bottom",t="middle",s="normal",p="px ",P=" ",G="right",_="rtl",v="word",S="char",k="none",F="",D=["direction","fontFamily","fontSize","fontStyle","fontVariant","padding","align","verticalAlign","lineHeight","text","width","height","wrap","ellipsis","letterSpacing"],I=D.length;function N(V){return V.split(",").map(O=>{O=O.trim();const H=O.indexOf(" ")>=0,j=O.indexOf('"')>=0||O.indexOf("'")>=0;return H&&!j&&(O=`"${O}"`),O}).join(", ")}let W;function u(){return W||(W=m.Util.createCanvasElement().getContext(c),W)}function x(V){V.fillText(this._partialText,this._partialTextX,this._partialTextY)}function E(V){V.setAttr("miterLimit",2),V.strokeText(this._partialText,this._partialTextX,this._partialTextY)}function T(V){return V=V||{},!V.fillLinearGradientColorStops&&!V.fillRadialGradientColorStops&&!V.fillPatternImage&&(V.fill=V.fill||"black"),V}let M=class extends L.Shape{constructor(O){super(T(O)),this._partialTextX=0,this._partialTextY=0;for(let H=0;H<I;H++)this.on(D[H]+g,this._setTextData);this._setTextData()}_sceneFunc(O){const H=this.textArr,j=H.length;if(!this.text())return;let B=this.padding(),A=this.fontSize(),U=this.lineHeight()*A,Y=this.verticalAlign(),X=this.direction(),$=0,tt=this.align(),it=this.getWidth(),at=this.letterSpacing(),et=this.fill(),pt=this.textDecoration(),ot=pt.indexOf("underline")!==-1,ct=pt.indexOf("line-through")!==-1,K;X=X===o?O.direction:X;let q=U/2,Z=t;if(R.Konva._fixTextRendering){const z=this.measureSize("M");Z="alphabetic",q=(z.fontBoundingBoxAscent-z.fontBoundingBoxDescent)/2+U/2}for(X===_&&O.setAttr("direction",X),O.setAttr("font",this._getContextFont()),O.setAttr("textBaseline",Z),O.setAttr("textAlign",n),Y===t?$=(this.getHeight()-j*U-B*2)/2:Y===e&&($=this.getHeight()-j*U-B*2),O.translate(B,$+B),K=0;K<j;K++){let z=0,J=0;const ht=H[K],yt=ht.text,ut=ht.width,Pt=ht.lastInParagraph;if(O.save(),tt===G?z+=it-ut-B*2:tt===l&&(z+=(it-ut-B*2)/2),ot){O.save(),O.beginPath();const bt=R.Konva._fixTextRendering?Math.round(A/4):Math.round(A/2),kt=z,St=q+J+bt;O.moveTo(kt,St);const Ct=tt===a&&!Pt?it-B*2:ut;O.lineTo(kt+Math.round(Ct),St),O.lineWidth=A/15;const It=this._getLinearGradient();O.strokeStyle=It||et,O.stroke(),O.restore()}if(ct){O.save(),O.beginPath();const bt=R.Konva._fixTextRendering?-Math.round(A/4):0;O.moveTo(z,q+J+bt);const kt=tt===a&&!Pt?it-B*2:ut;O.lineTo(z+Math.round(kt),q+J+bt),O.lineWidth=A/15;const St=this._getLinearGradient();O.strokeStyle=St||et,O.stroke(),O.restore()}if(X!==_&&(at!==0||tt===a)){const bt=yt.split(" ").length-1,kt=h(yt);for(let St=0;St<kt.length;St++){const Ct=kt[St];Ct===" "&&!Pt&&tt===a&&(z+=(it-B*2-ut)/bt),this._partialTextX=z,this._partialTextY=q+J,this._partialText=Ct,O.fillStrokeShape(this),z+=this.measureSize(Ct).width+at}}else at!==0&&O.setAttr("letterSpacing",`${at}px`),this._partialTextX=z,this._partialTextY=q+J,this._partialText=yt,O.fillStrokeShape(this);O.restore(),j>1&&(q+=U)}}_hitFunc(O){const H=this.getWidth(),j=this.getHeight();O.beginPath(),O.rect(0,0,H,j),O.closePath(),O.fillStrokeShape(this)}setText(O){const H=m.Util._isString(O)?O:O==null?"":O+"";return this._setAttr(d,H),this}getWidth(){return this.attrs.width===r||this.attrs.width===void 0?this.getTextWidth()+this.padding()*2:this.attrs.width}getHeight(){return this.attrs.height===r||this.attrs.height===void 0?this.fontSize()*this.textArr.length*this.lineHeight()+this.padding()*2:this.attrs.height}getTextWidth(){return this.textWidth}getTextHeight(){return m.Util.warn("text.getTextHeight() method is deprecated. Use text.height() - for full height and text.fontSize() - for one line height."),this.textHeight}measureSize(O){var H,j,B,A,U,Y,X,$,tt,it,at;let et=u(),pt=this.fontSize(),ot;et.save(),et.font=this._getContextFont(),ot=et.measureText(O),et.restore();const ct=pt/100;return{actualBoundingBoxAscent:(H=ot.actualBoundingBoxAscent)!==null&&H!==void 0?H:71.58203125*ct,actualBoundingBoxDescent:(j=ot.actualBoundingBoxDescent)!==null&&j!==void 0?j:0,actualBoundingBoxLeft:(B=ot.actualBoundingBoxLeft)!==null&&B!==void 0?B:-7.421875*ct,actualBoundingBoxRight:(A=ot.actualBoundingBoxRight)!==null&&A!==void 0?A:75.732421875*ct,alphabeticBaseline:(U=ot.alphabeticBaseline)!==null&&U!==void 0?U:0,emHeightAscent:(Y=ot.emHeightAscent)!==null&&Y!==void 0?Y:100*ct,emHeightDescent:(X=ot.emHeightDescent)!==null&&X!==void 0?X:-20*ct,fontBoundingBoxAscent:($=ot.fontBoundingBoxAscent)!==null&&$!==void 0?$:91*ct,fontBoundingBoxDescent:(tt=ot.fontBoundingBoxDescent)!==null&&tt!==void 0?tt:21*ct,hangingBaseline:(it=ot.hangingBaseline)!==null&&it!==void 0?it:72.80000305175781*ct,ideographicBaseline:(at=ot.ideographicBaseline)!==null&&at!==void 0?at:-21*ct,width:ot.width,height:pt}}_getContextFont(){return this.fontStyle()+P+this.fontVariant()+P+(this.fontSize()+p)+N(this.fontFamily())}_addTextLine(O){this.align()===a&&(O=O.trim());const j=this._getTextWidth(O);return this.textArr.push({text:O,width:j,lastInParagraph:!1})}_getTextWidth(O){const H=this.letterSpacing(),j=O.length;return u().measureText(O).width+H*j}_setTextData(){let O=this.text().split(`
`),H=+this.fontSize(),j=0,B=this.lineHeight()*H,A=this.attrs.width,U=this.attrs.height,Y=A!==r&&A!==void 0,X=U!==r&&U!==void 0,$=this.padding(),tt=A-$*2,it=U-$*2,at=0,et=this.wrap(),pt=et!==k,ot=et!==S&&pt,ct=this.ellipsis();this.textArr=[],u().font=this._getContextFont();const K=ct?this._getTextWidth(F):0;for(let q=0,Z=O.length;q<Z;++q){let z=O[q],J=this._getTextWidth(z);if(Y&&J>tt)for(;z.length>0;){let ht=0,yt=h(z).length,ut="",Pt=0;for(;ht<yt;){const bt=ht+yt>>>1,kt=h(z),St=kt.slice(0,bt+1).join(""),Ct=this._getTextWidth(St);(ct&&X&&at+B>it?Ct+K:Ct)<=tt?(ht=bt+1,ut=St,Pt=Ct):yt=bt}if(ut){if(ot){const St=h(z),Ct=h(ut),It=St[Ct.length],Je=It===P||It===i;let Re;if(Je&&Pt<=tt)Re=Ct.length;else{const mn=Ct.lastIndexOf(P),_n=Ct.lastIndexOf(i);Re=Math.max(mn,_n)+1}Re>0&&(ht=Re,ut=St.slice(0,ht).join(""),Pt=this._getTextWidth(ut))}if(ut=ut.trimRight(),this._addTextLine(ut),j=Math.max(j,Pt),at+=B,this._shouldHandleEllipsis(at)){this._tryToAddEllipsisToLastLine();break}if(z=h(z).slice(ht).join("").trimLeft(),z.length>0&&(J=this._getTextWidth(z),J<=tt)){this._addTextLine(z),at+=B,j=Math.max(j,J);break}}else break}else this._addTextLine(z),at+=B,j=Math.max(j,J),this._shouldHandleEllipsis(at)&&q<Z-1&&this._tryToAddEllipsisToLastLine();if(this.textArr[this.textArr.length-1]&&(this.textArr[this.textArr.length-1].lastInParagraph=!0),X&&at+B>it)break}this.textHeight=H,this.textWidth=j}_shouldHandleEllipsis(O){const H=+this.fontSize(),j=this.lineHeight()*H,B=this.attrs.height,A=B!==r&&B!==void 0,U=this.padding(),Y=B-U*2;return!(this.wrap()!==k)||A&&O+j>Y}_tryToAddEllipsisToLastLine(){const O=this.attrs.width,H=O!==r&&O!==void 0,j=this.padding(),B=O-j*2,A=this.ellipsis(),U=this.textArr[this.textArr.length-1];!U||!A||(H&&(this._getTextWidth(U.text+F)<B||(U.text=U.text.slice(0,U.text.length-3))),this.textArr.splice(this.textArr.length-1,1),this._addTextLine(U.text+F))}getStrokeScaleEnabled(){return!0}_useBufferCanvas(){const O=this.textDecoration().indexOf("underline")!==-1||this.textDecoration().indexOf("line-through")!==-1,H=this.hasShadow();return O&&H?!0:super._useBufferCanvas()}};return Lt.Text=M,M.prototype._fillFunc=x,M.prototype._strokeFunc=E,M.prototype.className=y,M.prototype._attrsAffectingSize=["text","fontSize","padding","wrap","lineHeight","letterSpacing"],(0,f._registerNode)(M),w.Factory.overWriteSetter(M,"width",(0,C.getNumberOrAutoValidator)()),w.Factory.overWriteSetter(M,"height",(0,C.getNumberOrAutoValidator)()),w.Factory.addGetterSetter(M,"direction",o),w.Factory.addGetterSetter(M,"fontFamily","Arial"),w.Factory.addGetterSetter(M,"fontSize",12,(0,C.getNumberValidator)()),w.Factory.addGetterSetter(M,"fontStyle",s),w.Factory.addGetterSetter(M,"fontVariant",s),w.Factory.addGetterSetter(M,"padding",0,(0,C.getNumberValidator)()),w.Factory.addGetterSetter(M,"align",n),w.Factory.addGetterSetter(M,"verticalAlign",b),w.Factory.addGetterSetter(M,"lineHeight",1,(0,C.getNumberValidator)()),w.Factory.addGetterSetter(M,"wrap",v),w.Factory.addGetterSetter(M,"ellipsis",!1,(0,C.getBooleanValidator)()),w.Factory.addGetterSetter(M,"letterSpacing",0,(0,C.getNumberValidator)()),w.Factory.addGetterSetter(M,"text","",(0,C.getStringValidator)()),w.Factory.addGetterSetter(M,"textDecoration",""),Lt}var re={},Ii;function or(){if(Ii)return re;Ii=1,Object.defineProperty(re,"__esModule",{value:!0}),re.TextPath=void 0;const m=dt(),w=rt(),L=_t(),R=Qe(),C=pn(),f=st(),h=nt(),r="",l="normal";function o(c){c.fillText(this.partialText,0,0)}function a(c){c.strokeText(this.partialText,0,0)}let g=class extends L.Shape{constructor(i){super(i),this.dummyCanvas=m.Util.createCanvasElement(),this.dataArray=[],this._readDataAttribute(),this.on("dataChange.konva",function(){this._readDataAttribute(),this._setTextData()}),this.on("textChange.konva alignChange.konva letterSpacingChange.konva kerningFuncChange.konva fontSizeChange.konva fontFamilyChange.konva",this._setTextData),this._setTextData()}_getTextPathLength(){return R.Path.getPathLength(this.dataArray)}_getPointAtLength(i){if(!this.attrs.data)return null;const n=this.pathLength;return i-1>n?null:R.Path.getPointAtLengthOfDataArray(i,this.dataArray)}_readDataAttribute(){this.dataArray=R.Path.parsePathData(this.attrs.data),this.pathLength=this._getTextPathLength()}_sceneFunc(i){i.setAttr("font",this._getContextFont()),i.setAttr("textBaseline",this.textBaseline()),i.setAttr("textAlign","left"),i.save();const n=this.textDecoration(),d=this.fill(),y=this.fontSize(),b=this.glyphInfo;n==="underline"&&i.beginPath();for(let e=0;e<b.length;e++){i.save();const t=b[e].p0;i.translate(t.x,t.y),i.rotate(b[e].rotation),this.partialText=b[e].text,i.fillStrokeShape(this),n==="underline"&&(e===0&&i.moveTo(0,y/2+1),i.lineTo(y,y/2+1)),i.restore()}n==="underline"&&(i.strokeStyle=d,i.lineWidth=y/20,i.stroke()),i.restore()}_hitFunc(i){i.beginPath();const n=this.glyphInfo;if(n.length>=1){const d=n[0].p0;i.moveTo(d.x,d.y)}for(let d=0;d<n.length;d++){const y=n[d].p1;i.lineTo(y.x,y.y)}i.setAttr("lineWidth",this.fontSize()),i.setAttr("strokeStyle",this.colorKey),i.stroke()}getTextWidth(){return this.textWidth}getTextHeight(){return m.Util.warn("text.getTextHeight() method is deprecated. Use text.height() - for full height and text.fontSize() - for one line height."),this.textHeight}setText(i){return C.Text.prototype.setText.call(this,i)}_getContextFont(){return C.Text.prototype._getContextFont.call(this)}_getTextSize(i){const d=this.dummyCanvas.getContext("2d");d.save(),d.font=this._getContextFont();const y=d.measureText(i);return d.restore(),{width:y.width,height:parseInt(`${this.fontSize()}`,10)}}_setTextData(){const{width:i,height:n}=this._getTextSize(this.attrs.text);if(this.textWidth=i,this.textHeight=n,this.glyphInfo=[],!this.attrs.data)return null;const d=this.letterSpacing(),y=this.align(),b=this.kerningFunc(),e=Math.max(this.textWidth+((this.attrs.text||"").length-1)*d,0);let t=0;y==="center"&&(t=Math.max(0,this.pathLength/2-e/2)),y==="right"&&(t=Math.max(0,this.pathLength-e));const s=(0,C.stringToArray)(this.text());let p=t;for(let P=0;P<s.length;P++){const G=this._getPointAtLength(p);if(!G)return;let _=this._getTextSize(s[P]).width+d;if(s[P]===" "&&y==="justify"){const I=this.text().split(" ").length-1;_+=(this.pathLength-e)/I}const v=this._getPointAtLength(p+_);if(!v)return;const S=R.Path.getLineLength(G.x,G.y,v.x,v.y);let k=0;if(b)try{k=b(s[P-1],s[P])*this.fontSize()}catch{k=0}G.x+=k,v.x+=k,this.textWidth+=k;const F=R.Path.getPointOnLine(k+S/2,G.x,G.y,v.x,v.y),D=Math.atan2(v.y-G.y,v.x-G.x);this.glyphInfo.push({transposeX:F.x,transposeY:F.y,text:s[P],rotation:D,p0:G,p1:v}),p+=_}}getSelfRect(){if(!this.glyphInfo.length)return{x:0,y:0,width:0,height:0};const i=[];this.glyphInfo.forEach(function(p){i.push(p.p0.x),i.push(p.p0.y),i.push(p.p1.x),i.push(p.p1.y)});let n=i[0]||0,d=i[0]||0,y=i[1]||0,b=i[1]||0,e,t;for(let p=0;p<i.length/2;p++)e=i[p*2],t=i[p*2+1],n=Math.min(n,e),d=Math.max(d,e),y=Math.min(y,t),b=Math.max(b,t);const s=this.fontSize();return{x:n-s/2,y:y-s/2,width:d-n+s,height:b-y+s}}destroy(){return m.Util.releaseCanvas(this.dummyCanvas),super.destroy()}};return re.TextPath=g,g.prototype._fillFunc=o,g.prototype._strokeFunc=a,g.prototype._fillFuncHit=o,g.prototype._strokeFuncHit=a,g.prototype.className="TextPath",g.prototype._attrsAffectingSize=["text","fontSize","data"],(0,h._registerNode)(g),w.Factory.addGetterSetter(g,"data"),w.Factory.addGetterSetter(g,"fontFamily","Arial"),w.Factory.addGetterSetter(g,"fontSize",12,(0,f.getNumberValidator)()),w.Factory.addGetterSetter(g,"fontStyle",l),w.Factory.addGetterSetter(g,"align","left"),w.Factory.addGetterSetter(g,"letterSpacing",0,(0,f.getNumberValidator)()),w.Factory.addGetterSetter(g,"textBaseline","middle"),w.Factory.addGetterSetter(g,"fontVariant",l),w.Factory.addGetterSetter(g,"text",r),w.Factory.addGetterSetter(g,"textDecoration",""),w.Factory.addGetterSetter(g,"kerningFunc",void 0),re}var se={},Ui;function lr(){if(Ui)return se;Ui=1,Object.defineProperty(se,"__esModule",{value:!0}),se.Transformer=void 0;const m=dt(),w=rt(),L=gt(),R=_t(),C=gn(),f=Xe(),h=nt(),r=st(),l=nt(),o="tr-konva",a=["resizeEnabledChange","rotateAnchorOffsetChange","rotateEnabledChange","enabledAnchorsChange","anchorSizeChange","borderEnabledChange","borderStrokeChange","borderStrokeWidthChange","borderDashChange","anchorStrokeChange","anchorStrokeWidthChange","anchorFillChange","anchorCornerRadiusChange","ignoreStrokeChange","anchorStyleFuncChange"].map(_=>_+`.${o}`).join(" "),g="nodesRect",c=["widthChange","heightChange","scaleXChange","scaleYChange","skewXChange","skewYChange","rotationChange","offsetXChange","offsetYChange","transformsEnabledChange","strokeWidthChange"],i={"top-left":-45,"top-center":0,"top-right":45,"middle-right":-90,"middle-left":90,"bottom-left":-135,"bottom-center":180,"bottom-right":135},n="ontouchstart"in h.Konva._global;function d(_,v,S){if(_==="rotater")return S;v+=m.Util.degToRad(i[_]||0);const k=(m.Util.radToDeg(v)%360+360)%360;return m.Util._inRange(k,315+22.5,360)||m.Util._inRange(k,0,22.5)?"ns-resize":m.Util._inRange(k,45-22.5,45+22.5)?"nesw-resize":m.Util._inRange(k,90-22.5,90+22.5)?"ew-resize":m.Util._inRange(k,135-22.5,135+22.5)?"nwse-resize":m.Util._inRange(k,180-22.5,180+22.5)?"ns-resize":m.Util._inRange(k,225-22.5,225+22.5)?"nesw-resize":m.Util._inRange(k,270-22.5,270+22.5)?"ew-resize":m.Util._inRange(k,315-22.5,315+22.5)?"nwse-resize":(m.Util.error("Transformer has unknown angle for cursor detection: "+k),"pointer")}const y=["top-left","top-center","top-right","middle-right","middle-left","bottom-left","bottom-center","bottom-right"];function b(_){return{x:_.x+_.width/2*Math.cos(_.rotation)+_.height/2*Math.sin(-_.rotation),y:_.y+_.height/2*Math.cos(_.rotation)+_.width/2*Math.sin(_.rotation)}}function e(_,v,S){const k=S.x+(_.x-S.x)*Math.cos(v)-(_.y-S.y)*Math.sin(v),F=S.y+(_.x-S.x)*Math.sin(v)+(_.y-S.y)*Math.cos(v);return{..._,rotation:_.rotation+v,x:k,y:F}}function t(_,v){const S=b(_);return e(_,v,S)}function s(_,v,S){let k=v;for(let F=0;F<_.length;F++){const D=h.Konva.getAngle(_[F]),I=Math.abs(D-v)%(Math.PI*2);Math.min(I,Math.PI*2-I)<S&&(k=D)}return k}let p=0,P=class extends f.Group{constructor(v){super(v),this._movingAnchorName=null,this._transforming=!1,this._createElements(),this._handleMouseMove=this._handleMouseMove.bind(this),this._handleMouseUp=this._handleMouseUp.bind(this),this.update=this.update.bind(this),this.on(a,this.update),this.getNode()&&this.update()}attachTo(v){return this.setNode(v),this}setNode(v){return m.Util.warn("tr.setNode(shape), tr.node(shape) and tr.attachTo(shape) methods are deprecated. Please use tr.nodes(nodesArray) instead."),this.setNodes([v])}getNode(){return this._nodes&&this._nodes[0]}_getEventNamespace(){return o+this._id}setNodes(v=[]){this._nodes&&this._nodes.length&&this.detach();const S=v.filter(F=>F.isAncestorOf(this)?(m.Util.error("Konva.Transformer cannot be an a child of the node you are trying to attach"),!1):!0);return this._nodes=v=S,v.length===1&&this.useSingleNodeRotation()?this.rotation(v[0].getAbsoluteRotation()):this.rotation(0),this._nodes.forEach(F=>{const D=()=>{this.nodes().length===1&&this.useSingleNodeRotation()&&this.rotation(this.nodes()[0].getAbsoluteRotation()),this._resetTransformCache(),!this._transforming&&!this.isDragging()&&this.update()};if(F._attrsAffectingSize.length){const I=F._attrsAffectingSize.map(N=>N+"Change."+this._getEventNamespace()).join(" ");F.on(I,D)}F.on(c.map(I=>I+`.${this._getEventNamespace()}`).join(" "),D),F.on(`absoluteTransformChange.${this._getEventNamespace()}`,D),this._proxyDrag(F)}),this._resetTransformCache(),!!this.findOne(".top-left")&&this.update(),this}_proxyDrag(v){let S;v.on(`dragstart.${this._getEventNamespace()}`,k=>{S=v.getAbsolutePosition(),!this.isDragging()&&v!==this.findOne(".back")&&this.startDrag(k,!1)}),v.on(`dragmove.${this._getEventNamespace()}`,k=>{if(!S)return;const F=v.getAbsolutePosition(),D=F.x-S.x,I=F.y-S.y;this.nodes().forEach(N=>{if(N===v||N.isDragging())return;const W=N.getAbsolutePosition();N.setAbsolutePosition({x:W.x+D,y:W.y+I}),N.startDrag(k)}),S=null})}getNodes(){return this._nodes||[]}getActiveAnchor(){return this._movingAnchorName}detach(){this._nodes&&this._nodes.forEach(v=>{v.off("."+this._getEventNamespace())}),this._nodes=[],this._resetTransformCache()}_resetTransformCache(){this._clearCache(g),this._clearCache("transform"),this._clearSelfAndDescendantCache("absoluteTransform")}_getNodeRect(){return this._getCache(g,this.__getNodeRect)}__getNodeShape(v,S=this.rotation(),k){const F=v.getClientRect({skipTransform:!0,skipShadow:!0,skipStroke:this.ignoreStroke()}),D=v.getAbsoluteScale(k),I=v.getAbsolutePosition(k),N=F.x*D.x-v.offsetX()*D.x,W=F.y*D.y-v.offsetY()*D.y,u=(h.Konva.getAngle(v.getAbsoluteRotation())+Math.PI*2)%(Math.PI*2),x={x:I.x+N*Math.cos(u)+W*Math.sin(-u),y:I.y+W*Math.cos(u)+N*Math.sin(u),width:F.width*D.x,height:F.height*D.y,rotation:u};return e(x,-h.Konva.getAngle(S),{x:0,y:0})}__getNodeRect(){if(!this.getNode())return{x:-1e8,y:-1e8,width:0,height:0,rotation:0};const S=[];this.nodes().map(u=>{const x=u.getClientRect({skipTransform:!0,skipShadow:!0,skipStroke:this.ignoreStroke()}),E=[{x:x.x,y:x.y},{x:x.x+x.width,y:x.y},{x:x.x+x.width,y:x.y+x.height},{x:x.x,y:x.y+x.height}],T=u.getAbsoluteTransform();E.forEach(function(M){const V=T.point(M);S.push(V)})});const k=new m.Transform;k.rotate(-h.Konva.getAngle(this.rotation()));let F=1/0,D=1/0,I=-1/0,N=-1/0;S.forEach(function(u){const x=k.point(u);F===void 0&&(F=I=x.x,D=N=x.y),F=Math.min(F,x.x),D=Math.min(D,x.y),I=Math.max(I,x.x),N=Math.max(N,x.y)}),k.invert();const W=k.point({x:F,y:D});return{x:W.x,y:W.y,width:I-F,height:N-D,rotation:h.Konva.getAngle(this.rotation())}}getX(){return this._getNodeRect().x}getY(){return this._getNodeRect().y}getWidth(){return this._getNodeRect().width}getHeight(){return this._getNodeRect().height}_createElements(){this._createBack(),y.forEach(v=>{this._createAnchor(v)}),this._createAnchor("rotater")}_createAnchor(v){const S=new C.Rect({stroke:"rgb(0, 161, 255)",fill:"white",strokeWidth:1,name:v+" _anchor",dragDistance:0,draggable:!0,hitStrokeWidth:n?10:"auto"}),k=this;S.on("mousedown touchstart",function(F){k._handleMouseDown(F)}),S.on("dragstart",F=>{S.stopDrag(),F.cancelBubble=!0}),S.on("dragend",F=>{F.cancelBubble=!0}),S.on("mouseenter",()=>{const F=h.Konva.getAngle(this.rotation()),D=this.rotateAnchorCursor(),I=d(v,F,D);S.getStage().content&&(S.getStage().content.style.cursor=I),this._cursorChange=!0}),S.on("mouseout",()=>{S.getStage().content&&(S.getStage().content.style.cursor=""),this._cursorChange=!1}),this.add(S)}_createBack(){const v=new R.Shape({name:"back",width:0,height:0,draggable:!0,sceneFunc(S,k){const F=k.getParent(),D=F.padding();S.beginPath(),S.rect(-D,-D,k.width()+D*2,k.height()+D*2),S.moveTo(k.width()/2,-D),F.rotateEnabled()&&F.rotateLineVisible()&&S.lineTo(k.width()/2,-F.rotateAnchorOffset()*m.Util._sign(k.height())-D),S.fillStrokeShape(k)},hitFunc:(S,k)=>{if(!this.shouldOverdrawWholeArea())return;const F=this.padding();S.beginPath(),S.rect(-F,-F,k.width()+F*2,k.height()+F*2),S.fillStrokeShape(k)}});this.add(v),this._proxyDrag(v),v.on("dragstart",S=>{S.cancelBubble=!0}),v.on("dragmove",S=>{S.cancelBubble=!0}),v.on("dragend",S=>{S.cancelBubble=!0}),this.on("dragmove",S=>{this.update()})}_handleMouseDown(v){if(this._transforming)return;this._movingAnchorName=v.target.name().split(" ")[0];const S=this._getNodeRect(),k=S.width,F=S.height,D=Math.sqrt(Math.pow(k,2)+Math.pow(F,2));this.sin=Math.abs(F/D),this.cos=Math.abs(k/D),typeof window<"u"&&(window.addEventListener("mousemove",this._handleMouseMove),window.addEventListener("touchmove",this._handleMouseMove),window.addEventListener("mouseup",this._handleMouseUp,!0),window.addEventListener("touchend",this._handleMouseUp,!0)),this._transforming=!0;const I=v.target.getAbsolutePosition(),N=v.target.getStage().getPointerPosition();this._anchorDragOffset={x:N.x-I.x,y:N.y-I.y},p++,this._fire("transformstart",{evt:v.evt,target:this.getNode()}),this._nodes.forEach(W=>{W._fire("transformstart",{evt:v.evt,target:W})})}_handleMouseMove(v){let S,k,F;const D=this.findOne("."+this._movingAnchorName),I=D.getStage();I.setPointersPositions(v);const N=I.getPointerPosition();let W={x:N.x-this._anchorDragOffset.x,y:N.y-this._anchorDragOffset.y};const u=D.getAbsolutePosition();this.anchorDragBoundFunc()&&(W=this.anchorDragBoundFunc()(u,W,v)),D.setAbsolutePosition(W);const x=D.getAbsolutePosition();if(u.x===x.x&&u.y===x.y)return;if(this._movingAnchorName==="rotater"){const B=this._getNodeRect();S=D.x()-B.width/2,k=-D.y()+B.height/2;let A=Math.atan2(-k,S)+Math.PI/2;B.height<0&&(A-=Math.PI);const Y=h.Konva.getAngle(this.rotation())+A,X=h.Konva.getAngle(this.rotationSnapTolerance()),tt=s(this.rotationSnaps(),Y,X)-B.rotation,it=t(B,tt);this._fitNodesInto(it,v);return}const E=this.shiftBehavior();let T;E==="inverted"?T=this.keepRatio()&&!v.shiftKey:E==="none"?T=this.keepRatio():T=this.keepRatio()||v.shiftKey;let M=this.centeredScaling()||v.altKey;if(this._movingAnchorName==="top-left"){if(T){const B=M?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".bottom-right").x(),y:this.findOne(".bottom-right").y()};F=Math.sqrt(Math.pow(B.x-D.x(),2)+Math.pow(B.y-D.y(),2));const A=this.findOne(".top-left").x()>B.x?-1:1,U=this.findOne(".top-left").y()>B.y?-1:1;S=F*this.cos*A,k=F*this.sin*U,this.findOne(".top-left").x(B.x-S),this.findOne(".top-left").y(B.y-k)}}else if(this._movingAnchorName==="top-center")this.findOne(".top-left").y(D.y());else if(this._movingAnchorName==="top-right"){if(T){const B=M?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".bottom-left").x(),y:this.findOne(".bottom-left").y()};F=Math.sqrt(Math.pow(D.x()-B.x,2)+Math.pow(B.y-D.y(),2));const A=this.findOne(".top-right").x()<B.x?-1:1,U=this.findOne(".top-right").y()>B.y?-1:1;S=F*this.cos*A,k=F*this.sin*U,this.findOne(".top-right").x(B.x+S),this.findOne(".top-right").y(B.y-k)}var V=D.position();this.findOne(".top-left").y(V.y),this.findOne(".bottom-right").x(V.x)}else if(this._movingAnchorName==="middle-left")this.findOne(".top-left").x(D.x());else if(this._movingAnchorName==="middle-right")this.findOne(".bottom-right").x(D.x());else if(this._movingAnchorName==="bottom-left"){if(T){const B=M?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".top-right").x(),y:this.findOne(".top-right").y()};F=Math.sqrt(Math.pow(B.x-D.x(),2)+Math.pow(D.y()-B.y,2));const A=B.x<D.x()?-1:1,U=D.y()<B.y?-1:1;S=F*this.cos*A,k=F*this.sin*U,D.x(B.x-S),D.y(B.y+k)}V=D.position(),this.findOne(".top-left").x(V.x),this.findOne(".bottom-right").y(V.y)}else if(this._movingAnchorName==="bottom-center")this.findOne(".bottom-right").y(D.y());else if(this._movingAnchorName==="bottom-right"){if(T){const B=M?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".top-left").x(),y:this.findOne(".top-left").y()};F=Math.sqrt(Math.pow(D.x()-B.x,2)+Math.pow(D.y()-B.y,2));const A=this.findOne(".bottom-right").x()<B.x?-1:1,U=this.findOne(".bottom-right").y()<B.y?-1:1;S=F*this.cos*A,k=F*this.sin*U,this.findOne(".bottom-right").x(B.x+S),this.findOne(".bottom-right").y(B.y+k)}}else console.error(new Error("Wrong position argument of selection resizer: "+this._movingAnchorName));if(M=this.centeredScaling()||v.altKey,M){const B=this.findOne(".top-left"),A=this.findOne(".bottom-right"),U=B.x(),Y=B.y(),X=this.getWidth()-A.x(),$=this.getHeight()-A.y();A.move({x:-U,y:-Y}),B.move({x:X,y:$})}const O=this.findOne(".top-left").getAbsolutePosition();S=O.x,k=O.y;const H=this.findOne(".bottom-right").x()-this.findOne(".top-left").x(),j=this.findOne(".bottom-right").y()-this.findOne(".top-left").y();this._fitNodesInto({x:S,y:k,width:H,height:j,rotation:h.Konva.getAngle(this.rotation())},v)}_handleMouseUp(v){this._removeEvents(v)}getAbsoluteTransform(){return this.getTransform()}_removeEvents(v){var S;if(this._transforming){this._transforming=!1,typeof window<"u"&&(window.removeEventListener("mousemove",this._handleMouseMove),window.removeEventListener("touchmove",this._handleMouseMove),window.removeEventListener("mouseup",this._handleMouseUp,!0),window.removeEventListener("touchend",this._handleMouseUp,!0));const k=this.getNode();p--,this._fire("transformend",{evt:v,target:k}),(S=this.getLayer())===null||S===void 0||S.batchDraw(),k&&this._nodes.forEach(F=>{var D;F._fire("transformend",{evt:v,target:F}),(D=F.getLayer())===null||D===void 0||D.batchDraw()}),this._movingAnchorName=null}}_fitNodesInto(v,S){const k=this._getNodeRect(),F=1;if(m.Util._inRange(v.width,-this.padding()*2-F,F)){this.update();return}if(m.Util._inRange(v.height,-this.padding()*2-F,F)){this.update();return}const D=new m.Transform;if(D.rotate(h.Konva.getAngle(this.rotation())),this._movingAnchorName&&v.width<0&&this._movingAnchorName.indexOf("left")>=0){const T=D.point({x:-this.padding()*2,y:0});v.x+=T.x,v.y+=T.y,v.width+=this.padding()*2,this._movingAnchorName=this._movingAnchorName.replace("left","right"),this._anchorDragOffset.x-=T.x,this._anchorDragOffset.y-=T.y}else if(this._movingAnchorName&&v.width<0&&this._movingAnchorName.indexOf("right")>=0){const T=D.point({x:this.padding()*2,y:0});this._movingAnchorName=this._movingAnchorName.replace("right","left"),this._anchorDragOffset.x-=T.x,this._anchorDragOffset.y-=T.y,v.width+=this.padding()*2}if(this._movingAnchorName&&v.height<0&&this._movingAnchorName.indexOf("top")>=0){const T=D.point({x:0,y:-this.padding()*2});v.x+=T.x,v.y+=T.y,this._movingAnchorName=this._movingAnchorName.replace("top","bottom"),this._anchorDragOffset.x-=T.x,this._anchorDragOffset.y-=T.y,v.height+=this.padding()*2}else if(this._movingAnchorName&&v.height<0&&this._movingAnchorName.indexOf("bottom")>=0){const T=D.point({x:0,y:this.padding()*2});this._movingAnchorName=this._movingAnchorName.replace("bottom","top"),this._anchorDragOffset.x-=T.x,this._anchorDragOffset.y-=T.y,v.height+=this.padding()*2}if(this.boundBoxFunc()){const T=this.boundBoxFunc()(k,v);T?v=T:m.Util.warn("boundBoxFunc returned falsy. You should return new bound rect from it!")}const I=1e7,N=new m.Transform;N.translate(k.x,k.y),N.rotate(k.rotation),N.scale(k.width/I,k.height/I);const W=new m.Transform,u=v.width/I,x=v.height/I;this.flipEnabled()===!1?(W.translate(v.x,v.y),W.rotate(v.rotation),W.translate(v.width<0?v.width:0,v.height<0?v.height:0),W.scale(Math.abs(u),Math.abs(x))):(W.translate(v.x,v.y),W.rotate(v.rotation),W.scale(u,x));const E=W.multiply(N.invert());this._nodes.forEach(T=>{var M;const V=T.getParent().getAbsoluteTransform(),O=T.getTransform().copy();O.translate(T.offsetX(),T.offsetY());const H=new m.Transform;H.multiply(V.copy().invert()).multiply(E).multiply(V).multiply(O);const j=H.decompose();T.setAttrs(j),(M=T.getLayer())===null||M===void 0||M.batchDraw()}),this.rotation(m.Util._getRotation(v.rotation)),this._nodes.forEach(T=>{this._fire("transform",{evt:S,target:T}),T._fire("transform",{evt:S,target:T})}),this._resetTransformCache(),this.update(),this.getLayer().batchDraw()}forceUpdate(){this._resetTransformCache(),this.update()}_batchChangeChild(v,S){this.findOne(v).setAttrs(S)}update(){var v;const S=this._getNodeRect();this.rotation(m.Util._getRotation(S.rotation));const k=S.width,F=S.height,D=this.enabledAnchors(),I=this.resizeEnabled(),N=this.padding(),W=this.anchorSize(),u=this.find("._anchor");u.forEach(E=>{E.setAttrs({width:W,height:W,offsetX:W/2,offsetY:W/2,stroke:this.anchorStroke(),strokeWidth:this.anchorStrokeWidth(),fill:this.anchorFill(),cornerRadius:this.anchorCornerRadius()})}),this._batchChangeChild(".top-left",{x:0,y:0,offsetX:W/2+N,offsetY:W/2+N,visible:I&&D.indexOf("top-left")>=0}),this._batchChangeChild(".top-center",{x:k/2,y:0,offsetY:W/2+N,visible:I&&D.indexOf("top-center")>=0}),this._batchChangeChild(".top-right",{x:k,y:0,offsetX:W/2-N,offsetY:W/2+N,visible:I&&D.indexOf("top-right")>=0}),this._batchChangeChild(".middle-left",{x:0,y:F/2,offsetX:W/2+N,visible:I&&D.indexOf("middle-left")>=0}),this._batchChangeChild(".middle-right",{x:k,y:F/2,offsetX:W/2-N,visible:I&&D.indexOf("middle-right")>=0}),this._batchChangeChild(".bottom-left",{x:0,y:F,offsetX:W/2+N,offsetY:W/2-N,visible:I&&D.indexOf("bottom-left")>=0}),this._batchChangeChild(".bottom-center",{x:k/2,y:F,offsetY:W/2-N,visible:I&&D.indexOf("bottom-center")>=0}),this._batchChangeChild(".bottom-right",{x:k,y:F,offsetX:W/2-N,offsetY:W/2-N,visible:I&&D.indexOf("bottom-right")>=0}),this._batchChangeChild(".rotater",{x:k/2,y:-this.rotateAnchorOffset()*m.Util._sign(F)-N,visible:this.rotateEnabled()}),this._batchChangeChild(".back",{width:k,height:F,visible:this.borderEnabled(),stroke:this.borderStroke(),strokeWidth:this.borderStrokeWidth(),dash:this.borderDash(),x:0,y:0});const x=this.anchorStyleFunc();x&&u.forEach(E=>{x(E)}),(v=this.getLayer())===null||v===void 0||v.batchDraw()}isTransforming(){return this._transforming}stopTransform(){if(this._transforming){this._removeEvents();const v=this.findOne("."+this._movingAnchorName);v&&v.stopDrag()}}destroy(){return this.getStage()&&this._cursorChange&&this.getStage().content&&(this.getStage().content.style.cursor=""),f.Group.prototype.destroy.call(this),this.detach(),this._removeEvents(),this}toObject(){return L.Node.prototype.toObject.call(this)}clone(v){return L.Node.prototype.clone.call(this,v)}getClientRect(){return this.nodes().length>0?super.getClientRect():{x:0,y:0,width:0,height:0}}};se.Transformer=P,P.isTransforming=()=>p>0;function G(_){return _ instanceof Array||m.Util.warn("enabledAnchors value should be an array"),_ instanceof Array&&_.forEach(function(v){y.indexOf(v)===-1&&m.Util.warn("Unknown anchor name: "+v+". Available names are: "+y.join(", "))}),_||[]}return P.prototype.className="Transformer",(0,l._registerNode)(P),w.Factory.addGetterSetter(P,"enabledAnchors",y,G),w.Factory.addGetterSetter(P,"flipEnabled",!0,(0,r.getBooleanValidator)()),w.Factory.addGetterSetter(P,"resizeEnabled",!0),w.Factory.addGetterSetter(P,"anchorSize",10,(0,r.getNumberValidator)()),w.Factory.addGetterSetter(P,"rotateEnabled",!0),w.Factory.addGetterSetter(P,"rotateLineVisible",!0),w.Factory.addGetterSetter(P,"rotationSnaps",[]),w.Factory.addGetterSetter(P,"rotateAnchorOffset",50,(0,r.getNumberValidator)()),w.Factory.addGetterSetter(P,"rotateAnchorCursor","crosshair"),w.Factory.addGetterSetter(P,"rotationSnapTolerance",5,(0,r.getNumberValidator)()),w.Factory.addGetterSetter(P,"borderEnabled",!0),w.Factory.addGetterSetter(P,"anchorStroke","rgb(0, 161, 255)"),w.Factory.addGetterSetter(P,"anchorStrokeWidth",1,(0,r.getNumberValidator)()),w.Factory.addGetterSetter(P,"anchorFill","white"),w.Factory.addGetterSetter(P,"anchorCornerRadius",0,(0,r.getNumberValidator)()),w.Factory.addGetterSetter(P,"borderStroke","rgb(0, 161, 255)"),w.Factory.addGetterSetter(P,"borderStrokeWidth",1,(0,r.getNumberValidator)()),w.Factory.addGetterSetter(P,"borderDash"),w.Factory.addGetterSetter(P,"keepRatio",!0),w.Factory.addGetterSetter(P,"shiftBehavior","default"),w.Factory.addGetterSetter(P,"centeredScaling",!1),w.Factory.addGetterSetter(P,"ignoreStroke",!1),w.Factory.addGetterSetter(P,"padding",0,(0,r.getNumberValidator)()),w.Factory.addGetterSetter(P,"nodes"),w.Factory.addGetterSetter(P,"node"),w.Factory.addGetterSetter(P,"boundBoxFunc"),w.Factory.addGetterSetter(P,"anchorDragBoundFunc"),w.Factory.addGetterSetter(P,"anchorStyleFunc"),w.Factory.addGetterSetter(P,"shouldOverdrawWholeArea",!1),w.Factory.addGetterSetter(P,"useSingleNodeRotation",!0),w.Factory.backCompat(P,{lineEnabled:"borderEnabled",rotateHandlerOffset:"rotateAnchorOffset",enabledHandlers:"enabledAnchors"}),se}var ae={},Bi;function hr(){if(Bi)return ae;Bi=1,Object.defineProperty(ae,"__esModule",{value:!0}),ae.Wedge=void 0;const m=rt(),w=_t(),L=nt(),R=st(),C=nt();let f=class extends w.Shape{_sceneFunc(r){r.beginPath(),r.arc(0,0,this.radius(),0,L.Konva.getAngle(this.angle()),this.clockwise()),r.lineTo(0,0),r.closePath(),r.fillStrokeShape(this)}getWidth(){return this.radius()*2}getHeight(){return this.radius()*2}setWidth(r){this.radius(r/2)}setHeight(r){this.radius(r/2)}};return ae.Wedge=f,f.prototype.className="Wedge",f.prototype._centroid=!0,f.prototype._attrsAffectingSize=["radius"],(0,C._registerNode)(f),m.Factory.addGetterSetter(f,"radius",0,(0,R.getNumberValidator)()),m.Factory.addGetterSetter(f,"angle",0,(0,R.getNumberValidator)()),m.Factory.addGetterSetter(f,"clockwise",!1),m.Factory.backCompat(f,{angleDeg:"angle",getAngleDeg:"getAngle",setAngleDeg:"setAngle"}),ae}var oe={},Vi;function cr(){if(Vi)return oe;Vi=1,Object.defineProperty(oe,"__esModule",{value:!0}),oe.Blur=void 0;const m=rt(),w=gt(),L=st();function R(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}const C=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],f=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];function h(l,o){const a=l.data,g=l.width,c=l.height;let i,n,d,y,b,e,t,s,p,P,G,_,v,S,k,F,D,I,N,W;const u=o+o+1,x=g-1,E=c-1,T=o+1,M=T*(T+1)/2,V=new R,O=C[o],H=f[o];let j=null,B=V,A=null,U=null;for(let Y=1;Y<u;Y++)B=B.next=new R,Y===T&&(j=B);B.next=V,d=n=0;for(let Y=0;Y<c;Y++){_=v=S=k=y=b=e=t=0,s=T*(F=a[n]),p=T*(D=a[n+1]),P=T*(I=a[n+2]),G=T*(N=a[n+3]),y+=M*F,b+=M*D,e+=M*I,t+=M*N,B=V;for(let X=0;X<T;X++)B.r=F,B.g=D,B.b=I,B.a=N,B=B.next;for(let X=1;X<T;X++)i=n+((x<X?x:X)<<2),y+=(B.r=F=a[i])*(W=T-X),b+=(B.g=D=a[i+1])*W,e+=(B.b=I=a[i+2])*W,t+=(B.a=N=a[i+3])*W,_+=F,v+=D,S+=I,k+=N,B=B.next;A=V,U=j;for(let X=0;X<g;X++)a[n+3]=N=t*O>>H,N!==0?(N=255/N,a[n]=(y*O>>H)*N,a[n+1]=(b*O>>H)*N,a[n+2]=(e*O>>H)*N):a[n]=a[n+1]=a[n+2]=0,y-=s,b-=p,e-=P,t-=G,s-=A.r,p-=A.g,P-=A.b,G-=A.a,i=d+((i=X+o+1)<x?i:x)<<2,_+=A.r=a[i],v+=A.g=a[i+1],S+=A.b=a[i+2],k+=A.a=a[i+3],y+=_,b+=v,e+=S,t+=k,A=A.next,s+=F=U.r,p+=D=U.g,P+=I=U.b,G+=N=U.a,_-=F,v-=D,S-=I,k-=N,U=U.next,n+=4;d+=g}for(let Y=0;Y<g;Y++){v=S=k=_=b=e=t=y=0,n=Y<<2,s=T*(F=a[n]),p=T*(D=a[n+1]),P=T*(I=a[n+2]),G=T*(N=a[n+3]),y+=M*F,b+=M*D,e+=M*I,t+=M*N,B=V;for(let $=0;$<T;$++)B.r=F,B.g=D,B.b=I,B.a=N,B=B.next;let X=g;for(let $=1;$<=o;$++)n=X+Y<<2,y+=(B.r=F=a[n])*(W=T-$),b+=(B.g=D=a[n+1])*W,e+=(B.b=I=a[n+2])*W,t+=(B.a=N=a[n+3])*W,_+=F,v+=D,S+=I,k+=N,B=B.next,$<E&&(X+=g);n=Y,A=V,U=j;for(let $=0;$<c;$++)i=n<<2,a[i+3]=N=t*O>>H,N>0?(N=255/N,a[i]=(y*O>>H)*N,a[i+1]=(b*O>>H)*N,a[i+2]=(e*O>>H)*N):a[i]=a[i+1]=a[i+2]=0,y-=s,b-=p,e-=P,t-=G,s-=A.r,p-=A.g,P-=A.b,G-=A.a,i=Y+((i=$+T)<E?i:E)*g<<2,y+=_+=A.r=a[i],b+=v+=A.g=a[i+1],e+=S+=A.b=a[i+2],t+=k+=A.a=a[i+3],A=A.next,s+=F=U.r,p+=D=U.g,P+=I=U.b,G+=N=U.a,_-=F,v-=D,S-=I,k-=N,U=U.next,n+=g}}const r=function(o){const a=Math.round(this.blurRadius());a>0&&h(o,a)};return oe.Blur=r,m.Factory.addGetterSetter(w.Node,"blurRadius",0,(0,L.getNumberValidator)(),m.Factory.afterSetFilter),oe}var le={},Hi;function dr(){if(Hi)return le;Hi=1,Object.defineProperty(le,"__esModule",{value:!0}),le.Brighten=void 0;const m=rt(),w=gt(),L=st(),R=function(C){const f=this.brightness()*255,h=C.data,r=h.length;for(let l=0;l<r;l+=4)h[l]+=f,h[l+1]+=f,h[l+2]+=f};return le.Brighten=R,m.Factory.addGetterSetter(w.Node,"brightness",0,(0,L.getNumberValidator)(),m.Factory.afterSetFilter),le}var he={},zi;function ur(){if(zi)return he;zi=1,Object.defineProperty(he,"__esModule",{value:!0}),he.Contrast=void 0;const m=rt(),w=gt(),L=st(),R=function(C){const f=Math.pow((this.contrast()+100)/100,2),h=C.data,r=h.length;let l=150,o=150,a=150;for(let g=0;g<r;g+=4)l=h[g],o=h[g+1],a=h[g+2],l/=255,l-=.5,l*=f,l+=.5,l*=255,o/=255,o-=.5,o*=f,o+=.5,o*=255,a/=255,a-=.5,a*=f,a+=.5,a*=255,l=l<0?0:l>255?255:l,o=o<0?0:o>255?255:o,a=a<0?0:a>255?255:a,h[g]=l,h[g+1]=o,h[g+2]=a};return he.Contrast=R,m.Factory.addGetterSetter(w.Node,"contrast",0,(0,L.getNumberValidator)(),m.Factory.afterSetFilter),he}var ce={},qi;function fr(){if(qi)return ce;qi=1,Object.defineProperty(ce,"__esModule",{value:!0}),ce.Emboss=void 0;const m=rt(),w=gt(),L=dt(),R=st(),C=function(f){const h=this.embossStrength()*10,r=this.embossWhiteLevel()*255,l=this.embossDirection(),o=this.embossBlend(),a=f.data,g=f.width,c=f.height,i=g*4;let n=0,d=0,y=c;switch(l){case"top-left":n=-1,d=-1;break;case"top":n=-1,d=0;break;case"top-right":n=-1,d=1;break;case"right":n=0,d=1;break;case"bottom-right":n=1,d=1;break;case"bottom":n=1,d=0;break;case"bottom-left":n=1,d=-1;break;case"left":n=0,d=-1;break;default:L.Util.error("Unknown emboss direction: "+l)}do{const b=(y-1)*i;let e=n;y+e<1&&(e=0),y+e>c&&(e=0);const t=(y-1+e)*g*4;let s=g;do{const p=b+(s-1)*4;let P=d;s+P<1&&(P=0),s+P>g&&(P=0);const G=t+(s-1+P)*4,_=a[p]-a[G],v=a[p+1]-a[G+1],S=a[p+2]-a[G+2];let k=_;const F=k>0?k:-k,D=v>0?v:-v,I=S>0?S:-S;if(D>F&&(k=v),I>F&&(k=S),k*=h,o){const N=a[p]+k,W=a[p+1]+k,u=a[p+2]+k;a[p]=N>255?255:N<0?0:N,a[p+1]=W>255?255:W<0?0:W,a[p+2]=u>255?255:u<0?0:u}else{let N=r-k;N<0?N=0:N>255&&(N=255),a[p]=a[p+1]=a[p+2]=N}}while(--s)}while(--y)};return ce.Emboss=C,m.Factory.addGetterSetter(w.Node,"embossStrength",.5,(0,R.getNumberValidator)(),m.Factory.afterSetFilter),m.Factory.addGetterSetter(w.Node,"embossWhiteLevel",.5,(0,R.getNumberValidator)(),m.Factory.afterSetFilter),m.Factory.addGetterSetter(w.Node,"embossDirection","top-left",void 0,m.Factory.afterSetFilter),m.Factory.addGetterSetter(w.Node,"embossBlend",!1,void 0,m.Factory.afterSetFilter),ce}var de={},Wi;function gr(){if(Wi)return de;Wi=1,Object.defineProperty(de,"__esModule",{value:!0}),de.Enhance=void 0;const m=rt(),w=gt(),L=st();function R(f,h,r,l,o){const a=r-h,g=o-l;if(a===0)return l+g/2;if(g===0)return l;let c=(f-h)/a;return c=g*c+l,c}const C=function(f){const h=f.data,r=h.length;let l=h[0],o=l,a,g=h[1],c=g,i,n=h[2],d=n,y;const b=this.enhance();if(b===0)return;for(let _=0;_<r;_+=4)a=h[_+0],a<l?l=a:a>o&&(o=a),i=h[_+1],i<g?g=i:i>c&&(c=i),y=h[_+2],y<n?n=y:y>d&&(d=y);o===l&&(o=255,l=0),c===g&&(c=255,g=0),d===n&&(d=255,n=0);let e,t,s,p,P,G;if(b>0)e=o+b*(255-o),t=l-b*(l-0),s=c+b*(255-c),p=g-b*(g-0),P=d+b*(255-d),G=n-b*(n-0);else{const _=(o+l)*.5;e=o+b*(o-_),t=l+b*(l-_);const v=(c+g)*.5;s=c+b*(c-v),p=g+b*(g-v);const S=(d+n)*.5;P=d+b*(d-S),G=n+b*(n-S)}for(let _=0;_<r;_+=4)h[_+0]=R(h[_+0],l,o,t,e),h[_+1]=R(h[_+1],g,c,p,s),h[_+2]=R(h[_+2],n,d,G,P)};return de.Enhance=C,m.Factory.addGetterSetter(w.Node,"enhance",0,(0,L.getNumberValidator)(),m.Factory.afterSetFilter),de}var ue={},Yi;function pr(){if(Yi)return ue;Yi=1,Object.defineProperty(ue,"__esModule",{value:!0}),ue.Grayscale=void 0;const m=function(w){const L=w.data,R=L.length;for(let C=0;C<R;C+=4){const f=.34*L[C]+.5*L[C+1]+.16*L[C+2];L[C]=f,L[C+1]=f,L[C+2]=f}};return ue.Grayscale=m,ue}var fe={},ji;function mr(){if(ji)return fe;ji=1,Object.defineProperty(fe,"__esModule",{value:!0}),fe.HSL=void 0;const m=rt(),w=gt(),L=st();m.Factory.addGetterSetter(w.Node,"hue",0,(0,L.getNumberValidator)(),m.Factory.afterSetFilter),m.Factory.addGetterSetter(w.Node,"saturation",0,(0,L.getNumberValidator)(),m.Factory.afterSetFilter),m.Factory.addGetterSetter(w.Node,"luminance",0,(0,L.getNumberValidator)(),m.Factory.afterSetFilter);const R=function(C){const f=C.data,h=f.length,r=1,l=Math.pow(2,this.saturation()),o=Math.abs(this.hue()+360)%360,a=this.luminance()*127,g=r*l*Math.cos(o*Math.PI/180),c=r*l*Math.sin(o*Math.PI/180),i=.299*r+.701*g+.167*c,n=.587*r-.587*g+.33*c,d=.114*r-.114*g-.497*c,y=.299*r-.299*g-.328*c,b=.587*r+.413*g+.035*c,e=.114*r-.114*g+.293*c,t=.299*r-.3*g+1.25*c,s=.587*r-.586*g-1.05*c,p=.114*r+.886*g-.2*c;let P,G,_,v;for(let S=0;S<h;S+=4)P=f[S+0],G=f[S+1],_=f[S+2],v=f[S+3],f[S+0]=i*P+n*G+d*_+a,f[S+1]=y*P+b*G+e*_+a,f[S+2]=t*P+s*G+p*_+a,f[S+3]=v};return fe.HSL=R,fe}var ge={},Ki;function _r(){if(Ki)return ge;Ki=1,Object.defineProperty(ge,"__esModule",{value:!0}),ge.HSV=void 0;const m=rt(),w=gt(),L=st(),R=function(C){const f=C.data,h=f.length,r=Math.pow(2,this.value()),l=Math.pow(2,this.saturation()),o=Math.abs(this.hue()+360)%360,a=r*l*Math.cos(o*Math.PI/180),g=r*l*Math.sin(o*Math.PI/180),c=.299*r+.701*a+.167*g,i=.587*r-.587*a+.33*g,n=.114*r-.114*a-.497*g,d=.299*r-.299*a-.328*g,y=.587*r+.413*a+.035*g,b=.114*r-.114*a+.293*g,e=.299*r-.3*a+1.25*g,t=.587*r-.586*a-1.05*g,s=.114*r+.886*a-.2*g;for(let p=0;p<h;p+=4){const P=f[p+0],G=f[p+1],_=f[p+2],v=f[p+3];f[p+0]=c*P+i*G+n*_,f[p+1]=d*P+y*G+b*_,f[p+2]=e*P+t*G+s*_,f[p+3]=v}};return ge.HSV=R,m.Factory.addGetterSetter(w.Node,"hue",0,(0,L.getNumberValidator)(),m.Factory.afterSetFilter),m.Factory.addGetterSetter(w.Node,"saturation",0,(0,L.getNumberValidator)(),m.Factory.afterSetFilter),m.Factory.addGetterSetter(w.Node,"value",0,(0,L.getNumberValidator)(),m.Factory.afterSetFilter),ge}var pe={},Xi;function yr(){if(Xi)return pe;Xi=1,Object.defineProperty(pe,"__esModule",{value:!0}),pe.Invert=void 0;const m=function(w){const L=w.data,R=L.length;for(let C=0;C<R;C+=4)L[C]=255-L[C],L[C+1]=255-L[C+1],L[C+2]=255-L[C+2]};return pe.Invert=m,pe}var me={},$i;function vr(){if($i)return me;$i=1,Object.defineProperty(me,"__esModule",{value:!0}),me.Kaleidoscope=void 0;const m=rt(),w=gt(),L=dt(),R=st(),C=function(r,l,o){const a=r.data,g=l.data,c=r.width,i=r.height,n=o.polarCenterX||c/2,d=o.polarCenterY||i/2;let y=Math.sqrt(n*n+d*d),b=c-n,e=i-d;const t=Math.sqrt(b*b+e*e);y=t>y?t:y;const s=i,p=c,P=360/p*Math.PI/180;for(let G=0;G<p;G+=1){const _=Math.sin(G*P),v=Math.cos(G*P);for(let S=0;S<s;S+=1){b=Math.floor(n+y*S/s*v),e=Math.floor(d+y*S/s*_);let k=(e*c+b)*4;const F=a[k+0],D=a[k+1],I=a[k+2],N=a[k+3];k=(G+S*c)*4,g[k+0]=F,g[k+1]=D,g[k+2]=I,g[k+3]=N}}},f=function(r,l,o){const a=r.data,g=l.data,c=r.width,i=r.height,n=o.polarCenterX||c/2,d=o.polarCenterY||i/2;let y=Math.sqrt(n*n+d*d),b=c-n,e=i-d;const t=Math.sqrt(b*b+e*e);y=t>y?t:y;const s=i,p=c,P=0;let G,_;for(b=0;b<c;b+=1)for(e=0;e<i;e+=1){const v=b-n,S=e-d,k=Math.sqrt(v*v+S*S)*s/y;let F=(Math.atan2(S,v)*180/Math.PI+360+P)%360;F=F*p/360,G=Math.floor(F),_=Math.floor(k);let D=(_*c+G)*4;const I=a[D+0],N=a[D+1],W=a[D+2],u=a[D+3];D=(e*c+b)*4,g[D+0]=I,g[D+1]=N,g[D+2]=W,g[D+3]=u}},h=function(r){const l=r.width,o=r.height;let a,g,c,i,n,d,y,b,e,t,s=Math.round(this.kaleidoscopePower());const p=Math.round(this.kaleidoscopeAngle()),P=Math.floor(l*(p%360)/360);if(s<1)return;const G=L.Util.createCanvasElement();G.width=l,G.height=o;const _=G.getContext("2d").getImageData(0,0,l,o);L.Util.releaseCanvas(G),C(r,_,{polarCenterX:l/2,polarCenterY:o/2});let v=l/Math.pow(2,s);for(;v<=8;)v=v*2,s-=1;v=Math.ceil(v);let S=v,k=0,F=S,D=1;for(P+v>l&&(k=S,F=0,D=-1),g=0;g<o;g+=1)for(a=k;a!==F;a+=D)c=Math.round(a+P)%l,e=(l*g+c)*4,n=_.data[e+0],d=_.data[e+1],y=_.data[e+2],b=_.data[e+3],t=(l*g+a)*4,_.data[t+0]=n,_.data[t+1]=d,_.data[t+2]=y,_.data[t+3]=b;for(g=0;g<o;g+=1)for(S=Math.floor(v),i=0;i<s;i+=1){for(a=0;a<S+1;a+=1)e=(l*g+a)*4,n=_.data[e+0],d=_.data[e+1],y=_.data[e+2],b=_.data[e+3],t=(l*g+S*2-a-1)*4,_.data[t+0]=n,_.data[t+1]=d,_.data[t+2]=y,_.data[t+3]=b;S*=2}f(_,r,{})};return me.Kaleidoscope=h,m.Factory.addGetterSetter(w.Node,"kaleidoscopePower",2,(0,R.getNumberValidator)(),m.Factory.afterSetFilter),m.Factory.addGetterSetter(w.Node,"kaleidoscopeAngle",0,(0,R.getNumberValidator)(),m.Factory.afterSetFilter),me}var _e={},Qi;function br(){if(Qi)return _e;Qi=1,Object.defineProperty(_e,"__esModule",{value:!0}),_e.Mask=void 0;const m=rt(),w=gt(),L=st();function R(c,i,n){let d=(n*c.width+i)*4;const y=[];return y.push(c.data[d++],c.data[d++],c.data[d++],c.data[d++]),y}function C(c,i){return Math.sqrt(Math.pow(c[0]-i[0],2)+Math.pow(c[1]-i[1],2)+Math.pow(c[2]-i[2],2))}function f(c){const i=[0,0,0];for(let n=0;n<c.length;n++)i[0]+=c[n][0],i[1]+=c[n][1],i[2]+=c[n][2];return i[0]/=c.length,i[1]/=c.length,i[2]/=c.length,i}function h(c,i){const n=R(c,0,0),d=R(c,c.width-1,0),y=R(c,0,c.height-1),b=R(c,c.width-1,c.height-1),e=i||10;if(C(n,d)<e&&C(d,b)<e&&C(b,y)<e&&C(y,n)<e){const t=f([d,n,b,y]),s=[];for(let p=0;p<c.width*c.height;p++){const P=C(t,[c.data[p*4],c.data[p*4+1],c.data[p*4+2]]);s[p]=P<e?0:255}return s}}function r(c,i){for(let n=0;n<c.width*c.height;n++)c.data[4*n+3]=i[n]}function l(c,i,n){const d=[1,1,1,1,0,1,1,1,1],y=Math.round(Math.sqrt(d.length)),b=Math.floor(y/2),e=[];for(let t=0;t<n;t++)for(let s=0;s<i;s++){const p=t*i+s;let P=0;for(let G=0;G<y;G++)for(let _=0;_<y;_++){const v=t+G-b,S=s+_-b;if(v>=0&&v<n&&S>=0&&S<i){const k=v*i+S,F=d[G*y+_];P+=c[k]*F}}e[p]=P===2040?255:0}return e}function o(c,i,n){const d=[1,1,1,1,1,1,1,1,1],y=Math.round(Math.sqrt(d.length)),b=Math.floor(y/2),e=[];for(let t=0;t<n;t++)for(let s=0;s<i;s++){const p=t*i+s;let P=0;for(let G=0;G<y;G++)for(let _=0;_<y;_++){const v=t+G-b,S=s+_-b;if(v>=0&&v<n&&S>=0&&S<i){const k=v*i+S,F=d[G*y+_];P+=c[k]*F}}e[p]=P>=1020?255:0}return e}function a(c,i,n){const d=[.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111],y=Math.round(Math.sqrt(d.length)),b=Math.floor(y/2),e=[];for(let t=0;t<n;t++)for(let s=0;s<i;s++){const p=t*i+s;let P=0;for(let G=0;G<y;G++)for(let _=0;_<y;_++){const v=t+G-b,S=s+_-b;if(v>=0&&v<n&&S>=0&&S<i){const k=v*i+S,F=d[G*y+_];P+=c[k]*F}}e[p]=P}return e}const g=function(c){const i=this.threshold();let n=h(c,i);return n&&(n=l(n,c.width,c.height),n=o(n,c.width,c.height),n=a(n,c.width,c.height),r(c,n)),c};return _e.Mask=g,m.Factory.addGetterSetter(w.Node,"threshold",0,(0,L.getNumberValidator)(),m.Factory.afterSetFilter),_e}var ye={},Ji;function Sr(){if(Ji)return ye;Ji=1,Object.defineProperty(ye,"__esModule",{value:!0}),ye.Noise=void 0;const m=rt(),w=gt(),L=st(),R=function(C){const f=this.noise()*255,h=C.data,r=h.length,l=f/2;for(let o=0;o<r;o+=4)h[o+0]+=l-2*l*Math.random(),h[o+1]+=l-2*l*Math.random(),h[o+2]+=l-2*l*Math.random()};return ye.Noise=R,m.Factory.addGetterSetter(w.Node,"noise",.2,(0,L.getNumberValidator)(),m.Factory.afterSetFilter),ye}var ve={},Zi;function Cr(){if(Zi)return ve;Zi=1,Object.defineProperty(ve,"__esModule",{value:!0}),ve.Pixelate=void 0;const m=rt(),w=dt(),L=gt(),R=st(),C=function(f){let h=Math.ceil(this.pixelSize()),r=f.width,l=f.height,o=Math.ceil(r/h),a=Math.ceil(l/h),g=f.data;if(h<=0){w.Util.error("pixelSize value can not be <= 0");return}for(let c=0;c<o;c+=1)for(let i=0;i<a;i+=1){let n=0,d=0,y=0,b=0;const e=c*h,t=e+h,s=i*h,p=s+h;let P=0;for(let G=e;G<t;G+=1)if(!(G>=r))for(let _=s;_<p;_+=1){if(_>=l)continue;const v=(r*_+G)*4;n+=g[v+0],d+=g[v+1],y+=g[v+2],b+=g[v+3],P+=1}n=n/P,d=d/P,y=y/P,b=b/P;for(let G=e;G<t;G+=1)if(!(G>=r))for(let _=s;_<p;_+=1){if(_>=l)continue;const v=(r*_+G)*4;g[v+0]=n,g[v+1]=d,g[v+2]=y,g[v+3]=b}}};return ve.Pixelate=C,m.Factory.addGetterSetter(L.Node,"pixelSize",8,(0,R.getNumberValidator)(),m.Factory.afterSetFilter),ve}var be={},tn;function wr(){if(tn)return be;tn=1,Object.defineProperty(be,"__esModule",{value:!0}),be.Posterize=void 0;const m=rt(),w=gt(),L=st(),R=function(C){const f=Math.round(this.levels()*254)+1,h=C.data,r=h.length,l=255/f;for(let o=0;o<r;o+=1)h[o]=Math.floor(h[o]/l)*l};return be.Posterize=R,m.Factory.addGetterSetter(w.Node,"levels",.5,(0,L.getNumberValidator)(),m.Factory.afterSetFilter),be}var Se={},en;function xr(){if(en)return Se;en=1,Object.defineProperty(Se,"__esModule",{value:!0}),Se.RGB=void 0;const m=rt(),w=gt(),L=st(),R=function(C){const f=C.data,h=f.length,r=this.red(),l=this.green(),o=this.blue();for(let a=0;a<h;a+=4){const g=(.34*f[a]+.5*f[a+1]+.16*f[a+2])/255;f[a]=g*r,f[a+1]=g*l,f[a+2]=g*o,f[a+3]=f[a+3]}};return Se.RGB=R,m.Factory.addGetterSetter(w.Node,"red",0,function(C){return this._filterUpToDate=!1,C>255?255:C<0?0:Math.round(C)}),m.Factory.addGetterSetter(w.Node,"green",0,function(C){return this._filterUpToDate=!1,C>255?255:C<0?0:Math.round(C)}),m.Factory.addGetterSetter(w.Node,"blue",0,L.RGBComponent,m.Factory.afterSetFilter),Se}var Ce={},nn;function Pr(){if(nn)return Ce;nn=1,Object.defineProperty(Ce,"__esModule",{value:!0}),Ce.RGBA=void 0;const m=rt(),w=gt(),L=st(),R=function(C){const f=C.data,h=f.length,r=this.red(),l=this.green(),o=this.blue(),a=this.alpha();for(let g=0;g<h;g+=4){const c=1-a;f[g]=r*a+f[g]*c,f[g+1]=l*a+f[g+1]*c,f[g+2]=o*a+f[g+2]*c}};return Ce.RGBA=R,m.Factory.addGetterSetter(w.Node,"red",0,function(C){return this._filterUpToDate=!1,C>255?255:C<0?0:Math.round(C)}),m.Factory.addGetterSetter(w.Node,"green",0,function(C){return this._filterUpToDate=!1,C>255?255:C<0?0:Math.round(C)}),m.Factory.addGetterSetter(w.Node,"blue",0,L.RGBComponent,m.Factory.afterSetFilter),m.Factory.addGetterSetter(w.Node,"alpha",1,function(C){return this._filterUpToDate=!1,C>1?1:C<0?0:C}),Ce}var we={},rn;function kr(){if(rn)return we;rn=1,Object.defineProperty(we,"__esModule",{value:!0}),we.Sepia=void 0;const m=function(w){const L=w.data,R=L.length;for(let C=0;C<R;C+=4){const f=L[C+0],h=L[C+1],r=L[C+2];L[C+0]=Math.min(255,f*.393+h*.769+r*.189),L[C+1]=Math.min(255,f*.349+h*.686+r*.168),L[C+2]=Math.min(255,f*.272+h*.534+r*.131)}};return we.Sepia=m,we}var xe={},sn;function Rr(){if(sn)return xe;sn=1,Object.defineProperty(xe,"__esModule",{value:!0}),xe.Solarize=void 0;const m=function(w){const L=w.data,R=w.width,C=w.height,f=R*4;let h=C;do{const r=(h-1)*f;let l=R;do{const o=r+(l-1)*4;let a=L[o],g=L[o+1],c=L[o+2];a>127&&(a=255-a),g>127&&(g=255-g),c>127&&(c=255-c),L[o]=a,L[o+1]=g,L[o+2]=c}while(--l)}while(--h)};return xe.Solarize=m,xe}var Pe={},an;function Tr(){if(an)return Pe;an=1,Object.defineProperty(Pe,"__esModule",{value:!0}),Pe.Threshold=void 0;const m=rt(),w=gt(),L=st(),R=function(C){const f=this.threshold()*255,h=C.data,r=h.length;for(let l=0;l<r;l+=1)h[l]=h[l]<f?0:255};return Pe.Threshold=R,m.Factory.addGetterSetter(w.Node,"threshold",.5,(0,L.getNumberValidator)(),m.Factory.afterSetFilter),Pe}var on;function Ar(){if(on)return Ut;on=1,Object.defineProperty(Ut,"__esModule",{value:!0}),Ut.Konva=void 0;const m=Xn(),w=$n(),L=Jn(),R=Zn(),C=tr(),f=er(),h=ir(),r=fn(),l=Qe(),o=gn(),a=nr(),g=rr(),c=sr(),i=ar(),n=pn(),d=or(),y=lr(),b=hr(),e=cr(),t=dr(),s=ur(),p=fr(),P=gr(),G=pr(),_=mr(),v=_r(),S=yr(),k=vr(),F=br(),D=Sr(),I=Cr(),N=wr(),W=xr(),u=Pr(),x=kr(),E=Rr(),T=Tr();return Ut.Konva=m.Konva.Util._assign(m.Konva,{Arc:w.Arc,Arrow:L.Arrow,Circle:R.Circle,Ellipse:C.Ellipse,Image:f.Image,Label:h.Label,Tag:h.Tag,Line:r.Line,Path:l.Path,Rect:o.Rect,RegularPolygon:a.RegularPolygon,Ring:g.Ring,Sprite:c.Sprite,Star:i.Star,Text:n.Text,TextPath:d.TextPath,Transformer:y.Transformer,Wedge:b.Wedge,Filters:{Blur:e.Blur,Brighten:t.Brighten,Contrast:s.Contrast,Emboss:p.Emboss,Enhance:P.Enhance,Grayscale:G.Grayscale,HSL:_.HSL,HSV:v.HSV,Invert:S.Invert,Kaleidoscope:k.Kaleidoscope,Mask:F.Mask,Noise:D.Noise,Pixelate:I.Pixelate,Posterize:N.Posterize,RGB:W.RGB,RGBA:u.RGBA,Sepia:x.Sepia,Solarize:E.Solarize,Threshold:T.Threshold}}),Ut}var Er=Me.exports,ln;function Fr(){if(ln)return Me.exports;ln=1,Object.defineProperty(Er,"__esModule",{value:!0});const m=Ar();return Me.exports=m.Konva,Me.exports}var Mr=Fr();const vt=yn(Mr),Gr={class:"p-4 space-y-4"},Nr={class:"flex justify-between items-center mb-1"},Lr=["value"],Or={class:"flex justify-between items-center mb-1"},Dr=["value"],Ir={__name:"FloatingPromptPanel",props:{prompt:String,negativePrompt:String},emits:["update:prompt","update:negativePrompt","enhance"],setup(m){const w=mt(!1),L=mt(null),R=mt({x:0,y:0}),C=mt({x:0,y:0}),f=mt(!1);function h(o){f.value=!0,C.value.x=o.clientX-R.value.x,C.value.y=o.clientY-R.value.y,window.addEventListener("mousemove",r),window.addEventListener("mouseup",l)}function r(o){f.value&&(R.value.x=o.clientX-C.value.x,R.value.y=o.clientY-C.value.y)}function l(){f.value=!1,window.removeEventListener("mousemove",r),window.removeEventListener("mouseup",l)}return hn(()=>{window.removeEventListener("mousemove",r),window.removeEventListener("mouseup",l)}),(o,a)=>(lt(),ft("div",{ref_key:"panelRef",ref:L,class:"absolute top-4 left-4 w-96 bg-white dark:bg-gray-800 rounded-lg shadow-lg border dark:border-gray-700 z-10",style:Fe({transform:`translate(${R.value.x}px, ${R.value.y}px)`})},[Q("div",{class:"flex items-center justify-between p-2 cursor-move border-b dark:border-gray-700",onMousedown:h},[a[5]||(a[5]=Q("h3",{class:"font-semibold text-lg"},"Prompts",-1)),Q("button",{onClick:a[0]||(a[0]=g=>w.value=!w.value),class:"btn-icon"},[w.value?(lt(),Nt(bn,{key:1,class:"w-5 h-5"})):(lt(),Nt(vn,{key:0,class:"w-5 h-5"}))])],32),ke(Q("div",Gr,[Q("div",null,[Q("div",Nr,[a[6]||(a[6]=Q("label",{for:"floating-prompt",class:"block text-sm font-medium"},"Prompt",-1)),Q("button",{onClick:a[1]||(a[1]=g=>o.$emit("enhance","prompt")),class:"btn-icon",title:"Enhance prompt with AI"},[Et(ti,{class:"w-4 h-4"})])]),Q("textarea",{id:"floating-prompt",value:m.prompt,onInput:a[2]||(a[2]=g=>o.$emit("update:prompt",g.target.value)),rows:"4",class:"input-field w-full",placeholder:"Describe the image..."},null,40,Lr)]),Q("div",null,[Q("div",Or,[a[7]||(a[7]=Q("label",{for:"floating-neg-prompt",class:"block text-sm font-medium"},"Negative Prompt",-1)),Q("button",{onClick:a[3]||(a[3]=g=>o.$emit("enhance","negative_prompt")),class:"btn-icon",title:"Enhance negative prompt with AI"},[Et(ti,{class:"w-4 h-4"})])]),Q("textarea",{id:"floating-neg-prompt",value:m.negativePrompt,onInput:a[4]||(a[4]=g=>o.$emit("update:negativePrompt",g.target.value)),rows:"3",class:"input-field w-full",placeholder:"ugly, blurry..."},null,40,Dr)])],512),[[Sn,!w.value]])],4))}},Ur={},Br={xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"};function Vr(m,w){return lt(),ft("svg",Br,w[0]||(w[0]=[Q("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M21 11.25v8.25a1.5 1.5 0 0 1-1.5 1.5H5.25a1.5 1.5 0 0 1-1.5-1.5v-8.25M12 4.875A2.625 2.625 0 1 0 9.375 7.5H12m0-2.625V7.5m0-2.625A2.625 2.625 0 1 1 14.625 7.5H12m0 0V21m-8.625-9.75h18c.621 0 1.125-.504 1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125h-18c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125Z"},null,-1)]))}const Hr=Dt(Ur,[["render",Vr]]),zr={},qr={xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"};function Wr(m,w){return lt(),ft("svg",qr,w[0]||(w[0]=[Q("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15.042 21.672 13.684 16.6m0 0-2.51 2.225.569-9.47 5.227 7.917-3.286-.672ZM12 2.25V4.5m5.834.166-1.591 1.591M21.75 12h-2.25m-1.666 5.834L16.5 16.5M4.5 12H2.25m1.666 5.834 1.591-1.591M5.25 5.25 6.84 6.84"},null,-1)]))}const Yr=Dt(zr,[["render",Wr]]),jr={},Kr={xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"};function Xr(m,w){return lt(),ft("svg",Kr,w[0]||(w[0]=[Q("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"},null,-1)]))}const $r=Dt(jr,[["render",Xr]]),Qr={},Jr={xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"};function Zr(m,w){return lt(),ft("svg",Jr,w[0]||(w[0]=[Q("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M5.25 7.5A2.25 2.25 0 0 1 7.5 5.25h9a2.25 2.25 0 0 1 2.25 2.25v9a2.25 2.25 0 0 1-2.25 2.25h-9a2.25 2.25 0 0 1-2.25-2.25v-9Z"},null,-1)]))}const ts=Dt(Qr,[["render",Zr]]),es={},is={width:"50px",height:"50px",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function ns(m,w){return lt(),ft("svg",is,w[0]||(w[0]=[Q("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"1.5"},null,-1),Q("path",{d:"M15 12H9",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round"},null,-1)]))}const rs=Dt(es,[["render",ns]]),ss={class:"flex items-center gap-2"},as=["disabled"],os=["disabled"],ls={class:"flex-grow min-h-0 flex"},hs={class:"w-16 flex-shrink-0 bg-white dark:bg-gray-800 border-r dark:border-gray-700 flex flex-col items-center py-4 space-y-2"},cs=["onClick","title"],ds={class:"w-80 flex-shrink-0 bg-white dark:bg-gray-800 border-r dark:border-gray-700 flex flex-col"},us={class:"flex-grow p-4 space-y-6 overflow-y-auto custom-scrollbar"},fs={key:0,class:"space-y-4"},gs={class:"block text-sm font-medium"},ps={key:0},ms={class:"block text-sm font-medium"},_s={key:1,class:"space-y-4"},ys={class:"block text-sm font-medium"},vs={key:2,class:"space-y-4 mt-4"},bs={class:"flex items-center gap-2 mt-1"},Ss={class:"grid grid-cols-6 gap-1 flex-1"},Cs=["onClick"],ws={key:3,class:"text-sm text-gray-500"},xs={key:0},Ps={key:1},ks={key:2},Rs={class:"p-4 border-t dark:border-gray-700 flex-shrink-0 h-1/3 flex flex-col"},Ts={class:"flex justify-between items-center mb-2"},As=["disabled"],Es={class:"flex-grow overflow-y-auto custom-scrollbar bg-gray-100 dark:bg-gray-900/50 rounded-md p-1"},Fs=["onClick"],Ms={class:"flex-grow truncate"},Gs={class:"p-4 border-t dark:border-gray-700 flex-shrink-0"},Ns={key:0,class:"absolute inset-0 bg-black/50 backdrop-blur-sm z-30 flex flex-col items-center justify-center text-white"},Ls={__name:"ImageEditorView",props:{id:String},setup(m){const w=Cn(),L=wn(),R=xn(),C=Pn(),f=En();Vn();const{on:h,off:r}=Fn(),{user:l}=kn(C),o=m,a=mt(null),g=mt(""),c=mt(""),i=mt(!1),n=mt(!1),d=Le(()=>i.value||n.value),y=mt(null),b=Rn({selectedModel:"",imageSize:"1024x1024",seed:-1,params:{strength:.75}}),e=mt(null),t=mt(null);let s=null,p=null,P=null,G=null,_=null;const v=mt([]),S=mt(null),k=mt("brush"),F=mt({brushSize:20,opacity:1,color:"#000000",strokeWidth:5}),D=["#FFFFFF","#000000","#FF0000","#00FF00","#0000FF","#FFFF00","#FF00FF","#00FFFF"];let I=!1,N;const W=mt([]),u=mt(-1),x=[{id:"select",name:"Select & Move",icon:Ft(Yr)},{id:"pan",name:"Pan View",icon:Ft(Hr)},{id:"zoom",name:"Zoom Tool",icon:Ft(Tn)},{id:"brush",name:"Brush",icon:Ft(ei)},{id:"eraser",name:"Eraser",icon:Ft(rs)},{id:"rect",name:"Rectangle",icon:Ft(ts)},{id:"circle",name:"Circle",icon:Ft($r)}],E=Le(()=>({backgroundImage:"linear-gradient(45deg, #ccc 25%, transparent 25%), linear-gradient(-45deg, #ccc 25%, transparent 25%), linear-gradient(45deg, transparent 75%, #ccc 75%), linear-gradient(-45deg, transparent 75%, #ccc 75%)",backgroundSize:"20px 20px",backgroundPosition:"0 0, 0 10px, 10px -10px, -10px 0px"})),T=Le(()=>({width:`${F.value.brushSize}px`,height:`${F.value.brushSize}px`}));An(async()=>{var K,q,Z,z;if(w.setPageTitle({title:"Image Editor",icon:Ft(ei)}),R.fetchAvailableTtiModels(),o.id&&o.id!=="new"){let J=L.images.find(ht=>ht.id===o.id);if(J||(await L.fetchImages(),J=L.images.find(ht=>ht.id===o.id)),!J){w.addNotification("Image not found.","error"),f.push("/image-studio");return}a.value={...J},g.value=J.prompt||"",c.value=J.negative_prompt||"",b.selectedModel=J.model||((K=l.value)==null?void 0:K.iti_binding_model_name)||((q=l.value)==null?void 0:q.tti_binding_model_name)||"",J.width&&J.height&&(b.imageSize=`${J.width}x${J.height}`),b.seed=J.seed??-1,b.params={...J.generation_params||{strength:.75}},b.params.strength||(b.params.strength=.75)}else g.value=L.prompt,c.value=L.negativePrompt,b.selectedModel=((Z=l.value)==null?void 0:Z.iti_binding_model_name)||((z=l.value)==null?void 0:z.tti_binding_model_name)||L.selectedModel||"",b.imageSize=L.imageSize,b.seed=L.seed,b.params={...L.generationParams};await V(),window.addEventListener("resize",H),window.addEventListener("keydown",et),h("task:completed",at),h("prompt:enhanced",M)}),hn(()=>{w.setPageTitle({title:""}),window.removeEventListener("resize",H),window.removeEventListener("keydown",et),r("task:completed",at),r("prompt:enhanced",M),s==null||s.destroy()});function M(K){K&&(K.prompt&&(g.value=K.prompt),K.negative_prompt&&(c.value=K.negative_prompt))}async function V(){await Mn(),e.value&&(s=new vt.Stage({container:"image-editor-stage",width:1024,height:1024}),p=new vt.Layer({id:"base"}),P=new vt.Layer({id:"draw"}),G=new vt.Layer({id:"images"}),s.add(p,P,G),v.value=[{id:"images",name:"Objects",visible:!0,layer:G},{id:"draw",name:"Drawing",visible:!0,layer:P},{id:"base",name:"Background",visible:!0,layer:p,konvaNode:null}],_=new vt.Transformer({keepRatio:!0,centeredScaling:!0}),G.add(_),await O(),H(),B())}async function O(K,q=null){let Z=1024,z=1024;const J=K||(a.value?`/api/image-studio/${a.value.id}/file`:null);if(q?(Z=q.width||1024,z=q.height||1024):a.value&&(Z=a.value.width||1024,z=a.value.height||1024),s.width(Z),s.height(z),p.destroyChildren(),J)try{const ht=await Gn.get(J,{responseType:"blob"}),yt=URL.createObjectURL(ht.data),ut=new Image;ut.src=yt,ut.onload=()=>{const Pt=new vt.Image({image:ut,id:"baseImage",name:"Base Image",x:0,y:0,width:Z,height:z});p.add(Pt);const bt=v.value.find(kt=>kt.id==="base");bt&&(bt.konvaNode=Pt),H(),URL.revokeObjectURL(yt)}}catch{w.addNotification("Failed to load base image.","error")}else{const ht=new vt.Rect({x:0,y:0,width:Z,height:z,fill:"#FFFFFF",name:"background-color"});p.add(ht)}W.value[u.value]!==J&&(W.value.splice(u.value+1),W.value.push(J),u.value++)}function H(){if(!s||!e.value)return;const{offsetWidth:K,offsetHeight:q}=e.value;if(K===0||q===0)return;const{width:Z,height:z}=s,J=Math.min(K/Z,q/z)*.95;!isFinite(J)||J<=0||(s.scale({x:J,y:J}),s.position({x:(K-Z*J)/2,y:(q-z*J)/2}))}function j(){return["rect","circle"].includes(k.value)?G:["brush","eraser"].includes(k.value)?P:G}function B(){s.on("mousedown touchstart",K=>{if(k.value==="pan"){s.container().style.cursor="grabbing";return}if(k.value==="select"){const z=K.target;if(z===s||z.getLayer().id()==="base"||z.getLayer().id()==="draw"){_.nodes([]),S.value=null;return}if(z.getParent()instanceof vt.Transformer)return;_.nodes([z]),S.value=z.id();return}I=!0;const q=s.getRelativePointerPosition();if(!q||isNaN(q.x)||isNaN(q.y))return;const Z=j();if(["brush","eraser"].includes(k.value)){const z=k.value==="brush"?A(F.value.color,F.value.opacity):"rgba(0,0,0,1)";N=new vt.Line({stroke:z,strokeWidth:F.value.brushSize,globalCompositeOperation:k.value==="eraser"?"destination-out":"source-over",lineCap:"round",lineJoin:"round",points:[q.x,q.y,q.x,q.y]}),Z.add(N)}else if(["rect","circle"].includes(k.value)){const z={x:q.x,y:q.y,width:0,height:0,fill:F.value.color,stroke:F.value.color,strokeWidth:F.value.strokeWidth,draggable:!1,name:"shape"};N=k.value==="rect"?new vt.Rect(z):new vt.Circle({...z,radius:0}),Z.add(N)}}),s.on("mousemove touchmove",K=>{if(!I||!N)return;const q=s.getRelativePointerPosition();if(q){if(["brush","eraser"].includes(k.value))N.points(N.points().concat([q.x,q.y]));else if(["rect","circle"].includes(k.value)){const Z=q.x-N.x(),z=q.y-N.y();k.value==="rect"?(N.width(Z),N.height(z)):N.radius(Math.sqrt(Z**2+z**2))}}}),s.on("mouseup touchend",()=>{if(k.value==="pan"&&(s.container().style.cursor="grab"),I){if(I=!1,N&&["rect","circle"].includes(k.value)){N.draggable(!0);const K=`s_${vt.Util.getRandomColor()}`;N.id(K),v.value.unshift({id:K,name:`${k.value} ${G.getChildren(q=>q.hasName("shape")).length}`,visible:!0,konvaNode:N}),U(N)}N=null}}),s.on("wheel",K=>{K.evt.preventDefault();const q=1.05,Z=s.scaleX(),z=s.getPointerPosition();if(!z)return;const J={x:(z.x-s.x())/Z,y:(z.y-s.y())/Z},ht=K.evt.deltaY>0?Z/q:Z*q;s.scale({x:ht,y:ht});const yt={x:z.x-J.x*ht,y:z.y-J.y*ht};s.position(yt)}),s.on("mouseenter",()=>{t.value&&(t.value.style.display="block")}),s.on("mouseleave",()=>{t.value&&(t.value.style.display="none")}),s.on("mousemove",K=>{t.value&&(t.value.style.left=`${K.evt.clientX}px`,t.value.style.top=`${K.evt.clientY}px`)})}function A(K,q){const Z=parseInt(K.slice(1,3),16),z=parseInt(K.slice(3,5),16),J=parseInt(K.slice(5,7),16);return`rgba(${Z}, ${z}, ${J}, ${q})`}function U(K){if(!K){_.nodes([]),S.value=null;return}_.nodes([K]),S.value=K.id()}function Y(K){const q=v.value.find(Z=>Z.id===K);if(q&&(q.konvaNode||q.layer)){const Z=q.konvaNode||q.layer,z=!Z.visible();Z.visible(z),q.visible=z}}function X(){if(S.value){const K=s.findOne(`#${S.value}`);K&&K.getParent()!==p&&(K.destroy(),_.nodes([]),S.value=null,v.value=v.value.filter(q=>q.id!==S.value))}}async function $(K){const q=K.clipboardData.items;for(const Z of q)if(Z.type.includes("image")){const z=Z.getAsFile(),J=new FileReader;J.onload=ht=>vt.Image.fromURL(ht.target.result,yt=>{const ut=`img_${vt.Util.getRandomColor()}`;yt.setAttrs({id:ut,x:20,y:20,draggable:!0,name:"image_paste"}),G.add(yt),v.value.unshift({id:ut,name:`Pasted ${G.getChildren(Pt=>Pt.hasName("image_paste")).length}`,visible:!0,konvaNode:yt}),U(yt)}),J.readAsDataURL(z),K.preventDefault();break}}async function tt(){n.value=!0;try{_==null||_.nodes([]);const K={drawing_b64:s.toDataURL({pixelRatio:1}).split(",")[1],prompt:g.value,model:b.selectedModel,width:s.width(),height:s.height()};await L.saveCanvasAsNewImage(K)&&f.replace("/image-studio")}finally{n.value=!1}}async function it(){i.value=!0;try{_==null||_.nodes([]);const[K,q]=b.imageSize.split("x").map(Number),Z={base_image_b64:s.toDataURL({pixelRatio:1}).split(",")[1],prompt:g.value,negative_prompt:c.value,model:b.selectedModel,width:K,height:q,seed:b.seed,...b.params},z=await L.editImage(Z);z&&(y.value=z.id)}catch{i.value=!1}}function at(K){if(K&&K.id===y.value&&K.status==="completed"&&K.result){const q=K.result;a.value=q;const Z=`/api/image-studio/${q.id}/file`;O(Z,q),i.value=!1,y.value=null}else K&&K.id===y.value&&(i.value=!1,y.value=null)}function et(K){K.ctrlKey&&K.key.toLowerCase()==="z"&&(K.preventDefault(),pt())}function pt(){u.value>0&&(u.value--,O(W.value[u.value]))}function ot(K){w.openModal("enhancePrompt",{onConfirm:async({instructions:q,mode:Z})=>{const z={prompt:g.value,negative_prompt:c.value,target:K,instructions:q,mode:Z};L.enhanceImagePrompt(z)}})}function ct(){w.openModal("imageEditorSettings",{settings:b})}return Nn(k,K=>{if(!s)return;const q=s.container();s.draggable(K==="pan");const Z={brush:"none",eraser:"none",rect:"crosshair",circle:"crosshair",pan:"grab",zoom:"zoom-in",select:"default"};q.style.cursor=Z[K]||"default",[...G.getChildren(),...P.getChildren()].forEach(z=>{z instanceof vt.Stage||z instanceof vt.Transformer||z.draggable(K==="select"&&(z.hasName("shape")||z.hasName("image_paste")))}),K!=="select"&&(_==null||_.nodes([]))}),(K,q)=>{const Z=Bn("router-link");return lt(),ft(Te,null,[(lt(),Nt(On,{to:"#global-header-actions-target"},[Q("div",ss,[Q("button",{onClick:tt,class:"btn btn-secondary",disabled:d.value},[Et(Ln,{class:"w-5 h-5 mr-2"}),q[6]||(q[6]=Oe(" Save As New Image "))],8,as),Q("button",{onClick:it,class:"btn btn-primary",disabled:d.value||!g.value.trim()},[i.value?(lt(),Nt(ii,{key:0,class:"w-5 h-5 mr-2 animate-spin"})):Rt("",!0),q[7]||(q[7]=Oe(" Apply Prompt "))],8,os)])])),Q("div",{class:"h-full flex flex-col bg-gray-50 dark:bg-gray-900 relative",onPaste:$},[Q("div",ls,[Q("div",hs,[(lt(),ft(Te,null,De(x,z=>Q("button",{key:z.id,onClick:J=>k.value=z.id,class:ni(["btn-icon p-2.5 rounded-lg",{"bg-blue-100 dark:bg-blue-900/50 text-blue-600 dark:text-blue-400":k.value===z.id}]),title:z.name},[(lt(),Nt(Hn(z.icon),{class:"w-6 h-6"}))],10,cs)),64))]),Q("div",ds,[Q("div",us,[Q("button",{onClick:ct,class:"btn btn-secondary w-full"},[Et(Dn,{class:"w-5 h-5 mr-2"}),q[8]||(q[8]=Oe(" Generation Settings"))]),Q("div",null,[q[10]||(q[10]=Q("h3",{class:"font-semibold text-lg border-b dark:border-gray-600 pb-2 mb-4"},"Tool Properties",-1)),["brush","eraser"].includes(k.value)?(lt(),ft("div",fs,[Q("div",null,[Q("label",gs,"Brush Size: "+Ae(F.value.brushSize),1),ke(Q("input",{type:"range",min:"1",max:"200","onUpdate:modelValue":q[0]||(q[0]=z=>F.value.brushSize=z),class:"w-full"},null,512),[[Ee,F.value.brushSize,void 0,{number:!0}]])]),k.value==="brush"?(lt(),ft("div",ps,[Q("label",ms,"Opacity: "+Ae(Math.round(F.value.opacity*100))+"%",1),ke(Q("input",{type:"range",min:"0.01",max:"1",step:"0.01","onUpdate:modelValue":q[1]||(q[1]=z=>F.value.opacity=z),class:"w-full"},null,512),[[Ee,F.value.opacity,void 0,{number:!0}]])])):Rt("",!0)])):Rt("",!0),["rect","circle"].includes(k.value)?(lt(),ft("div",_s,[Q("div",null,[Q("label",ys,"Stroke Width: "+Ae(F.value.strokeWidth),1),ke(Q("input",{type:"range",min:"0",max:"100","onUpdate:modelValue":q[2]||(q[2]=z=>F.value.strokeWidth=z),class:"w-full"},null,512),[[Ee,F.value.strokeWidth,void 0,{number:!0}]])])])):Rt("",!0),["brush","rect","circle"].includes(k.value)?(lt(),ft("div",vs,[Q("div",null,[q[9]||(q[9]=Q("label",{class:"block text-sm font-medium"},"Color",-1)),Q("div",bs,[ke(Q("input",{type:"color","onUpdate:modelValue":q[3]||(q[3]=z=>F.value.color=z),class:"w-10 h-10 p-1 bg-white dark:bg-gray-800 border dark:border-gray-600 rounded cursor-pointer"},null,512),[[Ee,F.value.color]]),Q("div",Ss,[(lt(),ft(Te,null,De(D,z=>Q("button",{key:z,onClick:J=>F.value.color=z,class:"w-6 h-6 rounded-full border-2",style:Fe({backgroundColor:z,borderColor:F.value.color.toLowerCase()===z.toLowerCase()?"blue":"transparent"})},null,12,Cs)),64))])])])])):Rt("",!0),["select","pan","zoom"].includes(k.value)?(lt(),ft("div",ws,[k.value==="select"?(lt(),ft("p",xs,"Click on an object to select, resize, and rotate it.")):Rt("",!0),k.value==="pan"?(lt(),ft("p",Ps,"Click and drag the canvas to move your view.")):Rt("",!0),k.value==="zoom"?(lt(),ft("p",ks,"Use your mouse wheel to zoom in and out.")):Rt("",!0)])):Rt("",!0)])]),Q("div",Rs,[Q("div",Ts,[q[11]||(q[11]=Q("h3",{class:"font-semibold text-lg"},"Layers",-1)),Q("button",{onClick:X,class:"btn-icon p-1.5",title:"Delete Selected Layer",disabled:!S.value},[Et(In,{class:"w-5 h-5"})],8,As)]),Q("div",Es,[(lt(!0),ft(Te,null,De(v.value,z=>(lt(),ft("div",{key:z.id,onClick:J=>U(z.konvaNode),class:ni(["p-2 rounded-md cursor-pointer flex items-center gap-2 text-sm",{"bg-blue-100 dark:bg-blue-900/50":S.value===z.id}])},[z.visible?(lt(),Nt(zn,{key:0,onClick:ri(J=>Y(z.id),["stop"]),class:"w-4 h-4 text-gray-600 dark:text-gray-300 hover:text-black dark:hover:text-white"},null,8,["onClick"])):(lt(),Nt(qn,{key:1,onClick:ri(J=>Y(z.id),["stop"]),class:"w-4 h-4 text-gray-400 dark:text-gray-500 hover:text-black dark:hover:text-white"},null,8,["onClick"])),Q("span",Ms,Ae(z.name),1)],10,Fs))),128))])]),Q("div",Gs,[Et(Z,{to:"/image-studio",class:"w-full flex items-center gap-3 px-3 py-2.5 text-sm font-medium text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors"},{default:Un(()=>[Et(Wn,{class:"w-5 h-5"}),q[12]||(q[12]=Q("span",null,"Back to Studio",-1))]),_:1})])]),Q("div",{class:"flex-grow min-h-0 flex items-center justify-center p-4 relative",ref_key:"stageContainerRef",ref:e,style:Fe(E.value)},[q[14]||(q[14]=Q("div",{id:"image-editor-stage",class:"absolute shadow-lg"},null,-1)),Et(Ir,{prompt:g.value,"onUpdate:prompt":q[4]||(q[4]=z=>g.value=z),negativePrompt:c.value,"onUpdate:negativePrompt":q[5]||(q[5]=z=>c.value=z),onEnhance:ot},null,8,["prompt","negativePrompt"]),i.value?(lt(),ft("div",Ns,[Et(ii,{class:"w-12 h-12 animate-spin mb-4"}),q[13]||(q[13]=Q("p",{class:"text-lg font-semibold"},"Applying prompt...",-1))])):Rt("",!0),["brush","eraser"].includes(k.value)?(lt(),ft("div",{key:1,ref_key:"customCursorRef",ref:t,class:"custom-cursor",style:Fe(T.value)},null,4)):Rt("",!0)],4)])],32)],64)}}},ra=Dt(Ls,[["__scopeId","data-v-0cb44a12"]]);export{ra as default};
