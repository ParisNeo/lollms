import{a2 as xe,a5 as we,aj as Pe,m as Se,aw as Ce,a6 as j,f as n,c as _,ae as T,a7 as Ae,ax as $e,ay as Ie,a as o,o as l,e as s,j as p,h as y,a4 as C,q as K,az as Re,a8 as b,F as h,i as A,t as g,al as Me,s as Q,g as k,v as $,af as Te,b as Ne,ak as X,w as E,ad as Y,ai as Ze,aA as Ve}from"./index-VJ8TL8ZV.js";import{A as De,a as Le}from"./AppCardSkeleton-DXcDsO_Y.js";import"./IconArrowUpCircle-B6Pyjus8.js";const Ue={class:"space-y-6"},je={class:"border-b border-gray-200 dark:border-gray-700"},Ee={class:"-mb-px flex space-x-6","aria-label":"Sub Tabs"},Be={key:0},Fe={class:"flex justify-between items-center mb-4"},qe={class:"flex items-center gap-2"},ze={key:0,class:"text-center p-4"},Oe={key:1,class:"empty-state-card"},Ge={key:2,class:"space-y-3"},He={class:"flex items-center gap-3 flex-grow truncate"},Je=["src"],We={class:"font-medium truncate"},Ke={class:"flex items-center gap-x-2 flex-shrink-0"},Qe=["onClick"],Xe=["onClick"],Ye={key:1},et={class:"space-y-4"},tt={class:"grid grid-cols-1 lg:grid-cols-2 gap-4"},st=["value"],at={key:0,class:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6"},lt={key:1,class:"empty-state-card"},ot={key:2},nt={class:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6"},it={class:"mt-6 flex justify-between items-center"},rt={class:"text-sm text-gray-500"},dt={class:"flex gap-2"},ut=["disabled"],ct=["disabled"],mt={key:2},pt={class:"flex justify-between items-center mb-4"},vt={class:"flex items-center gap-2"},ft=["disabled"],yt={key:0,class:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm mb-6"},bt=["disabled"],gt={key:0,class:"text-center p-4"},_t={key:1,class:"empty-state-card"},ht={key:2,class:"space-y-4"},kt={class:"flex-grow truncate"},xt={class:"font-semibold"},wt={class:"text-sm text-gray-500 font-mono truncate"},Pt={class:"text-xs text-gray-400 mt-1"},St={class:"flex items-center gap-x-2"},Ct=["onClick","disabled"],At=["onClick","disabled"],$t={__name:"PromptsManagement",setup(It){const i=we(),ee=Pe(),r=Se(),B=Ce(),{on:te,off:se}=$e(),{promptZooRepositories:F,isLoadingPromptZooRepositories:ae,zooPrompts:x,isLoadingZooPrompts:le}=j(i),{systemPrompts:N,isLoading:oe}=j(B),{tasks:ne}=j(ee),d=n("installed"),v=n({name:"",url:""}),w=n(!1),c=n(null),I=n(!1),R=n(""),P=n("All"),Z=n("All"),q=n("last_update_date"),z=n("desc"),S=n(JSON.parse(localStorage.getItem("starredPrompts")||"[]")),m=n(1),V=n(24);let O=null;const D=n(null),G=_(()=>x.value.total||0),ie=_(()=>x.value.pages||1),re=_(()=>{const a=(m.value-1)*V.value+1,e=Math.min(m.value*V.value,G.value);return`Showing ${a}-${e} of ${G.value}`});async function M(){const a={page:m.value,page_size:V.value,sort_by:q.value,sort_order:z.value,category:P.value!=="All"?P.value:void 0,search_query:R.value||void 0,installation_status:Z.value!=="All"?Z.value:void 0};await i.fetchZooPrompts(a)}function de(){clearTimeout(O),O=setTimeout(()=>{m.value=1,M()},300)}T([q,z,P,Z,d],()=>{d.value==="available"&&(m.value=1,M())}),T(R,de),T(m,M),T(S,a=>{localStorage.setItem("starredPrompts",JSON.stringify(a))},{deep:!0}),Ae(()=>{B.fetchPrompts(),i.fetchPromptZooRepositories(),M(),te("task:completed",H)}),Ie(()=>{se("task:completed",H)});const L=_(()=>{if(!Array.isArray(x.value.items))return[];const a=new Map;return ne.value.forEach(e=>{var t;if((t=e==null?void 0:e.name)!=null&&t.startsWith("Installing prompt: ")){const f=e.name.replace("Installing prompt: ","");a.set(f,e)}}),x.value.items.map(e=>({...e,task:a.get(e.folder_name)||null}))}),U=_(()=>Array.isArray(F.value)?[...F.value].sort((a,e)=>(a.name||"").localeCompare(e.name||"")):[]),ue=_(()=>{const a=new Set(x.value.items.map(e=>e.category).filter(Boolean));return["All",...Array.from(a).sort()]});function ce(a){return a?new Date(a).toLocaleString():"Never"}async function me(){if(!(!v.value.name||!v.value.url)){c.value="add";try{await i.addPromptZooRepository(v.value),v.value={name:"",url:""},w.value=!1}finally{c.value=null}}}async function pe(a){c.value=a.id;try{await i.pullPromptZooRepository(a.id)}finally{c.value=null}}async function ve(){I.value=!0;try{await i.pullAllPromptZooRepositories()}finally{I.value=!1}}async function fe(a){if(await r.showConfirmation({title:`Delete Repository '${a.name}'?`})){c.value=a.id;try{await i.deletePromptZooRepository(a.id)}finally{c.value=null}}}async function ye(a){await i.installZooPrompt({repository:a.repository,folder_name:a.folder_name})}async function be(a){const e=await i.fetchPromptReadme(a.repository,a.folder_name);r.openModal("sourceViewer",{title:`README: ${a.name}`,content:e,language:"markdown"})}function ge(a){const e=S.value.indexOf(a);e>-1?S.value.splice(e,1):S.value.push(a)}const u=n(null);function _e(){u.value={name:"",content:"",category:"",author:"",description:"",icon:null},r.openModal("editSystemPrompt")}function he(){r.openModal("generatePrompt",{isSystemPrompt:!0,onTaskSubmitted:a=>{D.value=a}})}function H(a){a&&a.id===D.value&&(D.value=null,r.isModalOpen("tasksManager")&&r.closeModal("tasksManager"),a.status==="completed"&&a.result?J(a.result):r.addNotification("System prompt generation did not complete successfully.","warning"))}function J(a){u.value={...a},r.openModal("editSystemPrompt")}async function W(){if(!u.value)return;const{id:a,...e}=u.value;try{a?await i.updateSystemPrompt(a,e):await i.createSystemPrompt(e),r.closeModal("editSystemPrompt")}catch{}}async function ke(a){await r.showConfirmation({title:`Delete '${a.name}'?`})&&await i.deleteSystemPrompt(a.id)}return(a,e)=>(l(),o(h,null,[s("div",Ue,[s("div",je,[s("nav",Ee,[s("button",{onClick:e[0]||(e[0]=t=>d.value="installed"),class:C(["tab-button",d.value==="installed"?"active":"inactive"])},"Installed",2),s("button",{onClick:e[1]||(e[1]=t=>d.value="available"),class:C(["tab-button",d.value==="available"?"active":"inactive"])},"Available from Zoo",2),s("button",{onClick:e[2]||(e[2]=t=>d.value="repositories"),class:C(["tab-button",d.value==="repositories"?"active":"inactive"])},"Repositories",2)])]),d.value==="installed"?(l(),o("section",Be,[s("div",Fe,[e[14]||(e[14]=s("h3",{class:"text-xl font-semibold"},"Installed System Prompts",-1)),s("div",qe,[s("button",{onClick:he,class:"btn btn-secondary"},[p(Re,{class:"w-4 h-4 mr-2"}),e[13]||(e[13]=K(" Generate with AI "))]),s("button",{onClick:_e,class:"btn btn-primary"},"Add Prompt")])]),b(oe)?(l(),o("div",ze,"Loading...")):!b(N)||b(N).length===0?(l(),o("div",Oe,e[15]||(e[15]=[s("p",null,"No system prompts installed.",-1)]))):(l(),o("div",Ge,[(l(!0),o(h,null,A(b(N),t=>(l(),o("div",{key:t.id,class:"bg-white dark:bg-gray-800 p-3 rounded-lg shadow-sm flex items-center justify-between gap-4"},[s("div",He,[t.icon?(l(),o("img",{key:0,src:t.icon,class:"h-8 w-8 rounded-md flex-shrink-0 object-cover",alt:"Icon"},null,8,Je)):y("",!0),s("p",We,g(t.name),1)]),s("div",Ke,[s("button",{onClick:f=>J(t),class:"btn btn-secondary btn-sm p-2",title:"Edit"},[p(Me,{class:"w-4 h-4"})],8,Qe),s("button",{onClick:f=>ke(t),class:"btn btn-danger btn-sm p-2",title:"Delete"},[p(Q,{class:"w-4 h-4"})],8,Xe)])]))),128))]))])):y("",!0),d.value==="available"?(l(),o("section",Ye,[s("div",et,[s("div",tt,[k(s("input",{type:"text","onUpdate:modelValue":e[3]||(e[3]=t=>R.value=t),placeholder:"Search Prompts...",class:"input-field"},null,512),[[$,R.value]]),k(s("select",{"onUpdate:modelValue":e[4]||(e[4]=t=>P.value=t),class:"input-field"},[e[16]||(e[16]=s("option",{value:"All"},"All Categories",-1)),(l(!0),o(h,null,A(ue.value,t=>(l(),o("option",{key:t,value:t},g(t),9,st))),128))],512),[[Te,P.value]])]),b(le)?(l(),o("div",at,[(l(),o(h,null,A(6,t=>p(De,{key:t})),64))])):!L.value||L.value.length===0?(l(),o("div",lt,e[17]||(e[17]=[s("h4",{class:"font-semibold"},"No Prompts Found",-1)]))):(l(),o("div",ot,[s("div",nt,[(l(!0),o(h,null,A(L.value,t=>(l(),Ne(Le,{key:`${t.repository}/${t.folder_name}`,app:t,task:t.task,"is-starred":S.value.includes(t.name),"item-type-name":"Prompt",onStar:f=>ge(t.name),onInstall:f=>ye(t),onHelp:f=>be(t)},null,8,["app","task","is-starred","onStar","onInstall","onHelp"]))),128))]),s("div",it,[s("p",rt,g(re.value),1),s("div",dt,[s("button",{onClick:e[5]||(e[5]=t=>m.value--),disabled:m.value<=1,class:"btn btn-secondary"},"Prev",8,ut),s("button",{onClick:e[6]||(e[6]=t=>m.value++),disabled:m.value>=ie.value,class:"btn btn-secondary"},"Next",8,ct)])])]))])])):y("",!0),d.value==="repositories"?(l(),o("section",mt,[s("div",pt,[e[19]||(e[19]=s("h3",{class:"text-xl font-semibold"},"Prompt Zoo Repositories",-1)),s("div",vt,[s("button",{onClick:ve,class:"btn btn-secondary",disabled:I.value},[p(X,{class:C(["w-4 h-4",{"animate-spin":I.value}])},null,8,["class"]),e[18]||(e[18]=s("span",{class:"ml-2"},"Pull All",-1))],8,ft),s("button",{onClick:e[7]||(e[7]=t=>w.value=!w.value),class:"btn btn-primary"},g(w.value?"Cancel":"Add"),1)])]),p(Ze,{name:"form-fade"},{default:E(()=>[w.value?(l(),o("div",yt,[s("form",{onSubmit:Y(me,["prevent"]),class:"flex gap-4"},[k(s("input",{"onUpdate:modelValue":e[8]||(e[8]=t=>v.value.name=t),type:"text",placeholder:"Name",class:"input-field flex-1",required:""},null,512),[[$,v.value.name]]),k(s("input",{"onUpdate:modelValue":e[9]||(e[9]=t=>v.value.url=t),type:"url",placeholder:"Git URL",class:"input-field flex-grow-[2]",required:""},null,512),[[$,v.value.url]]),s("button",{type:"submit",class:"btn btn-primary",disabled:c.value==="add"},"Add",8,bt)],32)])):y("",!0)]),_:1}),b(ae)?(l(),o("div",gt,"Loading...")):!U.value||U.value.length===0?(l(),o("div",_t,e[20]||(e[20]=[s("p",null,"No repositories added.",-1)]))):(l(),o("div",ht,[(l(!0),o(h,null,A(U.value,t=>(l(),o("div",{key:t.id,class:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm flex items-center justify-between gap-4"},[s("div",kt,[s("p",xt,g(t.name),1),s("p",wt,g(t.url),1),s("p",Pt,"Updated: "+g(ce(t.last_pulled_at)),1)]),s("div",St,[s("button",{onClick:f=>pe(t),class:"btn btn-secondary btn-sm",disabled:c.value===t.id},[p(X,{class:C(["w-4 h-4",{"animate-spin":c.value===t.id}])},null,8,["class"]),e[21]||(e[21]=K(" Pull"))],8,Ct),t.is_deletable?(l(),o("button",{key:0,onClick:f=>fe(t),class:"btn btn-danger btn-sm",disabled:c.value===t.id},[p(Q,{class:"w-4 h-4"})],8,At)):y("",!0)])]))),128))]))])):y("",!0)]),p(Ve,{modalName:"editSystemPrompt",title:u.value&&u.value.id?"Edit System Prompt":"Add System Prompt"},{body:E(()=>[u.value?(l(),o("form",{key:0,onSubmit:Y(W,["prevent"]),class:"space-y-4"},[s("div",null,[e[22]||(e[22]=s("label",{for:"prompt-name",class:"block text-sm font-medium"},"Name",-1)),k(s("input",{id:"prompt-name","onUpdate:modelValue":e[10]||(e[10]=t=>u.value.name=t),type:"text",class:"input-field mt-1",required:""},null,512),[[$,u.value.name]])]),s("div",null,[e[23]||(e[23]=s("label",{for:"prompt-content",class:"block text-sm font-medium"},"Content",-1)),k(s("textarea",{id:"prompt-content","onUpdate:modelValue":e[11]||(e[11]=t=>u.value.content=t),rows:"10",class:"input-field mt-1"},null,512),[[$,u.value.content]])])],32)):y("",!0)]),footer:E(()=>[s("button",{onClick:e[12]||(e[12]=t=>b(r).closeModal("editSystemPrompt")),class:"btn btn-secondary"},"Cancel"),s("button",{onClick:W,class:"btn btn-primary"},"Save")]),_:1},8,["title"])],64))}},Nt=xe($t,[["__scopeId","data-v-3819e7f1"]]);export{Nt as default};
