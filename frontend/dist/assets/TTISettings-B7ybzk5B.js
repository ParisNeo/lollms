import{S as Q,u as Y,a as H,q as W,s as z,r as f,bJ as X,bK as Z,bL as ee,bM as te,bN as se,w as M,bO as ae,z as m,o as le,c as n,b as o,g as l,d as _,B as I,k as O,bR as B,t as b,m as oe,h as E,N as ne,e as $,f as A,j as ie,F as L,i as N,n as j,bP as re,T as de,bQ as ue,A as ce,G as fe,bS as ve}from"./index-BzJSkIlv.js";const me={class:"space-y-8"},be={class:"space-y-6"},ge={class:"relative"},ye={class:"flex items-center space-x-3 truncate"},pe=["src"],_e={key:1,class:"w-8 h-8 flex-shrink-0 text-gray-500 dark:text-gray-400 flex items-center justify-center bg-gray-200 dark:bg-gray-700 rounded-md"},he={class:"min-w-0 text-left"},xe={class:"block font-semibold truncate"},ke={class:"p-2 sticky top-0 bg-white dark:bg-gray-800 z-10 border-b dark:border-gray-700"},we={class:"p-1 flex-grow overflow-y-auto"},Te={key:0,class:"text-center p-4 text-sm text-gray-500"},Se={key:1,class:"text-center p-4 text-sm text-gray-500"},Ce={class:"px-2 py-1.5 text-xs font-bold text-gray-600 dark:text-gray-300"},Me=["onClick"],Ie={class:"flex items-center space-x-3 truncate"},Oe=["src"],Ee={class:"truncate text-left"},Le={class:"font-medium truncate text-sm"},Ne={key:0,class:"p-4 border rounded-lg dark:border-gray-700 space-y-4"},je={class:"font-medium"},Fe={class:"font-mono text-blue-600 dark:text-blue-400"},De={key:0,class:"text-sm text-gray-500"},Re=["for"],Ue=["type","step","id","onUpdate:modelValue","placeholder"],ze={key:1,class:"mt-1"},Be=["onClick"],$e={class:"flex justify-end gap-3 pt-4 border-t dark:border-gray-600"},Ae=["disabled"],Pe=["disabled"],Ve={key:1,class:"p-4 border border-yellow-300 dark:border-yellow-700 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg text-sm text-yellow-800 dark:text-yellow-200 flex items-center gap-3"},Ge={__name:"TTISettings",setup(Je){const T=Y(),h=H();W();const{user:g}=z(T),{availableTtiModels:F,availableTtiModelsGrouped:D}=z(h),u=f({}),y=f(!1),p=f(!1);let x="{}";const v=f(!1),S=f(null),C=f(null),k=f(""),{floatingStyles:P}=X(S,C,{placement:"bottom-start",whileElementsMounted:Z,middleware:[ee(5),te(),se({padding:5})]}),V={mounted:(t,e)=>{t.clickOutsideEvent=s=>{const i=S.value;t===s.target||t.contains(s.target)||i!=null&&i.contains(s.target)||e.value()},document.addEventListener("mousedown",t.clickOutsideEvent)},unmounted:t=>{document.removeEventListener("mousedown",t.clickOutsideEvent)}};M(v,t=>{t&&ae(()=>{const e=C.value;if(e){const s=e.querySelector(".menu-item-button.selected");s&&s.scrollIntoView({block:"nearest"})}})});const d=m({get:()=>{var t;return(t=g.value)==null?void 0:t.tti_binding_model_name},set:t=>{T.updateUserPreferences({tti_binding_model_name:t})}}),r=m(()=>!d.value||F.value.length===0?null:F.value.find(t=>t.id===d.value)||null),w=m(()=>{var e;if(!((e=r.value)!=null&&e.alias))return[];const t=["icon","title","description","allow_parameters_override"];return Object.entries(r.value.alias).filter(([s])=>!t.includes(s)).map(([s,i])=>({name:s,type:typeof i=="boolean"?"bool":typeof i=="number"?"float":"str",default:i}))}),G=m(()=>!g.value||!d.value||!g.value.tti_models_config?{}:g.value.tti_models_config[d.value]||{}),R=m(()=>{var t;return(t=r.value)!=null&&t.alias?r.value.alias.allow_parameters_override!==!1:!0}),U=m(()=>{if(!k.value)return D.value;const t=k.value.toLowerCase(),e=[];for(const s of D.value)if(s.items){const i=s.items.filter(a=>a.name.toLowerCase().includes(t));i.length>0&&e.push({...s,items:i})}return e});function J(t){d.value=t,v.value=!1}M(r,t=>{if(t){const e={};w.value.forEach(s=>{e[s.name]=G.value[s.name]??t.alias[s.name]??s.default}),u.value=e,x=JSON.stringify(e),p.value=!1}else u.value={},x="{}",p.value=!1},{immediate:!0,deep:!0}),M(u,t=>{p.value=JSON.stringify(t)!==x},{deep:!0});async function q(){var t;if(d.value){y.value=!0;try{const e=g.value.tti_models_config||{},s={...e[d.value]||{},...u.value};(t=r.value)!=null&&t.alias&&Object.keys(s).forEach(a=>{(s[a]===r.value.alias[a]||s[a]===""||s[a]===null)&&delete s[a]});const i={...e,[d.value]:s};Object.keys(i[d.value]).length===0&&delete i[d.value],await T.updateUserPreferences({tti_models_config:i}),x=JSON.stringify(u.value),p.value=!1}finally{y.value=!1}}}function K(){var e;const t={};(e=r.value)!=null&&e.alias&&w.value.forEach(s=>{t[s.name]=r.value.alias[s.name]??s.default}),u.value=t}return le(()=>{h.availableTtiModels.length===0&&h.fetchAvailableTtiModels()}),(t,e)=>{var s,i;return o(),n("div",me,[e[7]||(e[7]=l("div",null,[l("h3",{class:"text-xl font-semibold leading-6 text-gray-900 dark:text-white"}," Image Generation (TTI) Parameters "),l("p",{class:"mt-1 text-sm text-gray-500 dark:text-gray-400"}," Configure default parameters for your selected Text-to-Image model. These settings can be overridden by model aliases set by an administrator if overrides are disabled. ")],-1)),l("div",be,[l("div",null,[e[4]||(e[4]=l("label",{class:"block text-base font-medium mb-2"},"Active Image Generation Model",-1)),l("div",ge,[l("button",{ref_key:"ttiTriggerRef",ref:S,onClick:e[0]||(e[0]=a=>v.value=!v.value),type:"button",class:"toolbox-select truncate w-full flex items-center justify-between"},[l("div",ye,[(s=r.value)!=null&&s.icon_base64?(o(),n("img",{key:0,src:r.value.icon_base64,class:"h-8 w-8 rounded-md object-cover"},null,8,pe)):(o(),n("span",_e,[O(B,{class:"w-5 h-5"})])),l("div",he,[l("span",xe,b(((i=r.value)==null?void 0:i.name)||"Select an Image Model"),1)])]),e[3]||(e[3]=l("svg",{class:"w-4 h-4 text-gray-400 flex-shrink-0",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor"},[l("path",{"fill-rule":"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z","clip-rule":"evenodd"})],-1))],512),(o(),I(ue,{to:"body"},[O(de,{"enter-active-class":"transition ease-out duration-100","enter-from-class":"transform opacity-0 scale-95","enter-to-class":"transform opacity-100 scale-100","leave-active-class":"transition ease-in duration-75","leave-from-class":"transform opacity-100 scale-100","leave-to-class":"transform opacity-0 scale-95"},{default:oe(()=>[v.value?E((o(),n("div",{key:0,ref_key:"ttiFloatingRef",ref:C,style:ne($(P)),class:"z-50 w-80 origin-top-left rounded-md bg-white dark:bg-gray-800 shadow-lg ring-1 ring-black ring-opacity-5 dark:ring-gray-700 focus:outline-none py-1 flex flex-col max-h-[50vh]"},[l("div",ke,[E(l("input",{type:"text","onUpdate:modelValue":e[1]||(e[1]=a=>k.value=a),onClick:e[2]||(e[2]=A(()=>{},["stop"])),placeholder:"Search TTI models...",class:"input-field-sm w-full"},null,512),[[ie,k.value]])]),l("div",we,[$(h).isLoadingTtiModels?(o(),n("div",Te,"Loading TTI models...")):U.value.length===0?(o(),n("div",Se,"No TTI models found.")):_("",!0),(o(!0),n(L,null,N(U.value,a=>(o(),n("div",{key:a.label},[l("h4",Ce,b(a.label),1),(o(!0),n(L,null,N(a.items,c=>(o(),n("button",{key:c.id,onClick:qe=>J(c.id),class:j(["menu-item-button",{selected:d.value===c.id}])},[l("div",Ie,[c.icon_base64?(o(),n("img",{key:0,src:c.icon_base64,class:"h-6 w-6 rounded-md object-cover flex-shrink-0"},null,8,Oe)):(o(),I(B,{key:1,class:"w-6 h-6 text-gray-500 dark:text-gray-400 flex-shrink-0"})),l("div",Ee,[l("p",Le,b(c.name),1)])]),d.value===c.id?(o(),I(re,{key:0,class:"w-5 h-5 text-blue-600 dark:text-blue-400 flex-shrink-0"})):_("",!0)],10,Me))),128))]))),128))])],4)),[[V,()=>v.value=!1]]):_("",!0)]),_:1})]))])]),d.value&&r.value&&R.value?(o(),n("div",Ne,[l("h4",je,[e[5]||(e[5]=ce("Configuration for: ")),l("span",Fe,b(r.value.name),1)]),w.value.length===0?(o(),n("div",De," This model has no parameters exposed for user configuration. ")):(o(),n("form",{key:1,onSubmit:A(q,["prevent"]),class:"space-y-4"},[(o(!0),n(L,null,N(w.value,a=>(o(),n("div",{key:a.name},[l("label",{for:`tti-param-${a.name}`,class:"block text-sm font-medium capitalize"},b(a.name.replace(/_/g," ")),9,Re),["str","int","float"].includes(a.type)?E((o(),n("input",{key:0,type:a.type==="str"?"text":"number",step:a.type==="float"?"0.01":"1",id:`tti-param-${a.name}`,"onUpdate:modelValue":c=>u.value[a.name]=c,class:"input-field mt-1",placeholder:`Default: ${r.value.alias[a.name]}`},null,8,Ue)),[[fe,u.value[a.name]]]):a.type==="bool"?(o(),n("div",ze,[l("button",{onClick:c=>u.value[a.name]=!u.value[a.name],type:"button",class:j([u.value[a.name]?"bg-blue-600":"bg-gray-200 dark:bg-gray-600","relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out"])},[l("span",{class:j([u.value[a.name]?"translate-x-5":"translate-x-0","pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition-colors duration-200 ease-in-out"])},null,2)],10,Be)])):_("",!0)]))),128)),l("div",$e,[l("button",{type:"button",onClick:K,class:"btn btn-secondary",disabled:y.value},"Reset to Defaults",8,Ae),l("button",{type:"submit",class:"btn btn-primary",disabled:y.value||!p.value},b(y.value?"Saving...":"Save Changes"),9,Pe)])],32))])):d.value&&r.value&&!R.value?(o(),n("div",Ve,[O(ve,{class:"w-5 h-5 flex-shrink-0"}),e[6]||(e[6]=l("span",null,"An administrator has locked the parameters for this model alias. Your personal settings will be ignored.",-1))])):_("",!0)])])}}},Qe=Q(Ge,[["__scopeId","data-v-82e79f02"]]);export{Qe as default};
