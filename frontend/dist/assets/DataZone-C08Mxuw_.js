import{$ as oe,cK as le,G as ge,r as b,k as d,c as a,b as o,g as e,n as j,z as u,cu as Ze,t as M,f as S,M as Ue,N as $e,h as O,v as Rt,F as W,i as B,J as z,a5 as jt,bR as Je,a4 as pe,cL as et,a2 as Gt,a8 as tt,s as K,d as D,K as st,A as ve,V as ot,e as Q,y as T,X as te,cM as Ft,cN as at,a as Wt,E as Bt,S as Nt,u as nt,R as Ot,w as De,o as lt,H as Ht,I as Xt,cO as qt,B as ee,cP as Kt,cQ as rt,bS as Qe,cR as it,Q as Qt,P as Yt,cS as Pe,j as se,_ as Ee,bQ as we,D as Ye,cT as Jt,cU as Ce,cV as es,cW as ts,cE as ss,cX as os}from"./index-BjsCXUh2.js";import{useMemoriesStore as as}from"./memories-CUTyloVi.js";const ns={class:"artefact-header"},ls={class:"artefact-info"},rs={class:"artefact-details"},is=["title"],cs={class:"artefact-actions"},ds={class:"artefact-body"},us={class:"w-full"},fs=["value"],ms={class:"grid grid-cols-2 gap-1 w-full mt-1.5"},vs={__name:"ArtefactCard",props:{artefactGroup:{type:Object,required:!0}},setup(P){var G;const n=P,f=le(),k=ge(),p=b(((G=n.artefactGroup.versions[0])==null?void 0:G.version)||1),x=d(()=>n.artefactGroup.isAnyVersionLoaded),_=d(()=>f.promptLoadedArtefacts.has(n.artefactGroup.title)),g=d(()=>x.value?n.artefactGroup.versions.find(Z=>Z.is_loaded):null),$=d(()=>({"loaded-data-zone":x.value,"loaded-prompt":_.value&&!x.value}));async function L(){await f.loadArtefactToContext({discussionId:f.currentDiscussionId,artefactTitle:n.artefactGroup.title,version:p.value})}function E(){f.loadArtefactToPrompt({discussionId:f.currentDiscussionId,artefactTitle:n.artefactGroup.title,version:p.value})}async function A(){g.value&&await f.unloadArtefactFromContext({discussionId:f.currentDiscussionId,artefactTitle:n.artefactGroup.title,version:g.value.version})}function V(){f.unloadArtefactFromPrompt(n.artefactGroup.title)}async function c(){const Z=await f.fetchArtefactContent({discussionId:f.currentDiscussionId,artefactTitle:n.artefactGroup.title,version:p.value});Z&&k.openModal("artefactEditor",{artefact:Z,discussionId:f.currentDiscussionId})}async function w(){await k.showConfirmation({title:`Delete Artefact '${n.artefactGroup.title}'?`,message:"This will permanently delete the artefact and all its versions.",confirmText:"Delete"})&&await f.deleteArtefact({discussionId:f.currentDiscussionId,artefactTitle:n.artefactGroup.title})}return(Z,I)=>(o(),a("div",{class:j(["artefact-card group",$.value])},[e("div",ns,[e("div",ls,[e("div",{class:j(["artefact-icon",{"loaded-data-zone":x.value,"loaded-prompt":_.value}])},[u(Ze,{class:"w-4 h-4"})],2),e("div",rs,[e("h5",{class:"artefact-title",title:P.artefactGroup.title},M(P.artefactGroup.title),9,is)])]),e("div",cs,[e("button",{onClick:S(c,["stop"]),class:"artefact-action-btn",title:"Edit Content"},[u(Ue,{class:"w-3 h-3"})]),e("button",{onClick:S(w,["stop"]),class:"artefact-action-btn artefact-action-btn-danger",title:"Delete Artefact"},[u($e,{class:"w-3 h-3"})])])]),e("div",ds,[e("div",us,[O(e("select",{"onUpdate:modelValue":I[0]||(I[0]=m=>p.value=m),onClick:I[1]||(I[1]=S(()=>{},["stop"])),class:"version-select"},[(o(!0),a(W,null,B(P.artefactGroup.versions,m=>(o(),a("option",{key:m.version,value:m.version}," Version "+M(m.version),9,fs))),128))],512),[[Rt,p.value]])]),e("div",ms,[x.value?(o(),a("button",{key:1,onClick:S(A,["stop"]),class:"load-btn loaded-data-zone-btn",title:"Unload from Data Zone"},[u(Je,{class:"w-3 h-3"}),I[3]||(I[3]=z(" Unload DZ "))])):(o(),a("button",{key:0,onClick:S(L,["stop"]),class:"load-btn",title:"Load to Data Zone"},[u(jt,{class:"w-3 h-3"}),I[2]||(I[2]=z(" Load DZ "))])),_.value?(o(),a("button",{key:3,onClick:S(V,["stop"]),class:"load-btn loaded-prompt-btn",title:"Unload from Prompt"},[u(et,{class:"w-3 h-3"}),I[5]||(I[5]=z(" Unload PMPT "))])):(o(),a("button",{key:2,onClick:S(E,["stop"]),class:"load-btn",title:"Load to Prompt"},[u(pe,{class:"w-3 h-3"}),I[4]||(I[4]=z(" Load PMPT "))]))])])],2))}},ps=oe(vs,[["__scopeId","data-v-be9a61b1"]]),gs={},ys={width:"800px",height:"800px",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function hs(P,n){return o(),a("svg",ys,n[0]||(n[0]=[e("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M9.83824 18.4467C10.0103 18.7692 10.1826 19.0598 10.3473 19.3173C8.59745 18.9238 7.07906 17.9187 6.02838 16.5383C6.72181 16.1478 7.60995 15.743 8.67766 15.4468C8.98112 16.637 9.40924 17.6423 9.83824 18.4467ZM11.1618 17.7408C10.7891 17.0421 10.4156 16.1695 10.1465 15.1356C10.7258 15.0496 11.3442 15 12.0001 15C12.6559 15 13.2743 15.0496 13.8535 15.1355C13.5844 16.1695 13.2109 17.0421 12.8382 17.7408C12.5394 18.3011 12.2417 18.7484 12 19.0757C11.7583 18.7484 11.4606 18.3011 11.1618 17.7408ZM9.75 12C9.75 12.5841 9.7893 13.1385 9.8586 13.6619C10.5269 13.5594 11.2414 13.5 12.0001 13.5C12.7587 13.5 13.4732 13.5593 14.1414 13.6619C14.2107 13.1384 14.25 12.5841 14.25 12C14.25 11.4159 14.2107 10.8616 14.1414 10.3381C13.4732 10.4406 12.7587 10.5 12.0001 10.5C11.2414 10.5 10.5269 10.4406 9.8586 10.3381C9.7893 10.8615 9.75 11.4159 9.75 12ZM8.38688 10.0288C8.29977 10.6478 8.25 11.3054 8.25 12C8.25 12.6946 8.29977 13.3522 8.38688 13.9712C7.11338 14.3131 6.05882 14.7952 5.24324 15.2591C4.76698 14.2736 4.5 13.168 4.5 12C4.5 10.832 4.76698 9.72644 5.24323 8.74088C6.05872 9.20472 7.1133 9.68686 8.38688 10.0288ZM10.1465 8.86445C10.7258 8.95042 11.3442 9 12.0001 9C12.6559 9 13.2743 8.95043 13.8535 8.86447C13.5844 7.83055 13.2109 6.95793 12.8382 6.2592C12.5394 5.69894 12.2417 5.25156 12 4.92432C11.7583 5.25156 11.4606 5.69894 11.1618 6.25918C10.7891 6.95791 10.4156 7.83053 10.1465 8.86445ZM15.6131 10.0289C15.7002 10.6479 15.75 11.3055 15.75 12C15.75 12.6946 15.7002 13.3521 15.6131 13.9711C16.8866 14.3131 17.9412 14.7952 18.7568 15.2591C19.233 14.2735 19.5 13.1679 19.5 12C19.5 10.8321 19.233 9.72647 18.7568 8.74093C17.9413 9.20477 16.8867 9.6869 15.6131 10.0289ZM17.9716 7.46178C17.2781 7.85231 16.39 8.25705 15.3224 8.55328C15.0189 7.36304 14.5908 6.35769 14.1618 5.55332C13.9897 5.23077 13.8174 4.94025 13.6527 4.6827C15.4026 5.07623 16.921 6.08136 17.9716 7.46178ZM8.67765 8.55325C7.61001 8.25701 6.7219 7.85227 6.02839 7.46173C7.07906 6.08134 8.59745 5.07623 10.3472 4.6827C10.1826 4.94025 10.0103 5.23076 9.83823 5.5533C9.40924 6.35767 8.98112 7.36301 8.67765 8.55325ZM15.3224 15.4467C15.0189 16.637 14.5908 17.6423 14.1618 18.4467C13.9897 18.7692 13.8174 19.0598 13.6527 19.3173C15.4026 18.9238 16.921 17.9186 17.9717 16.5382C17.2782 16.1477 16.3901 15.743 15.3224 15.4467ZM12 21C16.9706 21 21 16.9706 21 12C21 7.02944 16.9706 3 12 3C7.02944 3 3 7.02944 3 12C3 16.9706 7.02944 21 12 21Z",fill:"currentColor"},null,-1)]))}const bs=oe(gs,[["render",hs]]),xs={},ks={width:"50px",height:"50px",stroke:"currentColor",viewBox:"0 0 64 64",version:"1.1","xml:space":"preserve",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"};function _s(P,n){return o(),a("svg",ks,n[0]||(n[0]=[Gt('<g id="Layer_1"></g><g id="Layer_2"><g><path d="M9.1,46.9c-3.3,0-6,2.7-6,6c0,3.3,2.7,6,6,6c3.3,0,6-2.7,6-6C15.1,49.6,12.4,46.9,9.1,46.9z M12,55.8    c-0.7,0.7-1.7,1.2-2.8,1.2c-1.1,0-2.1-0.4-2.8-1.2C5.6,55,5.1,54,5.1,52.9c0-1.1,0.4-2.1,1.2-2.8C7,49.4,8,48.9,9.1,48.9    c1.1,0,2.1,0.4,2.8,1.2c0.7,0.7,1.2,1.7,1.2,2.8C13.1,54,12.7,55,12,55.8z"></path><path d="M24.4,46.9c-3.3,0-6,2.7-6,6c0,3.3,2.7,6,6,6c3.3,0,6-2.7,6-6C30.4,49.6,27.7,46.9,24.4,46.9z M27.2,55.8    c-0.7,0.7-1.7,1.2-2.8,1.2c-1.1,0-2.1-0.4-2.8-1.2c-0.7-0.7-1.2-1.7-1.2-2.8c0-1.1,0.4-2.1,1.2-2.8c0.7-0.7,1.7-1.2,2.8-1.2    c1.1,0,2.1,0.4,2.8,1.2c0.7,0.7,1.2,1.7,1.2,2.8C28.4,54,27.9,55,27.2,55.8z"></path><path d="M39.6,46.9c-3.3,0-6,2.7-6,6c0,3.3,2.7,6,6,6c3.3,0,6-2.7,6-6C45.6,49.6,42.9,46.9,39.6,46.9z M42.5,55.8    c-0.7,0.7-1.7,1.2-2.8,1.2c-1.1,0-2.1-0.4-2.8-1.2c-0.7-0.7-1.2-1.7-1.2-2.8c0-1.1,0.4-2.1,1.2-2.8c0.7-0.7,1.7-1.2,2.8-1.2    c1.1,0,2.1,0.4,2.8,1.2c0.7,0.7,1.2,1.7,1.2,2.8C43.6,54,43.2,55,42.5,55.8z"></path><path d="M22.9,39c0-3.3-2.7-6-6-6c-3.3,0-6,2.7-6,6c0,3.3,2.7,6,6,6C20.2,45,22.9,42.3,22.9,39z M19.7,41.8C19,42.5,18,43,16.9,43    c-1.1,0-2.1-0.4-2.8-1.2c-0.7-0.7-1.2-1.7-1.2-2.8c0-1.1,0.4-2.1,1.2-2.8c0.7-0.7,1.7-1.2,2.8-1.2c1.1,0,2.1,0.4,2.8,1.2    c0.7,0.7,1.2,1.7,1.2,2.8C20.9,40.1,20.4,41.1,19.7,41.8z"></path><path d="M38.1,39c0-3.3-2.7-6-6-6c-3.3,0-6,2.7-6,6c0,3.3,2.7,6,6,6C35.4,45,38.1,42.3,38.1,39z M35,41.8    c-0.7,0.7-1.7,1.2-2.8,1.2c-1.1,0-2.1-0.4-2.8-1.2c-0.7-0.7-1.2-1.7-1.2-2.8c0-1.1,0.4-2.1,1.2-2.8C30,35.4,31,35,32.1,35    c1.1,0,2.1,0.4,2.8,1.2c0.7,0.7,1.2,1.7,1.2,2.8C36.1,40.1,35.7,41.1,35,41.8z"></path><path d="M53.4,39c0-3.3-2.7-6-6-6c-3.3,0-6,2.7-6,6c0,3.3,2.7,6,6,6C50.7,45,53.4,42.3,53.4,39z M50.2,41.8    c-0.7,0.7-1.7,1.2-2.8,1.2c-1.1,0-2.1-0.4-2.8-1.2c-0.7-0.7-1.2-1.7-1.2-2.8c0-1.1,0.4-2.1,1.2-2.8c0.7-0.7,1.7-1.2,2.8-1.2    c1.1,0,2.1,0.4,2.8,1.2c0.7,0.7,1.2,1.7,1.2,2.8C51.4,40.1,50.9,41.1,50.2,41.8z"></path><path d="M24.5,31c3.3,0,6-2.7,6-6c0-3.3-2.7-6-6-6c-3.3,0-6,2.7-6,6C18.5,28.3,21.2,31,24.5,31z M21.7,22.2    c0.7-0.7,1.7-1.2,2.8-1.2c1.1,0,2.1,0.4,2.8,1.2c0.7,0.7,1.2,1.7,1.2,2.8c0,1.1-0.4,2.1-1.2,2.8c-0.7,0.7-1.7,1.2-2.8,1.2    c-1.1,0-2.1-0.4-2.8-1.2c-0.7-0.7-1.2-1.7-1.2-2.8C20.5,23.9,20.9,22.9,21.7,22.2z"></path><path d="M33.8,25c0,3.3,2.7,6,6,6c3.3,0,6-2.7,6-6c0-3.3-2.7-6-6-6C36.4,19,33.8,21.7,33.8,25z M36.9,22.2    c0.7-0.7,1.7-1.2,2.8-1.2c1.1,0,2.1,0.4,2.8,1.2c0.7,0.7,1.2,1.7,1.2,2.8c0,1.1-0.4,2.1-1.2,2.8c-0.7,0.7-1.7,1.2-2.8,1.2    c-1.1,0-2.1-0.4-2.8-1.2c-0.7-0.7-1.2-1.7-1.2-2.8C35.8,23.9,36.2,22.9,36.9,22.2z"></path><path d="M32.1,17.1c3.3,0,6-2.7,6-6c0-3.3-2.7-6-6-6c-3.3,0-6,2.7-6,6C26.1,14.4,28.8,17.1,32.1,17.1z M29.3,8.2    C30,7.5,31,7.1,32.1,7.1c1.1,0,2.1,0.4,2.8,1.2c0.7,0.7,1.2,1.7,1.2,2.8c0,1.1-0.4,2.1-1.2,2.8c-0.7,0.7-1.7,1.2-2.8,1.2    c-1.1,0-2.1-0.4-2.8-1.2c-0.7-0.7-1.2-1.7-1.2-2.8C28.1,10,28.6,9,29.3,8.2z"></path><path d="M54.9,46.9c-3.3,0-6,2.7-6,6c0,3.3,2.7,6,6,6c3.3,0,6-2.7,6-6C60.9,49.6,58.2,46.9,54.9,46.9z M57.7,55.8    c-0.7,0.7-1.7,1.2-2.8,1.2c-1.1,0-2.1-0.4-2.8-1.2c-0.7-0.7-1.2-1.7-1.2-2.8c0-1.1,0.4-2.1,1.2-2.8c0.7-0.7,1.7-1.2,2.8-1.2    c1.1,0,2.1,0.4,2.8,1.2c0.7,0.7,1.2,1.7,1.2,2.8C58.9,54,58.4,55,57.7,55.8z"></path></g></g>',2)]))}const ws=oe(xs,[["render",_s]]),Cs={key:0,class:"absolute inset-0 bg-blue-500/20 border-2 border-dashed border-blue-500 rounded-lg z-10 flex items-center justify-center"},$s={class:"flex justify-between items-center mb-2 flex-shrink-0"},Ds=["disabled"],Is={key:1,class:"flex-grow flex flex-col min-h-0"},Ms={class:"flex-grow min-h-0 overflow-y-auto custom-scrollbar"},Ts={key:"artefacts-loading",class:"loading-state"},Ls={key:"artefacts-empty",class:"flex flex-col items-center justify-center h-full text-center p-4 bg-gray-50 dark:bg-gray-800/50 rounded"},As={key:"artefacts-list",class:"artefacts-list space-y-2"},Ss={__name:"ArtefactZone",setup(P){const n=le(),f=ge();tt();const{activeDiscussionArtefacts:k,isLoadingArtefacts:p}=K(n),x=b(!1),_=b(!1),g=b(null),$=b(!1),L=d(()=>n.activeDiscussion),E=d(()=>{if(!k.value||!Array.isArray(k.value))return[];const i=k.value.reduce((l,y)=>(y&&y.title&&(l[y.title]||(l[y.title]={title:y.title,versions:[]}),l[y.title].versions.push(y)),l),{});return Object.values(i).forEach(l=>{l.versions.sort((y,Y)=>Y.version-y.version),l.isAnyVersionLoaded=l.versions.some(y=>y.is_loaded)}),Object.values(i)});function A(){L.value&&n.fetchArtefacts(L.value.id)}async function V(){if(!L.value)return;(await f.showConfirmation({title:"Load All Artefacts?",message:`This will clear the current Discussion Data Zone and load all ${E.value.length} artefact(s).`,confirmText:"Load All"})).confirmed&&n.loadAllArtefactsToDataZone(L.value.id)}function c(){L.value&&f.openModal("artefactEditor",{discussionId:L.value.id})}function w(){var i;(i=g.value)==null||i.click()}function G(){const i=prompt("Please enter the URL to import:");i&&L.value&&n.importArtefactFromUrl(L.value.id,i)}async function Z(i){const l=Array.from(i.target.files||[]);if(!l.length||!L.value)return;const y=["application/pdf","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.openxmlformats-officedocument.presentationml.presentation"],Y=[".pdf",".docx",".pptx",".msg"],q=[];for(const F of l){let U=!0;const ye=`.${F.name.split(".").pop()}`.toLowerCase();(y.includes(F.type)||Y.includes(ye))&&(U=(await f.showConfirmation({title:`Extract Images from ${F.name}?`,message:'This file may contain images. Do you want to extract and add them to the discussion context? Choosing "Text Only" may be faster.',confirmText:"Yes, Extract Images",cancelText:"No, Text Only"})).confirmed),q.push({file:F,extractImages:U})}if(q.length!==0){x.value=!0;try{await Promise.all(q.map(({file:F,extractImages:U})=>n.addArtefact({discussionId:L.value.id,file:F,extractImages:U})))}finally{x.value=!1,g.value&&(g.value.value="")}}}function I(i){i.currentTarget.contains(i.relatedTarget)||($.value=!1)}async function m(i){$.value=!1;const l=Array.from(i.dataTransfer.files);l.length&&await Z({target:{files:l}})}return(i,l)=>(o(),a("div",{onDragover:l[2]||(l[2]=S(y=>$.value=!0,["prevent"])),onDragleave:S(I,["prevent"]),onDrop:S(m,["prevent"]),class:"p-2 flex flex-col min-h-0 flex-grow relative"},[e("input",{type:"file",ref_key:"artefactFileInput",ref:g,onChange:Z,multiple:"",class:"hidden"},null,544),$.value?(o(),a("div",Cs,l[3]||(l[3]=[e("p",{class:"font-semibold text-blue-600"},"Drop files to upload",-1)]))):D("",!0),e("div",$s,[e("button",{onClick:l[0]||(l[0]=y=>_.value=!_.value),class:"flex items-center gap-2 text-sm font-semibold w-full text-left"},[u(Ze,{class:"w-4 h-4"}),l[4]||(l[4]=z()),l[5]||(l[5]=e("span",null,"Artefacts",-1)),u(st,{class:j(["w-4 h-4 ml-auto transition-transform",{"rotate-90":!_.value}])},null,8,["class"])]),e("div",{onClick:l[1]||(l[1]=S(()=>{},["stop"])),class:"flex items-center gap-1"},[u(at,{icon:"menu",buttonClass:"btn-icon-flat",title:"Artefact Actions"},{default:ve(()=>[e("button",{onClick:A,class:"menu-item"},[u(ot,{class:j(["w-4 h-4 mr-2",{"animate-spin":Q(p)}])},null,8,["class"]),l[6]||(l[6]=e("span",null,"Refresh Artefacts",-1))]),e("button",{onClick:V,class:"menu-item"},[u(ws,{class:"w-4 h-4 mr-2"}),l[7]||(l[7]=e("span",null,"Load All to Context",-1))]),l[11]||(l[11]=e("div",{class:"menu-divider"},null,-1)),e("button",{onClick:c,class:"menu-item"},[u(Ue,{class:"w-4 h-4 mr-2"}),l[8]||(l[8]=e("span",null,"Create Manual",-1))]),e("button",{onClick:G,class:"menu-item"},[u(bs,{class:"w-4 h-4 mr-2"}),l[9]||(l[9]=e("span",null,"Import from URL",-1))]),e("button",{onClick:w,class:"menu-item",disabled:x.value},[x.value?(o(),T(te,{key:0,class:"w-4 h-4 mr-2"})):(o(),T(Ft,{key:1,class:"w-4 h-4 mr-2"})),l[10]||(l[10]=e("span",null,"Upload File",-1))],8,Ds)]),_:1})])]),_.value?D("",!0):(o(),a("div",Is,[e("div",Ms,[Q(p)?(o(),a("div",Ts,[u(te,{class:"w-6 h-6 text-gray-400 animate-spin mx-auto mb-2"}),l[12]||(l[12]=e("p",{class:"text-xs text-gray-500"},"Loading...",-1))])):E.value.length===0?(o(),a("div",Ls,[u(Ze,{class:"w-10 h-10 text-gray-400 mb-2"}),l[14]||(l[14]=e("p",{class:"text-xs text-gray-500 mb-3"},"No artefacts yet",-1)),e("button",{onClick:w,class:"btn btn-secondary btn-sm"},[u(pe,{class:"w-3 h-3 mr-1"}),l[13]||(l[13]=z("Add Artefact"))])])):(o(),a("div",As,[(o(!0),a(W,null,B(E.value,y=>(o(),T(ps,{key:y.title,"artefact-group":y},null,8,["artefact-group"]))),128))]))])]))],32))}},zs={},Ps={width:"50px",height:"50px",viewBox:"0 0 32 32",version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink","xmlns:sketch":"http://www.bohemiancoding.com/sketch/ns"};function Zs(P,n){return o(),a("svg",Ps,n[0]||(n[0]=[e("g",{id:"Page-1",stroke:"none","stroke-width":"1",fill:"none","fill-rule":"evenodd","sketch:type":"MSPage"},[e("g",{id:"Icon-Set","sketch:type":"MSLayerGroup",transform:"translate(-152.000000, -515.000000)",fill:"currentColor"},[e("path",{d:"M171,525 C171.552,525 172,524.553 172,524 L172,520 C172,519.447 171.552,519 171,519 C170.448,519 170,519.447 170,520 L170,524 C170,524.553 170.448,525 171,525 L171,525 Z M182,543 C182,544.104 181.104,545 180,545 L156,545 C154.896,545 154,544.104 154,543 L154,519 C154,517.896 154.896,517 156,517 L158,517 L158,527 C158,528.104 158.896,529 160,529 L176,529 C177.104,529 178,528.104 178,527 L178,517 L180,517 C181.104,517 182,517.896 182,519 L182,543 L182,543 Z M160,517 L176,517 L176,526 C176,526.553 175.552,527 175,527 L161,527 C160.448,527 160,526.553 160,526 L160,517 L160,517 Z M180,515 L156,515 C153.791,515 152,516.791 152,519 L152,543 C152,545.209 153.791,547 156,547 L180,547 C182.209,547 184,545.209 184,543 L184,519 C184,516.791 182.209,515 180,515 L180,515 Z",id:"save-floppy","sketch:type":"MSShapeGroup"})])],-1)]))}const ct=oe(zs,[["render",Zs]]),Us={},Es={xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"};function Vs(P,n){return o(),a("svg",Es,n[0]||(n[0]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M3 10h10a8 8 0 018 8v2M3 10l4-4m-4 4l4 4"},null,-1)]))}const Rs=oe(Us,[["render",Vs]]),js={},Gs={xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"};function Fs(P,n){return o(),a("svg",Gs,n[0]||(n[0]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M21 10h-10a8 8 0 00-8 8v2m18-10l-4-4m4 4l-4 4"},null,-1)]))}const Ws=oe(js,[["render",Fs]]),Bs={key:0,class:"absolute inset-0 bg-blue-500/20 border-2 border-dashed border-blue-500 rounded-lg z-10 flex items-center justify-center pointer-events-none"},Ns={key:1,class:"px-3 pt-2 pb-1 border-b border-gray-200 dark:border-gray-700 relative group flex-shrink-0"},Os={class:"flex items-center gap-2 text-xs text-gray-600 dark:text-gray-400 font-mono"},Hs={class:"flex items-center gap-1.5 flex-shrink-0"},Xs=["title"],qs=["title"],Ks=["title"],Qs=["title"],Ys={class:"flex-shrink-0 pl-2"},Js={class:"absolute bottom-full left-0 mb-2 w-auto p-2 bg-white dark:bg-gray-900 border dark:border-gray-600 rounded-lg shadow-lg text-xs opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none z-10"},eo={class:"flex flex-wrap gap-1"},to=["title"],so={class:"flex-grow flex flex-col min-h-0"},oo={class:"flex-grow flex min-h-0"},ao={class:"flex-grow flex flex-col min-h-0 p-2"},no={class:"flex-shrink-0 px-1 pb-2 flex items-center justify-between gap-4"},lo={class:"flex items-center gap-1"},ro=["disabled"],io=["disabled"],co=["disabled"],uo=["disabled"],fo=["disabled"],mo=["disabled"],vo={class:"flex-grow min-h-0 border dark:border-gray-700 rounded-md overflow-hidden"},po={class:"p-2 border-b dark:border-gray-700 flex flex-col max-h-[50%] min-h-0"},go={class:"flex justify-between items-center mb-2 flex-shrink-0"},yo=["disabled"],ho=["disabled"],bo={key:0,class:"overflow-y-auto custom-scrollbar min-h-0"},xo={key:0,class:"text-center py-4 text-xs text-gray-500 bg-gray-50 dark:bg-gray-800/50 rounded"},ko={key:1,class:"image-grid"},_o=["src"],wo={class:"image-overlay"},Co=["onClick"],$o=["onClick","title"],Do=["onClick"],Io={class:"flex-shrink-0 p-2 border-t border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800/50"},Mo={key:0,class:"p-2 space-y-2"},To={key:0},Lo={class:"flex justify-between items-center text-xs font-semibold"},Ao={class:"text-gray-600 dark:text-gray-300"},So={class:"font-mono text-gray-500 dark:text-gray-400"},zo={class:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-1.5"},Po=["title"],Zo={key:1,class:"flex items-center space-x-3 h-[42px]"},Uo={key:1,class:"relative flex items-center"},Eo=["onClick"],Vo={class:"truncate"},Ro={class:"p-2 sticky top-0 bg-white dark:bg-gray-800 z-10"},jo={class:"max-h-60 overflow-y-auto"},Go={class:"category-header"},Fo=["onClick"],Wo=["src"],Bo={class:"truncate"},No={class:"p-2 sticky top-0 bg-white dark:bg-gray-800 z-10"},Oo={class:"max-h-60 overflow-y-auto"},Ho={class:"category-header"},Xo=["onClick"],qo=["src"],Ko={class:"truncate"},Qo={key:3,class:"my-1 border-t dark:border-gray-600"},Yo={class:"absolute right-1.5 top-1/2 -translate-y-1/2 flex items-center gap-2"},Jo=["disabled","title"],ea={key:2,class:"ml-2 text-sm"},ta=["disabled","title"],sa={key:2,class:"ml-2 text-sm"},oa={__name:"DiscussionZone",setup(P){const n=le(),f=ge(),k=Wt(),p=Bt(),x=Nt(),_=tt(),{on:g,off:$}=Ht(),L=nt(),{promptLoadedArtefacts:E,activeDiscussionContextStatus:A,dataZonesTokensFromContext:V}=K(n),{lollmsPrompts:c,systemPromptsByZooCategory:w,userPromptsByCategory:G}=K(p),{availableTtiModels:Z}=K(k),{tasks:I}=K(x),m=b(null),i=b(!1),l=b(!1),y=b(384),Y=b(!1),q=b(null),F=b(!1),U=b(""),ye=b(null),H=b([]),N=b(-1);let Ve=null,Re=null;const he=b(""),Ie=b(""),be=b(!1),h=d(()=>n.activeDiscussion),X=d({get:()=>{var t;return((t=h.value)==null?void 0:t.discussion_data_zone)||""},set:t=>{h.value&&(n.setDiscussionDataZoneContent(h.value.id,t),clearTimeout(Re),Re=setTimeout(()=>{h.value&&Ot.put(`/api/discussions/${h.value.id}/data_zone`,{content:t}).then(()=>{n.fetchContextStatus(h.value.id)}).catch(s=>{console.error("Failed to save data zone content:",s),f.addNotification("Failed to auto-save data zone.","error")})},1500))}}),ae=d(()=>{var t;return((t=h.value)==null?void 0:t.discussion_images)||[]}),Me=d(()=>{var t;return((t=h.value)==null?void 0:t.active_discussion_images)||[]}),xe=d(()=>{var t;return h.value&&((t=n.activeAiTasks[h.value.id])==null?void 0:t.type)==="summarize"}),ke=d(()=>{var t;return h.value&&((t=n.activeAiTasks[h.value.id])==null?void 0:t.type)==="generate_image"}),R=d(()=>{if(!h.value)return!1;const t=n.activeAiTasks[h.value.id];if(!t||!t.taskId)return!1;const s=I.value.find(r=>r.id===t.taskId);return s?s.status==="running"||s.status==="pending":!1}),ne=d(()=>{if(!h.value)return null;const t=n.activeAiTasks[h.value.id];return!t||!t.taskId?null:I.value.find(s=>s.id===t.taskId)}),dt=d(()=>Z.value.length>0),je=d(()=>N.value>0),Ge=d(()=>N.value<H.value.length-1),Fe=d(()=>L.user),re=d(()=>n.activeDiscussionContextStatus),ut=d(()=>{var t,s;return((t=Fe.value)==null?void 0:t.show_token_counter)&&((s=Fe.value)==null?void 0:s.user_ui_level)>=2&&re.value}),Te=d(()=>{var t;return((t=re.value)==null?void 0:t.max_tokens)||1}),ie=d(()=>{var t,s,r,v,C;return((C=(v=(r=(s=(t=re.value)==null?void 0:t.zones)==null?void 0:s.system_context)==null?void 0:r.breakdown)==null?void 0:v.system_prompt)==null?void 0:C.tokens)||0}),ce=d(()=>V.value),de=d(()=>{var t,s,r,v;return((v=(r=(s=(t=re.value)==null?void 0:t.zones)==null?void 0:s.message_history)==null?void 0:r.breakdown)==null?void 0:v.text_tokens)||0}),ue=d(()=>{var t,s,r,v;return((v=(r=(s=(t=re.value)==null?void 0:t.zones)==null?void 0:s.message_history)==null?void 0:r.breakdown)==null?void 0:v.image_tokens)||0}),We=d(()=>ie.value+ce.value+de.value+ue.value),fe=t=>Te.value>0?t/Te.value*100:0,ft=d(()=>{const t=[];return ie.value>0&&t.push({label:"S",value:ie.value,title:"System Prompt",colorClass:"bg-blue-100 dark:bg-blue-900/50"}),ce.value>0&&t.push({label:"D",value:ce.value,title:"Data Zones",colorClass:"bg-yellow-100 dark:bg-yellow-900/50"}),de.value>0&&t.push({label:"H",value:de.value,title:"History (Text)",colorClass:"bg-green-100 dark:bg-green-900/50"}),ue.value>0&&t.push({label:"I",value:ue.value,title:"History (Images)",colorClass:"bg-teal-100 dark:bg-teal-900/50"}),t.length===0&&t.push({label:"Empty",value:0,title:"Empty context",colorClass:"bg-gray-100 dark:bg-gray-900/50"}),t}),_e=d(()=>fe(ie.value)),Le=d(()=>fe(ce.value)),Be=d(()=>fe(de.value)),mt=d(()=>fe(ue.value)),me=d(()=>fe(We.value)),vt=d(()=>{const t=me.value;return t>=90?"border-red-500 dark:border-red-400":t>=75?"border-yellow-500 dark:border-yellow-400":"border-gray-300 dark:border-gray-600"}),pt=d(()=>me.value>90),gt=d(()=>me.value>100?"Context limit exceeded! The model may not see all of your message.":me.value>90?"You are approaching the context limit. Consider shortening your message or data zones.":"");function yt(){h.value&&f.openModal("contextViewer")}const Ae=d(()=>{if(!Array.isArray(c.value))return[];const t=he.value.toLowerCase();return t?c.value.filter(s=>s.name.toLowerCase().includes(t)):c.value}),Ne=d(()=>{const t=he.value.toLowerCase(),s=G.value;if(!s||typeof s!="object")return{};if(!t)return s;const r={};for(const v in s){const C=s[v].filter(J=>J.name.toLowerCase().includes(t));C.length>0&&(r[v]=C)}return r}),Oe=d(()=>{const t=Ie.value.toLowerCase(),s=w.value;if(!s||typeof s!="object")return{};if(!t)return s;const r={};for(const v in s){const C=s[v].filter(J=>J.name.toLowerCase().includes(t));C.length>0&&(r[v]=C)}return r});function ht(t){m.value=t.view}function Se(t){const s=r=>{U.value=r,we(()=>{var v;return(v=ye.value)==null?void 0:v.focus()})};/@<.*?>@/g.test(t)?f.openModal("fillPlaceholders",{promptTemplate:t,onConfirm:r=>s(r)}):s(t)}function bt(t){H.value=[t],N.value=0}function xt(t){clearTimeout(Ve),Ve=setTimeout(()=>{H.value[N.value]!==t&&(N.value<H.value.length-1&&H.value.splice(N.value+1),H.value.push(t),N.value++)},750)}async function kt(){je.value&&(i.value=!0,N.value--,X.value=H.value[N.value],await we(),i.value=!1)}async function _t(){Ge.value&&(i.value=!0,N.value++,X.value=H.value[N.value],await we(),i.value=!1)}De(X,(t,s)=>{!i.value&&t!==s&&xt(t)},{flush:"post"}),De(h,(t,s)=>{t&&(!s||t.id!==s.id)&&(t.discussion_data_zone===void 0&&n.refreshDataZones(t.id),bt(t.discussion_data_zone||""))},{immediate:!0,deep:!0});function wt(t){Y.value=!0;const s=t.clientX,r=y.value;document.body.style.cursor="col-resize",document.body.style.userSelect="none";function v(J){var Ke;if(!Y.value)return;const Ut=J.clientX-s,Et=r-Ut,Vt=(((Ke=document.querySelector(".flex-grow.flex.min-h-0"))==null?void 0:Ke.clientWidth)||window.innerWidth)*.75;y.value=Math.min(Et,Vt)}function C(){Y.value=!1,document.body.style.cursor="",document.body.style.userSelect="",window.removeEventListener("mousemove",v),window.removeEventListener("mouseup",C),localStorage.setItem("lollms_artefactListWidth",y.value)}window.addEventListener("mousemove",v),window.addEventListener("mouseup",C)}function Ct(){h.value&&n.cloneDiscussion(h.value.id)}function $t(){h.value&&f.openModal("contextToArtefact")}function Dt(){h.value&&n.refreshDataZones(h.value.id)}async function It(){(await f.showConfirmation({title:`Delete All ${ae.value.length} Images?`,message:"This will remove all images from this discussion's context. This action cannot be undone.",confirmText:"Delete All"})).confirmed&&n.deleteAllDiscussionImages()}function Mt(){var t;(t=q.value)==null||t.click()}async function Tt(t){const s=Array.from(t.target.files);if(!(!s.length||!h.value)){F.value=!0;try{await Promise.all(s.map(r=>n.uploadDiscussionImage(r)))}finally{F.value=!1,q.value&&(q.value.value="")}}}function Lt(){h.value&&n.summarizeDiscussionDataZone(h.value.id,U.value)}function At(){if(!h.value)return;let t=U.value.trim()||X.value.trim();if(!t){f.addNotification("Please provide a prompt to generate an image.","warning");return}n.generateImageFromDataZone(h.value.id,t)}function St(){_.push({path:"/settings",query:{tab:"prompts"}})}function ze(t){return!Me.value||Me.value.length<=t||Me.value[t]}function He(t){U.value=t}function Xe(){E.value.size===0&&(U.value="")}function qe(t){U.value=""}function zt(t){f.openImageViewer({imageList:ae.value.map(s=>({src:`data:image/png;base64,${s}`,prompt:"Image from Data Zone"})),startIndex:t})}function Pt(t){t.currentTarget.contains(t.relatedTarget)||(be.value=!1)}async function Zt(t){be.value=!1;const s=Array.from(t.dataTransfer.files);s.length>0&&h.value&&(f.addNotification(`Processing ${s.length} file(s)...`,"info"),await n.uploadAndEmbedFilesToDataZone(h.value.id,s))}return lt(()=>{const t=localStorage.getItem("lollms_artefactListWidth");t&&(y.value=parseInt(t,10)),g("artefact:load-to-prompt",He),g("artefact:unload-from-prompt",Xe),g("discussion_zone:processed",qe)}),Xt(()=>{$("artefact:load-to-prompt",He),$("artefact:unload-from-prompt",Xe),$("discussion_zone:processed",qe)}),(t,s)=>(o(),a("div",{onDragover:s[9]||(s[9]=S(r=>be.value=!0,["prevent"])),onDragleave:S(Pt,["prevent"]),onDrop:S(Zt,["prevent"]),class:"flex-1 flex flex-col min-h-0 relative"},[be.value?(o(),a("div",Bs,s[10]||(s[10]=[e("p",{class:"font-semibold text-blue-600"},"Drop files to add to Data Zone",-1)]))):D("",!0),ut.value?(o(),a("div",Ns,[e("div",Os,[e("div",Hs,[u(qt,{class:"w-4 h-4 flex-shrink-0"}),e("button",{onClick:yt,class:"cursor-pointer hover:underline flex-shrink-0",title:"View full context breakdown"},"Context:")]),e("div",{class:j(["flex-grow w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2 relative overflow-hidden border transition-colors duration-300",vt.value])},[e("div",{class:"progress-segment bg-blue-500",style:ee({width:`${_e.value}%`}),title:`System Prompt: ${ie.value.toLocaleString()} tokens`},null,12,Xs),e("div",{class:"progress-segment bg-yellow-500",style:ee({left:`${_e.value}%`,width:`${Le.value}%`}),title:`Data Zones: ${ce.value.toLocaleString()} tokens`},null,12,qs),e("div",{class:"progress-segment bg-green-500",style:ee({left:`${_e.value+Le.value}%`,width:`${Be.value}%`}),title:`History (Text): ${de.value.toLocaleString()} tokens`},null,12,Ks),e("div",{class:"progress-segment bg-teal-500",style:ee({left:`${_e.value+Le.value+Be.value}%`,width:`${mt.value}%`}),title:`History (Images): ${ue.value.toLocaleString()} tokens`},null,12,Qs)],2),e("span",Ys,M(We.value.toLocaleString())+" / "+M(Te.value.toLocaleString()),1)]),pt.value?(o(),a("p",{key:0,class:j(["mt-1.5 text-xs text-center",me.value>100?"text-red-600 dark:text-red-400":"text-yellow-600 dark:text-yellow-400"])},M(gt.value),3)):D("",!0),e("div",Js,[s[11]||(s[11]=e("h4",{class:"font-bold mb-1 whitespace-nowrap"},"Context Breakdown",-1)),e("div",eo,[(o(!0),a(W,null,B(ft.value,r=>(o(),a("span",{title:`${r.title}: ${r.value.toLocaleString()} tokens`,class:j(["px-1.5 py-0.5 rounded",r.colorClass])},M(r.label)+": "+M(r.value.toLocaleString()),11,to))),256))])])])):D("",!0),e("div",so,[e("input",{type:"file",ref_key:"discussionImageInput",ref:q,onChange:Tt,class:"hidden",accept:"image/*,application/pdf",multiple:""},null,544),e("div",oo,[e("div",ao,[e("div",no,[e("div",lo,[e("button",{onClick:kt,class:"action-btn-sm",title:"Undo",disabled:!je.value||R.value},[u(Rs,{class:"w-4 h-4"})],8,ro),e("button",{onClick:_t,class:"action-btn-sm",title:"Redo",disabled:!Ge.value||R.value},[u(Ws,{class:"w-4 h-4"})],8,io),s[12]||(s[12]=e("div",{class:"w-px h-5 bg-gray-200 dark:bg-gray-600 mx-1"},null,-1)),e("button",{onClick:Ct,class:"action-btn-sm",title:"Clone Discussion & Artefacts",disabled:R.value},[u(Kt,{class:"w-4 h-4"})],8,co),e("button",{onClick:$t,class:"action-btn-sm",title:"Save as Artefact",disabled:R.value},[u(ct,{class:"w-4 h-4"})],8,uo),e("button",{onClick:Dt,class:"action-btn-sm",title:"Refresh Data",disabled:R.value},[u(ot,{class:"w-4 h-4"})],8,fo),e("button",{onClick:s[0]||(s[0]=r=>X.value=""),class:"action-btn-sm-danger",title:"Clear All Text",disabled:R.value},[u($e,{class:"w-4 h-4"})],8,mo)])]),e("div",vo,[u(rt,{ref:"discussionCodeMirrorEditor",modelValue:X.value,"onUpdate:modelValue":s[1]||(s[1]=r=>X.value=r),class:"h-full","read-only":R.value,renderable:!0,onReady:ht},null,8,["modelValue","read-only"])])]),e("div",{onMousedown:S(wt,["prevent"]),class:"resizer"},null,32),e("div",{style:ee({width:`${y.value}px`}),class:"flex-shrink-0 border-l border-gray-200 dark:border-gray-700 flex flex-col h-full min-w-[256px]"},[e("div",po,[e("div",go,[e("button",{onClick:s[2]||(s[2]=r=>l.value=!l.value),class:"flex items-center gap-2 text-sm font-semibold w-full text-left"},[u(Qe,{class:"w-4 h-4"}),s[13]||(s[13]=z()),s[14]||(s[14]=e("span",null,"Images",-1)),u(st,{class:j(["w-4 h-4 ml-auto transition-transform",{"rotate-90":!l.value}])},null,8,["class"])]),e("div",{onClick:s[3]||(s[3]=S(()=>{},["stop"])),class:"flex items-center gap-1"},[e("button",{onClick:It,class:"action-btn-sm-danger",title:"Delete All Images",disabled:ae.value.length===0||R.value},[u($e,{class:"w-4 h-4"})],8,yo),e("button",{onClick:Mt,class:"action-btn-sm",title:"Add Image(s)",disabled:F.value||R.value},[F.value?(o(),T(te,{key:0,class:"w-4 h-4 animate-spin"})):(o(),T(pe,{key:1,class:"w-4 h-4"}))],8,ho)])]),l.value?D("",!0):(o(),a("div",bo,[ae.value.length===0&&!F.value?(o(),a("div",xo,"No images yet")):(o(),a("div",ko,[(o(!0),a(W,null,B(ae.value,(r,v)=>(o(),a("div",{key:r.substring(0,20)+v,class:"image-card group"},[e("img",{src:"data:image/png;base64,"+r,class:j(["image-thumbnail",{"grayscale opacity-50":!ze(v)}])},null,10,_o),e("div",wo,[e("button",{onClick:C=>zt(v),class:"overlay-btn",title:"View"},[u(it,{class:"w-3 h-3"})],8,Co),e("button",{onClick:C=>Q(n).toggleDiscussionImage(v),class:"overlay-btn",title:ze(v)?"Deactivate":"Activate"},[ze(v)?(o(),T(Qt,{key:0,class:"w-3 h-3"})):(o(),T(Yt,{key:1,class:"w-3 h-3"}))],8,$o),e("button",{onClick:C=>Q(n).deleteDiscussionImage(v),class:"overlay-btn overlay-btn-danger",title:"Delete"},[u(et,{class:"w-3 h-3"})],8,Do)])]))),128))]))]))]),u(Ss,{"is-task-running":R.value},null,8,["is-task-running"])],4)])]),e("div",Io,[R.value?(o(),a("div",Mo,[ne.value?(o(),a("div",To,[e("div",Lo,[e("span",Ao,M(ne.value.name),1),e("span",So,M(ne.value.progress)+"%",1)]),e("div",zo,[e("div",{class:"bg-blue-600 h-1.5 rounded-full",style:ee({width:`${ne.value.progress}%`})},null,4)]),e("p",{class:"text-xs text-gray-500 dark:text-gray-400 truncate",title:ne.value.description},M(ne.value.description),9,Po)])):(o(),a("div",Zo,[u(te,{class:"h-6 w-6 text-blue-500 animate-spin"}),s[15]||(s[15]=e("p",{class:"text-sm font-semibold text-gray-600 dark:text-gray-300"},"Initializing task...",-1))]))])):(o(),a("div",Uo,[u(at,{title:"Prompts",icon:"ticket",collection:"ui","button-class":"btn-icon absolute left-1.5 top-1/2 -translate-y-1/2 z-10"},{default:ve(()=>[Ae.value.length>0?(o(),T(Pe,{key:0,title:"Default",icon:"lollms",collection:"ui"},{default:ve(()=>[(o(!0),a(W,null,B(Ae.value,r=>(o(),a("button",{key:r.id,onClick:v=>Se(r.content),class:"menu-item text-sm"},[e("span",Vo,M(r.name),1)],8,Eo))),128))]),_:1})):D("",!0),Object.keys(Q(G)).length>0?(o(),T(Pe,{key:1,title:"User",icon:"user",collection:"ui"},{default:ve(()=>[e("div",Ro,[O(e("input",{type:"text","onUpdate:modelValue":s[4]||(s[4]=r=>he.value=r),onClick:s[5]||(s[5]=S(()=>{},["stop"])),placeholder:"Search user prompts...",class:"input-field w-full text-sm"},null,512),[[se,he.value]])]),s[17]||(s[17]=z()),e("div",jo,[(o(!0),a(W,null,B(Ne.value,(r,v)=>(o(),a("div",{key:v},[e("h3",Go,M(v),1),s[16]||(s[16]=z()),(o(!0),a(W,null,B(r,C=>(o(),a("button",{key:C.id,onClick:J=>Se(C.content),class:"menu-item text-sm"},[C.icon?(o(),a("img",{key:0,src:C.icon,class:"h-5 w-5 rounded-md object-cover mr-2 flex-shrink-0",alt:"Icon"},null,8,Wo)):D("",!0),e("span",Bo,M(C.name),1)],8,Fo))),128))]))),128))])]),_:1})):D("",!0),Object.keys(Q(w)).length>0?(o(),T(Pe,{key:2,title:"Zoo",icon:"server",collection:"ui"},{default:ve(()=>[e("div",No,[O(e("input",{type:"text","onUpdate:modelValue":s[6]||(s[6]=r=>Ie.value=r),onClick:s[7]||(s[7]=S(()=>{},["stop"])),placeholder:"Search zoo...",class:"input-field w-full text-sm"},null,512),[[se,Ie.value]])]),s[19]||(s[19]=z()),e("div",Oo,[(o(!0),a(W,null,B(Oe.value,(r,v)=>(o(),a("div",{key:v},[e("h3",Ho,M(v),1),s[18]||(s[18]=z()),(o(!0),a(W,null,B(r,C=>(o(),a("button",{key:C.id,onClick:J=>Se(C.content),class:"menu-item text-sm"},[C.icon?(o(),a("img",{key:0,src:C.icon,class:"h-5 w-5 rounded-md object-cover mr-2 flex-shrink-0",alt:"Icon"},null,8,qo)):D("",!0),e("span",Ko,M(C.name),1)],8,Xo))),128))]))),128))])]),_:1})):D("",!0),Ae.value.length+Object.keys(Ne.value).length+Object.keys(Oe.value).length>0?(o(),a("div",Qo)):D("",!0),e("button",{onClick:St,class:"menu-item text-sm font-medium text-blue-600 dark:text-blue-400"},"Manage My Prompts...")]),_:1}),O(e("textarea",{ref_key:"dataZonePromptTextareaRef",ref:ye,"onUpdate:modelValue":s[8]||(s[8]=r=>U.value=r),placeholder:"Enter a prompt to process content...",class:"enhanced-textarea w-full !pl-10 !pr-24"},null,512),[[se,U.value]]),e("div",Yo,[dt.value&&!xe.value?(o(),a("button",{key:0,onClick:At,class:"btn btn-primary !py-2 !px-3 flex items-center",disabled:R.value||!X.value.trim()&&!U.value.trim(),title:ke.value?"Generating image...":"Generate an image using the prompt"},[ke.value?(o(),T(te,{key:0,class:"w-5 h-5 animate-spin"})):(o(),T(Qe,{key:1,class:"w-5 h-5"})),ke.value?(o(),a("span",ea,"Generating...")):D("",!0)],8,Jo)):D("",!0),ke.value?D("",!0):(o(),a("button",{key:1,onClick:Lt,class:"btn btn-secondary !py-2 !px-3 flex items-center",disabled:R.value||!X.value.trim()&&ae.value.length===0&&!U.value.trim(),title:xe.value?"Processing text...":"Process the text in the data zone using the prompt"},[xe.value?(o(),T(te,{key:0,class:"w-5 h-5 animate-spin"})):(o(),T(Ee,{key:1,class:"w-5 h-5"})),xe.value?(o(),a("span",sa,"Processing...")):D("",!0)],8,ta))])]))])],32))}},aa={class:"flex-1 flex flex-col min-h-0"},na={class:"flex-shrink-0 px-3 py-2 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between gap-4"},la=["disabled"],ra={class:"flex-grow min-h-0 p-3 overflow-y-auto custom-scrollbar space-y-6"},ia={class:"p-4 bg-gray-50 dark:bg-gray-800/50 border dark:border-gray-700 rounded-lg"},ca={class:"flex items-center justify-between mb-3"},da={class:"relative inline-flex items-center cursor-pointer"},ua={key:0,class:"text-xs text-gray-500 dark:text-gray-400 mb-3"},fa={key:1,class:"text-xs text-gray-500 dark:text-gray-400 mb-3"},ma={key:2,class:"grid grid-cols-1 sm:grid-cols-2 gap-x-4 gap-y-2 text-sm"},va={class:"text-gray-800 dark:text-gray-200"},pa={class:"px-2 py-0.5 bg-gray-200 dark:bg-gray-700 rounded text-xs"},ga={class:"p-3 bg-gray-50 dark:bg-gray-800/50 border dark:border-gray-700 rounded-lg flex items-center justify-between"},ya={class:"relative inline-flex items-center cursor-pointer"},ha={class:"space-y-4"},ba={__name:"UserZone",setup(P){const n=nt(),{user:f}=K(n),k=b(""),p=b(""),x=b(""),_=b(!1),g=b(!0),$=b(!1);function L(){f.value&&(k.value=f.value.data_zone||"",p.value=f.value.coding_style_constraints||"",x.value=f.value.programming_language_preferences||"",_.value=f.value.tell_llm_os||!1,g.value=f.value.share_dynamic_info_with_llm??!0,we(()=>{$.value=!1}))}De(f,L,{immediate:!0,deep:!0}),De([k,p,x,_,g],()=>{$.value=!0});const E=[{label:"Date",placeholder:"{{date}}"},{label:"Time",placeholder:"{{time}}"},{label:"Date & Time",placeholder:"{{datetime}}"},{label:"Username",placeholder:"{{user_name}}"}];async function A(){$.value&&(await n.updateUserPreferences({data_zone:k.value,coding_style_constraints:p.value,programming_language_preferences:x.value,tell_llm_os:_.value,share_dynamic_info_with_llm:g.value}),$.value=!1)}return(V,c)=>(o(),a("div",aa,[e("div",na,[c[5]||(c[5]=e("span",{class:"text-sm font-medium text-gray-600 dark:text-gray-300"},"Global User Context",-1)),e("button",{onClick:A,class:"btn btn-secondary btn-sm",disabled:!$.value},[u(ct,{class:"w-4 h-4 mr-1.5"}),z(" "+M($.value?"Save Changes":"Saved"),1)],8,la)]),e("div",ra,[e("div",ia,[e("div",ca,[c[7]||(c[7]=e("h3",{class:"text-sm font-semibold text-gray-700 dark:text-gray-200"},"Dynamic Information",-1)),e("label",da,[O(e("input",{type:"checkbox","onUpdate:modelValue":c[0]||(c[0]=w=>g.value=w),class:"sr-only peer"},null,512),[[Ye,g.value]]),c[6]||(c[6]=e("div",{class:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"},null,-1))])]),g.value?(o(),a("p",ua,"The AI will automatically know the following information. You can use these placeholders in your prompts.")):(o(),a("p",fa,"Dynamic information is currently disabled and will not be sent to the AI.")),g.value?(o(),a("div",ma,[(o(),a(W,null,B(E,w=>e("div",{key:w.label,class:"flex justify-between items-center"},[e("span",va,M(w.label)+":",1),e("code",pa,M(w.placeholder),1)])),64))])):D("",!0)]),e("div",ga,[c[9]||(c[9]=e("div",{class:"flex-grow"},[e("h3",{class:"text-sm font-semibold text-gray-700 dark:text-gray-200"},"Operating System"),e("p",{class:"text-xs text-gray-500 dark:text-gray-400"},"Inform the AI about your current operating system.")],-1)),e("label",ya,[O(e("input",{type:"checkbox","onUpdate:modelValue":c[1]||(c[1]=w=>_.value=w),class:"sr-only peer"},null,512),[[Ye,_.value]]),c[8]||(c[8]=e("div",{class:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"},null,-1))])]),e("div",ha,[e("div",null,[c[10]||(c[10]=e("label",{class:"block text-sm font-semibold mb-2 text-gray-700 dark:text-gray-200"},"Coding Style Constraints",-1)),O(e("textarea",{"onUpdate:modelValue":c[2]||(c[2]=w=>p.value=w),class:"styled-textarea",placeholder:"e.g., Always follow PEP8 for Python code. Use pathlib instead of os.path."},null,512),[[se,p.value]])]),e("div",null,[c[11]||(c[11]=e("label",{class:"block text-sm font-semibold mb-2 text-gray-700 dark:text-gray-200"},"Programming Language & Library Preferences",-1)),O(e("textarea",{"onUpdate:modelValue":c[3]||(c[3]=w=>x.value=w),class:"styled-textarea",placeholder:"e.g., I prefer solutions in Python 3.10+. For web development, use Vue.js with Tailwind CSS."},null,512),[[se,x.value]])]),e("div",null,[c[12]||(c[12]=e("label",{class:"block text-sm font-semibold mb-2 text-gray-700 dark:text-gray-200"},"General Info / Notes",-1)),O(e("textarea",{"onUpdate:modelValue":c[4]||(c[4]=w=>k.value=w),class:"styled-textarea",placeholder:"Add any other information about yourself or general instructions for the AI."},null,512),[[se,k.value]])])])])]))}},xa=oe(ba,[["__scopeId","data-v-b3c67334"]]),ka={class:"flex-1 flex flex-col min-h-0 p-2"},_a={class:"flex-grow min-h-0 border dark:border-gray-700 rounded-md overflow-hidden"},wa={__name:"PersonalityZone",setup(P){const n=le(),f=d(()=>n.activeDiscussion),k=d(()=>{var p;return((p=f.value)==null?void 0:p.personality_data_zone)||""});return(p,x)=>(o(),a("div",ka,[e("div",_a,[u(rt,{modelValue:k.value,"onUpdate:modelValue":x[0]||(x[0]=_=>k.value=_),class:"h-full","read-only":!0},null,8,["modelValue"])])]))}},Ca={class:"flex-1 flex flex-col min-h-0"},$a={class:"flex-shrink-0 px-3 py-2 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between gap-4"},Da={class:"flex-grow min-h-0 flex"},Ia={class:"flex-grow flex flex-col min-w-0 p-2"},Ma={class:"flex-grow min-h-0 border dark:border-gray-700 rounded-md overflow-hidden"},Ta={class:"rendered-prose-container h-full p-2"},La={class:"w-64 flex-shrink-0 border-l border-gray-200 dark:border-gray-700 flex flex-col p-2"},Aa={class:"sidebar-section"},Sa={class:"section-header"},za={class:"section-title"},Pa={class:"section-actions"},Za={class:"px-1 pb-2"},Ua={class:"section-content flex-grow min-h-0 overflow-y-auto"},Ea={key:0,class:"loading-state"},Va={key:1,class:"empty-state"},Ra={key:2,class:"memories-list space-y-2"},ja={class:"memory-header"},Ga={class:"memory-info"},Fa={class:"memory-details"},Wa=["title"],Ba={class:"memory-actions"},Na=["onClick"],Oa=["onClick"],Ha={class:"memory-controls"},Xa=["onClick"],qa=["onClick"],Ka={__name:"MemoryZone",setup(P){const n=le(),f=as(),k=ge(),{memories:p,isLoading:x}=K(f),_=b(""),g=b(new Set),$=d(()=>n.activeDiscussion),L=d(()=>{var m;return $.value&&((m=n.activeAiTasks[$.value.id])==null?void 0:m.type)==="memorize"}),E=d(()=>p.value.filter(m=>g.value.has(m.title)).map(m=>`--- Memory: ${m.title} ---
${m.content}
--- End Memory: ${m.title} ---`).join(`

`)),A=d(()=>{if(!_.value)return p.value;const m=_.value.toLowerCase();return p.value.filter(i=>i.title.toLowerCase().includes(m)||i.content.toLowerCase().includes(m))});function V(){$.value&&n.memorizeLTM($.value.id)}function c(){k.openModal("memoryEditor")}function w(m){k.openModal("memoryEditor",{memory:m})}async function G(m){const i=p.value.find(y=>y.id===m);if(!i)return;await k.showConfirmation({title:`Delete Memory '${i.title}'?`,message:"This will permanently delete this memory from your memory bank.",confirmText:"Delete"})&&await f.deleteMemory(m)}function Z(m){g.value.add(m),k.addNotification(`Memory "${m}" loaded to context`,"success")}function I(m){g.value.delete(m),k.addNotification(`Memory "${m}" removed from context`,"info")}return(m,i)=>(o(),a("div",Ca,[e("div",$a,[i[2]||(i[2]=e("span",{class:"text-sm font-medium text-gray-600 dark:text-gray-300"},"Long-Term Memory",-1)),e("button",{onClick:V,class:"btn btn-secondary btn-sm",title:"Memorize Current Discussion"},[u(Ee,{class:j(["w-4 h-4 mr-1.5",{"animate-pulse":L.value}])},null,8,["class"]),i[1]||(i[1]=z("Memorize "))])]),e("div",Da,[e("div",Ia,[e("div",Ma,[e("div",Ta,[u(Jt,{content:E.value},null,8,["content"])])])]),e("div",La,[e("div",Aa,[e("div",Sa,[e("h4",za,[u(Ce,{class:"w-4 h-4"}),i[3]||(i[3]=z(" Memory Bank"))]),e("div",Pa,[e("button",{onClick:c,class:"action-btn-sm",title:"Create New Memory"},[u(pe,{class:"w-4 h-4"})])])]),e("div",Za,[O(e("input",{type:"text","onUpdate:modelValue":i[0]||(i[0]=l=>_.value=l),placeholder:"Search memories...",class:"w-full px-2 py-1.5 text-xs bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-md focus:ring-1 focus:ring-yellow-500 focus:border-yellow-500"},null,512),[[se,_.value]])]),e("div",Ua,[Q(x)?(o(),a("div",Ea,[u(te,{class:"w-6 h-6 text-gray-400 animate-spin mx-auto mb-2"}),i[4]||(i[4]=e("p",{class:"text-xs text-gray-500"},"Loading...",-1))])):A.value.length===0?(o(),a("div",Va,[u(Ce,{class:"w-8 h-8 text-gray-400 mx-auto mb-2"}),i[5]||(i[5]=e("p",{class:"text-xs text-gray-500 mb-3"},"No memories",-1))])):(o(),a("div",Ra,[(o(!0),a(W,null,B(A.value,l=>(o(),a("div",{key:l.id,class:"memory-card"},[e("div",ja,[e("div",Ga,[e("div",{class:j(["memory-icon",{loaded:g.value.has(l.title)}])},[u(Ce,{class:"w-4 h-4"})],2),e("div",Fa,[e("h5",{class:"memory-title",title:l.title},M(l.title),9,Wa)])]),e("div",Ba,[e("button",{onClick:y=>w(l),class:"memory-action-btn",title:"Edit Memory"},[u(Ue,{class:"w-3 h-3"})],8,Na),e("button",{onClick:y=>G(l.id),class:"memory-action-btn memory-action-btn-danger",title:"Delete Memory"},[u($e,{class:"w-3 h-3"})],8,Oa)])]),e("div",Ha,[g.value.has(l.title)?(o(),a("button",{key:0,onClick:y=>I(l.title),class:"memory-load-btn loaded",title:"Remove from Context"},[u(Je,{class:"w-3 h-3"}),i[6]||(i[6]=z("In Context"))],8,Xa)):(o(),a("button",{key:1,onClick:y=>Z(l.title),class:"memory-load-btn",title:"Add to Context"},[u(pe,{class:"w-3 h-3"}),i[7]||(i[7]=z("Add to Context"))],8,qa))])]))),128))]))])])])])]))}},Qa={class:"h-full flex flex-col bg-white dark:bg-gray-800 shadow-xl flex-grow min-w-0"},Ya={class:"flex-shrink-0 bg-gray-50 dark:bg-gray-800/50 border-b border-gray-200 dark:border-gray-700"},Ja={class:"flex items-center justify-between px-2"},en={class:"flex space-x-1","aria-label":"Data Zone Tabs"},tn=["onClick"],sn={key:0,class:"px-1.5 py-0.5 bg-gray-200 dark:bg-gray-600 text-xs rounded-full font-mono"},on=["title"],ln={__name:"DataZone",setup(P){const n=ge(),f=le(),{liveDataZoneTokens:k}=K(f),p=b("discussion"),x=b(768),_=b(!1),g=d(()=>n.isDataZoneExpanded),$=A=>A>1e3?`${(A/1e3).toFixed(1)}K`:A.toString(),L=d(()=>[{id:"discussion",label:"Discussion",icon:es,tokenCount:k.value.discussion},{id:"user",label:"User",icon:ts,tokenCount:k.value.user},{id:"personality",label:"Personality",icon:Ee,tokenCount:k.value.personality},{id:"ltm",label:"Memory",icon:Ce,tokenCount:k.value.memory}]);function E(A){_.value=!0;const V=A.clientX,c=x.value;document.body.style.cursor="col-resize",document.body.style.userSelect="none";function w(Z){if(!_.value)return;const I=Z.clientX-V,m=c-I,i=320,l=window.innerWidth*.75;x.value=Math.max(i,Math.min(m,l))}function G(){_.value=!1,document.body.style.cursor="",document.body.style.userSelect="",window.removeEventListener("mousemove",w),window.removeEventListener("mouseup",G),localStorage.setItem("lollms_dataZoneWidth",x.value)}window.addEventListener("mousemove",w),window.addEventListener("mouseup",G)}return lt(()=>{const A=localStorage.getItem("lollms_dataZoneWidth");A&&(x.value=parseInt(A,10))}),(A,V)=>(o(),a("div",{class:j(["relative h-full flex",[g.value?"w-full":"flex-shrink-0"]]),style:ee(g.value?{}:{width:`${x.value}px`})},[e("div",{onMousedown:S(E,["prevent"]),class:"flex-shrink-0 w-2 cursor-col-resize bg-gray-200 dark:bg-gray-700 hover:bg-blue-400 transition-colors duration-200"},null,32),e("aside",Qa,[e("div",Ya,[e("div",Ja,[e("nav",en,[(o(!0),a(W,null,B(L.value,c=>(o(),a("button",{key:c.id,onClick:w=>p.value=c.id,class:j(["flex items-center gap-2 px-3 py-2.5 text-sm font-medium rounded-t-md border-b-2",p.value===c.id?"border-blue-500 text-blue-600 dark:text-blue-400 bg-white dark:bg-gray-800":"border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200"])},[(o(),T(ss(c.icon),{class:"w-4 h-4"})),e("span",null,M(c.label),1),c.tokenCount>0?(o(),a("span",sn,M($(c.tokenCount)),1)):D("",!0)],10,tn))),128))]),e("button",{onClick:V[0]||(V[0]=c=>Q(n).toggleDataZoneExpansion()),class:"action-btn",title:g.value?"Shrink":"Expand"},[g.value?(o(),T(os,{key:0,class:"w-5 h-5"})):(o(),T(it,{key:1,class:"w-5 h-5"}))],8,on)])]),p.value==="discussion"?(o(),T(oa,{key:0})):D("",!0),p.value==="user"?(o(),T(xa,{key:1})):D("",!0),p.value==="personality"?(o(),T(wa,{key:2})):D("",!0),p.value==="ltm"?(o(),T(Ka,{key:3})):D("",!0)])],6))}};export{ln as default};
