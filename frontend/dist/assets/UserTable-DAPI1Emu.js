import{bV as G,bW as J,bX as Q,bY as X,bZ as Y,b_ as ee,b$ as te,c0 as se,c1 as ae,W as z,G as R,r as m,k as $,w as oe,y as F,b as l,A as T,g as e,t as d,e as E,c,z as L,X as ne,c2 as le,a6 as ie,a8 as re,s as de,o as ce,d as h,h as A,j as ue,v as j,D as B,J as _,F as ve,i as me,U as pe,n as O}from"./index-CxDnU1ln.js";import{L as ge,I as fe}from"./chartjs-adapter-date-fns.esm-MTmHNP6c.js";const ye={key:0,class:"flex justify-center items-center h-96"},be={key:1,class:"text-center h-96 flex items-center justify-center"},he={key:2},_e={class:"h-96"},ke=["disabled"],xe={__name:"UserStatsModal",props:{userId:{type:Number,required:!0},username:{type:String,required:!0}},setup(I){G.register(J,Q,X,Y,ee,te,se,ae);const p=I,f=z(),g=R(),b=m(null),v=m(!0),k=m(null),x=$(()=>({responsive:!0,maintainAspectRatio:!1,scales:{x:{type:"time",time:{unit:"day",tooltipFormat:"MMM d, yyyy",displayFormats:{day:"MMM d"}},grid:{color:g.currentTheme==="dark"?"rgba(255, 255, 255, 0.1)":"rgba(0, 0, 0, 0.1)"},ticks:{color:g.currentTheme==="dark"?"#cbd5e1":"#4b5563"}},y:{beginAtZero:!0,grid:{color:g.currentTheme==="dark"?"rgba(255, 255, 255, 0.1)":"rgba(0, 0, 0, 0.1)"},ticks:{color:g.currentTheme==="dark"?"#cbd5e1":"#4b5563",stepSize:1}}},plugins:{legend:{labels:{color:g.currentTheme==="dark"?"#cbd5e1":"#4b5563"}}}})),U=$(()=>{if(!b.value)return{labels:[],datasets:[]};const o=new Map;for(let n=29;n>=0;n--){const S=new Date;S.setDate(S.getDate()-n),o.set(S.toISOString().split("T")[0],{tasks:0,messages:0})}b.value.tasks_per_day.forEach(n=>{o.has(n.date)&&(o.get(n.date).tasks=n.count)}),b.value.messages_per_day.forEach(n=>{o.has(n.date)&&(o.get(n.date).messages=n.count)});const i=Array.from(o.keys()),r=Array.from(o.values()).map(n=>n.tasks),C=Array.from(o.values()).map(n=>n.messages);return{labels:i,datasets:[{label:"Tasks Created",backgroundColor:"#3b82f6",borderColor:"#3b82f6",data:r,tension:.1},{label:"AI Generations",backgroundColor:"#10b981",borderColor:"#10b981",data:C,tension:.1}]}});async function w(){v.value=!0;try{b.value=await f.fetchUserStats(p.userId)}finally{v.value=!1}}function u(){if(k.value&&k.value.chart){const o=document.createElement("a");o.href=k.value.chart.toBase64Image("image/png",1),o.download=`user_stats_${p.username}.png`,o.click()}else g.addNotification("Could not export chart.","error")}return oe(()=>p.userId,o=>{o&&w()},{immediate:!0}),(o,i)=>(l(),F(le,{modalName:"userStats",title:`Usage Statistics for ${I.username}`,maxWidthClass:"max-w-4xl"},{body:T(()=>[v.value?(l(),c("div",ye,[L(ne,{class:"w-8 h-8 text-blue-500"})])):b.value?(l(),c("div",he,[i[2]||(i[2]=e("p",{class:"text-sm text-gray-500 mb-4"},"Showing activity for the last 30 days.",-1)),e("div",_e,[L(E(ge),{data:U.value,options:x.value,ref_key:"chartRef",ref:k},null,8,["data","options"])])])):(l(),c("div",be,i[1]||(i[1]=[e("p",{class:"text-gray-500"},"Could not load statistics for this user.",-1)])))]),footer:T(()=>[e("button",{onClick:w,class:"btn btn-secondary",disabled:v.value},d(v.value?"Reloading...":"Reload Data"),9,ke),e("button",{onClick:u,class:"btn btn-secondary"},"Export Image"),i[3]||(i[3]=e("div",{class:"flex-grow"},null,-1)),e("button",{onClick:i[0]||(i[0]=r=>E(g).closeModal("userStats")),class:"btn btn-primary"},"Close")]),_:1},8,["title"]))}},we={class:"bg-white dark:bg-gray-800 shadow-sm rounded-lg overflow-hidden"},Ce={class:"px-4 py-5 sm:p-6 space-y-4"},Se={class:"flex flex-wrap items-center justify-between gap-4"},Me={class:"flex items-center gap-2"},Ue=["disabled"],Ae=["disabled"],$e={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},Le={class:"border-t border-gray-200 dark:border-gray-700"},Ie={key:0,class:"p-6 text-center text-gray-500"},De={key:1,class:"p-6 text-center text-gray-500"},Ee={key:2,class:"overflow-x-auto"},Ve={class:"min-w-full divide-y divide-gray-200 dark:divide-gray-700"},Ne={class:"bg-gray-50 dark:bg-gray-700/50"},Te={scope:"col",class:"px-6 py-3"},je={scope:"col",class:"table-header"},Be={key:0},Oe={scope:"col",class:"table-header"},ze={key:0},Re={scope:"col",class:"table-header"},Fe={key:0},He={scope:"col",class:"table-header"},Ke={key:0},Pe={scope:"col",class:"table-header"},We={key:0},Ze={scope:"col",class:"table-header"},qe={key:0},Ge={class:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700"},Je={class:"px-6 py-4"},Qe=["value"],Xe={class:"table-cell"},Ye={class:"flex items-center"},et={class:"ml-4"},tt={class:"text-sm font-medium text-gray-900 dark:text-white"},st={class:"text-sm text-gray-500 dark:text-gray-400"},at={class:"table-cell"},ot={class:"flex items-center gap-2"},nt=["title"],lt={class:"table-cell text-sm text-center font-mono text-gray-500 dark:text-gray-400"},it=["title"],rt={class:"table-cell text-sm text-gray-500 dark:text-gray-400"},dt={class:"table-cell text-sm text-center text-gray-500 dark:text-gray-400"},ct={class:"table-cell text-sm text-center text-gray-500 dark:text-gray-400"},ut={class:"table-cell text-sm text-gray-500 dark:text-gray-400"},vt={class:"table-cell text-right text-sm font-medium"},mt={class:"flex items-center justify-end space-x-2"},pt=["onClick"],gt=["onClick"],ft=["onClick"],ht={__name:"UserTable",setup(I){const p=z(),f=R(),g=ie(),b=re(),{allUsers:v,isLoadingUsers:k}=de(p),x=m(""),U=m(null),w=m(null),u=m("username"),o=m("asc"),i=m(null),r=m([]),C=$(()=>({filter_online:U.value,filter_has_keys:w.value,sort_by:u.value,sort_order:o.value})),n=$(()=>{if(!x.value)return v.value;const a=x.value.toLowerCase();return v.value.filter(t=>t.username.toLowerCase().includes(a)||t.email&&t.email.toLowerCase().includes(a))}),S=$({get:()=>{const a=n.value.map(t=>t.id);return a.length===0?!1:r.value.length===a.length&&a.every(t=>r.value.includes(t))},set:a=>{const t=n.value.map(s=>s.id);a?r.value=[...new Set([...r.value,...t])]:r.value=r.value.filter(s=>!t.includes(s))}});function H(){const a=v.value.filter(t=>r.value.includes(t.id));if(a.length===0){f.addNotification("Please select at least one user.","warning");return}f.openModal("emailAllUsers",{users:a})}function K(){const a=v.value.filter(t=>r.value.includes(t.id));if(a.length===0){f.addNotification("Please select at least one user.","warning");return}f.openModal("emailList",{users:a})}function M(a){u.value===a?o.value=o.value==="asc"?"desc":"asc":(u.value=a,o.value="asc"),p.fetchAllUsers(C.value)}function V(){p.fetchAllUsers(C.value)}function P(a){if(!a)return"Never";const t=new Date(a),y=Math.round((new Date-t)/1e3);if(y<60)return`${y}s ago`;const D=Math.round(y/60);if(D<60)return`${D}m ago`;const N=Math.round(D/60);return N<24?`${N}h ago`:t.toLocaleString()}function W(a){f.openModal("adminUserEdit",{user:a,onUserUpdated:()=>p.fetchAllUsers(C.value)})}function Z(a){i.value=a,f.openModal("userStats",{userId:a.id,username:a.username})}async function q(a){await b.push("/"),g.openConversation({id:a.id,username:a.username,icon:a.icon})}return ce(()=>{p.fetchAllUsers(C.value)}),(a,t)=>(l(),c("div",we,[e("div",Ce,[e("div",Se,[t[11]||(t[11]=e("h3",{class:"text-base font-semibold leading-6 text-gray-900 dark:text-white"},"All Users",-1)),e("div",Me,[e("button",{onClick:K,class:"btn btn-secondary btn-sm",disabled:r.value.length===0},"Copy Emails",8,Ue),e("button",{onClick:H,class:"btn btn-secondary btn-sm",disabled:r.value.length===0},"Email Selected",8,Ae)])]),e("div",$e,[A(e("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=s=>x.value=s),placeholder:"Search username/email...",class:"input-field md:col-span-2"},null,512),[[ue,x.value]]),A(e("select",{"onUpdate:modelValue":t[1]||(t[1]=s=>U.value=s),onChange:V,class:"input-field"},t[12]||(t[12]=[e("option",{value:null},"All Activity",-1),e("option",{value:!0},"Online",-1),e("option",{value:!1},"Offline",-1)]),544),[[j,U.value]]),A(e("select",{"onUpdate:modelValue":t[2]||(t[2]=s=>w.value=s),onChange:V,class:"input-field"},t[13]||(t[13]=[e("option",{value:null},"All API Keys",-1),e("option",{value:!0},"Has Keys",-1),e("option",{value:!1},"No Keys",-1)]),544),[[j,w.value]])])]),e("div",Le,[E(k)?(l(),c("div",Ie," Loading users... ")):n.value.length===0?(l(),c("div",De," No users found. ")):(l(),c("div",Ee,[e("table",Ve,[e("thead",Ne,[e("tr",null,[e("th",Te,[A(e("input",{type:"checkbox","onUpdate:modelValue":t[3]||(t[3]=s=>S.value=s),class:"h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500"},null,512),[[B,S.value]])]),e("th",je,[e("button",{onClick:t[4]||(t[4]=s=>M("username")),class:"flex items-center gap-1"},[t[14]||(t[14]=_("User ")),u.value==="username"?(l(),c("span",Be,d(o.value==="asc"?"▲":"▼"),1)):h("",!0)])]),t[20]||(t[20]=e("th",{scope:"col",class:"table-header"},"Status",-1)),e("th",Oe,[e("button",{onClick:t[5]||(t[5]=s=>M("connection_count")),class:"flex items-center gap-1"},[t[15]||(t[15]=_("Connections")),u.value==="connection_count"?(l(),c("span",ze,d(o.value==="asc"?"▲":"▼"),1)):h("",!0)])]),e("th",Re,[e("button",{onClick:t[6]||(t[6]=s=>M("last_activity_at")),class:"flex items-center gap-1"},[t[16]||(t[16]=_("Last Seen ")),u.value==="last_activity_at"?(l(),c("span",Fe,d(o.value==="asc"?"▲":"▼"),1)):h("",!0)])]),e("th",He,[e("button",{onClick:t[7]||(t[7]=s=>M("api_key_count")),class:"flex items-center gap-1"},[t[17]||(t[17]=_("API Keys ")),u.value==="api_key_count"?(l(),c("span",Ke,d(o.value==="asc"?"▲":"▼"),1)):h("",!0)])]),e("th",Pe,[e("button",{onClick:t[8]||(t[8]=s=>M("task_count")),class:"flex items-center gap-1"},[t[18]||(t[18]=_("Tasks ")),u.value==="task_count"?(l(),c("span",We,d(o.value==="asc"?"▲":"▼"),1)):h("",!0)])]),e("th",Ze,[e("button",{onClick:t[9]||(t[9]=s=>M("created_at")),class:"flex items-center gap-1"},[t[19]||(t[19]=_("Joined ")),u.value==="created_at"?(l(),c("span",qe,d(o.value==="asc"?"▲":"▼"),1)):h("",!0)])]),t[21]||(t[21]=e("th",{scope:"col",class:"relative px-6 py-3"},[e("span",{class:"sr-only"},"Actions")],-1))])]),e("tbody",Ge,[(l(!0),c(ve,null,me(n.value,s=>(l(),c("tr",{key:s.id,class:"hover:bg-gray-50 dark:hover:bg-gray-700/50"},[e("td",Je,[A(e("input",{type:"checkbox",value:s.id,"onUpdate:modelValue":t[10]||(t[10]=y=>r.value=y),class:"h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500"},null,8,Qe),[[B,r.value]])]),e("td",Xe,[e("div",Ye,[L(pe,{icon:s.icon,username:s.username,"size-class":"h-8 w-8"},null,8,["icon","username"]),e("div",et,[e("div",tt,d(s.username),1),e("div",st,d(s.email||"No email"),1)])])]),e("td",at,[e("div",ot,[e("span",{class:O(["w-3 h-3 rounded-full",s.is_online?"bg-green-500":"bg-gray-400"]),title:s.is_online?"Online":"Offline"},null,10,nt),e("span",{class:O([s.is_active?"status-badge-green":"status-badge-red","status-badge"])},d(s.is_active?"Active":"Inactive"),3)])]),e("td",lt,[e("div",{class:"flex items-center justify-center gap-1",title:`${s.connection_count} active connections`},[L(fe,{class:"w-4 h-4"}),_(" "+d(s.connection_count),1)],8,it)]),e("td",rt,d(P(s.last_activity_at)),1),e("td",dt,d(s.api_key_count),1),e("td",ct,d(s.task_count),1),e("td",ut,d(new Date(s.created_at).toLocaleDateString()),1),e("td",vt,[e("div",mt,[e("button",{onClick:y=>Z(s),title:"View Stats",class:"action-icon"},t[22]||(t[22]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})],-1)]),8,pt),e("button",{onClick:y=>q(s),title:"Send DM",class:"action-icon"},t[23]||(t[23]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})],-1)]),8,gt),e("button",{onClick:y=>W(s),title:"Edit User",class:"action-icon"},t[24]||(t[24]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10"})],-1)]),8,ft)])])]))),128))])])]))]),i.value?(l(),F(xe,{key:0,userId:i.value.id,username:i.value.username},null,8,["userId","username"])):h("",!0)]))}};export{ht as default};
