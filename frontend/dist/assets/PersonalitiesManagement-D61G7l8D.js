import{W as ue,Q as de,N as ve,x as pe,a as ce,s as N,r as i,j as b,w as C,o as me,c as o,b as a,g as s,d as c,n as F,h as u,l as I,v as Z,F as x,i as h,t as p,e as O,k as T,C as ye,A as z,bH as E,f as fe,O as ge,G as be}from"./index-0fYRG1mg.js";import{A as we}from"./AppCard-CLRsKX2U.js";import{A as _e}from"./AppCardSkeleton-CMtN3200.js";import"./IconArrowUpCircle-DOpQ4laH.js";import"./IconGlobeAlt-CXDbe-De.js";import"./IconPlayCircle-uykQe9C5.js";import"./IconWrenchScrewdriver-CW2vA_r7.js";const ke={class:"space-y-6"},xe={class:"border-b border-gray-200 dark:border-gray-700"},he={class:"-mb-px flex space-x-6"},Se={key:0},Pe={class:"space-y-4"},Re={class:"grid grid-cols-1 lg:grid-cols-4 gap-4"},Ae={class:"relative lg:col-span-1"},Ce={class:"grid grid-cols-1 sm:grid-cols-3 lg:col-span-3 gap-4"},Ie=["value"],Ue=["value"],$e={key:0,class:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 2xl:grid-cols-4 gap-6"},Ve={key:1,class:"empty-state-card"},Me={key:2},Ne={class:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 2xl:grid-cols-4 gap-6"},Ze={key:0,class:"flex justify-between items-center mt-6"},Te=["disabled"],ze={class:"text-sm text-gray-600 dark:text-gray-400"},De=["disabled"],Le={key:1},qe={class:"flex justify-between items-center mb-4"},je={key:0,class:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm mb-6"},Be={class:"flex items-center gap-x-4"},Fe={key:0},Oe=["required"],Ee={key:1},He=["required"],We={key:1,class:"text-center p-4"},Ge={key:2,class:"empty-state-card"},Je={key:3,class:"space-y-4"},Qe={class:"font-semibold"},Ke={class:"text-sm text-gray-500"},Xe={class:"text-xs text-gray-400"},Ye={class:"flex items-center gap-2"},et=["onClick"],tt=["onClick"],st={__name:"PersonalitiesManagement",setup(lt){const d=de(),H=ve(),S=pe(),U=ce(),{personalityZooRepositories:W,isLoadingPersonalityZooRepositories:G,zooPersonalities:P,isLoadingZooPersonalities:J}=N(d),{publicPersonalities:Q}=N(U),{tasks:K}=N(H),m=i("zoo"),n=i({type:"git",name:"",url:"",path:""}),w=i(!1),y=i(null),R=i(""),v=i("All"),_=i("All"),k=i("All"),D=i("name"),L=i("asc"),f=i(JSON.parse(localStorage.getItem("starredPersonalities")||"[]")),r=i(1),$=i(24);let q=null;const V=b(()=>P.value.total||0),j=b(()=>P.value.pages||1),X=b(()=>{if(V.value===0)return"Showing 0-0 of 0";const l=(r.value-1)*$.value+1,e=Math.min(r.value*$.value,V.value);return`Showing ${l}-${e} of ${V.value}`});async function g(){const l={page:r.value,page_size:$.value,sort_by:D.value,sort_order:L.value,category:v.value!=="All"&&v.value!=="Starred"?v.value:void 0,repository:k.value!=="All"?k.value:void 0,search_query:R.value||void 0,installation_status:_.value!=="All"?_.value:void 0};v.value==="Starred"&&(l.starred_names=f.value),await d.fetchZooPersonalities(l)}const B=b(()=>{const l=new Map;return(K.value||[]).forEach(e=>{var t;if((t=e==null?void 0:e.name)!=null&&t.startsWith("Installing personality: ")&&(e.status==="running"||e.status==="pending")){const A=e.name.replace("Installing personality: ","");l.set(A,e)}}),(P.value.items||[]).map(e=>({...e,task:l.get(e.folder_name)||null}))});function Y(){clearTimeout(q),q=setTimeout(()=>{r.value=1,g()},300)}C([D,L,v,_,k],()=>{r.value=1,g()}),C(R,Y),C(r,g),C(f,l=>{localStorage.setItem("starredPersonalities",JSON.stringify(l)),v.value==="Starred"&&(r.value=1,g())},{deep:!0}),me(()=>{U.fetchPersonalities(),d.fetchPersonalityZooRepositories(),g()});const M=b(()=>[...W.value||[]].sort((l,e)=>(l.name||"").localeCompare(e.name||""))),ee=b(()=>["All","Starred",...P.value.categories||[]]);function te(l){return l?new Date(l).toLocaleString():"Never"}async function se(){if(!n.value.name){S.addNotification("Repository name is required.","warning");return}const l={name:n.value.name};n.value.type==="git"?l.url=n.value.url:l.path=n.value.path,y.value="add";try{await d.addPersonalityZooRepository(l),n.value={type:"git",name:"",url:"",path:""},w.value=!1}finally{y.value=null}}async function le(l){y.value=l.id;try{await d.pullPersonalityZooRepository(l.id)}finally{y.value=null}}async function ae(l){if(await S.showConfirmation({title:`Delete Repository '${l.name}'?`})){y.value=l.id;try{await d.deletePersonalityZooRepository(l.id)}finally{y.value=null}}}async function oe(l){await d.installZooPersonality({repository:l.repository,folder_name:l.folder_name})}async function ne(l){const e=Q.value.find(t=>t.name===l.name&&t.owner_username==="System");e&&await S.showConfirmation({title:`Uninstall '${l.name}'?`})&&(await U.deletePersonality(e.id),await g())}async function ie(l){const e=await d.fetchPersonalityReadme(l.repository,l.folder_name);S.openModal("sourceViewer",{title:`README: ${l.name}`,content:e,language:"markdown"})}function re(l){const e=f.value.indexOf(l);e>-1?f.value.splice(e,1):f.value.push(l)}return(l,e)=>(a(),o("div",ke,[s("div",xe,[s("nav",he,[s("button",{onClick:e[0]||(e[0]=t=>m.value="zoo"),class:F(["tab-button",m.value==="zoo"?"active":"inactive"])},"Zoo",2),s("button",{onClick:e[1]||(e[1]=t=>m.value="source"),class:F(["tab-button",m.value==="source"?"active":"inactive"])},"Repositories",2)])]),m.value==="zoo"?(a(),o("section",Se,[e[18]||(e[18]=s("h3",{class:"text-xl font-semibold mb-4"},"Personality Zoo",-1)),s("div",Pe,[s("div",Re,[s("div",Ae,[u(s("input",{"onUpdate:modelValue":e[2]||(e[2]=t=>R.value=t),type:"text",placeholder:"Search Personalities...",class:"input-field w-full pl-10"},null,512),[[I,R.value]]),e[14]||(e[14]=s("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[s("svg",{class:"h-5 w-5 text-gray-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})])],-1))]),s("div",Ce,[u(s("select",{"onUpdate:modelValue":e[3]||(e[3]=t=>_.value=t),class:"input-field"},e[15]||(e[15]=[s("option",{value:"All"},"All Statuses",-1),s("option",{value:"Installed"},"Installed",-1),s("option",{value:"Uninstalled"},"Uninstalled",-1)]),512),[[Z,_.value]]),u(s("select",{"onUpdate:modelValue":e[4]||(e[4]=t=>v.value=t),class:"input-field"},[(a(!0),o(x,null,h(ee.value,t=>(a(),o("option",{key:t,value:t},p(t),9,Ie))),128))],512),[[Z,v.value]]),u(s("select",{"onUpdate:modelValue":e[5]||(e[5]=t=>k.value=t),class:"input-field"},[e[16]||(e[16]=s("option",{value:"All"},"All Sources",-1)),(a(!0),o(x,null,h(M.value,t=>(a(),o("option",{key:t.id,value:t.name},p(t.name),9,Ue))),128))],512),[[Z,k.value]])])]),O(J)?(a(),o("div",$e,[(a(),o(x,null,h(8,t=>T(_e,{key:t})),64))])):B.value.length===0?(a(),o("div",Ve,e[17]||(e[17]=[s("p",null,"No personalities found.",-1)]))):(a(),o("div",Me,[s("div",Ne,[(a(!0),o(x,null,h(B.value,t=>(a(),ye(we,{key:`${t.repository}/${t.folder_name}`,app:t,task:t.task,"is-starred":f.value.includes(t.name),"item-type-name":"Personality",onStar:A=>re(t.name),onInstall:oe,onUninstall:ne,onHelp:ie},null,8,["app","task","is-starred","onStar"]))),128))]),j.value>1?(a(),o("div",Ze,[s("button",{onClick:e[6]||(e[6]=t=>r.value--),disabled:r.value===1,class:"btn btn-secondary"},"Previous",8,Te),s("span",ze,p(X.value),1),s("button",{onClick:e[7]||(e[7]=t=>r.value++),disabled:r.value>=j.value,class:"btn btn-secondary"},"Next",8,De)])):c("",!0)]))])])):c("",!0),m.value==="source"?(a(),o("section",Le,[s("div",qe,[e[19]||(e[19]=s("h3",{class:"text-xl font-semibold"},"Personality Zoo Repositories",-1)),s("button",{onClick:e[8]||(e[8]=t=>w.value=!w.value),class:"btn btn-primary"},p(w.value?"Cancel":"Add Repository"),1)]),w.value?(a(),o("div",je,[s("form",{onSubmit:fe(se,["prevent"]),class:"space-y-4"},[s("div",Be,[s("label",null,[u(s("input",{type:"radio","onUpdate:modelValue":e[9]||(e[9]=t=>n.value.type=t),value:"git",class:"radio-input"},null,512),[[E,n.value.type]]),e[20]||(e[20]=z(" Git"))]),s("label",null,[u(s("input",{type:"radio","onUpdate:modelValue":e[10]||(e[10]=t=>n.value.type=t),value:"local",class:"radio-input"},null,512),[[E,n.value.type]]),e[21]||(e[21]=z(" Local"))])]),s("div",null,[e[22]||(e[22]=s("label",null,"Name",-1)),u(s("input",{"onUpdate:modelValue":e[11]||(e[11]=t=>n.value.name=t),type:"text",class:"input-field",required:""},null,512),[[I,n.value.name]])]),n.value.type==="git"?(a(),o("div",Fe,[e[23]||(e[23]=s("label",null,"URL",-1)),u(s("input",{"onUpdate:modelValue":e[12]||(e[12]=t=>n.value.url=t),type:"url",class:"input-field",required:n.value.type==="git"},null,8,Oe),[[I,n.value.url]])])):c("",!0),n.value.type==="local"?(a(),o("div",Ee,[e[24]||(e[24]=s("label",null,"Path",-1)),u(s("input",{"onUpdate:modelValue":e[13]||(e[13]=t=>n.value.path=t),type:"text",class:"input-field",required:n.value.type==="local"},null,8,He),[[I,n.value.path]])])):c("",!0),e[25]||(e[25]=s("div",{class:"flex justify-end"},[s("button",{type:"submit",class:"btn btn-primary"},"Add")],-1))],32)])):c("",!0),O(G)?(a(),o("div",We,"Loading...")):M.value.length===0?(a(),o("div",Ge,e[26]||(e[26]=[s("p",null,"No repositories added.",-1)]))):(a(),o("div",Je,[(a(!0),o(x,null,h(M.value,t=>(a(),o("div",{key:t.id,class:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm flex items-center justify-between"},[s("div",null,[s("p",Qe,p(t.name),1),s("p",Ke,p(t.url),1),s("p",Xe,"Pulled: "+p(te(t.last_pulled_at)),1)]),s("div",Ye,[s("button",{onClick:A=>le(t),class:"btn btn-secondary btn-sm"},[T(ge,{class:"w-4 h-4 mr-1"}),z(p(t.type==="git"?"Pull":"Rescan"),1)],8,et),t.is_deletable?(a(),o("button",{key:0,onClick:A=>ae(t),class:"btn btn-danger btn-sm"},[T(be,{class:"w-4 h-4"})],8,tt)):c("",!0)])]))),128))]))])):c("",!0)]))}},vt=ue(st,[["__scopeId","data-v-8a089443"]]);export{vt as default};
