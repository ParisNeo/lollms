import{$ as Z,u as W,p as X,s as R,r as v,B as ee,C as te,D as le,E as se,G as ae,w as T,c as g,o as oe,b as i,e as o,f as t,g as j,d as b,l as h,h as B,Z as I,t as V,A as ne,i as m,H as re,q as P,v as _,F as D,y as $,z as p,bQ as ie,m as de,T as ue,I as me,j as ce,bR as pe}from"./index-Bk1wL1nm.js";const ve={class:"bg-white dark:bg-gray-800 shadow-md rounded-lg"},_e={class:"border-t border-gray-200 dark:border-gray-700"},fe={class:"relative mt-1"},ge={class:"flex items-center space-x-3 truncate"},be=["src"],xe={key:1,class:"w-8 h-8 flex-shrink-0 text-gray-500 dark:text-gray-400 flex items-center justify-center bg-gray-200 dark:bg-gray-700 rounded-md"},ye={class:"min-w-0 text-left"},ke={class:"block font-semibold truncate"},he={class:"p-2 sticky top-0 bg-white dark:bg-gray-800 z-10 border-b dark:border-gray-700"},we={class:"p-1 flex-grow overflow-y-auto"},Le={key:0,class:"text-center p-4 text-sm text-gray-500"},Se={class:"px-2 py-1.5 text-xs font-bold text-gray-600 dark:text-gray-300"},Me=["onClick"],Ce={class:"flex items-center space-x-3 truncate"},ze=["src"],Te={class:"truncate text-left"},Ve={class:"font-medium truncate text-sm"},Ne={class:"flex items-center gap-2 flex-shrink-0"},Oe={key:0,class:"p-4 bg-blue-50 dark:bg-blue-900/20 border-l-4 border-blue-500 text-blue-800 dark:text-blue-200"},Ue=["disabled"],Ae={key:0,class:"mt-1 text-xs text-red-600 dark:text-red-400"},Ee=["disabled"],Fe=["disabled"],Re=["disabled"],je=["disabled"],Be=["disabled"],Ie={class:"flex h-6 items-center"},Pe=["disabled"],De={class:"flex justify-end pt-4"},$e=["disabled"],Je={key:0},Ke={key:1},qe={__name:"LLMSettings",setup(Ge){const N=W(),w=X(),{user:d}=R(N),{availableLLMModelsGrouped:L,isLoadingLollmsModels:J,availableLollmsModels:O}=R(w),s=v({lollms_model_name:"",llm_ctx_size:4096,llm_temperature:.7,llm_top_k:50,llm_top_p:.95,llm_repeat_penalty:1.1,llm_repeat_last_n:64,put_thoughts_in_context:!1}),y=v(!1),S=v(!1);let U={};const f=v(!1),M=v(null),C=v(null),k=v(""),{floatingStyles:K}=ee(M,C,{placement:"bottom-start",whileElementsMounted:te,middleware:[le(5),se(),ae({padding:5})]}),q={mounted:(l,e)=>{l.clickOutsideEvent=r=>{const u=M.value;l===r.target||l.contains(r.target)||u!=null&&u.contains(r.target)||e.value()},document.addEventListener("mousedown",l.clickOutsideEvent)},unmounted:l=>{document.removeEventListener("mousedown",l.clickOutsideEvent)}};T(f,l=>{l&&pe(()=>{const e=C.value;if(e){const r=e.querySelector(".menu-item-button.selected");r&&r.scrollIntoView({block:"nearest"})}})});const n=g(()=>{var l;return((l=d.value)==null?void 0:l.llm_settings_overridden)??!1}),G=g(()=>!s.value.lollms_model_name||!O.value?null:O.value.find(l=>l.id===s.value.lollms_model_name)),A=g(()=>{var l,e;return((e=(l=G.value)==null?void 0:l.alias)==null?void 0:e.ctx_size_locked)===!0}),x=g({get:()=>s.value.lollms_model_name,set:l=>{n.value||(s.value.lollms_model_name=l)}}),z=g(()=>{if(!x.value)return null;for(const l of L.value){const e=l.items.find(r=>r.id===x.value);if(e)return e}return null}),H=g(()=>{if(!k.value)return L.value;const l=k.value.toLowerCase(),e=[];for(const r of L.value){const u=r.items.filter(a=>a.name.toLowerCase().includes(l));u.length>0&&e.push({...r,items:u})}return e});function Q(l){x.value=l,f.value=!1}const E=()=>{d.value&&(s.value={lollms_model_name:d.value.lollms_model_name||"",llm_ctx_size:d.value.llm_ctx_size??null,llm_temperature:d.value.llm_temperature??null,llm_top_k:d.value.llm_top_k??null,llm_top_p:d.value.llm_top_p??null,llm_repeat_penalty:d.value.llm_repeat_penalty??null,llm_repeat_last_n:d.value.llm_repeat_last_n??null,put_thoughts_in_context:d.value.put_thoughts_in_context||!1},U=JSON.parse(JSON.stringify(s.value)),S.value=!1)};oe(()=>{w.availableLollmsModels.length===0&&w.fetchAvailableLollmsModels(),E()}),T(d,E,{deep:!0}),T(s,l=>{S.value=JSON.stringify(l)!==JSON.stringify(U)},{deep:!0});async function Y(){y.value=!0;try{await N.updateUserPreferences(s.value)}catch{}finally{y.value=!1}}return(l,e)=>{var r,u;return o(),i("div",ve,[e[20]||(e[20]=t("div",{class:"px-4 py-5 sm:p-6"},[t("h2",{class:"text-xl font-bold leading-6 text-gray-900 dark:text-white"},"LLM Configuration"),t("p",{class:"mt-1 max-w-2xl text-sm text-gray-500 dark:text-gray-400"}," Select your default text generation model and adjust its parameters. ")],-1)),t("div",_e,[t("form",{onSubmit:j(Y,["prevent"]),class:"p-4 sm:p-6 space-y-6"},[t("div",null,[e[11]||(e[11]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Default LLM Model",-1)),t("div",fe,[t("button",{ref_key:"llmTriggerRef",ref:M,onClick:e[0]||(e[0]=a=>f.value=!f.value),type:"button",class:"toolbox-select truncate w-full flex items-center justify-between"},[t("div",ge,[(r=z.value)!=null&&r.icon_base64?(o(),i("img",{key:0,src:z.value.icon_base64,class:"h-8 w-8 rounded-md object-cover"},null,8,be)):(o(),i("span",xe,[B(I,{class:"w-5 h-5"})])),t("div",ye,[t("span",ke,V(((u=z.value)==null?void 0:u.name)||"Select a Model"),1)])]),e[10]||(e[10]=t("svg",{class:"w-4 h-4 text-gray-400 flex-shrink-0",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor"},[t("path",{"fill-rule":"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z","clip-rule":"evenodd"})],-1))],512),(o(),h(me,{to:"body"},[B(ue,{"enter-active-class":"transition ease-out duration-100","enter-from-class":"transform opacity-0 scale-95","enter-to-class":"transform opacity-100 scale-100","leave-active-class":"transition ease-in duration-75","leave-from-class":"transform opacity-100 scale-100","leave-to-class":"transform opacity-0 scale-95"},{default:ne(()=>[f.value?m((o(),i("div",{key:0,ref_key:"llmFloatingRef",ref:C,style:re(P(K)),class:"z-50 w-80 origin-top-left rounded-md bg-white dark:bg-gray-800 shadow-lg ring-1 ring-black ring-opacity-5 dark:ring-gray-700 focus:outline-none py-1 flex flex-col max-h-[50vh]"},[t("div",he,[m(t("input",{type:"text","onUpdate:modelValue":e[1]||(e[1]=a=>k.value=a),onClick:e[2]||(e[2]=j(()=>{},["stop"])),placeholder:"Search models...",class:"input-field-sm w-full"},null,512),[[_,k.value]])]),t("div",we,[P(J)?(o(),i("div",Le,"Loading models...")):b("",!0),(o(!0),i(D,null,$(H.value,a=>(o(),i("div",{key:a.label},[t("h4",Se,V(a.label),1),(o(!0),i(D,null,$(a.items,c=>{var F;return o(),i("button",{key:c.id,onClick:He=>Q(c.id),class:p(["menu-item-button",{selected:x.value===c.id}])},[t("div",Ce,[c.icon_base64?(o(),i("img",{key:0,src:c.icon_base64,class:"h-6 w-6 rounded-md object-cover flex-shrink-0"},null,8,ze)):(o(),h(I,{key:1,class:"w-6 h-6 p-0.5 text-gray-500 dark:text-gray-400 flex-shrink-0"})),t("div",Te,[t("p",Ve,V(c.name),1)])]),t("div",Ne,[x.value===c.id?(o(),h(ie,{key:0,class:"w-5 h-5 text-blue-600 dark:text-blue-400"})):b("",!0),(F=c.alias)!=null&&F.has_vision?(o(),h(de,{key:1,class:"w-5 h-5 text-green-500",title:"Vision active"})):b("",!0)])],10,Me)}),128))]))),128))])],4)),[[q,()=>f.value=!1]]):b("",!0)]),_:1})]))])]),n.value?(o(),i("div",Oe,e[12]||(e[12]=[t("p",{class:"font-semibold"},"Settings Overridden by Admin",-1),t("p",{class:"text-sm"},"An administrator has set and locked the generation parameters for this model. Your personal settings will not apply.",-1)]))):b("",!0),t("fieldset",{class:p(["grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",{"opacity-60":n.value}])},[t("div",null,[e[13]||(e[13]=t("label",{for:"contextSize",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Context Size (tokens)",-1)),m(t("input",{type:"number",id:"contextSize","onUpdate:modelValue":e[3]||(e[3]=a=>s.value.llm_ctx_size=a),class:"input-field mt-1",placeholder:"e.g., 4096",disabled:n.value||A.value},null,8,Ue),[[_,s.value.llm_ctx_size,void 0,{number:!0}]]),A.value?(o(),i("p",Ae,"This model has a fixed context size set by the administrator.")):b("",!0)]),t("div",{class:p({"cursor-not-allowed":n.value})},[e[14]||(e[14]=t("label",{for:"temperature",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Temperature",-1)),m(t("input",{type:"number",id:"temperature","onUpdate:modelValue":e[4]||(e[4]=a=>s.value.llm_temperature=a),class:"input-field mt-1",step:"0.01",min:"0",max:"2",placeholder:"e.g., 0.7",disabled:n.value},null,8,Ee),[[_,s.value.llm_temperature,void 0,{number:!0}]])],2),t("div",{class:p({"cursor-not-allowed":n.value})},[e[15]||(e[15]=t("label",{for:"topK",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Top K",-1)),m(t("input",{type:"number",id:"topK","onUpdate:modelValue":e[5]||(e[5]=a=>s.value.llm_top_k=a),class:"input-field mt-1",step:"1",min:"1",placeholder:"e.g., 50",disabled:n.value},null,8,Fe),[[_,s.value.llm_top_k,void 0,{number:!0}]])],2),t("div",{class:p({"cursor-not-allowed":n.value})},[e[16]||(e[16]=t("label",{for:"topP",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Top P",-1)),m(t("input",{type:"number",id:"topP","onUpdate:modelValue":e[6]||(e[6]=a=>s.value.llm_top_p=a),class:"input-field mt-1",step:"0.01",min:"0",max:"1",placeholder:"e.g., 0.95",disabled:n.value},null,8,Re),[[_,s.value.llm_top_p,void 0,{number:!0}]])],2),t("div",{class:p({"cursor-not-allowed":n.value})},[e[17]||(e[17]=t("label",{for:"repeatPenalty",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Repeat Penalty",-1)),m(t("input",{type:"number",id:"repeatPenalty","onUpdate:modelValue":e[7]||(e[7]=a=>s.value.llm_repeat_penalty=a),class:"input-field mt-1",step:"0.01",min:"0",placeholder:"e.g., 1.1",disabled:n.value},null,8,je),[[_,s.value.llm_repeat_penalty,void 0,{number:!0}]])],2),t("div",{class:p({"cursor-not-allowed":n.value})},[e[18]||(e[18]=t("label",{for:"repeatLastN",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Repeat Last N",-1)),m(t("input",{type:"number",id:"repeatLastN","onUpdate:modelValue":e[8]||(e[8]=a=>s.value.llm_repeat_last_n=a),class:"input-field mt-1",step:"1",min:"0",placeholder:"e.g., 64",disabled:n.value},null,8,Be),[[_,s.value.llm_repeat_last_n,void 0,{number:!0}]])],2)],2),t("div",{class:p(["relative flex items-start",{"opacity-60 cursor-not-allowed":n.value}])},[t("div",Ie,[m(t("input",{id:"putThoughts","onUpdate:modelValue":e[9]||(e[9]=a=>s.value.put_thoughts_in_context=a),type:"checkbox",disabled:n.value,class:"h-4 w-4 rounded border-gray-300 dark:border-gray-600 dark:bg-gray-700 text-blue-600 focus:ring-blue-600 dark:focus:ring-blue-600 dark:ring-offset-gray-800"},null,8,Pe),[[ce,s.value.put_thoughts_in_context]])]),e[19]||(e[19]=t("div",{class:"ml-3 text-sm leading-6"},[t("label",{for:"putThoughts",class:"font-medium text-gray-900 dark:text-gray-300"},'Include "think" blocks in context'),t("p",{class:"text-gray-500 dark:text-gray-400"},"Allows the AI to see its previous reasoning steps.")],-1))],2),t("div",De,[t("button",{type:"submit",class:"btn btn-primary",disabled:y.value||!S.value||n.value},[y.value?(o(),i("span",Je,"Saving...")):(o(),i("span",Ke,"Save LLM Settings"))],8,$e)])],32)])])}}},Ye=Z(qe,[["__scopeId","data-v-77caf658"]]);export{Ye as default};
