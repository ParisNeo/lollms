import{ad as W,s as X,ae as Z,c1 as A,r as p,af as ee,ag as te,ah as le,ai as se,aj as ae,w as T,c as b,o as oe,b as u,d as n,h as t,P as F,g as x,q as h,e as P,H as $,t as V,f as ne,l as c,ak as re,i as B,v as f,F as D,m as I,n as r,cg as ie,c0 as de,T as ue,al as me,c2 as ce,aa as ge}from"./index-DnjdbnqE.js";const pe={class:"bg-white dark:bg-gray-800 shadow-md rounded-lg"},fe={class:"border-t border-gray-200 dark:border-gray-700"},ve={class:"relative mt-1"},be={class:"flex items-center space-x-3 truncate"},xe=["src"],_e={key:1,class:"w-8 h-8 flex-shrink-0 text-gray-500 dark:text-gray-400 flex items-center justify-center bg-gray-200 dark:bg-gray-700 rounded-md"},ye={class:"min-w-0 text-left"},ke={class:"block font-semibold truncate"},he={class:"p-2 sticky top-0 bg-white dark:bg-gray-800 z-10 border-b dark:border-gray-700"},we={class:"p-1 flex-grow overflow-y-auto"},Le={key:0,class:"text-center p-4 text-sm text-gray-500"},Se={class:"px-2 py-1.5 text-xs font-bold text-gray-600 dark:text-gray-300"},Me=["onClick"],Ce={class:"flex items-center space-x-3 truncate"},ze=["src"],Te={class:"truncate text-left"},Ve={class:"font-medium truncate text-sm"},Ne={class:"flex items-center gap-2 flex-shrink-0"},Oe={key:0,class:"p-4 bg-blue-50 dark:bg-blue-900/20 border-l-4 border-blue-500 text-blue-800 dark:text-blue-200"},Re=["disabled"],je={key:0,class:"mt-1 text-xs text-red-600 dark:text-red-400"},Ee=["disabled"],Ue=["disabled"],Ae=["disabled"],Fe=["disabled"],Pe=["disabled"],$e={class:"border-t dark:border-gray-700 pt-4"},Be={class:"flex items-center justify-between bg-gray-50 dark:bg-gray-700/50 p-3 rounded-md"},De=["disabled"],Ie=["disabled"],Je={class:"flex items-center justify-between bg-gray-50 dark:bg-gray-700/50 p-3 rounded-md"},Ke=["disabled"],qe={class:"flex items-center justify-between bg-gray-50 dark:bg-gray-700/50 p-3 rounded-md"},He=["disabled"],Ge={class:"flex justify-end pt-4"},Ye=["disabled"],Qe={key:0},We={key:1},Xe={__name:"LLMSettings",setup(Ze){const N=X(),w=Z(),{user:i}=A(N),{availableLLMModelsGrouped:L,isLoadingLollmsModels:J,availableLollmsModels:O}=A(w),l=p({lollms_model_name:"",llm_ctx_size:4096,llm_temperature:.7,llm_top_k:50,llm_top_p:.95,llm_repeat_penalty:1.1,llm_repeat_last_n:64,put_thoughts_in_context:!1,reasoning_activation:!1,reasoning_effort:null,reasoning_summary:!1}),y=p(!1),S=p(!1);let R={};const v=p(!1),M=p(null),C=p(null),k=p(""),{floatingStyles:K}=ee(M,C,{placement:"bottom-start",whileElementsMounted:te,middleware:[le(5),se(),ae({padding:5})]}),q={mounted:(s,e)=>{s.clickOutsideEvent=d=>{const m=M.value;s===d.target||s.contains(d.target)||m!=null&&m.contains(d.target)||e.value()},document.addEventListener("mousedown",s.clickOutsideEvent)},unmounted:s=>{document.removeEventListener("mousedown",s.clickOutsideEvent)}};T(v,s=>{s&&ge(()=>{const e=C.value;if(e){const d=e.querySelector(".menu-item-button.selected");d&&d.scrollIntoView({block:"nearest"})}})});const o=b(()=>{var s;return((s=i.value)==null?void 0:s.llm_settings_overridden)??!1}),H=b(()=>!l.value.lollms_model_name||!O.value?null:O.value.find(s=>s.id===l.value.lollms_model_name)),j=b(()=>{var s,e;return((e=(s=H.value)==null?void 0:s.alias)==null?void 0:e.ctx_size_locked)===!0}),_=b({get:()=>l.value.lollms_model_name,set:s=>{o.value||(l.value.lollms_model_name=s)}}),z=b(()=>{if(!_.value)return null;for(const s of L.value){const e=s.items.find(d=>d.id===_.value);if(e)return e}return null}),G=b(()=>{if(!k.value)return L.value;const s=k.value.toLowerCase(),e=[];for(const d of L.value){const m=d.items.filter(a=>a.name.toLowerCase().includes(s));m.length>0&&e.push({...d,items:m})}return e});function Y(s){_.value=s,v.value=!1}const E=()=>{i.value&&(l.value={lollms_model_name:i.value.lollms_model_name||"",llm_ctx_size:i.value.llm_ctx_size??null,llm_temperature:i.value.llm_temperature??null,llm_top_k:i.value.llm_top_k??null,llm_top_p:i.value.llm_top_p??null,llm_repeat_penalty:i.value.llm_repeat_penalty??null,llm_repeat_last_n:i.value.llm_repeat_last_n??null,put_thoughts_in_context:i.value.put_thoughts_in_context||!1,reasoning_activation:i.value.reasoning_activation||!1,reasoning_effort:i.value.reasoning_effort||null,reasoning_summary:i.value.reasoning_summary||!1},R=JSON.parse(JSON.stringify(l.value)),S.value=!1)};oe(()=>{w.availableLollmsModels.length===0&&w.fetchAvailableLollmsModels(),E()}),T(i,E,{deep:!0}),T(l,s=>{S.value=JSON.stringify(s)!==JSON.stringify(R)},{deep:!0});async function Q(){y.value=!0;try{await N.updateUserPreferences(l.value)}catch{}finally{y.value=!1}}return(s,e)=>{var d,m;return n(),u("div",pe,[e[29]||(e[29]=t("div",{class:"px-4 py-5 sm:p-6"},[t("h2",{class:"text-xl font-bold leading-6 text-gray-900 dark:text-white"},"LLM Configuration"),t("p",{class:"mt-1 max-w-2xl text-sm text-gray-500 dark:text-gray-400"}," Select your default text generation model and adjust its parameters. ")],-1)),t("div",fe,[t("form",{onSubmit:F(Q,["prevent"]),class:"p-4 sm:p-6 space-y-6"},[t("div",null,[e[14]||(e[14]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Default LLM Model",-1)),t("div",ve,[t("button",{ref_key:"llmTriggerRef",ref:M,onClick:e[0]||(e[0]=a=>v.value=!v.value),type:"button",class:"toolbox-select truncate w-full flex items-center justify-between"},[t("div",be,[(d=z.value)!=null&&d.icon_base64?(n(),u("img",{key:0,src:z.value.icon_base64,class:"h-8 w-8 rounded-md object-cover"},null,8,xe)):(n(),u("span",_e,[P($,{class:"w-5 h-5"})])),t("div",ye,[t("span",ke,V(((m=z.value)==null?void 0:m.name)||"Select a Model"),1)])]),e[13]||(e[13]=t("svg",{class:"w-4 h-4 text-gray-400 flex-shrink-0",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor"},[t("path",{"fill-rule":"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z","clip-rule":"evenodd"})],-1))],512),(n(),h(me,{to:"body"},[P(ue,{"enter-active-class":"transition ease-out duration-100","enter-from-class":"transform opacity-0 scale-95","enter-to-class":"transform opacity-100 scale-100","leave-active-class":"transition ease-in duration-75","leave-from-class":"transform opacity-100 scale-100","leave-to-class":"transform opacity-0 scale-95"},{default:ne(()=>[v.value?c((n(),u("div",{key:0,ref_key:"llmFloatingRef",ref:C,style:re(B(K)),class:"z-50 w-80 origin-top-left rounded-md bg-white dark:bg-gray-800 shadow-lg ring-1 ring-black ring-opacity-5 dark:ring-gray-700 focus:outline-none py-1 flex flex-col max-h-[50vh]"},[t("div",he,[c(t("input",{type:"text","onUpdate:modelValue":e[1]||(e[1]=a=>k.value=a),onClick:e[2]||(e[2]=F(()=>{},["stop"])),placeholder:"Search models...",class:"input-field-sm w-full"},null,512),[[f,k.value]])]),t("div",we,[B(J)?(n(),u("div",Le,"Loading models...")):x("",!0),(n(!0),u(D,null,I(G.value,a=>(n(),u("div",{key:a.label},[t("h4",Se,V(a.label),1),(n(!0),u(D,null,I(a.items,g=>{var U;return n(),u("button",{key:g.id,onClick:et=>Y(g.id),class:r(["menu-item-button",{selected:_.value===g.id}])},[t("div",Ce,[g.icon_base64?(n(),u("img",{key:0,src:g.icon_base64,class:"h-6 w-6 rounded-md object-cover flex-shrink-0"},null,8,ze)):(n(),h($,{key:1,class:"w-6 h-6 p-0.5 text-gray-500 dark:text-gray-400 flex-shrink-0"})),t("div",Te,[t("p",Ve,V(g.name),1)])]),t("div",Ne,[_.value===g.id?(n(),h(ie,{key:0,class:"w-5 h-5 text-blue-600 dark:text-blue-400"})):x("",!0),(U=g.alias)!=null&&U.has_vision?(n(),h(de,{key:1,class:"w-5 h-5 text-green-500",title:"Vision active"})):x("",!0)])],10,Me)}),128))]))),128))])],4)),[[q,()=>v.value=!1]]):x("",!0)]),_:1})]))])]),o.value?(n(),u("div",Oe,e[15]||(e[15]=[t("p",{class:"font-semibold"},"Settings Overridden by Admin",-1),t("p",{class:"text-sm"},"An administrator has set and locked the generation parameters for this model. Your personal settings will not apply.",-1)]))):x("",!0),t("fieldset",{class:r(["grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",{"opacity-60":o.value}])},[t("div",null,[e[16]||(e[16]=t("label",{for:"contextSize",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Context Size (tokens)",-1)),c(t("input",{type:"number",id:"contextSize","onUpdate:modelValue":e[3]||(e[3]=a=>l.value.llm_ctx_size=a),class:"input-field mt-1",placeholder:"e.g., 4096",disabled:o.value||j.value},null,8,Re),[[f,l.value.llm_ctx_size,void 0,{number:!0}]]),j.value?(n(),u("p",je,"This model has a fixed context size set by the administrator.")):x("",!0)]),t("div",{class:r({"cursor-not-allowed":o.value})},[e[17]||(e[17]=t("label",{for:"temperature",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Temperature",-1)),c(t("input",{type:"number",id:"temperature","onUpdate:modelValue":e[4]||(e[4]=a=>l.value.llm_temperature=a),class:"input-field mt-1",step:"0.01",min:"0",max:"2",placeholder:"e.g., 0.7",disabled:o.value},null,8,Ee),[[f,l.value.llm_temperature,void 0,{number:!0}]])],2),t("div",{class:r({"cursor-not-allowed":o.value})},[e[18]||(e[18]=t("label",{for:"topK",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Top K",-1)),c(t("input",{type:"number",id:"topK","onUpdate:modelValue":e[5]||(e[5]=a=>l.value.llm_top_k=a),class:"input-field mt-1",step:"1",min:"1",placeholder:"e.g., 50",disabled:o.value},null,8,Ue),[[f,l.value.llm_top_k,void 0,{number:!0}]])],2),t("div",{class:r({"cursor-not-allowed":o.value})},[e[19]||(e[19]=t("label",{for:"topP",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Top P",-1)),c(t("input",{type:"number",id:"topP","onUpdate:modelValue":e[6]||(e[6]=a=>l.value.llm_top_p=a),class:"input-field mt-1",step:"0.01",min:"0",max:"1",placeholder:"e.g., 0.95",disabled:o.value},null,8,Ae),[[f,l.value.llm_top_p,void 0,{number:!0}]])],2),t("div",{class:r({"cursor-not-allowed":o.value})},[e[20]||(e[20]=t("label",{for:"repeatPenalty",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Repeat Penalty",-1)),c(t("input",{type:"number",id:"repeatPenalty","onUpdate:modelValue":e[7]||(e[7]=a=>l.value.llm_repeat_penalty=a),class:"input-field mt-1",step:"0.01",min:"0",placeholder:"e.g., 1.1",disabled:o.value},null,8,Fe),[[f,l.value.llm_repeat_penalty,void 0,{number:!0}]])],2),t("div",{class:r({"cursor-not-allowed":o.value})},[e[21]||(e[21]=t("label",{for:"repeatLastN",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Repeat Last N",-1)),c(t("input",{type:"number",id:"repeatLastN","onUpdate:modelValue":e[8]||(e[8]=a=>l.value.llm_repeat_last_n=a),class:"input-field mt-1",step:"1",min:"0",placeholder:"e.g., 64",disabled:o.value},null,8,Pe),[[f,l.value.llm_repeat_last_n,void 0,{number:!0}]])],2)],2),t("div",$e,[e[28]||(e[28]=t("h3",{class:"font-semibold text-gray-800 dark:text-gray-200 mb-3"},"Reasoning Capabilities",-1)),t("div",{class:r(["grid grid-cols-1 md:grid-cols-2 gap-6",{"opacity-60":o.value}])},[t("div",Be,[e[22]||(e[22]=t("span",{class:"flex-grow flex flex-col pr-4"},[t("span",{class:"text-sm font-medium text-gray-900 dark:text-gray-100"},"Enable Reasoning (Thinking)"),t("span",{class:"text-xs text-gray-500 dark:text-gray-400"},"Activates thought generation if supported by the model.")],-1)),t("button",{onClick:e[9]||(e[9]=a=>l.value.reasoning_activation=!l.value.reasoning_activation),type:"button",disabled:o.value,class:r([l.value.reasoning_activation?"bg-blue-600":"bg-gray-200 dark:bg-gray-600","relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800"])},[t("span",{class:r([l.value.reasoning_activation?"translate-x-5":"translate-x-0","pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out"])},null,2)],10,De)]),t("div",{class:r({"cursor-not-allowed":o.value})},[e[24]||(e[24]=t("label",{for:"reasoning-effort",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Reasoning Effort",-1)),c(t("select",{id:"reasoning-effort","onUpdate:modelValue":e[10]||(e[10]=a=>l.value.reasoning_effort=a),class:"input-field mt-1",disabled:o.value},e[23]||(e[23]=[t("option",{value:null},"Default",-1),t("option",{value:"low"},"Low",-1),t("option",{value:"medium"},"Medium",-1),t("option",{value:"high"},"High",-1)]),8,Ie),[[ce,l.value.reasoning_effort]]),e[25]||(e[25]=t("p",{class:"mt-1 text-xs text-gray-500 dark:text-gray-400"},"Controls the depth of reasoning (model dependent).",-1))],2),t("div",Je,[e[26]||(e[26]=t("span",{class:"flex-grow flex flex-col pr-4"},[t("span",{class:"text-sm font-medium text-gray-900 dark:text-gray-100"},"Reasoning Summary"),t("span",{class:"text-xs text-gray-500 dark:text-gray-400"},"Enable summarization of reasoning steps in output.")],-1)),t("button",{onClick:e[11]||(e[11]=a=>l.value.reasoning_summary=!l.value.reasoning_summary),type:"button",disabled:o.value,class:r([l.value.reasoning_summary?"bg-blue-600":"bg-gray-200 dark:bg-gray-600","relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800"])},[t("span",{class:r([l.value.reasoning_summary?"translate-x-5":"translate-x-0","pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out"])},null,2)],10,Ke)]),t("div",qe,[e[27]||(e[27]=t("span",{class:"flex-grow flex flex-col pr-4"},[t("span",{class:"text-sm font-medium text-gray-900 dark:text-gray-100"},'Include "think" blocks in context'),t("span",{class:"text-xs text-gray-500 dark:text-gray-400"},"Allows the AI to see its previous reasoning steps.")],-1)),t("button",{onClick:e[12]||(e[12]=a=>l.value.put_thoughts_in_context=!l.value.put_thoughts_in_context),type:"button",disabled:o.value,class:r([l.value.put_thoughts_in_context?"bg-blue-600":"bg-gray-200 dark:bg-gray-600","relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800"])},[t("span",{class:r([l.value.put_thoughts_in_context?"translate-x-5":"translate-x-0","pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out"])},null,2)],10,He)])],2)]),t("div",Ge,[t("button",{type:"submit",class:"btn btn-primary",disabled:y.value||!S.value||o.value},[y.value?(n(),u("span",Qe,"Saving...")):(n(),u("span",We,"Save LLM Settings"))],8,Ye)])],32)])])}}},lt=W(Xe,[["__scopeId","data-v-de2b5b61"]]);export{lt as default};
