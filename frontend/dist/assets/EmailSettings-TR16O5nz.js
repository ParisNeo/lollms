import{c7 as w,r as g,c as k,o as S,w as c,b as d,d as i,h as e,P as M,l as o,c2 as h,g as y,j as u,v as n,p as T,t as _,i as P}from"./index-DnjdbnqE.js";const U={class:"bg-white dark:bg-gray-800 shadow-md rounded-lg"},V={class:"space-y-8"},E={class:"mt-4"},C={key:0,class:"p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg"},L={key:1,class:"p-4 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800/50 rounded-lg"},N={key:2,class:"space-y-6 pt-4"},A={class:"grid grid-cols-1 gap-y-6 sm:grid-cols-2 sm:gap-x-6"},F={class:"sm:col-span-2"},O={class:"sm:col-span-2"},j={class:"sm:col-span-2"},B={class:"relative flex items-start"},q={class:"flex h-6 items-center"},D={class:"mt-8 pt-5 border-t border-gray-200 dark:border-gray-700"},G={class:"flex justify-end"},I=["disabled"],J={key:1,class:"p-6 text-center"},W={class:"text-gray-500"},z={__name:"EmailSettings",setup(H){const r=w(),s=g({}),m=g(!1),p=g(!1);let v="{}";const b=k(()=>r.globalSettings.filter(a=>a.category==="Email Settings"||a.key==="password_recovery_mode"));S(()=>{r.globalSettings.length===0?r.fetchGlobalSettings():f()}),c(()=>r.globalSettings,f,{deep:!0}),c(s,a=>{p.value=JSON.stringify(a)!==v},{deep:!0});function f(){const a={};b.value.length>0&&(b.value.forEach(t=>{a[t.key]=t.value}),s.value=a,v=JSON.stringify(s.value),p.value=!1)}async function x(){m.value=!0;try{const a={...s.value};(a.smtp_password===null||a.smtp_password==="")&&delete a.smtp_password,await r.updateGlobalSettings(a),a.smtp_password&&(s.value.smtp_password="")}catch{}finally{m.value=!1}}return(a,t)=>(i(),d("div",U,[t[18]||(t[18]=e("div",{class:"p-6 border-b border-gray-200 dark:border-gray-700"},[e("h3",{class:"text-xl font-semibold leading-6 text-gray-900 dark:text-white"}," Email & Password Recovery "),e("p",{class:"mt-1 text-sm text-gray-500 dark:text-gray-400"}," Configure the method for sending system emails and managing password recovery. ")],-1)),Object.keys(s.value).length?(i(),d("form",{key:0,onSubmit:M(x,["prevent"]),class:"p-6"},[e("div",V,[e("div",null,[t[8]||(t[8]=e("label",{for:"password_recovery_mode",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Email Sending Method",-1)),o(e("select",{id:"password_recovery_mode","onUpdate:modelValue":t[0]||(t[0]=l=>s.value.password_recovery_mode=l),class:"input-field mt-1"},t[7]||(t[7]=[e("option",{value:"manual"},"Manual (Admin Managed)",-1),e("option",{value:"automatic"},"SMTP Server",-1),e("option",{value:"system_mail"},"System Mail Command",-1),e("option",{value:"outlook"},"Outlook (Windows only)",-1)]),512),[[h,s.value.password_recovery_mode]])]),e("div",E,[s.value.password_recovery_mode==="manual"?(i(),d("div",C,t[9]||(t[9]=[e("p",{class:"text-sm text-gray-600 dark:text-gray-300"},[u(" In "),e("span",{class:"font-semibold"},"Manual Mode"),u(", the system will not send any emails. When a user requests a password reset, a notification will be sent to administrators in the UI. Admins must then manually generate a reset link and send it to the user. ")],-1)]))):y("",!0),s.value.password_recovery_mode==="system_mail"?(i(),d("div",L,t[10]||(t[10]=[e("p",{class:"text-sm text-yellow-800 dark:text-yellow-200"},[e("span",{class:"font-semibold"},"System Mail Mode"),u(" uses the server's built-in `mail` command (e.g., from `mailutils`). This is a simpler alternative to SMTP but requires the command to be installed and properly configured on the server's operating system. ")],-1)]))):y("",!0),s.value.password_recovery_mode==="automatic"?(i(),d("div",N,[t[17]||(t[17]=e("div",{class:"p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800/50 rounded-lg"},[e("p",{class:"text-sm text-blue-800 dark:text-blue-200"},[e("span",{class:"font-semibold"},"SMTP Mode"),u(" provides the most reliable way to send emails. Fill in your SMTP provider's details below. ")])],-1)),e("div",A,[e("div",null,[t[11]||(t[11]=e("label",{for:"smtp_host",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"SMTP Host",-1)),o(e("input",{type:"text",id:"smtp_host","onUpdate:modelValue":t[1]||(t[1]=l=>s.value.smtp_host=l),class:"input-field mt-1"},null,512),[[n,s.value.smtp_host]])]),e("div",null,[t[12]||(t[12]=e("label",{for:"smtp_port",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"SMTP Port",-1)),o(e("input",{type:"number",id:"smtp_port","onUpdate:modelValue":t[2]||(t[2]=l=>s.value.smtp_port=l),class:"input-field mt-1"},null,512),[[n,s.value.smtp_port]])]),e("div",F,[t[13]||(t[13]=e("label",{for:"smtp_from_email",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"From Email Address",-1)),o(e("input",{type:"email",id:"smtp_from_email","onUpdate:modelValue":t[3]||(t[3]=l=>s.value.smtp_from_email=l),class:"input-field mt-1"},null,512),[[n,s.value.smtp_from_email]])]),e("div",O,[t[14]||(t[14]=e("label",{for:"smtp_user",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"SMTP Username",-1)),o(e("input",{type:"text",id:"smtp_user","onUpdate:modelValue":t[4]||(t[4]=l=>s.value.smtp_user=l),class:"input-field mt-1",autocomplete:"off"},null,512),[[n,s.value.smtp_user]])]),e("div",j,[t[15]||(t[15]=e("label",{for:"smtp_password",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"SMTP Password",-1)),o(e("input",{type:"password",id:"smtp_password","onUpdate:modelValue":t[5]||(t[5]=l=>s.value.smtp_password=l),class:"input-field mt-1",placeholder:"Leave blank to keep existing password",autocomplete:"new-password"},null,512),[[n,s.value.smtp_password]])]),e("div",B,[e("div",q,[o(e("input",{id:"smtp_use_tls","onUpdate:modelValue":t[6]||(t[6]=l=>s.value.smtp_use_tls=l),type:"checkbox",class:"h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-600"},null,512),[[T,s.value.smtp_use_tls]])]),t[16]||(t[16]=e("div",{class:"ml-3 text-sm leading-6"},[e("label",{for:"smtp_use_tls",class:"font-medium text-gray-900 dark:text-gray-100"},"Use TLS"),e("p",{class:"text-gray-500 dark:text-gray-400"},"Enable TLS encryption for the connection.")],-1))])])])):y("",!0)])]),e("div",D,[e("div",G,[e("button",{type:"submit",class:"btn btn-primary",disabled:m.value||!p.value},_(m.value?"Saving...":"Save Settings"),9,I)])])],32)):(i(),d("div",J,[e("p",W,_(P(r).isLoadingSettings?"Loading settings...":"Could not load email settings."),1)]))]))}};export{z as default};
