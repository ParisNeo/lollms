import{s as C,x as E,r as i,o as M,b as o,h as t,g,j as y,t as u,i as k,P as V,l as L,v as S,F as j,m as I,e as R,f as B,y as H,W as P,d as r}from"./index-DnjdbnqE.js";const q="/logo.png",F={class:"fixed inset-0 z-[100] flex flex-col items-center justify-center p-4 bg-gray-100 dark:bg-gray-900"},N={class:"w-full max-w-md mx-auto bg-white dark:bg-gray-800 rounded-lg shadow-xl overflow-hidden"},T={class:"p-6 text-center border-b dark:border-gray-700"},D={class:"flex justify-center items-center gap-4 mb-4"},W={class:"h-12 w-12 rounded-md bg-gray-200 dark:bg-gray-700 flex items-center justify-center overflow-hidden"},Y=["src"],Z={key:1,class:"w-7 h-7 text-gray-500 dark:text-gray-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},J={key:0,class:"text-xl font-bold text-gray-800 dark:text-gray-100"},K={class:"text-blue-600 dark:text-blue-400"},Q={key:1,class:"text-sm text-gray-500 dark:text-gray-400 mt-1"},X={key:2,class:"text-lg text-gray-500 dark:text-gray-400 animate-pulse"},ee={key:0,class:"p-6"},te=["disabled"],se=["disabled"],oe={key:0,class:"text-sm text-center p-2 rounded-md bg-red-100 dark:bg-red-900/50 text-red-700 dark:text-red-300"},re=["disabled"],ae={key:1,class:"p-6 space-y-4"},ne={class:"text-sm text-center"},le={class:"font-medium"},ie={key:0},de={class:"text-sm text-gray-600 dark:text-gray-300 mb-2"},ue={class:"font-semibold text-gray-800 dark:text-gray-100"},ce={class:"text-sm list-disc list-inside bg-gray-50 dark:bg-gray-700/50 p-3 rounded-md space-y-1"},ge={key:1,class:"text-sm text-center text-gray-500 dark:text-gray-400"},pe=["disabled"],fe={key:2,class:"p-6 text-center space-y-4"},me={class:"text-sm text-gray-600 dark:text-gray-300"},he={__name:"SsoLoginView",setup(ve){const O=E(),d=C(),p=O.params.clientId,c=i({}),f=i(!0),b=i(!1),h=i(""),x=i(""),w=i(""),l=i(!1),m=i(""),_=i(!1);function A(s){return s.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase())}async function z(){var s,e,n,a;console.log(`[SSO LOG] Fetching details for client_id: ${p}`);try{const v=await P.get(`/api/sso/app_details/${p}`);c.value=v.data,console.log("[SSO LOG] App details received:",v.data)}catch(v){console.error("[SSO LOG] Error fetching app details:",((e=(s=v.response)==null?void 0:s.data)==null?void 0:e.detail)||v.message),h.value=((a=(n=v.response)==null?void 0:n.data)==null?void 0:a.detail)||"This application is not configured for SSO."}finally{f.value=!1}}async function $(){var s,e;l.value=!0,m.value="",console.log(`[SSO LOG] Attempting login for user '${x.value}' to authorize client '${p}'.`);try{const n=await d.ssoLoginWithPassword(p,x.value,w.value);if(n!=null&&n.redirect_uri){_.value=!0;const a=`${n.redirect_uri}?token=${n.access_token}`;console.log(`[SSO LOG] Login successful. Redirecting to: ${a}`),window.location.href=a}else throw new Error("Redirect URI not found after login.")}catch(n){m.value=((e=(s=n.response)==null?void 0:s.data)==null?void 0:e.detail)||"Login failed. Please check your credentials.",console.error("[SSO LOG] Login failed:",m.value)}finally{l.value=!1}}async function G(){l.value=!0,m.value="",console.log(`[SSO LOG] Authorizing client '${p}' for logged-in user '${d.user.username}'.`);try{const s=await d.ssoAuthorizeApplication(p);if(s!=null&&s.redirect_uri){_.value=!0;const e=`${s.redirect_uri}?token=${s.access_token}`;console.log(`[SSO LOG] Authorization successful. Redirecting to: ${e}`),window.location.href=e}else throw new Error("Redirect URI not found after authorization.")}catch(s){h.value="Failed to authorize the application. Please try again.",console.error("[SSO LOG] Authorization failed:",s)}finally{l.value=!1}}function U(){console.log("[SSO LOG] User chose to logout and switch account."),d.logout()}return M(()=>{console.log("[SSO LOG] SSO Login View mounted."),d.attemptInitialAuth().then(()=>{z()})}),(s,e)=>{const n=H("router-link");return r(),o("div",F,[t("div",N,[t("div",T,[t("div",D,[e[4]||(e[4]=t("img",{src:q,alt:"LoLLMs Logo",class:"h-12 w-12"},null,-1)),e[5]||(e[5]=t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 text-gray-300 dark:text-gray-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 7l5 5m0 0l-5 5m5-5H6"})],-1)),t("div",W,[c.value.icon&&!b.value?(r(),o("img",{key:0,src:c.value.icon,onError:e[0]||(e[0]=a=>b.value=!0),alt:"App Icon",class:"h-full w-full object-cover"},null,40,Y)):(r(),o("svg",Z,e[3]||(e[3]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M21.75 17.25v-.228a4.5 4.5 0 0 0-.12-1.03l-2.268-9.64a3.375 3.375 0 0 0-3.285-2.602H7.923a3.375 3.375 0 0 0-3.285 2.602l-2.268 9.64a4.5 4.5 0 0 0-.12 1.03v.228m19.5 0a3 3 0 0 1-3 3H5.25a3 3 0 0 1-3-3m19.5 0a3 3 0 0 0-3-3H5.25a3 3 0 0 0-3 3m16.5 0h.008v.008h-.008v-.008Z"},null,-1)])))])]),f.value?g("",!0):(r(),o("h1",J,[e[6]||(e[6]=y(" Login to ")),t("span",K,u(c.value.name),1)])),f.value?g("",!0):(r(),o("p",Q,"with your LoLLMs Account")),f.value?(r(),o("p",X,"Loading Application Details...")):g("",!0)]),!f.value&&!k(d).isAuthenticated?(r(),o("div",ee,[t("form",{onSubmit:V($,["prevent"]),class:"space-y-4"},[t("div",null,[e[7]||(e[7]=t("label",{for:"sso-username",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Username",-1)),L(t("input",{"onUpdate:modelValue":e[1]||(e[1]=a=>x.value=a),type:"text",id:"sso-username",required:"",class:"input-field mt-1 w-full",disabled:l.value},null,8,te),[[S,x.value]])]),t("div",null,[e[8]||(e[8]=t("label",{for:"sso-password",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Password",-1)),L(t("input",{"onUpdate:modelValue":e[2]||(e[2]=a=>w.value=a),type:"password",id:"sso-password",required:"",class:"input-field mt-1 w-full",disabled:l.value},null,8,se),[[S,w.value]])]),m.value?(r(),o("div",oe,u(m.value),1)):g("",!0),t("button",{type:"submit",class:"btn btn-primary w-full",disabled:l.value},u(l.value?"Logging In...":"Login & Authorize"),9,re)],32)])):g("",!0),!f.value&&k(d).isAuthenticated&&!_.value?(r(),o("div",ae,[t("p",ne,[e[9]||(e[9]=y("You are logged in as ")),t("strong",le,u(k(d).user.username),1),e[10]||(e[10]=y("."))]),c.value.sso_user_infos_to_share.length>0?(r(),o("div",ie,[t("p",de,[t("strong",ue,u(c.value.name),1),e[11]||(e[11]=y(" is requesting access to the following information: "))]),t("ul",ce,[e[12]||(e[12]=t("li",null,"Username",-1)),(r(!0),o(j,null,I(c.value.sso_user_infos_to_share,a=>(r(),o("li",{key:a},u(A(a)),1))),128))])])):(r(),o("p",ge," This application has not requested any personal information beyond your username. ")),t("button",{onClick:G,class:"btn btn-primary w-full",disabled:l.value},u(l.value?"Authorizing...":"Authorize"),9,pe),t("button",{onClick:U,class:"btn btn-secondary w-full"},"Logout & Switch Account")])):g("",!0),h.value?(r(),o("div",fe,[e[14]||(e[14]=t("h2",{class:"text-lg font-bold text-red-600 dark:text-red-400"},"Error",-1)),t("p",me,u(h.value),1),R(n,{to:"/",class:"btn btn-secondary"},{default:B(()=>e[13]||(e[13]=[y("Go to Homepage")])),_:1})])):g("",!0)])])}}};export{he as default};
