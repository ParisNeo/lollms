import{S as Me,O as Re,L as Se,x as Ce,s as K,r as M,j as p,w as R,o as $e,c as i,b as o,g as s,d as m,n as Q,h as f,l as _,v as A,V as _e,F as w,i as h,t as y,B as F,e as J,k as L,A as N,bM as W,f as Ae,M as Te,E as Ie}from"./index-BG8jdxtl.js";import Ue from"./IconArrowUp-BtkXeAzm.js";import Pe from"./IconArrowDown-CScJbOFS.js";import{A as De}from"./AppCard-CwlBfHZp.js";import{A as Ve}from"./AppCardSkeleton-CofqKgkK.js";import"./IconArrowUpCircle-Bj4cFoYf.js";import"./IconGlobeAlt-B0tLXZlh.js";import"./IconPlayCircle-DFvX5Gc1.js";import"./IconWrenchScrewdriver-DL4SqmBF.js";const Ze={class:"space-y-6"},Fe={class:"border-b border-gray-200 dark:border-gray-700"},Le={class:"-mb-px flex space-x-6","aria-label":"Sub Tabs"},Ne={key:0},ze={class:"space-y-4"},Be={class:"grid grid-cols-1 lg:grid-cols-4 gap-4"},Oe={class:"relative lg:col-span-1"},je={class:"grid grid-cols-1 sm:grid-cols-3 lg:col-span-3 gap-4"},qe=["value"],Ee=["value"],He={class:"flex items-center gap-2"},Ke=["value"],Qe={key:0,class:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 2xl:grid-cols-4 gap-6"},Je={key:1,class:"empty-state-card"},We={key:2},Ge={class:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 2xl:grid-cols-4 gap-6"},Xe={key:0,class:"flex justify-between items-center mt-6"},Ye=["disabled"],et={class:"text-sm text-gray-600 dark:text-gray-400"},tt=["disabled"],at={key:1},st={class:"flex justify-between items-center mb-4 flex-wrap gap-2"},lt={key:0,class:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm mb-6"},ot={class:"flex items-center gap-x-4"},nt={key:0},it=["required"],rt={key:1},dt=["required"],ut={key:1,class:"text-center p-4"},pt={key:2,class:"empty-state-card"},ct={key:3,class:"space-y-4"},vt={class:"font-semibold"},ft={class:"text-sm text-gray-500"},gt={class:"text-xs text-gray-400"},yt={class:"flex items-center gap-2"},mt=["onClick"],bt=["onClick"],wt={__name:"McpsManagement",setup(ht){const n=Re(),z=Se(),u=Ce(),{mcpFilters:d}=n,{mcpZooRepositories:B,isLoadingMcpZooRepositories:G,zooMcps:S,isLoadingZooMcps:X}=K(n),{tasks:Y}=K(z),g=M("zoo"),r=M({type:"git",name:"",url:"",path:""}),x=M(!1),v=M(null),k=M(JSON.parse(localStorage.getItem("starredMcps")||"[]"));let O=null;const T=p({get:()=>d.searchQuery,set:e=>{d.searchQuery=e}}),I=p({get:()=>d.selectedCategory,set:e=>{d.selectedCategory=e}}),U=p({get:()=>d.installationStatusFilter,set:e=>{d.installationStatusFilter=e}}),P=p({get:()=>d.selectedRepository,set:e=>{d.selectedRepository=e}}),D=p({get:()=>d.sortKey,set:e=>{d.sortKey=e}}),C=p({get:()=>d.sortOrder,set:e=>{d.sortOrder=e}}),c=p({get:()=>d.currentPage,set:e=>{d.currentPage=e}}),j=p({get:()=>d.pageSize,set:e=>{d.pageSize=e}}),ee=[{value:"last_update_date",label:"Last Updated"},{value:"creation_date",label:"Creation Date"},{value:"name",label:"Name"},{value:"author",label:"Author"}],V=p(()=>S.value.total||0),q=p(()=>S.value.pages||1),te=p(()=>{if(V.value===0)return"Showing 0-0 of 0";const e=(c.value-1)*j.value+1,t=Math.min(c.value*j.value,V.value);return`Showing ${e}-${t} of ${V.value}`});function ae(){clearTimeout(O),O=setTimeout(()=>{c.value!==1?c.value=1:n.fetchZooMcps()},300)}R([D,C,I,U,P],()=>{c.value!==1?c.value=1:n.fetchZooMcps()}),R(T,ae),R(c,n.fetchZooMcps),R(k,e=>{localStorage.setItem("starredMcps",JSON.stringify(e))},{deep:!0}),R(g,e=>{e==="zoo"&&n.fetchZooMcps(),e==="source"&&n.fetchMcpZooRepositories()}),$e(()=>{g.value==="zoo"&&n.fetchZooMcps(),g.value==="source"&&n.fetchMcpZooRepositories()});const Z=p(()=>{const e=new Map,t="Installing MCP: ",a=/^(Updating app|Start app|Stop app|Fixing item|Purging item): .* \(([a-fA-F0-9-]+)\)$/;return(Y.value||[]).forEach(l=>{if(l!=null&&l.name&&(l.status==="running"||l.status==="pending")){let b;if(l.name.startsWith(t))b=`folder:${l.name.replace(t,"")}`;else{const H=l.name.match(a);H&&(b=`id:${H[2]}`)}b&&(!e.has(b)||new Date(l.created_at)>new Date(e.get(b).created_at))&&e.set(b,l)}}),(S.value.items||[]).map(l=>({...l,task:e.get(`folder:${l.folder_name}`)||(l.id?e.get(`id:${l.id}`):null)}))}),$=p(()=>Array.isArray(B.value)?[...B.value].sort((e,t)=>(e.name||"").localeCompare(t.name||"")):[]),se=p(()=>["All","Starred",...S.value.categories||[]]);function le(e){const t=k.value.indexOf(e);t>-1?k.value.splice(t,1):k.value.push(e)}function oe(e){return e?new Date(e).toLocaleString():"Never"}async function ne(){if(!r.value.name){u.addNotification("Repository name is required.","warning");return}const e={name:r.value.name};r.value.type==="git"?e.url=r.value.url:e.path=r.value.path,v.value="add";try{await n.addMcpZooRepository(e),r.value={type:"git",name:"",url:"",path:""},x.value=!1}finally{v.value=null}}async function ie(e){v.value=e.id;try{await n.pullMcpZooRepository(e.id)}finally{v.value=null}}async function re(e){if(await u.showConfirmation({title:`Delete Repository '${e.name}'?`})){v.value=e.id;try{await n.deleteMcpZooRepository(e.id)}finally{v.value=null}}}function de(e){u.openModal("appInstall",{app:e,type:"mcps"})}async function ue(e){await u.showConfirmation({title:`Update '${e.name}'?`,confirmText:"Update"})&&await n.updateApp(e.id)}async function E(e,t){v.value=`${t}-${e}`;try{t==="start"&&await n.startApp(e),t==="stop"&&await n.stopApp(e)}finally{v.value=null}}async function pe(e){if(await u.showConfirmation({title:`Uninstall '${e.name}'?`,confirmText:"Uninstall"})){v.value=`uninstall-${e.id}`;try{await n.uninstallApp(e.id)}finally{v.value=null}}}function ce(e){e.is_installed?u.openModal("appConfig",{app:e}):e.repository==="Registered"&&u.openModal("serviceRegistration",{item:e,itemType:"mcp",ownerType:e.type||"system",onRegistered:n.fetchZooMcps})}async function ve(e){await u.showConfirmation({title:`Delete Registration for '${e.name}'?`,message:"This will remove the manually registered entry but will not affect the service itself.",confirmText:"Delete"})&&await n.deleteRegisteredMcp(e.id)}function fe(e){u.openModal("appLog",{app:e})}async function ge(e){const t=await n.fetchMcpReadme(e.repository,e.folder_name);u.openModal("sourceViewer",{title:`README: ${e.name}`,content:t,language:"markdown"})}async function ye(e){await z.cancelTask(e)}function me(e){u.openModal("tasksManager",{initialTaskId:e})}async function be(){await n.syncInstallations()}async function we(e){await u.showConfirmation({title:`Purge '${e.name}'?`,message:"This will permanently delete the installation folder.",confirmText:"Purge"})&&await n.purgeBrokenInstallation({...e,item_type:"mcp"})}async function he(e){await u.showConfirmation({title:`Fix '${e.name}'?`,message:"This will attempt to re-create the database entry for this item.",confirmText:"Fix"})&&await n.fixBrokenInstallation({...e,item_type:"mcp"})}function xe(e){u.openModal("appDetails",{app:e})}function ke(){u.openModal("serviceRegistration",{itemType:"mcp",ownerType:"system",onRegistered:n.fetchZooMcps})}return(e,t)=>(o(),i("div",Ze,[s("div",Fe,[s("nav",Le,[s("button",{onClick:t[0]||(t[0]=a=>g.value="zoo"),class:Q(["tab-button",g.value==="zoo"?"active":"inactive"])},"Zoo",2),s("button",{onClick:t[1]||(t[1]=a=>g.value="source"),class:Q(["tab-button",g.value==="source"?"active":"inactive"])},"Repositories",2)])]),g.value==="zoo"?(o(),i("section",Ne,[s("div",{class:"flex justify-between items-center mb-4 flex-wrap gap-2"},[t[16]||(t[16]=s("h3",{class:"text-xl font-semibold"},"MCP Zoo",-1)),s("div",{class:"flex items-center gap-2"},[s("button",{onClick:ke,class:"btn btn-secondary"},"Register External MCP"),s("button",{onClick:be,class:"btn btn-secondary-outline",title:"Repair broken installations and remove orphaned DB entries."},"Sync Installations")])]),s("div",ze,[s("div",Be,[s("div",Oe,[f(s("input",{type:"text","onUpdate:modelValue":t[2]||(t[2]=a=>T.value=a),placeholder:"Search MCPs...",class:"input-field w-full pl-10"},null,512),[[_,T.value]]),t[17]||(t[17]=s("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[s("svg",{class:"h-5 w-5 text-gray-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})])],-1))]),s("div",je,[f(s("select",{"onUpdate:modelValue":t[3]||(t[3]=a=>U.value=a),class:"input-field"},t[18]||(t[18]=[_e('<option value="All" data-v-fa70298c>All Statuses</option><option value="Installed" data-v-fa70298c>Installed</option><option value="Uninstalled" data-v-fa70298c>Uninstalled</option><option value="Registered" data-v-fa70298c>Registered</option><option value="Broken" data-v-fa70298c>Broken</option>',5)]),512),[[A,U.value]]),f(s("select",{"onUpdate:modelValue":t[4]||(t[4]=a=>I.value=a),class:"input-field"},[(o(!0),i(w,null,h(se.value,a=>(o(),i("option",{key:a,value:a},y(a),9,qe))),128))],512),[[A,I.value]]),f(s("select",{"onUpdate:modelValue":t[5]||(t[5]=a=>P.value=a),class:"input-field"},[t[19]||(t[19]=s("option",{value:"All"},"All Sources",-1)),t[20]||(t[20]=s("option",{value:"Registered"},"Registered",-1)),(o(!0),i(w,null,h($.value,a=>(o(),i("option",{key:a.id,value:a.name},y(a.name),9,Ee))),128))],512),[[A,P.value]])])]),s("div",He,[f(s("select",{"onUpdate:modelValue":t[6]||(t[6]=a=>D.value=a),class:"input-field w-48"},[(o(),i(w,null,h(ee,a=>s("option",{key:a.value,value:a.value},"Sort by "+y(a.label),9,Ke)),64))],512),[[A,D.value]]),s("button",{onClick:t[7]||(t[7]=a=>C.value=C.value==="asc"?"desc":"asc"),class:"btn btn-secondary p-2"},[C.value==="asc"?(o(),F(Ue,{key:0,class:"w-5 h-5"})):(o(),F(Pe,{key:1,class:"w-5 h-5"}))])]),J(X)?(o(),i("div",Qe,[(o(),i(w,null,h(8,a=>L(Ve,{key:a})),64))])):!Z.value||Z.value.length===0?(o(),i("div",Je,t[21]||(t[21]=[s("h4",{class:"font-semibold"},"No MCPs Found",-1)]))):(o(),i("div",We,[s("div",Ge,[(o(!0),i(w,null,h(Z.value,a=>(o(),F(De,{key:a.id||`${a.repository}/${a.folder_name}`,app:a,task:a.task,"is-starred":k.value.includes(a.name),"item-type-name":"MCP",onStar:l=>le(a.name),onInstall:l=>de(a),onUpdate:l=>ue(a),onUninstall:l=>pe(a),onDelete:l=>ve(a),onHelp:l=>ge(a),onViewTask:me,onCancelInstall:l=>ye(a.task.id),onStart:l=>E(a.id,"start"),onStop:l=>E(a.id,"stop"),onConfigure:l=>ce(a),onFix:l=>he(a),onPurge:l=>we(a),onDetails:xe,onLogs:l=>fe(a)},null,8,["app","task","is-starred","onStar","onInstall","onUpdate","onUninstall","onDelete","onHelp","onCancelInstall","onStart","onStop","onConfigure","onFix","onPurge","onLogs"]))),128))]),q.value>1?(o(),i("div",Xe,[s("button",{onClick:t[8]||(t[8]=a=>c.value--),disabled:c.value===1,class:"btn btn-secondary"},"Previous",8,Ye),s("span",et,y(te.value),1),s("button",{onClick:t[9]||(t[9]=a=>c.value++),disabled:c.value>=q.value,class:"btn btn-secondary"},"Next",8,tt)])):m("",!0)]))])])):m("",!0),g.value==="source"?(o(),i("section",at,[s("div",st,[t[22]||(t[22]=s("h3",{class:"text-xl font-semibold"},"MCP Zoo Repositories",-1)),s("button",{onClick:t[10]||(t[10]=a=>x.value=!x.value),class:"btn btn-primary"},y(x.value?"Cancel":"Add Repository"),1)]),x.value?(o(),i("div",lt,[s("form",{onSubmit:Ae(ne,["prevent"]),class:"space-y-4"},[s("div",ot,[s("label",null,[f(s("input",{type:"radio","onUpdate:modelValue":t[11]||(t[11]=a=>r.value.type=a),value:"git",class:"radio-input"},null,512),[[W,r.value.type]]),t[23]||(t[23]=N(" Git"))]),s("label",null,[f(s("input",{type:"radio","onUpdate:modelValue":t[12]||(t[12]=a=>r.value.type=a),value:"local",class:"radio-input"},null,512),[[W,r.value.type]]),t[24]||(t[24]=N(" Local"))])]),s("div",null,[t[25]||(t[25]=s("label",null,"Name",-1)),f(s("input",{"onUpdate:modelValue":t[13]||(t[13]=a=>r.value.name=a),type:"text",class:"input-field",required:""},null,512),[[_,r.value.name]])]),r.value.type==="git"?(o(),i("div",nt,[t[26]||(t[26]=s("label",null,"URL",-1)),f(s("input",{"onUpdate:modelValue":t[14]||(t[14]=a=>r.value.url=a),type:"url",class:"input-field",required:r.value.type==="git"},null,8,it),[[_,r.value.url]])])):m("",!0),r.value.type==="local"?(o(),i("div",rt,[t[27]||(t[27]=s("label",null,"Path",-1)),f(s("input",{"onUpdate:modelValue":t[15]||(t[15]=a=>r.value.path=a),type:"text",class:"input-field",required:r.value.type==="local"},null,8,dt),[[_,r.value.path]])])):m("",!0),t[28]||(t[28]=s("div",{class:"flex justify-end"},[s("button",{type:"submit",class:"btn btn-primary"},"Add")],-1))],32)])):m("",!0),J(G)?(o(),i("div",ut,"Loading...")):!$.value||$.value.length===0?(o(),i("div",pt,t[29]||(t[29]=[s("p",null,"No repositories added.",-1)]))):(o(),i("div",ct,[(o(!0),i(w,null,h($.value,a=>(o(),i("div",{key:a.id,class:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm flex items-center justify-between"},[s("div",null,[s("p",vt,y(a.name),1),s("p",ft,y(a.url),1),s("p",gt,"Pulled: "+y(oe(a.last_pulled_at)),1)]),s("div",yt,[s("button",{onClick:l=>ie(a),class:"btn btn-secondary btn-sm"},[L(Te,{class:"w-4 h-4 mr-1"}),N(y(a.type==="git"?"Pull":"Rescan"),1)],8,mt),a.is_deletable?(o(),i("button",{key:0,onClick:l=>re(a),class:"btn btn-danger btn-sm"},[L(Ie,{class:"w-4 h-4"})],8,bt)):m("",!0)])]))),128))]))])):m("",!0)]))}},Tt=Me(wt,[["__scopeId","data-v-fa70298c"]]);export{Tt as default};
