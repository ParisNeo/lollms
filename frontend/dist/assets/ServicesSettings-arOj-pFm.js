import{z as ae,n as se,a as le,u as ne,s as z,r as u,o as oe,w as ie,c as w,b as o,e as n,f as t,h as re,i as c,y as U,A as de,d as b,t as x,g as ue,v as j,l as g,B as ce,q as pe,k as ve,T as me,C as F,p as L,F as P,x as N}from"./index-BZDc2BnE.js";import{_ as R}from"./McpCard-DNumtVOh.js";import{_ as ye,a as ge}from"./IconEyeOff-DRVZD49w.js";const fe={class:"space-y-10"},be={class:"border-b border-gray-200 dark:border-gray-700"},xe={class:"-mb-px flex space-x-6","aria-label":"Tabs"},he={key:0,class:"bg-white dark:bg-gray-800 shadow-md rounded-lg"},ke={class:"px-4 py-5 sm:p-6"},_e={class:"text-xl font-bold leading-6 text-gray-900 dark:text-white capitalize"},we={class:"mt-1 max-w-2xl text-sm text-gray-500 dark:text-gray-400"},Ae={class:"border-t border-gray-200 dark:border-gray-700"},Me={class:"grid grid-cols-1 sm:grid-cols-2 gap-6"},Ce=["placeholder"],Se=["placeholder"],$e={class:"mt-2 flex items-center gap-x-4"},Te={class:"h-16 w-16 rounded-md bg-gray-200 dark:bg-gray-700 flex items-center justify-center overflow-hidden"},Ie=["src"],De={class:"flex-grow space-y-2"},Ee={class:"flex items-center gap-x-3"},Ue={class:"flex items-center justify-between bg-gray-50 dark:bg-gray-700/50 p-3 rounded-md"},Fe={class:"space-y-4"},Le={key:0,class:"mt-1 text-xs text-gray-500 dark:text-gray-400"},Pe={key:1,class:"relative"},Ne=["type"],Re={class:"flex justify-end items-center gap-x-3 pt-2"},He=["disabled"],Ve={class:"flex justify-between items-center mb-4 flex-wrap gap-4"},je={class:"flex items-center gap-x-3"},Xe={key:0,class:"empty-state-card"},Be={key:1,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5"},Ge={class:"flex justify-between items-center my-4 flex-wrap gap-4"},We=["disabled"],qe={key:0,class:"empty-state-card"},Ke={key:1,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5"},Ye={class:"flex justify-between items-center mb-4 flex-wrap gap-4"},ze={class:"flex items-center gap-x-3"},Oe={key:0,class:"empty-state-card"},Je={key:1,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5"},Qe={key:0,class:"empty-state-card"},Ze={key:1,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5"},et={__name:"ServicesSettings",setup(tt){const d=se(),f=le(),O=ne(),{userMcps:X,userApps:B}=z(d),{user:A}=z(O),i=u("mcps"),H=(a="mcps",e="user")=>({name:"",url:"",icon:"",active:!0,type:e,authentication_type:"none",authentication_key:""}),s=u(H()),y=u(null),M=u(!1),C=u(!1),h=u(!1),G=u(null),V=u(!1),S=u(!1);oe(()=>{d.fetchMcps(),d.fetchApps()}),ie(()=>s.value.icon,()=>{V.value=!1});const k=w(()=>y.value!==null),W=w(()=>X.value.filter(a=>a.type==="user").sort((a,e)=>a.name.localeCompare(e.name))),q=w(()=>X.value.filter(a=>a.type==="system").sort((a,e)=>a.name.localeCompare(e.name))),K=w(()=>B.value.filter(a=>a.type==="user").sort((a,e)=>a.name.localeCompare(e.name))),Y=w(()=>B.value.filter(a=>a.type==="system").sort((a,e)=>a.name.localeCompare(e.name)));function $(a,e="user"){k.value&&I(),i.value=a,s.value=H(a,e),S.value=!0,window.scrollTo({top:0,behavior:"smooth"})}function T(a,e){i.value=e,y.value={...a,_type:e},s.value.name=a.name,s.value.url=a.url,s.value.icon=a.icon||"",s.value.active=typeof a.active=="boolean"?a.active:!0,s.value.type=a.type||"user",s.value.authentication_type=a.authentication_type||"none",s.value.authentication_key=a.authentication_key||"",S.value=!0,window.scrollTo({top:0,behavior:"smooth"})}function I(){y.value=null,s.value=H(i.value),h.value=!1,S.value=!1}function J(){V.value=!0}async function Q(){C.value=!0;try{await d.triggerMcpReload()}finally{C.value=!1}}async function Z(){if(!s.value.name||!s.value.url){f.addNotification("Name and URL are required.","warning");return}M.value=!0;try{const a={name:s.value.name,url:s.value.url,icon:s.value.icon||null,active:s.value.active,type:s.value.type,authentication_type:s.value.authentication_type,authentication_key:s.value.authentication_key||""},e=i.value==="apps";k.value?await(e?d.updateApp(y.value.id,a):d.updateMcp(y.value.id,a)):await(e?d.addApp(a):d.addMcp(a)),I()}finally{M.value=!1}}async function D(a,e){await f.showConfirmation({title:`Delete '${a.name}'?`,message:`Are you sure you want to remove this ${e==="mcps"?"MCP server":"Application"}? This cannot be undone.`,confirmText:"Delete"})&&(y.value&&y.value.id===a.id&&I(),await(e==="apps"?d.deleteApp(a.id):d.deleteMcp(a.id)))}function ee(){G.value.click()}function te(a){const e=a.target.files[0];if(!e)return;if(!["image/jpeg","image/png","image/gif","image/webp","image/svg+xml"].includes(e.type)){f.addNotification("Invalid file type. Please select an image.","error");return}if(e.type==="image/svg+xml"){const _=new FileReader;_.onload=p=>{s.value.icon=p.target.result},_.onerror=()=>{f.addNotification("Failed to read the SVG file.","error")},_.readAsDataURL(e),a.target.value="";return}const r=new FileReader;r.onload=_=>{const p=new Image;p.onload=()=>{let v=p.width,m=p.height;v>m?v>128&&(m=Math.round(m*(128/v)),v=128):m>128&&(v=Math.round(v*(128/m)),m=128);const E=document.createElement("canvas");E.width=v,E.height=m,E.getContext("2d").drawImage(p,0,0,v,m),s.value.icon=E.toDataURL("image/png")},p.onerror=()=>{f.addNotification("Failed to load image for processing.","error")},p.src=_.target.result},r.onerror=()=>{f.addNotification("Failed to read the file.","error")},r.readAsDataURL(e),a.target.value=""}return(a,e)=>(n(),o("div",fe,[t("div",be,[t("nav",xe,[t("button",{onClick:e[0]||(e[0]=l=>i.value="mcps"),class:U(["tab-button",i.value==="mcps"?"active":"inactive"])}," MCP Servers ",2),t("button",{onClick:e[1]||(e[1]=l=>i.value="apps"),class:U(["tab-button",i.value==="apps"?"active":"inactive"])}," Applications ",2)])]),re(me,{name:"form-fade"},{default:de(()=>[S.value?(n(),o("div",he,[t("div",ke,[t("h2",_e,x(k.value?"Edit":"Add")+" "+x(s.value.type)+" "+x(i.value==="mcps"?"MCP Server":"Application"),1),t("p",we,x(s.value.type==="user"?"This is only available to you.":"This is available to all users."),1)]),t("div",Ae,[t("form",{onSubmit:ue(Z,["prevent"]),class:"p-4 sm:p-6 space-y-6"},[t("div",Me,[t("div",null,[e[15]||(e[15]=t("label",{for:"formName",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Name",-1)),c(t("input",{type:"text",id:"formName","onUpdate:modelValue":e[2]||(e[2]=l=>s.value.name=l),class:"input-field mt-1",placeholder:i.value==="mcps"?"My Local Server":"My Web App",required:""},null,8,Ce),[[j,s.value.name]])]),t("div",null,[e[16]||(e[16]=t("label",{for:"formUrl",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"URL",-1)),c(t("input",{type:"url",id:"formUrl","onUpdate:modelValue":e[3]||(e[3]=l=>s.value.url=l),class:"input-field mt-1",placeholder:i.value==="mcps"?"http://127.0.0.1:9602":"https://example.com",required:""},null,8,Se),[[j,s.value.url]])])]),t("div",null,[e[17]||(e[17]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Icon (Optional)",-1)),t("div",$e,[t("div",Te,[s.value.icon&&!V.value?(n(),o("img",{key:0,src:s.value.icon,onError:J,alt:"Icon Preview",class:"h-full w-full object-cover"},null,40,Ie)):(n(),g(ce,{key:1,class:"w-8 h-8 text-gray-500 dark:text-gray-400"}))]),t("div",De,[c(t("input",{type:"text","onUpdate:modelValue":e[4]||(e[4]=l=>s.value.icon=l),class:"input-field",placeholder:"Paste image URL or upload a file"},null,512),[[j,s.value.icon]]),t("div",Ee,[t("button",{onClick:ee,type:"button",class:"btn btn-secondary text-sm"},"Upload File"),s.value.icon?(n(),o("button",{key:0,onClick:e[5]||(e[5]=l=>s.value.icon=""),type:"button",class:"text-sm font-medium text-red-600 hover:text-red-500"},"Remove")):b("",!0)])])]),t("input",{type:"file",ref_key:"fileInput",ref:G,onChange:te,class:"hidden",accept:"image/png, image/jpeg, image/gif, image/webp, image/svg+xml"},null,544)]),t("div",Ue,[e[18]||(e[18]=t("span",{class:"flex-grow flex flex-col"},[t("span",{class:"text-sm font-medium text-gray-900 dark:text-gray-100"},"Active"),t("span",{class:"text-sm text-gray-500 dark:text-gray-400"},"Inactive items cannot be used.")],-1)),t("button",{onClick:e[6]||(e[6]=l=>s.value.active=!s.value.active),type:"button",class:U([s.value.active?"bg-blue-600":"bg-gray-200 dark:bg-gray-600","relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800"])},[t("span",{class:U([s.value.active?"translate-x-5":"translate-x-0","pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out"])},null,2)],2)]),t("fieldset",Fe,[e[21]||(e[21]=t("legend",{class:"text-sm font-medium text-gray-700 dark:text-gray-300"},"Authentication",-1)),c(t("select",{id:"formAuthType","onUpdate:modelValue":e[7]||(e[7]=l=>s.value.authentication_type=l),class:"input-field"},e[19]||(e[19]=[t("option",{value:"none"},"None",-1),t("option",{value:"lollms_chat_auth"},"LoLLMs Chat Auth",-1),t("option",{value:"bearer"},"Bearer Token",-1)]),512),[[pe,s.value.authentication_type]]),s.value.authentication_type==="lollms_chat_auth"?(n(),o("p",Le," A temporary token will be generated by LoLLMs for each session. ")):b("",!0),s.value.authentication_type==="bearer"?(n(),o("div",Pe,[e[20]||(e[20]=t("label",{for:"formKey",class:"sr-only"},"Authentication Key",-1)),c(t("input",{type:h.value?"text":"password",id:"formKey","onUpdate:modelValue":e[8]||(e[8]=l=>s.value.authentication_key=l),class:"input-field pr-10",placeholder:"Paste your Bearer token here"},null,8,Ne),[[ve,s.value.authentication_key]]),t("button",{type:"button",onClick:e[9]||(e[9]=l=>h.value=!h.value),class:"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600 dark:hover:text-gray-200"},[h.value?(n(),g(ye,{key:0,class:"w-5 h-5"})):(n(),g(ge,{key:1,class:"w-5 h-5"}))])])):b("",!0)]),t("div",Re,[t("button",{onClick:I,type:"button",class:"btn btn-secondary"},"Cancel"),t("button",{type:"submit",class:"btn btn-primary",disabled:M.value},x(M.value?k.value?"Saving...":"Adding...":k.value?"Save Changes":`Add ${i.value==="mcps"?"MCP":"App"}`),9,He)])],32)])])):b("",!0)]),_:1}),c(t("section",null,[t("div",Ve,[e[22]||(e[22]=t("h3",{class:"text-xl font-bold leading-6 text-gray-900 dark:text-white"},"Your Personal MCPs",-1)),t("div",je,[t("button",{onClick:e[10]||(e[10]=l=>$("mcps","user")),class:"btn btn-primary text-sm"},"+ Add Personal Server"),L(A).is_admin?(n(),o("button",{key:0,onClick:e[11]||(e[11]=l=>$("mcps","system")),class:"btn btn-secondary text-sm"},"+ Add System Server")):b("",!0)])]),W.value.length===0?(n(),o("div",Xe,e[23]||(e[23]=[t("p",null,"You haven't added any personal MCP servers yet.",-1)]))):(n(),o("div",Be,[(n(!0),o(P,null,N(W.value,l=>(n(),g(R,{key:l.id,mcp:l,"is-editable":"",onEdit:r=>T(l,"mcps"),onDelete:r=>D(l,"mcps")},null,8,["mcp","onEdit","onDelete"]))),128))]))],512),[[F,i.value==="mcps"]]),c(t("section",null,[t("div",Ge,[e[24]||(e[24]=t("h3",{class:"text-xl font-bold leading-6 text-gray-900 dark:text-white"},"System MCPs",-1)),t("button",{onClick:e[12]||(e[12]=l=>Q()),class:"btn btn-secondary text-sm",disabled:C.value},x(C.value?"Reloading...":"Reload All Servers"),9,We)]),q.value.length===0?(n(),o("div",qe,e[25]||(e[25]=[t("p",null,"No system-wide MCP servers are available.",-1)]))):(n(),o("div",Ke,[(n(!0),o(P,null,N(q.value,l=>(n(),g(R,{key:l.id,mcp:l,"is-editable":L(A).is_admin,onEdit:r=>T(l,"mcps"),onDelete:r=>D(l,"mcps")},null,8,["mcp","is-editable","onEdit","onDelete"]))),128))]))],512),[[F,i.value==="mcps"]]),c(t("section",null,[t("div",Ye,[e[26]||(e[26]=t("h3",{class:"text-xl font-bold leading-6 text-gray-900 dark:text-white"},"Your Personal Apps",-1)),t("div",ze,[t("button",{onClick:e[13]||(e[13]=l=>$("apps","user")),class:"btn btn-primary text-sm"},"+ Add Personal App"),L(A).is_admin?(n(),o("button",{key:0,onClick:e[14]||(e[14]=l=>$("apps","system")),class:"btn btn-secondary text-sm"},"+ Add System App")):b("",!0)])]),K.value.length===0?(n(),o("div",Oe,e[27]||(e[27]=[t("p",null,"You haven't added any personal Apps yet.",-1)]))):(n(),o("div",Je,[(n(!0),o(P,null,N(K.value,l=>(n(),g(R,{key:l.id,mcp:l,"is-editable":"",onEdit:r=>T(l,"apps"),onDelete:r=>D(l,"apps")},null,8,["mcp","onEdit","onDelete"]))),128))]))],512),[[F,i.value==="apps"]]),c(t("section",null,[e[29]||(e[29]=t("h3",{class:"text-xl font-bold leading-6 text-gray-900 dark:text-white my-4"},"System Apps",-1)),Y.value.length===0?(n(),o("div",Qe,e[28]||(e[28]=[t("p",null,"No system-wide Apps are available.",-1)]))):(n(),o("div",Ze,[(n(!0),o(P,null,N(Y.value,l=>(n(),g(R,{key:l.id,mcp:l,"is-editable":L(A).is_admin,onEdit:r=>T(l,"apps"),onDelete:r=>D(l,"apps")},null,8,["mcp","is-editable","onEdit","onDelete"]))),128))]))],512),[[F,i.value==="apps"]])]))}},rt=ae(et,[["__scopeId","data-v-ac040f5b"]]);export{rt as default};
