import{B as de,q as ue,a as ce,u as pe,s as Q,r as v,o as ve,w as me,c as x,D as fe,b as n,e as o,f as t,h as O,i as u,E as ge,G as C,C as Z,A as w,d as b,t as _,g as ye,v as S,l as h,H as be,y as xe,k as _e,m as he,n as ke,F as M,z as I,j as we,T as Se,J as V,x as H}from"./index-CVL4H6dy.js";import{_ as G}from"./McpCard-Qj8pCrkM.js";const Ae={class:"space-y-10"},Ce={class:"p-4 bg-blue-50 dark:bg-blue-900/20 border-l-4 border-blue-400 text-blue-800 dark:text-blue-200"},Me={class:"flex"},Ie={class:"flex-shrink-0"},$e={class:"ml-3"},Te={class:"text-sm"},Ue={class:"border-b border-gray-200 dark:border-gray-700"},De={class:"-mb-px flex space-x-6","aria-label":"Tabs"},Re={key:0,class:"bg-white dark:bg-gray-800 shadow-md rounded-lg"},Ee={class:"px-4 py-5 sm:p-6"},Le={class:"text-xl font-bold leading-6 text-gray-900 dark:text-white capitalize"},Ne={class:"border-t border-gray-200 dark:border-gray-700"},Pe={class:"grid grid-cols-1 sm:grid-cols-2 gap-6"},Fe=["placeholder"],Ve={key:0},He=["placeholder"],Ge={key:1},je={class:"mt-2 flex items-center gap-x-4"},Be={class:"h-16 w-16 rounded-md bg-gray-200 dark:bg-gray-700 flex items-center justify-center overflow-hidden"},Oe=["src"],Xe={class:"flex-grow space-y-2"},qe={class:"flex items-center gap-x-3"},We=["title"],Ye={class:"flex-grow flex flex-col"},Ke=["disabled"],ze={class:"space-y-4"},Je={key:0,class:"mt-1 text-xs text-gray-500 dark:text-gray-400"},Qe={key:1,class:"relative"},Ze=["type"],et={key:0,class:"p-4 space-y-4 border rounded-md dark:border-gray-600"},tt=["readonly"],st={class:"mt-2 space-y-2"},at=["id","value"],lt=["for"],ot={key:0},nt={class:"mt-1 flex items-center gap-x-3"},it={class:"text-sm text-gray-500 dark:text-gray-400 flex-grow"},rt={class:"flex justify-end items-center gap-x-3 pt-2"},dt=["disabled"],ut={class:"flex justify-between items-center mb-4 flex-wrap gap-4"},ct={class:"flex items-center gap-x-3"},pt={key:0,class:"empty-state-card"},vt={key:1,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5"},mt={class:"flex justify-between items-center my-4 flex-wrap gap-4"},ft=["disabled"],gt={key:0,class:"empty-state-card"},yt={key:1,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5"},bt={class:"flex justify-between items-center mb-4 flex-wrap gap-4"},xt={class:"flex items-center gap-x-3"},_t={key:0,class:"empty-state-card"},ht={key:1,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5"},kt={key:0,class:"empty-state-card"},wt={key:1,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5"},St={__name:"ServicesSettings",setup(At){const c=ue(),m=ce(),ee=pe(),{userMcps:X,userApps:q}=Q(c),{user:$}=Q(ee),r=v("mcps"),te=[{id:"email",label:"Email Address"},{id:"first_name",label:"First Name"},{id:"family_name",label:"Family Name"},{id:"birth_date",label:"Birth Date"}],j=(a="mcps",e="user")=>({name:"",client_id:"",url:"",icon:"",active:!0,type:e,authentication_type:"none",authentication_key:"",sso_redirect_uri:"",sso_user_infos_to_share:[],port:null}),l=v(j()),d=v(null),T=v(!1),U=v(!1),A=v(!1),W=v(null),B=v(!1),D=v(!1);ve(()=>{c.fetchMcps(),c.fetchApps()}),me(()=>l.value.icon,()=>{B.value=!1});const p=x(()=>d.value!==null),se=x(()=>l.value.authentication_type==="lollms_sso"),k=x(()=>p.value&&d.value.is_installed),Y=x(()=>X.value.filter(a=>a.type==="user").sort((a,e)=>a.name.localeCompare(e.name))),K=x(()=>X.value.filter(a=>a.type==="system").sort((a,e)=>a.name.localeCompare(e.name))),z=x(()=>q.value.filter(a=>a.type==="user").sort((a,e)=>a.name.localeCompare(e.name))),J=x(()=>q.value.filter(a=>a.type==="system").sort((a,e)=>a.name.localeCompare(e.name)));function R(a,e="user"){p.value&&L(),r.value=a,l.value=j(a,e),D.value=!0,window.scrollTo({top:0,behavior:"smooth"})}function E(a,e){r.value=e,d.value={...a,_type:e},l.value.name=a.name,l.value.url=a.url||"",l.value.icon=a.icon||"",l.value.active=typeof a.active=="boolean"?a.active:!0,l.value.type=a.type||"user",l.value.authentication_type=a.authentication_type||"none",l.value.authentication_key="",l.value.sso_redirect_uri=a.sso_redirect_uri||"",l.value.sso_user_infos_to_share=a.sso_user_infos_to_share||[],l.value.port=a.port||null,D.value=!0,window.scrollTo({top:0,behavior:"smooth"})}function L(){d.value=null,l.value=j(r.value),A.value=!1,D.value=!1}function ae(){B.value=!0}async function le(){U.value=!0;try{await c.triggerMcpReload()}finally{U.value=!1}}async function oe(){if(!l.value.name||!l.value.url&&!k.value){m.addNotification("Name and URL are required.","warning");return}T.value=!0;try{const a={...l.value};a.port&&(a.port=Number(a.port));const e=r.value==="apps";p.value?await(e?c.updateApp(d.value.id,a):c.updateMcp(d.value.id,a)):await(e?c.addApp(a):c.addMcp(a)),L()}finally{T.value=!1}}async function ne(a,e){if(await m.showConfirmation({title:"Generate New Secret?",message:`This will generate a new SSO secret for '${a.name}'. Your existing application using the old secret will no longer be able to authenticate. This action is irreversible.`,confirmText:"Generate Secret"})){const i=await(e==="apps"?c.generateAppSsoSecret(a.id):c.generateMcpSsoSecret(a.id));i&&m.openModal("passwordResetLink",{title:"New SSO Secret Generated",message:`This is the new SSO secret for '${a.name}'. Copy it now, as you will not be able to see it again.`,link:i,copyButtonText:"Copy Secret"})}}async function N(a,e){await m.showConfirmation({title:`Delete '${a.name}'?`,message:`Are you sure you want to remove this ${e==="mcps"?"MCP server":"Application"}? This cannot be undone.`,confirmText:"Delete"})&&(d.value&&d.value.id===a.id&&L(),await(e==="apps"?c.deleteApp(a.id):c.deleteMcp(a.id)))}function ie(){W.value.click()}function re(a){const e=a.target.files[0];if(!e)return;if(!["image/jpeg","image/png","image/gif","image/webp","image/svg+xml"].includes(e.type)){m.addNotification("Invalid file type. Please select an image.","error");return}if(e.type==="image/svg+xml"){const i=new FileReader;i.onload=f=>{l.value.icon=f.target.result},i.onerror=()=>{m.addNotification("Failed to read the SVG file.","error")},i.readAsDataURL(e),a.target.value="";return}const s=new FileReader;s.onload=i=>{const f=new Image;f.onload=()=>{let g=f.width,y=f.height;g>y?g>128&&(y=Math.round(y*(128/g)),g=128):y>128&&(g=Math.round(g*(128/y)),y=128);const F=document.createElement("canvas");F.width=g,F.height=y,F.getContext("2d").drawImage(f,0,0,g,y),l.value.icon=F.toDataURL("image/png")},f.onerror=()=>{m.addNotification("Failed to load image for processing.","error")},f.src=i.target.result},s.onerror=()=>{m.addNotification("Failed to read the file.","error")},s.readAsDataURL(e),a.target.value=""}return(a,e)=>{const P=fe("router-link");return o(),n("div",Ae,[t("div",Ce,[t("div",Me,[t("div",Ie,[O(ge,{class:"h-5 w-5 text-blue-400","aria-hidden":"true"})]),t("div",$e,[t("p",Te,[e[21]||(e[21]=C(" This section is for registering personal, external Apps and MCPs by providing a URL. ")),e[22]||(e[22]=t("br",null,null,-1)),e[23]||(e[23]=C(" For locally installed and hosted services with advanced configuration, please visit the ")),O(P,{to:"/admin",class:"font-medium underline hover:text-blue-600 dark:hover:text-blue-300"},{default:Z(()=>e[20]||(e[20]=[C("Admin Panel")])),_:1,__:[20]}),e[24]||(e[24]=C(". "))])])])]),t("div",Ue,[t("nav",De,[t("button",{onClick:e[0]||(e[0]=s=>r.value="mcps"),class:w(["tab-button",r.value==="mcps"?"active":"inactive"])}," MCP Servers ",2),t("button",{onClick:e[1]||(e[1]=s=>r.value="apps"),class:w(["tab-button",r.value==="apps"?"active":"inactive"])}," Applications ",2)])]),O(Se,{name:"form-fade"},{default:Z(()=>[D.value?(o(),n("div",Re,[t("div",Ee,[t("h2",Le,_(p.value?"Edit":"Add New")+" "+_(r.value==="mcps"?"MCP Server":"Application"),1)]),t("div",Ne,[t("form",{onSubmit:ye(oe,["prevent"]),class:"p-4 sm:p-6 space-y-6"},[t("div",Pe,[t("div",null,[e[25]||(e[25]=t("label",{for:"formName",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Name",-1)),u(t("input",{type:"text",id:"formName","onUpdate:modelValue":e[2]||(e[2]=s=>l.value.name=s),class:"input-field mt-1",placeholder:r.value==="mcps"?"My Local Server":"My Web App",required:""},null,8,Fe),[[S,l.value.name]])]),k.value?(o(),n("div",Ge,[e[27]||(e[27]=t("label",{for:"formPort",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Port",-1)),u(t("input",{type:"number",id:"formPort","onUpdate:modelValue":e[4]||(e[4]=s=>l.value.port=s),class:"input-field mt-1",placeholder:"e.g., 9601",required:""},null,512),[[S,l.value.port]])])):(o(),n("div",Ve,[e[26]||(e[26]=t("label",{for:"formUrl",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"URL",-1)),u(t("input",{type:"url",id:"formUrl","onUpdate:modelValue":e[3]||(e[3]=s=>l.value.url=s),class:"input-field mt-1",placeholder:r.value==="mcps"?"http://127.0.0.1:9602":"https://example.com",required:""},null,8,He),[[S,l.value.url]])]))]),t("div",null,[e[28]||(e[28]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Icon (Optional)",-1)),t("div",je,[t("div",Be,[l.value.icon&&!B.value?(o(),n("img",{key:0,src:l.value.icon,onError:ae,alt:"Icon Preview",class:"h-full w-full object-cover"},null,40,Oe)):(o(),h(be,{key:1,class:"w-8 h-8 text-gray-500 dark:text-gray-400"}))]),t("div",Xe,[u(t("input",{type:"text","onUpdate:modelValue":e[5]||(e[5]=s=>l.value.icon=s),class:"input-field",placeholder:"Paste image URL or upload a file"},null,512),[[S,l.value.icon]]),t("div",qe,[t("button",{onClick:ie,type:"button",class:"btn btn-secondary text-sm"},"Upload File"),l.value.icon?(o(),n("button",{key:0,onClick:e[6]||(e[6]=s=>l.value.icon=""),type:"button",class:"text-sm font-medium text-red-600 hover:text-red-500"},"Remove")):b("",!0)])])]),t("input",{type:"file",ref_key:"fileInput",ref:W,onChange:re,class:"hidden",accept:"image/png, image/jpeg, image/gif, image/webp, image/svg+xml"},null,544)]),t("div",{class:"flex items-center justify-between bg-gray-50 dark:bg-gray-700/50 p-3 rounded-md",title:k.value?"Status is controlled from the Apps Management panel":""},[t("span",Ye,[t("span",{class:w(["text-sm font-medium",k.value?"text-gray-500 dark:text-gray-400":"text-gray-900 dark:text-gray-100"])},"Active",2),e[29]||(e[29]=t("span",{class:"text-sm text-gray-500 dark:text-gray-400"},"Inactive items cannot be used.",-1))]),t("button",{onClick:e[7]||(e[7]=s=>l.value.active=!l.value.active),type:"button",disabled:k.value,class:w([l.value.active?"bg-blue-600":"bg-gray-200 dark:bg-gray-600","relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800",{"opacity-50 cursor-not-allowed":k.value}])},[t("span",{class:w([l.value.active?"translate-x-5":"translate-x-0","pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out"])},null,2)],10,Ke)],8,We),t("fieldset",ze,[e[32]||(e[32]=t("legend",{class:"text-sm font-medium text-gray-700 dark:text-gray-300"},"Authentication",-1)),u(t("select",{id:"formAuthType","onUpdate:modelValue":e[8]||(e[8]=s=>l.value.authentication_type=s),class:"input-field"},e[30]||(e[30]=[t("option",{value:"none"},"None",-1),t("option",{value:"lollms_sso"},"LoLLMs SSO",-1),t("option",{value:"lollms_chat_auth"},"LoLLMs Chat Auth",-1),t("option",{value:"bearer"},"Bearer Token",-1)]),512),[[xe,l.value.authentication_type]]),l.value.authentication_type==="lollms_chat_auth"?(o(),n("p",Je," A temporary token will be generated by LoLLMs for each session. ")):b("",!0),l.value.authentication_type==="bearer"?(o(),n("div",Qe,[e[31]||(e[31]=t("label",{for:"formKey",class:"sr-only"},"Authentication Key",-1)),u(t("input",{type:A.value?"text":"password",id:"formKey","onUpdate:modelValue":e[9]||(e[9]=s=>l.value.authentication_key=s),class:"input-field pr-10",placeholder:"Paste your Bearer token here"},null,8,Ze),[[_e,l.value.authentication_key]]),t("button",{type:"button",onClick:e[10]||(e[10]=s=>A.value=!A.value),class:"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600 dark:hover:text-gray-200"},[A.value?(o(),h(he,{key:0,class:"w-5 h-5"})):(o(),h(ke,{key:1,class:"w-5 h-5"}))])])):b("",!0)]),se.value?(o(),n("div",et,[e[39]||(e[39]=t("h4",{class:"font-medium text-gray-800 dark:text-gray-200"},"SSO Configuration",-1)),t("div",null,[e[33]||(e[33]=t("label",{for:"ssoClientId",class:"block text-sm font-medium"},"Client ID",-1)),u(t("input",{type:"text",id:"ssoClientId","onUpdate:modelValue":e[11]||(e[11]=s=>l.value.client_id=s),class:w(["input-field mt-1",{"bg-gray-100 dark:bg-gray-700":p.value&&d.value.client_id}]),readonly:p.value&&d.value.client_id,placeholder:"e.g., my_cool_app_v1 (optional)"},null,10,tt),[[S,l.value.client_id]]),e[34]||(e[34]=t("p",{class:"mt-1 text-xs text-gray-500 dark:text-gray-400"},[C(" A unique identifier for this application. URL-safe characters only. If left blank, one will be generated from the name. "),t("strong",{class:"font-semibold"},"Cannot be changed after creation.")],-1))]),t("div",null,[e[35]||(e[35]=t("label",{for:"ssoRedirectUri",class:"block text-sm font-medium"},"Redirect URI",-1)),u(t("input",{type:"url",id:"ssoRedirectUri","onUpdate:modelValue":e[12]||(e[12]=s=>l.value.sso_redirect_uri=s),class:"input-field mt-1",placeholder:"https://yourapp.com/lollms_auth",required:""},null,512),[[S,l.value.sso_redirect_uri]]),e[36]||(e[36]=t("p",{class:"mt-1 text-xs text-gray-500 dark:text-gray-400"},"The URL where users are sent after successful authentication.",-1))]),t("div",null,[e[37]||(e[37]=t("label",{class:"block text-sm font-medium"},"User Info to Share",-1)),t("div",st,[(o(),n(M,null,I(te,s=>t("div",{key:s.id,class:"flex items-center"},[u(t("input",{id:`sso-info-${s.id}`,type:"checkbox",value:s.id,"onUpdate:modelValue":e[13]||(e[13]=i=>l.value.sso_user_infos_to_share=i),class:"h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500"},null,8,at),[[we,l.value.sso_user_infos_to_share]]),t("label",{for:`sso-info-${s.id}`,class:"ml-2 text-sm text-gray-700 dark:text-gray-300"},_(s.label),9,lt)])),64))])]),p.value?(o(),n("div",ot,[e[38]||(e[38]=t("label",{class:"block text-sm font-medium"},"SSO Secret",-1)),t("div",nt,[t("p",it,_(d.value.sso_secret_exists?"A secret is configured.":"No secret has been generated."),1),t("button",{type:"button",onClick:e[14]||(e[14]=s=>ne(d.value,r.value)),class:"btn btn-secondary text-sm"},_(d.value.sso_secret_exists?"Regenerate Secret":"Generate Secret"),1)])])):b("",!0)])):b("",!0),t("div",rt,[t("button",{onClick:L,type:"button",class:"btn btn-secondary"},"Cancel"),t("button",{type:"submit",class:"btn btn-primary",disabled:T.value},_(T.value?p.value?"Saving...":"Adding...":p.value?"Save Changes":`Add ${r.value==="mcps"?"MCP":"App"}`),9,dt)])],32)])])):b("",!0)]),_:1}),u(t("section",null,[t("div",ut,[e[40]||(e[40]=t("h3",{class:"text-xl font-bold leading-6 text-gray-900 dark:text-white"},"Your Personal MCPs",-1)),t("div",ct,[t("button",{onClick:e[15]||(e[15]=s=>R("mcps","user")),class:"btn btn-primary text-sm"},"+ Add Personal Server"),H($).is_admin?(o(),n("button",{key:0,onClick:e[16]||(e[16]=s=>R("mcps","system")),class:"btn btn-secondary text-sm"},"+ Add System Server")):b("",!0)])]),Y.value.length===0?(o(),n("div",pt,e[41]||(e[41]=[t("p",null,"You haven't added any personal MCP servers yet.",-1)]))):(o(),n("div",vt,[(o(!0),n(M,null,I(Y.value,s=>(o(),h(G,{key:s.id,mcp:s,"is-editable":"",onEdit:i=>E(s,"mcps"),onDelete:i=>N(s,"mcps")},null,8,["mcp","onEdit","onDelete"]))),128))]))],512),[[V,r.value==="mcps"]]),u(t("section",null,[t("div",mt,[e[42]||(e[42]=t("h3",{class:"text-xl font-bold leading-6 text-gray-900 dark:text-white"},"System MCPs",-1)),t("button",{onClick:e[17]||(e[17]=s=>le()),class:"btn btn-secondary text-sm",disabled:U.value},_(U.value?"Reloading...":"Reload All Servers"),9,ft)]),K.value.length===0?(o(),n("div",gt,e[43]||(e[43]=[t("p",null,"No system-wide MCP servers are available.",-1)]))):(o(),n("div",yt,[(o(!0),n(M,null,I(K.value,s=>(o(),h(G,{key:s.id,mcp:s,"is-editable":H($).is_admin,onEdit:i=>E(s,"mcps"),onDelete:i=>N(s,"mcps")},null,8,["mcp","is-editable","onEdit","onDelete"]))),128))]))],512),[[V,r.value==="mcps"]]),u(t("section",null,[t("div",bt,[e[44]||(e[44]=t("h3",{class:"text-xl font-bold leading-6 text-gray-900 dark:text-white"},"Your Personal Apps",-1)),t("div",xt,[t("button",{onClick:e[18]||(e[18]=s=>R("apps","user")),class:"btn btn-primary text-sm"},"+ Add Personal App"),H($).is_admin?(o(),n("button",{key:0,onClick:e[19]||(e[19]=s=>R("apps","system")),class:"btn btn-secondary text-sm"},"+ Add System App")):b("",!0)])]),z.value.length===0?(o(),n("div",_t,e[45]||(e[45]=[t("p",null,"You haven't added any personal Apps yet.",-1)]))):(o(),n("div",ht,[(o(!0),n(M,null,I(z.value,s=>(o(),h(G,{key:s.id,mcp:s,"is-editable":"",onEdit:i=>E(s,"apps"),onDelete:i=>N(s,"apps")},null,8,["mcp","onEdit","onDelete"]))),128))]))],512),[[V,r.value==="apps"]]),u(t("section",null,[e[47]||(e[47]=t("h3",{class:"text-xl font-bold leading-6 text-gray-900 dark:text-white my-4"},"System Apps",-1)),J.value.length===0?(o(),n("div",kt,e[46]||(e[46]=[t("p",null,"No system-wide Apps are available.",-1)]))):(o(),n("div",wt,[(o(!0),n(M,null,I(J.value,s=>(o(),h(G,{key:s.id,mcp:s,"is-editable":H($).is_admin,onEdit:i=>E(s,"apps"),onDelete:i=>N(s,"apps")},null,8,["mcp","is-editable","onEdit","onDelete"]))),128))]))],512),[[V,r.value==="apps"]])])}}},Ut=de(St,[["__scopeId","data-v-01b23f92"]]);export{Ut as default};
